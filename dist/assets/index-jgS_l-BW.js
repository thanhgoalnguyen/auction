(function(){const _=document.createElement("link").relList;if(_&&_.supports&&_.supports("modulepreload"))return;for(const R of document.querySelectorAll('link[rel="modulepreload"]'))v(R);new MutationObserver(R=>{for(const w of R)if(w.type==="childList")for(const x of w.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&v(x)}).observe(document,{childList:!0,subtree:!0});function g(R){const w={};return R.integrity&&(w.integrity=R.integrity),R.referrerPolicy&&(w.referrerPolicy=R.referrerPolicy),R.crossOrigin==="use-credentials"?w.credentials="include":R.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function v(R){if(R.ep)return;R.ep=!0;const w=g(R);fetch(R.href,w)}})();function zH(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var l2={exports:{}},C0={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var p4;function KH(){if(p4)return C0;p4=1;var p=Symbol.for("react.transitional.element"),_=Symbol.for("react.fragment");function g(v,R,w){var x=null;if(w!==void 0&&(x=""+w),R.key!==void 0&&(x=""+R.key),"key"in R){w={};for(var W in R)W!=="key"&&(w[W]=R[W])}else w=R;return R=w.ref,{$$typeof:p,type:v,key:x,ref:R!==void 0?R:null,props:w}}return C0.Fragment=_,C0.jsx=g,C0.jsxs=g,C0}var f4;function YH(){return f4||(f4=1,l2.exports=KH()),l2.exports}var A=YH(),d2={exports:{}},ii={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var m4;function qH(){if(m4)return ii;m4=1;var p=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),w=Symbol.for("react.consumer"),x=Symbol.for("react.context"),W=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),V=Symbol.for("react.memo"),q=Symbol.for("react.lazy"),z=Symbol.iterator;function ce(le){return le===null||typeof le!="object"?null:(le=z&&le[z]||le["@@iterator"],typeof le=="function"?le:null)}var Z={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ae=Object.assign,ne={};function se(le,Ge,tt){this.props=le,this.context=Ge,this.refs=ne,this.updater=tt||Z}se.prototype.isReactComponent={},se.prototype.setState=function(le,Ge){if(typeof le!="object"&&typeof le!="function"&&le!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,le,Ge,"setState")},se.prototype.forceUpdate=function(le){this.updater.enqueueForceUpdate(this,le,"forceUpdate")};function Q(){}Q.prototype=se.prototype;function oe(le,Ge,tt){this.props=le,this.context=Ge,this.refs=ne,this.updater=tt||Z}var fe=oe.prototype=new Q;fe.constructor=oe,ae(fe,se.prototype),fe.isPureReactComponent=!0;var Ue=Array.isArray,Ne={H:null,A:null,T:null,S:null,V:null},ft=Object.prototype.hasOwnProperty;function $e(le,Ge,tt,it,_t,Si){return tt=Si.ref,{$$typeof:p,type:le,key:Ge,ref:tt!==void 0?tt:null,props:Si}}function De(le,Ge){return $e(le.type,Ge,void 0,void 0,void 0,le.props)}function Et(le){return typeof le=="object"&&le!==null&&le.$$typeof===p}function qe(le){var Ge={"=":"=0",":":"=2"};return"$"+le.replace(/[=:]/g,function(tt){return Ge[tt]})}var Qe=/\/+/g;function Ye(le,Ge){return typeof le=="object"&&le!==null&&le.key!=null?qe(""+le.key):Ge.toString(36)}function Vt(){}function Ct(le){switch(le.status){case"fulfilled":return le.value;case"rejected":throw le.reason;default:switch(typeof le.status=="string"?le.then(Vt,Vt):(le.status="pending",le.then(function(Ge){le.status==="pending"&&(le.status="fulfilled",le.value=Ge)},function(Ge){le.status==="pending"&&(le.status="rejected",le.reason=Ge)})),le.status){case"fulfilled":return le.value;case"rejected":throw le.reason}}throw le}function ui(le,Ge,tt,it,_t){var Si=typeof le;(Si==="undefined"||Si==="boolean")&&(le=null);var Bt=!1;if(le===null)Bt=!0;else switch(Si){case"bigint":case"string":case"number":Bt=!0;break;case"object":switch(le.$$typeof){case p:case _:Bt=!0;break;case q:return Bt=le._init,ui(Bt(le._payload),Ge,tt,it,_t)}}if(Bt)return _t=_t(le),Bt=it===""?"."+Ye(le,0):it,Ue(_t)?(tt="",Bt!=null&&(tt=Bt.replace(Qe,"$&/")+"/"),ui(_t,Ge,tt,"",function(La){return La})):_t!=null&&(Et(_t)&&(_t=De(_t,tt+(_t.key==null||le&&le.key===_t.key?"":(""+_t.key).replace(Qe,"$&/")+"/")+Bt)),Ge.push(_t)),1;Bt=0;var Sr=it===""?".":it+":";if(Ue(le))for(var en=0;en<le.length;en++)it=le[en],Si=Sr+Ye(it,en),Bt+=ui(it,Ge,tt,Si,_t);else if(en=ce(le),typeof en=="function")for(le=en.call(le),en=0;!(it=le.next()).done;)it=it.value,Si=Sr+Ye(it,en++),Bt+=ui(it,Ge,tt,Si,_t);else if(Si==="object"){if(typeof le.then=="function")return ui(Ct(le),Ge,tt,it,_t);throw Ge=String(le),Error("Objects are not valid as a React child (found: "+(Ge==="[object Object]"?"object with keys {"+Object.keys(le).join(", ")+"}":Ge)+"). If you meant to render a collection of children, use an array instead.")}return Bt}function Le(le,Ge,tt){if(le==null)return le;var it=[],_t=0;return ui(le,it,"","",function(Si){return Ge.call(tt,Si,_t++)}),it}function ze(le){if(le._status===-1){var Ge=le._result;Ge=Ge(),Ge.then(function(tt){(le._status===0||le._status===-1)&&(le._status=1,le._result=tt)},function(tt){(le._status===0||le._status===-1)&&(le._status=2,le._result=tt)}),le._status===-1&&(le._status=0,le._result=Ge)}if(le._status===1)return le._result.default;throw le._result}var We=typeof reportError=="function"?reportError:function(le){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ge=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof le=="object"&&le!==null&&typeof le.message=="string"?String(le.message):String(le),error:le});if(!window.dispatchEvent(Ge))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",le);return}console.error(le)};function Tt(){}return ii.Children={map:Le,forEach:function(le,Ge,tt){Le(le,function(){Ge.apply(this,arguments)},tt)},count:function(le){var Ge=0;return Le(le,function(){Ge++}),Ge},toArray:function(le){return Le(le,function(Ge){return Ge})||[]},only:function(le){if(!Et(le))throw Error("React.Children.only expected to receive a single React element child.");return le}},ii.Component=se,ii.Fragment=g,ii.Profiler=R,ii.PureComponent=oe,ii.StrictMode=v,ii.Suspense=P,ii.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ne,ii.__COMPILER_RUNTIME={__proto__:null,c:function(le){return Ne.H.useMemoCache(le)}},ii.cache=function(le){return function(){return le.apply(null,arguments)}},ii.cloneElement=function(le,Ge,tt){if(le==null)throw Error("The argument must be a React element, but you passed "+le+".");var it=ae({},le.props),_t=le.key,Si=void 0;if(Ge!=null)for(Bt in Ge.ref!==void 0&&(Si=void 0),Ge.key!==void 0&&(_t=""+Ge.key),Ge)!ft.call(Ge,Bt)||Bt==="key"||Bt==="__self"||Bt==="__source"||Bt==="ref"&&Ge.ref===void 0||(it[Bt]=Ge[Bt]);var Bt=arguments.length-2;if(Bt===1)it.children=tt;else if(1<Bt){for(var Sr=Array(Bt),en=0;en<Bt;en++)Sr[en]=arguments[en+2];it.children=Sr}return $e(le.type,_t,void 0,void 0,Si,it)},ii.createContext=function(le){return le={$$typeof:x,_currentValue:le,_currentValue2:le,_threadCount:0,Provider:null,Consumer:null},le.Provider=le,le.Consumer={$$typeof:w,_context:le},le},ii.createElement=function(le,Ge,tt){var it,_t={},Si=null;if(Ge!=null)for(it in Ge.key!==void 0&&(Si=""+Ge.key),Ge)ft.call(Ge,it)&&it!=="key"&&it!=="__self"&&it!=="__source"&&(_t[it]=Ge[it]);var Bt=arguments.length-2;if(Bt===1)_t.children=tt;else if(1<Bt){for(var Sr=Array(Bt),en=0;en<Bt;en++)Sr[en]=arguments[en+2];_t.children=Sr}if(le&&le.defaultProps)for(it in Bt=le.defaultProps,Bt)_t[it]===void 0&&(_t[it]=Bt[it]);return $e(le,Si,void 0,void 0,null,_t)},ii.createRef=function(){return{current:null}},ii.forwardRef=function(le){return{$$typeof:W,render:le}},ii.isValidElement=Et,ii.lazy=function(le){return{$$typeof:q,_payload:{_status:-1,_result:le},_init:ze}},ii.memo=function(le,Ge){return{$$typeof:V,type:le,compare:Ge===void 0?null:Ge}},ii.startTransition=function(le){var Ge=Ne.T,tt={};Ne.T=tt;try{var it=le(),_t=Ne.S;_t!==null&&_t(tt,it),typeof it=="object"&&it!==null&&typeof it.then=="function"&&it.then(Tt,We)}catch(Si){We(Si)}finally{Ne.T=Ge}},ii.unstable_useCacheRefresh=function(){return Ne.H.useCacheRefresh()},ii.use=function(le){return Ne.H.use(le)},ii.useActionState=function(le,Ge,tt){return Ne.H.useActionState(le,Ge,tt)},ii.useCallback=function(le,Ge){return Ne.H.useCallback(le,Ge)},ii.useContext=function(le){return Ne.H.useContext(le)},ii.useDebugValue=function(){},ii.useDeferredValue=function(le,Ge){return Ne.H.useDeferredValue(le,Ge)},ii.useEffect=function(le,Ge,tt){var it=Ne.H;if(typeof tt=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return it.useEffect(le,Ge)},ii.useId=function(){return Ne.H.useId()},ii.useImperativeHandle=function(le,Ge,tt){return Ne.H.useImperativeHandle(le,Ge,tt)},ii.useInsertionEffect=function(le,Ge){return Ne.H.useInsertionEffect(le,Ge)},ii.useLayoutEffect=function(le,Ge){return Ne.H.useLayoutEffect(le,Ge)},ii.useMemo=function(le,Ge){return Ne.H.useMemo(le,Ge)},ii.useOptimistic=function(le,Ge){return Ne.H.useOptimistic(le,Ge)},ii.useReducer=function(le,Ge,tt){return Ne.H.useReducer(le,Ge,tt)},ii.useRef=function(le){return Ne.H.useRef(le)},ii.useState=function(le){return Ne.H.useState(le)},ii.useSyncExternalStore=function(le,Ge,tt){return Ne.H.useSyncExternalStore(le,Ge,tt)},ii.useTransition=function(){return Ne.H.useTransition()},ii.version="19.1.1",ii}var _4;function x2(){return _4||(_4=1,d2.exports=qH()),d2.exports}var ie=x2();const cr=zH(ie);var u2={exports:{}},b0={},h2={exports:{}},p2={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var E4;function XH(){return E4||(E4=1,(function(p){function _(Le,ze){var We=Le.length;Le.push(ze);e:for(;0<We;){var Tt=We-1>>>1,le=Le[Tt];if(0<R(le,ze))Le[Tt]=ze,Le[We]=le,We=Tt;else break e}}function g(Le){return Le.length===0?null:Le[0]}function v(Le){if(Le.length===0)return null;var ze=Le[0],We=Le.pop();if(We!==ze){Le[0]=We;e:for(var Tt=0,le=Le.length,Ge=le>>>1;Tt<Ge;){var tt=2*(Tt+1)-1,it=Le[tt],_t=tt+1,Si=Le[_t];if(0>R(it,We))_t<le&&0>R(Si,it)?(Le[Tt]=Si,Le[_t]=We,Tt=_t):(Le[Tt]=it,Le[tt]=We,Tt=tt);else if(_t<le&&0>R(Si,We))Le[Tt]=Si,Le[_t]=We,Tt=_t;else break e}}return ze}function R(Le,ze){var We=Le.sortIndex-ze.sortIndex;return We!==0?We:Le.id-ze.id}if(p.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var w=performance;p.unstable_now=function(){return w.now()}}else{var x=Date,W=x.now();p.unstable_now=function(){return x.now()-W}}var P=[],V=[],q=1,z=null,ce=3,Z=!1,ae=!1,ne=!1,se=!1,Q=typeof setTimeout=="function"?setTimeout:null,oe=typeof clearTimeout=="function"?clearTimeout:null,fe=typeof setImmediate<"u"?setImmediate:null;function Ue(Le){for(var ze=g(V);ze!==null;){if(ze.callback===null)v(V);else if(ze.startTime<=Le)v(V),ze.sortIndex=ze.expirationTime,_(P,ze);else break;ze=g(V)}}function Ne(Le){if(ne=!1,Ue(Le),!ae)if(g(P)!==null)ae=!0,ft||(ft=!0,Ye());else{var ze=g(V);ze!==null&&ui(Ne,ze.startTime-Le)}}var ft=!1,$e=-1,De=5,Et=-1;function qe(){return se?!0:!(p.unstable_now()-Et<De)}function Qe(){if(se=!1,ft){var Le=p.unstable_now();Et=Le;var ze=!0;try{e:{ae=!1,ne&&(ne=!1,oe($e),$e=-1),Z=!0;var We=ce;try{t:{for(Ue(Le),z=g(P);z!==null&&!(z.expirationTime>Le&&qe());){var Tt=z.callback;if(typeof Tt=="function"){z.callback=null,ce=z.priorityLevel;var le=Tt(z.expirationTime<=Le);if(Le=p.unstable_now(),typeof le=="function"){z.callback=le,Ue(Le),ze=!0;break t}z===g(P)&&v(P),Ue(Le)}else v(P);z=g(P)}if(z!==null)ze=!0;else{var Ge=g(V);Ge!==null&&ui(Ne,Ge.startTime-Le),ze=!1}}break e}finally{z=null,ce=We,Z=!1}ze=void 0}}finally{ze?Ye():ft=!1}}}var Ye;if(typeof fe=="function")Ye=function(){fe(Qe)};else if(typeof MessageChannel<"u"){var Vt=new MessageChannel,Ct=Vt.port2;Vt.port1.onmessage=Qe,Ye=function(){Ct.postMessage(null)}}else Ye=function(){Q(Qe,0)};function ui(Le,ze){$e=Q(function(){Le(p.unstable_now())},ze)}p.unstable_IdlePriority=5,p.unstable_ImmediatePriority=1,p.unstable_LowPriority=4,p.unstable_NormalPriority=3,p.unstable_Profiling=null,p.unstable_UserBlockingPriority=2,p.unstable_cancelCallback=function(Le){Le.callback=null},p.unstable_forceFrameRate=function(Le){0>Le||125<Le?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):De=0<Le?Math.floor(1e3/Le):5},p.unstable_getCurrentPriorityLevel=function(){return ce},p.unstable_next=function(Le){switch(ce){case 1:case 2:case 3:var ze=3;break;default:ze=ce}var We=ce;ce=ze;try{return Le()}finally{ce=We}},p.unstable_requestPaint=function(){se=!0},p.unstable_runWithPriority=function(Le,ze){switch(Le){case 1:case 2:case 3:case 4:case 5:break;default:Le=3}var We=ce;ce=Le;try{return ze()}finally{ce=We}},p.unstable_scheduleCallback=function(Le,ze,We){var Tt=p.unstable_now();switch(typeof We=="object"&&We!==null?(We=We.delay,We=typeof We=="number"&&0<We?Tt+We:Tt):We=Tt,Le){case 1:var le=-1;break;case 2:le=250;break;case 5:le=1073741823;break;case 4:le=1e4;break;default:le=5e3}return le=We+le,Le={id:q++,callback:ze,priorityLevel:Le,startTime:We,expirationTime:le,sortIndex:-1},We>Tt?(Le.sortIndex=We,_(V,Le),g(P)===null&&Le===g(V)&&(ne?(oe($e),$e=-1):ne=!0,ui(Ne,We-Tt))):(Le.sortIndex=le,_(P,Le),ae||Z||(ae=!0,ft||(ft=!0,Ye()))),Le},p.unstable_shouldYield=qe,p.unstable_wrapCallback=function(Le){var ze=ce;return function(){var We=ce;ce=ze;try{return Le.apply(this,arguments)}finally{ce=We}}}})(p2)),p2}var g4;function JH(){return g4||(g4=1,h2.exports=XH()),h2.exports}var f2={exports:{}},Kr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var S4;function ZH(){if(S4)return Kr;S4=1;var p=x2();function _(P){var V="https://react.dev/errors/"+P;if(1<arguments.length){V+="?args[]="+encodeURIComponent(arguments[1]);for(var q=2;q<arguments.length;q++)V+="&args[]="+encodeURIComponent(arguments[q])}return"Minified React error #"+P+"; visit "+V+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function g(){}var v={d:{f:g,r:function(){throw Error(_(522))},D:g,C:g,L:g,m:g,X:g,S:g,M:g},p:0,findDOMNode:null},R=Symbol.for("react.portal");function w(P,V,q){var z=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:R,key:z==null?null:""+z,children:P,containerInfo:V,implementation:q}}var x=p.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function W(P,V){if(P==="font")return"";if(typeof V=="string")return V==="use-credentials"?V:""}return Kr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=v,Kr.createPortal=function(P,V){var q=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!V||V.nodeType!==1&&V.nodeType!==9&&V.nodeType!==11)throw Error(_(299));return w(P,V,null,q)},Kr.flushSync=function(P){var V=x.T,q=v.p;try{if(x.T=null,v.p=2,P)return P()}finally{x.T=V,v.p=q,v.d.f()}},Kr.preconnect=function(P,V){typeof P=="string"&&(V?(V=V.crossOrigin,V=typeof V=="string"?V==="use-credentials"?V:"":void 0):V=null,v.d.C(P,V))},Kr.prefetchDNS=function(P){typeof P=="string"&&v.d.D(P)},Kr.preinit=function(P,V){if(typeof P=="string"&&V&&typeof V.as=="string"){var q=V.as,z=W(q,V.crossOrigin),ce=typeof V.integrity=="string"?V.integrity:void 0,Z=typeof V.fetchPriority=="string"?V.fetchPriority:void 0;q==="style"?v.d.S(P,typeof V.precedence=="string"?V.precedence:void 0,{crossOrigin:z,integrity:ce,fetchPriority:Z}):q==="script"&&v.d.X(P,{crossOrigin:z,integrity:ce,fetchPriority:Z,nonce:typeof V.nonce=="string"?V.nonce:void 0})}},Kr.preinitModule=function(P,V){if(typeof P=="string")if(typeof V=="object"&&V!==null){if(V.as==null||V.as==="script"){var q=W(V.as,V.crossOrigin);v.d.M(P,{crossOrigin:q,integrity:typeof V.integrity=="string"?V.integrity:void 0,nonce:typeof V.nonce=="string"?V.nonce:void 0})}}else V==null&&v.d.M(P)},Kr.preload=function(P,V){if(typeof P=="string"&&typeof V=="object"&&V!==null&&typeof V.as=="string"){var q=V.as,z=W(q,V.crossOrigin);v.d.L(P,q,{crossOrigin:z,integrity:typeof V.integrity=="string"?V.integrity:void 0,nonce:typeof V.nonce=="string"?V.nonce:void 0,type:typeof V.type=="string"?V.type:void 0,fetchPriority:typeof V.fetchPriority=="string"?V.fetchPriority:void 0,referrerPolicy:typeof V.referrerPolicy=="string"?V.referrerPolicy:void 0,imageSrcSet:typeof V.imageSrcSet=="string"?V.imageSrcSet:void 0,imageSizes:typeof V.imageSizes=="string"?V.imageSizes:void 0,media:typeof V.media=="string"?V.media:void 0})}},Kr.preloadModule=function(P,V){if(typeof P=="string")if(V){var q=W(V.as,V.crossOrigin);v.d.m(P,{as:typeof V.as=="string"&&V.as!=="script"?V.as:void 0,crossOrigin:q,integrity:typeof V.integrity=="string"?V.integrity:void 0})}else v.d.m(P)},Kr.requestFormReset=function(P){v.d.r(P)},Kr.unstable_batchedUpdates=function(P,V){return P(V)},Kr.useFormState=function(P,V,q){return x.H.useFormState(P,V,q)},Kr.useFormStatus=function(){return x.H.useHostTransitionStatus()},Kr.version="19.1.1",Kr}var v4;function QH(){if(v4)return f2.exports;v4=1;function p(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(p)}catch(_){console.error(_)}}return p(),f2.exports=ZH(),f2.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var T4;function $H(){if(T4)return b0;T4=1;var p=JH(),_=x2(),g=QH();function v(a){var o="https://react.dev/errors/"+a;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+a+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function R(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function w(a){var o=a,u=a;if(a.alternate)for(;o.return;)o=o.return;else{a=o;do o=a,(o.flags&4098)!==0&&(u=o.return),a=o.return;while(a)}return o.tag===3?u:null}function x(a){if(a.tag===13){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function W(a){if(w(a)!==a)throw Error(v(188))}function P(a){var o=a.alternate;if(!o){if(o=w(a),o===null)throw Error(v(188));return o!==a?null:a}for(var u=a,m=o;;){var T=u.return;if(T===null)break;var b=T.alternate;if(b===null){if(m=T.return,m!==null){u=m;continue}break}if(T.child===b.child){for(b=T.child;b;){if(b===u)return W(T),a;if(b===m)return W(T),o;b=b.sibling}throw Error(v(188))}if(u.return!==m.return)u=T,m=b;else{for(var F=!1,Y=T.child;Y;){if(Y===u){F=!0,u=T,m=b;break}if(Y===m){F=!0,m=T,u=b;break}Y=Y.sibling}if(!F){for(Y=b.child;Y;){if(Y===u){F=!0,u=b,m=T;break}if(Y===m){F=!0,m=b,u=T;break}Y=Y.sibling}if(!F)throw Error(v(189))}}if(u.alternate!==m)throw Error(v(190))}if(u.tag!==3)throw Error(v(188));return u.stateNode.current===u?a:o}function V(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a;for(a=a.child;a!==null;){if(o=V(a),o!==null)return o;a=a.sibling}return null}var q=Object.assign,z=Symbol.for("react.element"),ce=Symbol.for("react.transitional.element"),Z=Symbol.for("react.portal"),ae=Symbol.for("react.fragment"),ne=Symbol.for("react.strict_mode"),se=Symbol.for("react.profiler"),Q=Symbol.for("react.provider"),oe=Symbol.for("react.consumer"),fe=Symbol.for("react.context"),Ue=Symbol.for("react.forward_ref"),Ne=Symbol.for("react.suspense"),ft=Symbol.for("react.suspense_list"),$e=Symbol.for("react.memo"),De=Symbol.for("react.lazy"),Et=Symbol.for("react.activity"),qe=Symbol.for("react.memo_cache_sentinel"),Qe=Symbol.iterator;function Ye(a){return a===null||typeof a!="object"?null:(a=Qe&&a[Qe]||a["@@iterator"],typeof a=="function"?a:null)}var Vt=Symbol.for("react.client.reference");function Ct(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===Vt?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case ae:return"Fragment";case se:return"Profiler";case ne:return"StrictMode";case Ne:return"Suspense";case ft:return"SuspenseList";case Et:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case Z:return"Portal";case fe:return(a.displayName||"Context")+".Provider";case oe:return(a._context.displayName||"Context")+".Consumer";case Ue:var o=a.render;return a=a.displayName,a||(a=o.displayName||o.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case $e:return o=a.displayName||null,o!==null?o:Ct(a.type)||"Memo";case De:o=a._payload,a=a._init;try{return Ct(a(o))}catch{}}return null}var ui=Array.isArray,Le=_.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ze=g.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,We={pending:!1,data:null,method:null,action:null},Tt=[],le=-1;function Ge(a){return{current:a}}function tt(a){0>le||(a.current=Tt[le],Tt[le]=null,le--)}function it(a,o){le++,Tt[le]=a.current,a.current=o}var _t=Ge(null),Si=Ge(null),Bt=Ge(null),Sr=Ge(null);function en(a,o){switch(it(Bt,o),it(Si,a),it(_t,null),o.nodeType){case 9:case 11:a=(a=o.documentElement)&&(a=a.namespaceURI)?Fv(a):0;break;default:if(a=o.tagName,o=o.namespaceURI)o=Fv(o),a=Gv(o,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}tt(_t),it(_t,a)}function La(){tt(_t),tt(Si),tt(Bt)}function Nl(a){a.memoizedState!==null&&it(Sr,a);var o=_t.current,u=Gv(o,a.type);o!==u&&(it(Si,a),it(_t,u))}function cp(a){Si.current===a&&(tt(_t),tt(Si)),Sr.current===a&&(tt(Sr),fh._currentValue=We)}var qm=Object.prototype.hasOwnProperty,Vs=p.unstable_scheduleCallback,Xm=p.unstable_cancelCallback,iC=p.unstable_shouldYield,bo=p.unstable_requestPaint,as=p.unstable_now,$n=p.unstable_getCurrentPriorityLevel,Dr=p.unstable_ImmediatePriority,lp=p.unstable_UserBlockingPriority,Dl=p.unstable_NormalPriority,nC=p.unstable_LowPriority,Jm=p.unstable_IdlePriority,er=p.log,k0=p.unstable_setDisableYieldValue,Ll=null,mn=null;function js(a){if(typeof er=="function"&&k0(a),mn&&typeof mn.setStrictMode=="function")try{mn.setStrictMode(Ll,a)}catch{}}var vr=Math.clz32?Math.clz32:V0,M0=Math.log,U0=Math.LN2;function V0(a){return a>>>=0,a===0?32:31-(M0(a)/U0|0)|0}var lu=256,ss=4194304;function Ao(a){var o=a&42;if(o!==0)return o;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function dp(a,o,u){var m=a.pendingLanes;if(m===0)return 0;var T=0,b=a.suspendedLanes,F=a.pingedLanes;a=a.warmLanes;var Y=m&134217727;return Y!==0?(m=Y&~b,m!==0?T=Ao(m):(F&=Y,F!==0?T=Ao(F):u||(u=Y&~a,u!==0&&(T=Ao(u))))):(Y=m&~b,Y!==0?T=Ao(Y):F!==0?T=Ao(F):u||(u=m&~a,u!==0&&(T=Ao(u)))),T===0?0:o!==0&&o!==T&&(o&b)===0&&(b=T&-T,u=o&-o,b>=u||b===32&&(u&4194048)!==0)?o:T}function du(a,o){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&o)===0}function Pl(a,o){switch(a){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Zm(){var a=lu;return lu<<=1,(lu&4194048)===0&&(lu=256),a}function j0(){var a=ss;return ss<<=1,(ss&62914560)===0&&(ss=4194304),a}function Qm(a){for(var o=[],u=0;31>u;u++)o.push(a);return o}function uu(a,o){a.pendingLanes|=o,o!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function rC(a,o,u,m,T,b){var F=a.pendingLanes;a.pendingLanes=u,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=u,a.entangledLanes&=u,a.errorRecoveryDisabledLanes&=u,a.shellSuspendCounter=0;var Y=a.entanglements,re=a.expirationTimes,Se=a.hiddenUpdates;for(u=F&~u;0<u;){var Pe=31-vr(u),Be=1<<Pe;Y[Pe]=0,re[Pe]=-1;var be=Se[Pe];if(be!==null)for(Se[Pe]=null,Pe=0;Pe<be.length;Pe++){var we=be[Pe];we!==null&&(we.lane&=-536870913)}u&=~Be}m!==0&&xl(a,m,0),b!==0&&T===0&&a.tag!==0&&(a.suspendedLanes|=b&~(F&~o))}function xl(a,o,u){a.pendingLanes|=o,a.suspendedLanes&=~o;var m=31-vr(o);a.entangledLanes|=o,a.entanglements[m]=a.entanglements[m]|1073741824|u&4194090}function B0(a,o){var u=a.entangledLanes|=o;for(a=a.entanglements;u;){var m=31-vr(u),T=1<<m;T&o|a[m]&o&&(a[m]|=o),u&=~T}}function wo(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function $m(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function F0(){var a=ze.p;return a!==0?a:(a=window.event,a===void 0?32:sT(a.type))}function aC(a,o){var u=ze.p;try{return ze.p=a,o()}finally{ze.p=u}}var _n=Math.random().toString(36).slice(2),lr="__reactFiber$"+_n,Lr="__reactProps$"+_n,Bs="__reactContainer$"+_n,up="__reactEvents$"+_n,G0="__reactListeners$"+_n,H0="__reactHandles$"+_n,W0="__reactResources$"+_n,kl="__reactMarker$"+_n;function hp(a){delete a[lr],delete a[Lr],delete a[up],delete a[G0],delete a[H0]}function Ml(a){var o=a[lr];if(o)return o;for(var u=a.parentNode;u;){if(o=u[Bs]||u[lr]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(a=Kv(a);a!==null;){if(u=a[lr])return u;a=Kv(a)}return o}a=u,u=a.parentNode}return null}function Ul(a){if(a=a[lr]||a[Bs]){var o=a.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return a}return null}function hu(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a.stateNode;throw Error(v(33))}function Ic(a){var o=a[W0];return o||(o=a[W0]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function Ln(a){a[kl]=!0}var pp=new Set,e_={};function la(a,o){Vl(a,o),Vl(a+"Capture",o)}function Vl(a,o){for(e_[a]=o,a=0;a<o.length;a++)pp.add(o[a])}var sC=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Pa={},z0={};function oC(a){return qm.call(z0,a)?!0:qm.call(Pa,a)?!1:sC.test(a)?z0[a]=!0:(Pa[a]=!0,!1)}function an(a,o,u){if(oC(o))if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":a.removeAttribute(o);return;case"boolean":var m=o.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){a.removeAttribute(o);return}}a.setAttribute(o,""+u)}}function fp(a,o,u){if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(o);return}a.setAttribute(o,""+u)}}function Fs(a,o,u,m){if(m===null)a.removeAttribute(u);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(u);return}a.setAttributeNS(o,u,""+m)}}var t_,K0;function Io(a){if(t_===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);t_=o&&o[1]||"",K0=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+t_+a+K0}var i_=!1;function mp(a,o){if(!a||i_)return"";i_=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(o){var Be=function(){throw Error()};if(Object.defineProperty(Be.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Be,[])}catch(we){var be=we}Reflect.construct(a,[],Be)}else{try{Be.call()}catch(we){be=we}a.call(Be.prototype)}}else{try{throw Error()}catch(we){be=we}(Be=a())&&typeof Be.catch=="function"&&Be.catch(function(){})}}catch(we){if(we&&be&&typeof we.stack=="string")return[we.stack,be.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var T=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");T&&T.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=m.DetermineComponentFrameRoot(),F=b[0],Y=b[1];if(F&&Y){var re=F.split(`
`),Se=Y.split(`
`);for(T=m=0;m<re.length&&!re[m].includes("DetermineComponentFrameRoot");)m++;for(;T<Se.length&&!Se[T].includes("DetermineComponentFrameRoot");)T++;if(m===re.length||T===Se.length)for(m=re.length-1,T=Se.length-1;1<=m&&0<=T&&re[m]!==Se[T];)T--;for(;1<=m&&0<=T;m--,T--)if(re[m]!==Se[T]){if(m!==1||T!==1)do if(m--,T--,0>T||re[m]!==Se[T]){var Pe=`
`+re[m].replace(" at new "," at ");return a.displayName&&Pe.includes("<anonymous>")&&(Pe=Pe.replace("<anonymous>",a.displayName)),Pe}while(1<=m&&0<=T);break}}}finally{i_=!1,Error.prepareStackTrace=u}return(u=a?a.displayName||a.name:"")?Io(u):""}function cC(a){switch(a.tag){case 26:case 27:case 5:return Io(a.type);case 16:return Io("Lazy");case 13:return Io("Suspense");case 19:return Io("SuspenseList");case 0:case 15:return mp(a.type,!1);case 11:return mp(a.type.render,!1);case 1:return mp(a.type,!0);case 31:return Io("Activity");default:return""}}function Y0(a){try{var o="";do o+=cC(a),a=a.return;while(a);return o}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function da(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Oc(a){var o=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function n_(a){var o=Oc(a)?"checked":"value",u=Object.getOwnPropertyDescriptor(a.constructor.prototype,o),m=""+a[o];if(!a.hasOwnProperty(o)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var T=u.get,b=u.set;return Object.defineProperty(a,o,{configurable:!0,get:function(){return T.call(this)},set:function(F){m=""+F,b.call(this,F)}}),Object.defineProperty(a,o,{enumerable:u.enumerable}),{getValue:function(){return m},setValue:function(F){m=""+F},stopTracking:function(){a._valueTracker=null,delete a[o]}}}}function _p(a){a._valueTracker||(a._valueTracker=n_(a))}function xi(a){if(!a)return!1;var o=a._valueTracker;if(!o)return!0;var u=o.getValue(),m="";return a&&(m=Oc(a)?a.checked?"true":"false":a.value),a=m,a!==u?(o.setValue(a),!0):!1}function Ep(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var q0=/[\n"\\]/g;function qr(a){return a.replace(q0,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function r_(a,o,u,m,T,b,F,Y){a.name="",F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"?a.type=F:a.removeAttribute("type"),o!=null?F==="number"?(o===0&&a.value===""||a.value!=o)&&(a.value=""+da(o)):a.value!==""+da(o)&&(a.value=""+da(o)):F!=="submit"&&F!=="reset"||a.removeAttribute("value"),o!=null?a_(a,F,da(o)):u!=null?a_(a,F,da(u)):m!=null&&a.removeAttribute("value"),T==null&&b!=null&&(a.defaultChecked=!!b),T!=null&&(a.checked=T&&typeof T!="function"&&typeof T!="symbol"),Y!=null&&typeof Y!="function"&&typeof Y!="symbol"&&typeof Y!="boolean"?a.name=""+da(Y):a.removeAttribute("name")}function X0(a,o,u,m,T,b,F,Y){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(a.type=b),o!=null||u!=null){if(!(b!=="submit"&&b!=="reset"||o!=null))return;u=u!=null?""+da(u):"",o=o!=null?""+da(o):u,Y||o===a.value||(a.value=o),a.defaultValue=o}m=m??T,m=typeof m!="function"&&typeof m!="symbol"&&!!m,a.checked=Y?a.checked:!!m,a.defaultChecked=!!m,F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"&&(a.name=F)}function a_(a,o,u){o==="number"&&Ep(a.ownerDocument)===a||a.defaultValue===""+u||(a.defaultValue=""+u)}function jl(a,o,u,m){if(a=a.options,o){o={};for(var T=0;T<u.length;T++)o["$"+u[T]]=!0;for(u=0;u<a.length;u++)T=o.hasOwnProperty("$"+a[u].value),a[u].selected!==T&&(a[u].selected=T),T&&m&&(a[u].defaultSelected=!0)}else{for(u=""+da(u),o=null,T=0;T<a.length;T++){if(a[T].value===u){a[T].selected=!0,m&&(a[T].defaultSelected=!0);return}o!==null||a[T].disabled||(o=a[T])}o!==null&&(o.selected=!0)}}function J0(a,o,u){if(o!=null&&(o=""+da(o),o!==a.value&&(a.value=o),u==null)){a.defaultValue!==o&&(a.defaultValue=o);return}a.defaultValue=u!=null?""+da(u):""}function Z0(a,o,u,m){if(o==null){if(m!=null){if(u!=null)throw Error(v(92));if(ui(m)){if(1<m.length)throw Error(v(93));m=m[0]}u=m}u==null&&(u=""),o=u}u=da(o),a.defaultValue=u,m=a.textContent,m===u&&m!==""&&m!==null&&(a.value=m)}function Oo(a,o){if(o){var u=a.firstChild;if(u&&u===a.lastChild&&u.nodeType===3){u.nodeValue=o;return}}a.textContent=o}var Q0=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function gp(a,o,u){var m=o.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?m?a.setProperty(o,""):o==="float"?a.cssFloat="":a[o]="":m?a.setProperty(o,u):typeof u!="number"||u===0||Q0.has(o)?o==="float"?a.cssFloat=u:a[o]=(""+u).trim():a[o]=u+"px"}function $0(a,o,u){if(o!=null&&typeof o!="object")throw Error(v(62));if(a=a.style,u!=null){for(var m in u)!u.hasOwnProperty(m)||o!=null&&o.hasOwnProperty(m)||(m.indexOf("--")===0?a.setProperty(m,""):m==="float"?a.cssFloat="":a[m]="");for(var T in o)m=o[T],o.hasOwnProperty(T)&&u[T]!==m&&gp(a,T,m)}else for(var b in o)o.hasOwnProperty(b)&&gp(a,b,o[b])}function pu(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var lC=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),eS=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Sp(a){return eS.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var s_=null;function o_(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Bl=null,Fl=null;function tS(a){var o=Ul(a);if(o&&(a=o.stateNode)){var u=a[Lr]||null;e:switch(a=o.stateNode,o.type){case"input":if(r_(a,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),o=u.name,u.type==="radio"&&o!=null){for(u=a;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+qr(""+o)+'"][type="radio"]'),o=0;o<u.length;o++){var m=u[o];if(m!==a&&m.form===a.form){var T=m[Lr]||null;if(!T)throw Error(v(90));r_(m,T.value,T.defaultValue,T.defaultValue,T.checked,T.defaultChecked,T.type,T.name)}}for(o=0;o<u.length;o++)m=u[o],m.form===a.form&&xi(m)}break e;case"textarea":J0(a,u.value,u.defaultValue);break e;case"select":o=u.value,o!=null&&jl(a,!!u.multiple,o,!1)}}}var c_=!1;function iS(a,o,u){if(c_)return a(o,u);c_=!0;try{var m=a(o);return m}finally{if(c_=!1,(Bl!==null||Fl!==null)&&(nl(),Bl&&(o=Bl,a=Fl,Fl=Bl=null,tS(o),a)))for(o=0;o<a.length;o++)tS(a[o])}}function Gl(a,o){var u=a.stateNode;if(u===null)return null;var m=u[Lr]||null;if(m===null)return null;u=m[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(a=a.type,m=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!m;break e;default:a=!1}if(a)return null;if(u&&typeof u!="function")throw Error(v(231,o,typeof u));return u}var Gs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l_=!1;if(Gs)try{var fu={};Object.defineProperty(fu,"passive",{get:function(){l_=!0}}),window.addEventListener("test",fu,fu),window.removeEventListener("test",fu,fu)}catch{l_=!1}var ua=null,d_=null,vp=null;function nS(){if(vp)return vp;var a,o=d_,u=o.length,m,T="value"in ua?ua.value:ua.textContent,b=T.length;for(a=0;a<u&&o[a]===T[a];a++);var F=u-a;for(m=1;m<=F&&o[u-m]===T[b-m];m++);return vp=T.slice(a,1<m?1-m:void 0)}function Tp(a){var o=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&o===13&&(a=13)):a=o,a===10&&(a=13),32<=a||a===13?a:0}function mu(){return!0}function rS(){return!1}function Pr(a){function o(u,m,T,b,F){this._reactName=u,this._targetInst=T,this.type=m,this.nativeEvent=b,this.target=F,this.currentTarget=null;for(var Y in a)a.hasOwnProperty(Y)&&(u=a[Y],this[Y]=u?u(b):b[Y]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?mu:rS,this.isPropagationStopped=rS,this}return q(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=mu)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=mu)},persist:function(){},isPersistent:mu}),o}var Nc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xa=Pr(Nc),dr=q({},Nc,{view:0,detail:0}),aS=Pr(dr),u_,h_,_u,Wn=q({},dr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:__,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==_u&&(_u&&a.type==="mousemove"?(u_=a.screenX-_u.screenX,h_=a.screenY-_u.screenY):h_=u_=0,_u=a),u_)},movementY:function(a){return"movementY"in a?a.movementY:h_}}),sS=Pr(Wn),dC=q({},Wn,{dataTransfer:0}),uC=Pr(dC),yp=q({},dr,{relatedTarget:0}),Rp=Pr(yp),hC=q({},Nc,{animationName:0,elapsedTime:0,pseudoElement:0}),p_=Pr(hC),pC=q({},Nc,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),f_=Pr(pC),m_=q({},Nc,{data:0}),Cp=Pr(m_),fC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},mC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Dc={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Eu(a){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(a):(a=Dc[a])?!!o[a]:!1}function __(){return Eu}var _C=q({},dr,{key:function(a){if(a.key){var o=fC[a.key]||a.key;if(o!=="Unidentified")return o}return a.type==="keypress"?(a=Tp(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?mC[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:__,charCode:function(a){return a.type==="keypress"?Tp(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Tp(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),EC=Pr(_C),gC=q({},Wn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),oS=Pr(gC),Hl=q({},dr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:__}),SC=Pr(Hl),Wl=q({},Nc,{propertyName:0,elapsedTime:0,pseudoElement:0}),cS=Pr(Wl),vC=q({},Wn,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),Ft=Pr(vC),TC=q({},Nc,{newState:0,oldState:0}),yC=Pr(TC),RC=[9,13,27,32],E_=Gs&&"CompositionEvent"in window,Lc=null;Gs&&"documentMode"in document&&(Lc=document.documentMode);var CC=Gs&&"TextEvent"in window&&!Lc,lS=Gs&&(!E_||Lc&&8<Lc&&11>=Lc),dS=" ",bp=!1;function uS(a,o){switch(a){case"keyup":return RC.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hS(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Pc=!1;function bC(a,o){switch(a){case"compositionend":return hS(o);case"keypress":return o.which!==32?null:(bp=!0,dS);case"textInput":return a=o.data,a===dS&&bp?null:a;default:return null}}function No(a,o){if(Pc)return a==="compositionend"||!E_&&uS(a,o)?(a=nS(),vp=d_=ua=null,Pc=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return lS&&o.locale!=="ko"?null:o.data;default:return null}}var AC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pS(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o==="input"?!!AC[a.type]:o==="textarea"}function fS(a,o,u,m){Bl?Fl?Fl.push(m):Fl=[m]:Bl=m,o=oh(o,"onChange"),0<o.length&&(u=new xa("onChange","change",null,u,m),a.push({event:u,listeners:o}))}var zl=null,xc=null;function wC(a){Rf(a,0)}function Ap(a){var o=hu(a);if(xi(o))return a}function mS(a,o){if(a==="change")return o}var Xr=!1;if(Gs){var g_;if(Gs){var S_="oninput"in document;if(!S_){var _S=document.createElement("div");_S.setAttribute("oninput","return;"),S_=typeof _S.oninput=="function"}g_=S_}else g_=!1;Xr=g_&&(!document.documentMode||9<document.documentMode)}function ES(){zl&&(zl.detachEvent("onpropertychange",v_),xc=zl=null)}function v_(a){if(a.propertyName==="value"&&Ap(xc)){var o=[];fS(o,xc,a,o_(a)),iS(wC,o)}}function IC(a,o,u){a==="focusin"?(ES(),zl=o,xc=u,zl.attachEvent("onpropertychange",v_)):a==="focusout"&&ES()}function OC(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Ap(xc)}function gS(a,o){if(a==="click")return Ap(o)}function T_(a,o){if(a==="input"||a==="change")return Ap(o)}function NC(a,o){return a===o&&(a!==0||1/a===1/o)||a!==a&&o!==o}var Jr=typeof Object.is=="function"?Object.is:NC;function Do(a,o){if(Jr(a,o))return!0;if(typeof a!="object"||a===null||typeof o!="object"||o===null)return!1;var u=Object.keys(a),m=Object.keys(o);if(u.length!==m.length)return!1;for(m=0;m<u.length;m++){var T=u[m];if(!qm.call(o,T)||!Jr(a[T],o[T]))return!1}return!0}function SS(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function vS(a,o){var u=SS(a);a=0;for(var m;u;){if(u.nodeType===3){if(m=a+u.textContent.length,a<=o&&m>=o)return{node:u,offset:o-a};a=m}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=SS(u)}}function TS(a,o){return a&&o?a===o?!0:a&&a.nodeType===3?!1:o&&o.nodeType===3?TS(a,o.parentNode):"contains"in a?a.contains(o):a.compareDocumentPosition?!!(a.compareDocumentPosition(o)&16):!1:!1}function Hs(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var o=Ep(a.document);o instanceof a.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)a=o.contentWindow;else break;o=Ep(a.document)}return o}function y_(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o&&(o==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||o==="textarea"||a.contentEditable==="true")}var DC=Gs&&"documentMode"in document&&11>=document.documentMode,Pn=null,R_=null,gu=null,C_=!1;function yS(a,o,u){var m=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;C_||Pn==null||Pn!==Ep(m)||(m=Pn,"selectionStart"in m&&y_(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),gu&&Do(gu,m)||(gu=m,m=oh(R_,"onSelect"),0<m.length&&(o=new xa("onSelect","select",null,o,u),a.push({event:o,listeners:m}),o.target=Pn)))}function Lo(a,o){var u={};return u[a.toLowerCase()]=o.toLowerCase(),u["Webkit"+a]="webkit"+o,u["Moz"+a]="moz"+o,u}var Kl={animationend:Lo("Animation","AnimationEnd"),animationiteration:Lo("Animation","AnimationIteration"),animationstart:Lo("Animation","AnimationStart"),transitionrun:Lo("Transition","TransitionRun"),transitionstart:Lo("Transition","TransitionStart"),transitioncancel:Lo("Transition","TransitionCancel"),transitionend:Lo("Transition","TransitionEnd")},b_={},RS={};Gs&&(RS=document.createElement("div").style,"AnimationEvent"in window||(delete Kl.animationend.animation,delete Kl.animationiteration.animation,delete Kl.animationstart.animation),"TransitionEvent"in window||delete Kl.transitionend.transition);function Po(a){if(b_[a])return b_[a];if(!Kl[a])return a;var o=Kl[a],u;for(u in o)if(o.hasOwnProperty(u)&&u in RS)return b_[a]=o[u];return a}var CS=Po("animationend"),bS=Po("animationiteration"),wp=Po("animationstart"),A_=Po("transitionrun"),LC=Po("transitionstart"),Ce=Po("transitioncancel"),AS=Po("transitionend"),wS=new Map,w_="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");w_.push("scrollEnd");function ka(a,o){wS.set(a,o),la(o,[a])}var I_=new WeakMap;function Zr(a,o){if(typeof a=="object"&&a!==null){var u=I_.get(a);return u!==void 0?u:(o={value:a,source:o,stack:Y0(o)},I_.set(a,o),o)}return{value:a,source:o,stack:Y0(o)}}var ha=[],Yl=0,O_=0;function kc(){for(var a=Yl,o=O_=Yl=0;o<a;){var u=ha[o];ha[o++]=null;var m=ha[o];ha[o++]=null;var T=ha[o];ha[o++]=null;var b=ha[o];if(ha[o++]=null,m!==null&&T!==null){var F=m.pending;F===null?T.next=T:(T.next=F.next,F.next=T),m.pending=T}b!==0&&Su(u,T,b)}}function xo(a,o,u,m){ha[Yl++]=a,ha[Yl++]=o,ha[Yl++]=u,ha[Yl++]=m,O_|=m,a.lanes|=m,a=a.alternate,a!==null&&(a.lanes|=m)}function N_(a,o,u,m){return xo(a,o,u,m),Xl(a)}function ql(a,o){return xo(a,null,null,o),Xl(a)}function Su(a,o,u){a.lanes|=u;var m=a.alternate;m!==null&&(m.lanes|=u);for(var T=!1,b=a.return;b!==null;)b.childLanes|=u,m=b.alternate,m!==null&&(m.childLanes|=u),b.tag===22&&(a=b.stateNode,a===null||a._visibility&1||(T=!0)),a=b,b=b.return;return a.tag===3?(b=a.stateNode,T&&o!==null&&(T=31-vr(u),a=b.hiddenUpdates,m=a[T],m===null?a[T]=[o]:m.push(o),o.lane=u|536870912),b):null}function Xl(a){if(50<rh)throw rh=0,wE=null,Error(v(185));for(var o=a.return;o!==null;)a=o,o=a.return;return a.tag===3?a.stateNode:null}var Ws={};function PC(a,o,u,m){this.tag=a,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Qr(a,o,u,m){return new PC(a,o,u,m)}function D_(a){return a=a.prototype,!(!a||!a.isReactComponent)}function zs(a,o){var u=a.alternate;return u===null?(u=Qr(a.tag,o,a.key,a.mode),u.elementType=a.elementType,u.type=a.type,u.stateNode=a.stateNode,u.alternate=a,a.alternate=u):(u.pendingProps=o,u.type=a.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=a.flags&65011712,u.childLanes=a.childLanes,u.lanes=a.lanes,u.child=a.child,u.memoizedProps=a.memoizedProps,u.memoizedState=a.memoizedState,u.updateQueue=a.updateQueue,o=a.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=a.sibling,u.index=a.index,u.ref=a.ref,u.refCleanup=a.refCleanup,u}function Ip(a,o){a.flags&=65011714;var u=a.alternate;return u===null?(a.childLanes=0,a.lanes=o,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=u.childLanes,a.lanes=u.lanes,a.child=u.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=u.memoizedProps,a.memoizedState=u.memoizedState,a.updateQueue=u.updateQueue,a.type=u.type,o=u.dependencies,a.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),a}function Op(a,o,u,m,T,b){var F=0;if(m=a,typeof a=="function")D_(a)&&(F=1);else if(typeof a=="string")F=ng(a,u,_t.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case Et:return a=Qr(31,u,o,T),a.elementType=Et,a.lanes=b,a;case ae:return ko(u.children,T,b,o);case ne:F=8,T|=24;break;case se:return a=Qr(12,u,o,T|2),a.elementType=se,a.lanes=b,a;case Ne:return a=Qr(13,u,o,T),a.elementType=Ne,a.lanes=b,a;case ft:return a=Qr(19,u,o,T),a.elementType=ft,a.lanes=b,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case Q:case fe:F=10;break e;case oe:F=9;break e;case Ue:F=11;break e;case $e:F=14;break e;case De:F=16,m=null;break e}F=29,u=Error(v(130,a===null?"null":typeof a,"")),m=null}return o=Qr(F,u,o,T),o.elementType=a,o.type=m,o.lanes=b,o}function ko(a,o,u,m){return a=Qr(7,a,m,o),a.lanes=u,a}function xr(a,o,u){return a=Qr(6,a,null,o),a.lanes=u,a}function L_(a,o,u){return o=Qr(4,a.children!==null?a.children:[],a.key,o),o.lanes=u,o.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},o}var os=[],Jl=0,Np=null,Dp=0,$r=[],pa=0,Mc=null,Ks=1,Ma="";function Uc(a,o){os[Jl++]=Dp,os[Jl++]=Np,Np=a,Dp=o}function P_(a,o,u){$r[pa++]=Ks,$r[pa++]=Ma,$r[pa++]=Mc,Mc=a;var m=Ks;a=Ma;var T=32-vr(m)-1;m&=~(1<<T),u+=1;var b=32-vr(o)+T;if(30<b){var F=T-T%5;b=(m&(1<<F)-1).toString(32),m>>=F,T-=F,Ks=1<<32-vr(o)+T|u<<T|m,Ma=b+a}else Ks=1<<b|u<<T|m,Ma=a}function Lp(a){a.return!==null&&(Uc(a,1),P_(a,1,0))}function x_(a){for(;a===Np;)Np=os[--Jl],os[Jl]=null,Dp=os[--Jl],os[Jl]=null;for(;a===Mc;)Mc=$r[--pa],$r[pa]=null,Ma=$r[--pa],$r[pa]=null,Ks=$r[--pa],$r[pa]=null}var ur=null,Xi=null,yi=!1,Vc=null,cs=!1,k_=Error(v(519));function jc(a){var o=Error(v(418,""));throw Tu(Zr(o,a)),k_}function M_(a){var o=a.stateNode,u=a.type,m=a.memoizedProps;switch(o[lr]=a,o[Lr]=m,u){case"dialog":Qt("cancel",o),Qt("close",o);break;case"iframe":case"object":case"embed":Qt("load",o);break;case"video":case"audio":for(u=0;u<Cd.length;u++)Qt(Cd[u],o);break;case"source":Qt("error",o);break;case"img":case"image":case"link":Qt("error",o),Qt("load",o);break;case"details":Qt("toggle",o);break;case"input":Qt("invalid",o),X0(o,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0),_p(o);break;case"select":Qt("invalid",o);break;case"textarea":Qt("invalid",o),Z0(o,m.value,m.defaultValue,m.children),_p(o)}u=m.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||o.textContent===""+u||m.suppressHydrationWarning===!0||wf(o.textContent,u)?(m.popover!=null&&(Qt("beforetoggle",o),Qt("toggle",o)),m.onScroll!=null&&Qt("scroll",o),m.onScrollEnd!=null&&Qt("scrollend",o),m.onClick!=null&&(o.onclick=ch),o=!0):o=!1,o||jc(a)}function Pp(a){for(ur=a.return;ur;)switch(ur.tag){case 5:case 13:cs=!1;return;case 27:case 3:cs=!0;return;default:ur=ur.return}}function vu(a){if(a!==ur)return!1;if(!yi)return Pp(a),yi=!0,!1;var o=a.tag,u;if((u=o!==3&&o!==27)&&((u=o===5)&&(u=a.type,u=!(u!=="form"&&u!=="button")||JE(a.type,a.memoizedProps)),u=!u),u&&Xi&&jc(a),Pp(a),o===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(v(317));e:{for(a=a.nextSibling,o=0;a;){if(a.nodeType===8)if(u=a.data,u==="/$"){if(o===0){Xi=za(a.nextSibling);break e}o--}else u!=="$"&&u!=="$!"&&u!=="$?"||o++;a=a.nextSibling}Xi=null}}else o===27?(o=Xi,$o(a.type)?(a=$E,$E=null,Xi=a):Xi=o):Xi=ur?za(a.stateNode.nextSibling):null;return!0}function Bc(){Xi=ur=null,yi=!1}function IS(){var a=Vc;return a!==null&&(Un===null?Un=a:Un.push.apply(Un,a),Vc=null),a}function Tu(a){Vc===null?Vc=[a]:Vc.push(a)}var U_=Ge(null),Fc=null,Ys=null;function Mo(a,o,u){it(U_,o._currentValue),o._currentValue=u}function qs(a){a._currentValue=U_.current,tt(U_)}function V_(a,o,u){for(;a!==null;){var m=a.alternate;if((a.childLanes&o)!==o?(a.childLanes|=o,m!==null&&(m.childLanes|=o)):m!==null&&(m.childLanes&o)!==o&&(m.childLanes|=o),a===u)break;a=a.return}}function j_(a,o,u,m){var T=a.child;for(T!==null&&(T.return=a);T!==null;){var b=T.dependencies;if(b!==null){var F=T.child;b=b.firstContext;e:for(;b!==null;){var Y=b;b=T;for(var re=0;re<o.length;re++)if(Y.context===o[re]){b.lanes|=u,Y=b.alternate,Y!==null&&(Y.lanes|=u),V_(b.return,u,a),m||(F=null);break e}b=Y.next}}else if(T.tag===18){if(F=T.return,F===null)throw Error(v(341));F.lanes|=u,b=F.alternate,b!==null&&(b.lanes|=u),V_(F,u,a),F=null}else F=T.child;if(F!==null)F.return=T;else for(F=T;F!==null;){if(F===a){F=null;break}if(T=F.sibling,T!==null){T.return=F.return,F=T;break}F=F.return}T=F}}function yu(a,o,u,m){a=null;for(var T=o,b=!1;T!==null;){if(!b){if((T.flags&524288)!==0)b=!0;else if((T.flags&262144)!==0)break}if(T.tag===10){var F=T.alternate;if(F===null)throw Error(v(387));if(F=F.memoizedProps,F!==null){var Y=T.type;Jr(T.pendingProps.value,F.value)||(a!==null?a.push(Y):a=[Y])}}else if(T===Sr.current){if(F=T.alternate,F===null)throw Error(v(387));F.memoizedState.memoizedState!==T.memoizedState.memoizedState&&(a!==null?a.push(fh):a=[fh])}T=T.return}a!==null&&j_(o,a,u,m),o.flags|=262144}function xp(a){for(a=a.firstContext;a!==null;){if(!Jr(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function ls(a){Fc=a,Ys=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function xn(a){return OS(Fc,a)}function Zl(a,o){return Fc===null&&ls(a),OS(a,o)}function OS(a,o){var u=o._currentValue;if(o={context:o,memoizedValue:u,next:null},Ys===null){if(a===null)throw Error(v(308));Ys=o,a.dependencies={lanes:0,firstContext:o},a.flags|=524288}else Ys=Ys.next=o;return u}var xC=typeof AbortController<"u"?AbortController:function(){var a=[],o=this.signal={aborted:!1,addEventListener:function(u,m){a.push(m)}};this.abort=function(){o.aborted=!0,a.forEach(function(u){return u()})}},kC=p.unstable_scheduleCallback,NS=p.unstable_NormalPriority,Cn={$$typeof:fe,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ru(){return{controller:new xC,data:new Map,refCount:0}}function Cu(a){a.refCount--,a.refCount===0&&kC(NS,function(){a.controller.abort()})}var bu=null,Gc=0,Ql=0,$l=null;function MC(a,o){if(bu===null){var u=bu=[];Gc=0,Ql=Rd(),$l={status:"pending",value:void 0,then:function(m){u.push(m)}}}return Gc++,o.then(DS,DS),o}function DS(){if(--Gc===0&&bu!==null){$l!==null&&($l.status="fulfilled");var a=bu;bu=null,Ql=0,$l=null;for(var o=0;o<a.length;o++)(0,a[o])()}}function UC(a,o){var u=[],m={status:"pending",value:null,reason:null,then:function(T){u.push(T)}};return a.then(function(){m.status="fulfilled",m.value=o;for(var T=0;T<u.length;T++)(0,u[T])(o)},function(T){for(m.status="rejected",m.reason=T,T=0;T<u.length;T++)(0,u[T])(void 0)}),m}var LS=Le.S;Le.S=function(a,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&MC(a,o),LS!==null&&LS(a,o)};var Uo=Ge(null);function B_(){var a=Uo.current;return a!==null?a:Wi.pooledCache}function kp(a,o){o===null?it(Uo,Uo.current):it(Uo,o.pool)}function PS(){var a=B_();return a===null?null:{parent:Cn._currentValue,pool:a}}var Hc=Error(v(460)),xS=Error(v(474)),Mp=Error(v(542)),ed={then:function(){}};function kS(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Up(){}function MS(a,o,u){switch(u=a[u],u===void 0?a.push(o):u!==o&&(o.then(Up,Up),o=u),o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,VS(a),a;default:if(typeof o.status=="string")o.then(Up,Up);else{if(a=Wi,a!==null&&100<a.shellSuspendCounter)throw Error(v(482));a=o,a.status="pending",a.then(function(m){if(o.status==="pending"){var T=o;T.status="fulfilled",T.value=m}},function(m){if(o.status==="pending"){var T=o;T.status="rejected",T.reason=m}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,VS(a),a}throw Au=o,Hc}}var Au=null;function US(){if(Au===null)throw Error(v(459));var a=Au;return Au=null,a}function VS(a){if(a===Hc||a===Mp)throw Error(v(483))}var Ua=!1;function Vp(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function F_(a,o){a=a.updateQueue,o.updateQueue===a&&(o.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Vo(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Xs(a,o,u){var m=a.updateQueue;if(m===null)return null;if(m=m.shared,(Ri&2)!==0){var T=m.pending;return T===null?o.next=o:(o.next=T.next,T.next=o),m.pending=o,o=Xl(a),Su(a,null,u),o}return xo(a,m,o,u),Xl(a)}function wu(a,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194048)!==0)){var m=o.lanes;m&=a.pendingLanes,u|=m,o.lanes=u,B0(a,u)}}function G_(a,o){var u=a.updateQueue,m=a.alternate;if(m!==null&&(m=m.updateQueue,u===m)){var T=null,b=null;if(u=u.firstBaseUpdate,u!==null){do{var F={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};b===null?T=b=F:b=b.next=F,u=u.next}while(u!==null);b===null?T=b=o:b=b.next=o}else T=b=o;u={baseState:m.baseState,firstBaseUpdate:T,lastBaseUpdate:b,shared:m.shared,callbacks:m.callbacks},a.updateQueue=u;return}a=u.lastBaseUpdate,a===null?u.firstBaseUpdate=o:a.next=o,u.lastBaseUpdate=o}var H_=!1;function Wc(){if(H_){var a=$l;if(a!==null)throw a}}function zc(a,o,u,m){H_=!1;var T=a.updateQueue;Ua=!1;var b=T.firstBaseUpdate,F=T.lastBaseUpdate,Y=T.shared.pending;if(Y!==null){T.shared.pending=null;var re=Y,Se=re.next;re.next=null,F===null?b=Se:F.next=Se,F=re;var Pe=a.alternate;Pe!==null&&(Pe=Pe.updateQueue,Y=Pe.lastBaseUpdate,Y!==F&&(Y===null?Pe.firstBaseUpdate=Se:Y.next=Se,Pe.lastBaseUpdate=re))}if(b!==null){var Be=T.baseState;F=0,Pe=Se=re=null,Y=b;do{var be=Y.lane&-536870913,we=be!==Y.lane;if(we?(hi&be)===be:(m&be)===be){be!==0&&be===Ql&&(H_=!0),Pe!==null&&(Pe=Pe.next={lane:0,tag:Y.tag,payload:Y.payload,callback:null,next:null});e:{var xt=a,bt=Y;be=o;var Mi=u;switch(bt.tag){case 1:if(xt=bt.payload,typeof xt=="function"){Be=xt.call(Mi,Be,be);break e}Be=xt;break e;case 3:xt.flags=xt.flags&-65537|128;case 0:if(xt=bt.payload,be=typeof xt=="function"?xt.call(Mi,Be,be):xt,be==null)break e;Be=q({},Be,be);break e;case 2:Ua=!0}}be=Y.callback,be!==null&&(a.flags|=64,we&&(a.flags|=8192),we=T.callbacks,we===null?T.callbacks=[be]:we.push(be))}else we={lane:be,tag:Y.tag,payload:Y.payload,callback:Y.callback,next:null},Pe===null?(Se=Pe=we,re=Be):Pe=Pe.next=we,F|=be;if(Y=Y.next,Y===null){if(Y=T.shared.pending,Y===null)break;we=Y,Y=we.next,we.next=null,T.lastBaseUpdate=we,T.shared.pending=null}}while(!0);Pe===null&&(re=Be),T.baseState=re,T.firstBaseUpdate=Se,T.lastBaseUpdate=Pe,b===null&&(T.shared.lanes=0),Ga|=F,a.lanes=F,a.memoizedState=Be}}function W_(a,o){if(typeof a!="function")throw Error(v(191,a));a.call(o)}function jp(a,o){var u=a.callbacks;if(u!==null)for(a.callbacks=null,a=0;a<u.length;a++)W_(u[a],o)}var Kc=Ge(null),Iu=Ge(0);function Ou(a,o){a=_s,it(Iu,a),it(Kc,o),_s=a|o.baseLanes}function Yc(){it(Iu,_s),it(Kc,Kc.current)}function z_(){_s=Iu.current,tt(Kc),tt(Iu)}var jo=0,qt=null,ki=null,bn=null,Nu=!1,td=!1,qc=!1,Bp=0,Du=0,id=null,VC=0;function dn(){throw Error(v(321))}function Bo(a,o){if(o===null)return!1;for(var u=0;u<o.length&&u<a.length;u++)if(!Jr(a[u],o[u]))return!1;return!0}function K_(a,o,u,m,T,b){return jo=b,qt=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Le.H=a===null||a.memoizedState===null?Xc:Go,qc=!1,b=u(m,T),qc=!1,td&&(b=BS(o,u,m,T)),jS(a),b}function jS(a){Le.H=ea;var o=ki!==null&&ki.next!==null;if(jo=0,bn=ki=qt=null,Nu=!1,Du=0,id=null,o)throw Error(v(300));a===null||zn||(a=a.dependencies,a!==null&&xp(a)&&(zn=!0))}function BS(a,o,u,m){qt=a;var T=0;do{if(td&&(id=null),Du=0,td=!1,25<=T)throw Error(v(301));if(T+=1,bn=ki=null,a.updateQueue!=null){var b=a.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}Le.H=av,b=o(u,m)}while(td);return b}function FS(){var a=Le.H,o=a.useState()[0];return o=typeof o.then=="function"?Lu(o):o,a=a.useState()[0],(ki!==null?ki.memoizedState:null)!==a&&(qt.flags|=1024),o}function Y_(){var a=Bp!==0;return Bp=0,a}function Fp(a,o,u){o.updateQueue=a.updateQueue,o.flags&=-2053,a.lanes&=~u}function q_(a){if(Nu){for(a=a.memoizedState;a!==null;){var o=a.queue;o!==null&&(o.pending=null),a=a.next}Nu=!1}jo=0,bn=ki=qt=null,td=!1,Du=Bp=0,id=null}function kr(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bn===null?qt.memoizedState=bn=a:bn=bn.next=a,bn}function An(){if(ki===null){var a=qt.alternate;a=a!==null?a.memoizedState:null}else a=ki.next;var o=bn===null?qt.memoizedState:bn.next;if(o!==null)bn=o,ki=a;else{if(a===null)throw qt.alternate===null?Error(v(467)):Error(v(310));ki=a,a={memoizedState:ki.memoizedState,baseState:ki.baseState,baseQueue:ki.baseQueue,queue:ki.queue,next:null},bn===null?qt.memoizedState=bn=a:bn=bn.next=a}return bn}function nd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Lu(a){var o=Du;return Du+=1,id===null&&(id=[]),a=MS(id,a,o),o=qt,(bn===null?o.memoizedState:bn.next)===null&&(o=o.alternate,Le.H=o===null||o.memoizedState===null?Xc:Go),a}function Gp(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Lu(a);if(a.$$typeof===fe)return xn(a)}throw Error(v(438,String(a)))}function X_(a){var o=null,u=qt.updateQueue;if(u!==null&&(o=u.memoCache),o==null){var m=qt.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(o={data:m.data.map(function(T){return T.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),u===null&&(u=nd(),qt.updateQueue=u),u.memoCache=o,u=o.data[o.index],u===void 0)for(u=o.data[o.index]=Array(a),m=0;m<a;m++)u[m]=qe;return o.index++,u}function Js(a,o){return typeof o=="function"?o(a):o}function Hp(a){var o=An();return J_(o,ki,a)}function J_(a,o,u){var m=a.queue;if(m===null)throw Error(v(311));m.lastRenderedReducer=u;var T=a.baseQueue,b=m.pending;if(b!==null){if(T!==null){var F=T.next;T.next=b.next,b.next=F}o.baseQueue=T=b,m.pending=null}if(b=a.baseState,T===null)a.memoizedState=b;else{o=T.next;var Y=F=null,re=null,Se=o,Pe=!1;do{var Be=Se.lane&-536870913;if(Be!==Se.lane?(hi&Be)===Be:(jo&Be)===Be){var be=Se.revertLane;if(be===0)re!==null&&(re=re.next={lane:0,revertLane:0,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null}),Be===Ql&&(Pe=!0);else if((jo&be)===be){Se=Se.next,be===Ql&&(Pe=!0);continue}else Be={lane:0,revertLane:Se.revertLane,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null},re===null?(Y=re=Be,F=b):re=re.next=Be,qt.lanes|=be,Ga|=be;Be=Se.action,qc&&u(b,Be),b=Se.hasEagerState?Se.eagerState:u(b,Be)}else be={lane:Be,revertLane:Se.revertLane,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null},re===null?(Y=re=be,F=b):re=re.next=be,qt.lanes|=Be,Ga|=Be;Se=Se.next}while(Se!==null&&Se!==o);if(re===null?F=b:re.next=Y,!Jr(b,a.memoizedState)&&(zn=!0,Pe&&(u=$l,u!==null)))throw u;a.memoizedState=b,a.baseState=F,a.baseQueue=re,m.lastRenderedState=b}return T===null&&(m.lanes=0),[a.memoizedState,m.dispatch]}function Pu(a){var o=An(),u=o.queue;if(u===null)throw Error(v(311));u.lastRenderedReducer=a;var m=u.dispatch,T=u.pending,b=o.memoizedState;if(T!==null){u.pending=null;var F=T=T.next;do b=a(b,F.action),F=F.next;while(F!==T);Jr(b,o.memoizedState)||(zn=!0),o.memoizedState=b,o.baseQueue===null&&(o.baseState=b),u.lastRenderedState=b}return[b,m]}function GS(a,o,u){var m=qt,T=An(),b=yi;if(b){if(u===void 0)throw Error(v(407));u=u()}else u=o();var F=!Jr((ki||T).memoizedState,u);F&&(T.memoizedState=u,zn=!0),T=T.queue;var Y=Q_.bind(null,m,T,a);if(sd(2048,8,Y,[a]),T.getSnapshot!==o||F||bn!==null&&bn.memoizedState.tag&1){if(m.flags|=2048,ad(9,Wp(),HS.bind(null,m,T,u,o),null),Wi===null)throw Error(v(349));b||(jo&124)!==0||Z_(m,o,u)}return u}function Z_(a,o,u){a.flags|=16384,a={getSnapshot:o,value:u},o=qt.updateQueue,o===null?(o=nd(),qt.updateQueue=o,o.stores=[a]):(u=o.stores,u===null?o.stores=[a]:u.push(a))}function HS(a,o,u,m){o.value=u,o.getSnapshot=m,WS(o)&&zS(a)}function Q_(a,o,u){return u(function(){WS(o)&&zS(a)})}function WS(a){var o=a.getSnapshot;a=a.value;try{var u=o();return!Jr(a,u)}catch{return!0}}function zS(a){var o=ql(a,2);o!==null&&Vr(o,a,2)}function $_(a){var o=kr();if(typeof a=="function"){var u=a;if(a=u(),qc){js(!0);try{u()}finally{js(!1)}}}return o.memoizedState=o.baseState=a,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Js,lastRenderedState:a},o}function KS(a,o,u,m){return a.baseState=u,J_(a,ki,typeof m=="function"?m:Js)}function jC(a,o,u,m,T){if(Bu(a))throw Error(v(485));if(a=o.action,a!==null){var b={payload:T,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(F){b.listeners.push(F)}};Le.T!==null?u(!0):b.isTransition=!1,m(b),u=o.pending,u===null?(b.next=o.pending=b,YS(o,b)):(b.next=u.next,o.pending=u.next=b)}}function YS(a,o){var u=o.action,m=o.payload,T=a.state;if(o.isTransition){var b=Le.T,F={};Le.T=F;try{var Y=u(T,m),re=Le.S;re!==null&&re(F,Y),eE(a,o,Y)}catch(Se){tE(a,o,Se)}finally{Le.T=b}}else try{b=u(T,m),eE(a,o,b)}catch(Se){tE(a,o,Se)}}function eE(a,o,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(m){qS(a,o,m)},function(m){return tE(a,o,m)}):qS(a,o,u)}function qS(a,o,u){o.status="fulfilled",o.value=u,iE(o),a.state=u,o=a.pending,o!==null&&(u=o.next,u===o?a.pending=null:(u=u.next,o.next=u,YS(a,u)))}function tE(a,o,u){var m=a.pending;if(a.pending=null,m!==null){m=m.next;do o.status="rejected",o.reason=u,iE(o),o=o.next;while(o!==m)}a.action=null}function iE(a){a=a.listeners;for(var o=0;o<a.length;o++)(0,a[o])()}function XS(a,o){return o}function xu(a,o){if(yi){var u=Wi.formState;if(u!==null){e:{var m=qt;if(yi){if(Xi){t:{for(var T=Xi,b=cs;T.nodeType!==8;){if(!b){T=null;break t}if(T=za(T.nextSibling),T===null){T=null;break t}}b=T.data,T=b==="F!"||b==="F"?T:null}if(T){Xi=za(T.nextSibling),m=T.data==="F!";break e}}jc(m)}m=!1}m&&(o=u[0])}}return u=kr(),u.memoizedState=u.baseState=o,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:XS,lastRenderedState:o},u.queue=m,u=Xp.bind(null,qt,m),m.dispatch=u,m=$_(!1),b=lE.bind(null,qt,!1,m.queue),m=kr(),T={state:o,dispatch:null,action:a,pending:null},m.queue=T,u=jC.bind(null,qt,T,b,u),T.dispatch=u,m.memoizedState=a,[o,u,!1]}function nE(a){var o=An();return rd(o,ki,a)}function rd(a,o,u){if(o=J_(a,o,XS)[0],a=Hp(Js)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var m=Lu(o)}catch(F){throw F===Hc?Mp:F}else m=o;o=An();var T=o.queue,b=T.dispatch;return u!==o.memoizedState&&(qt.flags|=2048,ad(9,Wp(),BC.bind(null,T,u),null)),[m,b,a]}function BC(a,o){a.action=o}function JS(a){var o=An(),u=ki;if(u!==null)return rd(o,u,a);An(),o=o.memoizedState,u=An();var m=u.queue.dispatch;return u.memoizedState=a,[o,m,!1]}function ad(a,o,u,m){return a={tag:a,create:u,deps:m,inst:o,next:null},o=qt.updateQueue,o===null&&(o=nd(),qt.updateQueue=o),u=o.lastEffect,u===null?o.lastEffect=a.next=a:(m=u.next,u.next=a,a.next=m,o.lastEffect=a),a}function Wp(){return{destroy:void 0,resource:void 0}}function ku(){return An().memoizedState}function zp(a,o,u,m){var T=kr();m=m===void 0?null:m,qt.flags|=a,T.memoizedState=ad(1|o,Wp(),u,m)}function sd(a,o,u,m){var T=An();m=m===void 0?null:m;var b=T.memoizedState.inst;ki!==null&&m!==null&&Bo(m,ki.memoizedState.deps)?T.memoizedState=ad(o,b,u,m):(qt.flags|=a,T.memoizedState=ad(1|o,b,u,m))}function Kp(a,o){zp(8390656,8,a,o)}function Yp(a,o){sd(2048,8,a,o)}function ZS(a,o){return sd(4,2,a,o)}function QS(a,o){return sd(4,4,a,o)}function $S(a,o){if(typeof o=="function"){a=a();var u=o(a);return function(){typeof u=="function"?u():o(null)}}if(o!=null)return a=a(),o.current=a,function(){o.current=null}}function ev(a,o,u){u=u!=null?u.concat([a]):null,sd(4,4,$S.bind(null,o,a),u)}function rE(){}function Mu(a,o){var u=An();o=o===void 0?null:o;var m=u.memoizedState;return o!==null&&Bo(o,m[1])?m[0]:(u.memoizedState=[a,o],a)}function tv(a,o){var u=An();o=o===void 0?null:o;var m=u.memoizedState;if(o!==null&&Bo(o,m[1]))return m[0];if(m=a(),qc){js(!0);try{a()}finally{js(!1)}}return u.memoizedState=[m,o],m}function Fo(a,o,u){return u===void 0||(jo&1073741824)!==0?a.memoizedState=o:(a.memoizedState=u,a=ff(),qt.lanes|=a,Ga|=a,u)}function qp(a,o,u,m){return Jr(u,o)?u:Kc.current!==null?(a=Fo(a,u,m),Jr(a,o)||(zn=!0),a):(jo&42)===0?(zn=!0,a.memoizedState=u):(a=ff(),qt.lanes|=a,Ga|=a,o)}function Uu(a,o,u,m,T){var b=ze.p;ze.p=b!==0&&8>b?b:8;var F=Le.T,Y={};Le.T=Y,lE(a,!1,o,u);try{var re=T(),Se=Le.S;if(Se!==null&&Se(Y,re),re!==null&&typeof re=="object"&&typeof re.then=="function"){var Pe=UC(re,m);ju(a,o,Pe,ia(a))}else ju(a,o,m,ia(a))}catch(Be){ju(a,o,{then:function(){},status:"rejected",reason:Be},ia())}finally{ze.p=b,Le.T=F}}function Vu(){}function od(a,o,u,m){if(a.tag!==5)throw Error(v(476));var T=iv(a).queue;Uu(a,T,o,We,u===null?Vu:function(){return aE(a),u(m)})}function iv(a){var o=a.memoizedState;if(o!==null)return o;o={memoizedState:We,baseState:We,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Js,lastRenderedState:We},next:null};var u={};return o.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Js,lastRenderedState:u},next:null},a.memoizedState=o,a=a.alternate,a!==null&&(a.memoizedState=o),o}function aE(a){var o=iv(a).next.queue;ju(a,o,{},ia())}function sE(){return xn(fh)}function oE(){return An().memoizedState}function nv(){return An().memoizedState}function FC(a){for(var o=a.return;o!==null;){switch(o.tag){case 24:case 3:var u=ia();a=Vo(u);var m=Xs(o,a,u);m!==null&&(Vr(m,o,u),wu(m,o,u)),o={cache:Ru()},a.payload=o;return}o=o.return}}function cE(a,o,u){var m=ia();u={lane:m,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},Bu(a)?Jp(o,u):(u=N_(a,o,u,m),u!==null&&(Vr(u,a,m),rv(u,o,m)))}function Xp(a,o,u){var m=ia();ju(a,o,u,m)}function ju(a,o,u,m){var T={lane:m,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(Bu(a))Jp(o,T);else{var b=a.alternate;if(a.lanes===0&&(b===null||b.lanes===0)&&(b=o.lastRenderedReducer,b!==null))try{var F=o.lastRenderedState,Y=b(F,u);if(T.hasEagerState=!0,T.eagerState=Y,Jr(Y,F))return xo(a,o,T,0),Wi===null&&kc(),!1}catch{}finally{}if(u=N_(a,o,T,m),u!==null)return Vr(u,a,m),rv(u,o,m),!0}return!1}function lE(a,o,u,m){if(m={lane:2,revertLane:Rd(),action:m,hasEagerState:!1,eagerState:null,next:null},Bu(a)){if(o)throw Error(v(479))}else o=N_(a,u,m,2),o!==null&&Vr(o,a,2)}function Bu(a){var o=a.alternate;return a===qt||o!==null&&o===qt}function Jp(a,o){td=Nu=!0;var u=a.pending;u===null?o.next=o:(o.next=u.next,u.next=o),a.pending=o}function rv(a,o,u){if((u&4194048)!==0){var m=o.lanes;m&=a.pendingLanes,u|=m,o.lanes=u,B0(a,u)}}var ea={readContext:xn,use:Gp,useCallback:dn,useContext:dn,useEffect:dn,useImperativeHandle:dn,useLayoutEffect:dn,useInsertionEffect:dn,useMemo:dn,useReducer:dn,useRef:dn,useState:dn,useDebugValue:dn,useDeferredValue:dn,useTransition:dn,useSyncExternalStore:dn,useId:dn,useHostTransitionStatus:dn,useFormState:dn,useActionState:dn,useOptimistic:dn,useMemoCache:dn,useCacheRefresh:dn},Xc={readContext:xn,use:Gp,useCallback:function(a,o){return kr().memoizedState=[a,o===void 0?null:o],a},useContext:xn,useEffect:Kp,useImperativeHandle:function(a,o,u){u=u!=null?u.concat([a]):null,zp(4194308,4,$S.bind(null,o,a),u)},useLayoutEffect:function(a,o){return zp(4194308,4,a,o)},useInsertionEffect:function(a,o){zp(4,2,a,o)},useMemo:function(a,o){var u=kr();o=o===void 0?null:o;var m=a();if(qc){js(!0);try{a()}finally{js(!1)}}return u.memoizedState=[m,o],m},useReducer:function(a,o,u){var m=kr();if(u!==void 0){var T=u(o);if(qc){js(!0);try{u(o)}finally{js(!1)}}}else T=o;return m.memoizedState=m.baseState=T,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:T},m.queue=a,a=a.dispatch=cE.bind(null,qt,a),[m.memoizedState,a]},useRef:function(a){var o=kr();return a={current:a},o.memoizedState=a},useState:function(a){a=$_(a);var o=a.queue,u=Xp.bind(null,qt,o);return o.dispatch=u,[a.memoizedState,u]},useDebugValue:rE,useDeferredValue:function(a,o){var u=kr();return Fo(u,a,o)},useTransition:function(){var a=$_(!1);return a=Uu.bind(null,qt,a.queue,!0,!1),kr().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,o,u){var m=qt,T=kr();if(yi){if(u===void 0)throw Error(v(407));u=u()}else{if(u=o(),Wi===null)throw Error(v(349));(hi&124)!==0||Z_(m,o,u)}T.memoizedState=u;var b={value:u,getSnapshot:o};return T.queue=b,Kp(Q_.bind(null,m,b,a),[a]),m.flags|=2048,ad(9,Wp(),HS.bind(null,m,b,u,o),null),u},useId:function(){var a=kr(),o=Wi.identifierPrefix;if(yi){var u=Ma,m=Ks;u=(m&~(1<<32-vr(m)-1)).toString(32)+u,o=""+o+"R"+u,u=Bp++,0<u&&(o+="H"+u.toString(32)),o+=""}else u=VC++,o=""+o+"r"+u.toString(32)+"";return a.memoizedState=o},useHostTransitionStatus:sE,useFormState:xu,useActionState:xu,useOptimistic:function(a){var o=kr();o.memoizedState=o.baseState=a;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=u,o=lE.bind(null,qt,!0,u),u.dispatch=o,[a,o]},useMemoCache:X_,useCacheRefresh:function(){return kr().memoizedState=FC.bind(null,qt)}},Go={readContext:xn,use:Gp,useCallback:Mu,useContext:xn,useEffect:Yp,useImperativeHandle:ev,useInsertionEffect:ZS,useLayoutEffect:QS,useMemo:tv,useReducer:Hp,useRef:ku,useState:function(){return Hp(Js)},useDebugValue:rE,useDeferredValue:function(a,o){var u=An();return qp(u,ki.memoizedState,a,o)},useTransition:function(){var a=Hp(Js)[0],o=An().memoizedState;return[typeof a=="boolean"?a:Lu(a),o]},useSyncExternalStore:GS,useId:oE,useHostTransitionStatus:sE,useFormState:nE,useActionState:nE,useOptimistic:function(a,o){var u=An();return KS(u,ki,a,o)},useMemoCache:X_,useCacheRefresh:nv},av={readContext:xn,use:Gp,useCallback:Mu,useContext:xn,useEffect:Yp,useImperativeHandle:ev,useInsertionEffect:ZS,useLayoutEffect:QS,useMemo:tv,useReducer:Pu,useRef:ku,useState:function(){return Pu(Js)},useDebugValue:rE,useDeferredValue:function(a,o){var u=An();return ki===null?Fo(u,a,o):qp(u,ki.memoizedState,a,o)},useTransition:function(){var a=Pu(Js)[0],o=An().memoizedState;return[typeof a=="boolean"?a:Lu(a),o]},useSyncExternalStore:GS,useId:oE,useHostTransitionStatus:sE,useFormState:JS,useActionState:JS,useOptimistic:function(a,o){var u=An();return ki!==null?KS(u,ki,a,o):(u.baseState=a,[a,u.queue.dispatch])},useMemoCache:X_,useCacheRefresh:nv},Jc=null,Va=0;function cd(a){var o=Va;return Va+=1,Jc===null&&(Jc=[]),MS(Jc,a,o)}function Fu(a,o){o=o.props.ref,a.ref=o!==void 0?o:null}function Gu(a,o){throw o.$$typeof===z?Error(v(525)):(a=Object.prototype.toString.call(o),Error(v(31,a==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":a)))}function sv(a){var o=a._init;return o(a._payload)}function dE(a){function o(_e,he){if(a){var ve=_e.deletions;ve===null?(_e.deletions=[he],_e.flags|=16):ve.push(he)}}function u(_e,he){if(!a)return null;for(;he!==null;)o(_e,he),he=he.sibling;return null}function m(_e){for(var he=new Map;_e!==null;)_e.key!==null?he.set(_e.key,_e):he.set(_e.index,_e),_e=_e.sibling;return he}function T(_e,he){return _e=zs(_e,he),_e.index=0,_e.sibling=null,_e}function b(_e,he,ve){return _e.index=ve,a?(ve=_e.alternate,ve!==null?(ve=ve.index,ve<he?(_e.flags|=67108866,he):ve):(_e.flags|=67108866,he)):(_e.flags|=1048576,he)}function F(_e){return a&&_e.alternate===null&&(_e.flags|=67108866),_e}function Y(_e,he,ve,Ve){return he===null||he.tag!==6?(he=xr(ve,_e.mode,Ve),he.return=_e,he):(he=T(he,ve),he.return=_e,he)}function re(_e,he,ve,Ve){var lt=ve.type;return lt===ae?Pe(_e,he,ve.props.children,Ve,ve.key):he!==null&&(he.elementType===lt||typeof lt=="object"&&lt!==null&&lt.$$typeof===De&&sv(lt)===he.type)?(he=T(he,ve.props),Fu(he,ve),he.return=_e,he):(he=Op(ve.type,ve.key,ve.props,null,_e.mode,Ve),Fu(he,ve),he.return=_e,he)}function Se(_e,he,ve,Ve){return he===null||he.tag!==4||he.stateNode.containerInfo!==ve.containerInfo||he.stateNode.implementation!==ve.implementation?(he=L_(ve,_e.mode,Ve),he.return=_e,he):(he=T(he,ve.children||[]),he.return=_e,he)}function Pe(_e,he,ve,Ve,lt){return he===null||he.tag!==7?(he=ko(ve,_e.mode,Ve,lt),he.return=_e,he):(he=T(he,ve),he.return=_e,he)}function Be(_e,he,ve){if(typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint")return he=xr(""+he,_e.mode,ve),he.return=_e,he;if(typeof he=="object"&&he!==null){switch(he.$$typeof){case ce:return ve=Op(he.type,he.key,he.props,null,_e.mode,ve),Fu(ve,he),ve.return=_e,ve;case Z:return he=L_(he,_e.mode,ve),he.return=_e,he;case De:var Ve=he._init;return he=Ve(he._payload),Be(_e,he,ve)}if(ui(he)||Ye(he))return he=ko(he,_e.mode,ve,null),he.return=_e,he;if(typeof he.then=="function")return Be(_e,cd(he),ve);if(he.$$typeof===fe)return Be(_e,Zl(_e,he),ve);Gu(_e,he)}return null}function be(_e,he,ve,Ve){var lt=he!==null?he.key:null;if(typeof ve=="string"&&ve!==""||typeof ve=="number"||typeof ve=="bigint")return lt!==null?null:Y(_e,he,""+ve,Ve);if(typeof ve=="object"&&ve!==null){switch(ve.$$typeof){case ce:return ve.key===lt?re(_e,he,ve,Ve):null;case Z:return ve.key===lt?Se(_e,he,ve,Ve):null;case De:return lt=ve._init,ve=lt(ve._payload),be(_e,he,ve,Ve)}if(ui(ve)||Ye(ve))return lt!==null?null:Pe(_e,he,ve,Ve,null);if(typeof ve.then=="function")return be(_e,he,cd(ve),Ve);if(ve.$$typeof===fe)return be(_e,he,Zl(_e,ve),Ve);Gu(_e,ve)}return null}function we(_e,he,ve,Ve,lt){if(typeof Ve=="string"&&Ve!==""||typeof Ve=="number"||typeof Ve=="bigint")return _e=_e.get(ve)||null,Y(he,_e,""+Ve,lt);if(typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case ce:return _e=_e.get(Ve.key===null?ve:Ve.key)||null,re(he,_e,Ve,lt);case Z:return _e=_e.get(Ve.key===null?ve:Ve.key)||null,Se(he,_e,Ve,lt);case De:var ri=Ve._init;return Ve=ri(Ve._payload),we(_e,he,ve,Ve,lt)}if(ui(Ve)||Ye(Ve))return _e=_e.get(ve)||null,Pe(he,_e,Ve,lt,null);if(typeof Ve.then=="function")return we(_e,he,ve,cd(Ve),lt);if(Ve.$$typeof===fe)return we(_e,he,ve,Zl(he,Ve),lt);Gu(he,Ve)}return null}function xt(_e,he,ve,Ve){for(var lt=null,ri=null,gt=he,Nt=he=0,qn=null;gt!==null&&Nt<ve.length;Nt++){gt.index>Nt?(qn=gt,gt=null):qn=gt.sibling;var mi=be(_e,gt,ve[Nt],Ve);if(mi===null){gt===null&&(gt=qn);break}a&&gt&&mi.alternate===null&&o(_e,gt),he=b(mi,he,Nt),ri===null?lt=mi:ri.sibling=mi,ri=mi,gt=qn}if(Nt===ve.length)return u(_e,gt),yi&&Uc(_e,Nt),lt;if(gt===null){for(;Nt<ve.length;Nt++)gt=Be(_e,ve[Nt],Ve),gt!==null&&(he=b(gt,he,Nt),ri===null?lt=gt:ri.sibling=gt,ri=gt);return yi&&Uc(_e,Nt),lt}for(gt=m(gt);Nt<ve.length;Nt++)qn=we(gt,_e,Nt,ve[Nt],Ve),qn!==null&&(a&&qn.alternate!==null&&gt.delete(qn.key===null?Nt:qn.key),he=b(qn,he,Nt),ri===null?lt=qn:ri.sibling=qn,ri=qn);return a&&gt.forEach(function(eo){return o(_e,eo)}),yi&&Uc(_e,Nt),lt}function bt(_e,he,ve,Ve){if(ve==null)throw Error(v(151));for(var lt=null,ri=null,gt=he,Nt=he=0,qn=null,mi=ve.next();gt!==null&&!mi.done;Nt++,mi=ve.next()){gt.index>Nt?(qn=gt,gt=null):qn=gt.sibling;var eo=be(_e,gt,mi.value,Ve);if(eo===null){gt===null&&(gt=qn);break}a&&gt&&eo.alternate===null&&o(_e,gt),he=b(eo,he,Nt),ri===null?lt=eo:ri.sibling=eo,ri=eo,gt=qn}if(mi.done)return u(_e,gt),yi&&Uc(_e,Nt),lt;if(gt===null){for(;!mi.done;Nt++,mi=ve.next())mi=Be(_e,mi.value,Ve),mi!==null&&(he=b(mi,he,Nt),ri===null?lt=mi:ri.sibling=mi,ri=mi);return yi&&Uc(_e,Nt),lt}for(gt=m(gt);!mi.done;Nt++,mi=ve.next())mi=we(gt,_e,Nt,mi.value,Ve),mi!==null&&(a&&mi.alternate!==null&&gt.delete(mi.key===null?Nt:mi.key),he=b(mi,he,Nt),ri===null?lt=mi:ri.sibling=mi,ri=mi);return a&&gt.forEach(function(Cb){return o(_e,Cb)}),yi&&Uc(_e,Nt),lt}function Mi(_e,he,ve,Ve){if(typeof ve=="object"&&ve!==null&&ve.type===ae&&ve.key===null&&(ve=ve.props.children),typeof ve=="object"&&ve!==null){switch(ve.$$typeof){case ce:e:{for(var lt=ve.key;he!==null;){if(he.key===lt){if(lt=ve.type,lt===ae){if(he.tag===7){u(_e,he.sibling),Ve=T(he,ve.props.children),Ve.return=_e,_e=Ve;break e}}else if(he.elementType===lt||typeof lt=="object"&&lt!==null&&lt.$$typeof===De&&sv(lt)===he.type){u(_e,he.sibling),Ve=T(he,ve.props),Fu(Ve,ve),Ve.return=_e,_e=Ve;break e}u(_e,he);break}else o(_e,he);he=he.sibling}ve.type===ae?(Ve=ko(ve.props.children,_e.mode,Ve,ve.key),Ve.return=_e,_e=Ve):(Ve=Op(ve.type,ve.key,ve.props,null,_e.mode,Ve),Fu(Ve,ve),Ve.return=_e,_e=Ve)}return F(_e);case Z:e:{for(lt=ve.key;he!==null;){if(he.key===lt)if(he.tag===4&&he.stateNode.containerInfo===ve.containerInfo&&he.stateNode.implementation===ve.implementation){u(_e,he.sibling),Ve=T(he,ve.children||[]),Ve.return=_e,_e=Ve;break e}else{u(_e,he);break}else o(_e,he);he=he.sibling}Ve=L_(ve,_e.mode,Ve),Ve.return=_e,_e=Ve}return F(_e);case De:return lt=ve._init,ve=lt(ve._payload),Mi(_e,he,ve,Ve)}if(ui(ve))return xt(_e,he,ve,Ve);if(Ye(ve)){if(lt=Ye(ve),typeof lt!="function")throw Error(v(150));return ve=lt.call(ve),bt(_e,he,ve,Ve)}if(typeof ve.then=="function")return Mi(_e,he,cd(ve),Ve);if(ve.$$typeof===fe)return Mi(_e,he,Zl(_e,ve),Ve);Gu(_e,ve)}return typeof ve=="string"&&ve!==""||typeof ve=="number"||typeof ve=="bigint"?(ve=""+ve,he!==null&&he.tag===6?(u(_e,he.sibling),Ve=T(he,ve),Ve.return=_e,_e=Ve):(u(_e,he),Ve=xr(ve,_e.mode,Ve),Ve.return=_e,_e=Ve),F(_e)):u(_e,he)}return function(_e,he,ve,Ve){try{Va=0;var lt=Mi(_e,he,ve,Ve);return Jc=null,lt}catch(gt){if(gt===Hc||gt===Mp)throw gt;var ri=Qr(29,gt,null,_e.mode);return ri.lanes=Ve,ri.return=_e,ri}finally{}}}var Zc=dE(!0),ov=dE(!1),kn=Ge(null),ds=null;function Ho(a){var o=a.alternate;it(Mn,Mn.current&1),it(kn,a),ds===null&&(o===null||Kc.current!==null||o.memoizedState!==null)&&(ds=a)}function cv(a){if(a.tag===22){if(it(Mn,Mn.current),it(kn,a),ds===null){var o=a.alternate;o!==null&&o.memoizedState!==null&&(ds=a)}}else Wo()}function Wo(){it(Mn,Mn.current),it(kn,kn.current)}function us(a){tt(kn),ds===a&&(ds=null),tt(Mn)}var Mn=Ge(0);function ld(a){for(var o=a;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||Of(u)))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}function Zp(a,o,u,m){o=a.memoizedState,u=u(m,o),u=u==null?o:q({},o,u),a.memoizedState=u,a.lanes===0&&(a.updateQueue.baseState=u)}var uE={enqueueSetState:function(a,o,u){a=a._reactInternals;var m=ia(),T=Vo(m);T.payload=o,u!=null&&(T.callback=u),o=Xs(a,T,m),o!==null&&(Vr(o,a,m),wu(o,a,m))},enqueueReplaceState:function(a,o,u){a=a._reactInternals;var m=ia(),T=Vo(m);T.tag=1,T.payload=o,u!=null&&(T.callback=u),o=Xs(a,T,m),o!==null&&(Vr(o,a,m),wu(o,a,m))},enqueueForceUpdate:function(a,o){a=a._reactInternals;var u=ia(),m=Vo(u);m.tag=2,o!=null&&(m.callback=o),o=Xs(a,m,u),o!==null&&(Vr(o,a,u),wu(o,a,u))}};function hE(a,o,u,m,T,b,F){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(m,b,F):o.prototype&&o.prototype.isPureReactComponent?!Do(u,m)||!Do(T,b):!0}function lv(a,o,u,m){a=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,m),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,m),o.state!==a&&uE.enqueueReplaceState(o,o.state,null)}function Qc(a,o){var u=o;if("ref"in o){u={};for(var m in o)m!=="ref"&&(u[m]=o[m])}if(a=a.defaultProps){u===o&&(u=q({},u));for(var T in a)u[T]===void 0&&(u[T]=a[T])}return u}var Qp=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function dv(a){Qp(a)}function uv(a){console.error(a)}function hv(a){Qp(a)}function $p(a,o){try{var u=a.onUncaughtError;u(o.value,{componentStack:o.stack})}catch(m){setTimeout(function(){throw m})}}function pE(a,o,u){try{var m=a.onCaughtError;m(u.value,{componentStack:u.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(T){setTimeout(function(){throw T})}}function ja(a,o,u){return u=Vo(u),u.tag=3,u.payload={element:null},u.callback=function(){$p(a,o)},u}function pv(a){return a=Vo(a),a.tag=3,a}function fv(a,o,u,m){var T=u.type.getDerivedStateFromError;if(typeof T=="function"){var b=m.value;a.payload=function(){return T(b)},a.callback=function(){pE(o,u,m)}}var F=u.stateNode;F!==null&&typeof F.componentDidCatch=="function"&&(a.callback=function(){pE(o,u,m),typeof T!="function"&&(Qs===null?Qs=new Set([this]):Qs.add(this));var Y=m.stack;this.componentDidCatch(m.value,{componentStack:Y!==null?Y:""})})}function GC(a,o,u,m,T){if(u.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(o=u.alternate,o!==null&&yu(o,u,T,!0),u=kn.current,u!==null){switch(u.tag){case 13:return ds===null?sl():u.alternate===null&&sn===0&&(sn=3),u.flags&=-257,u.flags|=65536,u.lanes=T,m===ed?u.flags|=16384:(o=u.updateQueue,o===null?u.updateQueue=new Set([m]):o.add(m),Td(a,m,T)),!1;case 22:return u.flags|=65536,m===ed?u.flags|=16384:(o=u.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([m])},u.updateQueue=o):(u=o.retryQueue,u===null?o.retryQueue=new Set([m]):u.add(m)),Td(a,m,T)),!1}throw Error(v(435,u.tag))}return Td(a,m,T),sl(),!1}if(yi)return o=kn.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=T,m!==k_&&(a=Error(v(422),{cause:m}),Tu(Zr(a,u)))):(m!==k_&&(o=Error(v(423),{cause:m}),Tu(Zr(o,u))),a=a.current.alternate,a.flags|=65536,T&=-T,a.lanes|=T,m=Zr(m,u),T=ja(a.stateNode,m,T),G_(a,T),sn!==4&&(sn=2)),!1;var b=Error(v(520),{cause:m});if(b=Zr(b,u),_d===null?_d=[b]:_d.push(b),sn!==4&&(sn=2),o===null)return!0;m=Zr(m,u),u=o;do{switch(u.tag){case 3:return u.flags|=65536,a=T&-T,u.lanes|=a,a=ja(u.stateNode,m,a),G_(u,a),!1;case 1:if(o=u.type,b=u.stateNode,(u.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Qs===null||!Qs.has(b))))return u.flags|=65536,T&=-T,u.lanes|=T,T=pv(T),fv(T,a,u,m),G_(u,T),!1}u=u.return}while(u!==null);return!1}var mv=Error(v(461)),zn=!1;function tr(a,o,u,m){o.child=a===null?ov(o,null,u,m):Zc(o,a.child,u,m)}function ef(a,o,u,m,T){u=u.render;var b=o.ref;if("ref"in m){var F={};for(var Y in m)Y!=="ref"&&(F[Y]=m[Y])}else F=m;return ls(o),m=K_(a,o,u,F,b,T),Y=Y_(),a!==null&&!zn?(Fp(a,o,T),hs(a,o,T)):(yi&&Y&&Lp(o),o.flags|=1,tr(a,o,m,T),o.child)}function _v(a,o,u,m,T){if(a===null){var b=u.type;return typeof b=="function"&&!D_(b)&&b.defaultProps===void 0&&u.compare===null?(o.tag=15,o.type=b,Ev(a,o,b,m,T)):(a=Op(u.type,null,m,o,o.mode,T),a.ref=o.ref,a.return=o,o.child=a)}if(b=a.child,!nf(a,T)){var F=b.memoizedProps;if(u=u.compare,u=u!==null?u:Do,u(F,m)&&a.ref===o.ref)return hs(a,o,T)}return o.flags|=1,a=zs(b,m),a.ref=o.ref,a.return=o,o.child=a}function Ev(a,o,u,m,T){if(a!==null){var b=a.memoizedProps;if(Do(b,m)&&a.ref===o.ref)if(zn=!1,o.pendingProps=m=b,nf(a,T))(a.flags&131072)!==0&&(zn=!0);else return o.lanes=a.lanes,hs(a,o,T)}return fE(a,o,u,m,T)}function gv(a,o,u){var m=o.pendingProps,T=m.children,b=a!==null?a.memoizedState:null;if(m.mode==="hidden"){if((o.flags&128)!==0){if(m=b!==null?b.baseLanes|u:u,a!==null){for(T=o.child=a.child,b=0;T!==null;)b=b|T.lanes|T.childLanes,T=T.sibling;o.childLanes=b&~m}else o.childLanes=0,o.child=null;return Sv(a,o,m,u)}if((u&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},a!==null&&kp(o,b!==null?b.cachePool:null),b!==null?Ou(o,b):Yc(),cv(o);else return o.lanes=o.childLanes=536870912,Sv(a,o,b!==null?b.baseLanes|u:u,u)}else b!==null?(kp(o,b.cachePool),Ou(o,b),Wo(),o.memoizedState=null):(a!==null&&kp(o,null),Yc(),Wo());return tr(a,o,T,u),o.child}function Sv(a,o,u,m){var T=B_();return T=T===null?null:{parent:Cn._currentValue,pool:T},o.memoizedState={baseLanes:u,cachePool:T},a!==null&&kp(o,null),Yc(),cv(o),a!==null&&yu(a,o,m,!0),null}function tf(a,o){var u=o.ref;if(u===null)a!==null&&a.ref!==null&&(o.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(v(284));(a===null||a.ref!==u)&&(o.flags|=4194816)}}function fE(a,o,u,m,T){return ls(o),u=K_(a,o,u,m,void 0,T),m=Y_(),a!==null&&!zn?(Fp(a,o,T),hs(a,o,T)):(yi&&m&&Lp(o),o.flags|=1,tr(a,o,u,T),o.child)}function mE(a,o,u,m,T,b){return ls(o),o.updateQueue=null,u=BS(o,m,u,T),jS(a),m=Y_(),a!==null&&!zn?(Fp(a,o,b),hs(a,o,b)):(yi&&m&&Lp(o),o.flags|=1,tr(a,o,u,b),o.child)}function _E(a,o,u,m,T){if(ls(o),o.stateNode===null){var b=Ws,F=u.contextType;typeof F=="object"&&F!==null&&(b=xn(F)),b=new u(m,b),o.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=uE,o.stateNode=b,b._reactInternals=o,b=o.stateNode,b.props=m,b.state=o.memoizedState,b.refs={},Vp(o),F=u.contextType,b.context=typeof F=="object"&&F!==null?xn(F):Ws,b.state=o.memoizedState,F=u.getDerivedStateFromProps,typeof F=="function"&&(Zp(o,u,F,m),b.state=o.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(F=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),F!==b.state&&uE.enqueueReplaceState(b,b.state,null),zc(o,m,b,T),Wc(),b.state=o.memoizedState),typeof b.componentDidMount=="function"&&(o.flags|=4194308),m=!0}else if(a===null){b=o.stateNode;var Y=o.memoizedProps,re=Qc(u,Y);b.props=re;var Se=b.context,Pe=u.contextType;F=Ws,typeof Pe=="object"&&Pe!==null&&(F=xn(Pe));var Be=u.getDerivedStateFromProps;Pe=typeof Be=="function"||typeof b.getSnapshotBeforeUpdate=="function",Y=o.pendingProps!==Y,Pe||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(Y||Se!==F)&&lv(o,b,m,F),Ua=!1;var be=o.memoizedState;b.state=be,zc(o,m,b,T),Wc(),Se=o.memoizedState,Y||be!==Se||Ua?(typeof Be=="function"&&(Zp(o,u,Be,m),Se=o.memoizedState),(re=Ua||hE(o,u,re,m,be,Se,F))?(Pe||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(o.flags|=4194308)):(typeof b.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=m,o.memoizedState=Se),b.props=m,b.state=Se,b.context=F,m=re):(typeof b.componentDidMount=="function"&&(o.flags|=4194308),m=!1)}else{b=o.stateNode,F_(a,o),F=o.memoizedProps,Pe=Qc(u,F),b.props=Pe,Be=o.pendingProps,be=b.context,Se=u.contextType,re=Ws,typeof Se=="object"&&Se!==null&&(re=xn(Se)),Y=u.getDerivedStateFromProps,(Se=typeof Y=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(F!==Be||be!==re)&&lv(o,b,m,re),Ua=!1,be=o.memoizedState,b.state=be,zc(o,m,b,T),Wc();var we=o.memoizedState;F!==Be||be!==we||Ua||a!==null&&a.dependencies!==null&&xp(a.dependencies)?(typeof Y=="function"&&(Zp(o,u,Y,m),we=o.memoizedState),(Pe=Ua||hE(o,u,Pe,m,be,we,re)||a!==null&&a.dependencies!==null&&xp(a.dependencies))?(Se||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(m,we,re),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(m,we,re)),typeof b.componentDidUpdate=="function"&&(o.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof b.componentDidUpdate!="function"||F===a.memoizedProps&&be===a.memoizedState||(o.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||F===a.memoizedProps&&be===a.memoizedState||(o.flags|=1024),o.memoizedProps=m,o.memoizedState=we),b.props=m,b.state=we,b.context=re,m=Pe):(typeof b.componentDidUpdate!="function"||F===a.memoizedProps&&be===a.memoizedState||(o.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||F===a.memoizedProps&&be===a.memoizedState||(o.flags|=1024),m=!1)}return b=m,tf(a,o),m=(o.flags&128)!==0,b||m?(b=o.stateNode,u=m&&typeof u.getDerivedStateFromError!="function"?null:b.render(),o.flags|=1,a!==null&&m?(o.child=Zc(o,a.child,null,T),o.child=Zc(o,null,u,T)):tr(a,o,u,T),o.memoizedState=b.state,a=o.child):a=hs(a,o,T),a}function vv(a,o,u,m){return Bc(),o.flags|=256,tr(a,o,u,m),o.child}var EE={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function dd(a){return{baseLanes:a,cachePool:PS()}}function Hu(a,o,u){return a=a!==null?a.childLanes&~u:0,o&&(a|=ma),a}function gE(a,o,u){var m=o.pendingProps,T=!1,b=(o.flags&128)!==0,F;if((F=b)||(F=a!==null&&a.memoizedState===null?!1:(Mn.current&2)!==0),F&&(T=!0,o.flags&=-129),F=(o.flags&32)!==0,o.flags&=-33,a===null){if(yi){if(T?Ho(o):Wo(),yi){var Y=Xi,re;if(re=Y){e:{for(re=Y,Y=cs;re.nodeType!==8;){if(!Y){Y=null;break e}if(re=za(re.nextSibling),re===null){Y=null;break e}}Y=re}Y!==null?(o.memoizedState={dehydrated:Y,treeContext:Mc!==null?{id:Ks,overflow:Ma}:null,retryLane:536870912,hydrationErrors:null},re=Qr(18,null,null,0),re.stateNode=Y,re.return=o,o.child=re,ur=o,Xi=null,re=!0):re=!1}re||jc(o)}if(Y=o.memoizedState,Y!==null&&(Y=Y.dehydrated,Y!==null))return Of(Y)?o.lanes=32:o.lanes=536870912,null;us(o)}return Y=m.children,m=m.fallback,T?(Wo(),T=o.mode,Y=Wu({mode:"hidden",children:Y},T),m=ko(m,T,u,null),Y.return=o,m.return=o,Y.sibling=m,o.child=Y,T=o.child,T.memoizedState=dd(u),T.childLanes=Hu(a,F,u),o.memoizedState=EE,m):(Ho(o),ud(o,Y))}if(re=a.memoizedState,re!==null&&(Y=re.dehydrated,Y!==null)){if(b)o.flags&256?(Ho(o),o.flags&=-257,o=SE(a,o,u)):o.memoizedState!==null?(Wo(),o.child=a.child,o.flags|=128,o=null):(Wo(),T=m.fallback,Y=o.mode,m=Wu({mode:"visible",children:m.children},Y),T=ko(T,Y,u,null),T.flags|=2,m.return=o,T.return=o,m.sibling=T,o.child=m,Zc(o,a.child,null,u),m=o.child,m.memoizedState=dd(u),m.childLanes=Hu(a,F,u),o.memoizedState=EE,o=T);else if(Ho(o),Of(Y)){if(F=Y.nextSibling&&Y.nextSibling.dataset,F)var Se=F.dgst;F=Se,m=Error(v(419)),m.stack="",m.digest=F,Tu({value:m,source:null,stack:null}),o=SE(a,o,u)}else if(zn||yu(a,o,u,!1),F=(u&a.childLanes)!==0,zn||F){if(F=Wi,F!==null&&(m=u&-u,m=(m&42)!==0?1:wo(m),m=(m&(F.suspendedLanes|u))!==0?0:m,m!==0&&m!==re.retryLane))throw re.retryLane=m,ql(a,m),Vr(F,a,m),mv;Y.data==="$?"||sl(),o=SE(a,o,u)}else Y.data==="$?"?(o.flags|=192,o.child=a.child,o=null):(a=re.treeContext,Xi=za(Y.nextSibling),ur=o,yi=!0,Vc=null,cs=!1,a!==null&&($r[pa++]=Ks,$r[pa++]=Ma,$r[pa++]=Mc,Ks=a.id,Ma=a.overflow,Mc=o),o=ud(o,m.children),o.flags|=4096);return o}return T?(Wo(),T=m.fallback,Y=o.mode,re=a.child,Se=re.sibling,m=zs(re,{mode:"hidden",children:m.children}),m.subtreeFlags=re.subtreeFlags&65011712,Se!==null?T=zs(Se,T):(T=ko(T,Y,u,null),T.flags|=2),T.return=o,m.return=o,m.sibling=T,o.child=m,m=T,T=o.child,Y=a.child.memoizedState,Y===null?Y=dd(u):(re=Y.cachePool,re!==null?(Se=Cn._currentValue,re=re.parent!==Se?{parent:Se,pool:Se}:re):re=PS(),Y={baseLanes:Y.baseLanes|u,cachePool:re}),T.memoizedState=Y,T.childLanes=Hu(a,F,u),o.memoizedState=EE,m):(Ho(o),u=a.child,a=u.sibling,u=zs(u,{mode:"visible",children:m.children}),u.return=o,u.sibling=null,a!==null&&(F=o.deletions,F===null?(o.deletions=[a],o.flags|=16):F.push(a)),o.child=u,o.memoizedState=null,u)}function ud(a,o){return o=Wu({mode:"visible",children:o},a.mode),o.return=a,a.child=o}function Wu(a,o){return a=Qr(22,a,null,o),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function SE(a,o,u){return Zc(o,a.child,null,u),a=ud(o,o.pendingProps.children),a.flags|=2,o.memoizedState=null,a}function vE(a,o,u){a.lanes|=o;var m=a.alternate;m!==null&&(m.lanes|=o),V_(a.return,o,u)}function hd(a,o,u,m,T){var b=a.memoizedState;b===null?a.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:m,tail:u,tailMode:T}:(b.isBackwards=o,b.rendering=null,b.renderingStartTime=0,b.last=m,b.tail=u,b.tailMode=T)}function Tv(a,o,u){var m=o.pendingProps,T=m.revealOrder,b=m.tail;if(tr(a,o,m.children,u),m=Mn.current,(m&2)!==0)m=m&1|2,o.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=o.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&vE(a,u,o);else if(a.tag===19)vE(a,u,o);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break e;for(;a.sibling===null;){if(a.return===null||a.return===o)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}m&=1}switch(it(Mn,m),T){case"forwards":for(u=o.child,T=null;u!==null;)a=u.alternate,a!==null&&ld(a)===null&&(T=u),u=u.sibling;u=T,u===null?(T=o.child,o.child=null):(T=u.sibling,u.sibling=null),hd(o,!1,T,u,b);break;case"backwards":for(u=null,T=o.child,o.child=null;T!==null;){if(a=T.alternate,a!==null&&ld(a)===null){o.child=T;break}a=T.sibling,T.sibling=u,u=T,T=a}hd(o,!0,u,null,b);break;case"together":hd(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function hs(a,o,u){if(a!==null&&(o.dependencies=a.dependencies),Ga|=o.lanes,(u&o.childLanes)===0)if(a!==null){if(yu(a,o,u,!1),(u&o.childLanes)===0)return null}else return null;if(a!==null&&o.child!==a.child)throw Error(v(153));if(o.child!==null){for(a=o.child,u=zs(a,a.pendingProps),o.child=u,u.return=o;a.sibling!==null;)a=a.sibling,u=u.sibling=zs(a,a.pendingProps),u.return=o;u.sibling=null}return o.child}function nf(a,o){return(a.lanes&o)!==0?!0:(a=a.dependencies,!!(a!==null&&xp(a)))}function HC(a,o,u){switch(o.tag){case 3:en(o,o.stateNode.containerInfo),Mo(o,Cn,a.memoizedState.cache),Bc();break;case 27:case 5:Nl(o);break;case 4:en(o,o.stateNode.containerInfo);break;case 10:Mo(o,o.type,o.memoizedProps.value);break;case 13:var m=o.memoizedState;if(m!==null)return m.dehydrated!==null?(Ho(o),o.flags|=128,null):(u&o.child.childLanes)!==0?gE(a,o,u):(Ho(o),a=hs(a,o,u),a!==null?a.sibling:null);Ho(o);break;case 19:var T=(a.flags&128)!==0;if(m=(u&o.childLanes)!==0,m||(yu(a,o,u,!1),m=(u&o.childLanes)!==0),T){if(m)return Tv(a,o,u);o.flags|=128}if(T=o.memoizedState,T!==null&&(T.rendering=null,T.tail=null,T.lastEffect=null),it(Mn,Mn.current),m)break;return null;case 22:case 23:return o.lanes=0,gv(a,o,u);case 24:Mo(o,Cn,a.memoizedState.cache)}return hs(a,o,u)}function zu(a,o,u){if(a!==null)if(a.memoizedProps!==o.pendingProps)zn=!0;else{if(!nf(a,u)&&(o.flags&128)===0)return zn=!1,HC(a,o,u);zn=(a.flags&131072)!==0}else zn=!1,yi&&(o.flags&1048576)!==0&&P_(o,Dp,o.index);switch(o.lanes=0,o.tag){case 16:e:{a=o.pendingProps;var m=o.elementType,T=m._init;if(m=T(m._payload),o.type=m,typeof m=="function")D_(m)?(a=Qc(m,a),o.tag=1,o=_E(null,o,m,a,u)):(o.tag=0,o=fE(null,o,m,a,u));else{if(m!=null){if(T=m.$$typeof,T===Ue){o.tag=11,o=ef(null,o,m,a,u);break e}else if(T===$e){o.tag=14,o=_v(null,o,m,a,u);break e}}throw o=Ct(m)||m,Error(v(306,o,""))}}return o;case 0:return fE(a,o,o.type,o.pendingProps,u);case 1:return m=o.type,T=Qc(m,o.pendingProps),_E(a,o,m,T,u);case 3:e:{if(en(o,o.stateNode.containerInfo),a===null)throw Error(v(387));m=o.pendingProps;var b=o.memoizedState;T=b.element,F_(a,o),zc(o,m,null,u);var F=o.memoizedState;if(m=F.cache,Mo(o,Cn,m),m!==b.cache&&j_(o,[Cn],u,!0),Wc(),m=F.element,b.isDehydrated)if(b={element:m,isDehydrated:!1,cache:F.cache},o.updateQueue.baseState=b,o.memoizedState=b,o.flags&256){o=vv(a,o,m,u);break e}else if(m!==T){T=Zr(Error(v(424)),o),Tu(T),o=vv(a,o,m,u);break e}else{switch(a=o.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(Xi=za(a.firstChild),ur=o,yi=!0,Vc=null,cs=!0,u=ov(o,null,m,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(Bc(),m===T){o=hs(a,o,u);break e}tr(a,o,m,u)}o=o.child}return o;case 26:return tf(a,o),a===null?(u=Zv(o.type,null,o.pendingProps,null))?o.memoizedState=u:yi||(u=o.type,a=o.pendingProps,m=If(Bt.current).createElement(u),m[lr]=o,m[Lr]=a,Yn(m,u,a),Ln(m),o.stateNode=m):o.memoizedState=Zv(o.type,a.memoizedProps,o.pendingProps,a.memoizedState),null;case 27:return Nl(o),a===null&&yi&&(m=o.stateNode=Yv(o.type,o.pendingProps,Bt.current),ur=o,cs=!0,T=Xi,$o(o.type)?($E=T,Xi=za(m.firstChild)):Xi=T),tr(a,o,o.pendingProps.children,u),tf(a,o),a===null&&(o.flags|=4194304),o.child;case 5:return a===null&&yi&&((T=m=Xi)&&(m=ob(m,o.type,o.pendingProps,cs),m!==null?(o.stateNode=m,ur=o,Xi=za(m.firstChild),cs=!1,T=!0):T=!1),T||jc(o)),Nl(o),T=o.type,b=o.pendingProps,F=a!==null?a.memoizedProps:null,m=b.children,JE(T,b)?m=null:F!==null&&JE(T,F)&&(o.flags|=32),o.memoizedState!==null&&(T=K_(a,o,FS,null,null,u),fh._currentValue=T),tf(a,o),tr(a,o,m,u),o.child;case 6:return a===null&&yi&&((a=u=Xi)&&(u=cb(u,o.pendingProps,cs),u!==null?(o.stateNode=u,ur=o,Xi=null,a=!0):a=!1),a||jc(o)),null;case 13:return gE(a,o,u);case 4:return en(o,o.stateNode.containerInfo),m=o.pendingProps,a===null?o.child=Zc(o,null,m,u):tr(a,o,m,u),o.child;case 11:return ef(a,o,o.type,o.pendingProps,u);case 7:return tr(a,o,o.pendingProps,u),o.child;case 8:return tr(a,o,o.pendingProps.children,u),o.child;case 12:return tr(a,o,o.pendingProps.children,u),o.child;case 10:return m=o.pendingProps,Mo(o,o.type,m.value),tr(a,o,m.children,u),o.child;case 9:return T=o.type._context,m=o.pendingProps.children,ls(o),T=xn(T),m=m(T),o.flags|=1,tr(a,o,m,u),o.child;case 14:return _v(a,o,o.type,o.pendingProps,u);case 15:return Ev(a,o,o.type,o.pendingProps,u);case 19:return Tv(a,o,u);case 31:return m=o.pendingProps,u=o.mode,m={mode:m.mode,children:m.children},a===null?(u=Wu(m,u),u.ref=o.ref,o.child=u,u.return=o,o=u):(u=zs(a.child,m),u.ref=o.ref,o.child=u,u.return=o,o=u),o;case 22:return gv(a,o,u);case 24:return ls(o),m=xn(Cn),a===null?(T=B_(),T===null&&(T=Wi,b=Ru(),T.pooledCache=b,b.refCount++,b!==null&&(T.pooledCacheLanes|=u),T=b),o.memoizedState={parent:m,cache:T},Vp(o),Mo(o,Cn,T)):((a.lanes&u)!==0&&(F_(a,o),zc(o,null,null,u),Wc()),T=a.memoizedState,b=o.memoizedState,T.parent!==m?(T={parent:m,cache:m},o.memoizedState=T,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=T),Mo(o,Cn,m)):(m=b.cache,Mo(o,Cn,m),m!==T.cache&&j_(o,[Cn],u,!0))),tr(a,o,o.pendingProps.children,u),o.child;case 29:throw o.pendingProps}throw Error(v(156,o.tag))}function ps(a){a.flags|=4}function yv(a,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!eT(o)){if(o=kn.current,o!==null&&((hi&4194048)===hi?ds!==null:(hi&62914560)!==hi&&(hi&536870912)===0||o!==ds))throw Au=ed,xS;a.flags|=8192}}function rf(a,o){o!==null&&(a.flags|=4),a.flags&16384&&(o=a.tag!==22?j0():536870912,a.lanes|=o,il|=o)}function Ku(a,o){if(!yi)switch(a.tailMode){case"hidden":o=a.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?a.tail=null:u.sibling=null;break;case"collapsed":u=a.tail;for(var m=null;u!==null;)u.alternate!==null&&(m=u),u=u.sibling;m===null?o||a.tail===null?a.tail=null:a.tail.sibling=null:m.sibling=null}}function Hi(a){var o=a.alternate!==null&&a.alternate.child===a.child,u=0,m=0;if(o)for(var T=a.child;T!==null;)u|=T.lanes|T.childLanes,m|=T.subtreeFlags&65011712,m|=T.flags&65011712,T.return=a,T=T.sibling;else for(T=a.child;T!==null;)u|=T.lanes|T.childLanes,m|=T.subtreeFlags,m|=T.flags,T.return=a,T=T.sibling;return a.subtreeFlags|=m,a.childLanes=u,o}function WC(a,o,u){var m=o.pendingProps;switch(x_(o),o.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hi(o),null;case 1:return Hi(o),null;case 3:return u=o.stateNode,m=null,a!==null&&(m=a.memoizedState.cache),o.memoizedState.cache!==m&&(o.flags|=2048),qs(Cn),La(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(a===null||a.child===null)&&(vu(o)?ps(o):a===null||a.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,IS())),Hi(o),null;case 26:return u=o.memoizedState,a===null?(ps(o),u!==null?(Hi(o),yv(o,u)):(Hi(o),o.flags&=-16777217)):u?u!==a.memoizedState?(ps(o),Hi(o),yv(o,u)):(Hi(o),o.flags&=-16777217):(a.memoizedProps!==m&&ps(o),Hi(o),o.flags&=-16777217),null;case 27:cp(o),u=Bt.current;var T=o.type;if(a!==null&&o.stateNode!=null)a.memoizedProps!==m&&ps(o);else{if(!m){if(o.stateNode===null)throw Error(v(166));return Hi(o),null}a=_t.current,vu(o)?M_(o):(a=Yv(T,m,u),o.stateNode=a,ps(o))}return Hi(o),null;case 5:if(cp(o),u=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==m&&ps(o);else{if(!m){if(o.stateNode===null)throw Error(v(166));return Hi(o),null}if(a=_t.current,vu(o))M_(o);else{switch(T=If(Bt.current),a){case 1:a=T.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:a=T.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":a=T.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":a=T.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":a=T.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof m.is=="string"?T.createElement("select",{is:m.is}):T.createElement("select"),m.multiple?a.multiple=!0:m.size&&(a.size=m.size);break;default:a=typeof m.is=="string"?T.createElement(u,{is:m.is}):T.createElement(u)}}a[lr]=o,a[Lr]=m;e:for(T=o.child;T!==null;){if(T.tag===5||T.tag===6)a.appendChild(T.stateNode);else if(T.tag!==4&&T.tag!==27&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===o)break e;for(;T.sibling===null;){if(T.return===null||T.return===o)break e;T=T.return}T.sibling.return=T.return,T=T.sibling}o.stateNode=a;e:switch(Yn(a,u,m),u){case"button":case"input":case"select":case"textarea":a=!!m.autoFocus;break e;case"img":a=!0;break e;default:a=!1}a&&ps(o)}}return Hi(o),o.flags&=-16777217,null;case 6:if(a&&o.stateNode!=null)a.memoizedProps!==m&&ps(o);else{if(typeof m!="string"&&o.stateNode===null)throw Error(v(166));if(a=Bt.current,vu(o)){if(a=o.stateNode,u=o.memoizedProps,m=null,T=ur,T!==null)switch(T.tag){case 27:case 5:m=T.memoizedProps}a[lr]=o,a=!!(a.nodeValue===u||m!==null&&m.suppressHydrationWarning===!0||wf(a.nodeValue,u)),a||jc(o)}else a=If(a).createTextNode(m),a[lr]=o,o.stateNode=a}return Hi(o),null;case 13:if(m=o.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(T=vu(o),m!==null&&m.dehydrated!==null){if(a===null){if(!T)throw Error(v(318));if(T=o.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(v(317));T[lr]=o}else Bc(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Hi(o),T=!1}else T=IS(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=T),T=!0;if(!T)return o.flags&256?(us(o),o):(us(o),null)}if(us(o),(o.flags&128)!==0)return o.lanes=u,o;if(u=m!==null,a=a!==null&&a.memoizedState!==null,u){m=o.child,T=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(T=m.alternate.memoizedState.cachePool.pool);var b=null;m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(b=m.memoizedState.cachePool.pool),b!==T&&(m.flags|=2048)}return u!==a&&u&&(o.child.flags|=8192),rf(o,o.updateQueue),Hi(o),null;case 4:return La(),a===null&&bf(o.stateNode.containerInfo),Hi(o),null;case 10:return qs(o.type),Hi(o),null;case 19:if(tt(Mn),T=o.memoizedState,T===null)return Hi(o),null;if(m=(o.flags&128)!==0,b=T.rendering,b===null)if(m)Ku(T,!1);else{if(sn!==0||a!==null&&(a.flags&128)!==0)for(a=o.child;a!==null;){if(b=ld(a),b!==null){for(o.flags|=128,Ku(T,!1),a=b.updateQueue,o.updateQueue=a,rf(o,a),o.subtreeFlags=0,a=u,u=o.child;u!==null;)Ip(u,a),u=u.sibling;return it(Mn,Mn.current&1|2),o.child}a=a.sibling}T.tail!==null&&as()>Ed&&(o.flags|=128,m=!0,Ku(T,!1),o.lanes=4194304)}else{if(!m)if(a=ld(b),a!==null){if(o.flags|=128,m=!0,a=a.updateQueue,o.updateQueue=a,rf(o,a),Ku(T,!0),T.tail===null&&T.tailMode==="hidden"&&!b.alternate&&!yi)return Hi(o),null}else 2*as()-T.renderingStartTime>Ed&&u!==536870912&&(o.flags|=128,m=!0,Ku(T,!1),o.lanes=4194304);T.isBackwards?(b.sibling=o.child,o.child=b):(a=T.last,a!==null?a.sibling=b:o.child=b,T.last=b)}return T.tail!==null?(o=T.tail,T.rendering=o,T.tail=o.sibling,T.renderingStartTime=as(),o.sibling=null,a=Mn.current,it(Mn,m?a&1|2:a&1),o):(Hi(o),null);case 22:case 23:return us(o),z_(),m=o.memoizedState!==null,a!==null?a.memoizedState!==null!==m&&(o.flags|=8192):m&&(o.flags|=8192),m?(u&536870912)!==0&&(o.flags&128)===0&&(Hi(o),o.subtreeFlags&6&&(o.flags|=8192)):Hi(o),u=o.updateQueue,u!==null&&rf(o,u.retryQueue),u=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),m=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(m=o.memoizedState.cachePool.pool),m!==u&&(o.flags|=2048),a!==null&&tt(Uo),null;case 24:return u=null,a!==null&&(u=a.memoizedState.cache),o.memoizedState.cache!==u&&(o.flags|=2048),qs(Cn),Hi(o),null;case 25:return null;case 30:return null}throw Error(v(156,o.tag))}function zC(a,o){switch(x_(o),o.tag){case 1:return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 3:return qs(Cn),La(),a=o.flags,(a&65536)!==0&&(a&128)===0?(o.flags=a&-65537|128,o):null;case 26:case 27:case 5:return cp(o),null;case 13:if(us(o),a=o.memoizedState,a!==null&&a.dehydrated!==null){if(o.alternate===null)throw Error(v(340));Bc()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 19:return tt(Mn),null;case 4:return La(),null;case 10:return qs(o.type),null;case 22:case 23:return us(o),z_(),a!==null&&tt(Uo),a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 24:return qs(Cn),null;case 25:return null;default:return null}}function Rv(a,o){switch(x_(o),o.tag){case 3:qs(Cn),La();break;case 26:case 27:case 5:cp(o);break;case 4:La();break;case 13:us(o);break;case 19:tt(Mn);break;case 10:qs(o.type);break;case 22:case 23:us(o),z_(),a!==null&&tt(Uo);break;case 24:qs(Cn)}}function pd(a,o){try{var u=o.updateQueue,m=u!==null?u.lastEffect:null;if(m!==null){var T=m.next;u=T;do{if((u.tag&a)===a){m=void 0;var b=u.create,F=u.inst;m=b(),F.destroy=m}u=u.next}while(u!==T)}}catch(Y){ji(o,o.return,Y)}}function zo(a,o,u){try{var m=o.updateQueue,T=m!==null?m.lastEffect:null;if(T!==null){var b=T.next;m=b;do{if((m.tag&a)===a){var F=m.inst,Y=F.destroy;if(Y!==void 0){F.destroy=void 0,T=o;var re=u,Se=Y;try{Se()}catch(Pe){ji(T,re,Pe)}}}m=m.next}while(m!==b)}}catch(Pe){ji(o,o.return,Pe)}}function Cv(a){var o=a.updateQueue;if(o!==null){var u=a.stateNode;try{jp(o,u)}catch(m){ji(a,a.return,m)}}}function af(a,o,u){u.props=Qc(a.type,a.memoizedProps),u.state=a.memoizedState;try{u.componentWillUnmount()}catch(m){ji(a,o,m)}}function Yu(a,o){try{var u=a.ref;if(u!==null){switch(a.tag){case 26:case 27:case 5:var m=a.stateNode;break;case 30:m=a.stateNode;break;default:m=a.stateNode}typeof u=="function"?a.refCleanup=u(m):u.current=m}}catch(T){ji(a,o,T)}}function fa(a,o){var u=a.ref,m=a.refCleanup;if(u!==null)if(typeof m=="function")try{m()}catch(T){ji(a,o,T)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(T){ji(a,o,T)}else u.current=null}function bv(a){var o=a.type,u=a.memoizedProps,m=a.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":u.autoFocus&&m.focus();break e;case"img":u.src?m.src=u.src:u.srcSet&&(m.srcset=u.srcSet)}}catch(T){ji(a,a.return,T)}}function sf(a,o,u){try{var m=a.stateNode;ib(m,a.type,u,o),m[Lr]=o}catch(T){ji(a,a.return,T)}}function Av(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&$o(a.type)||a.tag===4}function TE(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||Av(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&$o(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function of(a,o,u){var m=a.tag;if(m===5||m===6)a=a.stateNode,o?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(a,o):(o=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,o.appendChild(a),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=ch));else if(m!==4&&(m===27&&$o(a.type)&&(u=a.stateNode,o=null),a=a.child,a!==null))for(of(a,o,u),a=a.sibling;a!==null;)of(a,o,u),a=a.sibling}function cf(a,o,u){var m=a.tag;if(m===5||m===6)a=a.stateNode,o?u.insertBefore(a,o):u.appendChild(a);else if(m!==4&&(m===27&&$o(a.type)&&(u=a.stateNode),a=a.child,a!==null))for(cf(a,o,u),a=a.sibling;a!==null;)cf(a,o,u),a=a.sibling}function wv(a){var o=a.stateNode,u=a.memoizedProps;try{for(var m=a.type,T=o.attributes;T.length;)o.removeAttributeNode(T[0]);Yn(o,m,u),o[lr]=a,o[Lr]=u}catch(b){ji(a,a.return,b)}}var fs=!1,un=!1,qu=!1,Iv=typeof WeakSet=="function"?WeakSet:Set,Kn=null;function Xu(a,o){if(a=a.containerInfo,XE=Mf,a=Hs(a),y_(a)){if("selectionStart"in a)var u={start:a.selectionStart,end:a.selectionEnd};else e:{u=(u=a.ownerDocument)&&u.defaultView||window;var m=u.getSelection&&u.getSelection();if(m&&m.rangeCount!==0){u=m.anchorNode;var T=m.anchorOffset,b=m.focusNode;m=m.focusOffset;try{u.nodeType,b.nodeType}catch{u=null;break e}var F=0,Y=-1,re=-1,Se=0,Pe=0,Be=a,be=null;t:for(;;){for(var we;Be!==u||T!==0&&Be.nodeType!==3||(Y=F+T),Be!==b||m!==0&&Be.nodeType!==3||(re=F+m),Be.nodeType===3&&(F+=Be.nodeValue.length),(we=Be.firstChild)!==null;)be=Be,Be=we;for(;;){if(Be===a)break t;if(be===u&&++Se===T&&(Y=F),be===b&&++Pe===m&&(re=F),(we=Be.nextSibling)!==null)break;Be=be,be=Be.parentNode}Be=we}u=Y===-1||re===-1?null:{start:Y,end:re}}else u=null}u=u||{start:0,end:0}}else u=null;for(Id={focusedElem:a,selectionRange:u},Mf=!1,Kn=o;Kn!==null;)if(o=Kn,a=o.child,(o.subtreeFlags&1024)!==0&&a!==null)a.return=o,Kn=a;else for(;Kn!==null;){switch(o=Kn,b=o.alternate,a=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&b!==null){a=void 0,u=o,T=b.memoizedProps,b=b.memoizedState,m=u.stateNode;try{var xt=Qc(u.type,T,u.elementType===u.type);a=m.getSnapshotBeforeUpdate(xt,b),m.__reactInternalSnapshotBeforeUpdate=a}catch(bt){ji(u,u.return,bt)}}break;case 3:if((a&1024)!==0){if(a=o.stateNode.containerInfo,u=a.nodeType,u===9)QE(a);else if(u===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":QE(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(v(163))}if(a=o.sibling,a!==null){a.return=o.return,Kn=a;break}Kn=o.return}}function yE(a,o,u){var m=u.flags;switch(u.tag){case 0:case 11:case 15:yr(a,u),m&4&&pd(5,u);break;case 1:if(yr(a,u),m&4)if(a=u.stateNode,o===null)try{a.componentDidMount()}catch(F){ji(u,u.return,F)}else{var T=Qc(u.type,o.memoizedProps);o=o.memoizedState;try{a.componentDidUpdate(T,o,a.__reactInternalSnapshotBeforeUpdate)}catch(F){ji(u,u.return,F)}}m&64&&Cv(u),m&512&&Yu(u,u.return);break;case 3:if(yr(a,u),m&64&&(a=u.updateQueue,a!==null)){if(o=null,u.child!==null)switch(u.child.tag){case 27:case 5:o=u.child.stateNode;break;case 1:o=u.child.stateNode}try{jp(a,o)}catch(F){ji(u,u.return,F)}}break;case 27:o===null&&m&4&&wv(u);case 26:case 5:yr(a,u),o===null&&m&4&&bv(u),m&512&&Yu(u,u.return);break;case 12:yr(a,u);break;case 13:yr(a,u),m&4&&Ov(a,u),m&64&&(a=u.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(u=ZC.bind(null,u),lb(a,u))));break;case 22:if(m=u.memoizedState!==null||fs,!m){o=o!==null&&o.memoizedState!==null||un,T=fs;var b=un;fs=m,(un=o)&&!b?Ur(a,u,(u.subtreeFlags&8772)!==0):yr(a,u),fs=T,un=b}break;case 30:break;default:yr(a,u)}}function fd(a){var o=a.alternate;o!==null&&(a.alternate=null,fd(o)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(o=a.stateNode,o!==null&&hp(o)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Ni=null,Tr=!1;function Ba(a,o,u){for(u=u.child;u!==null;)Ju(a,o,u),u=u.sibling}function Ju(a,o,u){if(mn&&typeof mn.onCommitFiberUnmount=="function")try{mn.onCommitFiberUnmount(Ll,u)}catch{}switch(u.tag){case 26:un||fa(u,o),Ba(a,o,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:un||fa(u,o);var m=Ni,T=Tr;$o(u.type)&&(Ni=u.stateNode,Tr=!1),Ba(a,o,u),lh(u.stateNode),Ni=m,Tr=T;break;case 5:un||fa(u,o);case 6:if(m=Ni,T=Tr,Ni=null,Ba(a,o,u),Ni=m,Tr=T,Ni!==null)if(Tr)try{(Ni.nodeType===9?Ni.body:Ni.nodeName==="HTML"?Ni.ownerDocument.body:Ni).removeChild(u.stateNode)}catch(b){ji(u,o,b)}else try{Ni.removeChild(u.stateNode)}catch(b){ji(u,o,b)}break;case 18:Ni!==null&&(Tr?(a=Ni,zv(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,u.stateNode),Sh(a)):zv(Ni,u.stateNode));break;case 4:m=Ni,T=Tr,Ni=u.stateNode.containerInfo,Tr=!0,Ba(a,o,u),Ni=m,Tr=T;break;case 0:case 11:case 14:case 15:un||zo(2,u,o),un||zo(4,u,o),Ba(a,o,u);break;case 1:un||(fa(u,o),m=u.stateNode,typeof m.componentWillUnmount=="function"&&af(u,o,m)),Ba(a,o,u);break;case 21:Ba(a,o,u);break;case 22:un=(m=un)||u.memoizedState!==null,Ba(a,o,u),un=m;break;default:Ba(a,o,u)}}function Ov(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Sh(a)}catch(u){ji(o,o.return,u)}}function KC(a){switch(a.tag){case 13:case 19:var o=a.stateNode;return o===null&&(o=a.stateNode=new Iv),o;case 22:return a=a.stateNode,o=a._retryCache,o===null&&(o=a._retryCache=new Iv),o;default:throw Error(v(435,a.tag))}}function RE(a,o){var u=KC(a);o.forEach(function(m){var T=QC.bind(null,a,m);u.has(m)||(u.add(m),m.then(T,T))})}function Mr(a,o){var u=o.deletions;if(u!==null)for(var m=0;m<u.length;m++){var T=u[m],b=a,F=o,Y=F;e:for(;Y!==null;){switch(Y.tag){case 27:if($o(Y.type)){Ni=Y.stateNode,Tr=!1;break e}break;case 5:Ni=Y.stateNode,Tr=!1;break e;case 3:case 4:Ni=Y.stateNode.containerInfo,Tr=!0;break e}Y=Y.return}if(Ni===null)throw Error(v(160));Ju(b,F,T),Ni=null,Tr=!1,b=T.alternate,b!==null&&(b.return=null),T.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)Nv(o,a),o=o.sibling}var Fa=null;function Nv(a,o){var u=a.alternate,m=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Mr(o,a),ta(a),m&4&&(zo(3,a,a.return),pd(3,a),zo(5,a,a.return));break;case 1:Mr(o,a),ta(a),m&512&&(un||u===null||fa(u,u.return)),m&64&&fs&&(a=a.updateQueue,a!==null&&(m=a.callbacks,m!==null&&(u=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=u===null?m:u.concat(m))));break;case 26:var T=Fa;if(Mr(o,a),ta(a),m&512&&(un||u===null||fa(u,u.return)),m&4){var b=u!==null?u.memoizedState:null;if(m=a.memoizedState,u===null)if(m===null)if(a.stateNode===null){e:{m=a.type,u=a.memoizedProps,T=T.ownerDocument||T;t:switch(m){case"title":b=T.getElementsByTagName("title")[0],(!b||b[kl]||b[lr]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=T.createElement(m),T.head.insertBefore(b,T.querySelector("head > title"))),Yn(b,m,u),b[lr]=a,Ln(b),m=b;break e;case"link":var F=ig("link","href",T).get(m+(u.href||""));if(F){for(var Y=0;Y<F.length;Y++)if(b=F[Y],b.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&b.getAttribute("rel")===(u.rel==null?null:u.rel)&&b.getAttribute("title")===(u.title==null?null:u.title)&&b.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){F.splice(Y,1);break t}}b=T.createElement(m),Yn(b,m,u),T.head.appendChild(b);break;case"meta":if(F=ig("meta","content",T).get(m+(u.content||""))){for(Y=0;Y<F.length;Y++)if(b=F[Y],b.getAttribute("content")===(u.content==null?null:""+u.content)&&b.getAttribute("name")===(u.name==null?null:u.name)&&b.getAttribute("property")===(u.property==null?null:u.property)&&b.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&b.getAttribute("charset")===(u.charSet==null?null:u.charSet)){F.splice(Y,1);break t}}b=T.createElement(m),Yn(b,m,u),T.head.appendChild(b);break;default:throw Error(v(468,m))}b[lr]=a,Ln(b),m=b}a.stateNode=m}else $v(T,a.type,a.stateNode);else a.stateNode=Lf(T,m,a.memoizedProps);else b!==m?(b===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):b.count--,m===null?$v(T,a.type,a.stateNode):Lf(T,m,a.memoizedProps)):m===null&&a.stateNode!==null&&sf(a,a.memoizedProps,u.memoizedProps)}break;case 27:Mr(o,a),ta(a),m&512&&(un||u===null||fa(u,u.return)),u!==null&&m&4&&sf(a,a.memoizedProps,u.memoizedProps);break;case 5:if(Mr(o,a),ta(a),m&512&&(un||u===null||fa(u,u.return)),a.flags&32){T=a.stateNode;try{Oo(T,"")}catch(we){ji(a,a.return,we)}}m&4&&a.stateNode!=null&&(T=a.memoizedProps,sf(a,T,u!==null?u.memoizedProps:T)),m&1024&&(qu=!0);break;case 6:if(Mr(o,a),ta(a),m&4){if(a.stateNode===null)throw Error(v(162));m=a.memoizedProps,u=a.stateNode;try{u.nodeValue=m}catch(we){ji(a,a.return,we)}}break;case 3:if(xf=null,T=Fa,Fa=Nf(o.containerInfo),Mr(o,a),Fa=T,ta(a),m&4&&u!==null&&u.memoizedState.isDehydrated)try{Sh(o.containerInfo)}catch(we){ji(a,a.return,we)}qu&&(qu=!1,lf(a));break;case 4:m=Fa,Fa=Nf(a.stateNode.containerInfo),Mr(o,a),ta(a),Fa=m;break;case 12:Mr(o,a),ta(a);break;case 13:Mr(o,a),ta(a),a.child.flags&8192&&a.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(th=as()),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,RE(a,m)));break;case 22:T=a.memoizedState!==null;var re=u!==null&&u.memoizedState!==null,Se=fs,Pe=un;if(fs=Se||T,un=Pe||re,Mr(o,a),un=Pe,fs=Se,ta(a),m&8192)e:for(o=a.stateNode,o._visibility=T?o._visibility&-2:o._visibility|1,T&&(u===null||re||fs||un||$c(a)),u=null,o=a;;){if(o.tag===5||o.tag===26){if(u===null){re=u=o;try{if(b=re.stateNode,T)F=b.style,typeof F.setProperty=="function"?F.setProperty("display","none","important"):F.display="none";else{Y=re.stateNode;var Be=re.memoizedProps.style,be=Be!=null&&Be.hasOwnProperty("display")?Be.display:null;Y.style.display=be==null||typeof be=="boolean"?"":(""+be).trim()}}catch(we){ji(re,re.return,we)}}}else if(o.tag===6){if(u===null){re=o;try{re.stateNode.nodeValue=T?"":re.memoizedProps}catch(we){ji(re,re.return,we)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===a)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break e;for(;o.sibling===null;){if(o.return===null||o.return===a)break e;u===o&&(u=null),o=o.return}u===o&&(u=null),o.sibling.return=o.return,o=o.sibling}m&4&&(m=a.updateQueue,m!==null&&(u=m.retryQueue,u!==null&&(m.retryQueue=null,RE(a,u))));break;case 19:Mr(o,a),ta(a),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,RE(a,m)));break;case 30:break;case 21:break;default:Mr(o,a),ta(a)}}function ta(a){var o=a.flags;if(o&2){try{for(var u,m=a.return;m!==null;){if(Av(m)){u=m;break}m=m.return}if(u==null)throw Error(v(160));switch(u.tag){case 27:var T=u.stateNode,b=TE(a);cf(a,b,T);break;case 5:var F=u.stateNode;u.flags&32&&(Oo(F,""),u.flags&=-33);var Y=TE(a);cf(a,Y,F);break;case 3:case 4:var re=u.stateNode.containerInfo,Se=TE(a);of(a,Se,re);break;default:throw Error(v(161))}}catch(Pe){ji(a,a.return,Pe)}a.flags&=-3}o&4096&&(a.flags&=-4097)}function lf(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var o=a;lf(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),a=a.sibling}}function yr(a,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)yE(a,o.alternate,o),o=o.sibling}function $c(a){for(a=a.child;a!==null;){var o=a;switch(o.tag){case 0:case 11:case 14:case 15:zo(4,o,o.return),$c(o);break;case 1:fa(o,o.return);var u=o.stateNode;typeof u.componentWillUnmount=="function"&&af(o,o.return,u),$c(o);break;case 27:lh(o.stateNode);case 26:case 5:fa(o,o.return),$c(o);break;case 22:o.memoizedState===null&&$c(o);break;case 30:$c(o);break;default:$c(o)}a=a.sibling}}function Ur(a,o,u){for(u=u&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var m=o.alternate,T=a,b=o,F=b.flags;switch(b.tag){case 0:case 11:case 15:Ur(T,b,u),pd(4,b);break;case 1:if(Ur(T,b,u),m=b,T=m.stateNode,typeof T.componentDidMount=="function")try{T.componentDidMount()}catch(Se){ji(m,m.return,Se)}if(m=b,T=m.updateQueue,T!==null){var Y=m.stateNode;try{var re=T.shared.hiddenCallbacks;if(re!==null)for(T.shared.hiddenCallbacks=null,T=0;T<re.length;T++)W_(re[T],Y)}catch(Se){ji(m,m.return,Se)}}u&&F&64&&Cv(b),Yu(b,b.return);break;case 27:wv(b);case 26:case 5:Ur(T,b,u),u&&m===null&&F&4&&bv(b),Yu(b,b.return);break;case 12:Ur(T,b,u);break;case 13:Ur(T,b,u),u&&F&4&&Ov(T,b);break;case 22:b.memoizedState===null&&Ur(T,b,u),Yu(b,b.return);break;case 30:break;default:Ur(T,b,u)}o=o.sibling}}function df(a,o){var u=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),a=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(a=o.memoizedState.cachePool.pool),a!==u&&(a!=null&&a.refCount++,u!=null&&Cu(u))}function Rr(a,o){a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&Cu(a))}function ms(a,o,u,m){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)Dv(a,o,u,m),o=o.sibling}function Dv(a,o,u,m){var T=o.flags;switch(o.tag){case 0:case 11:case 15:ms(a,o,u,m),T&2048&&pd(9,o);break;case 1:ms(a,o,u,m);break;case 3:ms(a,o,u,m),T&2048&&(a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&Cu(a)));break;case 12:if(T&2048){ms(a,o,u,m),a=o.stateNode;try{var b=o.memoizedProps,F=b.id,Y=b.onPostCommit;typeof Y=="function"&&Y(F,o.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(re){ji(o,o.return,re)}}else ms(a,o,u,m);break;case 13:ms(a,o,u,m);break;case 23:break;case 22:b=o.stateNode,F=o.alternate,o.memoizedState!==null?b._visibility&2?ms(a,o,u,m):Zu(a,o):b._visibility&2?ms(a,o,u,m):(b._visibility|=2,el(a,o,u,m,(o.subtreeFlags&10256)!==0)),T&2048&&df(F,o);break;case 24:ms(a,o,u,m),T&2048&&Rr(o.alternate,o);break;default:ms(a,o,u,m)}}function el(a,o,u,m,T){for(T=T&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var b=a,F=o,Y=u,re=m,Se=F.flags;switch(F.tag){case 0:case 11:case 15:el(b,F,Y,re,T),pd(8,F);break;case 23:break;case 22:var Pe=F.stateNode;F.memoizedState!==null?Pe._visibility&2?el(b,F,Y,re,T):Zu(b,F):(Pe._visibility|=2,el(b,F,Y,re,T)),T&&Se&2048&&df(F.alternate,F);break;case 24:el(b,F,Y,re,T),T&&Se&2048&&Rr(F.alternate,F);break;default:el(b,F,Y,re,T)}o=o.sibling}}function Zu(a,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var u=a,m=o,T=m.flags;switch(m.tag){case 22:Zu(u,m),T&2048&&df(m.alternate,m);break;case 24:Zu(u,m),T&2048&&Rr(m.alternate,m);break;default:Zu(u,m)}o=o.sibling}}var md=8192;function tl(a){if(a.subtreeFlags&md)for(a=a.child;a!==null;)Lv(a),a=a.sibling}function Lv(a){switch(a.tag){case 26:tl(a),a.flags&md&&a.memoizedState!==null&&Sb(Fa,a.memoizedState,a.memoizedProps);break;case 5:tl(a);break;case 3:case 4:var o=Fa;Fa=Nf(a.stateNode.containerInfo),tl(a),Fa=o;break;case 22:a.memoizedState===null&&(o=a.alternate,o!==null&&o.memoizedState!==null?(o=md,md=16777216,tl(a),md=o):tl(a));break;default:tl(a)}}function CE(a){var o=a.alternate;if(o!==null&&(a=o.child,a!==null)){o.child=null;do o=a.sibling,a.sibling=null,a=o;while(a!==null)}}function Qu(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var m=o[u];Kn=m,hf(m,a)}CE(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Pv(a),a=a.sibling}function Pv(a){switch(a.tag){case 0:case 11:case 15:Qu(a),a.flags&2048&&zo(9,a,a.return);break;case 3:Qu(a);break;case 12:Qu(a);break;case 22:var o=a.stateNode;a.memoizedState!==null&&o._visibility&2&&(a.return===null||a.return.tag!==13)?(o._visibility&=-3,uf(a)):Qu(a);break;default:Qu(a)}}function uf(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var m=o[u];Kn=m,hf(m,a)}CE(a)}for(a=a.child;a!==null;){switch(o=a,o.tag){case 0:case 11:case 15:zo(8,o,o.return),uf(o);break;case 22:u=o.stateNode,u._visibility&2&&(u._visibility&=-3,uf(o));break;default:uf(o)}a=a.sibling}}function hf(a,o){for(;Kn!==null;){var u=Kn;switch(u.tag){case 0:case 11:case 15:zo(8,u,o);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var m=u.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:Cu(u.memoizedState.cache)}if(m=u.child,m!==null)m.return=u,Kn=m;else e:for(u=a;Kn!==null;){m=Kn;var T=m.sibling,b=m.return;if(fd(m),m===u){Kn=null;break e}if(T!==null){T.return=b,Kn=T;break e}Kn=b}}}var bE={getCacheForType:function(a){var o=xn(Cn),u=o.data.get(a);return u===void 0&&(u=a(),o.data.set(a,u)),u}},YC=typeof WeakMap=="function"?WeakMap:Map,Ri=0,Wi=null,ni=null,hi=0,Ci=0,ir=null,Zs=!1,Ko=!1,$u=!1,_s=0,sn=0,Ga=0,Yo=0,AE=0,ma=0,il=0,_d=null,Un=null,eh=!1,th=0,Ed=1/0,ih=null,Qs=null,nr=0,qo=null,Ha=null,gd=0,pf=0,nh=null,xv=null,rh=0,wE=null;function ia(){if((Ri&2)!==0&&hi!==0)return hi&-hi;if(Le.T!==null){var a=Ql;return a!==0?a:Rd()}return F0()}function ff(){ma===0&&(ma=(hi&536870912)===0||yi?Zm():536870912);var a=kn.current;return a!==null&&(a.flags|=32),ma}function Vr(a,o,u){(a===Wi&&(Ci===2||Ci===9)||a.cancelPendingCommit!==null)&&(rl(a,0),Es(a,hi,ma,!1)),uu(a,u),((Ri&2)===0||a!==Wi)&&(a===Wi&&((Ri&2)===0&&(Yo|=u),sn===4&&Es(a,hi,ma,!1)),_a(a))}function IE(a,o,u){if((Ri&6)!==0)throw Error(v(327));var m=!u&&(o&124)===0&&(o&a.expiredLanes)===0||du(a,o),T=m?XC(a,o):NE(a,o,!0),b=m;do{if(T===0){Ko&&!m&&Es(a,o,0,!1);break}else{if(u=a.current.alternate,b&&!mf(u)){T=NE(a,o,!1),b=!1;continue}if(T===2){if(b=o,a.errorRecoveryDisabledLanes&b)var F=0;else F=a.pendingLanes&-536870913,F=F!==0?F:F&536870912?536870912:0;if(F!==0){o=F;e:{var Y=a;T=_d;var re=Y.current.memoizedState.isDehydrated;if(re&&(rl(Y,F).flags|=256),F=NE(Y,F,!1),F!==2){if($u&&!re){Y.errorRecoveryDisabledLanes|=b,Yo|=b,T=4;break e}b=Un,Un=T,b!==null&&(Un===null?Un=b:Un.push.apply(Un,b))}T=F}if(b=!1,T!==2)continue}}if(T===1){rl(a,0),Es(a,o,0,!0);break}e:{switch(m=a,b=T,b){case 0:case 1:throw Error(v(345));case 4:if((o&4194048)!==o)break;case 6:Es(m,o,ma,!Zs);break e;case 2:Un=null;break;case 3:case 5:break;default:throw Error(v(329))}if((o&62914560)===o&&(T=th+300-as(),10<T)){if(Es(m,o,ma,!Zs),dp(m,0,!0)!==0)break e;m.timeoutHandle=Hv(OE.bind(null,m,u,Un,ih,eh,o,ma,Yo,il,Zs,b,2,-0,0),T);break e}OE(m,u,Un,ih,eh,o,ma,Yo,il,Zs,b,0,-0,0)}}break}while(!0);_a(a)}function OE(a,o,u,m,T,b,F,Y,re,Se,Pe,Be,be,we){if(a.timeoutHandle=-1,Be=o.subtreeFlags,(Be&8192||(Be&16785408)===16785408)&&(uh={stylesheets:null,count:0,unsuspend:gb},Lv(o),Be=tT(),Be!==null)){a.cancelPendingCommit=Be(Mv.bind(null,a,o,b,u,m,T,F,Y,re,Pe,1,be,we)),Es(a,b,F,!Se);return}Mv(a,o,b,u,m,T,F,Y,re)}function mf(a){for(var o=a;;){var u=o.tag;if((u===0||u===11||u===15)&&o.flags&16384&&(u=o.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var m=0;m<u.length;m++){var T=u[m],b=T.getSnapshot;T=T.value;try{if(!Jr(b(),T))return!1}catch{return!1}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Es(a,o,u,m){o&=~AE,o&=~Yo,a.suspendedLanes|=o,a.pingedLanes&=~o,m&&(a.warmLanes|=o),m=a.expirationTimes;for(var T=o;0<T;){var b=31-vr(T),F=1<<b;m[b]=-1,T&=~F}u!==0&&xl(a,u,o)}function nl(){return(Ri&6)===0?(ah(0),!1):!0}function Sd(){if(ni!==null){if(Ci===0)var a=ni.return;else a=ni,Ys=Fc=null,q_(a),Jc=null,Va=0,a=ni;for(;a!==null;)Rv(a.alternate,a),a=a.return;ni=null}}function rl(a,o){var u=a.timeoutHandle;u!==-1&&(a.timeoutHandle=-1,rb(u)),u=a.cancelPendingCommit,u!==null&&(a.cancelPendingCommit=null,u()),Sd(),Wi=a,ni=u=zs(a.current,null),hi=o,Ci=0,ir=null,Zs=!1,Ko=du(a,o),$u=!1,il=ma=AE=Yo=Ga=sn=0,Un=_d=null,eh=!1,(o&8)!==0&&(o|=o&32);var m=a.entangledLanes;if(m!==0)for(a=a.entanglements,m&=o;0<m;){var T=31-vr(m),b=1<<T;o|=a[T],m&=~b}return _s=o,kc(),u}function al(a,o){qt=null,Le.H=ea,o===Hc||o===Mp?(o=US(),Ci=3):o===xS?(o=US(),Ci=4):Ci=o===mv?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,ir=o,ni===null&&(sn=1,$p(a,Zr(o,a.current)))}function Xo(){var a=Le.H;return Le.H=ea,a===null?ea:a}function kv(){var a=Le.A;return Le.A=bE,a}function sl(){sn=4,Zs||(hi&4194048)!==hi&&kn.current!==null||(Ko=!0),(Ga&134217727)===0&&(Yo&134217727)===0||Wi===null||Es(Wi,hi,ma,!1)}function NE(a,o,u){var m=Ri;Ri|=2;var T=Xo(),b=kv();(Wi!==a||hi!==o)&&(ih=null,rl(a,o)),o=!1;var F=sn;e:do try{if(Ci!==0&&ni!==null){var Y=ni,re=ir;switch(Ci){case 8:Sd(),F=6;break e;case 3:case 2:case 9:case 6:kn.current===null&&(o=!0);var Se=Ci;if(Ci=0,ir=null,ol(a,Y,re,Se),u&&Ko){F=0;break e}break;default:Se=Ci,Ci=0,ir=null,ol(a,Y,re,Se)}}qC(),F=sn;break}catch(Pe){al(a,Pe)}while(!0);return o&&a.shellSuspendCounter++,Ys=Fc=null,Ri=m,Le.H=T,Le.A=b,ni===null&&(Wi=null,hi=0,kc()),F}function qC(){for(;ni!==null;)DE(ni)}function XC(a,o){var u=Ri;Ri|=2;var m=Xo(),T=kv();Wi!==a||hi!==o?(ih=null,Ed=as()+500,rl(a,o)):Ko=du(a,o);e:do try{if(Ci!==0&&ni!==null){o=ni;var b=ir;t:switch(Ci){case 1:Ci=0,ir=null,ol(a,o,b,1);break;case 2:case 9:if(kS(b)){Ci=0,ir=null,_f(o);break}o=function(){Ci!==2&&Ci!==9||Wi!==a||(Ci=7),_a(a)},b.then(o,o);break e;case 3:Ci=7;break e;case 4:Ci=5;break e;case 7:kS(b)?(Ci=0,ir=null,_f(o)):(Ci=0,ir=null,ol(a,o,b,7));break;case 5:var F=null;switch(ni.tag){case 26:F=ni.memoizedState;case 5:case 27:var Y=ni;if(!F||eT(F)){Ci=0,ir=null;var re=Y.sibling;if(re!==null)ni=re;else{var Se=Y.return;Se!==null?(ni=Se,Ef(Se)):ni=null}break t}}Ci=0,ir=null,ol(a,o,b,5);break;case 6:Ci=0,ir=null,ol(a,o,b,6);break;case 8:Sd(),sn=6;break e;default:throw Error(v(462))}}JC();break}catch(Pe){al(a,Pe)}while(!0);return Ys=Fc=null,Le.H=m,Le.A=T,Ri=u,ni!==null?0:(Wi=null,hi=0,kc(),sn)}function JC(){for(;ni!==null&&!iC();)DE(ni)}function DE(a){var o=zu(a.alternate,a,_s);a.memoizedProps=a.pendingProps,o===null?Ef(a):ni=o}function _f(a){var o=a,u=o.alternate;switch(o.tag){case 15:case 0:o=mE(u,o,o.pendingProps,o.type,void 0,hi);break;case 11:o=mE(u,o,o.pendingProps,o.type.render,o.ref,hi);break;case 5:q_(o);default:Rv(u,o),o=ni=Ip(o,_s),o=zu(u,o,_s)}a.memoizedProps=a.pendingProps,o===null?Ef(a):ni=o}function ol(a,o,u,m){Ys=Fc=null,q_(o),Jc=null,Va=0;var T=o.return;try{if(GC(a,T,o,u,hi)){sn=1,$p(a,Zr(u,a.current)),ni=null;return}}catch(b){if(T!==null)throw ni=T,b;sn=1,$p(a,Zr(u,a.current)),ni=null;return}o.flags&32768?(yi||m===1?a=!0:Ko||(hi&536870912)!==0?a=!1:(Zs=a=!0,(m===2||m===9||m===3||m===6)&&(m=kn.current,m!==null&&m.tag===13&&(m.flags|=16384))),LE(o,a)):Ef(o)}function Ef(a){var o=a;do{if((o.flags&32768)!==0){LE(o,Zs);return}a=o.return;var u=WC(o.alternate,o,_s);if(u!==null){ni=u;return}if(o=o.sibling,o!==null){ni=o;return}ni=o=a}while(o!==null);sn===0&&(sn=5)}function LE(a,o){do{var u=zC(a.alternate,a);if(u!==null){u.flags&=32767,ni=u;return}if(u=a.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!o&&(a=a.sibling,a!==null)){ni=a;return}ni=a=u}while(a!==null);sn=6,ni=null}function Mv(a,o,u,m,T,b,F,Y,re){a.cancelPendingCommit=null;do gf();while(nr!==0);if((Ri&6)!==0)throw Error(v(327));if(o!==null){if(o===a.current)throw Error(v(177));if(b=o.lanes|o.childLanes,b|=O_,rC(a,u,b,F,Y,re),a===Wi&&(ni=Wi=null,hi=0),Ha=o,qo=a,gd=u,pf=b,nh=T,xv=m,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,$C(Dl,function(){return Sf(),null})):(a.callbackNode=null,a.callbackPriority=0),m=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||m){m=Le.T,Le.T=null,T=ze.p,ze.p=2,F=Ri,Ri|=4;try{Xu(a,o,u)}finally{Ri=F,ze.p=T,Le.T=m}}nr=1,vd(),Wa(),PE()}}function vd(){if(nr===1){nr=0;var a=qo,o=Ha,u=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||u){u=Le.T,Le.T=null;var m=ze.p;ze.p=2;var T=Ri;Ri|=4;try{Nv(o,a);var b=Id,F=Hs(a.containerInfo),Y=b.focusedElem,re=b.selectionRange;if(F!==Y&&Y&&Y.ownerDocument&&TS(Y.ownerDocument.documentElement,Y)){if(re!==null&&y_(Y)){var Se=re.start,Pe=re.end;if(Pe===void 0&&(Pe=Se),"selectionStart"in Y)Y.selectionStart=Se,Y.selectionEnd=Math.min(Pe,Y.value.length);else{var Be=Y.ownerDocument||document,be=Be&&Be.defaultView||window;if(be.getSelection){var we=be.getSelection(),xt=Y.textContent.length,bt=Math.min(re.start,xt),Mi=re.end===void 0?bt:Math.min(re.end,xt);!we.extend&&bt>Mi&&(F=Mi,Mi=bt,bt=F);var _e=vS(Y,bt),he=vS(Y,Mi);if(_e&&he&&(we.rangeCount!==1||we.anchorNode!==_e.node||we.anchorOffset!==_e.offset||we.focusNode!==he.node||we.focusOffset!==he.offset)){var ve=Be.createRange();ve.setStart(_e.node,_e.offset),we.removeAllRanges(),bt>Mi?(we.addRange(ve),we.extend(he.node,he.offset)):(ve.setEnd(he.node,he.offset),we.addRange(ve))}}}}for(Be=[],we=Y;we=we.parentNode;)we.nodeType===1&&Be.push({element:we,left:we.scrollLeft,top:we.scrollTop});for(typeof Y.focus=="function"&&Y.focus(),Y=0;Y<Be.length;Y++){var Ve=Be[Y];Ve.element.scrollLeft=Ve.left,Ve.element.scrollTop=Ve.top}}Mf=!!XE,Id=XE=null}finally{Ri=T,ze.p=m,Le.T=u}}a.current=o,nr=2}}function Wa(){if(nr===2){nr=0;var a=qo,o=Ha,u=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||u){u=Le.T,Le.T=null;var m=ze.p;ze.p=2;var T=Ri;Ri|=4;try{yE(a,o.alternate,o)}finally{Ri=T,ze.p=m,Le.T=u}}nr=3}}function PE(){if(nr===4||nr===3){nr=0,bo();var a=qo,o=Ha,u=gd,m=xv;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?nr=5:(nr=0,Ha=qo=null,Uv(a,a.pendingLanes));var T=a.pendingLanes;if(T===0&&(Qs=null),$m(u),o=o.stateNode,mn&&typeof mn.onCommitFiberRoot=="function")try{mn.onCommitFiberRoot(Ll,o,void 0,(o.current.flags&128)===128)}catch{}if(m!==null){o=Le.T,T=ze.p,ze.p=2,Le.T=null;try{for(var b=a.onRecoverableError,F=0;F<m.length;F++){var Y=m[F];b(Y.value,{componentStack:Y.stack})}}finally{Le.T=o,ze.p=T}}(gd&3)!==0&&gf(),_a(a),T=a.pendingLanes,(u&4194090)!==0&&(T&42)!==0?a===wE?rh++:(rh=0,wE=a):rh=0,ah(0)}}function Uv(a,o){(a.pooledCacheLanes&=o)===0&&(o=a.pooledCache,o!=null&&(a.pooledCache=null,Cu(o)))}function gf(a){return vd(),Wa(),PE(),Sf()}function Sf(){if(nr!==5)return!1;var a=qo,o=pf;pf=0;var u=$m(gd),m=Le.T,T=ze.p;try{ze.p=32>u?32:u,Le.T=null,u=nh,nh=null;var b=qo,F=gd;if(nr=0,Ha=qo=null,gd=0,(Ri&6)!==0)throw Error(v(331));var Y=Ri;if(Ri|=4,Pv(b.current),Dv(b,b.current,F,u),Ri=Y,ah(0,!1),mn&&typeof mn.onPostCommitFiberRoot=="function")try{mn.onPostCommitFiberRoot(Ll,b)}catch{}return!0}finally{ze.p=T,Le.T=m,Uv(a,o)}}function xE(a,o,u){o=Zr(u,o),o=ja(a.stateNode,o,2),a=Xs(a,o,2),a!==null&&(uu(a,2),_a(a))}function ji(a,o,u){if(a.tag===3)xE(a,a,u);else for(;o!==null;){if(o.tag===3){xE(o,a,u);break}else if(o.tag===1){var m=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(Qs===null||!Qs.has(m))){a=Zr(u,a),u=pv(2),m=Xs(o,u,2),m!==null&&(fv(u,m,o,a),uu(m,2),_a(m));break}}o=o.return}}function Td(a,o,u){var m=a.pingCache;if(m===null){m=a.pingCache=new YC;var T=new Set;m.set(o,T)}else T=m.get(o),T===void 0&&(T=new Set,m.set(o,T));T.has(u)||($u=!0,T.add(u),a=Jo.bind(null,a,o,u),o.then(a,a))}function Jo(a,o,u){var m=a.pingCache;m!==null&&m.delete(o),a.pingedLanes|=a.suspendedLanes&u,a.warmLanes&=~u,Wi===a&&(hi&u)===u&&(sn===4||sn===3&&(hi&62914560)===hi&&300>as()-th?(Ri&2)===0&&rl(a,0):AE|=u,il===hi&&(il=0)),_a(a)}function yd(a,o){o===0&&(o=j0()),a=ql(a,o),a!==null&&(uu(a,o),_a(a))}function ZC(a){var o=a.memoizedState,u=0;o!==null&&(u=o.retryLane),yd(a,u)}function QC(a,o){var u=0;switch(a.tag){case 13:var m=a.stateNode,T=a.memoizedState;T!==null&&(u=T.retryLane);break;case 19:m=a.stateNode;break;case 22:m=a.stateNode._retryCache;break;default:throw Error(v(314))}m!==null&&m.delete(o),yd(a,u)}function $C(a,o){return Vs(a,o)}var vf=null,Zo=null,kE=!1,Tf=!1,ME=!1,Qo=0;function _a(a){a!==Zo&&a.next===null&&(Zo===null?vf=Zo=a:Zo=Zo.next=a),Tf=!0,kE||(kE=!0,jv())}function ah(a,o){if(!ME&&Tf){ME=!0;do for(var u=!1,m=vf;m!==null;){if(a!==0){var T=m.pendingLanes;if(T===0)var b=0;else{var F=m.suspendedLanes,Y=m.pingedLanes;b=(1<<31-vr(42|a)+1)-1,b&=T&~(F&~Y),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(u=!0,VE(m,b))}else b=hi,b=dp(m,m===Wi?b:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(b&3)===0||du(m,b)||(u=!0,VE(m,b));m=m.next}while(u);ME=!1}}function eb(){Vv()}function Vv(){Tf=kE=!1;var a=0;Qo!==0&&(nb()&&(a=Qo),Qo=0);for(var o=as(),u=null,m=vf;m!==null;){var T=m.next,b=UE(m,o);b===0?(m.next=null,u===null?vf=T:u.next=T,T===null&&(Zo=u)):(u=m,(a!==0||(b&3)!==0)&&(Tf=!0)),m=T}ah(a)}function UE(a,o){for(var u=a.suspendedLanes,m=a.pingedLanes,T=a.expirationTimes,b=a.pendingLanes&-62914561;0<b;){var F=31-vr(b),Y=1<<F,re=T[F];re===-1?((Y&u)===0||(Y&m)!==0)&&(T[F]=Pl(Y,o)):re<=o&&(a.expiredLanes|=Y),b&=~Y}if(o=Wi,u=hi,u=dp(a,a===o?u:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m=a.callbackNode,u===0||a===o&&(Ci===2||Ci===9)||a.cancelPendingCommit!==null)return m!==null&&m!==null&&Xm(m),a.callbackNode=null,a.callbackPriority=0;if((u&3)===0||du(a,u)){if(o=u&-u,o===a.callbackPriority)return o;switch(m!==null&&Xm(m),$m(u)){case 2:case 8:u=lp;break;case 32:u=Dl;break;case 268435456:u=Jm;break;default:u=Dl}return m=yf.bind(null,a),u=Vs(u,m),a.callbackPriority=o,a.callbackNode=u,o}return m!==null&&m!==null&&Xm(m),a.callbackPriority=2,a.callbackNode=null,2}function yf(a,o){if(nr!==0&&nr!==5)return a.callbackNode=null,a.callbackPriority=0,null;var u=a.callbackNode;if(gf()&&a.callbackNode!==u)return null;var m=hi;return m=dp(a,a===Wi?m:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m===0?null:(IE(a,m,o),UE(a,as()),a.callbackNode!=null&&a.callbackNode===u?yf.bind(null,a):null)}function VE(a,o){if(gf())return null;IE(a,o,!0)}function jv(){ab(function(){(Ri&6)!==0?Vs(Dr,eb):Vv()})}function Rd(){return Qo===0&&(Qo=Zm()),Qo}function jE(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Sp(""+a)}function Bv(a,o){var u=o.ownerDocument.createElement("input");return u.name=o.name,u.value=o.value,a.id&&u.setAttribute("form",a.id),o.parentNode.insertBefore(u,o),a=new FormData(a),u.parentNode.removeChild(u),a}function BE(a,o,u,m,T){if(o==="submit"&&u&&u.stateNode===T){var b=jE((T[Lr]||null).action),F=m.submitter;F&&(o=(o=F[Lr]||null)?jE(o.formAction):F.getAttribute("formAction"),o!==null&&(b=o,F=null));var Y=new xa("action","action",null,m,T);a.push({event:Y,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(Qo!==0){var re=F?Bv(T,F):new FormData(T);od(u,{pending:!0,data:re,method:T.method,action:b},null,re)}}else typeof b=="function"&&(Y.preventDefault(),re=F?Bv(T,F):new FormData(T),od(u,{pending:!0,data:re,method:T.method,action:b},b,re))},currentTarget:T}]})}}for(var FE=0;FE<w_.length;FE++){var GE=w_[FE],sh=GE.toLowerCase(),HE=GE[0].toUpperCase()+GE.slice(1);ka(sh,"on"+HE)}ka(CS,"onAnimationEnd"),ka(bS,"onAnimationIteration"),ka(wp,"onAnimationStart"),ka("dblclick","onDoubleClick"),ka("focusin","onFocus"),ka("focusout","onBlur"),ka(A_,"onTransitionRun"),ka(LC,"onTransitionStart"),ka(Ce,"onTransitionCancel"),ka(AS,"onTransitionEnd"),Vl("onMouseEnter",["mouseout","mouseover"]),Vl("onMouseLeave",["mouseout","mouseover"]),Vl("onPointerEnter",["pointerout","pointerover"]),Vl("onPointerLeave",["pointerout","pointerover"]),la("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),la("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),la("onBeforeInput",["compositionend","keypress","textInput","paste"]),la("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),la("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),la("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Cd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),WE=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Cd));function Rf(a,o){o=(o&4)!==0;for(var u=0;u<a.length;u++){var m=a[u],T=m.event;m=m.listeners;e:{var b=void 0;if(o)for(var F=m.length-1;0<=F;F--){var Y=m[F],re=Y.instance,Se=Y.currentTarget;if(Y=Y.listener,re!==b&&T.isPropagationStopped())break e;b=Y,T.currentTarget=Se;try{b(T)}catch(Pe){Qp(Pe)}T.currentTarget=null,b=re}else for(F=0;F<m.length;F++){if(Y=m[F],re=Y.instance,Se=Y.currentTarget,Y=Y.listener,re!==b&&T.isPropagationStopped())break e;b=Y,T.currentTarget=Se;try{b(T)}catch(Pe){Qp(Pe)}T.currentTarget=null,b=re}}}}function Qt(a,o){var u=o[up];u===void 0&&(u=o[up]=new Set);var m=a+"__bubble";u.has(m)||(KE(o,a,2,!1),u.add(m))}function zE(a,o,u){var m=0;o&&(m|=4),KE(u,a,m,o)}var Cf="_reactListening"+Math.random().toString(36).slice(2);function bf(a){if(!a[Cf]){a[Cf]=!0,pp.forEach(function(u){u!=="selectionchange"&&(WE.has(u)||zE(u,!1,a),zE(u,!0,a))});var o=a.nodeType===9?a:a.ownerDocument;o===null||o[Cf]||(o[Cf]=!0,zE("selectionchange",!1,o))}}function KE(a,o,u,m){switch(sT(o)){case 2:var T=Tb;break;case 8:T=yb;break;default:T=Uf}u=T.bind(null,o,u,a),T=void 0,!l_||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(T=!0),m?T!==void 0?a.addEventListener(o,u,{capture:!0,passive:T}):a.addEventListener(o,u,!0):T!==void 0?a.addEventListener(o,u,{passive:T}):a.addEventListener(o,u,!1)}function Af(a,o,u,m,T){var b=m;if((o&1)===0&&(o&2)===0&&m!==null)e:for(;;){if(m===null)return;var F=m.tag;if(F===3||F===4){var Y=m.stateNode.containerInfo;if(Y===T)break;if(F===4)for(F=m.return;F!==null;){var re=F.tag;if((re===3||re===4)&&F.stateNode.containerInfo===T)return;F=F.return}for(;Y!==null;){if(F=Ml(Y),F===null)return;if(re=F.tag,re===5||re===6||re===26||re===27){m=b=F;continue e}Y=Y.parentNode}}m=m.return}iS(function(){var Se=b,Pe=o_(u),Be=[];e:{var be=wS.get(a);if(be!==void 0){var we=xa,xt=a;switch(a){case"keypress":if(Tp(u)===0)break e;case"keydown":case"keyup":we=EC;break;case"focusin":xt="focus",we=Rp;break;case"focusout":xt="blur",we=Rp;break;case"beforeblur":case"afterblur":we=Rp;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":we=sS;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":we=uC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":we=SC;break;case CS:case bS:case wp:we=p_;break;case AS:we=cS;break;case"scroll":case"scrollend":we=aS;break;case"wheel":we=Ft;break;case"copy":case"cut":case"paste":we=f_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":we=oS;break;case"toggle":case"beforetoggle":we=yC}var bt=(o&4)!==0,Mi=!bt&&(a==="scroll"||a==="scrollend"),_e=bt?be!==null?be+"Capture":null:be;bt=[];for(var he=Se,ve;he!==null;){var Ve=he;if(ve=Ve.stateNode,Ve=Ve.tag,Ve!==5&&Ve!==26&&Ve!==27||ve===null||_e===null||(Ve=Gl(he,_e),Ve!=null&&bt.push(bd(he,Ve,ve))),Mi)break;he=he.return}0<bt.length&&(be=new we(be,xt,null,u,Pe),Be.push({event:be,listeners:bt}))}}if((o&7)===0){e:{if(be=a==="mouseover"||a==="pointerover",we=a==="mouseout"||a==="pointerout",be&&u!==s_&&(xt=u.relatedTarget||u.fromElement)&&(Ml(xt)||xt[Bs]))break e;if((we||be)&&(be=Pe.window===Pe?Pe:(be=Pe.ownerDocument)?be.defaultView||be.parentWindow:window,we?(xt=u.relatedTarget||u.toElement,we=Se,xt=xt?Ml(xt):null,xt!==null&&(Mi=w(xt),bt=xt.tag,xt!==Mi||bt!==5&&bt!==27&&bt!==6)&&(xt=null)):(we=null,xt=Se),we!==xt)){if(bt=sS,Ve="onMouseLeave",_e="onMouseEnter",he="mouse",(a==="pointerout"||a==="pointerover")&&(bt=oS,Ve="onPointerLeave",_e="onPointerEnter",he="pointer"),Mi=we==null?be:hu(we),ve=xt==null?be:hu(xt),be=new bt(Ve,he+"leave",we,u,Pe),be.target=Mi,be.relatedTarget=ve,Ve=null,Ml(Pe)===Se&&(bt=new bt(_e,he+"enter",xt,u,Pe),bt.target=ve,bt.relatedTarget=Mi,Ve=bt),Mi=Ve,we&&xt)t:{for(bt=we,_e=xt,he=0,ve=bt;ve;ve=Ad(ve))he++;for(ve=0,Ve=_e;Ve;Ve=Ad(Ve))ve++;for(;0<he-ve;)bt=Ad(bt),he--;for(;0<ve-he;)_e=Ad(_e),ve--;for(;he--;){if(bt===_e||_e!==null&&bt===_e.alternate)break t;bt=Ad(bt),_e=Ad(_e)}bt=null}else bt=null;we!==null&&YE(Be,be,we,bt,!1),xt!==null&&Mi!==null&&YE(Be,Mi,xt,bt,!0)}}e:{if(be=Se?hu(Se):window,we=be.nodeName&&be.nodeName.toLowerCase(),we==="select"||we==="input"&&be.type==="file")var lt=mS;else if(pS(be))if(Xr)lt=T_;else{lt=OC;var ri=IC}else we=be.nodeName,!we||we.toLowerCase()!=="input"||be.type!=="checkbox"&&be.type!=="radio"?Se&&pu(Se.elementType)&&(lt=mS):lt=gS;if(lt&&(lt=lt(a,Se))){fS(Be,lt,u,Pe);break e}ri&&ri(a,be,Se),a==="focusout"&&Se&&be.type==="number"&&Se.memoizedProps.value!=null&&a_(be,"number",be.value)}switch(ri=Se?hu(Se):window,a){case"focusin":(pS(ri)||ri.contentEditable==="true")&&(Pn=ri,R_=Se,gu=null);break;case"focusout":gu=R_=Pn=null;break;case"mousedown":C_=!0;break;case"contextmenu":case"mouseup":case"dragend":C_=!1,yS(Be,u,Pe);break;case"selectionchange":if(DC)break;case"keydown":case"keyup":yS(Be,u,Pe)}var gt;if(E_)e:{switch(a){case"compositionstart":var Nt="onCompositionStart";break e;case"compositionend":Nt="onCompositionEnd";break e;case"compositionupdate":Nt="onCompositionUpdate";break e}Nt=void 0}else Pc?uS(a,u)&&(Nt="onCompositionEnd"):a==="keydown"&&u.keyCode===229&&(Nt="onCompositionStart");Nt&&(lS&&u.locale!=="ko"&&(Pc||Nt!=="onCompositionStart"?Nt==="onCompositionEnd"&&Pc&&(gt=nS()):(ua=Pe,d_="value"in ua?ua.value:ua.textContent,Pc=!0)),ri=oh(Se,Nt),0<ri.length&&(Nt=new Cp(Nt,a,null,u,Pe),Be.push({event:Nt,listeners:ri}),gt?Nt.data=gt:(gt=hS(u),gt!==null&&(Nt.data=gt)))),(gt=CC?bC(a,u):No(a,u))&&(Nt=oh(Se,"onBeforeInput"),0<Nt.length&&(ri=new Cp("onBeforeInput","beforeinput",null,u,Pe),Be.push({event:ri,listeners:Nt}),ri.data=gt)),BE(Be,a,Se,u,Pe)}Rf(Be,o)})}function bd(a,o,u){return{instance:a,listener:o,currentTarget:u}}function oh(a,o){for(var u=o+"Capture",m=[];a!==null;){var T=a,b=T.stateNode;if(T=T.tag,T!==5&&T!==26&&T!==27||b===null||(T=Gl(a,u),T!=null&&m.unshift(bd(a,T,b)),T=Gl(a,o),T!=null&&m.push(bd(a,T,b))),a.tag===3)return m;a=a.return}return[]}function Ad(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function YE(a,o,u,m,T){for(var b=o._reactName,F=[];u!==null&&u!==m;){var Y=u,re=Y.alternate,Se=Y.stateNode;if(Y=Y.tag,re!==null&&re===m)break;Y!==5&&Y!==26&&Y!==27||Se===null||(re=Se,T?(Se=Gl(u,b),Se!=null&&F.unshift(bd(u,Se,re))):T||(Se=Gl(u,b),Se!=null&&F.push(bd(u,Se,re)))),u=u.return}F.length!==0&&a.push({event:o,listeners:F})}var tb=/\r\n?/g,wd=/\u0000|\uFFFD/g;function cl(a){return(typeof a=="string"?a:""+a).replace(tb,`
`).replace(wd,"")}function wf(a,o){return o=cl(o),cl(a)===o}function ch(){}function Di(a,o,u,m,T,b){switch(u){case"children":typeof m=="string"?o==="body"||o==="textarea"&&m===""||Oo(a,m):(typeof m=="number"||typeof m=="bigint")&&o!=="body"&&Oo(a,""+m);break;case"className":fp(a,"class",m);break;case"tabIndex":fp(a,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":fp(a,u,m);break;case"style":$0(a,m,b);break;case"data":if(o!=="object"){fp(a,"data",m);break}case"src":case"href":if(m===""&&(o!=="a"||u!=="href")){a.removeAttribute(u);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(u);break}m=Sp(""+m),a.setAttribute(u,m);break;case"action":case"formAction":if(typeof m=="function"){a.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(u==="formAction"?(o!=="input"&&Di(a,o,"name",T.name,T,null),Di(a,o,"formEncType",T.formEncType,T,null),Di(a,o,"formMethod",T.formMethod,T,null),Di(a,o,"formTarget",T.formTarget,T,null)):(Di(a,o,"encType",T.encType,T,null),Di(a,o,"method",T.method,T,null),Di(a,o,"target",T.target,T,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(u);break}m=Sp(""+m),a.setAttribute(u,m);break;case"onClick":m!=null&&(a.onclick=ch);break;case"onScroll":m!=null&&Qt("scroll",a);break;case"onScrollEnd":m!=null&&Qt("scrollend",a);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(v(61));if(u=m.__html,u!=null){if(T.children!=null)throw Error(v(60));a.innerHTML=u}}break;case"multiple":a.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":a.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){a.removeAttribute("xlink:href");break}u=Sp(""+m),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(u,""+m):a.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(u,""):a.removeAttribute(u);break;case"capture":case"download":m===!0?a.setAttribute(u,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(u,m):a.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?a.setAttribute(u,m):a.removeAttribute(u);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?a.removeAttribute(u):a.setAttribute(u,m);break;case"popover":Qt("beforetoggle",a),Qt("toggle",a),an(a,"popover",m);break;case"xlinkActuate":Fs(a,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":Fs(a,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":Fs(a,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":Fs(a,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":Fs(a,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":Fs(a,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":Fs(a,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":Fs(a,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":Fs(a,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":an(a,"is",m);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=lC.get(u)||u,an(a,u,m))}}function qE(a,o,u,m,T,b){switch(u){case"style":$0(a,m,b);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(v(61));if(u=m.__html,u!=null){if(T.children!=null)throw Error(v(60));a.innerHTML=u}}break;case"children":typeof m=="string"?Oo(a,m):(typeof m=="number"||typeof m=="bigint")&&Oo(a,""+m);break;case"onScroll":m!=null&&Qt("scroll",a);break;case"onScrollEnd":m!=null&&Qt("scrollend",a);break;case"onClick":m!=null&&(a.onclick=ch);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!e_.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(T=u.endsWith("Capture"),o=u.slice(2,T?u.length-7:void 0),b=a[Lr]||null,b=b!=null?b[u]:null,typeof b=="function"&&a.removeEventListener(o,b,T),typeof m=="function")){typeof b!="function"&&b!==null&&(u in a?a[u]=null:a.hasAttribute(u)&&a.removeAttribute(u)),a.addEventListener(o,m,T);break e}u in a?a[u]=m:m===!0?a.setAttribute(u,""):an(a,u,m)}}}function Yn(a,o,u){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Qt("error",a),Qt("load",a);var m=!1,T=!1,b;for(b in u)if(u.hasOwnProperty(b)){var F=u[b];if(F!=null)switch(b){case"src":m=!0;break;case"srcSet":T=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(v(137,o));default:Di(a,o,b,F,u,null)}}T&&Di(a,o,"srcSet",u.srcSet,u,null),m&&Di(a,o,"src",u.src,u,null);return;case"input":Qt("invalid",a);var Y=b=F=T=null,re=null,Se=null;for(m in u)if(u.hasOwnProperty(m)){var Pe=u[m];if(Pe!=null)switch(m){case"name":T=Pe;break;case"type":F=Pe;break;case"checked":re=Pe;break;case"defaultChecked":Se=Pe;break;case"value":b=Pe;break;case"defaultValue":Y=Pe;break;case"children":case"dangerouslySetInnerHTML":if(Pe!=null)throw Error(v(137,o));break;default:Di(a,o,m,Pe,u,null)}}X0(a,b,Y,re,Se,F,T,!1),_p(a);return;case"select":Qt("invalid",a),m=F=b=null;for(T in u)if(u.hasOwnProperty(T)&&(Y=u[T],Y!=null))switch(T){case"value":b=Y;break;case"defaultValue":F=Y;break;case"multiple":m=Y;default:Di(a,o,T,Y,u,null)}o=b,u=F,a.multiple=!!m,o!=null?jl(a,!!m,o,!1):u!=null&&jl(a,!!m,u,!0);return;case"textarea":Qt("invalid",a),b=T=m=null;for(F in u)if(u.hasOwnProperty(F)&&(Y=u[F],Y!=null))switch(F){case"value":m=Y;break;case"defaultValue":T=Y;break;case"children":b=Y;break;case"dangerouslySetInnerHTML":if(Y!=null)throw Error(v(91));break;default:Di(a,o,F,Y,u,null)}Z0(a,m,T,b),_p(a);return;case"option":for(re in u)if(u.hasOwnProperty(re)&&(m=u[re],m!=null))switch(re){case"selected":a.selected=m&&typeof m!="function"&&typeof m!="symbol";break;default:Di(a,o,re,m,u,null)}return;case"dialog":Qt("beforetoggle",a),Qt("toggle",a),Qt("cancel",a),Qt("close",a);break;case"iframe":case"object":Qt("load",a);break;case"video":case"audio":for(m=0;m<Cd.length;m++)Qt(Cd[m],a);break;case"image":Qt("error",a),Qt("load",a);break;case"details":Qt("toggle",a);break;case"embed":case"source":case"link":Qt("error",a),Qt("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Se in u)if(u.hasOwnProperty(Se)&&(m=u[Se],m!=null))switch(Se){case"children":case"dangerouslySetInnerHTML":throw Error(v(137,o));default:Di(a,o,Se,m,u,null)}return;default:if(pu(o)){for(Pe in u)u.hasOwnProperty(Pe)&&(m=u[Pe],m!==void 0&&qE(a,o,Pe,m,u,void 0));return}}for(Y in u)u.hasOwnProperty(Y)&&(m=u[Y],m!=null&&Di(a,o,Y,m,u,null))}function ib(a,o,u,m){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var T=null,b=null,F=null,Y=null,re=null,Se=null,Pe=null;for(we in u){var Be=u[we];if(u.hasOwnProperty(we)&&Be!=null)switch(we){case"checked":break;case"value":break;case"defaultValue":re=Be;default:m.hasOwnProperty(we)||Di(a,o,we,null,m,Be)}}for(var be in m){var we=m[be];if(Be=u[be],m.hasOwnProperty(be)&&(we!=null||Be!=null))switch(be){case"type":b=we;break;case"name":T=we;break;case"checked":Se=we;break;case"defaultChecked":Pe=we;break;case"value":F=we;break;case"defaultValue":Y=we;break;case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(v(137,o));break;default:we!==Be&&Di(a,o,be,we,m,Be)}}r_(a,F,Y,re,Se,Pe,b,T);return;case"select":we=F=Y=be=null;for(b in u)if(re=u[b],u.hasOwnProperty(b)&&re!=null)switch(b){case"value":break;case"multiple":we=re;default:m.hasOwnProperty(b)||Di(a,o,b,null,m,re)}for(T in m)if(b=m[T],re=u[T],m.hasOwnProperty(T)&&(b!=null||re!=null))switch(T){case"value":be=b;break;case"defaultValue":Y=b;break;case"multiple":F=b;default:b!==re&&Di(a,o,T,b,m,re)}o=Y,u=F,m=we,be!=null?jl(a,!!u,be,!1):!!m!=!!u&&(o!=null?jl(a,!!u,o,!0):jl(a,!!u,u?[]:"",!1));return;case"textarea":we=be=null;for(Y in u)if(T=u[Y],u.hasOwnProperty(Y)&&T!=null&&!m.hasOwnProperty(Y))switch(Y){case"value":break;case"children":break;default:Di(a,o,Y,null,m,T)}for(F in m)if(T=m[F],b=u[F],m.hasOwnProperty(F)&&(T!=null||b!=null))switch(F){case"value":be=T;break;case"defaultValue":we=T;break;case"children":break;case"dangerouslySetInnerHTML":if(T!=null)throw Error(v(91));break;default:T!==b&&Di(a,o,F,T,m,b)}J0(a,be,we);return;case"option":for(var xt in u)if(be=u[xt],u.hasOwnProperty(xt)&&be!=null&&!m.hasOwnProperty(xt))switch(xt){case"selected":a.selected=!1;break;default:Di(a,o,xt,null,m,be)}for(re in m)if(be=m[re],we=u[re],m.hasOwnProperty(re)&&be!==we&&(be!=null||we!=null))switch(re){case"selected":a.selected=be&&typeof be!="function"&&typeof be!="symbol";break;default:Di(a,o,re,be,m,we)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var bt in u)be=u[bt],u.hasOwnProperty(bt)&&be!=null&&!m.hasOwnProperty(bt)&&Di(a,o,bt,null,m,be);for(Se in m)if(be=m[Se],we=u[Se],m.hasOwnProperty(Se)&&be!==we&&(be!=null||we!=null))switch(Se){case"children":case"dangerouslySetInnerHTML":if(be!=null)throw Error(v(137,o));break;default:Di(a,o,Se,be,m,we)}return;default:if(pu(o)){for(var Mi in u)be=u[Mi],u.hasOwnProperty(Mi)&&be!==void 0&&!m.hasOwnProperty(Mi)&&qE(a,o,Mi,void 0,m,be);for(Pe in m)be=m[Pe],we=u[Pe],!m.hasOwnProperty(Pe)||be===we||be===void 0&&we===void 0||qE(a,o,Pe,be,m,we);return}}for(var _e in u)be=u[_e],u.hasOwnProperty(_e)&&be!=null&&!m.hasOwnProperty(_e)&&Di(a,o,_e,null,m,be);for(Be in m)be=m[Be],we=u[Be],!m.hasOwnProperty(Be)||be===we||be==null&&we==null||Di(a,o,Be,be,m,we)}var XE=null,Id=null;function If(a){return a.nodeType===9?a:a.ownerDocument}function Fv(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Gv(a,o){if(a===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&o==="foreignObject"?0:a}function JE(a,o){return a==="textarea"||a==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var ZE=null;function nb(){var a=window.event;return a&&a.type==="popstate"?a===ZE?!1:(ZE=a,!0):(ZE=null,!1)}var Hv=typeof setTimeout=="function"?setTimeout:void 0,rb=typeof clearTimeout=="function"?clearTimeout:void 0,Wv=typeof Promise=="function"?Promise:void 0,ab=typeof queueMicrotask=="function"?queueMicrotask:typeof Wv<"u"?function(a){return Wv.resolve(null).then(a).catch(sb)}:Hv;function sb(a){setTimeout(function(){throw a})}function $o(a){return a==="head"}function zv(a,o){var u=o,m=0,T=0;do{var b=u.nextSibling;if(a.removeChild(u),b&&b.nodeType===8)if(u=b.data,u==="/$"){if(0<m&&8>m){u=m;var F=a.ownerDocument;if(u&1&&lh(F.documentElement),u&2&&lh(F.body),u&4)for(u=F.head,lh(u),F=u.firstChild;F;){var Y=F.nextSibling,re=F.nodeName;F[kl]||re==="SCRIPT"||re==="STYLE"||re==="LINK"&&F.rel.toLowerCase()==="stylesheet"||u.removeChild(F),F=Y}}if(T===0){a.removeChild(b),Sh(o);return}T--}else u==="$"||u==="$?"||u==="$!"?T++:m=u.charCodeAt(0)-48;else m=0;u=b}while(u);Sh(o)}function QE(a){var o=a.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var u=o;switch(o=o.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":QE(u),hp(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}a.removeChild(u)}}function ob(a,o,u,m){for(;a.nodeType===1;){var T=u;if(a.nodeName.toLowerCase()!==o.toLowerCase()){if(!m&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(m){if(!a[kl])switch(o){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(b=a.getAttribute("rel"),b==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(b!==T.rel||a.getAttribute("href")!==(T.href==null||T.href===""?null:T.href)||a.getAttribute("crossorigin")!==(T.crossOrigin==null?null:T.crossOrigin)||a.getAttribute("title")!==(T.title==null?null:T.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(b=a.getAttribute("src"),(b!==(T.src==null?null:T.src)||a.getAttribute("type")!==(T.type==null?null:T.type)||a.getAttribute("crossorigin")!==(T.crossOrigin==null?null:T.crossOrigin))&&b&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(o==="input"&&a.type==="hidden"){var b=T.name==null?null:""+T.name;if(T.type==="hidden"&&a.getAttribute("name")===b)return a}else return a;if(a=za(a.nextSibling),a===null)break}return null}function cb(a,o,u){if(o==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!u||(a=za(a.nextSibling),a===null))return null;return a}function Of(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function lb(a,o){var u=a.ownerDocument;if(a.data!=="$?"||u.readyState==="complete")o();else{var m=function(){o(),u.removeEventListener("DOMContentLoaded",m)};u.addEventListener("DOMContentLoaded",m),a._reactRetry=m}}function za(a){for(;a!=null;a=a.nextSibling){var o=a.nodeType;if(o===1||o===3)break;if(o===8){if(o=a.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return a}var $E=null;function Kv(a){a=a.previousSibling;for(var o=0;a;){if(a.nodeType===8){var u=a.data;if(u==="$"||u==="$!"||u==="$?"){if(o===0)return a;o--}else u==="/$"&&o++}a=a.previousSibling}return null}function Yv(a,o,u){switch(o=If(u),a){case"html":if(a=o.documentElement,!a)throw Error(v(452));return a;case"head":if(a=o.head,!a)throw Error(v(453));return a;case"body":if(a=o.body,!a)throw Error(v(454));return a;default:throw Error(v(451))}}function lh(a){for(var o=a.attributes;o.length;)a.removeAttributeNode(o[0]);hp(a)}var Ea=new Map,qv=new Set;function Nf(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var $s=ze.d;ze.d={f:db,r:ub,D:hb,C:pb,L:fb,m:Jv,X:_b,S:mb,M:Eb};function db(){var a=$s.f(),o=nl();return a||o}function ub(a){var o=Ul(a);o!==null&&o.tag===5&&o.type==="form"?aE(o):$s.r(a)}var Od=typeof document>"u"?null:document;function Xv(a,o,u){var m=Od;if(m&&typeof o=="string"&&o){var T=qr(o);T='link[rel="'+a+'"][href="'+T+'"]',typeof u=="string"&&(T+='[crossorigin="'+u+'"]'),qv.has(T)||(qv.add(T),a={rel:a,crossOrigin:u,href:o},m.querySelector(T)===null&&(o=m.createElement("link"),Yn(o,"link",a),Ln(o),m.head.appendChild(o)))}}function hb(a){$s.D(a),Xv("dns-prefetch",a,null)}function pb(a,o){$s.C(a,o),Xv("preconnect",a,o)}function fb(a,o,u){$s.L(a,o,u);var m=Od;if(m&&a&&o){var T='link[rel="preload"][as="'+qr(o)+'"]';o==="image"&&u&&u.imageSrcSet?(T+='[imagesrcset="'+qr(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(T+='[imagesizes="'+qr(u.imageSizes)+'"]')):T+='[href="'+qr(a)+'"]';var b=T;switch(o){case"style":b=Nd(a);break;case"script":b=Ld(a)}Ea.has(b)||(a=q({rel:"preload",href:o==="image"&&u&&u.imageSrcSet?void 0:a,as:o},u),Ea.set(b,a),m.querySelector(T)!==null||o==="style"&&m.querySelector(Dd(b))||o==="script"&&m.querySelector(dh(b))||(o=m.createElement("link"),Yn(o,"link",a),Ln(o),m.head.appendChild(o)))}}function Jv(a,o){$s.m(a,o);var u=Od;if(u&&a){var m=o&&typeof o.as=="string"?o.as:"script",T='link[rel="modulepreload"][as="'+qr(m)+'"][href="'+qr(a)+'"]',b=T;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=Ld(a)}if(!Ea.has(b)&&(a=q({rel:"modulepreload",href:a},o),Ea.set(b,a),u.querySelector(T)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(dh(b)))return}m=u.createElement("link"),Yn(m,"link",a),Ln(m),u.head.appendChild(m)}}}function mb(a,o,u){$s.S(a,o,u);var m=Od;if(m&&a){var T=Ic(m).hoistableStyles,b=Nd(a);o=o||"default";var F=T.get(b);if(!F){var Y={loading:0,preload:null};if(F=m.querySelector(Dd(b)))Y.loading=5;else{a=q({rel:"stylesheet",href:a,"data-precedence":o},u),(u=Ea.get(b))&&eg(a,u);var re=F=m.createElement("link");Ln(re),Yn(re,"link",a),re._p=new Promise(function(Se,Pe){re.onload=Se,re.onerror=Pe}),re.addEventListener("load",function(){Y.loading|=1}),re.addEventListener("error",function(){Y.loading|=2}),Y.loading|=4,Pf(F,o,m)}F={type:"stylesheet",instance:F,count:1,state:Y},T.set(b,F)}}}function _b(a,o){$s.X(a,o);var u=Od;if(u&&a){var m=Ic(u).hoistableScripts,T=Ld(a),b=m.get(T);b||(b=u.querySelector(dh(T)),b||(a=q({src:a,async:!0},o),(o=Ea.get(T))&&tg(a,o),b=u.createElement("script"),Ln(b),Yn(b,"link",a),u.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},m.set(T,b))}}function Eb(a,o){$s.M(a,o);var u=Od;if(u&&a){var m=Ic(u).hoistableScripts,T=Ld(a),b=m.get(T);b||(b=u.querySelector(dh(T)),b||(a=q({src:a,async:!0,type:"module"},o),(o=Ea.get(T))&&tg(a,o),b=u.createElement("script"),Ln(b),Yn(b,"link",a),u.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},m.set(T,b))}}function Zv(a,o,u,m){var T=(T=Bt.current)?Nf(T):null;if(!T)throw Error(v(446));switch(a){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(o=Nd(u.href),u=Ic(T).hoistableStyles,m=u.get(o),m||(m={type:"style",instance:null,count:0,state:null},u.set(o,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){a=Nd(u.href);var b=Ic(T).hoistableStyles,F=b.get(a);if(F||(T=T.ownerDocument||T,F={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(a,F),(b=T.querySelector(Dd(a)))&&!b._p&&(F.instance=b,F.state.loading=5),Ea.has(a)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},Ea.set(a,u),b||Qv(T,a,u,F.state))),o&&m===null)throw Error(v(528,""));return F}if(o&&m!==null)throw Error(v(529,""));return null;case"script":return o=u.async,u=u.src,typeof u=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=Ld(u),u=Ic(T).hoistableScripts,m=u.get(o),m||(m={type:"script",instance:null,count:0,state:null},u.set(o,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(v(444,a))}}function Nd(a){return'href="'+qr(a)+'"'}function Dd(a){return'link[rel="stylesheet"]['+a+"]"}function Df(a){return q({},a,{"data-precedence":a.precedence,precedence:null})}function Qv(a,o,u,m){a.querySelector('link[rel="preload"][as="style"]['+o+"]")?m.loading=1:(o=a.createElement("link"),m.preload=o,o.addEventListener("load",function(){return m.loading|=1}),o.addEventListener("error",function(){return m.loading|=2}),Yn(o,"link",u),Ln(o),a.head.appendChild(o))}function Ld(a){return'[src="'+qr(a)+'"]'}function dh(a){return"script[async]"+a}function Lf(a,o,u){if(o.count++,o.instance===null)switch(o.type){case"style":var m=a.querySelector('style[data-href~="'+qr(u.href)+'"]');if(m)return o.instance=m,Ln(m),m;var T=q({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return m=(a.ownerDocument||a).createElement("style"),Ln(m),Yn(m,"style",T),Pf(m,u.precedence,a),o.instance=m;case"stylesheet":T=Nd(u.href);var b=a.querySelector(Dd(T));if(b)return o.state.loading|=4,o.instance=b,Ln(b),b;m=Df(u),(T=Ea.get(T))&&eg(m,T),b=(a.ownerDocument||a).createElement("link"),Ln(b);var F=b;return F._p=new Promise(function(Y,re){F.onload=Y,F.onerror=re}),Yn(b,"link",m),o.state.loading|=4,Pf(b,u.precedence,a),o.instance=b;case"script":return b=Ld(u.src),(T=a.querySelector(dh(b)))?(o.instance=T,Ln(T),T):(m=u,(T=Ea.get(b))&&(m=q({},u),tg(m,T)),a=a.ownerDocument||a,T=a.createElement("script"),Ln(T),Yn(T,"link",m),a.head.appendChild(T),o.instance=T);case"void":return null;default:throw Error(v(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(m=o.instance,o.state.loading|=4,Pf(m,u.precedence,a));return o.instance}function Pf(a,o,u){for(var m=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),T=m.length?m[m.length-1]:null,b=T,F=0;F<m.length;F++){var Y=m[F];if(Y.dataset.precedence===o)b=Y;else if(b!==T)break}b?b.parentNode.insertBefore(a,b.nextSibling):(o=u.nodeType===9?u.head:u,o.insertBefore(a,o.firstChild))}function eg(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.title==null&&(a.title=o.title)}function tg(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.integrity==null&&(a.integrity=o.integrity)}var xf=null;function ig(a,o,u){if(xf===null){var m=new Map,T=xf=new Map;T.set(u,m)}else T=xf,m=T.get(u),m||(m=new Map,T.set(u,m));if(m.has(a))return m;for(m.set(a,null),u=u.getElementsByTagName(a),T=0;T<u.length;T++){var b=u[T];if(!(b[kl]||b[lr]||a==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var F=b.getAttribute(o)||"";F=a+F;var Y=m.get(F);Y?Y.push(b):m.set(F,[b])}}return m}function $v(a,o,u){a=a.ownerDocument||a,a.head.insertBefore(u,o==="title"?a.querySelector("head > title"):null)}function ng(a,o,u){if(u===1||o.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return a=o.disabled,typeof o.precedence=="string"&&a==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function eT(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var uh=null;function gb(){}function Sb(a,o,u){if(uh===null)throw Error(v(475));var m=uh;if(o.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var T=Nd(u.href),b=a.querySelector(Dd(T));if(b){a=b._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(m.count++,m=kf.bind(m),a.then(m,m)),o.state.loading|=4,o.instance=b,Ln(b);return}b=a.ownerDocument||a,u=Df(u),(T=Ea.get(T))&&eg(u,T),b=b.createElement("link"),Ln(b);var F=b;F._p=new Promise(function(Y,re){F.onload=Y,F.onerror=re}),Yn(b,"link",u),o.instance=b}m.stylesheets===null&&(m.stylesheets=new Map),m.stylesheets.set(o,a),(a=o.state.preload)&&(o.state.loading&3)===0&&(m.count++,o=kf.bind(m),a.addEventListener("load",o),a.addEventListener("error",o))}}function tT(){if(uh===null)throw Error(v(475));var a=uh;return a.stylesheets&&a.count===0&&ph(a,a.stylesheets),0<a.count?function(o){var u=setTimeout(function(){if(a.stylesheets&&ph(a,a.stylesheets),a.unsuspend){var m=a.unsuspend;a.unsuspend=null,m()}},6e4);return a.unsuspend=o,function(){a.unsuspend=null,clearTimeout(u)}}:null}function kf(){if(this.count--,this.count===0){if(this.stylesheets)ph(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var hh=null;function ph(a,o){a.stylesheets=null,a.unsuspend!==null&&(a.count++,hh=new Map,o.forEach(vb,a),hh=null,kf.call(a))}function vb(a,o){if(!(o.state.loading&4)){var u=hh.get(a);if(u)var m=u.get(null);else{u=new Map,hh.set(a,u);for(var T=a.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<T.length;b++){var F=T[b];(F.nodeName==="LINK"||F.getAttribute("media")!=="not all")&&(u.set(F.dataset.precedence,F),m=F)}m&&u.set(null,m)}T=o.instance,F=T.getAttribute("data-precedence"),b=u.get(F)||m,b===m&&u.set(null,T),u.set(F,T),this.count++,m=kf.bind(this),T.addEventListener("load",m),T.addEventListener("error",m),b?b.parentNode.insertBefore(T,b.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(T,a.firstChild)),o.state.loading|=4}}var fh={$$typeof:fe,Provider:null,Consumer:null,_currentValue:We,_currentValue2:We,_threadCount:0};function iT(a,o,u,m,T,b,F,Y){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Qm(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qm(0),this.hiddenUpdates=Qm(null),this.identifierPrefix=m,this.onUncaughtError=T,this.onCaughtError=b,this.onRecoverableError=F,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Y,this.incompleteTransitions=new Map}function nT(a,o,u,m,T,b,F,Y,re,Se,Pe,Be){return a=new iT(a,o,u,F,Y,re,Se,Be),o=1,b===!0&&(o|=24),b=Qr(3,null,null,o),a.current=b,b.stateNode=a,o=Ru(),o.refCount++,a.pooledCache=o,o.refCount++,b.memoizedState={element:m,isDehydrated:u,cache:o},Vp(b),a}function rg(a){return a?(a=Ws,a):Ws}function ag(a,o,u,m,T,b){T=rg(T),m.context===null?m.context=T:m.pendingContext=T,m=Vo(o),m.payload={element:u},b=b===void 0?null:b,b!==null&&(m.callback=b),u=Xs(a,m,o),u!==null&&(Vr(u,a,o),wu(u,a,o))}function rT(a,o){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var u=a.retryLane;a.retryLane=u!==0&&u<o?u:o}}function sg(a,o){rT(a,o),(a=a.alternate)&&rT(a,o)}function aT(a){if(a.tag===13){var o=ql(a,67108864);o!==null&&Vr(o,a,67108864),sg(a,67108864)}}var Mf=!0;function Tb(a,o,u,m){var T=Le.T;Le.T=null;var b=ze.p;try{ze.p=2,Uf(a,o,u,m)}finally{ze.p=b,Le.T=T}}function yb(a,o,u,m){var T=Le.T;Le.T=null;var b=ze.p;try{ze.p=8,Uf(a,o,u,m)}finally{ze.p=b,Le.T=T}}function Uf(a,o,u,m){if(Mf){var T=mh(m);if(T===null)Af(a,o,m,_h,u),cg(a,m);else if(oT(T,a,o,u,m))m.stopPropagation();else if(cg(a,m),o&4&&-1<Cr.indexOf(a)){for(;T!==null;){var b=Ul(T);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var F=Ao(b.pendingLanes);if(F!==0){var Y=b;for(Y.pendingLanes|=2,Y.entangledLanes|=2;F;){var re=1<<31-vr(F);Y.entanglements[1]|=re,F&=~re}_a(b),(Ri&6)===0&&(Ed=as()+500,ah(0))}}break;case 13:Y=ql(b,2),Y!==null&&Vr(Y,b,2),nl(),sg(b,2)}if(b=mh(m),b===null&&Af(a,o,m,_h,u),b===T)break;T=b}T!==null&&m.stopPropagation()}else Af(a,o,m,null,u)}}function mh(a){return a=o_(a),Ie(a)}var _h=null;function Ie(a){if(_h=null,a=Ml(a),a!==null){var o=w(a);if(o===null)a=null;else{var u=o.tag;if(u===13){if(a=x(o),a!==null)return a;a=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;a=null}else o!==a&&(a=null)}}return _h=a,null}function sT(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch($n()){case Dr:return 2;case lp:return 8;case Dl:case nC:return 32;case Jm:return 268435456;default:return 32}default:return 32}}var og=!1,ec=null,tc=null,ic=null,ll=new Map,Eh=new Map,nc=[],Cr="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function cg(a,o){switch(a){case"focusin":case"focusout":ec=null;break;case"dragenter":case"dragleave":tc=null;break;case"mouseover":case"mouseout":ic=null;break;case"pointerover":case"pointerout":ll.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Eh.delete(o.pointerId)}}function gh(a,o,u,m,T,b){return a===null||a.nativeEvent!==b?(a={blockedOn:o,domEventName:u,eventSystemFlags:m,nativeEvent:b,targetContainers:[T]},o!==null&&(o=Ul(o),o!==null&&aT(o)),a):(a.eventSystemFlags|=m,o=a.targetContainers,T!==null&&o.indexOf(T)===-1&&o.push(T),a)}function oT(a,o,u,m,T){switch(o){case"focusin":return ec=gh(ec,a,o,u,m,T),!0;case"dragenter":return tc=gh(tc,a,o,u,m,T),!0;case"mouseover":return ic=gh(ic,a,o,u,m,T),!0;case"pointerover":var b=T.pointerId;return ll.set(b,gh(ll.get(b)||null,a,o,u,m,T)),!0;case"gotpointercapture":return b=T.pointerId,Eh.set(b,gh(Eh.get(b)||null,a,o,u,m,T)),!0}return!1}function cT(a){var o=Ml(a.target);if(o!==null){var u=w(o);if(u!==null){if(o=u.tag,o===13){if(o=x(u),o!==null){a.blockedOn=o,aC(a.priority,function(){if(u.tag===13){var m=ia();m=wo(m);var T=ql(u,m);T!==null&&Vr(T,u,m),sg(u,m)}});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){a.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Pd(a){if(a.blockedOn!==null)return!1;for(var o=a.targetContainers;0<o.length;){var u=mh(a.nativeEvent);if(u===null){u=a.nativeEvent;var m=new u.constructor(u.type,u);s_=m,u.target.dispatchEvent(m),s_=null}else return o=Ul(u),o!==null&&aT(o),a.blockedOn=u,!1;o.shift()}return!0}function lg(a,o,u){Pd(a)&&u.delete(o)}function lT(){og=!1,ec!==null&&Pd(ec)&&(ec=null),tc!==null&&Pd(tc)&&(tc=null),ic!==null&&Pd(ic)&&(ic=null),ll.forEach(lg),Eh.forEach(lg)}function Vf(a,o){a.blockedOn===o&&(a.blockedOn=null,og||(og=!0,p.unstable_scheduleCallback(p.unstable_NormalPriority,lT)))}var jf=null;function dg(a){jf!==a&&(jf=a,p.unstable_scheduleCallback(p.unstable_NormalPriority,function(){jf===a&&(jf=null);for(var o=0;o<a.length;o+=3){var u=a[o],m=a[o+1],T=a[o+2];if(typeof m!="function"){if(Ie(m||u)===null)continue;break}var b=Ul(u);b!==null&&(a.splice(o,3),o-=3,od(b,{pending:!0,data:T,method:u.method,action:m},m,T))}}))}function Sh(a){function o(re){return Vf(re,a)}ec!==null&&Vf(ec,a),tc!==null&&Vf(tc,a),ic!==null&&Vf(ic,a),ll.forEach(o),Eh.forEach(o);for(var u=0;u<nc.length;u++){var m=nc[u];m.blockedOn===a&&(m.blockedOn=null)}for(;0<nc.length&&(u=nc[0],u.blockedOn===null);)cT(u),u.blockedOn===null&&nc.shift();if(u=(a.ownerDocument||a).$$reactFormReplay,u!=null)for(m=0;m<u.length;m+=3){var T=u[m],b=u[m+1],F=T[Lr]||null;if(typeof b=="function")F||dg(u);else if(F){var Y=null;if(b&&b.hasAttribute("formAction")){if(T=b,F=b[Lr]||null)Y=F.formAction;else if(Ie(T)!==null)continue}else Y=F.action;typeof Y=="function"?u[m+1]=Y:(u.splice(m,3),m-=3),dg(u)}}}function ug(a){this._internalRoot=a}vh.prototype.render=ug.prototype.render=function(a){var o=this._internalRoot;if(o===null)throw Error(v(409));var u=o.current,m=ia();ag(u,m,a,o,null,null)},vh.prototype.unmount=ug.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var o=a.containerInfo;ag(a.current,2,null,a,null,null),nl(),o[Bs]=null}};function vh(a){this._internalRoot=a}vh.prototype.unstable_scheduleHydration=function(a){if(a){var o=F0();a={blockedOn:null,target:a,priority:o};for(var u=0;u<nc.length&&o!==0&&o<nc[u].priority;u++);nc.splice(u,0,a),u===0&&cT(a)}};var dT=_.version;if(dT!=="19.1.1")throw Error(v(527,dT,"19.1.1"));ze.findDOMNode=function(a){var o=a._reactInternals;if(o===void 0)throw typeof a.render=="function"?Error(v(188)):(a=Object.keys(a).join(","),Error(v(268,a)));return a=P(o),a=a!==null?V(a):null,a=a===null?null:a.stateNode,a};var Rb={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:Le,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Th=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Th.isDisabled&&Th.supportsFiber)try{Ll=Th.inject(Rb),mn=Th}catch{}}return b0.createRoot=function(a,o){if(!R(a))throw Error(v(299));var u=!1,m="",T=dv,b=uv,F=hv,Y=null;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onUncaughtError!==void 0&&(T=o.onUncaughtError),o.onCaughtError!==void 0&&(b=o.onCaughtError),o.onRecoverableError!==void 0&&(F=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(Y=o.unstable_transitionCallbacks)),o=nT(a,1,!1,null,null,u,m,T,b,F,Y,null),a[Bs]=o.current,bf(a),new ug(o)},b0.hydrateRoot=function(a,o,u){if(!R(a))throw Error(v(299));var m=!1,T="",b=dv,F=uv,Y=hv,re=null,Se=null;return u!=null&&(u.unstable_strictMode===!0&&(m=!0),u.identifierPrefix!==void 0&&(T=u.identifierPrefix),u.onUncaughtError!==void 0&&(b=u.onUncaughtError),u.onCaughtError!==void 0&&(F=u.onCaughtError),u.onRecoverableError!==void 0&&(Y=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(re=u.unstable_transitionCallbacks),u.formState!==void 0&&(Se=u.formState)),o=nT(a,1,!0,o,u??null,m,T,b,F,Y,re,Se),o.context=rg(null),u=o.current,m=ia(),m=wo(m),T=Vo(m),T.callback=null,Xs(u,T,m),u=m,o.current.lanes=u,uu(o,u),_a(o),a[Bs]=o.current,bf(a),new vh(o)},b0.version="19.1.1",b0}var y4;function eW(){if(y4)return u2.exports;y4=1;function p(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(p)}catch(_){console.error(_)}}return p(),u2.exports=$H(),u2.exports}var tW=eW();/**
 * react-router v7.9.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var R4="popstate";function iW(p={}){function _(v,R){let{pathname:w,search:x,hash:W}=v.location;return b2("",{pathname:w,search:x,hash:W},R.state&&R.state.usr||null,R.state&&R.state.key||"default")}function g(v,R){return typeof R=="string"?R:N0(R)}return rW(_,g,null,p)}function Rn(p,_){if(p===!1||p===null||typeof p>"u")throw new Error(_)}function Rc(p,_){if(!p){typeof console<"u"&&console.warn(_);try{throw new Error(_)}catch{}}}function nW(){return Math.random().toString(36).substring(2,10)}function C4(p,_){return{usr:p.state,key:p.key,idx:_}}function b2(p,_,g=null,v){return{pathname:typeof p=="string"?p:p.pathname,search:"",hash:"",...typeof _=="string"?zm(_):_,state:g,key:_&&_.key||v||nW()}}function N0({pathname:p="/",search:_="",hash:g=""}){return _&&_!=="?"&&(p+=_.charAt(0)==="?"?_:"?"+_),g&&g!=="#"&&(p+=g.charAt(0)==="#"?g:"#"+g),p}function zm(p){let _={};if(p){let g=p.indexOf("#");g>=0&&(_.hash=p.substring(g),p=p.substring(0,g));let v=p.indexOf("?");v>=0&&(_.search=p.substring(v),p=p.substring(0,v)),p&&(_.pathname=p)}return _}function rW(p,_,g,v={}){let{window:R=document.defaultView,v5Compat:w=!1}=v,x=R.history,W="POP",P=null,V=q();V==null&&(V=0,x.replaceState({...x.state,idx:V},""));function q(){return(x.state||{idx:null}).idx}function z(){W="POP";let se=q(),Q=se==null?null:se-V;V=se,P&&P({action:W,location:ne.location,delta:Q})}function ce(se,Q){W="PUSH";let oe=b2(ne.location,se,Q);V=q()+1;let fe=C4(oe,V),Ue=ne.createHref(oe);try{x.pushState(fe,"",Ue)}catch(Ne){if(Ne instanceof DOMException&&Ne.name==="DataCloneError")throw Ne;R.location.assign(Ue)}w&&P&&P({action:W,location:ne.location,delta:1})}function Z(se,Q){W="REPLACE";let oe=b2(ne.location,se,Q);V=q();let fe=C4(oe,V),Ue=ne.createHref(oe);x.replaceState(fe,"",Ue),w&&P&&P({action:W,location:ne.location,delta:0})}function ae(se){return aW(se)}let ne={get action(){return W},get location(){return p(R,x)},listen(se){if(P)throw new Error("A history only accepts one active listener");return R.addEventListener(R4,z),P=se,()=>{R.removeEventListener(R4,z),P=null}},createHref(se){return _(R,se)},createURL:ae,encodeLocation(se){let Q=ae(se);return{pathname:Q.pathname,search:Q.search,hash:Q.hash}},push:ce,replace:Z,go(se){return x.go(se)}};return ne}function aW(p,_=!1){let g="http://localhost";typeof window<"u"&&(g=window.location.origin!=="null"?window.location.origin:window.location.href),Rn(g,"No window.location.(origin|href) available to create URL");let v=typeof p=="string"?p:N0(p);return v=v.replace(/ $/,"%20"),!_&&v.startsWith("//")&&(v=g+v),new URL(v,g)}function V4(p,_,g="/"){return sW(p,_,g,!1)}function sW(p,_,g,v){let R=typeof _=="string"?zm(_):_,w=Ol(R.pathname||"/",g);if(w==null)return null;let x=j4(p);oW(x);let W=null;for(let P=0;W==null&&P<x.length;++P){let V=gW(w);W=_W(x[P],V,v)}return W}function j4(p,_=[],g=[],v="",R=!1){let w=(x,W,P=R,V)=>{let q={relativePath:V===void 0?x.path||"":V,caseSensitive:x.caseSensitive===!0,childrenIndex:W,route:x};if(q.relativePath.startsWith("/")){if(!q.relativePath.startsWith(v)&&P)return;Rn(q.relativePath.startsWith(v),`Absolute route path "${q.relativePath}" nested under path "${v}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),q.relativePath=q.relativePath.slice(v.length)}let z=Il([v,q.relativePath]),ce=g.concat(q);x.children&&x.children.length>0&&(Rn(x.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${z}".`),j4(x.children,_,ce,z,P)),!(x.path==null&&!x.index)&&_.push({path:z,score:fW(z,x.index),routesMeta:ce})};return p.forEach((x,W)=>{if(x.path===""||!x.path?.includes("?"))w(x,W);else for(let P of B4(x.path))w(x,W,!0,P)}),_}function B4(p){let _=p.split("/");if(_.length===0)return[];let[g,...v]=_,R=g.endsWith("?"),w=g.replace(/\?$/,"");if(v.length===0)return R?[w,""]:[w];let x=B4(v.join("/")),W=[];return W.push(...x.map(P=>P===""?w:[w,P].join("/"))),R&&W.push(...x),W.map(P=>p.startsWith("/")&&P===""?"/":P)}function oW(p){p.sort((_,g)=>_.score!==g.score?g.score-_.score:mW(_.routesMeta.map(v=>v.childrenIndex),g.routesMeta.map(v=>v.childrenIndex)))}var cW=/^:[\w-]+$/,lW=3,dW=2,uW=1,hW=10,pW=-2,b4=p=>p==="*";function fW(p,_){let g=p.split("/"),v=g.length;return g.some(b4)&&(v+=pW),_&&(v+=dW),g.filter(R=>!b4(R)).reduce((R,w)=>R+(cW.test(w)?lW:w===""?uW:hW),v)}function mW(p,_){return p.length===_.length&&p.slice(0,-1).every((v,R)=>v===_[R])?p[p.length-1]-_[_.length-1]:0}function _W(p,_,g=!1){let{routesMeta:v}=p,R={},w="/",x=[];for(let W=0;W<v.length;++W){let P=v[W],V=W===v.length-1,q=w==="/"?_:_.slice(w.length)||"/",z=FR({path:P.relativePath,caseSensitive:P.caseSensitive,end:V},q),ce=P.route;if(!z&&V&&g&&!v[v.length-1].route.index&&(z=FR({path:P.relativePath,caseSensitive:P.caseSensitive,end:!1},q)),!z)return null;Object.assign(R,z.params),x.push({params:R,pathname:Il([w,z.pathname]),pathnameBase:yW(Il([w,z.pathnameBase])),route:ce}),z.pathnameBase!=="/"&&(w=Il([w,z.pathnameBase]))}return x}function FR(p,_){typeof p=="string"&&(p={path:p,caseSensitive:!1,end:!0});let[g,v]=EW(p.path,p.caseSensitive,p.end),R=_.match(g);if(!R)return null;let w=R[0],x=w.replace(/(.)\/+$/,"$1"),W=R.slice(1);return{params:v.reduce((V,{paramName:q,isOptional:z},ce)=>{if(q==="*"){let ae=W[ce]||"";x=w.slice(0,w.length-ae.length).replace(/(.)\/+$/,"$1")}const Z=W[ce];return z&&!Z?V[q]=void 0:V[q]=(Z||"").replace(/%2F/g,"/"),V},{}),pathname:w,pathnameBase:x,pattern:p}}function EW(p,_=!1,g=!0){Rc(p==="*"||!p.endsWith("*")||p.endsWith("/*"),`Route path "${p}" will be treated as if it were "${p.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${p.replace(/\*$/,"/*")}".`);let v=[],R="^"+p.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(x,W,P)=>(v.push({paramName:W,isOptional:P!=null}),P?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return p.endsWith("*")?(v.push({paramName:"*"}),R+=p==="*"||p==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):g?R+="\\/*$":p!==""&&p!=="/"&&(R+="(?:(?=\\/|$))"),[new RegExp(R,_?void 0:"i"),v]}function gW(p){try{return p.split("/").map(_=>decodeURIComponent(_).replace(/\//g,"%2F")).join("/")}catch(_){return Rc(!1,`The URL path "${p}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${_}).`),p}}function Ol(p,_){if(_==="/")return p;if(!p.toLowerCase().startsWith(_.toLowerCase()))return null;let g=_.endsWith("/")?_.length-1:_.length,v=p.charAt(g);return v&&v!=="/"?null:p.slice(g)||"/"}function SW(p,_="/"){let{pathname:g,search:v="",hash:R=""}=typeof p=="string"?zm(p):p;return{pathname:g?g.startsWith("/")?g:vW(g,_):_,search:RW(v),hash:CW(R)}}function vW(p,_){let g=_.replace(/\/+$/,"").split("/");return p.split("/").forEach(R=>{R===".."?g.length>1&&g.pop():R!=="."&&g.push(R)}),g.length>1?g.join("/"):"/"}function m2(p,_,g,v){return`Cannot include a '${p}' character in a manually specified \`to.${_}\` field [${JSON.stringify(v)}].  Please separate it out to the \`to.${g}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function TW(p){return p.filter((_,g)=>g===0||_.route.path&&_.route.path.length>0)}function F4(p){let _=TW(p);return _.map((g,v)=>v===_.length-1?g.pathname:g.pathnameBase)}function G4(p,_,g,v=!1){let R;typeof p=="string"?R=zm(p):(R={...p},Rn(!R.pathname||!R.pathname.includes("?"),m2("?","pathname","search",R)),Rn(!R.pathname||!R.pathname.includes("#"),m2("#","pathname","hash",R)),Rn(!R.search||!R.search.includes("#"),m2("#","search","hash",R)));let w=p===""||R.pathname==="",x=w?"/":R.pathname,W;if(x==null)W=g;else{let z=_.length-1;if(!v&&x.startsWith("..")){let ce=x.split("/");for(;ce[0]==="..";)ce.shift(),z-=1;R.pathname=ce.join("/")}W=z>=0?_[z]:"/"}let P=SW(R,W),V=x&&x!=="/"&&x.endsWith("/"),q=(w||x===".")&&g.endsWith("/");return!P.pathname.endsWith("/")&&(V||q)&&(P.pathname+="/"),P}var Il=p=>p.join("/").replace(/\/\/+/g,"/"),yW=p=>p.replace(/\/+$/,"").replace(/^\/*/,"/"),RW=p=>!p||p==="?"?"":p.startsWith("?")?p:"?"+p,CW=p=>!p||p==="#"?"":p.startsWith("#")?p:"#"+p;function bW(p){return p!=null&&typeof p.status=="number"&&typeof p.statusText=="string"&&typeof p.internal=="boolean"&&"data"in p}var H4=["POST","PUT","PATCH","DELETE"];new Set(H4);var AW=["GET",...H4];new Set(AW);var Km=ie.createContext(null);Km.displayName="DataRouter";var YR=ie.createContext(null);YR.displayName="DataRouterState";ie.createContext(!1);var W4=ie.createContext({isTransitioning:!1});W4.displayName="ViewTransition";var wW=ie.createContext(new Map);wW.displayName="Fetchers";var IW=ie.createContext(null);IW.displayName="Await";var bc=ie.createContext(null);bc.displayName="Navigation";var L0=ie.createContext(null);L0.displayName="Location";var Ac=ie.createContext({outlet:null,matches:[],isDataRoute:!1});Ac.displayName="Route";var k2=ie.createContext(null);k2.displayName="RouteError";function OW(p,{relative:_}={}){Rn(P0(),"useHref() may be used only in the context of a <Router> component.");let{basename:g,navigator:v}=ie.useContext(bc),{hash:R,pathname:w,search:x}=x0(p,{relative:_}),W=w;return g!=="/"&&(W=w==="/"?g:Il([g,w])),v.createHref({pathname:W,search:x,hash:R})}function P0(){return ie.useContext(L0)!=null}function wc(){return Rn(P0(),"useLocation() may be used only in the context of a <Router> component."),ie.useContext(L0).location}var z4="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function K4(p){ie.useContext(bc).static||ie.useLayoutEffect(p)}function Da(){let{isDataRoute:p}=ie.useContext(Ac);return p?HW():NW()}function NW(){Rn(P0(),"useNavigate() may be used only in the context of a <Router> component.");let p=ie.useContext(Km),{basename:_,navigator:g}=ie.useContext(bc),{matches:v}=ie.useContext(Ac),{pathname:R}=wc(),w=JSON.stringify(F4(v)),x=ie.useRef(!1);return K4(()=>{x.current=!0}),ie.useCallback((P,V={})=>{if(Rc(x.current,z4),!x.current)return;if(typeof P=="number"){g.go(P);return}let q=G4(P,JSON.parse(w),R,V.relative==="path");p==null&&_!=="/"&&(q.pathname=q.pathname==="/"?_:Il([_,q.pathname])),(V.replace?g.replace:g.push)(q,V.state,V)},[_,g,w,R,p])}var Y4=ie.createContext(null);function M2(){return ie.useContext(Y4)}function DW(p){let _=ie.useContext(Ac).outlet;return ie.useMemo(()=>_&&ie.createElement(Y4.Provider,{value:p},_),[_,p])}function x0(p,{relative:_}={}){let{matches:g}=ie.useContext(Ac),{pathname:v}=wc(),R=JSON.stringify(F4(g));return ie.useMemo(()=>G4(p,JSON.parse(R),v,_==="path"),[p,R,v,_])}function LW(p,_){return q4(p,_)}function q4(p,_,g,v,R){Rn(P0(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:w}=ie.useContext(bc),{matches:x}=ie.useContext(Ac),W=x[x.length-1],P=W?W.params:{},V=W?W.pathname:"/",q=W?W.pathnameBase:"/",z=W&&W.route;{let oe=z&&z.path||"";X4(V,!z||oe.endsWith("*")||oe.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${V}" (under <Route path="${oe}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${oe}"> to <Route path="${oe==="/"?"*":`${oe}/*`}">.`)}let ce=wc(),Z;if(_){let oe=typeof _=="string"?zm(_):_;Rn(q==="/"||oe.pathname?.startsWith(q),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${q}" but pathname "${oe.pathname}" was given in the \`location\` prop.`),Z=oe}else Z=ce;let ae=Z.pathname||"/",ne=ae;if(q!=="/"){let oe=q.replace(/^\//,"").split("/");ne="/"+ae.replace(/^\//,"").split("/").slice(oe.length).join("/")}let se=V4(p,{pathname:ne});Rc(z||se!=null,`No routes matched location "${Z.pathname}${Z.search}${Z.hash}" `),Rc(se==null||se[se.length-1].route.element!==void 0||se[se.length-1].route.Component!==void 0||se[se.length-1].route.lazy!==void 0,`Matched leaf route at location "${Z.pathname}${Z.search}${Z.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let Q=UW(se&&se.map(oe=>Object.assign({},oe,{params:Object.assign({},P,oe.params),pathname:Il([q,w.encodeLocation?w.encodeLocation(oe.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:oe.pathname]),pathnameBase:oe.pathnameBase==="/"?q:Il([q,w.encodeLocation?w.encodeLocation(oe.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:oe.pathnameBase])})),x,g,v,R);return _&&Q?ie.createElement(L0.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...Z},navigationType:"POP"}},Q):Q}function PW(){let p=GW(),_=bW(p)?`${p.status} ${p.statusText}`:p instanceof Error?p.message:JSON.stringify(p),g=p instanceof Error?p.stack:null,v="rgba(200,200,200, 0.5)",R={padding:"0.5rem",backgroundColor:v},w={padding:"2px 4px",backgroundColor:v},x=null;return console.error("Error handled by React Router default ErrorBoundary:",p),x=ie.createElement(ie.Fragment,null,ie.createElement("p",null," Hey developer "),ie.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ie.createElement("code",{style:w},"ErrorBoundary")," or"," ",ie.createElement("code",{style:w},"errorElement")," prop on your route.")),ie.createElement(ie.Fragment,null,ie.createElement("h2",null,"Unexpected Application Error!"),ie.createElement("h3",{style:{fontStyle:"italic"}},_),g?ie.createElement("pre",{style:R},g):null,x)}var xW=ie.createElement(PW,null),kW=class extends ie.Component{constructor(p){super(p),this.state={location:p.location,revalidation:p.revalidation,error:p.error}}static getDerivedStateFromError(p){return{error:p}}static getDerivedStateFromProps(p,_){return _.location!==p.location||_.revalidation!=="idle"&&p.revalidation==="idle"?{error:p.error,location:p.location,revalidation:p.revalidation}:{error:p.error!==void 0?p.error:_.error,location:_.location,revalidation:p.revalidation||_.revalidation}}componentDidCatch(p,_){this.props.unstable_onError?this.props.unstable_onError(p,_):console.error("React Router caught the following error during render",p)}render(){return this.state.error!==void 0?ie.createElement(Ac.Provider,{value:this.props.routeContext},ie.createElement(k2.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function MW({routeContext:p,match:_,children:g}){let v=ie.useContext(Km);return v&&v.static&&v.staticContext&&(_.route.errorElement||_.route.ErrorBoundary)&&(v.staticContext._deepestRenderedBoundaryId=_.route.id),ie.createElement(Ac.Provider,{value:p},g)}function UW(p,_=[],g=null,v=null,R=null){if(p==null){if(!g)return null;if(g.errors)p=g.matches;else if(_.length===0&&!g.initialized&&g.matches.length>0)p=g.matches;else return null}let w=p,x=g?.errors;if(x!=null){let V=w.findIndex(q=>q.route.id&&x?.[q.route.id]!==void 0);Rn(V>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(x).join(",")}`),w=w.slice(0,Math.min(w.length,V+1))}let W=!1,P=-1;if(g)for(let V=0;V<w.length;V++){let q=w[V];if((q.route.HydrateFallback||q.route.hydrateFallbackElement)&&(P=V),q.route.id){let{loaderData:z,errors:ce}=g,Z=q.route.loader&&!z.hasOwnProperty(q.route.id)&&(!ce||ce[q.route.id]===void 0);if(q.route.lazy||Z){W=!0,P>=0?w=w.slice(0,P+1):w=[w[0]];break}}}return w.reduceRight((V,q,z)=>{let ce,Z=!1,ae=null,ne=null;g&&(ce=x&&q.route.id?x[q.route.id]:void 0,ae=q.route.errorElement||xW,W&&(P<0&&z===0?(X4("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),Z=!0,ne=null):P===z&&(Z=!0,ne=q.route.hydrateFallbackElement||null)));let se=_.concat(w.slice(0,z+1)),Q=()=>{let oe;return ce?oe=ae:Z?oe=ne:q.route.Component?oe=ie.createElement(q.route.Component,null):q.route.element?oe=q.route.element:oe=V,ie.createElement(MW,{match:q,routeContext:{outlet:V,matches:se,isDataRoute:g!=null},children:oe})};return g&&(q.route.ErrorBoundary||q.route.errorElement||z===0)?ie.createElement(kW,{location:g.location,revalidation:g.revalidation,component:ae,error:ce,children:Q(),routeContext:{outlet:null,matches:se,isDataRoute:!0},unstable_onError:v}):Q()},null)}function U2(p){return`${p} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function VW(p){let _=ie.useContext(Km);return Rn(_,U2(p)),_}function jW(p){let _=ie.useContext(YR);return Rn(_,U2(p)),_}function BW(p){let _=ie.useContext(Ac);return Rn(_,U2(p)),_}function V2(p){let _=BW(p),g=_.matches[_.matches.length-1];return Rn(g.route.id,`${p} can only be used on routes that contain a unique "id"`),g.route.id}function FW(){return V2("useRouteId")}function GW(){let p=ie.useContext(k2),_=jW("useRouteError"),g=V2("useRouteError");return p!==void 0?p:_.errors?.[g]}function HW(){let{router:p}=VW("useNavigate"),_=V2("useNavigate"),g=ie.useRef(!1);return K4(()=>{g.current=!0}),ie.useCallback(async(R,w={})=>{Rc(g.current,z4),g.current&&(typeof R=="number"?p.navigate(R):await p.navigate(R,{fromRouteId:_,...w}))},[p,_])}var A4={};function X4(p,_,g){!_&&!A4[p]&&(A4[p]=!0,Rc(!1,g))}ie.memo(WW);function WW({routes:p,future:_,state:g,unstable_onError:v}){return q4(p,void 0,g,v,_)}function zW(p){return DW(p.context)}function rn(p){Rn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function KW({basename:p="/",children:_=null,location:g,navigationType:v="POP",navigator:R,static:w=!1}){Rn(!P0(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let x=p.replace(/^\/*/,"/"),W=ie.useMemo(()=>({basename:x,navigator:R,static:w,future:{}}),[x,R,w]);typeof g=="string"&&(g=zm(g));let{pathname:P="/",search:V="",hash:q="",state:z=null,key:ce="default"}=g,Z=ie.useMemo(()=>{let ae=Ol(P,x);return ae==null?null:{location:{pathname:ae,search:V,hash:q,state:z,key:ce},navigationType:v}},[x,P,V,q,z,ce,v]);return Rc(Z!=null,`<Router basename="${x}"> is not able to match the URL "${P}${V}${q}" because it does not start with the basename, so the <Router> won't render anything.`),Z==null?null:ie.createElement(bc.Provider,{value:W},ie.createElement(L0.Provider,{children:_,value:Z}))}function YW({children:p,location:_}){return LW(A2(p),_)}function A2(p,_=[]){let g=[];return ie.Children.forEach(p,(v,R)=>{if(!ie.isValidElement(v))return;let w=[..._,R];if(v.type===ie.Fragment){g.push.apply(g,A2(v.props.children,w));return}Rn(v.type===rn,`[${typeof v.type=="string"?v.type:v.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Rn(!v.props.index||!v.props.children,"An index route cannot have child routes.");let x={id:v.props.id||w.join("-"),caseSensitive:v.props.caseSensitive,element:v.props.element,Component:v.props.Component,index:v.props.index,path:v.props.path,middleware:v.props.middleware,loader:v.props.loader,action:v.props.action,hydrateFallbackElement:v.props.hydrateFallbackElement,HydrateFallback:v.props.HydrateFallback,errorElement:v.props.errorElement,ErrorBoundary:v.props.ErrorBoundary,hasErrorBoundary:v.props.hasErrorBoundary===!0||v.props.ErrorBoundary!=null||v.props.errorElement!=null,shouldRevalidate:v.props.shouldRevalidate,handle:v.props.handle,lazy:v.props.lazy};v.props.children&&(x.children=A2(v.props.children,w)),g.push(x)}),g}var UR="get",VR="application/x-www-form-urlencoded";function qR(p){return p!=null&&typeof p.tagName=="string"}function qW(p){return qR(p)&&p.tagName.toLowerCase()==="button"}function XW(p){return qR(p)&&p.tagName.toLowerCase()==="form"}function JW(p){return qR(p)&&p.tagName.toLowerCase()==="input"}function ZW(p){return!!(p.metaKey||p.altKey||p.ctrlKey||p.shiftKey)}function QW(p,_){return p.button===0&&(!_||_==="_self")&&!ZW(p)}var xR=null;function $W(){if(xR===null)try{new FormData(document.createElement("form"),0),xR=!1}catch{xR=!0}return xR}var ez=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function _2(p){return p!=null&&!ez.has(p)?(Rc(!1,`"${p}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${VR}"`),null):p}function tz(p,_){let g,v,R,w,x;if(XW(p)){let W=p.getAttribute("action");v=W?Ol(W,_):null,g=p.getAttribute("method")||UR,R=_2(p.getAttribute("enctype"))||VR,w=new FormData(p)}else if(qW(p)||JW(p)&&(p.type==="submit"||p.type==="image")){let W=p.form;if(W==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let P=p.getAttribute("formaction")||W.getAttribute("action");if(v=P?Ol(P,_):null,g=p.getAttribute("formmethod")||W.getAttribute("method")||UR,R=_2(p.getAttribute("formenctype"))||_2(W.getAttribute("enctype"))||VR,w=new FormData(W,p),!$W()){let{name:V,type:q,value:z}=p;if(q==="image"){let ce=V?`${V}.`:"";w.append(`${ce}x`,"0"),w.append(`${ce}y`,"0")}else V&&w.append(V,z)}}else{if(qR(p))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');g=UR,v=null,R=VR,x=p}return w&&R==="text/plain"&&(x=w,w=void 0),{action:v,method:g.toLowerCase(),encType:R,formData:w,body:x}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function j2(p,_){if(p===!1||p===null||typeof p>"u")throw new Error(_)}function iz(p,_,g){let v=typeof p=="string"?new URL(p,typeof window>"u"?"server://singlefetch/":window.location.origin):p;return v.pathname==="/"?v.pathname=`_root.${g}`:_&&Ol(v.pathname,_)==="/"?v.pathname=`${_.replace(/\/$/,"")}/_root.${g}`:v.pathname=`${v.pathname.replace(/\/$/,"")}.${g}`,v}async function nz(p,_){if(p.id in _)return _[p.id];try{let g=await import(p.module);return _[p.id]=g,g}catch(g){return console.error(`Error loading route module \`${p.module}\`, reloading page...`),console.error(g),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function rz(p){return p==null?!1:p.href==null?p.rel==="preload"&&typeof p.imageSrcSet=="string"&&typeof p.imageSizes=="string":typeof p.rel=="string"&&typeof p.href=="string"}async function az(p,_,g){let v=await Promise.all(p.map(async R=>{let w=_.routes[R.route.id];if(w){let x=await nz(w,g);return x.links?x.links():[]}return[]}));return lz(v.flat(1).filter(rz).filter(R=>R.rel==="stylesheet"||R.rel==="preload").map(R=>R.rel==="stylesheet"?{...R,rel:"prefetch",as:"style"}:{...R,rel:"prefetch"}))}function w4(p,_,g,v,R,w){let x=(P,V)=>g[V]?P.route.id!==g[V].route.id:!0,W=(P,V)=>g[V].pathname!==P.pathname||g[V].route.path?.endsWith("*")&&g[V].params["*"]!==P.params["*"];return w==="assets"?_.filter((P,V)=>x(P,V)||W(P,V)):w==="data"?_.filter((P,V)=>{let q=v.routes[P.route.id];if(!q||!q.hasLoader)return!1;if(x(P,V)||W(P,V))return!0;if(P.route.shouldRevalidate){let z=P.route.shouldRevalidate({currentUrl:new URL(R.pathname+R.search+R.hash,window.origin),currentParams:g[0]?.params||{},nextUrl:new URL(p,window.origin),nextParams:P.params,defaultShouldRevalidate:!0});if(typeof z=="boolean")return z}return!0}):[]}function sz(p,_,{includeHydrateFallback:g}={}){return oz(p.map(v=>{let R=_.routes[v.route.id];if(!R)return[];let w=[R.module];return R.clientActionModule&&(w=w.concat(R.clientActionModule)),R.clientLoaderModule&&(w=w.concat(R.clientLoaderModule)),g&&R.hydrateFallbackModule&&(w=w.concat(R.hydrateFallbackModule)),R.imports&&(w=w.concat(R.imports)),w}).flat(1))}function oz(p){return[...new Set(p)]}function cz(p){let _={},g=Object.keys(p).sort();for(let v of g)_[v]=p[v];return _}function lz(p,_){let g=new Set;return new Set(_),p.reduce((v,R)=>{let w=JSON.stringify(cz(R));return g.has(w)||(g.add(w),v.push({key:w,link:R})),v},[])}function J4(){let p=ie.useContext(Km);return j2(p,"You must render this element inside a <DataRouterContext.Provider> element"),p}function dz(){let p=ie.useContext(YR);return j2(p,"You must render this element inside a <DataRouterStateContext.Provider> element"),p}var B2=ie.createContext(void 0);B2.displayName="FrameworkContext";function Z4(){let p=ie.useContext(B2);return j2(p,"You must render this element inside a <HydratedRouter> element"),p}function uz(p,_){let g=ie.useContext(B2),[v,R]=ie.useState(!1),[w,x]=ie.useState(!1),{onFocus:W,onBlur:P,onMouseEnter:V,onMouseLeave:q,onTouchStart:z}=_,ce=ie.useRef(null);ie.useEffect(()=>{if(p==="render"&&x(!0),p==="viewport"){let ne=Q=>{Q.forEach(oe=>{x(oe.isIntersecting)})},se=new IntersectionObserver(ne,{threshold:.5});return ce.current&&se.observe(ce.current),()=>{se.disconnect()}}},[p]),ie.useEffect(()=>{if(v){let ne=setTimeout(()=>{x(!0)},100);return()=>{clearTimeout(ne)}}},[v]);let Z=()=>{R(!0)},ae=()=>{R(!1),x(!1)};return g?p!=="intent"?[w,ce,{}]:[w,ce,{onFocus:A0(W,Z),onBlur:A0(P,ae),onMouseEnter:A0(V,Z),onMouseLeave:A0(q,ae),onTouchStart:A0(z,Z)}]:[!1,ce,{}]}function A0(p,_){return g=>{p&&p(g),g.defaultPrevented||_(g)}}function hz({page:p,..._}){let{router:g}=J4(),v=ie.useMemo(()=>V4(g.routes,p,g.basename),[g.routes,p,g.basename]);return v?ie.createElement(fz,{page:p,matches:v,..._}):null}function pz(p){let{manifest:_,routeModules:g}=Z4(),[v,R]=ie.useState([]);return ie.useEffect(()=>{let w=!1;return az(p,_,g).then(x=>{w||R(x)}),()=>{w=!0}},[p,_,g]),v}function fz({page:p,matches:_,...g}){let v=wc(),{manifest:R,routeModules:w}=Z4(),{basename:x}=J4(),{loaderData:W,matches:P}=dz(),V=ie.useMemo(()=>w4(p,_,P,R,v,"data"),[p,_,P,R,v]),q=ie.useMemo(()=>w4(p,_,P,R,v,"assets"),[p,_,P,R,v]),z=ie.useMemo(()=>{if(p===v.pathname+v.search+v.hash)return[];let ae=new Set,ne=!1;if(_.forEach(Q=>{let oe=R.routes[Q.route.id];!oe||!oe.hasLoader||(!V.some(fe=>fe.route.id===Q.route.id)&&Q.route.id in W&&w[Q.route.id]?.shouldRevalidate||oe.hasClientLoader?ne=!0:ae.add(Q.route.id))}),ae.size===0)return[];let se=iz(p,x,"data");return ne&&ae.size>0&&se.searchParams.set("_routes",_.filter(Q=>ae.has(Q.route.id)).map(Q=>Q.route.id).join(",")),[se.pathname+se.search]},[x,W,v,R,V,_,p,w]),ce=ie.useMemo(()=>sz(q,R),[q,R]),Z=pz(q);return ie.createElement(ie.Fragment,null,z.map(ae=>ie.createElement("link",{key:ae,rel:"prefetch",as:"fetch",href:ae,...g})),ce.map(ae=>ie.createElement("link",{key:ae,rel:"modulepreload",href:ae,...g})),Z.map(({key:ae,link:ne})=>ie.createElement("link",{key:ae,nonce:g.nonce,...ne})))}function mz(...p){return _=>{p.forEach(g=>{typeof g=="function"?g(_):g!=null&&(g.current=_)})}}var Q4=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Q4&&(window.__reactRouterVersion="7.9.3")}catch{}function _z({basename:p,children:_,window:g}){let v=ie.useRef();v.current==null&&(v.current=iW({window:g,v5Compat:!0}));let R=v.current,[w,x]=ie.useState({action:R.action,location:R.location}),W=ie.useCallback(P=>{ie.startTransition(()=>x(P))},[x]);return ie.useLayoutEffect(()=>R.listen(W),[R,W]),ie.createElement(KW,{basename:p,children:_,location:w.location,navigationType:w.action,navigator:R})}var $4=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,qi=ie.forwardRef(function({onClick:_,discover:g="render",prefetch:v="none",relative:R,reloadDocument:w,replace:x,state:W,target:P,to:V,preventScrollReset:q,viewTransition:z,...ce},Z){let{basename:ae}=ie.useContext(bc),ne=typeof V=="string"&&$4.test(V),se,Q=!1;if(typeof V=="string"&&ne&&(se=V,Q4))try{let Et=new URL(window.location.href),qe=V.startsWith("//")?new URL(Et.protocol+V):new URL(V),Qe=Ol(qe.pathname,ae);qe.origin===Et.origin&&Qe!=null?V=Qe+qe.search+qe.hash:Q=!0}catch{Rc(!1,`<Link to="${V}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let oe=OW(V,{relative:R}),[fe,Ue,Ne]=uz(v,ce),ft=vz(V,{replace:x,state:W,target:P,preventScrollReset:q,relative:R,viewTransition:z});function $e(Et){_&&_(Et),Et.defaultPrevented||ft(Et)}let De=ie.createElement("a",{...ce,...Ne,href:se||oe,onClick:Q||w?_:$e,ref:mz(Z,Ue),target:P,"data-discover":!ne&&g==="render"?"true":void 0});return fe&&!ne?ie.createElement(ie.Fragment,null,De,ie.createElement(hz,{page:oe})):De});qi.displayName="Link";var Ez=ie.forwardRef(function({"aria-current":_="page",caseSensitive:g=!1,className:v="",end:R=!1,style:w,to:x,viewTransition:W,children:P,...V},q){let z=x0(x,{relative:V.relative}),ce=wc(),Z=ie.useContext(YR),{navigator:ae,basename:ne}=ie.useContext(bc),se=Z!=null&&bz(z)&&W===!0,Q=ae.encodeLocation?ae.encodeLocation(z).pathname:z.pathname,oe=ce.pathname,fe=Z&&Z.navigation&&Z.navigation.location?Z.navigation.location.pathname:null;g||(oe=oe.toLowerCase(),fe=fe?fe.toLowerCase():null,Q=Q.toLowerCase()),fe&&ne&&(fe=Ol(fe,ne)||fe);const Ue=Q!=="/"&&Q.endsWith("/")?Q.length-1:Q.length;let Ne=oe===Q||!R&&oe.startsWith(Q)&&oe.charAt(Ue)==="/",ft=fe!=null&&(fe===Q||!R&&fe.startsWith(Q)&&fe.charAt(Q.length)==="/"),$e={isActive:Ne,isPending:ft,isTransitioning:se},De=Ne?_:void 0,Et;typeof v=="function"?Et=v($e):Et=[v,Ne?"active":null,ft?"pending":null,se?"transitioning":null].filter(Boolean).join(" ");let qe=typeof w=="function"?w($e):w;return ie.createElement(qi,{...V,"aria-current":De,className:Et,ref:q,style:qe,to:x,viewTransition:W},typeof P=="function"?P($e):P)});Ez.displayName="NavLink";var gz=ie.forwardRef(({discover:p="render",fetcherKey:_,navigate:g,reloadDocument:v,replace:R,state:w,method:x=UR,action:W,onSubmit:P,relative:V,preventScrollReset:q,viewTransition:z,...ce},Z)=>{let ae=Rz(),ne=Cz(W,{relative:V}),se=x.toLowerCase()==="get"?"get":"post",Q=typeof W=="string"&&$4.test(W),oe=fe=>{if(P&&P(fe),fe.defaultPrevented)return;fe.preventDefault();let Ue=fe.nativeEvent.submitter,Ne=Ue?.getAttribute("formmethod")||x;ae(Ue||fe.currentTarget,{fetcherKey:_,method:Ne,navigate:g,replace:R,state:w,relative:V,preventScrollReset:q,viewTransition:z})};return ie.createElement("form",{ref:Z,method:se,action:ne,onSubmit:v?P:oe,...ce,"data-discover":!Q&&p==="render"?"true":void 0})});gz.displayName="Form";function Sz(p){return`${p} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function eV(p){let _=ie.useContext(Km);return Rn(_,Sz(p)),_}function vz(p,{target:_,replace:g,state:v,preventScrollReset:R,relative:w,viewTransition:x}={}){let W=Da(),P=wc(),V=x0(p,{relative:w});return ie.useCallback(q=>{if(QW(q,_)){q.preventDefault();let z=g!==void 0?g:N0(P)===N0(V);W(p,{replace:z,state:v,preventScrollReset:R,relative:w,viewTransition:x})}},[P,W,V,g,v,_,p,R,w,x])}var Tz=0,yz=()=>`__${String(++Tz)}__`;function Rz(){let{router:p}=eV("useSubmit"),{basename:_}=ie.useContext(bc),g=FW();return ie.useCallback(async(v,R={})=>{let{action:w,method:x,encType:W,formData:P,body:V}=tz(v,_);if(R.navigate===!1){let q=R.fetcherKey||yz();await p.fetch(q,g,R.action||w,{preventScrollReset:R.preventScrollReset,formData:P,body:V,formMethod:R.method||x,formEncType:R.encType||W,flushSync:R.flushSync})}else await p.navigate(R.action||w,{preventScrollReset:R.preventScrollReset,formData:P,body:V,formMethod:R.method||x,formEncType:R.encType||W,replace:R.replace,state:R.state,fromRouteId:g,flushSync:R.flushSync,viewTransition:R.viewTransition})},[p,_,g])}function Cz(p,{relative:_}={}){let{basename:g}=ie.useContext(bc),v=ie.useContext(Ac);Rn(v,"useFormAction must be used inside a RouteContext");let[R]=v.matches.slice(-1),w={...x0(p||".",{relative:_})},x=wc();if(p==null){w.search=x.search;let W=new URLSearchParams(w.search),P=W.getAll("index");if(P.some(q=>q==="")){W.delete("index"),P.filter(z=>z).forEach(z=>W.append("index",z));let q=W.toString();w.search=q?`?${q}`:""}}return(!p||p===".")&&R.route.index&&(w.search=w.search?w.search.replace(/^\?/,"?index&"):"?index"),g!=="/"&&(w.pathname=w.pathname==="/"?g:Il([g,w.pathname])),N0(w)}function bz(p,{relative:_}={}){let g=ie.useContext(W4);Rn(g!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:v}=eV("useViewTransitionState"),R=x0(p,{relative:_});if(!g.isTransitioning)return!1;let w=Ol(g.currentLocation.pathname,v)||g.currentLocation.pathname,x=Ol(g.nextLocation.pathname,v)||g.nextLocation.pathname;return FR(R.pathname,x)!=null||FR(R.pathname,w)!=null}const rt={TOP_NO_LOGIN:"/layout/",TOP_LOGIN:"/layout/auth",LIKE_LIST:"/layout/like-list",SEARCH_TOP:"/layout/search-top",USER_REGISTRATION:"/layout/user-registration",LOGIN:"/layout/login",REGISTRATION_EMAIL_SENT:"/layout/registration-email-sent",CATEGORY_LIST:"/layout/category-list",SEARCH_RESULT:"/layout/search-result",MY_PAGE:"/layout/my-page",USER_PROFILE:"/layout/user-profile",OTHER_PROFILE:"/layout/other-profile",ITEM_DETAIL:"/layout/item-detail",ROOM_DETAIL:"/layout/room-detail",FOLLOW_LIST:"/layout/follow-list",VIEW_HISTORY:"/layout/view-history",WON_ITEM_LIST:"/layout/won-item-list",PERSONAL_INFORMATION_SETTING:"/layout/personal-information-setting",USER_PROFILE_SETTING:"/layout/user-profile-setting",SHIPPING_ADDRESS_LIST:"/layout/shipping-address-list",EMAIL_PASSWORD_SETTING:"/layout/email-password-setting",SHIPPING_ADDRESS_REGISTRATION:"/layout/shipping-address-registration",POST:"/layout/post",POST_ITEM:"/layout/post-item",POSTED_ITEM_LIST:"/layout/posted-item-list",CREATE_ROOM:"/layout/create-room"},Az=[rt?.USER_REGISTRATION,rt?.LOGIN,rt?.REGISTRATION_EMAIL_SENT,rt?.ROOM_DETAIL],wz=[rt?.POST_ITEM,rt?.CREATE_ROOM],Iz=[rt?.USER_REGISTRATION,rt?.LOGIN,rt?.REGISTRATION_EMAIL_SENT,rt?.POST_ITEM,rt?.ROOM_DETAIL,rt?.CREATE_ROOM],Oz=[rt?.EMAIL_PASSWORD_SETTING,rt?.LIKE_LIST,rt?.MY_PAGE,rt?.PERSONAL_INFORMATION_SETTING,rt?.SHIPPING_ADDRESS_LIST,rt?.SHIPPING_ADDRESS_REGISTRATION,rt?.USER_PROFILE_SETTING,rt?.VIEW_HISTORY],Nz=[rt?.FOLLOW_LIST,rt?.OTHER_PROFILE,rt?.WON_ITEM_LIST,rt?.POSTED_ITEM_LIST],Dz=[rt?.FOLLOW_LIST,rt?.WON_ITEM_LIST,rt?.POSTED_ITEM_LIST],tV="/assets/logo-Ro6IXcIN.svg",Lz="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M15.0011%2015.6711L9.02113%209.69111C8.53113%2010.1011%207.9711%2010.4111%207.3711%2010.6211C6.7711%2010.8411%206.14111%2010.9511%205.50111%2010.9611C4.03111%2010.9911%202.62111%2010.4211%201.59111%209.37112C0.551105%208.35112%20-0.0288912%206.94112%200.0011088%205.48112C-0.0288912%202.48112%202.39112%200.0311088%205.39112%200.00110878C5.42112%200.00110878%205.45112%200.00110878%205.48112%200.00110878C6.94112%20-0.0288912%208.35111%200.55112%209.38111%201.59112C10.4311%202.61112%2011.0111%204.02112%2010.9811%205.48112C10.9811%206.14112%2010.8611%206.80112%2010.6211%207.42112C10.4111%208.00112%2010.0911%208.53111%209.69111%209.00111L15.7011%2015.0111L15.0111%2015.6811L15.0011%2015.6711ZM5.50111%2010.0011C7.97111%2010.0311%2010.0011%208.05111%2010.0211%205.58111C10.0211%205.55111%2010.0211%205.51112%2010.0211%205.48112C10.0511%203.01112%208.07111%200.981115%205.60111%200.961115C5.57111%200.961115%205.53111%200.961115%205.50111%200.961115C4.29111%200.931115%203.12113%201.40112%202.27113%202.26112C1.40113%203.10112%200.931121%204.27112%200.951121%205.48112C0.921121%206.69112%201.40113%207.86112%202.27113%208.70112C3.12113%209.56112%204.29111%2010.0311%205.50111%2010.0011Z'%20fill='%23EFEFEF'/%3e%3c/svg%3e";function Pz(){const _=wc()?.pathname!==rt?.SEARCH_TOP;return A.jsxs("div",{className:"relative flex justify-center items-center w-full max-w-[768px] pt-[22px] pb-[17px] [&_img]:w-full [&_img]:h-full",children:[A.jsx(qi,{to:rt?.TOP_NO_LOGIN,className:"w-full max-w-[103px] aspect-[103/16]",children:A.jsx("img",{src:tV,alt:"logo",className:"w-full h-full"})}),_&&A.jsx(qi,{to:rt?.SEARCH_TOP,className:"absolute top-[23px] right-[17px] w-4 h-4",children:A.jsx("img",{src:Lz,alt:"search",className:"w-full h-full"})})]})}const xz="data:image/svg+xml,%3csvg%20width='35'%20height='30'%20viewBox='0%200%2035%2030'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M31.5801%2017.22H34.4199H34.4399L32.6602%2015.4399L17.96%200.73999L17.2202%200L16.48%200.73999L1.78027%2015.4399L0.740234%2016.48L0%2017.21L6.88037%2017.22V29.38H27.5703V17.22H31.6001H31.5801ZM25.46%2027.24V27.3H8.93994V16L17.2002%207.75L25.46%2016V27.24Z'%20fill='white'/%3e%3cpath%20d='M19.5684%2020.1201H14.8281V24.4102H19.5684V20.1201Z'%20fill='white'/%3e%3cpath%20d='M19.5684%2014.79H14.8281V19.08H19.5684V14.79Z'%20fill='white'/%3e%3c/svg%3e",kz="data:image/svg+xml,%3csvg%20width='29'%20height='24'%20viewBox='0%200%2029%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M27.1802%205.20007H21.1499L20.21%200.98999C20.08%200.40999%2019.5702%200%2018.9702%200H9.49023C8.90023%200%208.38%200.40999%208.25%200.98999L7.31006%205.20007H1.27002C0.57002%205.20007%200%205.77009%200%206.47009V22.7201C0%2023.4201%200.57002%2023.99%201.27002%2023.99H27.1899C27.8899%2023.99%2028.46%2023.4201%2028.46%2022.7201V6.47009C28.46%205.77009%2027.8899%205.20007%2027.1899%205.20007H27.1802ZM7.22998%2014.6901C7.22998%2010.8201%2010.36%207.69006%2014.23%207.69006C18.1%207.69006%2021.23%2010.8301%2021.23%2014.6901C21.23%2018.5501%2018.1%2021.6901%2014.23%2021.6901C10.36%2021.6901%207.22998%2018.5601%207.22998%2014.6901ZM10.3203%205.2301L10.6201%203.46008H17.8403L18.1001%204.98999L18.1401%205.2301H10.3301H10.3203ZM23.6401%2020.78C22.9801%2020.78%2022.4399%2020.2401%2022.4399%2019.5801C22.4399%2018.9201%2022.9801%2018.38%2023.6401%2018.38C24.3001%2018.38%2024.8403%2018.9201%2024.8403%2019.5801C24.8403%2020.2401%2024.3001%2020.78%2023.6401%2020.78Z'%20fill='white'/%3e%3cpath%20d='M14.2295%2019.2496C16.7495%2019.2496%2018.7896%2017.2097%2018.7896%2014.6897C18.7896%2013.9597%2018.6198%2013.2797%2018.3198%2012.6697V12.6497L15.2197%2014.0897C14.8897%2014.2497%2014.5397%2013.8997%2014.6997%2013.5697L16.0996%2010.5697V10.5497H16.1099C15.5399%2010.2797%2014.8997%2010.1396%2014.2397%2010.1396C11.7197%2010.1396%209.67969%2012.1797%209.67969%2014.6997C9.67969%2017.2197%2011.7197%2019.2596%2014.2397%2019.2596L14.2295%2019.2496Z'%20fill='white'/%3e%3c/svg%3e",Mz="data:image/svg+xml,%3csvg%20width='17'%20height='32'%20viewBox='0%200%2017%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8.03027%2011.42C10.9103%2011.42%2013.2402%209.08996%2013.2402%206.20996C13.2402%203.32996%2010.9103%201%208.03027%201C5.15027%201%202.82031%203.32996%202.82031%206.20996C2.82031%209.08996%205.15027%2011.42%208.03027%2011.42Z'%20stroke='white'%20stroke-width='2'%20stroke-miterlimit='10'/%3e%3cpath%20d='M11.6299%2015.2695H4.42969C2.53969%2015.2695%201%2016.1995%201%2018.6995C1%2021.1995%202.06%2024.6194%202.75%2026.9294C3.44%2029.2394%204.28969%2030.3595%206.17969%2030.3595H9.87988C11.7699%2030.3595%2012.6601%2029.3394%2013.3101%2026.9294C13.9701%2024.5094%2015.0601%2020.9195%2015.0601%2018.6995C15.0601%2016.4795%2013.5099%2015.2695%2011.6299%2015.2695Z'%20stroke='white'%20stroke-width='2'%20stroke-miterlimit='10'/%3e%3c/svg%3e";function iV({isSubFooter:p=!1}){const _=wc(),g=!Az?.includes(_.pathname)&&!p,v=[{label:"",img:xz,link:"/",class:"max-w-[34px] aspect-[34/29]"},{label:"",img:kz,link:"/",class:"max-w-[28px] aspect-[28/24]"},{label:"",img:Mz,link:"/",class:"max-w-[15px] aspect-[15/30]"}];return A.jsx("div",{className:"flex justify-center w-full h-max bg-dark-300",children:g?A.jsx("div",{className:"flex justify-between items-end w-full max-w-[768px] h-[72px] pb-[23px] px-11",children:v.map(R=>A.jsxs(qi,{to:R.link,className:"flex flex-col items-center gap-[5px]",children:[A.jsx("img",{src:R.img,alt:R.label,className:`w-full ${R.class}`}),A.jsx("p",{className:"text-[8px] leading-[10px] text-white",children:R.label})]},R.label))}):A.jsx("div",{className:"flex items-end w-full max-w-[768px] h-[117px] pb-[14px] px-[10px]",children:A.jsx("p",{className:"text-[8px] leading-[10px] text-white",children:"@Creative & Planning by New Company.2026"})})})}const jR="data:image/svg+xml,%3csvg%20width='9'%20height='7'%20viewBox='0%200%209%207'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0.382812%200.318359L4.45279%205.2583L8.5228%200.318359'%20stroke='%23DCDCDC'%20stroke-miterlimit='10'/%3e%3c/svg%3e";function Uz({showMore:p,hiddenList:_,hiddenCopyRight:g}){const v=[{label:"FutureVintage",link:"/"},{label:"",link:"/"},{label:"",link:"/"}];return A.jsxs("div",{className:"policy-term flex flex-col items-center w-full mt-auto",children:[(!g||!_)&&A.jsxs("div",{className:"flex flex-col gap-6 w-full max-w-[768px] pb-3 px-[10px]",children:[!_&&A.jsxs("div",{className:"flex flex-col gap-[23px]",children:[p&&A.jsxs(A.Fragment,{children:[A.jsxs("button",{className:"flex justify-between items-center cursor-pointer",children:[A.jsx("p",{className:"text-[11px] leading-[13px]",children:"FutureVintage"}),A.jsx("img",{src:jR,alt:"arrow",className:"w-2 h-[5px]"})]}),A.jsxs("button",{className:"flex justify-between items-center cursor-pointer",children:[A.jsx("p",{className:"text-[11px] leading-[13px]",children:""}),A.jsx("img",{src:jR,alt:"arrow",className:"w-2 h-[5px]"})]})]}),A.jsxs("div",{className:"group",children:[A.jsxs("label",{className:"flex justify-between items-center pb-4 border-b border-dark-200 cursor-pointer",children:[A.jsx("p",{className:"text-[11px] leading-[13px]",children:""}),A.jsx("img",{src:jR,alt:"arrow",className:"w-2 h-[5px] transition-transform duration-300 group-has-[input:checked]:[transform:rotateX(180deg)]"}),A.jsx("input",{type:"checkbox",className:"hidden"})]}),A.jsx("div",{className:"w-full max-h-0 overflow-hidden transition-[max-height] duration-300 group-has-[input:checked]:max-h-[170px]",children:A.jsx("div",{className:"flex flex-col gap-[29px] w-full pt-[21px] pb-[25px] px-1",children:v?.map((R,w)=>A.jsx(qi,{to:R?.link,className:"text-[11px] leading-[13px]",children:R?.label},w))})})]})]}),!g&&A.jsx("p",{className:"text-[8px] leading-[10px]",children:"@Creative & Planning by New Company.2026"})]}),A.jsx("div",{className:"flex justify-center w-full h-[45px] pt-4 bg-dark-300",children:A.jsx("img",{src:tV,alt:"logo",className:"w-full max-w-[121px] aspect-[121/18]"})})]})}function Vz(){const p=wc(),_=ie.useRef(null),g=wz?.includes(p.pathname),v=Iz?.includes(p.pathname),R=Oz?.includes(p.pathname),w=Nz?.includes(p.pathname),x=Dz?.includes(p.pathname);return ie.useLayoutEffect(()=>{_.current.scrollTo(0,0)},[p.pathname]),A.jsxs("div",{className:"main-layout flex flex-col items-center w-full h-full bg-dark-100",children:[A.jsx("header",{className:"flex justify-center w-full h-max bg-dark-100",children:A.jsx(Pz,{})}),A.jsxs("div",{ref:_,className:"relative body-container no-scrollbar flex flex-col items-center grow w-full overflow-auto",children:[A.jsx(zW,{context:_}),!v&&A.jsx(Uz,{showMore:R,hiddenCopyRight:x,hiddenList:w})]}),!g&&A.jsx("footer",{className:"w-full",children:A.jsx(iV,{})})]})}const Cc="data:image/svg+xml,%3csvg%20width='7'%20height='9'%20viewBox='0%200%207%209'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0.320312%208.52576L5.26031%204.45569L0.320312%200.385742'%20stroke='%23DBDBDB'%20stroke-miterlimit='10'/%3e%3c/svg%3e";function ln({isTopPage:p=!1,isAuth:_=!1,title:g="",handleBack:v,showBack:R}){const w=()=>p?_?A.jsx("p",{children:"Welcome Back"}):A.jsxs(A.Fragment,{children:[A.jsx(qi,{to:rt?.USER_REGISTRATION,className:"text-inherit no-underline",children:""}),A.jsx(qi,{to:rt?.LOGIN,className:"text-inherit no-underline",children:""})]}):A.jsx("p",{children:g});return(p||g)&&A.jsx("div",{className:`page-header flex justify-center w-full h-[39px] text-[11px] leading-[13px] text-white bg-dark-300 ${p&&!_&&"sticky top-0 z-[2]"}`,children:A.jsxs("div",{className:"relative flex justify-center items-center gap-[22px] w-full max-w-[768px] h-full px-[10px]",children:[w(),R&&A.jsx("button",{onClick:()=>v(),className:"absolute top-1/2 left-[10px] translate-y-[-50%]",children:A.jsx("img",{src:Cc,alt:"arrow",className:"[transform:rotateY(180deg)]"})})]})})}function I4(p){return p!==null&&typeof p=="object"&&"constructor"in p&&p.constructor===Object}function F2(p={},_={}){const g=["__proto__","constructor","prototype"];Object.keys(_).filter(v=>g.indexOf(v)<0).forEach(v=>{typeof p[v]>"u"?p[v]=_[v]:I4(_[v])&&I4(p[v])&&Object.keys(_[v]).length>0&&F2(p[v],_[v])})}const nV={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector(){return null},querySelectorAll(){return[]},getElementById(){return null},createEvent(){return{initEvent(){}}},createElement(){return{children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName(){return[]}}},createElementNS(){return{}},importNode(){return null},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function np(){const p=typeof document<"u"?document:{};return F2(p,nV),p}const jz={document:nV,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle(){return{getPropertyValue(){return""}}},Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia(){return{}},requestAnimationFrame(p){return typeof setTimeout>"u"?(p(),null):setTimeout(p,0)},cancelAnimationFrame(p){typeof setTimeout>"u"||clearTimeout(p)}};function ca(){const p=typeof window<"u"?window:{};return F2(p,jz),p}function Bz(p=""){return p.trim().split(" ").filter(_=>!!_.trim())}function Fz(p){const _=p;Object.keys(_).forEach(g=>{try{_[g]=null}catch{}try{delete _[g]}catch{}})}function rV(p,_=0){return setTimeout(p,_)}function GR(){return Date.now()}function Gz(p){const _=ca();let g;return _.getComputedStyle&&(g=_.getComputedStyle(p,null)),!g&&p.currentStyle&&(g=p.currentStyle),g||(g=p.style),g}function Hz(p,_="x"){const g=ca();let v,R,w;const x=Gz(p);return g.WebKitCSSMatrix?(R=x.transform||x.webkitTransform,R.split(",").length>6&&(R=R.split(", ").map(W=>W.replace(",",".")).join(", ")),w=new g.WebKitCSSMatrix(R==="none"?"":R)):(w=x.MozTransform||x.OTransform||x.MsTransform||x.msTransform||x.transform||x.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),v=w.toString().split(",")),_==="x"&&(g.WebKitCSSMatrix?R=w.m41:v.length===16?R=parseFloat(v[12]):R=parseFloat(v[4])),_==="y"&&(g.WebKitCSSMatrix?R=w.m42:v.length===16?R=parseFloat(v[13]):R=parseFloat(v[5])),R||0}function kR(p){return typeof p=="object"&&p!==null&&p.constructor&&Object.prototype.toString.call(p).slice(8,-1)==="Object"}function Wz(p){return typeof window<"u"&&typeof window.HTMLElement<"u"?p instanceof HTMLElement:p&&(p.nodeType===1||p.nodeType===11)}function rs(...p){const _=Object(p[0]),g=["__proto__","constructor","prototype"];for(let v=1;v<p.length;v+=1){const R=p[v];if(R!=null&&!Wz(R)){const w=Object.keys(Object(R)).filter(x=>g.indexOf(x)<0);for(let x=0,W=w.length;x<W;x+=1){const P=w[x],V=Object.getOwnPropertyDescriptor(R,P);V!==void 0&&V.enumerable&&(kR(_[P])&&kR(R[P])?R[P].__swiper__?_[P]=R[P]:rs(_[P],R[P]):!kR(_[P])&&kR(R[P])?(_[P]={},R[P].__swiper__?_[P]=R[P]:rs(_[P],R[P])):_[P]=R[P])}}}return _}function MR(p,_,g){p.style.setProperty(_,g)}function aV({swiper:p,targetPosition:_,side:g}){const v=ca(),R=-p.translate;let w=null,x;const W=p.params.speed;p.wrapperEl.style.scrollSnapType="none",v.cancelAnimationFrame(p.cssModeFrameID);const P=_>R?"next":"prev",V=(z,ce)=>P==="next"&&z>=ce||P==="prev"&&z<=ce,q=()=>{x=new Date().getTime(),w===null&&(w=x);const z=Math.max(Math.min((x-w)/W,1),0),ce=.5-Math.cos(z*Math.PI)/2;let Z=R+ce*(_-R);if(V(Z,_)&&(Z=_),p.wrapperEl.scrollTo({[g]:Z}),V(Z,_)){p.wrapperEl.style.overflow="hidden",p.wrapperEl.style.scrollSnapType="",setTimeout(()=>{p.wrapperEl.style.overflow="",p.wrapperEl.scrollTo({[g]:Z})}),v.cancelAnimationFrame(p.cssModeFrameID);return}p.cssModeFrameID=v.requestAnimationFrame(q)};q()}function yc(p,_=""){const g=ca(),v=[...p.children];return g.HTMLSlotElement&&p instanceof HTMLSlotElement&&v.push(...p.assignedElements()),_?v.filter(R=>R.matches(_)):v}function zz(p,_){const g=[_];for(;g.length>0;){const v=g.shift();if(p===v)return!0;g.push(...v.children,...v.shadowRoot?v.shadowRoot.children:[],...v.assignedElements?v.assignedElements():[])}}function Kz(p,_){const g=ca();let v=_.contains(p);return!v&&g.HTMLSlotElement&&_ instanceof HTMLSlotElement&&(v=[..._.assignedElements()].includes(p),v||(v=zz(p,_))),v}function HR(p){try{console.warn(p);return}catch{}}function WR(p,_=[]){const g=document.createElement(p);return g.classList.add(...Array.isArray(_)?_:Bz(_)),g}function Yz(p,_){const g=[];for(;p.previousElementSibling;){const v=p.previousElementSibling;_?v.matches(_)&&g.push(v):g.push(v),p=v}return g}function qz(p,_){const g=[];for(;p.nextElementSibling;){const v=p.nextElementSibling;_?v.matches(_)&&g.push(v):g.push(v),p=v}return g}function su(p,_){return ca().getComputedStyle(p,null).getPropertyValue(_)}function zR(p){let _=p,g;if(_){for(g=0;(_=_.previousSibling)!==null;)_.nodeType===1&&(g+=1);return g}}function sV(p,_){const g=[];let v=p.parentElement;for(;v;)_?v.matches(_)&&g.push(v):g.push(v),v=v.parentElement;return g}function w2(p,_,g){const v=ca();return p[_==="width"?"offsetWidth":"offsetHeight"]+parseFloat(v.getComputedStyle(p,null).getPropertyValue(_==="width"?"margin-right":"margin-top"))+parseFloat(v.getComputedStyle(p,null).getPropertyValue(_==="width"?"margin-left":"margin-bottom"))}function gr(p){return(Array.isArray(p)?p:[p]).filter(_=>!!_)}function D0(p,_=""){typeof trustedTypes<"u"?p.innerHTML=trustedTypes.createPolicy("html",{createHTML:g=>g}).createHTML(_):p.innerHTML=_}let E2;function Xz(){const p=ca(),_=np();return{smoothScroll:_.documentElement&&_.documentElement.style&&"scrollBehavior"in _.documentElement.style,touch:!!("ontouchstart"in p||p.DocumentTouch&&_ instanceof p.DocumentTouch)}}function oV(){return E2||(E2=Xz()),E2}let g2;function Jz({userAgent:p}={}){const _=oV(),g=ca(),v=g.navigator.platform,R=p||g.navigator.userAgent,w={ios:!1,android:!1},x=g.screen.width,W=g.screen.height,P=R.match(/(Android);?[\s\/]+([\d.]+)?/);let V=R.match(/(iPad)(?!\1).*OS\s([\d_]+)/);const q=R.match(/(iPod)(.*OS\s([\d_]+))?/),z=!V&&R.match(/(iPhone\sOS|iOS)\s([\d_]+)/),ce=v==="Win32";let Z=v==="MacIntel";const ae=["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"];return!V&&Z&&_.touch&&ae.indexOf(`${x}x${W}`)>=0&&(V=R.match(/(Version)\/([\d.]+)/),V||(V=[0,1,"13_0_0"]),Z=!1),P&&!ce&&(w.os="android",w.android=!0),(V||z||q)&&(w.os="ios",w.ios=!0),w}function cV(p={}){return g2||(g2=Jz(p)),g2}let S2;function Zz(){const p=ca(),_=cV();let g=!1;function v(){const W=p.navigator.userAgent.toLowerCase();return W.indexOf("safari")>=0&&W.indexOf("chrome")<0&&W.indexOf("android")<0}if(v()){const W=String(p.navigator.userAgent);if(W.includes("Version/")){const[P,V]=W.split("Version/")[1].split(" ")[0].split(".").map(q=>Number(q));g=P<16||P===16&&V<2}}const R=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(p.navigator.userAgent),w=v(),x=w||R&&_.ios;return{isSafari:g||w,needPerspectiveFix:g,need3dFix:x,isWebView:R}}function lV(){return S2||(S2=Zz()),S2}function Qz({swiper:p,on:_,emit:g}){const v=ca();let R=null,w=null;const x=()=>{!p||p.destroyed||!p.initialized||(g("beforeResize"),g("resize"))},W=()=>{!p||p.destroyed||!p.initialized||(R=new ResizeObserver(q=>{w=v.requestAnimationFrame(()=>{const{width:z,height:ce}=p;let Z=z,ae=ce;q.forEach(({contentBoxSize:ne,contentRect:se,target:Q})=>{Q&&Q!==p.el||(Z=se?se.width:(ne[0]||ne).inlineSize,ae=se?se.height:(ne[0]||ne).blockSize)}),(Z!==z||ae!==ce)&&x()})}),R.observe(p.el))},P=()=>{w&&v.cancelAnimationFrame(w),R&&R.unobserve&&p.el&&(R.unobserve(p.el),R=null)},V=()=>{!p||p.destroyed||!p.initialized||g("orientationchange")};_("init",()=>{if(p.params.resizeObserver&&typeof v.ResizeObserver<"u"){W();return}v.addEventListener("resize",x),v.addEventListener("orientationchange",V)}),_("destroy",()=>{P(),v.removeEventListener("resize",x),v.removeEventListener("orientationchange",V)})}function $z({swiper:p,extendParams:_,on:g,emit:v}){const R=[],w=ca(),x=(V,q={})=>{const z=w.MutationObserver||w.WebkitMutationObserver,ce=new z(Z=>{if(p.__preventObserver__)return;if(Z.length===1){v("observerUpdate",Z[0]);return}const ae=function(){v("observerUpdate",Z[0])};w.requestAnimationFrame?w.requestAnimationFrame(ae):w.setTimeout(ae,0)});ce.observe(V,{attributes:typeof q.attributes>"u"?!0:q.attributes,childList:p.isElement||(typeof q.childList>"u"?!0:q).childList,characterData:typeof q.characterData>"u"?!0:q.characterData}),R.push(ce)},W=()=>{if(p.params.observer){if(p.params.observeParents){const V=sV(p.hostEl);for(let q=0;q<V.length;q+=1)x(V[q])}x(p.hostEl,{childList:p.params.observeSlideChildren}),x(p.wrapperEl,{attributes:!1})}},P=()=>{R.forEach(V=>{V.disconnect()}),R.splice(0,R.length)};_({observer:!1,observeParents:!1,observeSlideChildren:!1}),g("init",W),g("destroy",P)}var eK={on(p,_,g){const v=this;if(!v.eventsListeners||v.destroyed||typeof _!="function")return v;const R=g?"unshift":"push";return p.split(" ").forEach(w=>{v.eventsListeners[w]||(v.eventsListeners[w]=[]),v.eventsListeners[w][R](_)}),v},once(p,_,g){const v=this;if(!v.eventsListeners||v.destroyed||typeof _!="function")return v;function R(...w){v.off(p,R),R.__emitterProxy&&delete R.__emitterProxy,_.apply(v,w)}return R.__emitterProxy=_,v.on(p,R,g)},onAny(p,_){const g=this;if(!g.eventsListeners||g.destroyed||typeof p!="function")return g;const v=_?"unshift":"push";return g.eventsAnyListeners.indexOf(p)<0&&g.eventsAnyListeners[v](p),g},offAny(p){const _=this;if(!_.eventsListeners||_.destroyed||!_.eventsAnyListeners)return _;const g=_.eventsAnyListeners.indexOf(p);return g>=0&&_.eventsAnyListeners.splice(g,1),_},off(p,_){const g=this;return!g.eventsListeners||g.destroyed||!g.eventsListeners||p.split(" ").forEach(v=>{typeof _>"u"?g.eventsListeners[v]=[]:g.eventsListeners[v]&&g.eventsListeners[v].forEach((R,w)=>{(R===_||R.__emitterProxy&&R.__emitterProxy===_)&&g.eventsListeners[v].splice(w,1)})}),g},emit(...p){const _=this;if(!_.eventsListeners||_.destroyed||!_.eventsListeners)return _;let g,v,R;return typeof p[0]=="string"||Array.isArray(p[0])?(g=p[0],v=p.slice(1,p.length),R=_):(g=p[0].events,v=p[0].data,R=p[0].context||_),v.unshift(R),(Array.isArray(g)?g:g.split(" ")).forEach(x=>{_.eventsAnyListeners&&_.eventsAnyListeners.length&&_.eventsAnyListeners.forEach(W=>{W.apply(R,[x,...v])}),_.eventsListeners&&_.eventsListeners[x]&&_.eventsListeners[x].forEach(W=>{W.apply(R,v)})}),_}};function tK(){const p=this;let _,g;const v=p.el;typeof p.params.width<"u"&&p.params.width!==null?_=p.params.width:_=v.clientWidth,typeof p.params.height<"u"&&p.params.height!==null?g=p.params.height:g=v.clientHeight,!(_===0&&p.isHorizontal()||g===0&&p.isVertical())&&(_=_-parseInt(su(v,"padding-left")||0,10)-parseInt(su(v,"padding-right")||0,10),g=g-parseInt(su(v,"padding-top")||0,10)-parseInt(su(v,"padding-bottom")||0,10),Number.isNaN(_)&&(_=0),Number.isNaN(g)&&(g=0),Object.assign(p,{width:_,height:g,size:p.isHorizontal()?_:g}))}function iK(){const p=this;function _(qe,Qe){return parseFloat(qe.getPropertyValue(p.getDirectionLabel(Qe))||0)}const g=p.params,{wrapperEl:v,slidesEl:R,rtlTranslate:w,wrongRTL:x}=p,W=p.virtual&&g.virtual.enabled,P=W?p.virtual.slides.length:p.slides.length,V=yc(R,`.${p.params.slideClass}, swiper-slide`),q=W?p.virtual.slides.length:V.length;let z=[];const ce=[],Z=[];let ae=g.slidesOffsetBefore;typeof ae=="function"&&(ae=g.slidesOffsetBefore.call(p));let ne=g.slidesOffsetAfter;typeof ne=="function"&&(ne=g.slidesOffsetAfter.call(p));const se=p.snapGrid.length,Q=p.slidesGrid.length,oe=p.size-ae-ne;let fe=g.spaceBetween,Ue=-ae,Ne=0,ft=0;if(typeof oe>"u")return;typeof fe=="string"&&fe.indexOf("%")>=0?fe=parseFloat(fe.replace("%",""))/100*oe:typeof fe=="string"&&(fe=parseFloat(fe)),p.virtualSize=-fe-ae-ne,V.forEach(qe=>{w?qe.style.marginLeft="":qe.style.marginRight="",qe.style.marginBottom="",qe.style.marginTop=""}),g.centeredSlides&&g.cssMode&&(MR(v,"--swiper-centered-offset-before",""),MR(v,"--swiper-centered-offset-after",""));const $e=g.grid&&g.grid.rows>1&&p.grid;$e?p.grid.initSlides(V):p.grid&&p.grid.unsetSlides();let De;const Et=g.slidesPerView==="auto"&&g.breakpoints&&Object.keys(g.breakpoints).filter(qe=>typeof g.breakpoints[qe].slidesPerView<"u").length>0;for(let qe=0;qe<q;qe+=1){De=0;const Qe=V[qe];if(!(Qe&&($e&&p.grid.updateSlide(qe,Qe,V),su(Qe,"display")==="none"))){if(W&&g.slidesPerView==="auto")g.virtual.slidesPerViewAutoSlideSize&&(De=g.virtual.slidesPerViewAutoSlideSize),De&&Qe&&(g.roundLengths&&(De=Math.floor(De)),Qe.style[p.getDirectionLabel("width")]=`${De}px`);else if(g.slidesPerView==="auto"){Et&&(Qe.style[p.getDirectionLabel("width")]="");const Ye=getComputedStyle(Qe),Vt=Qe.style.transform,Ct=Qe.style.webkitTransform;if(Vt&&(Qe.style.transform="none"),Ct&&(Qe.style.webkitTransform="none"),g.roundLengths)De=p.isHorizontal()?w2(Qe,"width"):w2(Qe,"height");else{const ui=_(Ye,"width"),Le=_(Ye,"padding-left"),ze=_(Ye,"padding-right"),We=_(Ye,"margin-left"),Tt=_(Ye,"margin-right"),le=Ye.getPropertyValue("box-sizing");if(le&&le==="border-box")De=ui+We+Tt;else{const{clientWidth:Ge,offsetWidth:tt}=Qe;De=ui+Le+ze+We+Tt+(tt-Ge)}}Vt&&(Qe.style.transform=Vt),Ct&&(Qe.style.webkitTransform=Ct),g.roundLengths&&(De=Math.floor(De))}else De=(oe-(g.slidesPerView-1)*fe)/g.slidesPerView,g.roundLengths&&(De=Math.floor(De)),Qe&&(Qe.style[p.getDirectionLabel("width")]=`${De}px`);Qe&&(Qe.swiperSlideSize=De),Z.push(De),g.centeredSlides?(Ue=Ue+De/2+Ne/2+fe,Ne===0&&qe!==0&&(Ue=Ue-oe/2-fe),qe===0&&(Ue=Ue-oe/2-fe),Math.abs(Ue)<1/1e3&&(Ue=0),g.roundLengths&&(Ue=Math.floor(Ue)),ft%g.slidesPerGroup===0&&z.push(Ue),ce.push(Ue)):(g.roundLengths&&(Ue=Math.floor(Ue)),(ft-Math.min(p.params.slidesPerGroupSkip,ft))%p.params.slidesPerGroup===0&&z.push(Ue),ce.push(Ue),Ue=Ue+De+fe),p.virtualSize+=De+fe,Ne=De,ft+=1}}if(p.virtualSize=Math.max(p.virtualSize,oe)+ne,w&&x&&(g.effect==="slide"||g.effect==="coverflow")&&(v.style.width=`${p.virtualSize+fe}px`),g.setWrapperSize&&(v.style[p.getDirectionLabel("width")]=`${p.virtualSize+fe}px`),$e&&p.grid.updateWrapperSize(De,z),!g.centeredSlides){const qe=[];for(let Qe=0;Qe<z.length;Qe+=1){let Ye=z[Qe];g.roundLengths&&(Ye=Math.floor(Ye)),z[Qe]<=p.virtualSize-oe&&qe.push(Ye)}z=qe,Math.floor(p.virtualSize-oe)-Math.floor(z[z.length-1])>1&&z.push(p.virtualSize-oe)}if(W&&g.loop){const qe=Z[0]+fe;if(g.slidesPerGroup>1){const Qe=Math.ceil((p.virtual.slidesBefore+p.virtual.slidesAfter)/g.slidesPerGroup),Ye=qe*g.slidesPerGroup;for(let Vt=0;Vt<Qe;Vt+=1)z.push(z[z.length-1]+Ye)}for(let Qe=0;Qe<p.virtual.slidesBefore+p.virtual.slidesAfter;Qe+=1)g.slidesPerGroup===1&&z.push(z[z.length-1]+qe),ce.push(ce[ce.length-1]+qe),p.virtualSize+=qe}if(z.length===0&&(z=[0]),fe!==0){const qe=p.isHorizontal()&&w?"marginLeft":p.getDirectionLabel("marginRight");V.filter((Qe,Ye)=>!g.cssMode||g.loop?!0:Ye!==V.length-1).forEach(Qe=>{Qe.style[qe]=`${fe}px`})}if(g.centeredSlides&&g.centeredSlidesBounds){let qe=0;Z.forEach(Ye=>{qe+=Ye+(fe||0)}),qe-=fe;const Qe=qe>oe?qe-oe:0;z=z.map(Ye=>Ye<=0?-ae:Ye>Qe?Qe+ne:Ye)}if(g.centerInsufficientSlides){let qe=0;Z.forEach(Ye=>{qe+=Ye+(fe||0)}),qe-=fe;const Qe=(ae||0)+(ne||0);if(qe+Qe<oe){const Ye=(oe-qe-Qe)/2;z.forEach((Vt,Ct)=>{z[Ct]=Vt-Ye}),ce.forEach((Vt,Ct)=>{ce[Ct]=Vt+Ye})}}if(Object.assign(p,{slides:V,snapGrid:z,slidesGrid:ce,slidesSizesGrid:Z}),g.centeredSlides&&g.cssMode&&!g.centeredSlidesBounds){MR(v,"--swiper-centered-offset-before",`${-z[0]}px`),MR(v,"--swiper-centered-offset-after",`${p.size/2-Z[Z.length-1]/2}px`);const qe=-p.snapGrid[0],Qe=-p.slidesGrid[0];p.snapGrid=p.snapGrid.map(Ye=>Ye+qe),p.slidesGrid=p.slidesGrid.map(Ye=>Ye+Qe)}if(q!==P&&p.emit("slidesLengthChange"),z.length!==se&&(p.params.watchOverflow&&p.checkOverflow(),p.emit("snapGridLengthChange")),ce.length!==Q&&p.emit("slidesGridLengthChange"),g.watchSlidesProgress&&p.updateSlidesOffset(),p.emit("slidesUpdated"),!W&&!g.cssMode&&(g.effect==="slide"||g.effect==="fade")){const qe=`${g.containerModifierClass}backface-hidden`,Qe=p.el.classList.contains(qe);q<=g.maxBackfaceHiddenSlides?Qe||p.el.classList.add(qe):Qe&&p.el.classList.remove(qe)}}function nK(p){const _=this,g=[],v=_.virtual&&_.params.virtual.enabled;let R=0,w;typeof p=="number"?_.setTransition(p):p===!0&&_.setTransition(_.params.speed);const x=W=>v?_.slides[_.getSlideIndexByData(W)]:_.slides[W];if(_.params.slidesPerView!=="auto"&&_.params.slidesPerView>1)if(_.params.centeredSlides)(_.visibleSlides||[]).forEach(W=>{g.push(W)});else for(w=0;w<Math.ceil(_.params.slidesPerView);w+=1){const W=_.activeIndex+w;if(W>_.slides.length&&!v)break;g.push(x(W))}else g.push(x(_.activeIndex));for(w=0;w<g.length;w+=1)if(typeof g[w]<"u"){const W=g[w].offsetHeight;R=W>R?W:R}(R||R===0)&&(_.wrapperEl.style.height=`${R}px`)}function rK(){const p=this,_=p.slides,g=p.isElement?p.isHorizontal()?p.wrapperEl.offsetLeft:p.wrapperEl.offsetTop:0;for(let v=0;v<_.length;v+=1)_[v].swiperSlideOffset=(p.isHorizontal()?_[v].offsetLeft:_[v].offsetTop)-g-p.cssOverflowAdjustment()}const O4=(p,_,g)=>{_&&!p.classList.contains(g)?p.classList.add(g):!_&&p.classList.contains(g)&&p.classList.remove(g)};function aK(p=this&&this.translate||0){const _=this,g=_.params,{slides:v,rtlTranslate:R,snapGrid:w}=_;if(v.length===0)return;typeof v[0].swiperSlideOffset>"u"&&_.updateSlidesOffset();let x=-p;R&&(x=p),_.visibleSlidesIndexes=[],_.visibleSlides=[];let W=g.spaceBetween;typeof W=="string"&&W.indexOf("%")>=0?W=parseFloat(W.replace("%",""))/100*_.size:typeof W=="string"&&(W=parseFloat(W));for(let P=0;P<v.length;P+=1){const V=v[P];let q=V.swiperSlideOffset;g.cssMode&&g.centeredSlides&&(q-=v[0].swiperSlideOffset);const z=(x+(g.centeredSlides?_.minTranslate():0)-q)/(V.swiperSlideSize+W),ce=(x-w[0]+(g.centeredSlides?_.minTranslate():0)-q)/(V.swiperSlideSize+W),Z=-(x-q),ae=Z+_.slidesSizesGrid[P],ne=Z>=0&&Z<=_.size-_.slidesSizesGrid[P],se=Z>=0&&Z<_.size-1||ae>1&&ae<=_.size||Z<=0&&ae>=_.size;se&&(_.visibleSlides.push(V),_.visibleSlidesIndexes.push(P)),O4(V,se,g.slideVisibleClass),O4(V,ne,g.slideFullyVisibleClass),V.progress=R?-z:z,V.originalProgress=R?-ce:ce}}function sK(p){const _=this;if(typeof p>"u"){const q=_.rtlTranslate?-1:1;p=_&&_.translate&&_.translate*q||0}const g=_.params,v=_.maxTranslate()-_.minTranslate();let{progress:R,isBeginning:w,isEnd:x,progressLoop:W}=_;const P=w,V=x;if(v===0)R=0,w=!0,x=!0;else{R=(p-_.minTranslate())/v;const q=Math.abs(p-_.minTranslate())<1,z=Math.abs(p-_.maxTranslate())<1;w=q||R<=0,x=z||R>=1,q&&(R=0),z&&(R=1)}if(g.loop){const q=_.getSlideIndexByData(0),z=_.getSlideIndexByData(_.slides.length-1),ce=_.slidesGrid[q],Z=_.slidesGrid[z],ae=_.slidesGrid[_.slidesGrid.length-1],ne=Math.abs(p);ne>=ce?W=(ne-ce)/ae:W=(ne+ae-Z)/ae,W>1&&(W-=1)}Object.assign(_,{progress:R,progressLoop:W,isBeginning:w,isEnd:x}),(g.watchSlidesProgress||g.centeredSlides&&g.autoHeight)&&_.updateSlidesProgress(p),w&&!P&&_.emit("reachBeginning toEdge"),x&&!V&&_.emit("reachEnd toEdge"),(P&&!w||V&&!x)&&_.emit("fromEdge"),_.emit("progress",R)}const v2=(p,_,g)=>{_&&!p.classList.contains(g)?p.classList.add(g):!_&&p.classList.contains(g)&&p.classList.remove(g)};function oK(){const p=this,{slides:_,params:g,slidesEl:v,activeIndex:R}=p,w=p.virtual&&g.virtual.enabled,x=p.grid&&g.grid&&g.grid.rows>1,W=z=>yc(v,`.${g.slideClass}${z}, swiper-slide${z}`)[0];let P,V,q;if(w)if(g.loop){let z=R-p.virtual.slidesBefore;z<0&&(z=p.virtual.slides.length+z),z>=p.virtual.slides.length&&(z-=p.virtual.slides.length),P=W(`[data-swiper-slide-index="${z}"]`)}else P=W(`[data-swiper-slide-index="${R}"]`);else x?(P=_.find(z=>z.column===R),q=_.find(z=>z.column===R+1),V=_.find(z=>z.column===R-1)):P=_[R];P&&(x||(q=qz(P,`.${g.slideClass}, swiper-slide`)[0],g.loop&&!q&&(q=_[0]),V=Yz(P,`.${g.slideClass}, swiper-slide`)[0],g.loop&&!V===0&&(V=_[_.length-1]))),_.forEach(z=>{v2(z,z===P,g.slideActiveClass),v2(z,z===q,g.slideNextClass),v2(z,z===V,g.slidePrevClass)}),p.emitSlidesClasses()}const BR=(p,_)=>{if(!p||p.destroyed||!p.params)return;const g=()=>p.isElement?"swiper-slide":`.${p.params.slideClass}`,v=_.closest(g());if(v){let R=v.querySelector(`.${p.params.lazyPreloaderClass}`);!R&&p.isElement&&(v.shadowRoot?R=v.shadowRoot.querySelector(`.${p.params.lazyPreloaderClass}`):requestAnimationFrame(()=>{v.shadowRoot&&(R=v.shadowRoot.querySelector(`.${p.params.lazyPreloaderClass}`),R&&R.remove())})),R&&R.remove()}},T2=(p,_)=>{if(!p.slides[_])return;const g=p.slides[_].querySelector('[loading="lazy"]');g&&g.removeAttribute("loading")},I2=p=>{if(!p||p.destroyed||!p.params)return;let _=p.params.lazyPreloadPrevNext;const g=p.slides.length;if(!g||!_||_<0)return;_=Math.min(_,g);const v=p.params.slidesPerView==="auto"?p.slidesPerViewDynamic():Math.ceil(p.params.slidesPerView),R=p.activeIndex;if(p.params.grid&&p.params.grid.rows>1){const x=R,W=[x-_];W.push(...Array.from({length:_}).map((P,V)=>x+v+V)),p.slides.forEach((P,V)=>{W.includes(P.column)&&T2(p,V)});return}const w=R+v-1;if(p.params.rewind||p.params.loop)for(let x=R-_;x<=w+_;x+=1){const W=(x%g+g)%g;(W<R||W>w)&&T2(p,W)}else for(let x=Math.max(R-_,0);x<=Math.min(w+_,g-1);x+=1)x!==R&&(x>w||x<R)&&T2(p,x)};function cK(p){const{slidesGrid:_,params:g}=p,v=p.rtlTranslate?p.translate:-p.translate;let R;for(let w=0;w<_.length;w+=1)typeof _[w+1]<"u"?v>=_[w]&&v<_[w+1]-(_[w+1]-_[w])/2?R=w:v>=_[w]&&v<_[w+1]&&(R=w+1):v>=_[w]&&(R=w);return g.normalizeSlideIndex&&(R<0||typeof R>"u")&&(R=0),R}function lK(p){const _=this,g=_.rtlTranslate?_.translate:-_.translate,{snapGrid:v,params:R,activeIndex:w,realIndex:x,snapIndex:W}=_;let P=p,V;const q=Z=>{let ae=Z-_.virtual.slidesBefore;return ae<0&&(ae=_.virtual.slides.length+ae),ae>=_.virtual.slides.length&&(ae-=_.virtual.slides.length),ae};if(typeof P>"u"&&(P=cK(_)),v.indexOf(g)>=0)V=v.indexOf(g);else{const Z=Math.min(R.slidesPerGroupSkip,P);V=Z+Math.floor((P-Z)/R.slidesPerGroup)}if(V>=v.length&&(V=v.length-1),P===w&&!_.params.loop){V!==W&&(_.snapIndex=V,_.emit("snapIndexChange"));return}if(P===w&&_.params.loop&&_.virtual&&_.params.virtual.enabled){_.realIndex=q(P);return}const z=_.grid&&R.grid&&R.grid.rows>1;let ce;if(_.virtual&&R.virtual.enabled&&R.loop)ce=q(P);else if(z){const Z=_.slides.find(ne=>ne.column===P);let ae=parseInt(Z.getAttribute("data-swiper-slide-index"),10);Number.isNaN(ae)&&(ae=Math.max(_.slides.indexOf(Z),0)),ce=Math.floor(ae/R.grid.rows)}else if(_.slides[P]){const Z=_.slides[P].getAttribute("data-swiper-slide-index");Z?ce=parseInt(Z,10):ce=P}else ce=P;Object.assign(_,{previousSnapIndex:W,snapIndex:V,previousRealIndex:x,realIndex:ce,previousIndex:w,activeIndex:P}),_.initialized&&I2(_),_.emit("activeIndexChange"),_.emit("snapIndexChange"),(_.initialized||_.params.runCallbacksOnInit)&&(x!==ce&&_.emit("realIndexChange"),_.emit("slideChange"))}function dK(p,_){const g=this,v=g.params;let R=p.closest(`.${v.slideClass}, swiper-slide`);!R&&g.isElement&&_&&_.length>1&&_.includes(p)&&[..._.slice(_.indexOf(p)+1,_.length)].forEach(W=>{!R&&W.matches&&W.matches(`.${v.slideClass}, swiper-slide`)&&(R=W)});let w=!1,x;if(R){for(let W=0;W<g.slides.length;W+=1)if(g.slides[W]===R){w=!0,x=W;break}}if(R&&w)g.clickedSlide=R,g.virtual&&g.params.virtual.enabled?g.clickedIndex=parseInt(R.getAttribute("data-swiper-slide-index"),10):g.clickedIndex=x;else{g.clickedSlide=void 0,g.clickedIndex=void 0;return}v.slideToClickedSlide&&g.clickedIndex!==void 0&&g.clickedIndex!==g.activeIndex&&g.slideToClickedSlide()}var uK={updateSize:tK,updateSlides:iK,updateAutoHeight:nK,updateSlidesOffset:rK,updateSlidesProgress:aK,updateProgress:sK,updateSlidesClasses:oK,updateActiveIndex:lK,updateClickedSlide:dK};function hK(p=this.isHorizontal()?"x":"y"){const _=this,{params:g,rtlTranslate:v,translate:R,wrapperEl:w}=_;if(g.virtualTranslate)return v?-R:R;if(g.cssMode)return R;let x=Hz(w,p);return x+=_.cssOverflowAdjustment(),v&&(x=-x),x||0}function pK(p,_){const g=this,{rtlTranslate:v,params:R,wrapperEl:w,progress:x}=g;let W=0,P=0;const V=0;g.isHorizontal()?W=v?-p:p:P=p,R.roundLengths&&(W=Math.floor(W),P=Math.floor(P)),g.previousTranslate=g.translate,g.translate=g.isHorizontal()?W:P,R.cssMode?w[g.isHorizontal()?"scrollLeft":"scrollTop"]=g.isHorizontal()?-W:-P:R.virtualTranslate||(g.isHorizontal()?W-=g.cssOverflowAdjustment():P-=g.cssOverflowAdjustment(),w.style.transform=`translate3d(${W}px, ${P}px, ${V}px)`);let q;const z=g.maxTranslate()-g.minTranslate();z===0?q=0:q=(p-g.minTranslate())/z,q!==x&&g.updateProgress(p),g.emit("setTranslate",g.translate,_)}function fK(){return-this.snapGrid[0]}function mK(){return-this.snapGrid[this.snapGrid.length-1]}function _K(p=0,_=this.params.speed,g=!0,v=!0,R){const w=this,{params:x,wrapperEl:W}=w;if(w.animating&&x.preventInteractionOnTransition)return!1;const P=w.minTranslate(),V=w.maxTranslate();let q;if(v&&p>P?q=P:v&&p<V?q=V:q=p,w.updateProgress(q),x.cssMode){const z=w.isHorizontal();if(_===0)W[z?"scrollLeft":"scrollTop"]=-q;else{if(!w.support.smoothScroll)return aV({swiper:w,targetPosition:-q,side:z?"left":"top"}),!0;W.scrollTo({[z?"left":"top"]:-q,behavior:"smooth"})}return!0}return _===0?(w.setTransition(0),w.setTranslate(q),g&&(w.emit("beforeTransitionStart",_,R),w.emit("transitionEnd"))):(w.setTransition(_),w.setTranslate(q),g&&(w.emit("beforeTransitionStart",_,R),w.emit("transitionStart")),w.animating||(w.animating=!0,w.onTranslateToWrapperTransitionEnd||(w.onTranslateToWrapperTransitionEnd=function(ce){!w||w.destroyed||ce.target===this&&(w.wrapperEl.removeEventListener("transitionend",w.onTranslateToWrapperTransitionEnd),w.onTranslateToWrapperTransitionEnd=null,delete w.onTranslateToWrapperTransitionEnd,w.animating=!1,g&&w.emit("transitionEnd"))}),w.wrapperEl.addEventListener("transitionend",w.onTranslateToWrapperTransitionEnd))),!0}var EK={getTranslate:hK,setTranslate:pK,minTranslate:fK,maxTranslate:mK,translateTo:_K};function gK(p,_){const g=this;g.params.cssMode||(g.wrapperEl.style.transitionDuration=`${p}ms`,g.wrapperEl.style.transitionDelay=p===0?"0ms":""),g.emit("setTransition",p,_)}function dV({swiper:p,runCallbacks:_,direction:g,step:v}){const{activeIndex:R,previousIndex:w}=p;let x=g;x||(R>w?x="next":R<w?x="prev":x="reset"),p.emit(`transition${v}`),_&&x==="reset"?p.emit(`slideResetTransition${v}`):_&&R!==w&&(p.emit(`slideChangeTransition${v}`),x==="next"?p.emit(`slideNextTransition${v}`):p.emit(`slidePrevTransition${v}`))}function SK(p=!0,_){const g=this,{params:v}=g;v.cssMode||(v.autoHeight&&g.updateAutoHeight(),dV({swiper:g,runCallbacks:p,direction:_,step:"Start"}))}function vK(p=!0,_){const g=this,{params:v}=g;g.animating=!1,!v.cssMode&&(g.setTransition(0),dV({swiper:g,runCallbacks:p,direction:_,step:"End"}))}var TK={setTransition:gK,transitionStart:SK,transitionEnd:vK};function yK(p=0,_,g=!0,v,R){typeof p=="string"&&(p=parseInt(p,10));const w=this;let x=p;x<0&&(x=0);const{params:W,snapGrid:P,slidesGrid:V,previousIndex:q,activeIndex:z,rtlTranslate:ce,wrapperEl:Z,enabled:ae}=w;if(!ae&&!v&&!R||w.destroyed||w.animating&&W.preventInteractionOnTransition)return!1;typeof _>"u"&&(_=w.params.speed);const ne=Math.min(w.params.slidesPerGroupSkip,x);let se=ne+Math.floor((x-ne)/w.params.slidesPerGroup);se>=P.length&&(se=P.length-1);const Q=-P[se];if(W.normalizeSlideIndex)for(let $e=0;$e<V.length;$e+=1){const De=-Math.floor(Q*100),Et=Math.floor(V[$e]*100),qe=Math.floor(V[$e+1]*100);typeof V[$e+1]<"u"?De>=Et&&De<qe-(qe-Et)/2?x=$e:De>=Et&&De<qe&&(x=$e+1):De>=Et&&(x=$e)}if(w.initialized&&x!==z&&(!w.allowSlideNext&&(ce?Q>w.translate&&Q>w.minTranslate():Q<w.translate&&Q<w.minTranslate())||!w.allowSlidePrev&&Q>w.translate&&Q>w.maxTranslate()&&(z||0)!==x))return!1;x!==(q||0)&&g&&w.emit("beforeSlideChangeStart"),w.updateProgress(Q);let oe;x>z?oe="next":x<z?oe="prev":oe="reset";const fe=w.virtual&&w.params.virtual.enabled;if(!(fe&&R)&&(ce&&-Q===w.translate||!ce&&Q===w.translate))return w.updateActiveIndex(x),W.autoHeight&&w.updateAutoHeight(),w.updateSlidesClasses(),W.effect!=="slide"&&w.setTranslate(Q),oe!=="reset"&&(w.transitionStart(g,oe),w.transitionEnd(g,oe)),!1;if(W.cssMode){const $e=w.isHorizontal(),De=ce?Q:-Q;if(_===0)fe&&(w.wrapperEl.style.scrollSnapType="none",w._immediateVirtual=!0),fe&&!w._cssModeVirtualInitialSet&&w.params.initialSlide>0?(w._cssModeVirtualInitialSet=!0,requestAnimationFrame(()=>{Z[$e?"scrollLeft":"scrollTop"]=De})):Z[$e?"scrollLeft":"scrollTop"]=De,fe&&requestAnimationFrame(()=>{w.wrapperEl.style.scrollSnapType="",w._immediateVirtual=!1});else{if(!w.support.smoothScroll)return aV({swiper:w,targetPosition:De,side:$e?"left":"top"}),!0;Z.scrollTo({[$e?"left":"top"]:De,behavior:"smooth"})}return!0}const ft=lV().isSafari;return fe&&!R&&ft&&w.isElement&&w.virtual.update(!1,!1,x),w.setTransition(_),w.setTranslate(Q),w.updateActiveIndex(x),w.updateSlidesClasses(),w.emit("beforeTransitionStart",_,v),w.transitionStart(g,oe),_===0?w.transitionEnd(g,oe):w.animating||(w.animating=!0,w.onSlideToWrapperTransitionEnd||(w.onSlideToWrapperTransitionEnd=function(De){!w||w.destroyed||De.target===this&&(w.wrapperEl.removeEventListener("transitionend",w.onSlideToWrapperTransitionEnd),w.onSlideToWrapperTransitionEnd=null,delete w.onSlideToWrapperTransitionEnd,w.transitionEnd(g,oe))}),w.wrapperEl.addEventListener("transitionend",w.onSlideToWrapperTransitionEnd)),!0}function RK(p=0,_,g=!0,v){typeof p=="string"&&(p=parseInt(p,10));const R=this;if(R.destroyed)return;typeof _>"u"&&(_=R.params.speed);const w=R.grid&&R.params.grid&&R.params.grid.rows>1;let x=p;if(R.params.loop)if(R.virtual&&R.params.virtual.enabled)x=x+R.virtual.slidesBefore;else{let W;if(w){const ne=x*R.params.grid.rows;W=R.slides.find(se=>se.getAttribute("data-swiper-slide-index")*1===ne).column}else W=R.getSlideIndexByData(x);const P=w?Math.ceil(R.slides.length/R.params.grid.rows):R.slides.length,{centeredSlides:V,slidesOffsetBefore:q,slidesOffsetAfter:z}=R.params,ce=V||!!q||!!z;let Z=R.params.slidesPerView;Z==="auto"?Z=R.slidesPerViewDynamic():(Z=Math.ceil(parseFloat(R.params.slidesPerView,10)),ce&&Z%2===0&&(Z=Z+1));let ae=P-W<Z;if(ce&&(ae=ae||W<Math.ceil(Z/2)),v&&ce&&R.params.slidesPerView!=="auto"&&!w&&(ae=!1),ae){const ne=ce?W<R.activeIndex?"prev":"next":W-R.activeIndex-1<R.params.slidesPerView?"next":"prev";R.loopFix({direction:ne,slideTo:!0,activeSlideIndex:ne==="next"?W+1:W-P+1,slideRealIndex:ne==="next"?R.realIndex:void 0})}if(w){const ne=x*R.params.grid.rows;x=R.slides.find(se=>se.getAttribute("data-swiper-slide-index")*1===ne).column}else x=R.getSlideIndexByData(x)}return requestAnimationFrame(()=>{R.slideTo(x,_,g,v)}),R}function CK(p,_=!0,g){const v=this,{enabled:R,params:w,animating:x}=v;if(!R||v.destroyed)return v;typeof p>"u"&&(p=v.params.speed);let W=w.slidesPerGroup;w.slidesPerView==="auto"&&w.slidesPerGroup===1&&w.slidesPerGroupAuto&&(W=Math.max(v.slidesPerViewDynamic("current",!0),1));const P=v.activeIndex<w.slidesPerGroupSkip?1:W,V=v.virtual&&w.virtual.enabled;if(w.loop){if(x&&!V&&w.loopPreventsSliding)return!1;if(v.loopFix({direction:"next"}),v._clientLeft=v.wrapperEl.clientLeft,v.activeIndex===v.slides.length-1&&w.cssMode)return requestAnimationFrame(()=>{v.slideTo(v.activeIndex+P,p,_,g)}),!0}return w.rewind&&v.isEnd?v.slideTo(0,p,_,g):v.slideTo(v.activeIndex+P,p,_,g)}function bK(p,_=!0,g){const v=this,{params:R,snapGrid:w,slidesGrid:x,rtlTranslate:W,enabled:P,animating:V}=v;if(!P||v.destroyed)return v;typeof p>"u"&&(p=v.params.speed);const q=v.virtual&&R.virtual.enabled;if(R.loop){if(V&&!q&&R.loopPreventsSliding)return!1;v.loopFix({direction:"prev"}),v._clientLeft=v.wrapperEl.clientLeft}const z=W?v.translate:-v.translate;function ce(oe){return oe<0?-Math.floor(Math.abs(oe)):Math.floor(oe)}const Z=ce(z),ae=w.map(oe=>ce(oe)),ne=R.freeMode&&R.freeMode.enabled;let se=w[ae.indexOf(Z)-1];if(typeof se>"u"&&(R.cssMode||ne)){let oe;w.forEach((fe,Ue)=>{Z>=fe&&(oe=Ue)}),typeof oe<"u"&&(se=ne?w[oe]:w[oe>0?oe-1:oe])}let Q=0;if(typeof se<"u"&&(Q=x.indexOf(se),Q<0&&(Q=v.activeIndex-1),R.slidesPerView==="auto"&&R.slidesPerGroup===1&&R.slidesPerGroupAuto&&(Q=Q-v.slidesPerViewDynamic("previous",!0)+1,Q=Math.max(Q,0))),R.rewind&&v.isBeginning){const oe=v.params.virtual&&v.params.virtual.enabled&&v.virtual?v.virtual.slides.length-1:v.slides.length-1;return v.slideTo(oe,p,_,g)}else if(R.loop&&v.activeIndex===0&&R.cssMode)return requestAnimationFrame(()=>{v.slideTo(Q,p,_,g)}),!0;return v.slideTo(Q,p,_,g)}function AK(p,_=!0,g){const v=this;if(!v.destroyed)return typeof p>"u"&&(p=v.params.speed),v.slideTo(v.activeIndex,p,_,g)}function wK(p,_=!0,g,v=.5){const R=this;if(R.destroyed)return;typeof p>"u"&&(p=R.params.speed);let w=R.activeIndex;const x=Math.min(R.params.slidesPerGroupSkip,w),W=x+Math.floor((w-x)/R.params.slidesPerGroup),P=R.rtlTranslate?R.translate:-R.translate;if(P>=R.snapGrid[W]){const V=R.snapGrid[W],q=R.snapGrid[W+1];P-V>(q-V)*v&&(w+=R.params.slidesPerGroup)}else{const V=R.snapGrid[W-1],q=R.snapGrid[W];P-V<=(q-V)*v&&(w-=R.params.slidesPerGroup)}return w=Math.max(w,0),w=Math.min(w,R.slidesGrid.length-1),R.slideTo(w,p,_,g)}function IK(){const p=this;if(p.destroyed)return;const{params:_,slidesEl:g}=p,v=_.slidesPerView==="auto"?p.slidesPerViewDynamic():_.slidesPerView;let R=p.getSlideIndexWhenGrid(p.clickedIndex),w;const x=p.isElement?"swiper-slide":`.${_.slideClass}`,W=p.grid&&p.params.grid&&p.params.grid.rows>1;if(_.loop){if(p.animating)return;w=parseInt(p.clickedSlide.getAttribute("data-swiper-slide-index"),10),_.centeredSlides?p.slideToLoop(w):R>(W?(p.slides.length-v)/2-(p.params.grid.rows-1):p.slides.length-v)?(p.loopFix(),R=p.getSlideIndex(yc(g,`${x}[data-swiper-slide-index="${w}"]`)[0]),rV(()=>{p.slideTo(R)})):p.slideTo(R)}else p.slideTo(R)}var OK={slideTo:yK,slideToLoop:RK,slideNext:CK,slidePrev:bK,slideReset:AK,slideToClosest:wK,slideToClickedSlide:IK};function NK(p,_){const g=this,{params:v,slidesEl:R}=g;if(!v.loop||g.virtual&&g.params.virtual.enabled)return;const w=()=>{yc(R,`.${v.slideClass}, swiper-slide`).forEach((ae,ne)=>{ae.setAttribute("data-swiper-slide-index",ne)})},x=()=>{const Z=yc(R,`.${v.slideBlankClass}`);Z.forEach(ae=>{ae.remove()}),Z.length>0&&(g.recalcSlides(),g.updateSlides())},W=g.grid&&v.grid&&v.grid.rows>1;v.loopAddBlankSlides&&(v.slidesPerGroup>1||W)&&x();const P=v.slidesPerGroup*(W?v.grid.rows:1),V=g.slides.length%P!==0,q=W&&g.slides.length%v.grid.rows!==0,z=Z=>{for(let ae=0;ae<Z;ae+=1){const ne=g.isElement?WR("swiper-slide",[v.slideBlankClass]):WR("div",[v.slideClass,v.slideBlankClass]);g.slidesEl.append(ne)}};if(V){if(v.loopAddBlankSlides){const Z=P-g.slides.length%P;z(Z),g.recalcSlides(),g.updateSlides()}else HR("Swiper Loop Warning: The number of slides is not even to slidesPerGroup, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");w()}else if(q){if(v.loopAddBlankSlides){const Z=v.grid.rows-g.slides.length%v.grid.rows;z(Z),g.recalcSlides(),g.updateSlides()}else HR("Swiper Loop Warning: The number of slides is not even to grid.rows, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");w()}else w();const ce=v.centeredSlides||!!v.slidesOffsetBefore||!!v.slidesOffsetAfter;g.loopFix({slideRealIndex:p,direction:ce?void 0:"next",initial:_})}function DK({slideRealIndex:p,slideTo:_=!0,direction:g,setTranslate:v,activeSlideIndex:R,initial:w,byController:x,byMousewheel:W}={}){const P=this;if(!P.params.loop)return;P.emit("beforeLoopFix");const{slides:V,allowSlidePrev:q,allowSlideNext:z,slidesEl:ce,params:Z}=P,{centeredSlides:ae,slidesOffsetBefore:ne,slidesOffsetAfter:se,initialSlide:Q}=Z,oe=ae||!!ne||!!se;if(P.allowSlidePrev=!0,P.allowSlideNext=!0,P.virtual&&Z.virtual.enabled){_&&(!oe&&P.snapIndex===0?P.slideTo(P.virtual.slides.length,0,!1,!0):oe&&P.snapIndex<Z.slidesPerView?P.slideTo(P.virtual.slides.length+P.snapIndex,0,!1,!0):P.snapIndex===P.snapGrid.length-1&&P.slideTo(P.virtual.slidesBefore,0,!1,!0)),P.allowSlidePrev=q,P.allowSlideNext=z,P.emit("loopFix");return}let fe=Z.slidesPerView;fe==="auto"?fe=P.slidesPerViewDynamic():(fe=Math.ceil(parseFloat(Z.slidesPerView,10)),oe&&fe%2===0&&(fe=fe+1));const Ue=Z.slidesPerGroupAuto?fe:Z.slidesPerGroup;let Ne=oe?Math.max(Ue,Math.ceil(fe/2)):Ue;Ne%Ue!==0&&(Ne+=Ue-Ne%Ue),Ne+=Z.loopAdditionalSlides,P.loopedSlides=Ne;const ft=P.grid&&Z.grid&&Z.grid.rows>1;V.length<fe+Ne||P.params.effect==="cards"&&V.length<fe+Ne*2?HR("Swiper Loop Warning: The number of slides is not enough for loop mode, it will be disabled or not function properly. You need to add more slides (or make duplicates) or lower the values of slidesPerView and slidesPerGroup parameters"):ft&&Z.grid.fill==="row"&&HR("Swiper Loop Warning: Loop mode is not compatible with grid.fill = `row`");const $e=[],De=[],Et=ft?Math.ceil(V.length/Z.grid.rows):V.length,qe=w&&Et-Q<fe&&!oe;let Qe=qe?Q:P.activeIndex;typeof R>"u"?R=P.getSlideIndex(V.find(We=>We.classList.contains(Z.slideActiveClass))):Qe=R;const Ye=g==="next"||!g,Vt=g==="prev"||!g;let Ct=0,ui=0;const ze=(ft?V[R].column:R)+(oe&&typeof v>"u"?-fe/2+.5:0);if(ze<Ne){Ct=Math.max(Ne-ze,Ue);for(let We=0;We<Ne-ze;We+=1){const Tt=We-Math.floor(We/Et)*Et;if(ft){const le=Et-Tt-1;for(let Ge=V.length-1;Ge>=0;Ge-=1)V[Ge].column===le&&$e.push(Ge)}else $e.push(Et-Tt-1)}}else if(ze+fe>Et-Ne){ui=Math.max(ze-(Et-Ne*2),Ue),qe&&(ui=Math.max(ui,fe-Et+Q+1));for(let We=0;We<ui;We+=1){const Tt=We-Math.floor(We/Et)*Et;ft?V.forEach((le,Ge)=>{le.column===Tt&&De.push(Ge)}):De.push(Tt)}}if(P.__preventObserver__=!0,requestAnimationFrame(()=>{P.__preventObserver__=!1}),P.params.effect==="cards"&&V.length<fe+Ne*2&&(De.includes(R)&&De.splice(De.indexOf(R),1),$e.includes(R)&&$e.splice($e.indexOf(R),1)),Vt&&$e.forEach(We=>{V[We].swiperLoopMoveDOM=!0,ce.prepend(V[We]),V[We].swiperLoopMoveDOM=!1}),Ye&&De.forEach(We=>{V[We].swiperLoopMoveDOM=!0,ce.append(V[We]),V[We].swiperLoopMoveDOM=!1}),P.recalcSlides(),Z.slidesPerView==="auto"?P.updateSlides():ft&&($e.length>0&&Vt||De.length>0&&Ye)&&P.slides.forEach((We,Tt)=>{P.grid.updateSlide(Tt,We,P.slides)}),Z.watchSlidesProgress&&P.updateSlidesOffset(),_){if($e.length>0&&Vt){if(typeof p>"u"){const We=P.slidesGrid[Qe],le=P.slidesGrid[Qe+Ct]-We;W?P.setTranslate(P.translate-le):(P.slideTo(Qe+Math.ceil(Ct),0,!1,!0),v&&(P.touchEventsData.startTranslate=P.touchEventsData.startTranslate-le,P.touchEventsData.currentTranslate=P.touchEventsData.currentTranslate-le))}else if(v){const We=ft?$e.length/Z.grid.rows:$e.length;P.slideTo(P.activeIndex+We,0,!1,!0),P.touchEventsData.currentTranslate=P.translate}}else if(De.length>0&&Ye)if(typeof p>"u"){const We=P.slidesGrid[Qe],le=P.slidesGrid[Qe-ui]-We;W?P.setTranslate(P.translate-le):(P.slideTo(Qe-ui,0,!1,!0),v&&(P.touchEventsData.startTranslate=P.touchEventsData.startTranslate-le,P.touchEventsData.currentTranslate=P.touchEventsData.currentTranslate-le))}else{const We=ft?De.length/Z.grid.rows:De.length;P.slideTo(P.activeIndex-We,0,!1,!0)}}if(P.allowSlidePrev=q,P.allowSlideNext=z,P.controller&&P.controller.control&&!x){const We={slideRealIndex:p,direction:g,setTranslate:v,activeSlideIndex:R,byController:!0};Array.isArray(P.controller.control)?P.controller.control.forEach(Tt=>{!Tt.destroyed&&Tt.params.loop&&Tt.loopFix({...We,slideTo:Tt.params.slidesPerView===Z.slidesPerView?_:!1})}):P.controller.control instanceof P.constructor&&P.controller.control.params.loop&&P.controller.control.loopFix({...We,slideTo:P.controller.control.params.slidesPerView===Z.slidesPerView?_:!1})}P.emit("loopFix")}function LK(){const p=this,{params:_,slidesEl:g}=p;if(!_.loop||!g||p.virtual&&p.params.virtual.enabled)return;p.recalcSlides();const v=[];p.slides.forEach(R=>{const w=typeof R.swiperSlideIndex>"u"?R.getAttribute("data-swiper-slide-index")*1:R.swiperSlideIndex;v[w]=R}),p.slides.forEach(R=>{R.removeAttribute("data-swiper-slide-index")}),v.forEach(R=>{g.append(R)}),p.recalcSlides(),p.slideTo(p.realIndex,0)}var PK={loopCreate:NK,loopFix:DK,loopDestroy:LK};function xK(p){const _=this;if(!_.params.simulateTouch||_.params.watchOverflow&&_.isLocked||_.params.cssMode)return;const g=_.params.touchEventsTarget==="container"?_.el:_.wrapperEl;_.isElement&&(_.__preventObserver__=!0),g.style.cursor="move",g.style.cursor=p?"grabbing":"grab",_.isElement&&requestAnimationFrame(()=>{_.__preventObserver__=!1})}function kK(){const p=this;p.params.watchOverflow&&p.isLocked||p.params.cssMode||(p.isElement&&(p.__preventObserver__=!0),p[p.params.touchEventsTarget==="container"?"el":"wrapperEl"].style.cursor="",p.isElement&&requestAnimationFrame(()=>{p.__preventObserver__=!1}))}var MK={setGrabCursor:xK,unsetGrabCursor:kK};function UK(p,_=this){function g(v){if(!v||v===np()||v===ca())return null;v.assignedSlot&&(v=v.assignedSlot);const R=v.closest(p);return!R&&!v.getRootNode?null:R||g(v.getRootNode().host)}return g(_)}function N4(p,_,g){const v=ca(),{params:R}=p,w=R.edgeSwipeDetection,x=R.edgeSwipeThreshold;return w&&(g<=x||g>=v.innerWidth-x)?w==="prevent"?(_.preventDefault(),!0):!1:!0}function VK(p){const _=this,g=np();let v=p;v.originalEvent&&(v=v.originalEvent);const R=_.touchEventsData;if(v.type==="pointerdown"){if(R.pointerId!==null&&R.pointerId!==v.pointerId)return;R.pointerId=v.pointerId}else v.type==="touchstart"&&v.targetTouches.length===1&&(R.touchId=v.targetTouches[0].identifier);if(v.type==="touchstart"){N4(_,v,v.targetTouches[0].pageX);return}const{params:w,touches:x,enabled:W}=_;if(!W||!w.simulateTouch&&v.pointerType==="mouse"||_.animating&&w.preventInteractionOnTransition)return;!_.animating&&w.cssMode&&w.loop&&_.loopFix();let P=v.target;if(w.touchEventsTarget==="wrapper"&&!Kz(P,_.wrapperEl)||"which"in v&&v.which===3||"button"in v&&v.button>0||R.isTouched&&R.isMoved)return;const V=!!w.noSwipingClass&&w.noSwipingClass!=="",q=v.composedPath?v.composedPath():v.path;V&&v.target&&v.target.shadowRoot&&q&&(P=q[0]);const z=w.noSwipingSelector?w.noSwipingSelector:`.${w.noSwipingClass}`,ce=!!(v.target&&v.target.shadowRoot);if(w.noSwiping&&(ce?UK(z,P):P.closest(z))){_.allowClick=!0;return}if(w.swipeHandler&&!P.closest(w.swipeHandler))return;x.currentX=v.pageX,x.currentY=v.pageY;const Z=x.currentX,ae=x.currentY;if(!N4(_,v,Z))return;Object.assign(R,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),x.startX=Z,x.startY=ae,R.touchStartTime=GR(),_.allowClick=!0,_.updateSize(),_.swipeDirection=void 0,w.threshold>0&&(R.allowThresholdMove=!1);let ne=!0;P.matches(R.focusableElements)&&(ne=!1,P.nodeName==="SELECT"&&(R.isTouched=!1)),g.activeElement&&g.activeElement.matches(R.focusableElements)&&g.activeElement!==P&&(v.pointerType==="mouse"||v.pointerType!=="mouse"&&!P.matches(R.focusableElements))&&g.activeElement.blur();const se=ne&&_.allowTouchMove&&w.touchStartPreventDefault;(w.touchStartForcePreventDefault||se)&&!P.isContentEditable&&v.preventDefault(),w.freeMode&&w.freeMode.enabled&&_.freeMode&&_.animating&&!w.cssMode&&_.freeMode.onTouchStart(),_.emit("touchStart",v)}function jK(p){const _=np(),g=this,v=g.touchEventsData,{params:R,touches:w,rtlTranslate:x,enabled:W}=g;if(!W||!R.simulateTouch&&p.pointerType==="mouse")return;let P=p;if(P.originalEvent&&(P=P.originalEvent),P.type==="pointermove"&&(v.touchId!==null||P.pointerId!==v.pointerId))return;let V;if(P.type==="touchmove"){if(V=[...P.changedTouches].find(Ne=>Ne.identifier===v.touchId),!V||V.identifier!==v.touchId)return}else V=P;if(!v.isTouched){v.startMoving&&v.isScrolling&&g.emit("touchMoveOpposite",P);return}const q=V.pageX,z=V.pageY;if(P.preventedByNestedSwiper){w.startX=q,w.startY=z;return}if(!g.allowTouchMove){P.target.matches(v.focusableElements)||(g.allowClick=!1),v.isTouched&&(Object.assign(w,{startX:q,startY:z,currentX:q,currentY:z}),v.touchStartTime=GR());return}if(R.touchReleaseOnEdges&&!R.loop)if(g.isVertical()){if(z<w.startY&&g.translate<=g.maxTranslate()||z>w.startY&&g.translate>=g.minTranslate()){v.isTouched=!1,v.isMoved=!1;return}}else{if(x&&(q>w.startX&&-g.translate<=g.maxTranslate()||q<w.startX&&-g.translate>=g.minTranslate()))return;if(!x&&(q<w.startX&&g.translate<=g.maxTranslate()||q>w.startX&&g.translate>=g.minTranslate()))return}if(_.activeElement&&_.activeElement.matches(v.focusableElements)&&_.activeElement!==P.target&&P.pointerType!=="mouse"&&_.activeElement.blur(),_.activeElement&&P.target===_.activeElement&&P.target.matches(v.focusableElements)){v.isMoved=!0,g.allowClick=!1;return}v.allowTouchCallbacks&&g.emit("touchMove",P),w.previousX=w.currentX,w.previousY=w.currentY,w.currentX=q,w.currentY=z;const ce=w.currentX-w.startX,Z=w.currentY-w.startY;if(g.params.threshold&&Math.sqrt(ce**2+Z**2)<g.params.threshold)return;if(typeof v.isScrolling>"u"){let Ne;g.isHorizontal()&&w.currentY===w.startY||g.isVertical()&&w.currentX===w.startX?v.isScrolling=!1:ce*ce+Z*Z>=25&&(Ne=Math.atan2(Math.abs(Z),Math.abs(ce))*180/Math.PI,v.isScrolling=g.isHorizontal()?Ne>R.touchAngle:90-Ne>R.touchAngle)}if(v.isScrolling&&g.emit("touchMoveOpposite",P),typeof v.startMoving>"u"&&(w.currentX!==w.startX||w.currentY!==w.startY)&&(v.startMoving=!0),v.isScrolling||P.type==="touchmove"&&v.preventTouchMoveFromPointerMove){v.isTouched=!1;return}if(!v.startMoving)return;g.allowClick=!1,!R.cssMode&&P.cancelable&&P.preventDefault(),R.touchMoveStopPropagation&&!R.nested&&P.stopPropagation();let ae=g.isHorizontal()?ce:Z,ne=g.isHorizontal()?w.currentX-w.previousX:w.currentY-w.previousY;R.oneWayMovement&&(ae=Math.abs(ae)*(x?1:-1),ne=Math.abs(ne)*(x?1:-1)),w.diff=ae,ae*=R.touchRatio,x&&(ae=-ae,ne=-ne);const se=g.touchesDirection;g.swipeDirection=ae>0?"prev":"next",g.touchesDirection=ne>0?"prev":"next";const Q=g.params.loop&&!R.cssMode,oe=g.touchesDirection==="next"&&g.allowSlideNext||g.touchesDirection==="prev"&&g.allowSlidePrev;if(!v.isMoved){if(Q&&oe&&g.loopFix({direction:g.swipeDirection}),v.startTranslate=g.getTranslate(),g.setTransition(0),g.animating){const Ne=new window.CustomEvent("transitionend",{bubbles:!0,cancelable:!0,detail:{bySwiperTouchMove:!0}});g.wrapperEl.dispatchEvent(Ne)}v.allowMomentumBounce=!1,R.grabCursor&&(g.allowSlideNext===!0||g.allowSlidePrev===!0)&&g.setGrabCursor(!0),g.emit("sliderFirstMove",P)}if(new Date().getTime(),R._loopSwapReset!==!1&&v.isMoved&&v.allowThresholdMove&&se!==g.touchesDirection&&Q&&oe&&Math.abs(ae)>=1){Object.assign(w,{startX:q,startY:z,currentX:q,currentY:z,startTranslate:v.currentTranslate}),v.loopSwapReset=!0,v.startTranslate=v.currentTranslate;return}g.emit("sliderMove",P),v.isMoved=!0,v.currentTranslate=ae+v.startTranslate;let fe=!0,Ue=R.resistanceRatio;if(R.touchReleaseOnEdges&&(Ue=0),ae>0?(Q&&oe&&v.allowThresholdMove&&v.currentTranslate>(R.centeredSlides?g.minTranslate()-g.slidesSizesGrid[g.activeIndex+1]-(R.slidesPerView!=="auto"&&g.slides.length-R.slidesPerView>=2?g.slidesSizesGrid[g.activeIndex+1]+g.params.spaceBetween:0)-g.params.spaceBetween:g.minTranslate())&&g.loopFix({direction:"prev",setTranslate:!0,activeSlideIndex:0}),v.currentTranslate>g.minTranslate()&&(fe=!1,R.resistance&&(v.currentTranslate=g.minTranslate()-1+(-g.minTranslate()+v.startTranslate+ae)**Ue))):ae<0&&(Q&&oe&&v.allowThresholdMove&&v.currentTranslate<(R.centeredSlides?g.maxTranslate()+g.slidesSizesGrid[g.slidesSizesGrid.length-1]+g.params.spaceBetween+(R.slidesPerView!=="auto"&&g.slides.length-R.slidesPerView>=2?g.slidesSizesGrid[g.slidesSizesGrid.length-1]+g.params.spaceBetween:0):g.maxTranslate())&&g.loopFix({direction:"next",setTranslate:!0,activeSlideIndex:g.slides.length-(R.slidesPerView==="auto"?g.slidesPerViewDynamic():Math.ceil(parseFloat(R.slidesPerView,10)))}),v.currentTranslate<g.maxTranslate()&&(fe=!1,R.resistance&&(v.currentTranslate=g.maxTranslate()+1-(g.maxTranslate()-v.startTranslate-ae)**Ue))),fe&&(P.preventedByNestedSwiper=!0),!g.allowSlideNext&&g.swipeDirection==="next"&&v.currentTranslate<v.startTranslate&&(v.currentTranslate=v.startTranslate),!g.allowSlidePrev&&g.swipeDirection==="prev"&&v.currentTranslate>v.startTranslate&&(v.currentTranslate=v.startTranslate),!g.allowSlidePrev&&!g.allowSlideNext&&(v.currentTranslate=v.startTranslate),R.threshold>0)if(Math.abs(ae)>R.threshold||v.allowThresholdMove){if(!v.allowThresholdMove){v.allowThresholdMove=!0,w.startX=w.currentX,w.startY=w.currentY,v.currentTranslate=v.startTranslate,w.diff=g.isHorizontal()?w.currentX-w.startX:w.currentY-w.startY;return}}else{v.currentTranslate=v.startTranslate;return}!R.followFinger||R.cssMode||((R.freeMode&&R.freeMode.enabled&&g.freeMode||R.watchSlidesProgress)&&(g.updateActiveIndex(),g.updateSlidesClasses()),R.freeMode&&R.freeMode.enabled&&g.freeMode&&g.freeMode.onTouchMove(),g.updateProgress(v.currentTranslate),g.setTranslate(v.currentTranslate))}function BK(p){const _=this,g=_.touchEventsData;let v=p;v.originalEvent&&(v=v.originalEvent);let R;if(v.type==="touchend"||v.type==="touchcancel"){if(R=[...v.changedTouches].find(Ne=>Ne.identifier===g.touchId),!R||R.identifier!==g.touchId)return}else{if(g.touchId!==null||v.pointerId!==g.pointerId)return;R=v}if(["pointercancel","pointerout","pointerleave","contextmenu"].includes(v.type)&&!(["pointercancel","contextmenu"].includes(v.type)&&(_.browser.isSafari||_.browser.isWebView)))return;g.pointerId=null,g.touchId=null;const{params:x,touches:W,rtlTranslate:P,slidesGrid:V,enabled:q}=_;if(!q||!x.simulateTouch&&v.pointerType==="mouse")return;if(g.allowTouchCallbacks&&_.emit("touchEnd",v),g.allowTouchCallbacks=!1,!g.isTouched){g.isMoved&&x.grabCursor&&_.setGrabCursor(!1),g.isMoved=!1,g.startMoving=!1;return}x.grabCursor&&g.isMoved&&g.isTouched&&(_.allowSlideNext===!0||_.allowSlidePrev===!0)&&_.setGrabCursor(!1);const z=GR(),ce=z-g.touchStartTime;if(_.allowClick){const Ne=v.path||v.composedPath&&v.composedPath();_.updateClickedSlide(Ne&&Ne[0]||v.target,Ne),_.emit("tap click",v),ce<300&&z-g.lastClickTime<300&&_.emit("doubleTap doubleClick",v)}if(g.lastClickTime=GR(),rV(()=>{_.destroyed||(_.allowClick=!0)}),!g.isTouched||!g.isMoved||!_.swipeDirection||W.diff===0&&!g.loopSwapReset||g.currentTranslate===g.startTranslate&&!g.loopSwapReset){g.isTouched=!1,g.isMoved=!1,g.startMoving=!1;return}g.isTouched=!1,g.isMoved=!1,g.startMoving=!1;let Z;if(x.followFinger?Z=P?_.translate:-_.translate:Z=-g.currentTranslate,x.cssMode)return;if(x.freeMode&&x.freeMode.enabled){_.freeMode.onTouchEnd({currentPos:Z});return}const ae=Z>=-_.maxTranslate()&&!_.params.loop;let ne=0,se=_.slidesSizesGrid[0];for(let Ne=0;Ne<V.length;Ne+=Ne<x.slidesPerGroupSkip?1:x.slidesPerGroup){const ft=Ne<x.slidesPerGroupSkip-1?1:x.slidesPerGroup;typeof V[Ne+ft]<"u"?(ae||Z>=V[Ne]&&Z<V[Ne+ft])&&(ne=Ne,se=V[Ne+ft]-V[Ne]):(ae||Z>=V[Ne])&&(ne=Ne,se=V[V.length-1]-V[V.length-2])}let Q=null,oe=null;x.rewind&&(_.isBeginning?oe=x.virtual&&x.virtual.enabled&&_.virtual?_.virtual.slides.length-1:_.slides.length-1:_.isEnd&&(Q=0));const fe=(Z-V[ne])/se,Ue=ne<x.slidesPerGroupSkip-1?1:x.slidesPerGroup;if(ce>x.longSwipesMs){if(!x.longSwipes){_.slideTo(_.activeIndex);return}_.swipeDirection==="next"&&(fe>=x.longSwipesRatio?_.slideTo(x.rewind&&_.isEnd?Q:ne+Ue):_.slideTo(ne)),_.swipeDirection==="prev"&&(fe>1-x.longSwipesRatio?_.slideTo(ne+Ue):oe!==null&&fe<0&&Math.abs(fe)>x.longSwipesRatio?_.slideTo(oe):_.slideTo(ne))}else{if(!x.shortSwipes){_.slideTo(_.activeIndex);return}_.navigation&&(v.target===_.navigation.nextEl||v.target===_.navigation.prevEl)?v.target===_.navigation.nextEl?_.slideTo(ne+Ue):_.slideTo(ne):(_.swipeDirection==="next"&&_.slideTo(Q!==null?Q:ne+Ue),_.swipeDirection==="prev"&&_.slideTo(oe!==null?oe:ne))}}function D4(){const p=this,{params:_,el:g}=p;if(g&&g.offsetWidth===0)return;_.breakpoints&&p.setBreakpoint();const{allowSlideNext:v,allowSlidePrev:R,snapGrid:w}=p,x=p.virtual&&p.params.virtual.enabled;p.allowSlideNext=!0,p.allowSlidePrev=!0,p.updateSize(),p.updateSlides(),p.updateSlidesClasses();const W=x&&_.loop;(_.slidesPerView==="auto"||_.slidesPerView>1)&&p.isEnd&&!p.isBeginning&&!p.params.centeredSlides&&!W?p.slideTo(p.slides.length-1,0,!1,!0):p.params.loop&&!x?p.slideToLoop(p.realIndex,0,!1,!0):p.slideTo(p.activeIndex,0,!1,!0),p.autoplay&&p.autoplay.running&&p.autoplay.paused&&(clearTimeout(p.autoplay.resizeTimeout),p.autoplay.resizeTimeout=setTimeout(()=>{p.autoplay&&p.autoplay.running&&p.autoplay.paused&&p.autoplay.resume()},500)),p.allowSlidePrev=R,p.allowSlideNext=v,p.params.watchOverflow&&w!==p.snapGrid&&p.checkOverflow()}function FK(p){const _=this;_.enabled&&(_.allowClick||(_.params.preventClicks&&p.preventDefault(),_.params.preventClicksPropagation&&_.animating&&(p.stopPropagation(),p.stopImmediatePropagation())))}function GK(){const p=this,{wrapperEl:_,rtlTranslate:g,enabled:v}=p;if(!v)return;p.previousTranslate=p.translate,p.isHorizontal()?p.translate=-_.scrollLeft:p.translate=-_.scrollTop,p.translate===0&&(p.translate=0),p.updateActiveIndex(),p.updateSlidesClasses();let R;const w=p.maxTranslate()-p.minTranslate();w===0?R=0:R=(p.translate-p.minTranslate())/w,R!==p.progress&&p.updateProgress(g?-p.translate:p.translate),p.emit("setTranslate",p.translate,!1)}function HK(p){const _=this;BR(_,p.target),!(_.params.cssMode||_.params.slidesPerView!=="auto"&&!_.params.autoHeight)&&_.update()}function WK(){const p=this;p.documentTouchHandlerProceeded||(p.documentTouchHandlerProceeded=!0,p.params.touchReleaseOnEdges&&(p.el.style.touchAction="auto"))}const uV=(p,_)=>{const g=np(),{params:v,el:R,wrapperEl:w,device:x}=p,W=!!v.nested,P=_==="on"?"addEventListener":"removeEventListener",V=_;!R||typeof R=="string"||(g[P]("touchstart",p.onDocumentTouchStart,{passive:!1,capture:W}),R[P]("touchstart",p.onTouchStart,{passive:!1}),R[P]("pointerdown",p.onTouchStart,{passive:!1}),g[P]("touchmove",p.onTouchMove,{passive:!1,capture:W}),g[P]("pointermove",p.onTouchMove,{passive:!1,capture:W}),g[P]("touchend",p.onTouchEnd,{passive:!0}),g[P]("pointerup",p.onTouchEnd,{passive:!0}),g[P]("pointercancel",p.onTouchEnd,{passive:!0}),g[P]("touchcancel",p.onTouchEnd,{passive:!0}),g[P]("pointerout",p.onTouchEnd,{passive:!0}),g[P]("pointerleave",p.onTouchEnd,{passive:!0}),g[P]("contextmenu",p.onTouchEnd,{passive:!0}),(v.preventClicks||v.preventClicksPropagation)&&R[P]("click",p.onClick,!0),v.cssMode&&w[P]("scroll",p.onScroll),v.updateOnWindowResize?p[V](x.ios||x.android?"resize orientationchange observerUpdate":"resize observerUpdate",D4,!0):p[V]("observerUpdate",D4,!0),R[P]("load",p.onLoad,{capture:!0}))};function zK(){const p=this,{params:_}=p;p.onTouchStart=VK.bind(p),p.onTouchMove=jK.bind(p),p.onTouchEnd=BK.bind(p),p.onDocumentTouchStart=WK.bind(p),_.cssMode&&(p.onScroll=GK.bind(p)),p.onClick=FK.bind(p),p.onLoad=HK.bind(p),uV(p,"on")}function KK(){uV(this,"off")}var YK={attachEvents:zK,detachEvents:KK};const L4=(p,_)=>p.grid&&_.grid&&_.grid.rows>1;function qK(){const p=this,{realIndex:_,initialized:g,params:v,el:R}=p,w=v.breakpoints;if(!w||w&&Object.keys(w).length===0)return;const x=np(),W=v.breakpointsBase==="window"||!v.breakpointsBase?v.breakpointsBase:"container",P=["window","container"].includes(v.breakpointsBase)||!v.breakpointsBase?p.el:x.querySelector(v.breakpointsBase),V=p.getBreakpoint(w,W,P);if(!V||p.currentBreakpoint===V)return;const z=(V in w?w[V]:void 0)||p.originalParams,ce=L4(p,v),Z=L4(p,z),ae=p.params.grabCursor,ne=z.grabCursor,se=v.enabled;ce&&!Z?(R.classList.remove(`${v.containerModifierClass}grid`,`${v.containerModifierClass}grid-column`),p.emitContainerClasses()):!ce&&Z&&(R.classList.add(`${v.containerModifierClass}grid`),(z.grid.fill&&z.grid.fill==="column"||!z.grid.fill&&v.grid.fill==="column")&&R.classList.add(`${v.containerModifierClass}grid-column`),p.emitContainerClasses()),ae&&!ne?p.unsetGrabCursor():!ae&&ne&&p.setGrabCursor(),["navigation","pagination","scrollbar"].forEach(ft=>{if(typeof z[ft]>"u")return;const $e=v[ft]&&v[ft].enabled,De=z[ft]&&z[ft].enabled;$e&&!De&&p[ft].disable(),!$e&&De&&p[ft].enable()});const Q=z.direction&&z.direction!==v.direction,oe=v.loop&&(z.slidesPerView!==v.slidesPerView||Q),fe=v.loop;Q&&g&&p.changeDirection(),rs(p.params,z);const Ue=p.params.enabled,Ne=p.params.loop;Object.assign(p,{allowTouchMove:p.params.allowTouchMove,allowSlideNext:p.params.allowSlideNext,allowSlidePrev:p.params.allowSlidePrev}),se&&!Ue?p.disable():!se&&Ue&&p.enable(),p.currentBreakpoint=V,p.emit("_beforeBreakpoint",z),g&&(oe?(p.loopDestroy(),p.loopCreate(_),p.updateSlides()):!fe&&Ne?(p.loopCreate(_),p.updateSlides()):fe&&!Ne&&p.loopDestroy()),p.emit("breakpoint",z)}function XK(p,_="window",g){if(!p||_==="container"&&!g)return;let v=!1;const R=ca(),w=_==="window"?R.innerHeight:g.clientHeight,x=Object.keys(p).map(W=>{if(typeof W=="string"&&W.indexOf("@")===0){const P=parseFloat(W.substr(1));return{value:w*P,point:W}}return{value:W,point:W}});x.sort((W,P)=>parseInt(W.value,10)-parseInt(P.value,10));for(let W=0;W<x.length;W+=1){const{point:P,value:V}=x[W];_==="window"?R.matchMedia(`(min-width: ${V}px)`).matches&&(v=P):V<=g.clientWidth&&(v=P)}return v||"max"}var JK={setBreakpoint:qK,getBreakpoint:XK};function ZK(p,_){const g=[];return p.forEach(v=>{typeof v=="object"?Object.keys(v).forEach(R=>{v[R]&&g.push(_+R)}):typeof v=="string"&&g.push(_+v)}),g}function QK(){const p=this,{classNames:_,params:g,rtl:v,el:R,device:w}=p,x=ZK(["initialized",g.direction,{"free-mode":p.params.freeMode&&g.freeMode.enabled},{autoheight:g.autoHeight},{rtl:v},{grid:g.grid&&g.grid.rows>1},{"grid-column":g.grid&&g.grid.rows>1&&g.grid.fill==="column"},{android:w.android},{ios:w.ios},{"css-mode":g.cssMode},{centered:g.cssMode&&g.centeredSlides},{"watch-progress":g.watchSlidesProgress}],g.containerModifierClass);_.push(...x),R.classList.add(..._),p.emitContainerClasses()}function $K(){const p=this,{el:_,classNames:g}=p;!_||typeof _=="string"||(_.classList.remove(...g),p.emitContainerClasses())}var eY={addClasses:QK,removeClasses:$K};function tY(){const p=this,{isLocked:_,params:g}=p,{slidesOffsetBefore:v}=g;if(v){const R=p.slides.length-1,w=p.slidesGrid[R]+p.slidesSizesGrid[R]+v*2;p.isLocked=p.size>w}else p.isLocked=p.snapGrid.length===1;g.allowSlideNext===!0&&(p.allowSlideNext=!p.isLocked),g.allowSlidePrev===!0&&(p.allowSlidePrev=!p.isLocked),_&&_!==p.isLocked&&(p.isEnd=!1),_!==p.isLocked&&p.emit(p.isLocked?"lock":"unlock")}var iY={checkOverflow:tY},O2={init:!0,direction:"horizontal",oneWayMovement:!1,swiperElementNodeName:"SWIPER-CONTAINER",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,eventsPrefix:"swiper",enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:5,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,loop:!1,loopAddBlankSlides:!0,loopAdditionalSlides:0,loopPreventsSliding:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,maxBackfaceHiddenSlides:10,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-blank",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideFullyVisibleClass:"swiper-slide-fully-visible",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",lazyPreloaderClass:"swiper-lazy-preloader",lazyPreloadPrevNext:0,runCallbacksOnInit:!0,_emitClasses:!1};function nY(p,_){return function(v={}){const R=Object.keys(v)[0],w=v[R];if(typeof w!="object"||w===null){rs(_,v);return}if(p[R]===!0&&(p[R]={enabled:!0}),R==="navigation"&&p[R]&&p[R].enabled&&!p[R].prevEl&&!p[R].nextEl&&(p[R].auto=!0),["pagination","scrollbar"].indexOf(R)>=0&&p[R]&&p[R].enabled&&!p[R].el&&(p[R].auto=!0),!(R in p&&"enabled"in w)){rs(_,v);return}typeof p[R]=="object"&&!("enabled"in p[R])&&(p[R].enabled=!0),p[R]||(p[R]={enabled:!1}),rs(_,v)}}const y2={eventsEmitter:eK,update:uK,translate:EK,transition:TK,slide:OK,loop:PK,grabCursor:MK,events:YK,breakpoints:JK,checkOverflow:iY,classes:eY},R2={};let G2=class Al{constructor(..._){let g,v;_.length===1&&_[0].constructor&&Object.prototype.toString.call(_[0]).slice(8,-1)==="Object"?v=_[0]:[g,v]=_,v||(v={}),v=rs({},v),g&&!v.el&&(v.el=g);const R=np();if(v.el&&typeof v.el=="string"&&R.querySelectorAll(v.el).length>1){const P=[];return R.querySelectorAll(v.el).forEach(V=>{const q=rs({},v,{el:V});P.push(new Al(q))}),P}const w=this;w.__swiper__=!0,w.support=oV(),w.device=cV({userAgent:v.userAgent}),w.browser=lV(),w.eventsListeners={},w.eventsAnyListeners=[],w.modules=[...w.__modules__],v.modules&&Array.isArray(v.modules)&&w.modules.push(...v.modules);const x={};w.modules.forEach(P=>{P({params:v,swiper:w,extendParams:nY(v,x),on:w.on.bind(w),once:w.once.bind(w),off:w.off.bind(w),emit:w.emit.bind(w)})});const W=rs({},O2,x);return w.params=rs({},W,R2,v),w.originalParams=rs({},w.params),w.passedParams=rs({},v),w.params&&w.params.on&&Object.keys(w.params.on).forEach(P=>{w.on(P,w.params.on[P])}),w.params&&w.params.onAny&&w.onAny(w.params.onAny),Object.assign(w,{enabled:w.params.enabled,el:g,classNames:[],slides:[],slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal(){return w.params.direction==="horizontal"},isVertical(){return w.params.direction==="vertical"},activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,cssOverflowAdjustment(){return Math.trunc(this.translate/2**23)*2**23},allowSlideNext:w.params.allowSlideNext,allowSlidePrev:w.params.allowSlidePrev,touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:w.params.focusableElements,lastClickTime:0,clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,startMoving:void 0,pointerId:null,touchId:null},allowClick:!0,allowTouchMove:w.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),w.emit("_swiper"),w.params.init&&w.init(),w}getDirectionLabel(_){return this.isHorizontal()?_:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[_]}getSlideIndex(_){const{slidesEl:g,params:v}=this,R=yc(g,`.${v.slideClass}, swiper-slide`),w=zR(R[0]);return zR(_)-w}getSlideIndexByData(_){return this.getSlideIndex(this.slides.find(g=>g.getAttribute("data-swiper-slide-index")*1===_))}getSlideIndexWhenGrid(_){return this.grid&&this.params.grid&&this.params.grid.rows>1&&(this.params.grid.fill==="column"?_=Math.floor(_/this.params.grid.rows):this.params.grid.fill==="row"&&(_=_%Math.ceil(this.slides.length/this.params.grid.rows))),_}recalcSlides(){const _=this,{slidesEl:g,params:v}=_;_.slides=yc(g,`.${v.slideClass}, swiper-slide`)}enable(){const _=this;_.enabled||(_.enabled=!0,_.params.grabCursor&&_.setGrabCursor(),_.emit("enable"))}disable(){const _=this;_.enabled&&(_.enabled=!1,_.params.grabCursor&&_.unsetGrabCursor(),_.emit("disable"))}setProgress(_,g){const v=this;_=Math.min(Math.max(_,0),1);const R=v.minTranslate(),x=(v.maxTranslate()-R)*_+R;v.translateTo(x,typeof g>"u"?0:g),v.updateActiveIndex(),v.updateSlidesClasses()}emitContainerClasses(){const _=this;if(!_.params._emitClasses||!_.el)return;const g=_.el.className.split(" ").filter(v=>v.indexOf("swiper")===0||v.indexOf(_.params.containerModifierClass)===0);_.emit("_containerClasses",g.join(" "))}getSlideClasses(_){const g=this;return g.destroyed?"":_.className.split(" ").filter(v=>v.indexOf("swiper-slide")===0||v.indexOf(g.params.slideClass)===0).join(" ")}emitSlidesClasses(){const _=this;if(!_.params._emitClasses||!_.el)return;const g=[];_.slides.forEach(v=>{const R=_.getSlideClasses(v);g.push({slideEl:v,classNames:R}),_.emit("_slideClass",v,R)}),_.emit("_slideClasses",g)}slidesPerViewDynamic(_="current",g=!1){const v=this,{params:R,slides:w,slidesGrid:x,slidesSizesGrid:W,size:P,activeIndex:V}=v;let q=1;if(typeof R.slidesPerView=="number")return R.slidesPerView;if(R.centeredSlides){let z=w[V]?Math.ceil(w[V].swiperSlideSize):0,ce;for(let Z=V+1;Z<w.length;Z+=1)w[Z]&&!ce&&(z+=Math.ceil(w[Z].swiperSlideSize),q+=1,z>P&&(ce=!0));for(let Z=V-1;Z>=0;Z-=1)w[Z]&&!ce&&(z+=w[Z].swiperSlideSize,q+=1,z>P&&(ce=!0))}else if(_==="current")for(let z=V+1;z<w.length;z+=1)(g?x[z]+W[z]-x[V]<P:x[z]-x[V]<P)&&(q+=1);else for(let z=V-1;z>=0;z-=1)x[V]-x[z]<P&&(q+=1);return q}update(){const _=this;if(!_||_.destroyed)return;const{snapGrid:g,params:v}=_;v.breakpoints&&_.setBreakpoint(),[..._.el.querySelectorAll('[loading="lazy"]')].forEach(x=>{x.complete&&BR(_,x)}),_.updateSize(),_.updateSlides(),_.updateProgress(),_.updateSlidesClasses();function R(){const x=_.rtlTranslate?_.translate*-1:_.translate,W=Math.min(Math.max(x,_.maxTranslate()),_.minTranslate());_.setTranslate(W),_.updateActiveIndex(),_.updateSlidesClasses()}let w;if(v.freeMode&&v.freeMode.enabled&&!v.cssMode)R(),v.autoHeight&&_.updateAutoHeight();else{if((v.slidesPerView==="auto"||v.slidesPerView>1)&&_.isEnd&&!v.centeredSlides){const x=_.virtual&&v.virtual.enabled?_.virtual.slides:_.slides;w=_.slideTo(x.length-1,0,!1,!0)}else w=_.slideTo(_.activeIndex,0,!1,!0);w||R()}v.watchOverflow&&g!==_.snapGrid&&_.checkOverflow(),_.emit("update")}changeDirection(_,g=!0){const v=this,R=v.params.direction;return _||(_=R==="horizontal"?"vertical":"horizontal"),_===R||_!=="horizontal"&&_!=="vertical"||(v.el.classList.remove(`${v.params.containerModifierClass}${R}`),v.el.classList.add(`${v.params.containerModifierClass}${_}`),v.emitContainerClasses(),v.params.direction=_,v.slides.forEach(w=>{_==="vertical"?w.style.width="":w.style.height=""}),v.emit("changeDirection"),g&&v.update()),v}changeLanguageDirection(_){const g=this;g.rtl&&_==="rtl"||!g.rtl&&_==="ltr"||(g.rtl=_==="rtl",g.rtlTranslate=g.params.direction==="horizontal"&&g.rtl,g.rtl?(g.el.classList.add(`${g.params.containerModifierClass}rtl`),g.el.dir="rtl"):(g.el.classList.remove(`${g.params.containerModifierClass}rtl`),g.el.dir="ltr"),g.update())}mount(_){const g=this;if(g.mounted)return!0;let v=_||g.params.el;if(typeof v=="string"&&(v=document.querySelector(v)),!v)return!1;v.swiper=g,v.parentNode&&v.parentNode.host&&v.parentNode.host.nodeName===g.params.swiperElementNodeName.toUpperCase()&&(g.isElement=!0);const R=()=>`.${(g.params.wrapperClass||"").trim().split(" ").join(".")}`;let x=v&&v.shadowRoot&&v.shadowRoot.querySelector?v.shadowRoot.querySelector(R()):yc(v,R())[0];return!x&&g.params.createElements&&(x=WR("div",g.params.wrapperClass),v.append(x),yc(v,`.${g.params.slideClass}`).forEach(W=>{x.append(W)})),Object.assign(g,{el:v,wrapperEl:x,slidesEl:g.isElement&&!v.parentNode.host.slideSlots?v.parentNode.host:x,hostEl:g.isElement?v.parentNode.host:v,mounted:!0,rtl:v.dir.toLowerCase()==="rtl"||su(v,"direction")==="rtl",rtlTranslate:g.params.direction==="horizontal"&&(v.dir.toLowerCase()==="rtl"||su(v,"direction")==="rtl"),wrongRTL:su(x,"display")==="-webkit-box"}),!0}init(_){const g=this;if(g.initialized||g.mount(_)===!1)return g;g.emit("beforeInit"),g.params.breakpoints&&g.setBreakpoint(),g.addClasses(),g.updateSize(),g.updateSlides(),g.params.watchOverflow&&g.checkOverflow(),g.params.grabCursor&&g.enabled&&g.setGrabCursor(),g.params.loop&&g.virtual&&g.params.virtual.enabled?g.slideTo(g.params.initialSlide+g.virtual.slidesBefore,0,g.params.runCallbacksOnInit,!1,!0):g.slideTo(g.params.initialSlide,0,g.params.runCallbacksOnInit,!1,!0),g.params.loop&&g.loopCreate(void 0,!0),g.attachEvents();const R=[...g.el.querySelectorAll('[loading="lazy"]')];return g.isElement&&R.push(...g.hostEl.querySelectorAll('[loading="lazy"]')),R.forEach(w=>{w.complete?BR(g,w):w.addEventListener("load",x=>{BR(g,x.target)})}),I2(g),g.initialized=!0,I2(g),g.emit("init"),g.emit("afterInit"),g}destroy(_=!0,g=!0){const v=this,{params:R,el:w,wrapperEl:x,slides:W}=v;return typeof v.params>"u"||v.destroyed||(v.emit("beforeDestroy"),v.initialized=!1,v.detachEvents(),R.loop&&v.loopDestroy(),g&&(v.removeClasses(),w&&typeof w!="string"&&w.removeAttribute("style"),x&&x.removeAttribute("style"),W&&W.length&&W.forEach(P=>{P.classList.remove(R.slideVisibleClass,R.slideFullyVisibleClass,R.slideActiveClass,R.slideNextClass,R.slidePrevClass),P.removeAttribute("style"),P.removeAttribute("data-swiper-slide-index")})),v.emit("destroy"),Object.keys(v.eventsListeners).forEach(P=>{v.off(P)}),_!==!1&&(v.el&&typeof v.el!="string"&&(v.el.swiper=null),Fz(v)),v.destroyed=!0),null}static extendDefaults(_){rs(R2,_)}static get extendedDefaults(){return R2}static get defaults(){return O2}static installModule(_){Al.prototype.__modules__||(Al.prototype.__modules__=[]);const g=Al.prototype.__modules__;typeof _=="function"&&g.indexOf(_)<0&&g.push(_)}static use(_){return Array.isArray(_)?(_.forEach(g=>Al.installModule(g)),Al):(Al.installModule(_),Al)}};Object.keys(y2).forEach(p=>{Object.keys(y2[p]).forEach(_=>{G2.prototype[_]=y2[p][_]})});G2.use([Qz,$z]);const hV=["eventsPrefix","injectStyles","injectStylesUrls","modules","init","_direction","oneWayMovement","swiperElementNodeName","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","breakpointsBase","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_loop","loopAdditionalSlides","loopAddBlankSlides","loopPreventsSliding","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideActiveClass","slideVisibleClass","slideFullyVisibleClass","slideNextClass","slidePrevClass","slideBlankClass","wrapperClass","lazyPreloaderClass","lazyPreloadPrevNext","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom","control"];function ip(p){return typeof p=="object"&&p!==null&&p.constructor&&Object.prototype.toString.call(p).slice(8,-1)==="Object"&&!p.__swiper__}function Wm(p,_){const g=["__proto__","constructor","prototype"];Object.keys(_).filter(v=>g.indexOf(v)<0).forEach(v=>{typeof p[v]>"u"?p[v]=_[v]:ip(_[v])&&ip(p[v])&&Object.keys(_[v]).length>0?_[v].__swiper__?p[v]=_[v]:Wm(p[v],_[v]):p[v]=_[v]})}function pV(p={}){return p.navigation&&typeof p.navigation.nextEl>"u"&&typeof p.navigation.prevEl>"u"}function fV(p={}){return p.pagination&&typeof p.pagination.el>"u"}function mV(p={}){return p.scrollbar&&typeof p.scrollbar.el>"u"}function _V(p=""){const _=p.split(" ").map(v=>v.trim()).filter(v=>!!v),g=[];return _.forEach(v=>{g.indexOf(v)<0&&g.push(v)}),g.join(" ")}function rY(p=""){return p?p.includes("swiper-wrapper")?p:`swiper-wrapper ${p}`:"swiper-wrapper"}function aY({swiper:p,slides:_,passedParams:g,changedParams:v,nextEl:R,prevEl:w,scrollbarEl:x,paginationEl:W}){const P=v.filter(De=>De!=="children"&&De!=="direction"&&De!=="wrapperClass"),{params:V,pagination:q,navigation:z,scrollbar:ce,virtual:Z,thumbs:ae}=p;let ne,se,Q,oe,fe,Ue,Ne,ft;v.includes("thumbs")&&g.thumbs&&g.thumbs.swiper&&!g.thumbs.swiper.destroyed&&V.thumbs&&(!V.thumbs.swiper||V.thumbs.swiper.destroyed)&&(ne=!0),v.includes("controller")&&g.controller&&g.controller.control&&V.controller&&!V.controller.control&&(se=!0),v.includes("pagination")&&g.pagination&&(g.pagination.el||W)&&(V.pagination||V.pagination===!1)&&q&&!q.el&&(Q=!0),v.includes("scrollbar")&&g.scrollbar&&(g.scrollbar.el||x)&&(V.scrollbar||V.scrollbar===!1)&&ce&&!ce.el&&(oe=!0),v.includes("navigation")&&g.navigation&&(g.navigation.prevEl||w)&&(g.navigation.nextEl||R)&&(V.navigation||V.navigation===!1)&&z&&!z.prevEl&&!z.nextEl&&(fe=!0);const $e=De=>{p[De]&&(p[De].destroy(),De==="navigation"?(p.isElement&&(p[De].prevEl.remove(),p[De].nextEl.remove()),V[De].prevEl=void 0,V[De].nextEl=void 0,p[De].prevEl=void 0,p[De].nextEl=void 0):(p.isElement&&p[De].el.remove(),V[De].el=void 0,p[De].el=void 0))};v.includes("loop")&&p.isElement&&(V.loop&&!g.loop?Ue=!0:!V.loop&&g.loop?Ne=!0:ft=!0),P.forEach(De=>{if(ip(V[De])&&ip(g[De]))Object.assign(V[De],g[De]),(De==="navigation"||De==="pagination"||De==="scrollbar")&&"enabled"in g[De]&&!g[De].enabled&&$e(De);else{const Et=g[De];(Et===!0||Et===!1)&&(De==="navigation"||De==="pagination"||De==="scrollbar")?Et===!1&&$e(De):V[De]=g[De]}}),P.includes("controller")&&!se&&p.controller&&p.controller.control&&V.controller&&V.controller.control&&(p.controller.control=V.controller.control),v.includes("children")&&_&&Z&&V.virtual.enabled?(Z.slides=_,Z.update(!0)):v.includes("virtual")&&Z&&V.virtual.enabled&&(_&&(Z.slides=_),Z.update(!0)),v.includes("children")&&_&&V.loop&&(ft=!0),ne&&ae.init()&&ae.update(!0),se&&(p.controller.control=V.controller.control),Q&&(p.isElement&&(!W||typeof W=="string")&&(W=document.createElement("div"),W.classList.add("swiper-pagination"),W.part.add("pagination"),p.el.appendChild(W)),W&&(V.pagination.el=W),q.init(),q.render(),q.update()),oe&&(p.isElement&&(!x||typeof x=="string")&&(x=document.createElement("div"),x.classList.add("swiper-scrollbar"),x.part.add("scrollbar"),p.el.appendChild(x)),x&&(V.scrollbar.el=x),ce.init(),ce.updateSize(),ce.setTranslate()),fe&&(p.isElement&&((!R||typeof R=="string")&&(R=document.createElement("div"),R.classList.add("swiper-button-next"),D0(R,p.navigation.arrowSvg),R.part.add("button-next"),p.el.appendChild(R)),(!w||typeof w=="string")&&(w=document.createElement("div"),w.classList.add("swiper-button-prev"),D0(w,p.navigation.arrowSvg),w.part.add("button-prev"),p.el.appendChild(w))),R&&(V.navigation.nextEl=R),w&&(V.navigation.prevEl=w),z.init(),z.update()),v.includes("allowSlideNext")&&(p.allowSlideNext=g.allowSlideNext),v.includes("allowSlidePrev")&&(p.allowSlidePrev=g.allowSlidePrev),v.includes("direction")&&p.changeDirection(g.direction,!1),(Ue||ft)&&p.loopDestroy(),(Ne||ft)&&p.loopCreate(),p.update()}function sY(p={},_=!0){const g={on:{}},v={},R={};Wm(g,O2),g._emitClasses=!0,g.init=!1;const w={},x=hV.map(P=>P.replace(/_/,"")),W=Object.assign({},p);return Object.keys(W).forEach(P=>{typeof p[P]>"u"||(x.indexOf(P)>=0?ip(p[P])?(g[P]={},R[P]={},Wm(g[P],p[P]),Wm(R[P],p[P])):(g[P]=p[P],R[P]=p[P]):P.search(/on[A-Z]/)===0&&typeof p[P]=="function"?_?v[`${P[2].toLowerCase()}${P.substr(3)}`]=p[P]:g.on[`${P[2].toLowerCase()}${P.substr(3)}`]=p[P]:w[P]=p[P])}),["navigation","pagination","scrollbar"].forEach(P=>{g[P]===!0&&(g[P]={}),g[P]===!1&&delete g[P]}),{params:g,passedParams:R,rest:w,events:v}}function oY({el:p,nextEl:_,prevEl:g,paginationEl:v,scrollbarEl:R,swiper:w},x){pV(x)&&_&&g&&(w.params.navigation.nextEl=_,w.originalParams.navigation.nextEl=_,w.params.navigation.prevEl=g,w.originalParams.navigation.prevEl=g),fV(x)&&v&&(w.params.pagination.el=v,w.originalParams.pagination.el=v),mV(x)&&R&&(w.params.scrollbar.el=R,w.originalParams.scrollbar.el=R),w.init(p)}function cY(p,_,g,v,R){const w=[];if(!_)return w;const x=P=>{w.indexOf(P)<0&&w.push(P)};if(g&&v){const P=v.map(R),V=g.map(R);P.join("")!==V.join("")&&x("children"),v.length!==g.length&&x("children")}return hV.filter(P=>P[0]==="_").map(P=>P.replace(/_/,"")).forEach(P=>{if(P in p&&P in _)if(ip(p[P])&&ip(_[P])){const V=Object.keys(p[P]),q=Object.keys(_[P]);V.length!==q.length?x(P):(V.forEach(z=>{p[P][z]!==_[P][z]&&x(P)}),q.forEach(z=>{p[P][z]!==_[P][z]&&x(P)}))}else p[P]!==_[P]&&x(P)}),w}const lY=p=>{!p||p.destroyed||!p.params.virtual||p.params.virtual&&!p.params.virtual.enabled||(p.updateSlides(),p.updateProgress(),p.updateSlidesClasses(),p.emit("_virtualUpdated"),p.parallax&&p.params.parallax&&p.params.parallax.enabled&&p.parallax.setTranslate())};function KR(){return KR=Object.assign?Object.assign.bind():function(p){for(var _=1;_<arguments.length;_++){var g=arguments[_];for(var v in g)Object.prototype.hasOwnProperty.call(g,v)&&(p[v]=g[v])}return p},KR.apply(this,arguments)}function EV(p){return p.type&&p.type.displayName&&p.type.displayName.includes("SwiperSlide")}function gV(p){const _=[];return cr.Children.toArray(p).forEach(g=>{EV(g)?_.push(g):g.props&&g.props.children&&gV(g.props.children).forEach(v=>_.push(v))}),_}function dY(p){const _=[],g={"container-start":[],"container-end":[],"wrapper-start":[],"wrapper-end":[]};return cr.Children.toArray(p).forEach(v=>{if(EV(v))_.push(v);else if(v.props&&v.props.slot&&g[v.props.slot])g[v.props.slot].push(v);else if(v.props&&v.props.children){const R=gV(v.props.children);R.length>0?R.forEach(w=>_.push(w)):g["container-end"].push(v)}else g["container-end"].push(v)}),{slides:_,slots:g}}function uY(p,_,g){if(!g)return null;const v=q=>{let z=q;return q<0?z=_.length+q:z>=_.length&&(z=z-_.length),z},R=p.isHorizontal()?{[p.rtlTranslate?"right":"left"]:`${g.offset}px`}:{top:`${g.offset}px`},{from:w,to:x}=g,W=p.params.loop?-_.length:0,P=p.params.loop?_.length*2:_.length,V=[];for(let q=W;q<P;q+=1)q>=w&&q<=x&&V.push(_[v(q)]);return V.map((q,z)=>cr.cloneElement(q,{swiper:p,style:R,key:q.props.virtualIndex||q.key||`slide-${z}`}))}function O0(p,_){return typeof window>"u"?ie.useEffect(p,_):ie.useLayoutEffect(p,_)}const P4=ie.createContext(null),hY=ie.createContext(null),XR=ie.forwardRef(({className:p,tag:_="div",wrapperTag:g="div",children:v,onSwiper:R,...w}={},x)=>{let W=!1;const[P,V]=ie.useState("swiper"),[q,z]=ie.useState(null),[ce,Z]=ie.useState(!1),ae=ie.useRef(!1),ne=ie.useRef(null),se=ie.useRef(null),Q=ie.useRef(null),oe=ie.useRef(null),fe=ie.useRef(null),Ue=ie.useRef(null),Ne=ie.useRef(null),ft=ie.useRef(null),{params:$e,passedParams:De,rest:Et,events:qe}=sY(w),{slides:Qe,slots:Ye}=dY(v),Vt=()=>{Z(!ce)};Object.assign($e.on,{_containerClasses(We,Tt){V(Tt)}});const Ct=()=>{Object.assign($e.on,qe),W=!0;const We={...$e};if(delete We.wrapperClass,se.current=new G2(We),se.current.virtual&&se.current.params.virtual.enabled){se.current.virtual.slides=Qe;const Tt={cache:!1,slides:Qe,renderExternal:z,renderExternalUpdate:!1};Wm(se.current.params.virtual,Tt),Wm(se.current.originalParams.virtual,Tt)}};ne.current||Ct(),se.current&&se.current.on("_beforeBreakpoint",Vt);const ui=()=>{W||!qe||!se.current||Object.keys(qe).forEach(We=>{se.current.on(We,qe[We])})},Le=()=>{!qe||!se.current||Object.keys(qe).forEach(We=>{se.current.off(We,qe[We])})};ie.useEffect(()=>()=>{se.current&&se.current.off("_beforeBreakpoint",Vt)}),ie.useEffect(()=>{!ae.current&&se.current&&(se.current.emitSlidesClasses(),ae.current=!0)}),O0(()=>{if(x&&(x.current=ne.current),!!ne.current)return se.current.destroyed&&Ct(),oY({el:ne.current,nextEl:fe.current,prevEl:Ue.current,paginationEl:Ne.current,scrollbarEl:ft.current,swiper:se.current},$e),R&&!se.current.destroyed&&R(se.current),()=>{se.current&&!se.current.destroyed&&se.current.destroy(!0,!1)}},[]),O0(()=>{ui();const We=cY(De,Q.current,Qe,oe.current,Tt=>Tt.key);return Q.current=De,oe.current=Qe,We.length&&se.current&&!se.current.destroyed&&aY({swiper:se.current,slides:Qe,passedParams:De,changedParams:We,nextEl:fe.current,prevEl:Ue.current,scrollbarEl:ft.current,paginationEl:Ne.current}),()=>{Le()}}),O0(()=>{lY(se.current)},[q]);function ze(){return $e.virtual?uY(se.current,Qe,q):Qe.map((We,Tt)=>cr.cloneElement(We,{swiper:se.current,swiperSlideIndex:Tt}))}return cr.createElement(_,KR({ref:ne,className:_V(`${P}${p?` ${p}`:""}`)},Et),cr.createElement(hY.Provider,{value:se.current},Ye["container-start"],cr.createElement(g,{className:rY($e.wrapperClass)},Ye["wrapper-start"],ze(),Ye["wrapper-end"]),pV($e)&&cr.createElement(cr.Fragment,null,cr.createElement("div",{ref:Ue,className:"swiper-button-prev"}),cr.createElement("div",{ref:fe,className:"swiper-button-next"})),mV($e)&&cr.createElement("div",{ref:ft,className:"swiper-scrollbar"}),fV($e)&&cr.createElement("div",{ref:Ne,className:"swiper-pagination"}),Ye["container-end"]))});XR.displayName="Swiper";const JR=ie.forwardRef(({tag:p="div",children:_,className:g="",swiper:v,zoom:R,lazy:w,virtualIndex:x,swiperSlideIndex:W,...P}={},V)=>{const q=ie.useRef(null),[z,ce]=ie.useState("swiper-slide"),[Z,ae]=ie.useState(!1);function ne(fe,Ue,Ne){Ue===q.current&&ce(Ne)}O0(()=>{if(typeof W<"u"&&(q.current.swiperSlideIndex=W),V&&(V.current=q.current),!(!q.current||!v)){if(v.destroyed){z!=="swiper-slide"&&ce("swiper-slide");return}return v.on("_slideClass",ne),()=>{v&&v.off("_slideClass",ne)}}}),O0(()=>{v&&q.current&&!v.destroyed&&ce(v.getSlideClasses(q.current))},[v]);const se={isActive:z.indexOf("swiper-slide-active")>=0,isVisible:z.indexOf("swiper-slide-visible")>=0,isPrev:z.indexOf("swiper-slide-prev")>=0,isNext:z.indexOf("swiper-slide-next")>=0},Q=()=>typeof _=="function"?_(se):_,oe=()=>{ae(!0)};return cr.createElement(p,KR({ref:q,className:_V(`${z}${g?` ${g}`:""}`),"data-swiper-slide-index":x,onLoad:oe},P),R&&cr.createElement(P4.Provider,{value:se},cr.createElement("div",{className:"swiper-zoom-container","data-swiper-zoom":typeof R=="number"?R:void 0},Q(),w&&!Z&&cr.createElement("div",{className:"swiper-lazy-preloader"}))),!R&&cr.createElement(P4.Provider,{value:se},Q(),w&&!Z&&cr.createElement("div",{className:"swiper-lazy-preloader"})))});JR.displayName="SwiperSlide";const x4="/assets/1-BFCyOoiD.png",k4="/assets/2-fFq1KYAn.png",pY="/assets/3-BKc4Os9d.png",fY="/assets/4-DSnohge-.png",mY="/assets/5-ClTK3tpc.png",Ro="/assets/6-mjfRKAkB.png";function SV(){const p=[{img:x4,name:"",link:"/"},{img:k4,name:"",link:"/"},{img:pY,name:"",link:"/"},{img:fY,name:"",link:"/"},{img:mY,name:"",link:"/"},{img:Ro,name:"",link:"/"},{img:x4,name:"",link:"/"},{img:k4,name:"",link:"/"}];return A.jsxs("div",{className:"popular-category flex flex-col gap-2 w-full",children:[A.jsxs("div",{className:"flex justify-between items-end px-3",children:[A.jsx("p",{className:"text-[11px] leading-[13px]",children:""}),A.jsx(qi,{to:rt?.CATEGORY_LIST,className:"text-[9px] leading-[11px]",children:" "})]}),A.jsx("div",{className:"w-full",children:A.jsx(XR,{spaceBetween:4,slidesPerView:5,children:p?.map((_,g)=>A.jsx(JR,{children:A.jsxs(qi,{to:_?.link,className:"flex flex-col items-center gap-1",children:[A.jsx("img",{src:_?.img,alt:"category",className:"w-full aspect-square object-cover rounded-[8px]"}),A.jsx("p",{className:"text-[8px] leading-[10px] text-neutral-1200 text-center",children:_?.name})]})},g))})})]})}function ZR({data:p}){return A.jsxs(qi,{to:p?.link,className:"relative",children:[A.jsx("img",{src:p?.img,alt:"product",className:"relative z-0 w-full aspect-square rounded-[8px]"}),A.jsx("div",{className:"absolute bottom-[6px] right-0 flex justify-end min-w-[49px] px-2 bg-white bg-opacity-70",children:A.jsxs("p",{className:"text-[8px] leading-[10px] text-black",children:["",p?.money]})})]})}const wl="/assets/7-BrK51Gg9.png",tp="/assets/8-lEJiffLe.png",ou="/assets/9-DXAMUFJx.png";function vV(){const p=Da(),_=[{img:Ro,money:"22,000",link:"/"},{img:wl,money:"16,000",link:"/"},{img:tp,money:"800",link:"/"},{img:ou,money:"1,400",link:"/"},{img:Ro,money:"22,000",link:"/"},{img:wl,money:"16,000",link:"/"},{img:tp,money:"800",link:"/"},{img:ou,money:"1,400",link:"/"}],g=()=>{p("/layout/")};return A.jsxs("div",{className:"recent-product flex flex-col gap-2 w-full",children:[A.jsxs("div",{className:"flex justify-between items-center px-3",children:[A.jsx("p",{className:"text-[11px] leading-[13px]",children:""}),A.jsx("button",{onClick:g,className:"text-[9px] leading-[11px]",children:""})]}),A.jsx("div",{className:"w-full",children:A.jsx(XR,{spaceBetween:4,slidesPerView:4,children:_?.map((v,R)=>A.jsx(JR,{children:A.jsx(ZR,{data:v})},R))})})]})}function TV({data:p}){return A.jsxs(qi,{to:p?.link,className:"product-card flex flex-col gap-[2px]",children:[A.jsx("img",{src:p?.imgProduct,alt:"product",className:"w-full aspect-square rounded-[2px]"}),A.jsxs("div",{className:"grid grid-cols-[115fr_70fr] gap-1",children:[A.jsxs("div",{className:"flex flex-col gap-1",children:[A.jsx("p",{className:"text-[7px] leading-[8px] line-clamp-1",children:p?.nameProduct}),A.jsxs("div",{className:"flex items-center gap-6 text-[6px] leading-[7px]",children:[A.jsx("p",{children:""}),A.jsxs("p",{className:"text-red-100",children:["",p?.money]})]})]}),A.jsxs("div",{className:"flex justify-end items-end gap-1",children:[A.jsx("p",{className:"text-[6px] leading-[7px] truncate",children:p?.nameShop}),A.jsx("img",{src:p?.imgShop,alt:"shop",className:"w-[25px] h-[25px]"})]})]})]})}const QR="/assets/10-Bu0QSj4Q.png",H2="/assets/11-CrZN0ZSK.png",yV="/assets/12-aZ79SwQE.png",RV="/assets/13-DtbFduuM.png",W2="/assets/14-Dz3LKLil.png",CV="/assets/15-Bs5k0Xxh.png",N2="/assets/16-Bi4EWHu3.png",D2="/assets/17-BQiAjjvv.png",bV="/assets/18-FR4-8j_K.png",AV="/assets/19-Ncg14wek.png",wV="/assets/20-BQGf3PzE.png",IV="/assets/21-BjrjJ5qa.png";function OV(){const p=[{imgProduct:QR,money:"1,200",nameProduct:"balenciaga ",imgShop:N2,nameShop:"simgffj",link:"/layout"},{imgProduct:H2,money:"9,500",nameProduct:"Noir kei ninomiya ",imgShop:D2,nameShop:"ponta",link:"/layout"},{imgProduct:yV,money:"6,000",nameProduct:"DRIES VAN NOTEN ",imgShop:bV,nameShop:"",link:"/layout"},{imgProduct:RV,money:"2,000",nameProduct:"W&LT / Psychedelic Knit Vest",imgShop:AV,nameShop:"meangirls",link:"/layout"},{imgProduct:W2,money:"9,200",nameProduct:" ",imgShop:wV,nameShop:"ReviResonia",link:"/layout"},{imgProduct:CV,money:"38,000",nameProduct:"Archive Denim Half Coat",imgShop:IV,nameShop:"ichigo",link:"/layout"}];return A.jsxs("div",{className:"recommend-product flex flex-col gap-2 w-full",children:[A.jsx("p",{className:"ml-3 text-[11px] leading-[13px]",children:""}),A.jsx("div",{className:"grid grid-cols-2 gap-x-[2px] gap-y-3 w-full",children:p?.map((_,g)=>A.jsx(TV,{data:_},g))})]})}function _Y(){return A.jsxs("div",{className:"top-no-login-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{isTopPage:!0}),A.jsxs("div",{className:"container flex flex-col gap-8",children:[A.jsx(SV,{}),A.jsx(vV,{}),A.jsx(OV,{})]})]})}function EY(){return A.jsxs("div",{className:"liked-product flex flex-col gap-2",children:[A.jsxs("div",{className:"flex justify-between items-end pb-[6px] px-3 border-b border-neutral-300",children:[A.jsx("p",{className:"text-[12px] leading-[15px]",children:""}),A.jsx(qi,{to:"/layout/",className:"text-[9px] leading-[11px]",children:" "})]}),A.jsx("div",{className:"flex justify-center items-center py-[72px] bg-dark-300 rounded-[4px]",children:A.jsx("p",{className:"text-[12px] leading-[15px]",children:""})})]})}function gY(){return A.jsxs("div",{className:"top-login-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{isTopPage:!0,isAuth:!0}),A.jsxs("div",{className:"container flex flex-col gap-8",children:[A.jsx(EY,{}),A.jsx(SV,{}),A.jsx(vV,{}),A.jsx(OV,{})]})]})}const SY="data:image/svg+xml,%3csvg%20width='11'%20height='14'%20viewBox='0%200%2011%2014'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0.742188%2012.6204C0.782188%2013.3504%201.41218%2013.9403%202.14218%2013.9403H8.08218C8.81218%2013.9403%209.44221%2013.3404%209.48221%2012.6204L9.96219%204.28027H0.242188L0.722198%2012.6204H0.742188Z'%20fill='%23A5A5A5'/%3e%3cpath%20d='M9.98001%202.19995C9.83001%202.13995%208.54001%201.66999%206.60001%201.48999C6.60001%201.48999%206.60001%201.46996%206.60001%201.45996C6.60001%200.649961%205.94998%200%205.13998%200C4.32998%200%203.67999%200.649961%203.67999%201.45996C3.67999%201.45996%203.67999%201.47999%203.67999%201.48999C1.73999%201.66999%200.449988%202.13995%200.299988%202.19995C0.0399878%202.30995%200%202.45993%200%202.67993V3.63989H10.27V2.67993C10.27%202.45993%2010.23%202.30995%209.97%202.19995H9.98001ZM5.13998%201.41992C4.91998%201.41992%204.71001%201.41993%204.51001%201.42993C4.53001%201.08993%204.79998%200.829956%205.13998%200.829956C5.47998%200.829956%205.74999%201.09993%205.76999%201.42993C5.55999%201.42993%205.35998%201.41992%205.13998%201.41992Z'%20fill='%23A5A5A5'/%3e%3c/svg%3e";function vY({data:p,isEdit:_}){return A.jsxs("div",{className:"like-list-item flex items-center gap-4 pb-2 px-2 border-b border-neutral-300",children:[A.jsx("img",{src:p?.img,alt:"product",className:"w-[84px] aspect-square"}),A.jsxs("div",{className:"flex flex-col gap-4 grow",children:[A.jsx("p",{className:"text-[13px] leading-[16px]",children:p?.name}),A.jsxs("div",{className:"flex justify-between items-center gap-1",children:[A.jsxs("div",{className:"flex items-center gap-1 text-[10px] leading-[12px]",children:[A.jsx("p",{children:""}),A.jsxs("p",{className:"text-red-100",children:["",p?.money]})]}),A.jsx("button",{className:!_&&"invisible",children:A.jsx("img",{src:SY,alt:"trash",className:"w-[10px] h-[14px]"})})]})]})]})}const TY="data:image/svg+xml,%3csvg%20width='9'%20height='9'%20viewBox='0%200%209%209'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8.07001%200.25H0.25V8.06995H8.07001V0.25Z'%20stroke='%23DBDBDB'%20stroke-width='0.5'%20stroke-miterlimit='10'/%3e%3c/svg%3e",NV="data:image/svg+xml,%3csvg%20width='11'%20height='11'%20viewBox='0%200%2011%2011'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M3.28%209.11714C3.28%209.11714%203.30001%209.09715%203.32001%209.07715L7.17001%205.22714L7.20999%205.18715C7.20999%205.18715%207.23%205.16714%207.25%205.14714L9.29001%203.10715L7.01001%200.827148L4.97%202.86714L4.92999%202.90715C4.92999%202.90715%204.91001%202.92714%204.89001%202.94714L1%206.83714L0%2010.1171L3.23001%209.13715L3.28%209.12715V9.11714ZM0.730011%209.38715L1.23001%207.74715L2.37%208.88715L0.730011%209.38715Z'%20fill='%23DBDBDB'/%3e%3cpath%20d='M9.94156%202.0575C10.1916%201.8075%2010.1916%201.3875%209.94156%201.1375L8.99155%200.1875C8.74155%20-0.0625%208.32156%20-0.0625%208.07156%200.1875L7.60156%200.657501L9.47156%202.5275L9.94156%202.0575Z'%20fill='%232B2B2B'/%3e%3c/svg%3e";function yY(){const[p,_]=ie.useState(!1),g=[{img:QR,name:"balenciaga ",money:"1,200"},{img:H2,name:"Noir kei ninomiya ",money:"9,500"}],v=()=>{_(!p)};return A.jsxs("div",{className:"like-list-page flex flex-col items-center w-full h-max min-h-full",children:[A.jsx(ln,{title:""}),A.jsxs("div",{className:"container flex flex-col gap-4",children:[A.jsxs("div",{className:"flex justify-between items-center px-3 text-[10px] leading-[12px]",children:[A.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[A.jsx("img",{src:TY,alt:"checkbox",className:"w-2 h-2"}),A.jsx("p",{children:""})]}),A.jsxs("button",{onClick:v,className:"flex items-center gap-3",children:[A.jsx("p",{children:p?"":""}),!p&&A.jsx("img",{src:NV,alt:"edit",className:"w-[10px] h-[10px]"})]})]}),A.jsxs("div",{className:"flex flex-col gap-[10px]",children:[A.jsx("div",{className:"pb-1 pl-3 border-b border-neutral-300",children:A.jsx("p",{className:"text-[12px] leading-[15px]",children:""})}),A.jsx("div",{className:"flex flex-col gap-[10px]",children:g?.map((R,w)=>A.jsx(vY,{isEdit:p,data:R},w))})]})]})]})}const DV="data:image/svg+xml,%3csvg%20width='12'%20height='12'%20viewBox='0%200%2012%2012'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M11.1507%2011.6407L6.71067%207.20066C6.35067%207.50067%205.93068%207.74067%205.48068%207.89067C5.04068%208.05067%204.57068%208.14067%204.09068%208.14067C3.00068%208.16067%201.95068%207.74066%201.18068%206.96066C0.400676%206.20066%20-0.0193172%205.16066%200.000682771%204.07066C-0.0193172%201.84066%201.77068%200.0206679%204.00068%200.000667889C4.02068%200.000667889%204.05067%200.000667889%204.07067%200.000667889C5.16067%20-0.0193321%206.21068%200.410661%206.97068%201.18066C7.75068%201.94066%208.18069%202.98066%208.16069%204.07066C8.16069%204.56066%208.07068%205.05066%207.89068%205.51066C7.73068%205.94066%207.50068%206.34066%207.20068%206.68066L11.6607%2011.1407L11.1407%2011.6407H11.1507ZM4.09068%207.43066C5.93068%207.45066%207.43068%205.98067%207.45068%204.14067C7.45068%204.12067%207.45068%204.09066%207.45068%204.07066C7.47068%202.23066%206.00069%200.730659%204.16069%200.710659C4.14069%200.710659%204.11068%200.710659%204.09068%200.710659C3.19068%200.690659%202.32069%201.04066%201.69069%201.68066C1.05069%202.31066%200.690674%203.17066%200.710674%204.07066C0.690674%204.97066%201.04069%205.83066%201.69069%206.46066C2.32069%207.10066%203.19068%207.45066%204.09068%207.43066Z'%20fill='%23DBDBDB'/%3e%3c/svg%3e";function RY({data:p,index:_}){return A.jsxs(qi,{to:p?.link,className:`search-top-item flex justify-between items-center gap-1 h-[46px] pl-[11px] pr-[13px] border-b border-neutral-300 ${_===0?"border-t":""}`,children:[A.jsxs("div",{className:"flex items-center gap-4",children:[A.jsx("img",{src:DV,alt:"search",className:"w-3 h-3"}),A.jsxs("div",{children:[A.jsx("p",{className:"text-[11px] leading-[13px] text-neutral-600",children:p?.title}),p?.subTitle&&A.jsx("p",{className:"text-[8px] leading-[10px] text-neutral-700",children:p?.subTitle})]})]}),A.jsx("img",{src:Cc,alt:"arrow",className:"w-[5px] h-2"})]})}const CY="data:image/svg+xml,%3csvg%20width='11'%20height='11'%20viewBox='0%200%2011%2011'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9.20372%2010.4453L-0.00133512%201.24024L1.23906%20-0.000159318L10.4441%209.2049L9.20372%2010.4453ZM1.23906%2010.4453L-0.00133512%209.2049L9.20372%20-0.000159318L10.4441%201.24024L1.23906%2010.4453Z'%20fill='%23DBDBDB'/%3e%3c/svg%3e";function bY(){const[p,_]=ie.useState(""),g=[{title:"",link:rt?.SEARCH_RESULT},{title:"T",link:rt?.SEARCH_RESULT},{title:"",link:rt?.SEARCH_RESULT},{title:"",subTitle:"",link:rt?.SEARCH_RESULT},{title:"",link:rt?.SEARCH_RESULT},{title:"",link:rt?.SEARCH_RESULT},{title:"",link:rt?.SEARCH_RESULT},{title:"",link:rt?.SEARCH_RESULT},{title:"",link:rt?.SEARCH_RESULT}],v=()=>{_("")},R=w=>{_(w.target.value)};return A.jsxs("div",{className:"search-top-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:""}),A.jsxs("div",{className:"container flex flex-col gap-4",children:[A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("button",{onClick:v,className:"w-[11px] h-[11px]",children:A.jsx("img",{src:CY,alt:"remove",className:"w-full h-full"})}),A.jsxs("div",{className:`flex items-center gap-[5px] grow h-8 px-[13px] border ${p?.length>0?"border-dark-200":"bg-neutral-800 border-neutral-800"}`,children:[A.jsx("img",{src:DV,alt:"search",className:"w-3 h-3"}),A.jsx("input",{className:"grow text-[12px] leading-[15px] text-neutral-600 bg-transparent outline-none placeholder:text-neutral-600",placeholder:"",value:p,onChange:R})]})]}),p?.length>0?A.jsx("div",{children:g?.map((w,x)=>A.jsx(RY,{index:x,data:w},x))}):A.jsx("div",{className:"pt-3 pb-[6px] pl-[11px] border-b border-neutral-300",children:A.jsx("p",{className:"text-[9px] leading-[11px] text-neutral-700",children:""})})]})]})}const AY="data:image/svg+xml,%3csvg%20width='14'%20height='8'%20viewBox='0%200%2014%208'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M6.58997%207.91977C4.49997%207.91977%202.83003%207.01978%202.03003%206.48978C1.09003%205.86978%200%204.82979%200%203.96979C0%202.60979%202.81002%200.00976562%206.65002%200.00976562C10.94%200.00976562%2013.3%203.05976%2013.3%204.06976C13.3%205.27976%209.92997%207.91977%206.58997%207.91977ZM6.64001%200.979767C3.16001%200.979767%200.960083%203.36978%200.960083%203.95978C0.960083%204.54978%203.42008%206.93979%206.58008%206.93979C9.74008%206.93979%2012.1801%204.56977%2012.3101%204.04977C12.2601%203.59977%2010.45%200.969788%206.63%200.969788L6.64001%200.979767Z'%20fill='%234B4B4B'/%3e%3cpath%20d='M6.59302%206.10031C7.77491%206.10031%208.73303%205.14222%208.73303%203.96033C8.73303%202.77844%207.77491%201.82031%206.59302%201.82031C5.41113%201.82031%204.45312%202.77844%204.45312%203.96033C4.45312%205.14222%205.41113%206.10031%206.59302%206.10031Z'%20fill='%234B4B4B'/%3e%3cpath%20d='M6.59277%207.91998C4.41277%207.91998%202.63281%206.13999%202.63281%203.95999C2.63281%201.77999%204.41277%200%206.59277%200C8.77277%200%2010.5529%201.77999%2010.5529%203.95999C10.5529%206.13999%208.77277%207.91998%206.59277%207.91998ZM6.59277%200.97998C4.95277%200.97998%203.61279%202.31999%203.61279%203.95999C3.61279%205.59999%204.95277%206.94%206.59277%206.94C8.23277%206.94%209.57288%205.59999%209.57288%203.95999C9.57288%202.31999%208.23277%200.97998%206.59277%200.97998Z'%20fill='%234B4B4B'/%3e%3c/svg%3e",wY="data:image/svg+xml,%3csvg%20width='14'%20height='10'%20viewBox='0%200%2014%2010'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8.74219%204.66052C8.74219%203.48052%207.78217%202.52051%206.60217%202.52051C6.48217%202.52051%206.36219%202.54052%206.24219%202.56052L8.71228%205.03052C8.73228%204.91052%208.7522%204.79053%208.7522%204.67053L8.74219%204.66052Z'%20fill='%234B4B4B'/%3e%3cpath%20d='M4.46094%204.66055C4.46094%205.84055%205.42083%206.80057%206.60083%206.80057C7.00083%206.80057%207.37093%206.68054%207.70093%206.49054L4.77087%203.56055C4.58087%203.88055%204.46094%204.25055%204.46094%204.66055Z'%20fill='%234B4B4B'/%3e%3cpath%20d='M6.64722%200.700439C6.64722%200.700439%206.61718%200.700439%206.60718%200.700439C6.60718%200.700439%206.59728%200.700439%206.58728%200.700439C6.57728%200.700439%206.55724%200.700439%206.54724%200.700439C5.86724%200.700439%205.22719%200.800439%204.61719%200.950439L5.54724%201.88043C5.85724%201.76043%206.19724%201.69042%206.54724%201.68042C6.56724%201.68042%206.58718%201.68042%206.60718%201.68042C8.24718%201.68042%209.56726%203.02043%209.56726%204.66043C9.56726%205.03043%209.48719%205.38044%209.36719%205.70044L10.0972%206.43042C10.3672%205.89042%2010.5372%205.30042%2010.5372%204.65042C10.5372%203.81042%2010.2673%203.03043%209.81726%202.38043C11.4673%203.19043%2012.2773%204.44042%2012.3073%204.74042C12.2373%205.02042%2011.4372%205.86042%2010.2372%206.56042L10.9473%207.27042C12.3373%206.43042%2013.2872%205.39043%2013.2872%204.75043C13.2872%203.74043%2010.9272%200.69043%206.63721%200.69043L6.64722%200.700439Z'%20fill='%234B4B4B'/%3e%3cpath%20d='M6.59998%207.64014C4.95998%207.64014%203.62%206.30013%203.62%204.66013C3.62%204.03013%203.82003%203.44011%204.16003%202.96011L2.82007%201.62012C1.08007%202.50012%200%203.82013%200%204.66013C0%205.50013%201.10003%206.56011%202.03003%207.18011C2.84003%207.71011%204.50009%208.61014%206.59009%208.61014C7.51009%208.61014%208.43004%208.40012%209.29004%208.09012L8.29004%207.09012C7.81004%207.43012%207.22009%207.63013%206.59009%207.63013L6.59998%207.64014ZM3.26001%206.77011C1.87001%206.03011%200.97998%205.03014%200.97998%204.67014C0.97998%204.31014%201.83005%203.24011%203.30005%202.49011C2.89005%203.12011%202.64001%203.86014%202.64001%204.67014C2.64001%205.48014%202.87001%206.17012%203.26001%206.78012V6.77011Z'%20fill='%234B4B4B'/%3e%3cpath%20d='M2.72656%200.700195L10.6366%208.62018'%20stroke='%234B4B4B'%20stroke-width='1.4'%20stroke-miterlimit='10'%20stroke-linecap='round'/%3e%3c/svg%3e";function Qn({className:p,value:_,name:g,label:v,placeholder:R,type:w="text",showPasswordIcon:x,maxLength:W,title:P,...V}){const[q,z]=ie.useState(w),[ce,Z]=ie.useState(0),ae=()=>{z(q==="password"?"text":"password")},ne=se=>{if(W){const Q=se?.target?.value;Z(Q?.length)}};return A.jsxs("div",{className:`input-container flex flex-col gap-[6px] ${p}`,children:[A.jsxs("div",{className:"flex flex-col gap-1",children:[v&&A.jsx("label",{className:"ml-1 text-[11px] leading-[13px] text-neutral-500",children:v}),A.jsxs("div",{className:"flex items-center gap-1 w-full h-[29px] px-[13px] bg-neutral-300 border border-black rounded-[2px]",children:[A.jsx("input",{...V,onChange:ne,type:q,maxLength:W,value:_,name:g,placeholder:R,className:"grow text-[7px] leading-[8px] text-black bg-transparent outline-none placeholder:text-black"}),w==="password"&&x&&A.jsx("button",{onClick:ae,children:A.jsx("img",{src:q==="password"?wY:AY,alt:"icon pass",className:"w-[13px] h-2"})})]})]}),(P||W)&&A.jsxs("div",{className:"flex justify-between items-center px-1 text-[7px] leading-[8px] text-neutral-500",children:[P&&A.jsx("p",{children:P}),W&&A.jsxs("p",{className:"input-max-length ml-auto",children:[ce,"/",W]})]})]})}function Nr({children:p,className:_,kind:g="primary",...v}){const R=()=>{let w="";return g==="primary"?w="button-primary flex justify-center items-center gap-[6px] w-full h-[37px] text-[11px] leading-[13px] text-white bg-red-300 rounded-[2px]":g==="primary-large"?w="button-primary-large flex justify-center items-center gap-[6px] w-full h-[42px] text-[14px] leading-[17px] text-neutral-600 bg-red-300 rounded-[2px]":g==="outline"?w="button-outline flex justify-center items-center gap-[6px] w-full h-[37px] text-[11px] leading-[13px] text-red-200 bg-neutral-200 border border-red-200 rounded-[2px]":g==="secondary"?w="button-secondary flex justify-center items-center gap-[6px] w-full h-[27px] text-[10px] leading-[12px] text-white bg-dark-200 rounded-[2px]":g==="secondary-small"&&(w="button-secondary-small flex justify-center items-center gap-[6px] w-full h-[22px] text-[10px] leading-[12px] text-white bg-dark-200 rounded-full"),w+" "+_};return A.jsx("button",{className:R(),...v,children:p})}function IY(){const p=Da(),_=()=>{p(rt?.REGISTRATION_EMAIL_SENT)};return A.jsxs("div",{className:"user-registration-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:""}),A.jsxs("div",{className:"container",children:[A.jsx("p",{className:"text-[10px] leading-[12px] mb-6",children:""}),A.jsx(Qn,{className:"mb-4",label:"",placeholder:"future.vintage@example.com",title:""}),A.jsx(Qn,{className:"mb-6",label:"",type:"password"}),A.jsx(Qn,{className:"mb-[59px] [&_.input-max-length]:text-black",label:"",placeholder:"Future Vintage",maxLength:20,title:""}),A.jsx(Nr,{onClick:_,children:""})]})]})}function OY(){const p=Da(),_=()=>{p("/layout/")};return A.jsxs("div",{className:"login-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:""}),A.jsxs("div",{className:"container flex flex-col",children:[A.jsx("p",{className:"text-[10px] leading-[12px] mb-7 ml-auto mr-4",children:""}),A.jsx(Qn,{className:"mb-4",label:"",placeholder:"future.vintage@example.com"}),A.jsx(Qn,{className:"mb-11",label:"",type:"password"}),A.jsx(Nr,{onClick:_,className:"mb-1",children:""}),A.jsxs("p",{className:"mb-[6px] ml-1 text-[11px] leading-[13px]",children:[A.jsx(qi,{to:"/layout/",className:"text-red-200",children:""}),"",A.jsx(qi,{to:"/layout/",className:"text-red-200",children:""}),""]}),A.jsx("p",{className:"mb-[123px] ml-1 text-[11px] leading-[13px]",children:""}),A.jsx("p",{className:"mb-6 mx-auto text-[10px] leading-[12px] text-red-200",children:""}),A.jsx(Nr,{onClick:_,kind:"outline",children:""})]})]})}function NY(){const p=Da(),_=()=>{p("/layout/")};return A.jsxs("div",{className:"registration-email-sent-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:""}),A.jsxs("div",{className:"container flex flex-col gap-[187px]",children:[A.jsxs("div",{className:"flex flex-col gap-[6px] text-[13px] leading-[16px]",children:[A.jsx("p",{children:""}),A.jsx("p",{children:""}),A.jsx("p",{children:""}),A.jsx("p",{children:""})]}),A.jsx(Nr,{onClick:_,children:""})]})]})}function DY(){const p=[{title:"",to:"/"},{title:"",to:"/"},{title:"",to:"/"},{title:"",to:"/"},{title:"ETC",to:"/"},{title:"",to:"/"},{title:"",to:"/"},{title:"",to:"/"},{title:"",to:"/"}],_=[{title:"",level:3,list:p},{title:"",level:3,list:p},{title:"",level:3,list:p}],g=[{title:"",level:2,list:_,id:1},{title:"",level:2,list:_,id:2},{title:"",level:2,list:_,id:3},{title:"",level:2,list:_,id:4},{title:"",level:2,list:_,id:5},{title:"",level:2,list:_,id:6},{title:"CDDVD",level:2,list:_,id:7},{title:"",level:2,list:_,id:8},{title:"",level:2,list:_,id:9},{title:"",level:2,list:_,id:10},{title:"",level:2,list:_,id:11},{title:"",level:2,list:_,id:12},{title:"",level:2,list:_,id:13},{title:"",level:2,list:_,id:14},{title:"",level:2,list:_,id:15},{title:"",level:2,list:_,id:16},{title:"",level:2,list:_,id:17},{title:"",level:2,list:_,id:18}],v={title:"",level:1,list:g},R="flex justify-between items-center h-[46px] pl-[2px] pr-4 border-b border-neutral-300 [&_img]:w-[5px] [&_img]:h-2",[w,x]=ie.useState(v),[W,P]=ie.useState(0),V=M2(),q=ce=>{x(ce),ce?.level===2&&P(ce?.id),V?.current?.scrollTo(0,0)},z=()=>{if(w?.level===3){const ce=g?.find(Z=>Z?.id===W);x(ce)}else x(v)};return A.jsxs("div",{className:"category-list-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:w?.title,showBack:w?.level>1,handleBack:z}),A.jsxs("div",{className:"container flex flex-col text-[11px] leading-[13px]",children:[w?.level>1&&A.jsx("div",{className:R,children:A.jsx("p",{children:""})}),w?.list?.map((ce,Z)=>ce?.to?A.jsxs(qi,{to:ce.to,className:R,children:[A.jsx("p",{children:ce.title}),A.jsx("img",{src:Cc,alt:"arrow"})]},Z):A.jsxs("button",{className:R,onClick:()=>q(ce),children:[A.jsx("p",{children:ce.title}),A.jsx("img",{src:Cc,alt:"arrow"})]},Z))]})]})}const LV="data:image/svg+xml,%3csvg%20width='11'%20height='11'%20viewBox='0%200%2011%2011'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M5.45502%2010.535C8.26062%2010.535%2010.535%208.26056%2010.535%205.45496C10.535%202.64935%208.26062%200.375%205.45502%200.375C2.64941%200.375%200.375%202.64935%200.375%205.45496C0.375%208.26056%202.64941%2010.535%205.45502%2010.535Z'%20stroke='%23E6E6E6'%20stroke-width='0.75'%20stroke-miterlimit='10'/%3e%3c/svg%3e",PV="data:image/svg+xml,%3csvg%20width='11'%20height='11'%20viewBox='0%200%2011%2011'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M5.45502%2010.535C8.26062%2010.535%2010.535%208.26068%2010.535%205.45508C10.535%202.64947%208.26062%200.375%205.45502%200.375C2.64941%200.375%200.375%202.64947%200.375%205.45508C0.375%208.26068%202.64941%2010.535%205.45502%2010.535Z'%20stroke='%23E6E6E6'%20stroke-width='0.75'%20stroke-miterlimit='10'/%3e%3cpath%20d='M5.4516%208.05542C6.88754%208.05542%208.05157%206.89138%208.05157%205.45544C8.05157%204.0195%206.88754%202.85547%205.4516%202.85547C4.01566%202.85547%202.85156%204.0195%202.85156%205.45544C2.85156%206.89138%204.01566%208.05542%205.4516%208.05542Z'%20fill='%23E6E6E6'/%3e%3c/svg%3e";function LY(){const[p,_]=ie.useState(!1),[g,v]=ie.useState(""),[R,w]=ie.useState(1),x=M2(),W=ie.useRef(null),P=[{label:"",value:1},{label:"",value:2},{label:"",value:3}],V=()=>{_(!p)},q=z=>{v(z?.label),w(z?.value),V()};return ie.useEffect(()=>{function z(ce){W.current&&!W.current.contains(ce.target)&&V()}return p&&(document.addEventListener("mousedown",z),x?.current?.classList?.add("overflow-hidden")),()=>{document.removeEventListener("mousedown",z),x?.current?.classList?.remove("overflow-hidden")}},[p,x]),A.jsxs("div",{className:"relative",children:[A.jsxs("button",{onClick:V,className:"flex items-center gap-[19px]",id:"label-for-editor",children:[A.jsx("p",{className:"text-[12px] leading-[15px]",children:g}),A.jsx("img",{src:jR,alt:"arrow",className:`w-2 h-[5px] ${p&&"rotate-180"}`})]}),p&&A.jsx("div",{ref:W,className:"absolute top-full left-0 z-[2] translate-y-[5px] translate-x-[-18px] flex flex-col justify-center gap-2 w-[129px] h-max p-2 bg-dark-300",children:P?.map(z=>A.jsxs("button",{className:"flex justify-between items-center",onClick:()=>q(z),children:[A.jsx("p",{className:"text-[10px] leading-[12px]",children:z?.label}),A.jsx("img",{src:R===z?.value?PV:LV,alt:"checkbox",className:"w-[10px] h-[10px]"})]},z?.value))}),p&&A.jsx("div",{className:"fixed top-[55px] bottom-[72px] z-[1] left-0 w-full h-[calc(100%-127px)] bg-neutral-900 bg-opacity-40"})]})}const PY="data:image/svg+xml,%3csvg%20width='19'%20height='13'%20viewBox='0%200%2019%2013'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M5.67969%203V9.42188L8.14844%206.94531L8.75781%207.54687L5.25%2011.0469L1.75%207.54687L2.34375%206.94531L4.82031%209.42188V3H5.67969Z'%20fill='%23DBDBDB'/%3e%3cpath%20d='M11.9609%2011V4.57813L9.49219%207.05469L8.88281%206.45312L12.3906%202.95312L15.8906%206.45312L15.2969%207.05469L12.8203%204.57813V11H11.9609Z'%20fill='%23DBDBDB'/%3e%3c/svg%3e";function xY(){const[p,_]=ie.useState(!1),[g,v]=ie.useState(""),[R,w]=ie.useState(1),x=M2(),W=ie.useRef(null),P=[{label:"",value:1},{label:"",value:2},{label:"",value:3},{label:"",value:4},{label:"",value:5}],V=()=>{_(!p)},q=z=>{v(z?.label),w(z?.value),V()};return ie.useEffect(()=>{function z(ce){W.current&&!W.current.contains(ce.target)&&V()}return p&&(document.addEventListener("mousedown",z),x?.current?.classList?.add("overflow-hidden")),()=>{document.removeEventListener("mousedown",z),x?.current?.classList?.remove("overflow-hidden")}},[p,x]),A.jsxs("div",{className:"relative",children:[A.jsxs("button",{onClick:V,className:"flex items-center gap-[6px]",children:[A.jsx("img",{src:PY,alt:"sort",className:"w-[18px] h-[13px]"}),A.jsx("p",{className:"text-[12px] leading-[15px]",children:g})]}),p&&A.jsx("div",{ref:W,className:"absolute top-full right-0 z-[2] translate-y-[5px] translate-x-[11px] flex flex-col justify-center gap-2 w-[129px] h-max p-2 bg-dark-300",children:P?.map(z=>A.jsxs("button",{className:"flex justify-between items-center",onClick:()=>q(z),children:[A.jsx("p",{className:"text-[10px] leading-[12px]",children:z?.label}),A.jsx("img",{src:R===z?.value?PV:LV,alt:"checkbox",className:"w-[10px] h-[10px]"})]},z?.value))}),p&&A.jsx("div",{className:"fixed top-[55px] bottom-[72px] left-0 z-[1] w-full h-[calc(100%-127px)] bg-neutral-900 bg-opacity-40"})]})}const kY="data:image/svg+xml,%3csvg%20width='12'%20height='10'%20viewBox='0%200%2012%2010'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0%201.40039H2.08002'%20stroke='%23D8D8D8'%20stroke-width='0.5'%20stroke-miterlimit='10'/%3e%3cpath%20d='M4.29688%201.40039H11.1968'%20stroke='%23D8D8D8'%20stroke-width='0.5'%20stroke-miterlimit='10'/%3e%3cpath%20d='M3.22815%202.54999C3.86328%202.54999%204.37811%202.03512%204.37811%201.39999C4.37811%200.764866%203.86328%200.25%203.22815%200.25C2.59302%200.25%202.07812%200.764866%202.07812%201.39999C2.07812%202.03512%202.59302%202.54999%203.22815%202.54999Z'%20stroke='%23D8D8D8'%20stroke-width='0.5'%20stroke-miterlimit='10'/%3e%3cpath%20d='M0%204.69043H6.90002'%20stroke='%23D8D8D8'%20stroke-width='0.5'%20stroke-miterlimit='10'/%3e%3cpath%20d='M9.13281%204.69043H11.2028'%20stroke='%23D8D8D8'%20stroke-width='0.5'%20stroke-miterlimit='10'/%3e%3cpath%20d='M8.04846%205.84006C8.68359%205.84006%209.19843%205.32516%209.19843%204.69003C9.19843%204.05491%208.68359%203.54004%208.04846%203.54004C7.41333%203.54004%206.89844%204.05491%206.89844%204.69003C6.89844%205.32516%207.41333%205.84006%208.04846%205.84006Z'%20stroke='%23D8D8D8'%20stroke-width='0.5'%20stroke-miterlimit='10'/%3e%3cpath%20d='M0%207.98047H4.15002'%20stroke='%23D8D8D8'%20stroke-width='0.5'%20stroke-miterlimit='10'/%3e%3cpath%20d='M6.36719%207.98047H11.1971'%20stroke='%23D8D8D8'%20stroke-width='0.5'%20stroke-miterlimit='10'/%3e%3cpath%20d='M5.29846%209.13007C5.93359%209.13007%206.44843%208.6152%206.44843%207.98007C6.44843%207.34494%205.93359%206.83008%205.29846%206.83008C4.66333%206.83008%204.14844%207.34494%204.14844%207.98007C4.14844%208.6152%204.66333%209.13007%205.29846%209.13007Z'%20stroke='%23D8D8D8'%20stroke-width='0.5'%20stroke-miterlimit='10'/%3e%3c/svg%3e",MY="/assets/22-DukjYfrI.png",UY="/assets/23-CjkBXrKr.png",VY="/assets/24-Dr9m-hs0.png",jY="/assets/25-BZoWM4wF.png",BY="/assets/26-BuL5JnNk.png",FY="/assets/27-WnLymunr.png",GY="/assets/28-BKDn-avd.png",HY="/assets/29-CNwELTLO.png";function WY(){const p=[{imgProduct:MY,money:"11,200",nameProduct:"balenciaga ",nameShop:"simgffj",link:"/layout",imgShop:N2},{imgProduct:UY,money:"9,500",nameProduct:"Noir kei ninomiya ",nameShop:"ponta",link:"/layout",imgShop:D2},{imgProduct:VY,money:"6,000",nameProduct:"DRIES VAN NOTEN ",nameShop:"",link:"/layout",imgShop:bV},{imgProduct:jY,money:"12,000",nameProduct:"W&LT / Psychedelic Knit Vest",nameShop:"meangirls",link:"/layout",imgShop:AV},{imgProduct:BY,money:"9,200",nameProduct:" ",nameShop:"ReviResonia",link:"/layout",imgShop:wV},{imgProduct:FY,money:"38,000",nameProduct:"Archive Denim Half Coat",nameShop:"ichigo",link:"/layout",imgShop:IV},{imgProduct:GY,money:"1,200",nameProduct:"balenciaga ",nameShop:"ichigo",link:"/layout",imgShop:N2},{imgProduct:HY,money:"9,500",nameProduct:"Noir kei ninomiya ",nameShop:"ichigo",link:"/layout",imgShop:D2}];return A.jsxs("div",{className:"search-result-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:""}),A.jsxs("div",{className:"container flex flex-col gap-5 text-[11px] leading-[13px]",children:[A.jsxs("div",{className:"flex flex-col items-end gap-3 pb-[6px] px-3 border-b border-neutral-300",children:[A.jsx(xY,{}),A.jsxs("div",{className:"flex justify-between items-center w-full",children:[A.jsx(LY,{}),A.jsxs("button",{className:"flex items-center gap-2",children:[A.jsx("img",{src:kY,alt:"filter",className:"w-[11px] h-[9px]"}),A.jsx("p",{className:"text-[12px] leading-[15px]",children:"(1)"})]})]})]}),A.jsx("div",{className:"grid grid-cols-2 gap-x-1 gap-y-2 w-full",children:p?.map((_,g)=>A.jsx(TV,{data:_},g))})]})]})}function C2({title:p,list:_}){return A.jsxs("div",{className:"my-page-navigation flex flex-col gap-4 w-full",children:[A.jsx("div",{className:"pb-4 pl-[2px] border-b border-neutral-300",children:A.jsx("p",{className:"text-[11px] leading-[13px] text-neutral-700",children:p})}),_?.map((g,v)=>A.jsxs(qi,{to:g?.link,className:"flex justify-between items-center pb-4 pl-[2px] pr-[9px] border-b border-neutral-300",children:[A.jsx("p",{className:"text-[11px] leading-[13px] text-neutral-600",children:g?.label}),A.jsx("img",{src:Cc,alt:"arrow",className:"w-[5px] h-[9px"})]},v))]})}function zY({open:p,handleOpen:_}){const g=Da(),v=ie.useRef(null),R=()=>{g("/layout/")};return ie.useEffect(()=>{if(!p)return;function w(x){v.current&&!v.current.contains(x.target)&&_()}return document.addEventListener("mousedown",w),()=>{document.removeEventListener("mousedown",w)}},[p]),p?A.jsx("div",{className:"fixed top-[55px] bottom-[72px] z-[1] left-0 w-full h-[calc(100%-127px)] overflow-auto",children:A.jsxs("div",{className:"relative flex justify-center w-full h-max min-h-full p-5",children:[A.jsxs("div",{ref:v,className:"zoom-in-ani relative z-[1] flex flex-col items-center w-full max-w-[291px] pt-5 pb-7 px-1 my-auto bg-dark-300",children:[A.jsx("p",{className:"mb-5 text-[14px] leading-[17px] text-neutral-200",children:""}),A.jsx(Nr,{className:"mb-[22px]",kind:"primary-large",onClick:R,children:""}),A.jsx("button",{onClick:_,className:"text-[14px] leading-[17px] text-red-500",children:""})]}),A.jsx("div",{className:"absolute top-0 left-0 z-0 left-0 w-full h-full bg-neutral-900 bg-opacity-40"})]})}):null}const KY="/assets/avatar-mI32lpw9.svg",xV="data:image/svg+xml,%3csvg%20width='16'%20height='15'%20viewBox='0%200%2016%2015'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8.52495%200.4725L10.055%205.1925H15.0249C15.6949%205.1925%2015.965%206.0425%2015.425%206.4425L11.405%209.3625L12.935%2014.0825C13.145%2014.7125%2012.4149%2015.2425%2011.8749%2014.8525L7.8549%2011.9325L3.83488%2014.8525C3.29488%2015.2425%202.56495%2014.7125%202.77495%2014.0825L4.30497%209.3625L0.284955%206.4425C-0.255045%206.0525%200.0249795%205.1925%200.684979%205.1925H5.65495L7.18498%200.4725C7.39498%20-0.1575%208.28492%20-0.1575%208.49492%200.4725H8.52495Z'%20fill='%23FF1D25'/%3e%3c/svg%3e",kV="data:image/svg+xml,%3csvg%20width='15'%20height='17'%20viewBox='0%200%2015%2017'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M7.12%2016.46L14.25%2012.34V4.11L7.12%200L0%204.11V12.34'%20fill='%23D84800'/%3e%3cpath%20d='M4.72095%204.64977C5.10095%204.57977%205.95097%204.50977%206.74097%204.50977C7.72097%204.50977%208.25096%204.59977%208.73096%204.83977C9.21096%205.05977%209.59094%205.49976%209.59094%206.13976C9.59094%206.69976%209.25097%207.22976%208.49097%207.48976V7.50977C9.22097%207.69977%209.81091%208.23976%209.81091%209.09976C9.81091%209.70976%209.51093%2010.1798%209.08093%2010.4998C8.58093%2010.8598%207.7609%2011.0598%206.4209%2011.0598C5.6209%2011.0598%205.05094%2011.0098%204.71094%2010.9598V4.65976L4.72095%204.64977ZM6.22095%207.07976H6.76086C7.63086%207.07976%208.06091%206.77976%208.06091%206.31976C8.06091%205.82976%207.64092%205.60976%206.94092%205.60976C6.56092%205.60976%206.36096%205.62976%206.23096%205.65976V7.08977L6.22095%207.07976ZM6.22095%209.91975C6.38095%209.94975%206.58085%209.94977%206.87085%209.94977C7.58085%209.94977%208.21094%209.70975%208.21094%209.02975C8.21094%208.38975%207.59089%208.15976%206.79089%208.15976H6.22095V9.92976V9.91975Z'%20fill='%23F2F2F2'/%3e%3c/svg%3e";function YY(){const[p,_]=ie.useState(!1),g=[{label:"",value:31,percent:80},{label:"4",value:6,percent:30},{label:"3",value:1,percent:5},{label:"2",value:0,percent:0},{label:"1",value:0,percent:0}],v=[{label:"",link:"/"},{label:"",link:"/"},{label:"",link:"/"},{label:"",link:"/"},{label:"",link:"/"}],R=[{label:"",link:"/"}],w=[{label:"",link:"/"},{label:"",link:"/"}],x=()=>{_(!p)};return A.jsxs("div",{className:"my-page-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:""}),A.jsxs("div",{className:"container flex flex-col gap-7 text-[11px] leading-[13px]",children:[A.jsxs("div",{className:"flex justify-center items-center gap-9 px-5",children:[A.jsxs("div",{className:"flex flex-col items-center gap-2",children:[A.jsx("img",{src:KY,alt:"avatar",className:"w-full max-w-[79px] aspect-square"}),A.jsx("p",{className:"text-[15px] leading-[18px] text-neutral-600",children:"Y.Sara1985"})]}),A.jsxs("div",{className:"flex items-center gap-4",children:[A.jsxs("div",{className:"flex flex-col gap-2",children:[A.jsxs("div",{className:"flex justify-between items-center gap-3 w-full",children:[A.jsxs("div",{className:"flex items-center gap-1",children:[A.jsx("img",{src:xV,alt:"star",className:"w-4 h-[15px]"}),A.jsx("p",{className:"text-[12px] leading-[15px]",children:"4.2"})]}),A.jsx("p",{className:"text-[6px] leading-[7px]",children:"/ 38"}),A.jsxs("div",{className:"flex items-center gap-2",children:[A.jsx("img",{src:kV,alt:"blonze",className:"w-[14px] h-4"}),A.jsx("p",{className:"text-[12px] leading-[15px]",children:"Blonze"})]})]}),A.jsx("div",{className:"flex flex-col gap-1",children:g?.map((W,P)=>A.jsxs("div",{className:"flex items-center gap-1",children:[A.jsx("p",{className:"w-[14px] text-[7px] leading-[8px] text-neutral-600 text-left",children:W?.label}),A.jsx("div",{className:"w-[58px] h-[5px] border border-neutral-800",children:A.jsx("div",{style:{width:W?.percent+"%"},className:"h-full bg-red-400"})}),A.jsx("p",{className:"text-[5px] leading-[6px] text-neutral-600",children:W?.value})]},P))}),A.jsxs("div",{className:"flex justify-between items-center w-full",children:[A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("p",{className:"text-[10px] leading-[12px] text-neutral-600",children:""}),A.jsx("p",{className:"text-[6px] leading-[7px] text-neutral-700",children:""})]}),A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("p",{className:"text-[10px] leading-[12px] text-neutral-600",children:"16"}),A.jsx("p",{className:"text-[6px] leading-[7px] text-neutral-700",children:""})]}),A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("p",{className:"text-[10px] leading-[12px] text-neutral-600",children:"4"}),A.jsx("p",{className:"text-[6px] leading-[7px] text-neutral-700",children:""})]})]})]}),A.jsx(qi,{to:"/layout/",children:A.jsx("img",{src:Cc,alt:"arrow",className:"w-[5px] h-[8px]"})})]})]}),A.jsxs("div",{className:"flex flex-col gap-9 w-full",children:[A.jsx(C2,{title:"",list:v}),A.jsx(C2,{title:"",list:R}),A.jsx(C2,{title:"",list:w}),A.jsx("button",{onClick:x,className:"flex items-center w-full py-4 pl-[2px] border-b border-t border-neutral-300",children:A.jsx("p",{className:"text-[11px] leading-[13px] text-neutral-600",children:""})})]})]}),A.jsx(zY,{open:p,handleOpen:x})]})}const z2="/assets/avatar-sACfASGQ.svg",qY="data:image/svg+xml,%3csvg%20width='70'%20height='70'%20viewBox='0%200%2070%2070'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M34.98%2069.96C54.2989%2069.96%2069.96%2054.2989%2069.96%2034.98C69.96%2015.6611%2054.2989%200%2034.98%200C15.6611%200%200%2015.6611%200%2034.98C0%2054.2989%2015.6611%2069.96%2034.98%2069.96Z'%20fill='%23A3A3A3'/%3e%3cpath%20d='M34.9756%2032.3097C40.1956%2032.3097%2044.4355%2028.0796%2044.4355%2022.8496C44.4355%2017.6196%2040.2056%2013.3896%2034.9756%2013.3896C29.7456%2013.3896%2025.5156%2017.6196%2025.5156%2022.8496C25.5156%2028.0796%2029.7456%2032.3097%2034.9756%2032.3097Z'%20fill='%23EDEDED'/%3e%3cpath%20d='M41.5088%2037.1494H28.4487C25.0187%2037.1494%2022.2188%2038.8294%2022.2188%2043.3794C22.2188%2047.9294%2024.1388%2054.1293%2025.3888%2058.3293C26.6488%2062.5293%2028.1888%2064.5594%2031.6188%2064.5594H38.3387C41.7687%2064.5594%2043.3787%2062.7093%2044.5687%2058.3293C45.7587%2053.9393%2047.7388%2047.4194%2047.7388%2043.3794C47.7388%2039.3394%2044.9388%2037.1494%2041.5088%2037.1494Z'%20fill='%23EDEDED'/%3e%3c/svg%3e";function MV({isUserProfile:p,className:_}){const g=Da(),w=p?{avatar:z2,name:"Mamis Closet",star:4.2,quantity:31,follower:89,follow:6}:{avatar:qY,name:"Future Vintage",star:0,quantity:0,follower:0,follow:0},x=()=>{g("/layout/")},W=()=>{g("/layout/")};return A.jsxs("div",{className:`grid grid-cols-[70fr_276fr] items-center gap-[14px] ${_}`,children:[A.jsx("img",{src:w?.avatar,alt:"avatar",className:"w-full aspect-square rounded-full"}),A.jsxs("div",{className:"flex flex-col gap-2",children:[A.jsx("p",{className:"text-[15px] leading-[18px]",children:w?.name}),A.jsxs("div",{className:"flex w-full",children:[A.jsxs("div",{className:"flex items-center gap-1 mr-7",children:[A.jsx("img",{src:xV,alt:"star",className:"w-4 h-[15px]"}),A.jsx("p",{className:"w-[18px] text-[12px] leading-[15px] text-right",children:w?.star})]}),A.jsxs("div",{className:"flex items-center gap-2",children:[A.jsx("img",{src:kV,alt:"blonze",className:"w-[14px] h-4"}),A.jsx("p",{className:"text-[12px] leading-[15px]",children:"Blonze"})]}),p?A.jsx(Nr,{className:"max-w-[105px] ml-auto",kind:"secondary-small",onClick:x,children:"Follow"}):A.jsx(Nr,{className:"max-w-[125px] ml-auto",kind:"secondary-small",onClick:W,children:""})]}),A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("p",{className:"text-[10px] leading-[12px]",children:w?.quantity}),A.jsx("p",{className:"text-[6px] leading-[7px] text-neutral-700",children:""})]}),A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("p",{className:"text-[10px] leading-[12px]",children:w?.follower}),A.jsx("p",{className:"text-[6px] leading-[7px] text-neutral-700",children:""})]}),A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("p",{className:"text-[10px] leading-[12px]",children:w?.follow}),A.jsx("p",{className:"text-[6px] leading-[7px] text-neutral-700",children:""})]})]})]})]})}function XY(){const p=Da(),[_,g]=ie.useState("sell"),[v,R]=ie.useState(8),w=[{img:Ro,money:"22,000",link:"/"},{img:wl,money:"16,000",link:"/"},{img:tp,money:"800",link:"/"},{img:ou,money:"1,400",link:"/"},{img:Ro,money:"22,000",link:"/"},{img:wl,money:"16,000",link:"/"},{img:tp,money:"800",link:"/"},{img:ou,money:"1,400",link:"/"}],x=(P,V)=>{g(P),R(V)},W=()=>{p("/layout/")};return A.jsxs("div",{className:"user-profile-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:""}),A.jsxs("div",{className:"container flex flex-col w-full grow",children:[A.jsx(MV,{isUserProfile:!0,className:"mb-[25px]"}),A.jsxs("div",{className:"flex items-end gap-[42px] px-3 mb-9",children:[A.jsxs("div",{className:"flex flex-col gap-[5px] grow h-10 text-[9px] leading-[11px]",children:[A.jsx("p",{children:""}),A.jsx("p",{children:""}),A.jsx("p",{children:""})]}),A.jsx(qi,{to:"/layout/",className:"text-[7px] leading-[8px]",children:""})]}),A.jsxs("div",{className:"flex items-center mb-2 border-b border-neutral-1100",children:[A.jsxs("button",{onClick:()=>x("sell",8),className:`relative pb-[5px] pl-3 pr-6 text-[9px] leading-[11px] ${_==="sell"?"":"text-neutral-1000"}`,children:["8",_==="sell"&&A.jsx("span",{className:"absolute top-full left-0 w-full h-[1px] bg-neutral-600"})]}),A.jsxs("button",{onClick:()=>x("close",4),className:`relative pb-[5px] pl-3 pr-6 text-[9px] leading-[11px] ${_==="close"?"":"text-neutral-1000"}`,children:["4",_==="close"&&A.jsx("span",{className:"absolute top-full left-0 w-full h-[1px] bg-neutral-600"})]})]}),A.jsx("p",{className:"text-[8px] leading-[10px] mb-3 ml-3",children:v>1?v+"items":v+"item"}),A.jsx("div",{className:"grid grid-cols-4 gap-x-1 gap-y-7 mb-6",children:w?.slice(0,v)?.map((P,V)=>A.jsx(ZR,{data:P},V))}),A.jsx("div",{className:"px-2 mt-auto",children:A.jsx(Nr,{kind:"secondary",onClick:W,children:""})})]})]})}const JY="data:image/svg+xml,%3csvg%20width='47'%20height='46'%20viewBox='0%200%2047%2046'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M41.58%208.33997L27.25%200.97998C25.98%200.32998%2024.59%200%2023.2%200C21.81%200%2020.4199%200.32998%2019.1499%200.97998L4.81995%208.33997C1.85995%209.85997%200%2012.9%200%2016.23V29.48C0%2032.8%201.85995%2035.85%204.81995%2037.37L19.1499%2044.73C20.4199%2045.38%2021.81%2045.71%2023.2%2045.71C24.59%2045.71%2025.98%2045.38%2027.25%2044.73L41.58%2037.37C44.54%2035.85%2046.3999%2032.81%2046.3999%2029.48V16.23C46.3999%2012.91%2044.54%209.85997%2041.58%208.33997ZM6.02991%2010.71L20.36%203.34998C21.25%202.88998%2022.22%202.66003%2023.2%202.66003C24.18%202.66003%2025.1499%202.88998%2026.0399%203.34998L31.61%206.20996L11.85%2016.36L4.02991%2012.35C4.56991%2011.68%205.23991%2011.12%206.02991%2010.71ZM22.3099%2042.98C21.6399%2042.88%2020.98%2042.68%2020.36%2042.37L6.02991%2035.01C3.95991%2033.95%202.65991%2031.81%202.65991%2029.49V16.24C2.65991%2015.42%202.82988%2014.62%203.12988%2013.89L22.3099%2023.74V42.99V42.98ZM13.2899%2017.11L33.0499%206.95996L40.35%2010.71C41.14%2011.12%2041.82%2011.68%2042.35%2012.35L23.1799%2022.1899L13.2799%2017.1L13.2899%2017.11ZM43.73%2029.48C43.73%2031.81%2042.43%2033.94%2040.36%2035L26.0299%2042.36C25.4099%2042.68%2024.75%2042.88%2024.08%2042.97V23.72L43.2599%2013.87C43.5599%2014.61%2043.73%2015.4%2043.73%2016.22V29.47V29.48Z'%20fill='%23A5A5A5'/%3e%3cpath%20d='M8.15869%2022.6498L14.3688%2025.5798C15.1688%2025.9598%2015.8087%2025.6198%2015.8087%2024.8198C15.8087%2024.0198%2015.1688%2023.0698%2014.3688%2022.6998L8.15869%2019.7698C7.35869%2019.3898%206.71875%2019.7298%206.71875%2020.5298C6.71875%2021.3298%207.35869%2022.2798%208.15869%2022.6498Z'%20fill='%23A5A5A5'/%3e%3c/svg%3e";function ZY(){return A.jsxs("div",{className:"other-profile-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:""}),A.jsxs("div",{className:"container",children:[A.jsx(MV,{className:"mb-7"}),A.jsxs("div",{className:"flex flex-col items-center",children:[A.jsx("div",{className:"w-full pb-[14px] px-3 border-b border-neutral-300",children:A.jsx("p",{className:"text-[9px] leading-[11px]",children:""})}),A.jsxs("div",{className:"flex flex-col items-center gap-[7px] w-full py-[85px]",children:[A.jsx("img",{src:JY,alt:"empty",className:"w-[46px] aspect-square"}),A.jsx("p",{className:"text-[8px] leading-[10px]",children:"no items"})]}),A.jsx("p",{className:"text-[9px] leading-[11px]",children:""})]})]})]})}function UV(p,_,g,v){return p.params.createElements&&Object.keys(v).forEach(R=>{if(!g[R]&&g.auto===!0){let w=yc(p.el,`.${v[R]}`)[0];w||(w=WR("div",v[R]),w.className=v[R],p.el.append(w)),g[R]=w,_[R]=w}}),g}const M4='<svg class="swiper-navigation-icon" width="11" height="20" viewBox="0 0 11 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0.38296 20.0762C0.111788 19.805 0.111788 19.3654 0.38296 19.0942L9.19758 10.2796L0.38296 1.46497C0.111788 1.19379 0.111788 0.754138 0.38296 0.482966C0.654131 0.211794 1.09379 0.211794 1.36496 0.482966L10.4341 9.55214C10.8359 9.9539 10.8359 10.6053 10.4341 11.007L1.36496 20.0762C1.09379 20.3474 0.654131 20.3474 0.38296 20.0762Z" fill="currentColor"/></svg>';function QY({swiper:p,extendParams:_,on:g,emit:v}){_({navigation:{nextEl:null,prevEl:null,addIcons:!0,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),p.navigation={nextEl:null,prevEl:null,arrowSvg:M4};function R(Z){let ae;return Z&&typeof Z=="string"&&p.isElement&&(ae=p.el.querySelector(Z)||p.hostEl.querySelector(Z),ae)?ae:(Z&&(typeof Z=="string"&&(ae=[...document.querySelectorAll(Z)]),p.params.uniqueNavElements&&typeof Z=="string"&&ae&&ae.length>1&&p.el.querySelectorAll(Z).length===1?ae=p.el.querySelector(Z):ae&&ae.length===1&&(ae=ae[0])),Z&&!ae?Z:ae)}function w(Z,ae){const ne=p.params.navigation;Z=gr(Z),Z.forEach(se=>{se&&(se.classList[ae?"add":"remove"](...ne.disabledClass.split(" ")),se.tagName==="BUTTON"&&(se.disabled=ae),p.params.watchOverflow&&p.enabled&&se.classList[p.isLocked?"add":"remove"](ne.lockClass))})}function x(){const{nextEl:Z,prevEl:ae}=p.navigation;if(p.params.loop){w(ae,!1),w(Z,!1);return}w(ae,p.isBeginning&&!p.params.rewind),w(Z,p.isEnd&&!p.params.rewind)}function W(Z){Z.preventDefault(),!(p.isBeginning&&!p.params.loop&&!p.params.rewind)&&(p.slidePrev(),v("navigationPrev"))}function P(Z){Z.preventDefault(),!(p.isEnd&&!p.params.loop&&!p.params.rewind)&&(p.slideNext(),v("navigationNext"))}function V(){const Z=p.params.navigation;if(p.params.navigation=UV(p,p.originalParams.navigation,p.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!(Z.nextEl||Z.prevEl))return;let ae=R(Z.nextEl),ne=R(Z.prevEl);Object.assign(p.navigation,{nextEl:ae,prevEl:ne}),ae=gr(ae),ne=gr(ne);const se=(Q,oe)=>{if(Q){if(Z.addIcons&&Q.matches(".swiper-button-next,.swiper-button-prev")&&!Q.querySelector("svg")){const fe=document.createElement("div");D0(fe,M4),Q.appendChild(fe.querySelector("svg")),fe.remove()}Q.addEventListener("click",oe==="next"?P:W)}!p.enabled&&Q&&Q.classList.add(...Z.lockClass.split(" "))};ae.forEach(Q=>se(Q,"next")),ne.forEach(Q=>se(Q,"prev"))}function q(){let{nextEl:Z,prevEl:ae}=p.navigation;Z=gr(Z),ae=gr(ae);const ne=(se,Q)=>{se.removeEventListener("click",Q==="next"?P:W),se.classList.remove(...p.params.navigation.disabledClass.split(" "))};Z.forEach(se=>ne(se,"next")),ae.forEach(se=>ne(se,"prev"))}g("init",()=>{p.params.navigation.enabled===!1?ce():(V(),x())}),g("toEdge fromEdge lock unlock",()=>{x()}),g("destroy",()=>{q()}),g("enable disable",()=>{let{nextEl:Z,prevEl:ae}=p.navigation;if(Z=gr(Z),ae=gr(ae),p.enabled){x();return}[...Z,...ae].filter(ne=>!!ne).forEach(ne=>ne.classList.add(p.params.navigation.lockClass))}),g("click",(Z,ae)=>{let{nextEl:ne,prevEl:se}=p.navigation;ne=gr(ne),se=gr(se);const Q=ae.target;let oe=se.includes(Q)||ne.includes(Q);if(p.isElement&&!oe){const fe=ae.path||ae.composedPath&&ae.composedPath();fe&&(oe=fe.find(Ue=>ne.includes(Ue)||se.includes(Ue)))}if(p.params.navigation.hideOnClick&&!oe){if(p.pagination&&p.params.pagination&&p.params.pagination.clickable&&(p.pagination.el===Q||p.pagination.el.contains(Q)))return;let fe;ne.length?fe=ne[0].classList.contains(p.params.navigation.hiddenClass):se.length&&(fe=se[0].classList.contains(p.params.navigation.hiddenClass)),v(fe===!0?"navigationShow":"navigationHide"),[...ne,...se].filter(Ue=>!!Ue).forEach(Ue=>Ue.classList.toggle(p.params.navigation.hiddenClass))}});const z=()=>{p.el.classList.remove(...p.params.navigation.navigationDisabledClass.split(" ")),V(),x()},ce=()=>{p.el.classList.add(...p.params.navigation.navigationDisabledClass.split(" ")),q()};Object.assign(p.navigation,{enable:z,disable:ce,update:x,init:V,destroy:q})}function w0(p=""){return`.${p.trim().replace(/([\.:!+\/()[\]])/g,"\\$1").replace(/ /g,".")}`}function $Y({swiper:p,extendParams:_,on:g,emit:v}){const R="swiper-pagination";_({pagination:{el:null,bulletElement:"span",clickable:!1,hideOnClick:!1,renderBullet:null,renderProgressbar:null,renderFraction:null,renderCustom:null,progressbarOpposite:!1,type:"bullets",dynamicBullets:!1,dynamicMainBullets:1,formatFractionCurrent:Q=>Q,formatFractionTotal:Q=>Q,bulletClass:`${R}-bullet`,bulletActiveClass:`${R}-bullet-active`,modifierClass:`${R}-`,currentClass:`${R}-current`,totalClass:`${R}-total`,hiddenClass:`${R}-hidden`,progressbarFillClass:`${R}-progressbar-fill`,progressbarOppositeClass:`${R}-progressbar-opposite`,clickableClass:`${R}-clickable`,lockClass:`${R}-lock`,horizontalClass:`${R}-horizontal`,verticalClass:`${R}-vertical`,paginationDisabledClass:`${R}-disabled`}}),p.pagination={el:null,bullets:[]};let w,x=0;function W(){return!p.params.pagination.el||!p.pagination.el||Array.isArray(p.pagination.el)&&p.pagination.el.length===0}function P(Q,oe){const{bulletActiveClass:fe}=p.params.pagination;Q&&(Q=Q[`${oe==="prev"?"previous":"next"}ElementSibling`],Q&&(Q.classList.add(`${fe}-${oe}`),Q=Q[`${oe==="prev"?"previous":"next"}ElementSibling`],Q&&Q.classList.add(`${fe}-${oe}-${oe}`)))}function V(Q,oe,fe){if(Q=Q%fe,oe=oe%fe,oe===Q+1)return"next";if(oe===Q-1)return"previous"}function q(Q){const oe=Q.target.closest(w0(p.params.pagination.bulletClass));if(!oe)return;Q.preventDefault();const fe=zR(oe)*p.params.slidesPerGroup;if(p.params.loop){if(p.realIndex===fe)return;const Ue=V(p.realIndex,fe,p.slides.length);Ue==="next"?p.slideNext():Ue==="previous"?p.slidePrev():p.slideToLoop(fe)}else p.slideTo(fe)}function z(){const Q=p.rtl,oe=p.params.pagination;if(W())return;let fe=p.pagination.el;fe=gr(fe);let Ue,Ne;const ft=p.virtual&&p.params.virtual.enabled?p.virtual.slides.length:p.slides.length,$e=p.params.loop?Math.ceil(ft/p.params.slidesPerGroup):p.snapGrid.length;if(p.params.loop?(Ne=p.previousRealIndex||0,Ue=p.params.slidesPerGroup>1?Math.floor(p.realIndex/p.params.slidesPerGroup):p.realIndex):typeof p.snapIndex<"u"?(Ue=p.snapIndex,Ne=p.previousSnapIndex):(Ne=p.previousIndex||0,Ue=p.activeIndex||0),oe.type==="bullets"&&p.pagination.bullets&&p.pagination.bullets.length>0){const De=p.pagination.bullets;let Et,qe,Qe;if(oe.dynamicBullets&&(w=w2(De[0],p.isHorizontal()?"width":"height"),fe.forEach(Ye=>{Ye.style[p.isHorizontal()?"width":"height"]=`${w*(oe.dynamicMainBullets+4)}px`}),oe.dynamicMainBullets>1&&Ne!==void 0&&(x+=Ue-(Ne||0),x>oe.dynamicMainBullets-1?x=oe.dynamicMainBullets-1:x<0&&(x=0)),Et=Math.max(Ue-x,0),qe=Et+(Math.min(De.length,oe.dynamicMainBullets)-1),Qe=(qe+Et)/2),De.forEach(Ye=>{const Vt=[...["","-next","-next-next","-prev","-prev-prev","-main"].map(Ct=>`${oe.bulletActiveClass}${Ct}`)].map(Ct=>typeof Ct=="string"&&Ct.includes(" ")?Ct.split(" "):Ct).flat();Ye.classList.remove(...Vt)}),fe.length>1)De.forEach(Ye=>{const Vt=zR(Ye);Vt===Ue?Ye.classList.add(...oe.bulletActiveClass.split(" ")):p.isElement&&Ye.setAttribute("part","bullet"),oe.dynamicBullets&&(Vt>=Et&&Vt<=qe&&Ye.classList.add(...`${oe.bulletActiveClass}-main`.split(" ")),Vt===Et&&P(Ye,"prev"),Vt===qe&&P(Ye,"next"))});else{const Ye=De[Ue];if(Ye&&Ye.classList.add(...oe.bulletActiveClass.split(" ")),p.isElement&&De.forEach((Vt,Ct)=>{Vt.setAttribute("part",Ct===Ue?"bullet-active":"bullet")}),oe.dynamicBullets){const Vt=De[Et],Ct=De[qe];for(let ui=Et;ui<=qe;ui+=1)De[ui]&&De[ui].classList.add(...`${oe.bulletActiveClass}-main`.split(" "));P(Vt,"prev"),P(Ct,"next")}}if(oe.dynamicBullets){const Ye=Math.min(De.length,oe.dynamicMainBullets+4),Vt=(w*Ye-w)/2-Qe*w,Ct=Q?"right":"left";De.forEach(ui=>{ui.style[p.isHorizontal()?Ct:"top"]=`${Vt}px`})}}fe.forEach((De,Et)=>{if(oe.type==="fraction"&&(De.querySelectorAll(w0(oe.currentClass)).forEach(qe=>{qe.textContent=oe.formatFractionCurrent(Ue+1)}),De.querySelectorAll(w0(oe.totalClass)).forEach(qe=>{qe.textContent=oe.formatFractionTotal($e)})),oe.type==="progressbar"){let qe;oe.progressbarOpposite?qe=p.isHorizontal()?"vertical":"horizontal":qe=p.isHorizontal()?"horizontal":"vertical";const Qe=(Ue+1)/$e;let Ye=1,Vt=1;qe==="horizontal"?Ye=Qe:Vt=Qe,De.querySelectorAll(w0(oe.progressbarFillClass)).forEach(Ct=>{Ct.style.transform=`translate3d(0,0,0) scaleX(${Ye}) scaleY(${Vt})`,Ct.style.transitionDuration=`${p.params.speed}ms`})}oe.type==="custom"&&oe.renderCustom?(D0(De,oe.renderCustom(p,Ue+1,$e)),Et===0&&v("paginationRender",De)):(Et===0&&v("paginationRender",De),v("paginationUpdate",De)),p.params.watchOverflow&&p.enabled&&De.classList[p.isLocked?"add":"remove"](oe.lockClass)})}function ce(){const Q=p.params.pagination;if(W())return;const oe=p.virtual&&p.params.virtual.enabled?p.virtual.slides.length:p.grid&&p.params.grid.rows>1?p.slides.length/Math.ceil(p.params.grid.rows):p.slides.length;let fe=p.pagination.el;fe=gr(fe);let Ue="";if(Q.type==="bullets"){let Ne=p.params.loop?Math.ceil(oe/p.params.slidesPerGroup):p.snapGrid.length;p.params.freeMode&&p.params.freeMode.enabled&&Ne>oe&&(Ne=oe);for(let ft=0;ft<Ne;ft+=1)Q.renderBullet?Ue+=Q.renderBullet.call(p,ft,Q.bulletClass):Ue+=`<${Q.bulletElement} ${p.isElement?'part="bullet"':""} class="${Q.bulletClass}"></${Q.bulletElement}>`}Q.type==="fraction"&&(Q.renderFraction?Ue=Q.renderFraction.call(p,Q.currentClass,Q.totalClass):Ue=`<span class="${Q.currentClass}"></span> / <span class="${Q.totalClass}"></span>`),Q.type==="progressbar"&&(Q.renderProgressbar?Ue=Q.renderProgressbar.call(p,Q.progressbarFillClass):Ue=`<span class="${Q.progressbarFillClass}"></span>`),p.pagination.bullets=[],fe.forEach(Ne=>{Q.type!=="custom"&&D0(Ne,Ue||""),Q.type==="bullets"&&p.pagination.bullets.push(...Ne.querySelectorAll(w0(Q.bulletClass)))}),Q.type!=="custom"&&v("paginationRender",fe[0])}function Z(){p.params.pagination=UV(p,p.originalParams.pagination,p.params.pagination,{el:"swiper-pagination"});const Q=p.params.pagination;if(!Q.el)return;let oe;typeof Q.el=="string"&&p.isElement&&(oe=p.el.querySelector(Q.el)),!oe&&typeof Q.el=="string"&&(oe=[...document.querySelectorAll(Q.el)]),oe||(oe=Q.el),!(!oe||oe.length===0)&&(p.params.uniqueNavElements&&typeof Q.el=="string"&&Array.isArray(oe)&&oe.length>1&&(oe=[...p.el.querySelectorAll(Q.el)],oe.length>1&&(oe=oe.find(fe=>sV(fe,".swiper")[0]===p.el))),Array.isArray(oe)&&oe.length===1&&(oe=oe[0]),Object.assign(p.pagination,{el:oe}),oe=gr(oe),oe.forEach(fe=>{Q.type==="bullets"&&Q.clickable&&fe.classList.add(...(Q.clickableClass||"").split(" ")),fe.classList.add(Q.modifierClass+Q.type),fe.classList.add(p.isHorizontal()?Q.horizontalClass:Q.verticalClass),Q.type==="bullets"&&Q.dynamicBullets&&(fe.classList.add(`${Q.modifierClass}${Q.type}-dynamic`),x=0,Q.dynamicMainBullets<1&&(Q.dynamicMainBullets=1)),Q.type==="progressbar"&&Q.progressbarOpposite&&fe.classList.add(Q.progressbarOppositeClass),Q.clickable&&fe.addEventListener("click",q),p.enabled||fe.classList.add(Q.lockClass)}))}function ae(){const Q=p.params.pagination;if(W())return;let oe=p.pagination.el;oe&&(oe=gr(oe),oe.forEach(fe=>{fe.classList.remove(Q.hiddenClass),fe.classList.remove(Q.modifierClass+Q.type),fe.classList.remove(p.isHorizontal()?Q.horizontalClass:Q.verticalClass),Q.clickable&&(fe.classList.remove(...(Q.clickableClass||"").split(" ")),fe.removeEventListener("click",q))})),p.pagination.bullets&&p.pagination.bullets.forEach(fe=>fe.classList.remove(...Q.bulletActiveClass.split(" ")))}g("changeDirection",()=>{if(!p.pagination||!p.pagination.el)return;const Q=p.params.pagination;let{el:oe}=p.pagination;oe=gr(oe),oe.forEach(fe=>{fe.classList.remove(Q.horizontalClass,Q.verticalClass),fe.classList.add(p.isHorizontal()?Q.horizontalClass:Q.verticalClass)})}),g("init",()=>{p.params.pagination.enabled===!1?se():(Z(),ce(),z())}),g("activeIndexChange",()=>{typeof p.snapIndex>"u"&&z()}),g("snapIndexChange",()=>{z()}),g("snapGridLengthChange",()=>{ce(),z()}),g("destroy",()=>{ae()}),g("enable disable",()=>{let{el:Q}=p.pagination;Q&&(Q=gr(Q),Q.forEach(oe=>oe.classList[p.enabled?"remove":"add"](p.params.pagination.lockClass)))}),g("lock unlock",()=>{z()}),g("click",(Q,oe)=>{const fe=oe.target,Ue=gr(p.pagination.el);if(p.params.pagination.el&&p.params.pagination.hideOnClick&&Ue&&Ue.length>0&&!fe.classList.contains(p.params.pagination.bulletClass)){if(p.navigation&&(p.navigation.nextEl&&fe===p.navigation.nextEl||p.navigation.prevEl&&fe===p.navigation.prevEl))return;const Ne=Ue[0].classList.contains(p.params.pagination.hiddenClass);v(Ne===!0?"paginationShow":"paginationHide"),Ue.forEach(ft=>ft.classList.toggle(p.params.pagination.hiddenClass))}});const ne=()=>{p.el.classList.remove(p.params.pagination.paginationDisabledClass);let{el:Q}=p.pagination;Q&&(Q=gr(Q),Q.forEach(oe=>oe.classList.remove(p.params.pagination.paginationDisabledClass))),Z(),ce(),z()},se=()=>{p.el.classList.add(p.params.pagination.paginationDisabledClass);let{el:Q}=p.pagination;Q&&(Q=gr(Q),Q.forEach(oe=>oe.classList.add(p.params.pagination.paginationDisabledClass))),ae()};Object.assign(p.pagination,{enable:ne,disable:se,render:ce,update:z,init:Z,destroy:ae})}const eq="data:image/svg+xml,%3csvg%20width='9'%20height='8'%20viewBox='0%200%209%208'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M6.53998%200C6.53998%200%206.50999%200%206.48999%200C5.48999%200.02%204.84998%200.510046%204.47998%201.11005C4.11998%200.510046%203.47%200.02%202.47%200C2.45%200%202.43998%200%202.41998%200C1.74998%200%201.13998%200.27001%200.699982%200.76001C0.239982%201.27001%200%201.99003%200%202.84003C0%204.50003%201.32997%205.52%202.62997%206.5C3.12997%206.88%203.64%207.27001%204.09%207.70001L4.10999%207.73004C4.19999%207.84004%204.32999%207.90003%204.45999%207.91003H4.47H4.47998C4.61998%207.91003%204.74999%207.84004%204.82999%207.73004L4.84998%207.70001C5.29998%207.27001%205.81%206.88%206.31%206.5C7.6%205.52%208.93997%204.50003%208.93997%202.84003C8.93997%201.18003%207.94999%200%206.51999%200H6.53998ZM6.5%205.73004C5.85%206.24004%205.12998%206.74003%204.50998%207.34003C4.49998%207.35003%204.48998%207.35999%204.47998%207.37C4.47998%207.37%204.45998%207.35003%204.44998%207.34003C3.61998%206.54003%202.61998%205.91003%201.84998%205.22003C1.45998%204.88003%201.12998%204.52001%200.889984%204.14001C0.659984%203.75001%200.519989%203.33003%200.519989%202.84003C0.519989%202.07003%200.739996%201.49004%201.09%201.10004C1.44%200.710037%201.89999%200.51001%202.42999%200.51001H2.47C3.06%200.52001%203.48%200.730029%203.78%201.03003C4.08%201.33003%204.24998%201.72004%204.31998%202.10004C4.32998%202.18004%204.39999%202.24005%204.48999%202.24005C4.57999%202.24005%204.63997%202.18004%204.65997%202.10004C4.71997%201.73004%204.89998%201.33003%205.19998%201.03003C5.49998%200.730029%205.91998%200.52001%206.50998%200.51001H6.54999C7.07999%200.51001%207.54998%200.710037%207.88998%201.10004C8.22998%201.49004%208.45999%202.07003%208.45999%202.84003C8.45999%203.33003%208.32%203.75001%208.09%204.14001C7.74%204.72001%207.15998%205.23004%206.50998%205.73004H6.5Z'%20fill='%23A5A5A5'/%3e%3c/svg%3e",tq="data:image/svg+xml,%3csvg%20width='19'%20height='19'%20viewBox='0%200%2019%2019'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20opacity='0.15'%20d='M9.16003%2018.32C14.219%2018.32%2018.3201%2014.2189%2018.3201%209.16C18.3201%204.10108%2014.219%200%209.16003%200C4.10111%200%200%204.10108%200%209.16C0%2014.2189%204.10111%2018.32%209.16003%2018.32Z'%20fill='black'/%3e%3cpath%20d='M11.6274%205.08984L6.6875%209.15985L11.6274%2013.2299'%20stroke='white'%20stroke-miterlimit='10'/%3e%3c/svg%3e",iq="data:image/svg+xml,%3csvg%20width='19'%20height='19'%20viewBox='0%200%2019%2019'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20opacity='0.15'%20d='M9.16003%2018.32C14.219%2018.32%2018.3199%2014.2189%2018.3199%209.16C18.3199%204.10108%2014.219%200%209.16003%200C4.10111%200%200%204.10108%200%209.16C0%2014.2189%204.10111%2018.32%209.16003%2018.32Z'%20fill='black'/%3e%3cpath%20d='M6.6875%2013.2299L11.6276%209.15985L6.6875%205.08984'%20stroke='white'%20stroke-miterlimit='10'/%3e%3c/svg%3e";function nq({open:p,handleOpen:_,data:g}){const v=ie.useRef(null);return ie.useEffect(()=>{p&&v.current.scrollTo(0,0)},[p]),A.jsxs("div",{className:`detail-product fixed top-[55px] left-0 z-[2] w-full h-[calc(100dvh-55px)] flex flex-col bg-dark-100 transition-transform duration-300 ${p?"translate-x-0":"-translate-x-full"}`,children:[A.jsxs("div",{ref:v,className:"no-scrollbar flex flex-col items-center grow overflow-auto",children:[A.jsx(ln,{title:""}),A.jsxs("div",{className:"container flex flex-col",children:[A.jsxs("div",{className:"grid grid-cols-[74fr_270fr] gap-3 w-full mb-8",children:[A.jsx("img",{src:g?.img,alt:"product",className:"w-full aspect-square rounded-[4px]"}),A.jsx("p",{className:"mt-[14px] text-[15px] leading-[18px] text-neutral-600",children:g?.name})]}),A.jsxs("div",{className:"flex flex-col gap-[30px] mb-10",children:[A.jsx("div",{className:"px-3 pb-1 border-b border-neutral-300",children:A.jsx("p",{className:"text-[9px] leading-[11px] text-neutral-700",children:""})}),A.jsxs("div",{className:"px-3 text-[9px] leading-[11px] text-neutral-600",children:[A.jsxs("div",{className:"flex flex-col gap-1 mb-5",children:[A.jsx("p",{children:""}),A.jsx("p",{children:"CHRISTOPHER NEMETH"}),A.jsx("p",{children:""})]}),A.jsxs("div",{className:"flex flex-col gap-1 mb-5",children:[A.jsx("p",{children:""}),A.jsx("p",{children:""}),A.jsx("p",{children:"20102"}),A.jsx("p",{children:""})]}),A.jsxs("div",{className:"flex flex-col gap-1 mb-5",children:[A.jsx("p",{children:"1959"}),A.jsx("p",{children:""}),A.jsx("p",{children:""}),A.jsx("p",{children:""}),A.jsx("p",{children:""}),A.jsx("p",{children:""}),A.jsx("p",{children:""})]}),A.jsxs("div",{className:"flex flex-col gap-1 mb-8",children:[A.jsx("p",{children:"1980"}),A.jsx("p",{children:""}),A.jsx("p",{children:"2015"}),A.jsx("p",{children:""}),A.jsx("p",{children:""})]}),A.jsxs("div",{className:"flex flex-col gap-1",children:[A.jsx("p",{children:""}),A.jsx("p",{children:""}),A.jsx("p",{children:""}),A.jsx("p",{children:""})]})]})]}),A.jsxs("div",{className:"flex flex-col gap-[14px] mb-8",children:[A.jsx("div",{className:"px-3 pb-1 border-b border-neutral-300",children:A.jsx("p",{className:"text-[9px] leading-[11px] text-neutral-700",children:""})}),A.jsxs("div",{className:"flex flex-col gap-3 px-3 text-[10px] leading-[12px] text-neutral-700",children:[A.jsxs("div",{className:"grid grid-cols-[50fr_207fr] gap-[75px]",children:[A.jsx("p",{children:""}),A.jsx("p",{children:"/>/"})]}),A.jsxs("div",{className:"grid grid-cols-[50fr_207fr] gap-[75px]",children:[A.jsx("p",{children:""}),A.jsx("p",{children:""})]})]})]}),A.jsx("button",{onClick:_,className:"ml-auto text-[7px] leading-[8px] text-neutral-600",children:""})]})]}),A.jsx(iV,{isSubFooter:!0})]})}function VV({isRoom:p,data:_,className:g}){const[v,R]=ie.useState(!1),w=()=>{R(!v)};return A.jsxs("div",{className:`flex flex-col ${g}`,children:[A.jsx("div",{className:"w-full px-[58px] mb-6",children:A.jsxs("div",{className:`relative
						[&_.swiper-pagination]:static [&_.swiper-pagination]:flex [&_.swiper-pagination]:justify-center [&_.swiper-pagination]:gap-4 [&_.swiper-pagination]:h-1 [&_.swiper-pagination]:mt-[17px]
						[&_.swiper-pagination-bullet]:block [&_.swiper-pagination-bullet]:w-1 [&_.swiper-pagination-bullet]:h-1 [&_.swiper-pagination-bullet]:!m-0 [&_.swiper-pagination-bullet]:bg-dark-400 [&_.swiper-pagination-bullet]:opacity-100
						[&_.swiper-pagination-bullet-active]:!bg-neutral-700
					`,children:[A.jsx(XR,{modules:[QY,$Y],spaceBetween:0,slidesPerView:1,pagination:{clickable:!0},navigation:{nextEl:".my-custom-next-button",prevEl:".my-custom-prev-button"},children:_?.list?.map((x,W)=>A.jsx(JR,{children:A.jsx("img",{src:x,alt:"item",className:"w-full aspect-[254/338]"})},W))}),A.jsx("button",{className:"my-custom-prev-button absolute top-1/2 right-full -translate-y-1/2 translate-x-[-17px] w-[18px] h-[18px]",children:A.jsx("img",{src:tq,alt:"prev",className:"w-full h-full"})}),A.jsx("button",{className:"my-custom-next-button absolute top-1/2 left-full -translate-y-1/2 translate-x-[17px] w-[18px] h-[18px]",children:A.jsx("img",{src:iq,alt:"next",className:"w-full h-full"})})]})}),A.jsxs("div",{className:"flex flex-col gap-2 w-full px-7",children:[A.jsx("p",{className:"text-[16px] leading-[19px] text-neutral-600",children:_?.name}),p?A.jsxs("div",{className:"flex items-center gap-8",children:[A.jsx("p",{className:"text-[8px] leading-[10px] text-neutral-600",children:""}),A.jsxs("p",{className:"text-[14px] leading-[17px] text-red-100",children:[_?.entry,""]})]}):A.jsxs("div",{className:"flex items-center",children:[A.jsx("p",{className:"mr-2 text-[8px] leading-[10px] text-neutral-600",children:""}),A.jsxs("p",{className:"mr-2 text-[14px] leading-[17px] text-red-100",children:["",_?.bid]}),A.jsx("p",{className:"text-[7px] leading-[8px] text-neutral-600",children:""}),A.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[A.jsx("img",{src:eq,alt:"heart",className:"w-[9px] h-2"}),A.jsx("p",{className:"text-[7px] leading-[8px] text-neutral-600",children:_?.like})]})]})]}),p?A.jsxs("div",{className:"w-full mt-12",children:[A.jsx("div",{className:"pb-1 pl-2 mb-8 border-b border-neutral-300",children:A.jsx("p",{className:"text-[9px] leading-[11px] text-neutral-700",children:""})}),A.jsxs("div",{className:"w-full px-3 text-[9px] leading-[11px] text-neutral text-neutral-700",children:[A.jsxs("div",{className:"flex flex-col gap-1 mb-5",children:[A.jsx("p",{children:"CHRISTOPHER NEMETH"}),A.jsx("p",{children:"3"})]}),A.jsxs("div",{className:"flex flex-col gap-1 mb-5",children:[A.jsx("p",{children:""}),A.jsx("p",{children:""}),A.jsx("p",{children:"2010"}),A.jsx("p",{children:"2"})]}),A.jsxs("div",{className:"flex flex-col gap-1 mb-5",children:[A.jsx("p",{children:""}),A.jsx("p",{children:""})]}),A.jsxs("div",{className:"flex flex-col gap-1 mb-5",children:[A.jsx("p",{children:""}),A.jsx("p",{children:"400"}),A.jsx("p",{children:"16,000"}),A.jsx("p",{children:"22,000"}),A.jsxs("div",{className:"flex items-center gap-5 mb-6",children:[A.jsx("p",{children:"Psychedelic Knit Vest"}),A.jsx("p",{children:"30,000"})]})]}),A.jsx("p",{className:"mb-[42px]",children:""}),A.jsxs("div",{className:"flex items-center gap-[77px] mb-[18px]",children:[A.jsx("p",{children:""}),A.jsx("p",{children:"202632619:00"})]}),A.jsxs("div",{className:"flex items-center gap-[77px]",children:[A.jsx("p",{children:""}),A.jsx("p",{children:"202632619:40"})]})]})]}):A.jsxs(A.Fragment,{children:[A.jsxs("div",{className:"flex flex-col gap-5 w-full px-[18px] mt-9 mb-10 text-[9px] leading-[11px] text-neutral-600",children:[A.jsxs("div",{className:"flex flex-col gap-1",children:[A.jsx("p",{children:"24aw"}),A.jsx("p",{children:"70000"})]}),A.jsx("p",{children:""}),A.jsxs("div",{className:"flex flex-col gap-1",children:[A.jsx("p",{children:"M"}),A.jsx("p",{children:"63cm"}),A.jsx("p",{children:"66cm"}),A.jsx("p",{children:"74cm"}),A.jsx("p",{children:"59cm"}),A.jsxs("div",{className:"flex justify-between items-center",children:[A.jsx("p",{children:"..."}),A.jsx("button",{onClick:w,className:"text-[7px] leading-[8px]",children:""})]})]})]}),A.jsxs("div",{className:"w-full",children:[A.jsx("div",{className:"pb-1 px-3 mb-2 border-b border-neutral-300",children:A.jsx("p",{className:"text-[9px] leading-[11px] text-neutral-700",children:""})}),A.jsxs("div",{className:"w-full px-[13px] text-[11px] leading-[13px] text-neutral text-neutral-700",children:[A.jsxs("div",{className:"grid grid-cols-[88fr_187fr] items-center gap-[55px] mb-[23px]",children:[A.jsx("p",{children:""}),A.jsxs("div",{className:"flex flex-col gap-[6px]",children:[A.jsx("p",{children:""}),A.jsx("p",{children:""}),A.jsx("p",{children:""}),A.jsx("p",{children:""}),A.jsx("p",{children:""})]})]}),A.jsxs("div",{className:"grid grid-cols-[88fr_187fr] items-center gap-[55px] mb-4",children:[A.jsx("p",{children:""}),A.jsxs("div",{className:"flex flex-col gap-1",children:[A.jsx("p",{children:""}),A.jsx("p",{className:"text-[8px] leading-[10px]",children:""})]})]}),A.jsxs("div",{className:"grid grid-cols-[88fr_187fr] items-center gap-[55px] mb-[18px]",children:[A.jsx("p",{children:""}),A.jsx("p",{children:""})]}),A.jsxs("div",{className:"grid grid-cols-[88fr_187fr] items-center gap-[55px] mb-4",children:[A.jsx("p",{children:""}),A.jsx("p",{children:""})]}),A.jsxs("div",{className:"grid grid-cols-[88fr_187fr] items-center gap-[55px]",children:[A.jsx("p",{children:""}),A.jsx("p",{children:"202632619:00"})]})]})]})]}),A.jsx(nq,{open:v,handleOpen:w,data:_})]})}function jV({data:p,className:_}){return A.jsxs("div",{className:`seller flex flex-col gap-2 ${_}`,children:[A.jsx("div",{className:"pb-1 px-3 border-b border-neutral-300",children:A.jsx("p",{className:"text-[9px] leading-[11px] text-neutral-700",children:""})}),A.jsxs(qi,{to:"/layout/",className:"flex items-center",children:[A.jsx("img",{src:p?.avatar,alt:"avatar",className:"w-full max-w-[43px] mr-4 aspect-square rounded-full"}),A.jsx("p",{className:"text-[16px] leading-[19px] text-neutral-600",children:p?.name}),A.jsx("img",{src:Cc,alt:"arrow",className:"ml-auto w-[5px] h-2"})]})]})}function rq({data:p}){return A.jsxs("div",{className:"auction-room flex flex-col gap-2 mb-6",children:[A.jsx("div",{className:"pb-[5px] px-3 border-b border-neutral-300",children:A.jsx("p",{className:"text-[9px] leading-[11px] text-neutral-700",children:""})}),A.jsxs("div",{className:"flex items-center gap-6 px-2",children:[A.jsx("img",{src:p?.img,alt:"avatar",className:"w-full max-w-[50px] aspect-[50/48] rounded-[4px]"}),A.jsxs("div",{className:"flex flex-col gap-[10px] text-[9px] leading-[11px] text-neutral-600",children:[A.jsx("p",{children:p?.name}),A.jsx("p",{children:p?.time})]})]})]})}function aq({list:p}){return A.jsxs("div",{className:"flex flex-col gap-2 mb-10",children:[A.jsxs("div",{className:"flex justify-between items-center pb-1 px-3 border-b border-neutral-300",children:[A.jsx("p",{className:"text-[9px] leading-[11px] text-neutral-700",children:""}),A.jsx(qi,{to:"/layout/",className:"text-[7px] leading-[8px] text-neutral-600",children:" "})]}),A.jsx("div",{className:"grid grid-cols-4 gap-1 w-full",children:p?.map((_,g)=>A.jsx(ZR,{data:_},g))})]})}function sq({list:p}){return A.jsxs("div",{className:"flex flex-col gap-2 mb-[60px]",children:[A.jsx("div",{className:"flex justify-between items-center pb-1 px-3 border-b border-neutral-300",children:A.jsx("p",{className:"text-[9px] leading-[11px] text-neutral-700",children:""})}),A.jsx("div",{className:"grid grid-cols-4 gap-1 w-full",children:p?.map((_,g)=>A.jsx(qi,{to:_?.link,children:A.jsx(ZR,{data:_})},g))})]})}const yo="/assets/30-LxbL5T1A.png";function oq(){const p={name:"W&LT / Psychedelic Knit Vest",bid:"30,000",like:32,list:[yo,yo,yo,yo,yo],entry:4,img:yo},_={avatar:z2,name:"Mamis Closet"},g={img:Ro,name:"Mamis Monthly vol.01",time:"261900"},v=[{img:Ro,money:"22,000",link:"/"},{img:wl,money:"16,000",link:"/"},{img:tp,money:"800",link:"/"},{img:ou,money:"1,400",link:"/"}],R=[{img:Ro,money:"22,000",link:"/"},{img:wl,money:"16,000",link:"/"},{img:tp,money:"800",link:"/"},{img:ou,money:"1,400",link:"/"},{img:Ro,money:"22,000",link:"/"},{img:wl,money:"16,000",link:"/"},{img:tp,money:"800",link:"/"},{img:ou,money:"1,400",link:"/"},{img:Ro,money:"22,000",link:"/"},{img:wl,money:"16,000",link:"/"}];return A.jsxs("div",{className:"item-detail-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:""}),A.jsxs("div",{className:"container flex flex-col",children:[A.jsx(VV,{data:p,className:"mb-[49px]"}),A.jsx(jV,{data:_,className:"mb-9"}),A.jsx(rq,{data:g}),A.jsx(aq,{list:v}),A.jsx(sq,{list:R}),A.jsx(Nr,{children:"202632619:00"})]})]})}function cq({list:p,className:_}){return A.jsxs("div",{className:`time-table flex flex-col gap-2 ${_}`,children:[A.jsx("div",{className:"pb-1 px-3 border-b border-neutral-300",children:A.jsx("p",{className:"text-[9px] leading-[11px] text-neutral-700",children:""})}),A.jsx("div",{className:"flex flex-col gap-4 pl-2 pr-9",children:p?.map((g,v)=>A.jsxs("div",{className:"grid grid-cols-[72fr_224fr] items-center gap-4",children:[A.jsx("img",{src:g?.img,alt:"product",className:"aspect-square rounded-[4px]"}),A.jsxs("div",{className:"flex flex-col gap-[14px]",children:[A.jsx("p",{className:"text-[13px] leading-[16px] text-neutral-600",children:g?.name}),A.jsxs("div",{className:"flex items-end",children:[A.jsx("p",{className:"mr-[18px] text-[8px] leading-[10px] text-neutral-600",children:""}),A.jsxs("p",{className:"text-[10px] leading-[12px] text-red-100",children:["",g?.bid]}),A.jsx("p",{className:"ml-auto text-[14px] leading-[17px] text-neutral-600",children:g?.time})]})]})]},v))})]})}function lq(){const p={name:"W&LT / Psychedelic Knit Vest",bid:"30,000",like:32,list:[yo,yo,yo,yo],entry:4},_={avatar:z2,name:"Mamis Closet"},g=[{img:ou,name:"Noir kei ninomiya ",bid:"1,400",time:"19:00"},{img:wl,name:" ",bid:"16,000",time:"19:10"},{img:Ro,name:"DRIES VAN NOTEN ",bid:"22,000",time:"19:20"},{img:yo,name:"W&LT / Psychedelic Knit Vest",bid:"30,000",time:"19:30"}];return A.jsxs("div",{className:"item-detail-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:""}),A.jsxs("div",{className:"container flex flex-col",children:[A.jsx(VV,{data:p,isRoom:!0,className:"mb-[54px]"}),A.jsx(jV,{data:_,className:"mb-[33px]"}),A.jsx(cq,{className:"mb-[65px]",list:g}),A.jsx(Nr,{children:"202632619:00"})]})]})}const dq="data:image/svg+xml,%3csvg%20width='10'%20height='10'%20viewBox='0%200%2010%2010'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8.60999%200L2.67999%206.51999L0.950012%205.22H0L2.67999%209.56998L9.57001%200H8.60999Z'%20fill='%23C0D0D8'/%3e%3c/svg%3e";function uq({data:p,isFirst:_}){return A.jsxs(qi,{to:p?.link,className:`follow-list-item flex justify-between items-center gap-1 w-full h-20 px-2 border-b border-dark-500 ${_&&"border-t"}`,children:[A.jsxs("div",{className:"flex items-center gap-8",children:[A.jsx("img",{src:p?.img,alt:"follow",className:"w-14 h-14 rounded-full"}),A.jsx("p",{className:"text-[13px] leading-[16px] text-neutral-600",children:p?.name})]}),A.jsxs("div",{className:"flex items-center gap-[10px] h-7 pl-2 px-3 border border-neutral-1300 rounded-[8px]",children:[A.jsx("img",{src:dq,alt:"checked",className:"w-[10px] h-[10px]"}),A.jsx("p",{className:"text-[11px] leading-[13px] text-neutral-600",children:""})]})]})}const hq="/assets/31-DrcPLUaP.png",pq="/assets/32-C5fQ_LGT.png",fq="/assets/33-CXuXIKea.png";function mq(){const p=[{img:hq,name:"",link:"/layout"},{img:pq,name:"meangirls",link:"/layout"},{img:fq,name:"ponta",link:"/layout"}];return A.jsxs("div",{className:"follow-list-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:""}),A.jsx("div",{className:"container",children:p?.map((_,g)=>A.jsx(uq,{isFirst:g===0,data:_},g))})]})}function _q({data:p,isFirst:_}){return A.jsxs(qi,{to:p?.link,className:`view-history-item flex items-center gap-4 p-2 border-b border-neutral-300 ${_&&"border-t"}`,children:[A.jsx("img",{src:p?.img,alt:"product",className:"w-[84px] aspect-square"}),A.jsxs("div",{className:"flex justify-between items-center gap-1 grow",children:[A.jsxs("div",{className:"flex flex-col gap-4",children:[A.jsx("p",{className:"text-[13px] leading-[16px]",children:p?.name}),A.jsxs("div",{className:"flex items-center gap-1 text-[10px] leading-[12px]",children:[A.jsx("p",{children:""}),A.jsxs("p",{className:"text-red-100",children:["",p?.money]})]})]}),A.jsx("img",{src:Cc,alt:"arrow",className:"w-[5px] h-2"})]})]})}function Eq(){const p=[{img:QR,name:"balenciaga ",money:"1,200",link:"/layout"},{img:H2,name:"Noir kei ninomiya ",money:"9,500",link:"/layout"},{img:yV,name:"DRIES VAN NOTEN ",money:"6,000",link:"/layout"},{img:RV,name:"W&LT / Psychedelic Knit Vest",money:"12,000",link:"/layout"},{img:W2,name:" ",money:"9,200",link:"/layout"},{img:CV,name:"Archive Denim Half Coat",money:"38,000",link:"/layout"}];return A.jsxs("div",{className:"view-history-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:""}),A.jsx("div",{className:"container",children:p?.map((_,g)=>A.jsx(_q,{isFirst:g===0,data:_},g))})]})}const gq="data:image/svg+xml,%3csvg%20width='8'%20height='8'%20viewBox='0%200%208%208'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M4%200C1.8%200%200%201.8%200%204C0%206.2%201.8%208%204%208C6.2%208%208%206.2%208%204C8%201.8%206.2%200%204%200ZM4%200.799988C5.77%200.799988%207.19995%202.23%207.19995%204C7.19995%205.77%205.77%207.19998%204%207.19998C2.23%207.19998%200.799927%205.77%200.799927%204C0.799927%202.23%202.23%200.799988%204%200.799988ZM3.59998%201.59998V4.16998L5.31995%205.88998L5.89001%205.31998L4.41003%203.84V1.60999H3.60999L3.59998%201.59998Z'%20fill='%23D8D8D8'/%3e%3c/svg%3e";function Sq({data:p,isFirst:_}){return A.jsxs(qi,{to:p?.link,className:`won-item-list-item flex items-center gap-4 py-2 px-2 border-b border-neutral-300 ${_&&"border-t"}`,children:[A.jsx("img",{src:p?.img,alt:"product",className:"w-[84px] aspect-square"}),A.jsxs("div",{className:"flex justify-between items-center gap-1 grow",children:[A.jsxs("div",{children:[A.jsx("p",{className:"text-[13px] leading-[16px] mb-[6px]",children:p?.name}),A.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[A.jsx("img",{src:gq,alt:"clock",className:"w-2 h-2"}),A.jsx("p",{className:"text-[9px] leading-[11px]",children:p?.time})]}),A.jsx("p",{className:"text-[9px] leading-[11px] text-neutral-700",children:""})]}),A.jsx("img",{src:Cc,alt:"arrow",className:"w-[5px] h-2"})]})]})}function vq(){const p=[{img:QR,name:"balenciaga ",time:"2026/01/18 20:30",link:"/layout"}];return A.jsxs("div",{className:"won-item-list-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:""}),A.jsx("div",{className:"container",children:p?.map((_,g)=>A.jsx(Sq,{isFirst:g===0,data:_},g))})]})}function Tq(){const p=[{label:"",link:rt?.USER_PROFILE_SETTING},{label:"",link:rt?.SHIPPING_ADDRESS_LIST},{label:"",link:rt?.EMAIL_PASSWORD_SETTING}];return A.jsxs("div",{className:"personal-information-setting-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:""}),A.jsxs("div",{className:"container text-[11px] leading-[13px]",children:[A.jsx("div",{className:"flex items-center w-full pb-2 border-b border-neutral-300",children:A.jsx("p",{className:"text-neutral-700",children:""})}),p?.map((_,g)=>A.jsx(qi,{to:_?.link,className:"flex items-center w-full h-[45px] px-[2px] border-b border-neutral-300",children:A.jsx("p",{children:_?.label})},g))]})]})}function BV({className:p,label:_,placeholder:g,maxLength:v,onTextChange:R,...w}){const[x,W]=ie.useState(0),P=V=>{const q=V?.target?.value;v&&W(q?.length),R(q)};return A.jsxs("div",{className:`flex flex-col gap-1 ${p}`,children:[A.jsx("div",{className:"ml-1 text-[11px] leading-[13px] text-neutral-500",children:_}),A.jsx("textarea",{...w,placeholder:g,maxLength:v,onChange:P,className:"w-full h-[117px] py-3 px-2 mb-[6px] text-[7px] leading-[8px] text-black bg-neutral-300 rounded-[2px] outline-none resize-none"}),v&&A.jsx("div",{className:"flex justify-end w-full px-1",children:A.jsxs("p",{className:"text-[7px] leading-[8px] text-neutral-700",children:[x,"/",v]})})]})}const yq="data:image/svg+xml,%3csvg%20width='70'%20height='70'%20viewBox='0%200%2070%2070'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M34.98%2069.96C54.2989%2069.96%2069.96%2054.2989%2069.96%2034.98C69.96%2015.6611%2054.2989%200%2034.98%200C15.6611%200%200%2015.6611%200%2034.98C0%2054.2989%2015.6611%2069.96%2034.98%2069.96Z'%20fill='%23A3A3A3'/%3e%3cpath%20d='M34.9756%2032.3204C40.1956%2032.3204%2044.4357%2028.0904%2044.4357%2022.8604C44.4357%2017.6304%2040.2056%2013.4004%2034.9756%2013.4004C29.7456%2013.4004%2025.5156%2017.6304%2025.5156%2022.8604C25.5156%2028.0904%2029.7456%2032.3204%2034.9756%2032.3204Z'%20fill='%23EDEDED'/%3e%3cpath%20d='M41.5087%2037.1602H28.4487C25.0187%2037.1602%2022.2188%2038.8402%2022.2188%2043.3902C22.2188%2047.9402%2024.1387%2054.1402%2025.3887%2058.3402C26.6487%2062.5402%2028.1888%2064.5702%2031.6188%2064.5702H38.3387C41.7687%2064.5702%2043.3787%2062.7202%2044.5687%2058.3402C45.7587%2053.9502%2047.7388%2047.4302%2047.7388%2043.3902C47.7388%2039.3502%2044.9387%2037.1602%2041.5087%2037.1602Z'%20fill='%23EDEDED'/%3e%3c/svg%3e";function Rq(){const p=Da(),[_,g]=ie.useState(null),[v,R]=ie.useState(""),w=()=>{p(rt?.TOP_NO_LOGIN)},x=P=>{const V=P.target.files[0];if(V){if(!V.type.startsWith("image/"))return;const q=new FileReader;q.onload=z=>{const ce=z.target.result;g(ce)},q.readAsDataURL(V)}},W=P=>{R(P)};return A.jsxs("div",{className:"user-profile-setting-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:""}),A.jsxs("div",{className:"container",children:[A.jsxs("div",{className:"flex flex-col gap-1 mb-5",children:[A.jsx("p",{className:"text-[11px] leading-[13px]",children:""}),A.jsxs("label",{className:"w-max cursor-pointer",children:[A.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:x}),A.jsx("img",{src:_??yq,alt:"avatar",className:"w-[70px] aspect-square rounded-full"})]})]}),A.jsx(Qn,{label:"",placeholder:"Future Vintage",maxLength:20,className:"mb-6 [&_.input-max-length]:text-neutral-700"}),A.jsx(BV,{label:"",maxLength:1e3,className:"mb-9",value:v,onTextChange:W}),A.jsx(Nr,{onClick:w,children:""})]})]})}const Cq="data:image/svg+xml,%3csvg%20width='13'%20height='13'%20viewBox='0%200%2013%2013'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M6.70001%2010.5298H5.38995V6.62979H1.5V5.3298H5.38995V1.5498H6.70001V5.3298H10.59V6.62979H6.70001V10.5298Z'%20fill='%23ED1C24'/%3e%3cpath%20d='M6.03998%2011.58C9.09964%2011.58%2011.58%209.09967%2011.58%206.04001C11.58%202.98035%209.09964%200.5%206.03998%200.5C2.98032%200.5%200.5%202.98035%200.5%206.04001C0.5%209.09967%202.98032%2011.58%206.03998%2011.58Z'%20stroke='%23ED1C24'%20stroke-miterlimit='10'/%3e%3c/svg%3e";function L2({label:p,className:_,...g}){return A.jsxs("button",{...g,className:`flex items-center gap-4 ml-[10px] ${_}`,children:[A.jsx("img",{src:Cq,alt:"plus",className:"w-3 h-3"}),A.jsx("p",{className:"text-[13px] leading-[16px] text-red-200",children:p})]})}const bq="data:image/svg+xml,%3csvg%20width='13'%20height='13'%20viewBox='0%200%2013%2013'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M6.03998%2011.58C9.09964%2011.58%2011.58%209.09967%2011.58%206.04001C11.58%202.98035%209.09964%200.5%206.03998%200.5C2.98032%200.5%200.5%202.98035%200.5%206.04001C0.5%209.09967%202.98032%2011.58%206.03998%2011.58Z'%20stroke='%23DCDCDC'%20stroke-miterlimit='10'/%3e%3c/svg%3e",Aq="data:image/svg+xml,%3csvg%20width='13'%20height='13'%20viewBox='0%200%2013%2013'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M6.03998%2011.58C9.09964%2011.58%2011.58%209.09967%2011.58%206.04001C11.58%202.98035%209.09964%200.5%206.03998%200.5C2.98032%200.5%200.5%202.98035%200.5%206.04001C0.5%209.09967%202.98032%2011.58%206.03998%2011.58Z'%20stroke='%23DCDCDC'%20stroke-miterlimit='10'/%3e%3cpath%20d='M6.03809%209.25009C7.81092%209.25009%209.24805%207.81293%209.24805%206.0401C9.24805%204.26727%207.81092%202.83008%206.03809%202.83008C4.26525%202.83008%202.82812%204.26727%202.82812%206.0401C2.82812%207.81293%204.26525%209.25009%206.03809%209.25009Z'%20fill='%23DCDCDC'/%3e%3c/svg%3e";function wq(){const p=Da(),_={name:"",code:"150-0034",address:"1-1 Grava4F",id:1},[g,v]=ie.useState([_]),[R,w]=ie.useState(_?.id),x=()=>{p(rt?.TOP_NO_LOGIN)},W=()=>{v([...g,{..._,id:g?.length+1}])},P=V=>{w(V)};return A.jsxs("div",{className:"shipping-address-list-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:""}),A.jsxs("div",{className:"container",children:[A.jsxs("button",{className:"flex items-center gap-3 w-max ml-auto mb-6",children:[A.jsx("p",{className:"text-[10px] leading-[12px]",children:""}),A.jsx("img",{src:NV,alt:"edit",className:"w-[10px] h-[10px]"})]}),A.jsx("div",{className:"flex flex-col gap-4 px-[10px] mb-10",children:g?.map((V,q)=>A.jsxs("button",{className:"flex items-center gap-4",onClick:()=>P(V?.id),children:[A.jsx("img",{src:V?.id===R?Aq:bq,alt:"checkbox",className:"w-3 h-3"}),A.jsxs("div",{className:"flex flex-col items-start text-[13px] leading-[16px] text-neutral-500",children:[A.jsx("p",{className:"mb-1",children:V?.name}),A.jsx("p",{className:"mb-[6px]",children:V?.code}),A.jsx("p",{children:V?.address})]})]},q))}),A.jsx(L2,{onClick:W,className:"mb-4",label:""}),A.jsx(Nr,{onClick:x,children:""})]})]})}function Iq(){const p=Da(),_=()=>{p(rt?.TOP_NO_LOGIN)};return A.jsxs("div",{className:"email-password-setting-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:""}),A.jsxs("div",{className:"container",children:[A.jsx(Qn,{label:"",placeholder:"future.vintage@gmail.com",className:"mb-4"}),A.jsxs("div",{className:"flex flex-col gap-2 px-1 mb-7 text-[7px] leading-[8px] text-neutral-700",children:[A.jsx("p",{children:""}),A.jsx("p",{children:"URL"})]}),A.jsx(Qn,{label:"",placeholder:"future.vintage@gmail.com",className:"mb-7",type:"password",showPasswordIcon:!0}),A.jsx(Qn,{label:"",placeholder:"future.vintage@gmail.com",className:"mb-7",type:"password",showPasswordIcon:!0}),A.jsx(Qn,{label:"",placeholder:"future.vintage@gmail.com",className:"mb-4",type:"password",showPasswordIcon:!0}),A.jsx("p",{className:"mb-[88px] ml-1 text-[9px] leading-[11px] text-neutral-700",children:""}),A.jsx(Nr,{onClick:_,children:""})]})]})}const Oq="data:image/svg+xml,%3csvg%20width='9'%20height='7'%20viewBox='0%200%209%207'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0.382812%200.318359L4.45279%205.25836L8.51282%200.318359'%20stroke='black'%20stroke-miterlimit='10'/%3e%3c/svg%3e";function FV({className:p,label:_,placeholder:g,...v}){return A.jsxs("div",{className:`dropdown-container flex flex-col gap-1 ${p}`,children:[_&&A.jsx("label",{className:"ml-1 text-[11px] leading-[13px] text-neutral-500",children:_}),A.jsxs("div",{className:"flex justify-between items-center gap-1 w-full h-[29px] px-[13px] bg-neutral-300 border border-black rounded-[2px]",children:[A.jsx("p",{className:"text-[7px] leading-[8px] text-black",children:g}),A.jsx("img",{src:Oq,alt:"arrow",className:"w-[5px] h-2"})]})]})}function Nq(){const p=Da(),_=()=>{p(rt?.TOP_NO_LOGIN)};return A.jsxs("div",{className:"user-profile-setting-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:""}),A.jsxs("div",{className:"container",children:[A.jsxs("div",{className:"flex flex-col gap-5 pb-7 mb-9 border-b border-neutral-300",children:[A.jsx(Qn,{label:"",placeholder:"",maxLength:15,className:"[&_.input-max-length]:text-neutral-700"}),A.jsx(Qn,{label:"",placeholder:"",maxLength:15,className:"[&_.input-max-length]:text-neutral-700"}),A.jsx(Qn,{label:"",placeholder:"",maxLength:15,className:"[&_.input-max-length]:text-neutral-700"}),A.jsx(Qn,{label:"",placeholder:"",maxLength:15,className:"[&_.input-max-length]:text-neutral-700"})]}),A.jsxs("div",{className:"flex flex-col gap-9 mb-[70px]",children:[A.jsx(Qn,{label:"",placeholder:" 1234567"}),A.jsx(FV,{label:"",placeholder:""}),A.jsx(Qn,{label:"",placeholder:""}),A.jsx(Qn,{label:"",placeholder:"1-1-1"}),A.jsx(Qn,{label:"",placeholder:"101"}),A.jsx(Qn,{label:"",placeholder:"09012345678"})]}),A.jsx(Nr,{onClick:_,children:""})]})]})}const GV="data:image/svg+xml,%3csvg%20width='15'%20height='12'%20viewBox='0%200%2015%2012'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M7.27783%204.78027C6.29783%204.78027%205.50781%205.58028%205.50781%206.57028C5.50781%207.56028%206.29783%208.36026%207.27783%208.36026C8.25783%208.36026%209.04785%207.56028%209.04785%206.57028C9.04785%205.58028%208.25783%204.78027%207.27783%204.78027Z'%20fill='%23D8D8D8'/%3e%3cpath%20d='M13.63%202.23999H11.96C11.59%202.23999%2011.25%202.01999%2011.1%201.67999L10.6%200.559998C10.45%200.219998%2010.11%200%209.73999%200H4.83997C4.46997%200%204.12998%200.219998%203.97998%200.559998L3.47998%201.67999C3.32998%202.01999%202.99%202.23999%202.62%202.23999H0.949951C0.429951%202.23999%200%202.67001%200%203.20001V10.39C0%2010.92%200.419951%2011.35%200.949951%2011.35H13.65C14.17%2011.35%2014.6%2010.92%2014.6%2010.39V3.20001C14.6%202.67001%2014.18%202.23999%2013.65%202.23999H13.63ZM7.27997%209.88C5.45997%209.88%203.98999%208.40001%203.98999%206.57001C3.98999%204.74001%205.45997%203.25%207.27997%203.25C9.09997%203.25%2010.57%204.73001%2010.57%206.57001C10.57%208.41001%209.09997%209.88%207.27997%209.88Z'%20fill='%23D8D8D8'/%3e%3c/svg%3e";function Dq(){const p=Da(),_=()=>{p(rt?.TOP_NO_LOGIN)},g=()=>{p(rt?.POST_ITEM)};return A.jsxs("div",{className:"post-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:""}),A.jsxs("div",{className:"container flex flex-col gap-7",children:[A.jsxs(Nr,{onClick:_,className:"flex items-center gap-2 h-[46px]",children:[A.jsx("img",{src:GV,alt:"camera",className:"w-[15px] h-[11px]"}),A.jsx("p",{children:""})]}),A.jsx(Nr,{onClick:g,children:""})]})]})}const Lq="data:image/svg+xml,%3csvg%20width='15'%20height='12'%20viewBox='0%200%2015%2012'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M7.27783%204.77979C6.29783%204.77979%205.50781%205.57976%205.50781%206.56976C5.50781%207.55976%206.29783%208.35977%207.27783%208.35977C8.25783%208.35977%209.04785%207.55976%209.04785%206.56976C9.04785%205.57976%208.25783%204.77979%207.27783%204.77979Z'%20fill='%23CC5252'/%3e%3cpath%20d='M13.63%202.23999H11.9601C11.5901%202.23999%2011.2501%202.01999%2011.1001%201.67999L10.6001%200.559998C10.4501%200.219998%2010.11%200%209.73999%200H4.84009C4.47009%200%204.1301%200.219998%203.9801%200.559998L3.4801%201.67999C3.3301%202.01999%202.99%202.23999%202.62%202.23999H0.950073C0.430073%202.23999%200%202.66998%200%203.19998V10.39C0%2010.92%200.420073%2011.35%200.950073%2011.35H13.65C14.17%2011.35%2014.6001%2010.92%2014.6001%2010.39V3.19998C14.6001%202.66998%2014.18%202.23999%2013.65%202.23999H13.63ZM7.28003%209.87997C5.46003%209.87997%203.98999%208.39998%203.98999%206.56998C3.98999%204.73998%205.46003%203.25%207.28003%203.25C9.10003%203.25%2010.5701%204.72998%2010.5701%206.56998C10.5701%208.40998%209.10003%209.87997%207.28003%209.87997Z'%20fill='%23CC5252'/%3e%3c/svg%3e";function Pq({hiddenIcon:p,className:_,...g}){return A.jsxs("label",{className:`flex justify-center items-center gap-2 w-full h-[27px] text-[11px] leading-[13px] text-red-200 border border-red-200 rounded-[4px] cursor-pointer ${_}`,children:[!p&&A.jsx("img",{src:Lq,alt:"camera",className:"w-[15px] h-[11px]"}),A.jsx("p",{children:""}),A.jsx("input",{type:"file",multiple:!0,accept:"image/*",hidden:!0,...g})]})}function xq({className:p,value:_,name:g,...v}){return A.jsxs("div",{className:`input-container flex flex-col gap-1 ${p}`,children:[A.jsx("label",{className:"ml-1 text-[11px] leading-[13px] text-neutral-500",children:""}),A.jsxs("div",{className:"flex items-center gap-1 w-full h-[29px] px-[13px] bg-neutral-300 border border-black rounded-[2px]",children:[A.jsx("p",{className:"text-[9px] leading-[11px] text-black",children:""}),A.jsx("input",{...v,type:"number",value:_,name:g,className:"grow text-[7px] leading-[8px] text-black text-right bg-transparent outline-none placeholder:text-black"})]})]})}function kq(){const p=`

20 


`,_=Da(),[g,v]=ie.useState(p),[R,w]=ie.useState(0),x=()=>{_(rt?.TOP_NO_LOGIN)},W=V=>{v(V)},P=V=>{w(V.target.value)};return A.jsxs("div",{className:"post-item-page page-container flex flex-col items-center w-full h-max",children:[A.jsx(ln,{title:""}),A.jsxs("div",{className:"container",children:[A.jsx("p",{className:"mb-2 text-[11px] leading-[13px] text-neutral-500",children:"20"}),A.jsx(Pq,{className:"mb-3",hiddenIcon:!0}),A.jsx("p",{className:"mb-5 text-[9px] leading-[11px] text-neutral-700",children:""}),A.jsx(Qn,{label:"",maxLength:40,className:"mb-3 [&_.input-max-length]:text-neutral-700"}),A.jsx("div",{className:"pb-[14px] mb-5 border-b border-neutral-300",children:A.jsx("p",{className:"text-[11px] leading-[13px] text-neutral-700",children:""})}),A.jsxs("div",{className:"pb-5 mb-5 border-b border-neutral-300",children:[A.jsx("p",{className:"mb-[10px] text-[11px] leading-[13px] text-neutral-500",children:""}),A.jsx(L2,{onClick:x,label:""})]}),A.jsxs("div",{className:"pb-5 mb-5 border-b border-neutral-300",children:[A.jsx("p",{className:"mb-[10px] text-[11px] leading-[13px] text-neutral-500",children:""}),A.jsx(L2,{onClick:x,label:"",className:"mb-6"}),A.jsx(BV,{label:A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("p",{children:""}),A.jsx("div",{className:"flex items-center h-3 px-2 bg-neutral-1400 border border-black rounded-[2px]",children:A.jsx("p",{className:"text-[9px] leading-[11px] text-neutral-700",children:""})})]}),maxLength:1e3,className:"mb-4 [&_textarea]:h-[104px]",value:g,onTextChange:W}),A.jsx("p",{className:"mb-4 text-[11px] leading-[13px] text-neutral-700",children:""}),A.jsx("p",{className:"text-[11px] leading-[13px] text-neutral-500",children:""})]}),A.jsxs("div",{className:"flex flex-col gap-8 pb-7 mb-4 border-b border-neutral-300",children:[A.jsx(FV,{label:"",placeholder:""}),A.jsx(xq,{value:R,onChange:P})]}),A.jsxs("div",{className:"flex flex-col gap-3 pb-4 mb-5 border-b border-neutral-300",children:[A.jsx("p",{className:"text-[11px] leading-[13px] text-neutral-500",children:""}),A.jsxs(qi,{to:"/layout",className:"flex items-center gap-4 px-2",children:[A.jsx("img",{src:W2,alt:"product",className:"w-[72px] aspect-square"}),A.jsxs("div",{className:"flex justify-between items-center gap-1 grow",children:[A.jsxs("div",{className:"flex flex-col gap-3 text-neutral-500",children:[A.jsx("p",{className:"text-[11px] leading-[13px]",children:""}),A.jsxs("div",{className:"flex items-center gap-2 text-[10px] leading-[12px]",children:[A.jsx("p",{children:""}),A.jsx("p",{children:"202641020:00"})]})]}),A.jsx("img",{src:Cc,alt:"arrow",className:"w-[5px] h-2"})]})]})]}),A.jsxs("div",{className:"pb-7 mb-5 border-b border-neutral-300",children:[A.jsx("p",{className:"mb-4 text-[11px] leading-[13px] text-neutral-500",children:""}),A.jsx("p",{className:"mb-3 ml-7 text-[11px] leading-[13px] text-neutral-500",children:"2026410 20 : 00"}),A.jsxs("div",{className:"flex items-center gap-5 ml-11",children:[A.jsx("p",{className:"text-[11px] leading-[13px] text-neutral-500",children:"30"}),A.jsx("p",{className:"text-[9px] leading-[11px] text-neutral-700",children:"36001"})]})]}),A.jsxs("div",{className:"flex flex-col gap-2 mb-10 text-[7px] leading-[8px] text-neutral-700 [&_span]:text-red-200",children:[A.jsxs("p",{children:["",A.jsx("span",{children:""}),"",A.jsx("span",{children:""}),"",A.jsx("span",{children:""})," "]}),A.jsxs("p",{children:[A.jsx("span",{children:""}),""]})]}),A.jsxs(Nr,{onClick:x,className:"flex items-center gap-2",children:[A.jsx("img",{src:GV,alt:"camera",className:"w-[15px] h-[11px]"}),A.jsx("p",{children:""})]})]})]})}function Mq(){return A.jsx(_z,{children:A.jsx(YW,{children:A.jsxs(rn,{element:A.jsx(Vz,{}),children:[A.jsx(rn,{path:rt?.TOP_NO_LOGIN,element:A.jsx(_Y,{})}),A.jsx(rn,{path:rt?.TOP_LOGIN,element:A.jsx(gY,{})}),A.jsx(rn,{path:rt?.LIKE_LIST,element:A.jsx(yY,{})}),A.jsx(rn,{path:rt?.SEARCH_TOP,element:A.jsx(bY,{})}),A.jsx(rn,{path:rt?.USER_REGISTRATION,element:A.jsx(IY,{})}),A.jsx(rn,{path:rt?.LOGIN,element:A.jsx(OY,{})}),A.jsx(rn,{path:rt?.REGISTRATION_EMAIL_SENT,element:A.jsx(NY,{})}),A.jsx(rn,{path:rt?.CATEGORY_LIST,element:A.jsx(DY,{})}),A.jsx(rn,{path:rt?.SEARCH_RESULT,element:A.jsx(WY,{})}),A.jsx(rn,{path:rt?.MY_PAGE,element:A.jsx(YY,{})}),A.jsx(rn,{path:rt?.USER_PROFILE,element:A.jsx(XY,{})}),A.jsx(rn,{path:rt?.OTHER_PROFILE,element:A.jsx(ZY,{})}),A.jsx(rn,{path:rt?.ITEM_DETAIL,element:A.jsx(oq,{})}),A.jsx(rn,{path:rt?.ROOM_DETAIL,element:A.jsx(lq,{})}),A.jsx(rn,{path:rt?.FOLLOW_LIST,element:A.jsx(mq,{})}),A.jsx(rn,{path:rt?.VIEW_HISTORY,element:A.jsx(Eq,{})}),A.jsx(rn,{path:rt?.WON_ITEM_LIST,element:A.jsx(vq,{})}),A.jsx(rn,{path:rt?.PERSONAL_INFORMATION_SETTING,element:A.jsx(Tq,{})}),A.jsx(rn,{path:rt?.USER_PROFILE_SETTING,element:A.jsx(Rq,{})}),A.jsx(rn,{path:rt?.SHIPPING_ADDRESS_LIST,element:A.jsx(wq,{})}),A.jsx(rn,{path:rt?.EMAIL_PASSWORD_SETTING,element:A.jsx(Iq,{})}),A.jsx(rn,{path:rt?.SHIPPING_ADDRESS_REGISTRATION,element:A.jsx(Nq,{})}),A.jsx(rn,{path:rt?.POST,element:A.jsx(Dq,{})}),A.jsx(rn,{path:rt?.POST_ITEM,element:A.jsx(kq,{})})]})})})}/**
 * @license agora-rtc-react
 * @version 2.5.0
 *
 * Copyright (c) Agora, Inc.
 *
 * This source code is licensed under the MIT license.
 */var Uq=Object.create,K2=Object.defineProperty,Vq=Object.getOwnPropertyDescriptor,jq=Object.getOwnPropertyNames,Bq=Object.getPrototypeOf,Fq=Object.prototype.hasOwnProperty,Gq=(p,_)=>()=>(_||p((_={exports:{}}).exports,_),_.exports),Hq=(p,_)=>{for(var g in _)K2(p,g,{get:_[g],enumerable:!0})},HV=(p,_,g,v)=>{if(_&&typeof _=="object"||typeof _=="function")for(let R of jq(_))!Fq.call(p,R)&&R!==g&&K2(p,R,{get:()=>_[R],enumerable:!(v=Vq(_,R))||v.enumerable});return p},Wq=(p,_,g)=>(HV(p,_,"default"),g),rp=(p,_,g)=>(g=p!=null?Uq(Bq(p)):{},HV(!p||!p.__esModule?K2(g,"default",{value:p,enumerable:!0}):g,p)),ap=Gq((p,_)=>{(function(g,v){typeof p=="object"&&typeof _<"u"?_.exports=v():typeof define=="function"&&define.amd?define(v):(g=typeof globalThis<"u"?globalThis:g||self).AgoraRTC=v()})(p,function(){function g(e,t){return t.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(n){if(n!=="default"&&!(n in e)){var r=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return i[n]}})}})}),Object.freeze(e)}var v=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function R(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var w=function(e){try{return!!e()}catch{return!0}},x=!w(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),W=x,P=Function.prototype,V=P.call,q=W&&P.bind.bind(V,V),z=W?q:function(e){return function(){return V.apply(e,arguments)}},ce=z({}.isPrototypeOf),Z=function(e){return e&&e.Math===Math&&e},ae=Z(typeof globalThis=="object"&&globalThis)||Z(typeof window=="object"&&window)||Z(typeof self=="object"&&self)||Z(typeof v=="object"&&v)||Z(typeof v=="object"&&v)||(function(){return this})()||Function("return this")(),ne=x,se=Function.prototype,Q=se.apply,oe=se.call,fe=typeof Reflect=="object"&&Reflect.apply||(ne?oe.bind(Q):function(){return oe.apply(Q,arguments)}),Ue=z,Ne=Ue({}.toString),ft=Ue("".slice),$e=function(e){return ft(Ne(e),8,-1)},De=$e,Et=z,qe=function(e){if(De(e)==="Function")return Et(e)},Qe=typeof document=="object"&&document.all,Ye=Qe===void 0&&Qe!==void 0?function(e){return typeof e=="function"||e===Qe}:function(e){return typeof e=="function"},Vt={},Ct=!w(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),ui=x,Le=Function.prototype.call,ze=ui?Le.bind(Le):function(){return Le.apply(Le,arguments)},We={},Tt={}.propertyIsEnumerable,le=Object.getOwnPropertyDescriptor,Ge=le&&!Tt.call({1:2},1);We.f=Ge?function(e){var t=le(this,e);return!!t&&t.enumerable}:Tt;var tt,it,_t=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Si=w,Bt=$e,Sr=Object,en=z("".split),La=Si(function(){return!Sr("z").propertyIsEnumerable(0)})?function(e){return Bt(e)==="String"?en(e,""):Sr(e)}:Sr,Nl=function(e){return e==null},cp=Nl,qm=TypeError,Vs=function(e){if(cp(e))throw new qm("Can't call method on "+e);return e},Xm=La,iC=Vs,bo=function(e){return Xm(iC(e))},as=Ye,$n=function(e){return typeof e=="object"?e!==null:as(e)},Dr={},lp=Dr,Dl=ae,nC=Ye,Jm=function(e){return nC(e)?e:void 0},er=function(e,t){return arguments.length<2?Jm(lp[e])||Jm(Dl[e]):lp[e]&&lp[e][t]||Dl[e]&&Dl[e][t]},k0=ae.navigator,Ll=k0&&k0.userAgent,mn=Ll?String(Ll):"",js=ae,vr=mn,M0=js.process,U0=js.Deno,V0=M0&&M0.versions||U0&&U0.version,lu=V0&&V0.v8;lu&&(it=(tt=lu.split("."))[0]>0&&tt[0]<4?1:+(tt[0]+tt[1])),!it&&vr&&(!(tt=vr.match(/Edge\/(\d+)/))||tt[1]>=74)&&(tt=vr.match(/Chrome\/(\d+)/))&&(it=+tt[1]);var ss=it,Ao=ss,dp=w,du=ae.String,Pl=!!Object.getOwnPropertySymbols&&!dp(function(){var e=Symbol("symbol detection");return!du(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ao&&Ao<41}),Zm=Pl&&!Symbol.sham&&typeof Symbol.iterator=="symbol",j0=er,Qm=Ye,uu=ce,rC=Object,xl=Zm?function(e){return typeof e=="symbol"}:function(e){var t=j0("Symbol");return Qm(t)&&uu(t.prototype,rC(e))},B0=String,wo=function(e){try{return B0(e)}catch{return"Object"}},$m=Ye,F0=wo,aC=TypeError,_n=function(e){if($m(e))return e;throw new aC(F0(e)+" is not a function")},lr=_n,Lr=Nl,Bs=function(e,t){var i=e[t];return Lr(i)?void 0:lr(i)},up=ze,G0=Ye,H0=$n,W0=TypeError,kl={exports:{}},hp=ae,Ml=Object.defineProperty,Ul=ae,hu=function(e,t){try{Ml(hp,e,{value:t,configurable:!0,writable:!0})}catch{hp[e]=t}return t},Ic="__core-js_shared__",Ln=kl.exports=Ul[Ic]||hu(Ic,{});(Ln.versions||(Ln.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var pp=kl.exports,e_=pp,la=function(e,t){return e_[e]||(e_[e]=t||{})},Vl=Vs,sC=Object,Pa=function(e){return sC(Vl(e))},z0=Pa,oC=z({}.hasOwnProperty),an=Object.hasOwn||function(e,t){return oC(z0(e),t)},fp=z,Fs=0,t_=Math.random(),K0=fp(1 .toString),Io=function(e){return"Symbol("+(e===void 0?"":e)+")_"+K0(++Fs+t_,36)},i_=la,mp=an,cC=Io,Y0=Pl,da=Zm,Oc=ae.Symbol,n_=i_("wks"),_p=da?Oc.for||Oc:Oc&&Oc.withoutSetter||cC,xi=function(e){return mp(n_,e)||(n_[e]=Y0&&mp(Oc,e)?Oc[e]:_p("Symbol."+e)),n_[e]},Ep=ze,q0=$n,qr=xl,r_=Bs,X0=function(e,t){var i,n;if(G0(i=e.toString)&&!H0(n=up(i,e))||G0(i=e.valueOf)&&!H0(n=up(i,e))||t!=="string")return n;throw new W0("Can't convert object to primitive value")},a_=TypeError,jl=xi("toPrimitive"),J0=function(e,t){if(!q0(e)||qr(e))return e;var i,n=r_(e,jl);if(n){if(i=Ep(n,e,t),!q0(i)||qr(i))return i;throw new a_("Can't convert object to primitive value")}return X0(e,t)},Z0=xl,Oo=function(e){var t=J0(e,"string");return Z0(t)?t:t+""},Q0=$n,gp=ae.document,$0=Q0(gp)&&Q0(gp.createElement),pu=function(e){return $0?gp.createElement(e):{}},lC=pu,eS=!Ct&&!w(function(){return Object.defineProperty(lC("div"),"a",{get:function(){return 7}}).a!==7}),Sp=Ct,s_=ze,o_=We,Bl=_t,Fl=bo,tS=Oo,c_=an,iS=eS,Gl=Object.getOwnPropertyDescriptor;Vt.f=Sp?Gl:function(e,t){if(e=Fl(e),t=tS(t),iS)try{return Gl(e,t)}catch{}if(c_(e,t))return Bl(!s_(o_.f,e,t),e[t])};var Gs=w,l_=Ye,fu=/#|\.prototype\./,ua=function(e,t){var i=vp[d_(e)];return i===Tp||i!==nS&&(l_(t)?Gs(t):!!t)},d_=ua.normalize=function(e){return String(e).replace(fu,".").toLowerCase()},vp=ua.data={},nS=ua.NATIVE="N",Tp=ua.POLYFILL="P",mu=ua,rS=_n,Pr=x,Nc=qe(qe.bind),xa=function(e,t){return rS(e),t===void 0?e:Pr?Nc(e,t):function(){return e.apply(t,arguments)}},dr={},aS=Ct&&w(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),u_=$n,h_=String,_u=TypeError,Wn=function(e){if(u_(e))return e;throw new _u(h_(e)+" is not an object")},sS=Ct,dC=eS,uC=aS,yp=Wn,Rp=Oo,hC=TypeError,p_=Object.defineProperty,pC=Object.getOwnPropertyDescriptor,f_="enumerable",m_="configurable",Cp="writable";dr.f=sS?uC?function(e,t,i){if(yp(e),t=Rp(t),yp(i),typeof e=="function"&&t==="prototype"&&"value"in i&&Cp in i&&!i[Cp]){var n=pC(e,t);n&&n[Cp]&&(e[t]=i.value,i={configurable:m_ in i?i[m_]:n[m_],enumerable:f_ in i?i[f_]:n[f_],writable:!1})}return p_(e,t,i)}:p_:function(e,t,i){if(yp(e),t=Rp(t),yp(i),dC)try{return p_(e,t,i)}catch{}if("get"in i||"set"in i)throw new hC("Accessors not supported");return"value"in i&&(e[t]=i.value),e};var fC=dr,mC=_t,Dc=Ct?function(e,t,i){return fC.f(e,t,mC(1,i))}:function(e,t,i){return e[t]=i,e},Eu=ae,__=fe,_C=qe,EC=Ye,gC=Vt.f,oS=mu,Hl=Dr,SC=xa,Wl=Dc,cS=an,vC=function(e){var t=function(i,n,r){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,n)}return new e(i,n,r)}return __(e,this,arguments)};return t.prototype=e.prototype,t},Ft=function(e,t){var i,n,r,s,c,l,d,h,f,E=e.target,S=e.global,y=e.stat,D=e.proto,O=S?Eu:y?Eu[E]:Eu[E]&&Eu[E].prototype,N=S?Hl:Hl[E]||Wl(Hl,E,{})[E],k=N.prototype;for(s in t)n=!(i=oS(S?s:E+(y?".":"#")+s,e.forced))&&O&&cS(O,s),l=N[s],n&&(d=e.dontCallGetSet?(f=gC(O,s))&&f.value:O[s]),c=n&&d?d:t[s],(i||D||typeof l!=typeof c)&&(h=e.bind&&n?SC(c,Eu):e.wrap&&n?vC(c):D&&EC(c)?_C(c):c,(e.sham||c&&c.sham||l&&l.sham)&&Wl(h,"sham",!0),Wl(N,s,h),D&&(cS(Hl,r=E+"Prototype")||Wl(Hl,r,{}),Wl(Hl[r],s,c),e.real&&k&&(i||!k[s])&&Wl(k,s,c)))},TC=Math.ceil,yC=Math.floor,RC=Math.trunc||function(e){var t=+e;return(t>0?yC:TC)(t)},E_=RC,Lc=function(e){var t=+e;return t!=t||t===0?0:E_(t)},CC=Lc,lS=Math.max,dS=Math.min,bp=function(e,t){var i=CC(e);return i<0?lS(i+t,0):dS(i,t)},uS=Lc,hS=Math.min,Pc=function(e){var t=uS(e);return t>0?hS(t,9007199254740991):0},bC=Pc,No=function(e){return bC(e.length)},AC=bo,pS=bp,fS=No,zl=function(e){return function(t,i,n){var r=AC(t),s=fS(r);if(s===0)return!e&&-1;var c,l=pS(n,s);if(e&&i!=i){for(;s>l;)if((c=r[l++])!=c)return!0}else for(;s>l;l++)if((e||l in r)&&r[l]===i)return e||l||0;return!e&&-1}},xc={includes:zl(!0),indexOf:zl(!1)},wC=xc.includes;Ft({target:"Array",proto:!0,forced:w(function(){return!Array(1).includes()})},{includes:function(e){return wC(this,e,arguments.length>1?arguments[1]:void 0)}});var Ap=ae,mS=Dr,Xr=function(e,t){var i=mS[e+"Prototype"],n=i&&i[t];if(n)return n;var r=Ap[e],s=r&&r.prototype;return s&&s[t]},g_=Xr("Array","includes"),S_=$n,_S=$e,ES=xi("match"),v_=function(e){var t;return S_(e)&&((t=e[ES])!==void 0?!!t:_S(e)==="RegExp")},IC=v_,OC=TypeError,gS={};gS[xi("toStringTag")]="z";var T_=String(gS)==="[object z]",NC=T_,Jr=Ye,Do=$e,SS=xi("toStringTag"),vS=Object,TS=Do((function(){return arguments})())==="Arguments",Hs=NC?Do:function(e){var t,i,n;return e===void 0?"Undefined":e===null?"Null":typeof(i=(function(r,s){try{return r[s]}catch{}})(t=vS(e),SS))=="string"?i:TS?Do(t):(n=Do(t))==="Object"&&Jr(t.callee)?"Arguments":n},y_=Hs,DC=String,Pn=function(e){if(y_(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return DC(e)},R_=xi("match"),gu=Ft,C_=function(e){if(IC(e))throw new OC("The method doesn't accept regular expressions");return e},yS=Vs,Lo=Pn,Kl=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[R_]=!1,"/./"[e](t)}catch{}}return!1},b_=z("".indexOf);gu({target:"String",proto:!0,forced:!Kl("includes")},{includes:function(e){return!!~b_(Lo(yS(this)),Lo(C_(e)),arguments.length>1?arguments[1]:void 0)}});var RS=Xr("String","includes"),Po=ce,CS=g_,bS=RS,wp=Array.prototype,A_=String.prototype,LC=function(e){var t=e.includes;return e===wp||Po(wp,e)&&t===wp.includes?CS:typeof e=="string"||e===A_||Po(A_,e)&&t===A_.includes?bS:t},Ce=R(LC),AS=_n,wS=Pa,w_=La,ka=No,I_=TypeError,Zr="Reduce of empty array with no initial value",ha=function(e){return function(t,i,n,r){var s=wS(t),c=w_(s),l=ka(s);if(AS(i),l===0&&n<2)throw new I_(Zr);var d=0,h=1;if(n<2)for(;;){if(d in c){r=c[d],d+=h;break}if(d+=h,l<=d)throw new I_(Zr)}for(;l>d;d+=h)d in c&&(r=i(r,c[d],d,s));return r}},Yl={left:ha()},O_=w,kc=function(e,t){var i=[][e];return!!i&&O_(function(){i.call(null,t||function(){return 1},1)})},xo=ae,N_=mn,ql=$e,Su=function(e){return N_.slice(0,e.length)===e},Xl=Su("Bun/")?"BUN":Su("Cloudflare-Workers")?"CLOUDFLARE":Su("Deno/")?"DENO":Su("Node.js/")?"NODE":xo.Bun&&typeof Bun.version=="string"?"BUN":xo.Deno&&typeof Deno.version=="object"?"DENO":ql(xo.process)==="process"?"NODE":xo.window&&xo.document?"BROWSER":"REST",Ws=Xl==="NODE",PC=Yl.left;Ft({target:"Array",proto:!0,forced:!Ws&&ss>79&&ss<83||!kc("reduce")},{reduce:function(e){var t=arguments.length;return PC(this,e,t,t>1?arguments[1]:void 0)}});var Qr=Xr("Array","reduce"),D_=ce,zs=Qr,Ip=Array.prototype,Op=function(e){var t=e.reduce;return e===Ip||D_(Ip,e)&&t===Ip.reduce?zs:t},ko=Op,xr=R(ko),L_=$e,os=Array.isArray||function(e){return L_(e)==="Array"},Jl=Ft,Np=os,Dp=z([].reverse),$r=[1,2];Jl({target:"Array",proto:!0,forced:String($r)===String($r.reverse())},{reverse:function(){return Np(this)&&(this.length=this.length),Dp(this)}});var pa=Xr("Array","reverse"),Mc=ce,Ks=pa,Ma=Array.prototype,Uc=function(e){var t=e.reverse;return e===Ma||Mc(Ma,e)&&t===Ma.reverse?Ks:t},P_=Uc,Lp=R(P_),x_=Io,ur=la("keys"),Xi=function(e){return ur[e]||(ur[e]=x_(e))},yi=!w(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),Vc=an,cs=Ye,k_=Pa,jc=yi,M_=Xi("IE_PROTO"),Pp=Object,vu=Pp.prototype,Bc=jc?Pp.getPrototypeOf:function(e){var t=k_(e);if(Vc(t,M_))return t[M_];var i=t.constructor;return cs(i)&&t instanceof i?i.prototype:t instanceof Pp?vu:null},IS=z,Tu=_n,U_=$n,Fc=function(e){return U_(e)||e===null},Ys=String,Mo=TypeError,qs=function(e,t,i){try{return IS(Tu(Object.getOwnPropertyDescriptor(e,t)[i]))}catch{}},V_=$n,j_=Vs,yu=function(e){if(Fc(e))return e;throw new Mo("Can't set "+Ys(e)+" as a prototype")},xp=Object.setPrototypeOf||("__proto__"in{}?(function(){var e,t=!1,i={};try{(e=qs(Object.prototype,"__proto__","set"))(i,[]),t=i instanceof Array}catch{}return function(n,r){return j_(n),yu(r),V_(n)&&(t?e(n,r):n.__proto__=r),n}})():void 0),ls={},xn={},Zl=an,OS=bo,xC=xc.indexOf,kC=xn,NS=z([].push),Cn=function(e,t){var i,n=OS(e),r=0,s=[];for(i in n)!Zl(kC,i)&&Zl(n,i)&&NS(s,i);for(;t.length>r;)Zl(n,i=t[r++])&&(~xC(s,i)||NS(s,i));return s},Ru=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Cu=Cn,bu=Ru.concat("length","prototype");ls.f=Object.getOwnPropertyNames||function(e){return Cu(e,bu)};var Gc={};Gc.f=Object.getOwnPropertySymbols;var Ql=er,$l=ls,MC=Gc,DS=Wn,UC=z([].concat),LS=Ql("Reflect","ownKeys")||function(e){var t=$l.f(DS(e)),i=MC.f;return i?UC(t,i(e)):t},Uo=an,B_=LS,kp=Vt,PS=dr,Hc={},xS=Cn,Mp=Ru,ed=Object.keys||function(e){return xS(e,Mp)},kS=Ct,Up=aS,MS=dr,Au=Wn,US=bo,VS=ed;Hc.f=kS&&!Up?Object.defineProperties:function(e,t){Au(e);for(var i,n=US(t),r=VS(t),s=r.length,c=0;s>c;)MS.f(e,i=r[c++],n[i]);return e};var Ua,Vp=er("document","documentElement"),F_=Wn,Vo=Hc,Xs=Ru,wu=xn,G_=Vp,H_=pu,Wc="prototype",zc="script",W_=Xi("IE_PROTO"),jp=function(){},Kc=function(e){return"<"+zc+">"+e+"</"+zc+">"},Iu=function(e){e.write(Kc("")),e.close();var t=e.parentWindow.Object;return e=null,t},Ou=function(){try{Ua=new ActiveXObject("htmlfile")}catch{}var e,t,i;Ou=typeof document<"u"?document.domain&&Ua?Iu(Ua):(t=H_("iframe"),i="java"+zc+":",t.style.display="none",G_.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(Kc("document.F=Object")),e.close(),e.F):Iu(Ua);for(var n=Xs.length;n--;)delete Ou[Wc][Xs[n]];return Ou()};wu[W_]=!0;var Yc=Object.create||function(e,t){var i;return e!==null?(jp[Wc]=F_(e),i=new jp,jp[Wc]=null,i[W_]=e):i=Ou(),t===void 0?i:Vo.f(i,t)},z_=$n,jo=Dc,qt=Error,ki=z("".replace),bn=String(new qt("zxcasd").stack),Nu=/\n\s*at [^:]*:[^\n]*/,td=Nu.test(bn),qc=_t,Bp=!w(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",qc(1,7)),e.stack!==7)}),Du=Dc,id=function(e,t){if(td&&typeof e=="string"&&!qt.prepareStackTrace)for(;t--;)e=ki(e,Nu,"");return e},VC=Bp,dn=Error.captureStackTrace,Bo={},K_=Bo,jS=xi("iterator"),BS=Array.prototype,FS=function(e){return e!==void 0&&(K_.Array===e||BS[jS]===e)},Y_=Hs,Fp=Bs,q_=Nl,kr=Bo,An=xi("iterator"),nd=function(e){if(!q_(e))return Fp(e,An)||Fp(e,"@@iterator")||kr[Y_(e)]},Lu=ze,Gp=_n,X_=Wn,Js=wo,Hp=nd,J_=TypeError,Pu=function(e,t){var i=arguments.length<2?Hp(e):t;if(Gp(i))return X_(Lu(i,e));throw new J_(Js(e)+" is not iterable")},GS=ze,Z_=Wn,HS=Bs,Q_=function(e,t,i){var n,r;Z_(e);try{if(!(n=HS(e,"return"))){if(t==="throw")throw i;return i}n=GS(n,e)}catch(s){r=!0,n=s}if(t==="throw")throw i;if(r)throw n;return Z_(n),i},WS=xa,zS=ze,$_=Wn,KS=wo,jC=FS,YS=No,eE=ce,qS=Pu,tE=nd,iE=Q_,XS=TypeError,xu=function(e,t){this.stopped=e,this.result=t},nE=xu.prototype,rd=function(e,t,i){var n,r,s,c,l,d,h,f=i&&i.that,E=!(!i||!i.AS_ENTRIES),S=!(!i||!i.IS_RECORD),y=!(!i||!i.IS_ITERATOR),D=!(!i||!i.INTERRUPTED),O=WS(t,f),N=function(U){return n&&iE(n,"normal",U),new xu(!0,U)},k=function(U){return E?($_(U),D?O(U[0],U[1],N):O(U[0],U[1])):D?O(U,N):O(U)};if(S)n=e.iterator;else if(y)n=e;else{if(!(r=tE(e)))throw new XS(KS(e)+" is not iterable");if(jC(r)){for(s=0,c=YS(e);c>s;s++)if((l=k(e[s]))&&eE(nE,l))return l;return new xu(!1)}n=qS(e,r)}for(d=S?e.next:n.next;!(h=zS(d,n)).done;){try{l=k(h.value)}catch(U){iE(n,"throw",U)}if(typeof l=="object"&&l&&eE(nE,l))return l}return new xu(!1)},BC=Pn,JS=Ft,ad=ce,Wp=Bc,ku=xp,zp=function(e,t,i){for(var n=B_(t),r=PS.f,s=kp.f,c=0;c<n.length;c++){var l=n[c];Uo(e,l)||i&&Uo(i,l)||r(e,l,s(t,l))}},sd=Yc,Kp=Dc,Yp=_t,ZS=function(e,t){z_(t)&&"cause"in t&&jo(e,"cause",t.cause)},QS=function(e,t,i,n){VC&&(dn?dn(e,t):Du(e,"stack",id(i,n)))},$S=rd,ev=function(e,t){return e===void 0?arguments.length<2?"":t:BC(e)},rE=xi("toStringTag"),Mu=Error,tv=[].push,Fo=function(e,t){var i,n=ad(qp,this);ku?i=ku(new Mu,n?Wp(this):qp):(i=n?this:sd(qp),Kp(i,rE,"Error")),t!==void 0&&Kp(i,"message",ev(t)),QS(i,Fo,i.stack,1),arguments.length>2&&ZS(i,arguments[2]);var r=[];return $S(e,tv,{that:r}),Kp(i,"errors",r),i};ku?ku(Fo,Mu):zp(Fo,Mu,{name:!0});var qp=Fo.prototype=sd(Mu.prototype,{constructor:Yp(1,Fo),message:Yp(1,""),name:Yp(1,"AggregateError")});JS({global:!0},{AggregateError:Fo});var Uu,Vu,od,iv=Ye,aE=ae.WeakMap,sE=iv(aE)&&/native code/.test(String(aE)),oE=ae,nv=$n,FC=Dc,cE=an,Xp=pp,ju=Xi,lE=xn,Bu="Object already initialized",Jp=oE.TypeError,rv=oE.WeakMap;if(sE||Xp.state){var ea=Xp.state||(Xp.state=new rv);ea.get=ea.get,ea.has=ea.has,ea.set=ea.set,Uu=function(e,t){if(ea.has(e))throw new Jp(Bu);return t.facade=e,ea.set(e,t),t},Vu=function(e){return ea.get(e)||{}},od=function(e){return ea.has(e)}}else{var Xc=ju("state");lE[Xc]=!0,Uu=function(e,t){if(cE(e,Xc))throw new Jp(Bu);return t.facade=e,FC(e,Xc,t),t},Vu=function(e){return cE(e,Xc)?e[Xc]:{}},od=function(e){return cE(e,Xc)}}var Go,av,Jc,Va={set:Uu,get:Vu,has:od,enforce:function(e){return od(e)?Vu(e):Uu(e,{})},getterFor:function(e){return function(t){var i;if(!nv(t)||(i=Vu(t)).type!==e)throw new Jp("Incompatible receiver, "+e+" required");return i}}},cd=Ct,Fu=an,Gu=Function.prototype,sv=cd&&Object.getOwnPropertyDescriptor,dE=Fu(Gu,"name"),Zc={PROPER:dE&&(function(){}).name==="something",CONFIGURABLE:dE&&(!cd||cd&&sv(Gu,"name").configurable)},ov=Dc,kn=function(e,t,i,n){return n&&n.enumerable?e[t]=i:ov(e,t,i),e},ds=w,Ho=Ye,cv=$n,Wo=Yc,us=Bc,Mn=kn,ld=xi("iterator"),Zp=!1;[].keys&&("next"in(Jc=[].keys())?(av=us(us(Jc)))!==Object.prototype&&(Go=av):Zp=!0);var uE=!cv(Go)||ds(function(){var e={};return Go[ld].call(e)!==e});Ho((Go=uE?{}:Wo(Go))[ld])||Mn(Go,ld,function(){return this});var hE={IteratorPrototype:Go,BUGGY_SAFARI_ITERATORS:Zp},lv=Hs,Qc=T_?{}.toString:function(){return"[object "+lv(this)+"]"},Qp=T_,dv=dr.f,uv=Dc,hv=an,$p=Qc,pE=xi("toStringTag"),ja=function(e,t,i,n){var r=i?e:e&&e.prototype;r&&(hv(r,pE)||dv(r,pE,{configurable:!0,value:t}),n&&!Qp&&uv(r,"toString",$p))},pv=hE.IteratorPrototype,fv=Yc,GC=_t,mv=ja,zn=Bo,tr=function(){return this},ef=function(e,t,i,n){var r=t+" Iterator";return e.prototype=fv(pv,{next:GC(+!n,i)}),mv(e,r,!1,!0),zn[r]=tr,e},_v=Ft,Ev=ze,gv=Zc,Sv=ef,tf=Bc,fE=ja,mE=kn,_E=Bo,vv=hE,EE=gv.PROPER,dd=vv.BUGGY_SAFARI_ITERATORS,Hu=xi("iterator"),gE="keys",ud="values",Wu="entries",SE=function(){return this},vE=function(e,t,i,n,r,s,c){Sv(i,t,n);var l,d,h,f=function(k){if(k===r&&O)return O;if(!dd&&k&&k in y)return y[k];switch(k){case gE:case ud:case Wu:return function(){return new i(this,k)}}return function(){return new i(this)}},E=t+" Iterator",S=!1,y=e.prototype,D=y[Hu]||y["@@iterator"]||r&&y[r],O=!dd&&D||f(r),N=t==="Array"&&y.entries||D;if(N&&(l=tf(N.call(new e)))!==Object.prototype&&l.next&&(fE(l,E,!0,!0),_E[E]=SE),EE&&r===ud&&D&&D.name!==ud&&(S=!0,O=function(){return Ev(D,this)}),r)if(d={values:f(ud),keys:s?O:f(gE),entries:f(Wu)},c)for(h in d)(dd||S||!(h in y))&&mE(y,h,d[h]);else _v({target:t,proto:!0,forced:dd||S},d);return c&&y[Hu]!==O&&mE(y,Hu,O,{}),_E[t]=O,d},hd=function(e,t){return{value:e,done:t}},Tv=bo,hs=Bo,nf=Va;dr.f;var HC=vE,zu=hd,ps="Array Iterator",yv=nf.set,rf=nf.getterFor(ps);HC(Array,"Array",function(e,t){yv(this,{type:ps,target:Tv(e),index:0,kind:t})},function(){var e=rf(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=null,zu(void 0,!0);switch(e.kind){case"keys":return zu(i,!1);case"values":return zu(t[i],!1)}return zu([i,t[i]],!1)},"values"),hs.Arguments=hs.Array;var Ku=dr,Hi=function(e,t,i){return Ku.f(e,t,i)},WC=er,zC=Hi,Rv=Ct,pd=xi("species"),zo=ce,Cv=TypeError,af=function(e,t){if(zo(t,e))return e;throw new Cv("Incorrect invocation")},Yu=Ye,fa=pp,bv=z(Function.toString);Yu(fa.inspectSource)||(fa.inspectSource=function(e){return bv(e)});var sf=fa.inspectSource,Av=z,TE=w,of=Ye,cf=Hs,wv=sf,fs=function(){},un=er("Reflect","construct"),qu=/^\s*(?:class|function)\b/,Iv=Av(qu.exec),Kn=!qu.test(fs),Xu=function(e){if(!of(e))return!1;try{return un(fs,[],e),!0}catch{return!1}},yE=function(e){if(!of(e))return!1;switch(cf(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Kn||!!Iv(qu,wv(e))}catch{return!0}};yE.sham=!0;var fd,Ni,Tr,Ba,Ju=!un||TE(function(){var e;return Xu(Xu.call)||!Xu(Object)||!Xu(function(){e=!0})||e})?yE:Xu,Ov=Ju,KC=wo,RE=TypeError,Mr=Wn,Fa=function(e){if(Ov(e))return e;throw new RE(KC(e)+" is not a constructor")},Nv=Nl,ta=xi("species"),lf=function(e,t){var i,n=Mr(e).constructor;return n===void 0||Nv(i=Mr(n)[ta])?t:Fa(i)},yr=z([].slice),$c=TypeError,Ur=function(e,t){if(e<t)throw new $c("Not enough arguments");return e},df=/(?:ipad|iphone|ipod).*applewebkit/i.test(mn),Rr=ae,ms=fe,Dv=xa,el=Ye,Zu=an,md=w,tl=Vp,Lv=yr,CE=pu,Qu=Ur,Pv=df,uf=Ws,hf=Rr.setImmediate,bE=Rr.clearImmediate,YC=Rr.process,Ri=Rr.Dispatch,Wi=Rr.Function,ni=Rr.MessageChannel,hi=Rr.String,Ci=0,ir={},Zs="onreadystatechange";md(function(){fd=Rr.location});var Ko=function(e){if(Zu(ir,e)){var t=ir[e];delete ir[e],t()}},$u=function(e){return function(){Ko(e)}},_s=function(e){Ko(e.data)},sn=function(e){Rr.postMessage(hi(e),fd.protocol+"//"+fd.host)};hf&&bE||(hf=function(e){Qu(arguments.length,1);var t=el(e)?e:Wi(e),i=Lv(arguments,1);return ir[++Ci]=function(){ms(t,void 0,i)},Ni(Ci),Ci},bE=function(e){delete ir[e]},uf?Ni=function(e){YC.nextTick($u(e))}:Ri&&Ri.now?Ni=function(e){Ri.now($u(e))}:ni&&!Pv?(Ba=(Tr=new ni).port2,Tr.port1.onmessage=_s,Ni=Dv(Ba.postMessage,Ba)):Rr.addEventListener&&el(Rr.postMessage)&&!Rr.importScripts&&fd&&fd.protocol!=="file:"&&!md(sn)?(Ni=sn,Rr.addEventListener("message",_s,!1)):Ni=Zs in CE("script")?function(e){tl.appendChild(CE("script"))[Zs]=function(){tl.removeChild(this),Ko(e)}}:function(e){setTimeout($u(e),0)});var Ga={set:hf,clear:bE},Yo=ae,AE=Ct,ma=Object.getOwnPropertyDescriptor,il=function(e){if(!AE)return Yo[e];var t=ma(Yo,e);return t&&t.value},_d=function(){this.head=null,this.tail=null};_d.prototype={add:function(e){var t={item:e,next:null},i=this.tail;i?i.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Un,eh,th,Ed,ih,Qs=_d,nr=/ipad|iphone|ipod/i.test(mn)&&typeof Pebble<"u",qo=/web0s(?!.*chrome)/i.test(mn),Ha=ae,gd=il,pf=xa,nh=Ga.set,xv=Qs,rh=df,wE=nr,ia=qo,ff=Ws,Vr=Ha.MutationObserver||Ha.WebKitMutationObserver,IE=Ha.document,OE=Ha.process,mf=Ha.Promise,Es=gd("queueMicrotask");if(!Es){var nl=new xv,Sd=function(){var e,t;for(ff&&(e=OE.domain)&&e.exit();t=nl.get();)try{t()}catch(i){throw nl.head&&Un(),i}e&&e.enter()};rh||ff||ia||!Vr||!IE?!wE&&mf&&mf.resolve?((Ed=mf.resolve(void 0)).constructor=mf,ih=pf(Ed.then,Ed),Un=function(){ih(Sd)}):ff?Un=function(){OE.nextTick(Sd)}:(nh=pf(nh,Ha),Un=function(){nh(Sd)}):(eh=!0,th=IE.createTextNode(""),new Vr(Sd).observe(th,{characterData:!0}),Un=function(){th.data=eh=!eh}),Es=function(e){nl.head||Un(),nl.add(e)}}var rl=Es,al=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Xo=ae.Promise,kv=ae,sl=Xo,NE=Ye,qC=mu,XC=sf,JC=xi,DE=Xl,_f=ss,ol=sl&&sl.prototype,Ef=JC("species"),LE=NE(kv.PromiseRejectionEvent),Mv=qC("Promise",function(){var e=XC(sl),t=e!==String(sl);if(!t&&_f===66||!ol.catch||!ol.finally)return!0;if(!_f||_f<51||!/native code/.test(e)){var i=new sl(function(r){r(1)}),n=function(r){r(function(){},function(){})};if((i.constructor={})[Ef]=n,!(i.then(function(){})instanceof n))return!0}return!(t||DE!=="BROWSER"&&DE!=="DENO"||LE)}),vd={CONSTRUCTOR:Mv,REJECTION_EVENT:LE},Wa={},PE=_n,Uv=TypeError,gf=function(e){var t,i;this.promise=new e(function(n,r){if(t!==void 0||i!==void 0)throw new Uv("Bad Promise constructor");t=n,i=r}),this.resolve=PE(t),this.reject=PE(i)};Wa.f=function(e){return new gf(e)};var Sf,xE,ji=Ft,Td=Ws,Jo=ae,yd=ze,ZC=kn,QC=ja,$C=function(e){var t=WC(e);Rv&&t&&!t[pd]&&zC(t,pd,{configurable:!0,get:function(){return this}})},vf=_n,Zo=Ye,kE=$n,Tf=af,ME=lf,Qo=Ga.set,_a=rl,ah=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},eb=al,Vv=Qs,UE=Va,yf=Xo,VE=vd,jv=Wa,Rd="Promise",jE=VE.CONSTRUCTOR,Bv=VE.REJECTION_EVENT,BE=UE.getterFor(Rd),FE=UE.set,GE=yf&&yf.prototype,sh=yf,HE=GE,Cd=Jo.TypeError,WE=Jo.document,Rf=Jo.process,Qt=jv.f,zE=Qt,Cf=!!(WE&&WE.createEvent&&Jo.dispatchEvent),bf="unhandledrejection",KE=function(e){var t;return!(!kE(e)||!Zo(t=e.then))&&t},Af=function(e,t){var i,n,r,s=t.value,c=t.state===1,l=c?e.ok:e.fail,d=e.resolve,h=e.reject,f=e.domain;try{l?(c||(t.rejection===2&&tb(t),t.rejection=1),l===!0?i=s:(f&&f.enter(),i=l(s),f&&(f.exit(),r=!0)),i===e.promise?h(new Cd("Promise-chain cycle")):(n=KE(i))?yd(n,i,d,h):d(i)):h(s)}catch(E){f&&!r&&f.exit(),h(E)}},bd=function(e,t){e.notified||(e.notified=!0,_a(function(){for(var i,n=e.reactions;i=n.get();)Af(i,e);e.notified=!1,t&&!e.rejection&&Ad(e)}))},oh=function(e,t,i){var n,r;Cf?((n=WE.createEvent("Event")).promise=t,n.reason=i,n.initEvent(e,!1,!0),Jo.dispatchEvent(n)):n={promise:t,reason:i},!Bv&&(r=Jo["on"+e])?r(n):e===bf&&ah("Unhandled promise rejection",i)},Ad=function(e){yd(Qo,Jo,function(){var t,i=e.facade,n=e.value;if(YE(e)&&(t=eb(function(){Td?Rf.emit("unhandledRejection",n,i):oh(bf,i,n)}),e.rejection=Td||YE(e)?2:1,t.error))throw t.value})},YE=function(e){return e.rejection!==1&&!e.parent},tb=function(e){yd(Qo,Jo,function(){var t=e.facade;Td?Rf.emit("rejectionHandled",t):oh("rejectionhandled",t,e.value)})},wd=function(e,t,i){return function(n){e(t,n,i)}},cl=function(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,bd(e,!0))},wf=function(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw new Cd("Promise can't be resolved itself");var n=KE(t);n?_a(function(){var r={done:!1};try{yd(n,t,wd(wf,r,e),wd(cl,r,e))}catch(s){cl(r,s,e)}}):(e.value=t,e.state=1,bd(e,!1))}catch(r){cl({done:!1},r,e)}}};jE&&(HE=(sh=function(e){Tf(this,HE),vf(e),yd(Sf,this);var t=BE(this);try{e(wd(wf,t),wd(cl,t))}catch(i){cl(t,i)}}).prototype,(Sf=function(e){FE(this,{type:Rd,done:!1,notified:!1,parent:!1,reactions:new Vv,rejection:!1,state:0,value:null})}).prototype=ZC(HE,"then",function(e,t){var i=BE(this),n=Qt(ME(this,sh));return i.parent=!0,n.ok=!Zo(e)||e,n.fail=Zo(t)&&t,n.domain=Td?Rf.domain:void 0,i.state===0?i.reactions.add(n):_a(function(){Af(n,i)}),n.promise}),xE=function(){var e=new Sf,t=BE(e);this.promise=e,this.resolve=wd(wf,t),this.reject=wd(cl,t)},jv.f=Qt=function(e){return e===sh||e===void 0?new xE(e):zE(e)}),ji({global:!0,wrap:!0,forced:jE},{Promise:sh}),QC(sh,Rd,!1,!0),$C(Rd);var ch=xi("iterator"),Di=!1;try{var qE=0,Yn={next:function(){return{done:!!qE++}},return:function(){Di=!0}};Yn[ch]=function(){return this},Array.from(Yn,function(){throw 2})}catch{}var ib=Xo,XE=function(e,t){try{if(!t&&!Di)return!1}catch{return!1}var i=!1;try{var n={};n[ch]=function(){return{next:function(){return{done:i=!0}}}},e(n)}catch{}return i},Id=vd.CONSTRUCTOR||!XE(function(e){ib.all(e).then(void 0,function(){})}),If=ze,Fv=_n,Gv=Wa,JE=al,ZE=rd;Ft({target:"Promise",stat:!0,forced:Id},{all:function(e){var t=this,i=Gv.f(t),n=i.resolve,r=i.reject,s=JE(function(){var c=Fv(t.resolve),l=[],d=0,h=1;ZE(e,function(f){var E=d++,S=!1;h++,If(c,t,f).then(function(y){S||(S=!0,l[E]=y,--h||n(l))},r)}),--h||n(l)});return s.error&&r(s.value),i.promise}});var nb=Ft,Hv=vd.CONSTRUCTOR;Xo&&Xo.prototype,nb({target:"Promise",proto:!0,forced:Hv,real:!0},{catch:function(e){return this.then(void 0,e)}});var rb=ze,Wv=_n,ab=Wa,sb=al,$o=rd;Ft({target:"Promise",stat:!0,forced:Id},{race:function(e){var t=this,i=ab.f(t),n=i.reject,r=sb(function(){var s=Wv(t.resolve);$o(e,function(c){rb(s,t,c).then(i.resolve,n)})});return r.error&&n(r.value),i.promise}});var zv=Wa;Ft({target:"Promise",stat:!0,forced:vd.CONSTRUCTOR},{reject:function(e){var t=zv.f(this);return(0,t.reject)(e),t.promise}});var QE=Wn,ob=$n,cb=Wa,Of=function(e,t){if(QE(e),ob(t)&&t.constructor===e)return t;var i=cb.f(e);return(0,i.resolve)(t),i.promise},lb=Ft,za=Xo,$E=vd.CONSTRUCTOR,Kv=Of,Yv=er("Promise"),lh=!$E;lb({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return Kv(lh&&this===Yv?za:this,e)}});var Ea=ze,qv=_n,Nf=Wa,$s=al,db=rd;Ft({target:"Promise",stat:!0,forced:Id},{allSettled:function(e){var t=this,i=Nf.f(t),n=i.resolve,r=i.reject,s=$s(function(){var c=qv(t.resolve),l=[],d=0,h=1;db(e,function(f){var E=d++,S=!1;h++,Ea(c,t,f).then(function(y){S||(S=!0,l[E]={status:"fulfilled",value:y},--h||n(l))},function(y){S||(S=!0,l[E]={status:"rejected",reason:y},--h||n(l))})}),--h||n(l)});return s.error&&r(s.value),i.promise}});var ub=ze,Od=_n,Xv=er,hb=Wa,pb=al,fb=rd,Jv="No one promise resolved";Ft({target:"Promise",stat:!0,forced:Id},{any:function(e){var t=this,i=Xv("AggregateError"),n=hb.f(t),r=n.resolve,s=n.reject,c=pb(function(){var l=Od(t.resolve),d=[],h=0,f=1,E=!1;fb(e,function(S){var y=h++,D=!1;f++,ub(l,t,S).then(function(O){D||E||(E=!0,r(O))},function(O){D||E||(D=!0,d[y]=O,--f||s(new i(d,Jv)))})}),--f||s(new i(d,Jv))});return c.error&&s(c.value),n.promise}});var mb=Ft,_b=fe,Eb=yr,Zv=Wa,Nd=_n,Dd=al,Df=ae.Promise,Qv=!1;mb({target:"Promise",stat:!0,forced:!Df||!Df.try||Dd(function(){Df.try(function(e){Qv=e===8},8)}).error||!Qv},{try:function(e){var t=arguments.length>1?Eb(arguments,1):[],i=Zv.f(this),n=Dd(function(){return _b(Nd(e),void 0,t)});return(n.error?i.reject:i.resolve)(n.value),i.promise}});var Ld=Wa;Ft({target:"Promise",stat:!0},{withResolvers:function(){var e=Ld.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var dh=Ft,Lf=Xo,Pf=w,eg=er,tg=Ye,xf=lf,ig=Of,$v=Lf&&Lf.prototype;dh({target:"Promise",proto:!0,real:!0,forced:!!Lf&&Pf(function(){$v.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=xf(this,eg("Promise")),i=tg(e);return this.then(i?function(n){return ig(t,e()).then(function(){return n})}:e,i?function(n){return ig(t,e()).then(function(){throw n})}:e)}});var ng=z,eT=Lc,uh=Pn,gb=Vs,Sb=ng("".charAt),tT=ng("".charCodeAt),kf=ng("".slice),hh=function(e){return function(t,i){var n,r,s=uh(gb(t)),c=eT(i),l=s.length;return c<0||c>=l?e?"":void 0:(n=tT(s,c))<55296||n>56319||c+1===l||(r=tT(s,c+1))<56320||r>57343?e?Sb(s,c):n:e?kf(s,c,c+2):r-56320+(n-55296<<10)+65536}},ph={codeAt:hh(!1),charAt:hh(!0)},vb=ph.charAt,fh=Pn,iT=Va,nT=vE,rg=hd,ag="String Iterator",rT=iT.set,sg=iT.getterFor(ag);nT(String,"String",function(e){rT(this,{type:ag,string:fh(e),index:0})},function(){var e,t=sg(this),i=t.string,n=t.index;return n>=i.length?rg(void 0,!0):(e=vb(i,n),t.index+=e.length,rg(e,!1))});var aT=Dr.Promise,Mf={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Tb=ae,yb=ja,Uf=Bo;for(var mh in Mf)yb(Tb[mh],mh),Uf[mh]=Uf.Array;var _h=aT,Ie=R(_h),sT=Xr("Array","values"),og=Hs,ec=an,tc=ce,ic=sT,ll=Array.prototype,Eh={DOMTokenList:!0,NodeList:!0},nc=function(e){var t=e.values;return e===ll||tc(ll,e)&&t===ll.values||ec(Eh,og(e))?ic:t},Cr=R(nc),cg=wo,gh=TypeError,oT=yr,cT=Math.floor,Pd=function(e,t){var i=e.length;if(i<8)for(var n,r,s=1;s<i;){for(r=s,n=e[s];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==s++&&(e[r]=n)}else for(var c=cT(i/2),l=Pd(oT(e,0,c),t),d=Pd(oT(e,c),t),h=l.length,f=d.length,E=0,S=0;E<h||S<f;)e[E+S]=E<h&&S<f?t(l[E],d[S])<=0?l[E++]:d[S++]:E<h?l[E++]:d[S++];return e},lg=Pd,lT=mn.match(/firefox\/(\d+)/i),Vf=!!lT&&+lT[1],jf=/MSIE|Trident/.test(mn),dg=mn.match(/AppleWebKit\/(\d+)\./),Sh=!!dg&&+dg[1],ug=Ft,vh=z,dT=_n,Rb=Pa,Th=No,a=function(e,t){if(!delete e[t])throw new gh("Cannot delete property "+cg(t)+" of "+cg(e))},o=Pn,u=w,m=lg,T=kc,b=Vf,F=jf,Y=ss,re=Sh,Se=[],Pe=vh(Se.sort),Be=vh(Se.push),be=u(function(){Se.sort(void 0)}),we=u(function(){Se.sort(null)}),xt=T("sort"),bt=!u(function(){if(Y)return Y<70;if(!(b&&b>3)){if(F)return!0;if(re)return re<603;var e,t,i,n,r="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(n=0;n<47;n++)Se.push({k:t+n,v:i})}for(Se.sort(function(s,c){return c.v-s.v}),n=0;n<Se.length;n++)t=Se[n].k.charAt(0),r.charAt(r.length-1)!==t&&(r+=t);return r!=="DGBEFHACIJK"}});ug({target:"Array",proto:!0,forced:be||!we||!xt||!bt},{sort:function(e){e!==void 0&&dT(e);var t=Rb(this);if(bt)return e===void 0?Pe(t):Pe(t,e);var i,n,r=[],s=Th(t);for(n=0;n<s;n++)n in t&&Be(r,t[n]);for(m(r,(function(c){return function(l,d){return d===void 0?-1:l===void 0?1:c!==void 0?+c(l,d)||0:o(l)>o(d)?1:-1}})(e)),i=Th(r),n=0;n<i;)t[n]=r[n++];for(;n<s;)a(t,n++);return t}});var Mi=Xr("Array","sort"),_e=ce,he=Mi,ve=Array.prototype,Ve=function(e){var t=e.sort;return e===ve||_e(ve,e)&&t===ve.sort?he:t},lt=R(Ve),ri=Ft,gt=z,Nt=bp,qn=RangeError,mi=String.fromCharCode,eo=String.fromCodePoint,Cb=gt([].join);ri({target:"String",stat:!0,forced:!!eo&&eo.length!==1},{fromCodePoint:function(e){for(var t,i=[],n=arguments.length,r=0;n>r;){if(t=+arguments[r++],Nt(t,1114111)!==t)throw new qn(t+" is not a valid code point");i[r]=t<65536?mi(t):mi(55296+((t-=65536)>>10),t%1024+56320)}return Cb(i,"")}});var r9=w,a9=xi("iterator"),uT=!r9(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,i=new URLSearchParams("a=1&a=2&b=3"),n="";return e.pathname="c%20d",t.forEach(function(r,s){t.delete("b"),n+=s+r}),i.delete("a",2),i.delete("b",void 0),!e.toJSON||!i.has("a",1)||i.has("a",2)||!i.has("a",void 0)||i.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[a9]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||n!=="a1c3"||new URL("https://x",void 0).host!=="x"}),s9=kn,bb=Ft,Q2=ae,Ab=il,o9=er,hT=ze,to=z,hg=Ct,$2=uT,eO=kn,c9=Hi,l9=function(e,t,i){for(var n in t)i&&i.unsafe&&e[n]?e[n]=t[n]:s9(e,n,t[n],i);return e},d9=ja,u9=ef,wb=Va,tO=af,Ib=Ye,h9=an,p9=xa,f9=Hs,m9=Wn,iO=$n,na=Pn,_9=Yc,nO=_t,rO=Pu,E9=nd,pT=hd,Bf=Ur,g9=lg,S9=xi("iterator"),Ff="URLSearchParams",aO=Ff+"Iterator",sO=wb.set,gs=wb.getterFor(Ff),v9=wb.getterFor(aO),oO=Ab("fetch"),fT=Ab("Request"),pg=Ab("Headers"),Ob=fT&&fT.prototype,cO=pg&&pg.prototype,T9=Q2.TypeError,y9=Q2.encodeURIComponent,R9=String.fromCharCode,C9=o9("String","fromCodePoint"),b9=parseInt,mT=to("".charAt),lO=to([].join),xd=to([].push),dO=to("".replace),A9=to([].shift),uO=to([].splice),hO=to("".split),pO=to("".slice),w9=to(/./.exec),I9=/\+/g,O9=/^[0-9a-f]+$/i,fO=function(e,t){var i=pO(e,t,t+2);return w9(O9,i)?b9(i,16):NaN},N9=function(e){for(var t=0,i=128;i>0&&e&i;i>>=1)t++;return t},D9=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},mO=function(e){for(var t=(e=dO(e,I9," ")).length,i="",n=0;n<t;){var r=mT(e,n);if(r==="%"){if(mT(e,n+1)==="%"||n+3>t){i+="%",n++;continue}var s=fO(e,n+1);if(s!=s){i+=r,n++;continue}n+=2;var c=N9(s);if(c===0)r=R9(s);else{if(c===1||c>4){i+="",n++;continue}for(var l=[s],d=1;d<c&&!(++n+3>t||mT(e,n)!=="%");){var h=fO(e,n+1);if(h!=h){n+=3;break}if(h>191||h<128)break;xd(l,h),n+=2,d++}if(l.length!==c){i+="";continue}var f=D9(l);f===null?i+="":r=C9(f)}}i+=r,n++}return i},L9=/[!'()~]|%20/g,P9={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},x9=function(e){return P9[e]},_O=function(e){return dO(y9(e),L9,x9)},Nb=u9(function(e,t){sO(this,{type:aO,target:gs(e).entries,index:0,kind:t})},Ff,function(){var e=v9(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=null,pT(void 0,!0);var n=t[i];switch(e.kind){case"keys":return pT(n.key,!1);case"values":return pT(n.value,!1)}return pT([n.key,n.value],!1)},!0),EO=function(e){this.entries=[],this.url=null,e!==void 0&&(iO(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?mT(e,0)==="?"?pO(e,1):e:na(e)))};EO.prototype={type:Ff,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,i,n,r,s,c,l,d=this.entries,h=E9(e);if(h)for(i=(t=rO(e,h)).next;!(n=hT(i,t)).done;){if(s=(r=rO(m9(n.value))).next,(c=hT(s,r)).done||(l=hT(s,r)).done||!hT(s,r).done)throw new T9("Expected sequence with length 2");xd(d,{key:na(c.value),value:na(l.value)})}else for(var f in e)h9(e,f)&&xd(d,{key:f,value:na(e[f])})},parseQuery:function(e){if(e)for(var t,i,n=this.entries,r=hO(e,"&"),s=0;s<r.length;)(t=r[s++]).length&&(i=hO(t,"="),xd(n,{key:mO(A9(i)),value:mO(lO(i,"="))}))},serialize:function(){for(var e,t=this.entries,i=[],n=0;n<t.length;)e=t[n++],xd(i,_O(e.key)+"="+_O(e.value));return lO(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var _T=function(){tO(this,Gf);var e=sO(this,new EO(arguments.length>0?arguments[0]:void 0));hg||(this.size=e.entries.length)},Gf=_T.prototype;if(l9(Gf,{append:function(e,t){var i=gs(this);Bf(arguments.length,2),xd(i.entries,{key:na(e),value:na(t)}),hg||this.length++,i.updateURL()},delete:function(e){for(var t=gs(this),i=Bf(arguments.length,1),n=t.entries,r=na(e),s=i<2?void 0:arguments[1],c=s===void 0?s:na(s),l=0;l<n.length;){var d=n[l];if(d.key!==r||c!==void 0&&d.value!==c)l++;else if(uO(n,l,1),c!==void 0)break}hg||(this.size=n.length),t.updateURL()},get:function(e){var t=gs(this).entries;Bf(arguments.length,1);for(var i=na(e),n=0;n<t.length;n++)if(t[n].key===i)return t[n].value;return null},getAll:function(e){var t=gs(this).entries;Bf(arguments.length,1);for(var i=na(e),n=[],r=0;r<t.length;r++)t[r].key===i&&xd(n,t[r].value);return n},has:function(e){for(var t=gs(this).entries,i=Bf(arguments.length,1),n=na(e),r=i<2?void 0:arguments[1],s=r===void 0?r:na(r),c=0;c<t.length;){var l=t[c++];if(l.key===n&&(s===void 0||l.value===s))return!0}return!1},set:function(e,t){var i=gs(this);Bf(arguments.length,1);for(var n,r=i.entries,s=!1,c=na(e),l=na(t),d=0;d<r.length;d++)(n=r[d]).key===c&&(s?uO(r,d--,1):(s=!0,n.value=l));s||xd(r,{key:c,value:l}),hg||(this.size=r.length),i.updateURL()},sort:function(){var e=gs(this);g9(e.entries,function(t,i){return t.key>i.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,i=gs(this).entries,n=p9(e,arguments.length>1?arguments[1]:void 0),r=0;r<i.length;)n((t=i[r++]).value,t.key,this)},keys:function(){return new Nb(this,"keys")},values:function(){return new Nb(this,"values")},entries:function(){return new Nb(this,"entries")}},{enumerable:!0}),eO(Gf,S9,Gf.entries,{}),eO(Gf,"toString",function(){return gs(this).serialize()},{enumerable:!0}),hg&&c9(Gf,"size",{get:function(){return gs(this).entries.length},configurable:!0,enumerable:!0}),d9(_T,Ff),bb({global:!0,forced:!$2},{URLSearchParams:_T}),!$2&&Ib(pg)){var k9=to(cO.has),M9=to(cO.set),gO=function(e){if(iO(e)){var t,i=e.body;if(f9(i)===Ff)return t=e.headers?new pg(e.headers):new pg,k9(t,"content-type")||M9(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),_9(e,{body:nO(0,na(i)),headers:nO(0,t)})}return e};if(Ib(oO)&&bb({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return oO(e,arguments.length>1?gO(arguments[1]):{})}}),Ib(fT)){var Db=function(e){return tO(this,Ob),new fT(e,arguments.length>1?gO(arguments[1]):{})};Ob.constructor=Db,Db.prototype=Ob,bb({global:!0,dontCallGetSet:!0,forced:!0},{Request:Db})}}var Ss,U9={URLSearchParams:_T,getState:gs},V9=Dr.URLSearchParams,SO=Ct,j9=z,B9=ze,F9=w,Lb=ed,G9=Gc,H9=We,W9=Pa,z9=La,Hf=Object.assign,vO=Object.defineProperty,K9=j9([].concat),Y9=!Hf||F9(function(){if(SO&&Hf({b:1},Hf(vO({},"a",{enumerable:!0,get:function(){vO(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},i=Symbol("assign detection"),n="abcdefghijklmnopqrst";return e[i]=7,n.split("").forEach(function(r){t[r]=r}),Hf({},e)[i]!==7||Lb(Hf({},t)).join("")!==n})?function(e,t){for(var i=W9(e),n=arguments.length,r=1,s=G9.f,c=H9.f;n>r;)for(var l,d=z9(arguments[r++]),h=s?K9(Lb(d),s(d)):Lb(d),f=h.length,E=0;f>E;)l=h[E++],SO&&!B9(c,d,l)||(i[l]=d[l]);return i}:Hf,q9=Wn,X9=Q_,J9=Ct,Z9=dr,Q9=_t,Pb=function(e,t,i){J9?Z9.f(e,t,Q9(0,i)):e[t]=i},$9=xa,e5=ze,t5=Pa,i5=function(e,t,i,n){try{return n?t(q9(i)[0],i[1]):t(i)}catch(r){X9(e,"throw",r)}},n5=FS,r5=Ju,a5=No,TO=Pb,s5=Pu,o5=nd,yO=Array,yh=z,xb=2147483647,c5=/[^\0-\u007E]/,RO=/[.\u3002\uFF0E\uFF61]/g,CO="Overflow: input needs wider integers to process",bO=RangeError,l5=yh(RO.exec),Wf=Math.floor,kb=String.fromCharCode,AO=yh("".charCodeAt),wO=yh([].join),kd=yh([].push),d5=yh("".replace),u5=yh("".split),h5=yh("".toLowerCase),IO=function(e){return e+22+75*(e<26)},p5=function(e,t,i){var n=0;for(e=i?Wf(e/700):e>>1,e+=Wf(e/t);e>455;)e=Wf(e/35),n+=36;return Wf(n+36*e/(e+38))},f5=function(e){var t=[];e=(function(k){for(var U=[],B=0,J=k.length;B<J;){var K=AO(k,B++);if(K>=55296&&K<=56319&&B<J){var H=AO(k,B++);(64512&H)==56320?kd(U,((1023&K)<<10)+(1023&H)+65536):(kd(U,K),B--)}else kd(U,K)}return U})(e);var i,n,r=e.length,s=128,c=0,l=72;for(i=0;i<e.length;i++)(n=e[i])<128&&kd(t,kb(n));var d=t.length,h=d;for(d&&kd(t,"-");h<r;){var f=xb;for(i=0;i<e.length;i++)(n=e[i])>=s&&n<f&&(f=n);var E=h+1;if(f-s>Wf((xb-c)/E))throw new bO(CO);for(c+=(f-s)*E,s=f,i=0;i<e.length;i++){if((n=e[i])<s&&++c>xb)throw new bO(CO);if(n===s){for(var S=c,y=36;;){var D=y<=l?1:y>=l+26?26:y-l;if(S<D)break;var O=S-D,N=36-D;kd(t,kb(IO(D+O%N))),S=Wf(O/N),y+=36}kd(t,kb(IO(S))),l=p5(c,E,h===d),c=0,h++}}c++,s++}return wO(t,"")},m5=Ft,Mb=Ct,_5=uT,Ub=ae,OO=xa,vs=z,ET=kn,Ts=Hi,E5=af,Vb=an,jb=Y9,zf=function(e){var t=t5(e),i=r5(this),n=arguments.length,r=n>1?arguments[1]:void 0,s=r!==void 0;s&&(r=$9(r,n>2?arguments[2]:void 0));var c,l,d,h,f,E,S=o5(t),y=0;if(!S||this===yO&&n5(S))for(c=a5(t),l=i?new this(c):yO(c);c>y;y++)E=s?r(t[y],y):t[y],TO(l,y,E);else for(l=i?new this:[],f=(h=s5(t,S)).next;!(d=e5(f,h)).done;y++)E=s?i5(h,r,[d.value,y],!0):d.value,TO(l,y,E);return l.length=y,l},io=yr,g5=ph.codeAt,S5=function(e){var t,i,n=[],r=u5(d5(h5(e),RO,"."),".");for(t=0;t<r.length;t++)i=r[t],kd(n,l5(c5,i)?"xn--"+f5(i):i);return wO(n,".")},dl=Pn,v5=ja,T5=Ur,NO=U9,DO=Va,y5=DO.set,gT=DO.getterFor("URL"),R5=NO.URLSearchParams,C5=NO.getState,fg=Ub.URL,Bb=Ub.TypeError,ST=Ub.parseInt,b5=Math.floor,LO=Math.pow,ys=vs("".charAt),no=vs(/./.exec),mg=vs([].join),A5=vs(1 .toString),w5=vs([].pop),Kf=vs([].push),Fb=vs("".replace),I5=vs([].shift),O5=vs("".split),_g=vs("".slice),vT=vs("".toLowerCase),N5=vs([].unshift),Gb="Invalid scheme",Eg="Invalid host",PO="Invalid port",xO=/[a-z]/i,D5=/[\d+-.a-z]/i,Hb=/\d/,L5=/^0x/i,P5=/^[0-7]+$/,x5=/^\d+$/,kO=/^[\da-f]+$/i,k5=/[\0\t\n\r #%/:<>?@[\\\]^|]/,M5=/[\0\t\n\r #/:<>?@[\\\]^|]/,U5=/^[\u0000-\u0020]+/,V5=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,j5=/[\t\n\r]/g,gg=function(e){var t,i,n,r;if(typeof e=="number"){for(t=[],i=0;i<4;i++)N5(t,e%256),e=b5(e/256);return mg(t,".")}if(typeof e=="object"){for(t="",n=(function(s){for(var c=null,l=1,d=null,h=0,f=0;f<8;f++)s[f]!==0?(h>l&&(c=d,l=h),d=null,h=0):(d===null&&(d=f),++h);return h>l?d:c})(e),i=0;i<8;i++)r&&e[i]===0||(r&&(r=!1),n===i?(t+=i?":":"::",r=!0):(t+=A5(e[i],16),i<7&&(t+=":")));return"["+t+"]"}return e},TT={},MO=jb({},TT,{" ":1,'"':1,"<":1,">":1,"`":1}),UO=jb({},MO,{"#":1,"?":1,"{":1,"}":1}),Wb=jb({},UO,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Md=function(e,t){var i=g5(e,0);return i>32&&i<127&&!Vb(t,e)?e:encodeURIComponent(e)},yT={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Sg=function(e,t){var i;return e.length===2&&no(xO,ys(e,0))&&((i=ys(e,1))===":"||!t&&i==="|")},VO=function(e){var t;return e.length>1&&Sg(_g(e,0,2))&&(e.length===2||(t=ys(e,2))==="/"||t==="\\"||t==="?"||t==="#")},B5=function(e){return e==="."||vT(e)==="%2e"},zb={},jO={},Kb={},BO={},FO={},Yb={},GO={},HO={},RT={},CT={},qb={},Xb={},Jb={},Zb={},WO={},Qb={},Yf={},rc={},zO={},Rh={},ul={},$b=function(e,t,i){var n,r,s,c=dl(e);if(t){if(r=this.parse(c))throw new Bb(r);this.searchParams=null}else{if(i!==void 0&&(n=new $b(i,!0)),r=this.parse(c,null,n))throw new Bb(r);(s=C5(new R5)).bindURL(this),this.searchParams=s}};$b.prototype={type:"URL",parse:function(e,t,i){var n,r,s,c,l,d=this,h=t||zb,f=0,E="",S=!1,y=!1,D=!1;for(e=dl(e),t||(d.scheme="",d.username="",d.password="",d.host=null,d.port=null,d.path=[],d.query=null,d.fragment=null,d.cannotBeABaseURL=!1,e=Fb(e,U5,""),e=Fb(e,V5,"$1")),e=Fb(e,j5,""),n=zf(e);f<=n.length;){switch(r=n[f],h){case zb:if(!r||!no(xO,r)){if(t)return Gb;h=Kb;continue}E+=vT(r),h=jO;break;case jO:if(r&&(no(D5,r)||r==="+"||r==="-"||r==="."))E+=vT(r);else{if(r!==":"){if(t)return Gb;E="",h=Kb,f=0;continue}if(t&&(d.isSpecial()!==Vb(yT,E)||E==="file"&&(d.includesCredentials()||d.port!==null)||d.scheme==="file"&&!d.host))return;if(d.scheme=E,t)return void(d.isSpecial()&&yT[d.scheme]===d.port&&(d.port=null));E="",d.scheme==="file"?h=Zb:d.isSpecial()&&i&&i.scheme===d.scheme?h=BO:d.isSpecial()?h=HO:n[f+1]==="/"?(h=FO,f++):(d.cannotBeABaseURL=!0,Kf(d.path,""),h=zO)}break;case Kb:if(!i||i.cannotBeABaseURL&&r!=="#")return Gb;if(i.cannotBeABaseURL&&r==="#"){d.scheme=i.scheme,d.path=io(i.path),d.query=i.query,d.fragment="",d.cannotBeABaseURL=!0,h=ul;break}h=i.scheme==="file"?Zb:Yb;continue;case BO:if(r!=="/"||n[f+1]!=="/"){h=Yb;continue}h=RT,f++;break;case FO:if(r==="/"){h=CT;break}h=rc;continue;case Yb:if(d.scheme=i.scheme,r===Ss)d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,d.path=io(i.path),d.query=i.query;else if(r==="/"||r==="\\"&&d.isSpecial())h=GO;else if(r==="?")d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,d.path=io(i.path),d.query="",h=Rh;else{if(r!=="#"){d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,d.path=io(i.path),d.path.length--,h=rc;continue}d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,d.path=io(i.path),d.query=i.query,d.fragment="",h=ul}break;case GO:if(!d.isSpecial()||r!=="/"&&r!=="\\"){if(r!=="/"){d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,h=rc;continue}h=CT}else h=RT;break;case HO:if(h=RT,r!=="/"||ys(E,f+1)!=="/")continue;f++;break;case RT:if(r!=="/"&&r!=="\\"){h=CT;continue}break;case CT:if(r==="@"){S&&(E="%40"+E),S=!0,s=zf(E);for(var O=0;O<s.length;O++){var N=s[O];if(N!==":"||D){var k=Md(N,Wb);D?d.password+=k:d.username+=k}else D=!0}E=""}else if(r===Ss||r==="/"||r==="?"||r==="#"||r==="\\"&&d.isSpecial()){if(S&&E==="")return"Invalid authority";f-=zf(E).length+1,E="",h=qb}else E+=r;break;case qb:case Xb:if(t&&d.scheme==="file"){h=Qb;continue}if(r!==":"||y){if(r===Ss||r==="/"||r==="?"||r==="#"||r==="\\"&&d.isSpecial()){if(d.isSpecial()&&E==="")return Eg;if(t&&E===""&&(d.includesCredentials()||d.port!==null))return;if(c=d.parseHost(E))return c;if(E="",h=Yf,t)return;continue}r==="["?y=!0:r==="]"&&(y=!1),E+=r}else{if(E==="")return Eg;if(c=d.parseHost(E))return c;if(E="",h=Jb,t===Xb)return}break;case Jb:if(!no(Hb,r)){if(r===Ss||r==="/"||r==="?"||r==="#"||r==="\\"&&d.isSpecial()||t){if(E!==""){var U=ST(E,10);if(U>65535)return PO;d.port=d.isSpecial()&&U===yT[d.scheme]?null:U,E=""}if(t)return;h=Yf;continue}return PO}E+=r;break;case Zb:if(d.scheme="file",r==="/"||r==="\\")h=WO;else{if(!i||i.scheme!=="file"){h=rc;continue}switch(r){case Ss:d.host=i.host,d.path=io(i.path),d.query=i.query;break;case"?":d.host=i.host,d.path=io(i.path),d.query="",h=Rh;break;case"#":d.host=i.host,d.path=io(i.path),d.query=i.query,d.fragment="",h=ul;break;default:VO(mg(io(n,f),""))||(d.host=i.host,d.path=io(i.path),d.shortenPath()),h=rc;continue}}break;case WO:if(r==="/"||r==="\\"){h=Qb;break}i&&i.scheme==="file"&&!VO(mg(io(n,f),""))&&(Sg(i.path[0],!0)?Kf(d.path,i.path[0]):d.host=i.host),h=rc;continue;case Qb:if(r===Ss||r==="/"||r==="\\"||r==="?"||r==="#"){if(!t&&Sg(E))h=rc;else if(E===""){if(d.host="",t)return;h=Yf}else{if(c=d.parseHost(E))return c;if(d.host==="localhost"&&(d.host=""),t)return;E="",h=Yf}continue}E+=r;break;case Yf:if(d.isSpecial()){if(h=rc,r!=="/"&&r!=="\\")continue}else if(t||r!=="?")if(t||r!=="#"){if(r!==Ss&&(h=rc,r!=="/"))continue}else d.fragment="",h=ul;else d.query="",h=Rh;break;case rc:if(r===Ss||r==="/"||r==="\\"&&d.isSpecial()||!t&&(r==="?"||r==="#")){if((l=vT(l=E))===".."||l==="%2e."||l===".%2e"||l==="%2e%2e"?(d.shortenPath(),r==="/"||r==="\\"&&d.isSpecial()||Kf(d.path,"")):B5(E)?r==="/"||r==="\\"&&d.isSpecial()||Kf(d.path,""):(d.scheme==="file"&&!d.path.length&&Sg(E)&&(d.host&&(d.host=""),E=ys(E,0)+":"),Kf(d.path,E)),E="",d.scheme==="file"&&(r===Ss||r==="?"||r==="#"))for(;d.path.length>1&&d.path[0]==="";)I5(d.path);r==="?"?(d.query="",h=Rh):r==="#"&&(d.fragment="",h=ul)}else E+=Md(r,UO);break;case zO:r==="?"?(d.query="",h=Rh):r==="#"?(d.fragment="",h=ul):r!==Ss&&(d.path[0]+=Md(r,TT));break;case Rh:t||r!=="#"?r!==Ss&&(r==="'"&&d.isSpecial()?d.query+="%27":d.query+=r==="#"?"%23":Md(r,TT)):(d.fragment="",h=ul);break;case ul:r!==Ss&&(d.fragment+=Md(r,MO))}f++}},parseHost:function(e){var t,i,n;if(ys(e,0)==="["){if(ys(e,e.length-1)!=="]"||(t=(function(r){var s,c,l,d,h,f,E,S=[0,0,0,0,0,0,0,0],y=0,D=null,O=0,N=function(){return ys(r,O)};if(N()===":"){if(ys(r,1)!==":")return;O+=2,D=++y}for(;N();){if(y===8)return;if(N()!==":"){for(s=c=0;c<4&&no(kO,N());)s=16*s+ST(N(),16),O++,c++;if(N()==="."){if(c===0||(O-=c,y>6))return;for(l=0;N();){if(d=null,l>0){if(!(N()==="."&&l<4))return;O++}if(!no(Hb,N()))return;for(;no(Hb,N());){if(h=ST(N(),10),d===null)d=h;else{if(d===0)return;d=10*d+h}if(d>255)return;O++}S[y]=256*S[y]+d,++l!=2&&l!==4||y++}if(l!==4)return;break}if(N()===":"){if(O++,!N())return}else if(N())return;S[y++]=s}else{if(D!==null)return;O++,D=++y}}if(D!==null)for(f=y-D,y=7;y!==0&&f>0;)E=S[y],S[y--]=S[D+f-1],S[D+--f]=E;else if(y!==8)return;return S})(_g(e,1,-1)),!t))return Eg;this.host=t}else if(this.isSpecial()){if(e=S5(e),no(k5,e)||(t=(function(r){var s,c,l,d,h,f,E,S=O5(r,".");if(S.length&&S[S.length-1]===""&&S.length--,(s=S.length)>4)return r;for(c=[],l=0;l<s;l++){if((d=S[l])==="")return r;if(h=10,d.length>1&&ys(d,0)==="0"&&(h=no(L5,d)?16:8,d=_g(d,h===8?1:2)),d==="")f=0;else{if(!no(h===10?x5:h===8?P5:kO,d))return r;f=ST(d,h)}Kf(c,f)}for(l=0;l<s;l++)if(f=c[l],l===s-1){if(f>=LO(256,5-s))return null}else if(f>255)return null;for(E=w5(c),l=0;l<c.length;l++)E+=c[l]*LO(256,3-l);return E})(e),t===null))return Eg;this.host=t}else{if(no(M5,e))return Eg;for(t="",i=zf(e),n=0;n<i.length;n++)t+=Md(i[n],TT);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return Vb(yT,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&Sg(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,i=e.username,n=e.password,r=e.host,s=e.port,c=e.path,l=e.query,d=e.fragment,h=t+":";return r!==null?(h+="//",e.includesCredentials()&&(h+=i+(n?":"+n:"")+"@"),h+=gg(r),s!==null&&(h+=":"+s)):t==="file"&&(h+="//"),h+=e.cannotBeABaseURL?c[0]:c.length?"/"+mg(c,"/"):"",l!==null&&(h+="?"+l),d!==null&&(h+="#"+d),h},setHref:function(e){var t=this.parse(e);if(t)throw new Bb(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new qf(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+gg(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(dl(e)+":",zb)},getUsername:function(){return this.username},setUsername:function(e){var t=zf(dl(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<t.length;i++)this.username+=Md(t[i],Wb)}},getPassword:function(){return this.password},setPassword:function(e){var t=zf(dl(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<t.length;i++)this.password+=Md(t[i],Wb)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?gg(e):gg(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,qb)},getHostname:function(){var e=this.host;return e===null?"":gg(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Xb)},getPort:function(){var e=this.port;return e===null?"":dl(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=dl(e))===""?this.port=null:this.parse(e,Jb))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+mg(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Yf))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=dl(e))===""?this.query=null:(ys(e,0)==="?"&&(e=_g(e,1)),this.query="",this.parse(e,Rh)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=dl(e))!==""?(ys(e,0)==="#"&&(e=_g(e,1)),this.fragment="",this.parse(e,ul)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var qf=function(e){var t=E5(this,ra),i=T5(arguments.length,1)>1?arguments[1]:void 0,n=y5(t,new $b(e,!1,i));Mb||(t.href=n.serialize(),t.origin=n.getOrigin(),t.protocol=n.getProtocol(),t.username=n.getUsername(),t.password=n.getPassword(),t.host=n.getHost(),t.hostname=n.getHostname(),t.port=n.getPort(),t.pathname=n.getPathname(),t.search=n.getSearch(),t.searchParams=n.getSearchParams(),t.hash=n.getHash())},ra=qf.prototype,Rs=function(e,t){return{get:function(){return gT(this)[e]()},set:t&&function(i){return gT(this)[t](i)},configurable:!0,enumerable:!0}};if(Mb&&(Ts(ra,"href",Rs("serialize","setHref")),Ts(ra,"origin",Rs("getOrigin")),Ts(ra,"protocol",Rs("getProtocol","setProtocol")),Ts(ra,"username",Rs("getUsername","setUsername")),Ts(ra,"password",Rs("getPassword","setPassword")),Ts(ra,"host",Rs("getHost","setHost")),Ts(ra,"hostname",Rs("getHostname","setHostname")),Ts(ra,"port",Rs("getPort","setPort")),Ts(ra,"pathname",Rs("getPathname","setPathname")),Ts(ra,"search",Rs("getSearch","setSearch")),Ts(ra,"searchParams",Rs("getSearchParams")),Ts(ra,"hash",Rs("getHash","setHash"))),ET(ra,"toJSON",function(){return gT(this).serialize()},{enumerable:!0}),ET(ra,"toString",function(){return gT(this).serialize()},{enumerable:!0}),fg){var KO=fg.createObjectURL,YO=fg.revokeObjectURL;KO&&ET(qf,"createObjectURL",OO(KO,fg)),YO&&ET(qf,"revokeObjectURL",OO(YO,fg))}v5(qf,"URL"),m5({global:!0,forced:!_5,sham:!Mb},{URL:qf});var F5=Ft,qO=w,G5=Ur,XO=Pn,H5=uT,eA=er("URL"),W5=H5&&qO(function(){eA.canParse()}),z5=qO(function(){return eA.canParse.length!==1});F5({target:"URL",stat:!0,forced:!W5||z5},{canParse:function(e){var t=G5(arguments.length,1),i=XO(e),n=t<2||arguments[1]===void 0?void 0:XO(arguments[1]);try{return!!new eA(i,n)}catch{return!1}}});var K5=Ft,Y5=Ur,JO=Pn,q5=uT,X5=er("URL");K5({target:"URL",stat:!0,forced:!q5},{parse:function(e){var t=Y5(arguments.length,1),i=JO(e),n=t<2||arguments[1]===void 0?void 0:JO(arguments[1]);try{return new X5(i,n)}catch{return null}}});var bT=R(Dr.URL);let ZO=!0,QO=!0;function AT(e,t,i){let n=e.match(t);return n&&n.length>=i&&parseInt(n[i],10)}function Ch(e,t,i){if(!e.RTCPeerConnection)return;let n=e.RTCPeerConnection.prototype,r=n.addEventListener;n.addEventListener=function(c,l){if(c!==t)return r.apply(this,arguments);let d=h=>{let f=i(h);f&&(l.handleEvent?l.handleEvent(f):l(f))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(l,d),r.apply(this,[c,d])};let s=n.removeEventListener;n.removeEventListener=function(c,l){if(c!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(l))return s.apply(this,arguments);let d=this._eventMap[t].get(l);return this._eventMap[t].delete(l),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[c,d])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(c){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),c&&this.addEventListener(t,this["_on"+t]=c)},enumerable:!0,configurable:!0})}function J5(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(ZO=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Z5(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(QO=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function $O(){if(typeof window=="object"){if(ZO)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function tA(e,t){QO&&console.warn(e+" is deprecated, please use "+t+" instead.")}function e1(e){return Object.prototype.toString.call(e)==="[object Object]"}function t1(e){var t;return e1(e)?xr(t=Object.keys(e)).call(t,function(i,n){let r=e1(e[n]),s=r?t1(e[n]):e[n],c=r&&!Object.keys(s).length;return s===void 0||c?i:Object.assign(i,{[n]:s})},{}):e}function iA(e,t,i){t&&!i.has(t.id)&&(i.set(t.id,t),Object.keys(t).forEach(n=>{n.endsWith("Id")?iA(e,e.get(t[n]),i):n.endsWith("Ids")&&t[n].forEach(r=>{iA(e,e.get(r),i)})}))}function i1(e,t,i){let n=i?"outbound-rtp":"inbound-rtp",r=new Map;if(t===null)return r;let s=[];return e.forEach(c=>{c.type==="track"&&c.trackIdentifier===t.id&&s.push(c)}),s.forEach(c=>{e.forEach(l=>{l.type===n&&l.trackId===c.id&&iA(e,l,r)})}),r}let n1=$O;function r1(e,t){let i=e&&e.navigator;if(!i.mediaDevices)return;let n=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;let l={};return Object.keys(c).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;let h=typeof c[d]=="object"?c[d]:{ideal:c[d]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);let f=function(E,S){return E?E+S.charAt(0).toUpperCase()+S.slice(1):S==="deviceId"?"sourceId":S};if(h.ideal!==void 0){l.optional=l.optional||[];let E={};typeof h.ideal=="number"?(E[f("min",d)]=h.ideal,l.optional.push(E),E={},E[f("max",d)]=h.ideal,l.optional.push(E)):(E[f("",d)]=h.ideal,l.optional.push(E))}h.exact!==void 0&&typeof h.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[f("",d)]=h.exact):["min","max"].forEach(E=>{h[E]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[f(E,d)]=h[E])})}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},r=function(c,l){if(t.version>=61)return l(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){let d=function(h,f,E){f in h&&!(E in h)&&(h[E]=h[f],delete h[f])};d((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),d(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=n(c.audio)}if(c&&typeof c.video=="object"){let d=c.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});let h=t.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||h)){let f;if(delete c.video.facingMode,d.exact==="environment"||d.ideal==="environment"?f=["back","rear"]:d.exact!=="user"&&d.ideal!=="user"||(f=["front"]),f)return i.mediaDevices.enumerateDevices().then(E=>{E=E.filter(y=>y.kind==="videoinput");let S=E.find(y=>f.some(D=>{var O;return Ce(O=y.label.toLowerCase()).call(O,D)}));return!S&&E.length&&Ce(f).call(f,"back")&&(S=E[E.length-1]),S&&(c.video.deviceId=d.exact?{exact:S.deviceId}:{ideal:S.deviceId}),c.video=n(c.video),n1("chrome: "+JSON.stringify(c)),l(c)})}c.video=n(c.video)}return n1("chrome: "+JSON.stringify(c)),l(c)},s=function(c){return t.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(c,l,d){r(c,h=>{i.webkitGetUserMedia(h,l,f=>{d&&d(s(f))})})}).bind(i),i.mediaDevices.getUserMedia){let c=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(l){return r(l,d=>c(d).then(h=>{if(d.audio&&!h.getAudioTracks().length||d.video&&!h.getVideoTracks().length)throw h.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return h},h=>Ie.reject(s(h))))}}}function a1(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function s1(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===n.track.id):{track:n.track};let s=new Event("track");s.track=n.track,s.receiver=r,s.transceiver={receiver:r},s.streams=[i.stream],this.dispatchEvent(s)}),i.stream.getTracks().forEach(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===n.id):{track:n};let s=new Event("track");s.track=n,s.receiver=r,s.transceiver={receiver:r},s.streams=[i.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Ch(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function o1(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(c,l){let d=r.apply(this,arguments);return d||(d=t(this,c),this._senders.push(d)),d};let s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(c){s.apply(this,arguments);let l=this._senders.indexOf(c);l!==-1&&this._senders.splice(l,1)}}let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(s=>{this._senders.push(t(this,s))})};let n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],n.apply(this,[r]),r.getTracks().forEach(s=>{let c=this._senders.find(l=>l.track===s);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let i=t.apply(this,[]);return i.forEach(n=>n._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function c1(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[i,n,r]=arguments;if(arguments.length>0&&typeof i=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof i!="function"))return t.apply(this,[]);let s=function(l){let d={};return l.result().forEach(h=>{let f={id:h.id,timestamp:h.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type};h.names().forEach(E=>{f[E]=h.stat(E)}),d[f.id]=f}),d},c=function(l){return new Map(Object.keys(l).map(d=>[d,l[d]]))};if(arguments.length>=2){let l=function(d){n(c(s(d)))};return t.apply(this,[l,i])}return new Ie((l,d)=>{t.apply(this,[function(h){l(c(s(h)))},d])}).then(n,r)}}function l1(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){let r=i.apply(this,[]);return r.forEach(s=>s._pc=this),r});let n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let r=n.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){let r=this;return this._pc.getStats().then(s=>i1(s,r.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){let n=i.apply(this,[]);return n.forEach(r=>r._pc=this),n}),Ch(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){let n=this;return this._pc.getStats().then(r=>i1(r,n.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let i=arguments[0],n,r,s;return this.getSenders().forEach(c=>{c.track===i&&(n?s=!0:n=c)}),this.getReceivers().forEach(c=>(c.track===i&&(r?s=!0:r=c),c.track===i)),s||n&&r?Ie.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():r?r.getStats():Ie.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function d1(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,c){if(!c)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let l=t.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(l)===-1&&this._shimmedLocalStreams[c.id].push(l):this._shimmedLocalStreams[c.id]=[c,l],l};let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(d=>{if(this.getSenders().find(h=>h.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});let c=this.getSenders();i.apply(this,arguments);let l=this.getSenders().filter(d=>c.indexOf(d)===-1);this._shimmedLocalStreams[s.id]=[s].concat(l)};let n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],n.apply(this,arguments)};let r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(c=>{let l=this._shimmedLocalStreams[c].indexOf(s);l!==-1&&this._shimmedLocalStreams[c].splice(l,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),r.apply(this,arguments)}}function u1(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return d1(e);let i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let d=i.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(h=>this._reverseStreams[h.id])};let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(h=>{if(this.getSenders().find(f=>f.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){let h=new e.MediaStream(d.getTracks());this._streams[d.id]=h,this._reverseStreams[h.id]=d,d=h}n.apply(this,[d])};let r=e.RTCPeerConnection.prototype.removeStream;function s(d,h){let f=h.sdp;return Object.keys(d._reverseStreams||[]).forEach(E=>{let S=d._reverseStreams[E],y=d._streams[S.id];f=f.replace(new RegExp(y.id,"g"),S.id)}),new RTCSessionDescription({type:h.type,sdp:f})}e.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},e.RTCPeerConnection.prototype.addTrack=function(d,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(S=>S===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(S=>S.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let E=this._streams[h.id];if(E)E.addTrack(d),Ie.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let S=new e.MediaStream([d]);this._streams[h.id]=S,this._reverseStreams[S.id]=h,this.addStream(S)}return this.getSenders().find(S=>S.track===d)},["createOffer","createAnswer"].forEach(function(d){let h=e.RTCPeerConnection.prototype[d],f={[d](){let E=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[S=>{let y=s(this,S);E[0].apply(null,[y])},S=>{E[1]&&E[1].apply(null,S)},arguments[2]]):h.apply(this,arguments).then(S=>s(this,S))}};e.RTCPeerConnection.prototype[d]=f[d]});let c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(d,h){let f=h.sdp;return Object.keys(d._reverseStreams||[]).forEach(E=>{let S=d._reverseStreams[E],y=d._streams[S.id];f=f.replace(new RegExp(S.id,"g"),y.id)}),new RTCSessionDescription({type:h.type,sdp:f})})(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};let l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let d=l.get.apply(this);return d.type===""?d:s(this,d)}}),e.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(d._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let h;this._streams=this._streams||{},Object.keys(this._streams).forEach(f=>{this._streams[f].getTracks().find(E=>d.track===E)&&(h=this._streams[f])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function nA(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){let n=e.RTCPeerConnection.prototype[i],r={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=r[i]})}function h1(e,t){Ch(e,"negotiationneeded",i=>{let n=i.target;if(!(t.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics==="plan-b")||n.signalingState==="stable")return i})}var p1=Object.freeze({__proto__:null,fixNegotiationNeeded:h1,shimAddTrackRemoveTrack:u1,shimAddTrackRemoveTrackWithNative:d1,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then(n=>{let r=i.video&&i.video.width,s=i.video&&i.video.height,c=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxFrameRate:c||3}},r&&(i.video.mandatory.maxWidth=r),s&&(i.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:o1,shimGetStats:c1,shimGetUserMedia:r1,shimMediaStream:a1,shimOnTrack:s1,shimPeerConnection:nA,shimSenderReceiverGetStats:l1});function f1(e,t){let i=e&&e.navigator,n=e&&e.MediaStreamTrack;if(i.getUserMedia=function(r,s,c){tA("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(r).then(s,c)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){let r=function(c,l,d){l in c&&!(d in c)&&(c[d]=c[l],delete c[l])},s=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),r(c.audio,"autoGainControl","mozAutoGainControl"),r(c.audio,"noiseSuppression","mozNoiseSuppression")),s(c)},n&&n.prototype.getSettings){let c=n.prototype.getSettings;n.prototype.getSettings=function(){let l=c.apply(this,arguments);return r(l,"mozAutoGainControl","autoGainControl"),r(l,"mozNoiseSuppression","noiseSuppression"),l}}if(n&&n.prototype.applyConstraints){let c=n.prototype.applyConstraints;n.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),r(l,"autoGainControl","mozAutoGainControl"),r(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function m1(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function rA(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){let s=e.RTCPeerConnection.prototype[r],c={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=c[r]});let i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[r,s,c]=arguments;return n.apply(this,[r||null]).then(l=>{if(t.version<53&&!s)try{l.forEach(d=>{d.type=i[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;l.forEach((h,f)=>{l.set(f,Object.assign({},h,{type:i[h.type]||h.type}))})}return l}).then(s,c)}}function _1(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n});let i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){let n=i.apply(this,arguments);return n._pc=this,n}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Ie.resolve(new Map)}}function E1(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let i=t.apply(this,[]);return i.forEach(n=>n._pc=this),i}),Ch(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function g1(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){tA("removeStream","removeTrack"),this.getSenders().forEach(i=>{var n;i.track&&Ce(n=t.getTracks()).call(n,i.track)&&this.removeTrack(i)})})}function S1(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function v1(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];let n=i.length>0;n&&i.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let r=t.apply(this,arguments);if(n){let{sender:s}=r,c=s.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=i,s.sendEncodings=i,this.setParametersPromises.push(s.setParameters(c).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return r})}function T1(e){if(typeof e!="object"||!e.RTCRtpSender)return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let i=t.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function y1(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ie.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function R1(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ie.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var C1=Object.freeze({__proto__:null,shimAddTransceiver:v1,shimCreateAnswer:R1,shimCreateOffer:y1,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){let n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Ie.reject(n)}return i.video===!0?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:T1,shimGetUserMedia:f1,shimOnTrack:m1,shimPeerConnection:rA,shimRTCDataChannel:S1,shimReceiverGetStats:E1,shimRemoveStream:g1,shimSenderGetStats:_1});function b1(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){var n;this._localStreams||(this._localStreams=[]),Ce(n=this._localStreams).call(n,i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>t.call(this,r,i)),i.getVideoTracks().forEach(r=>t.call(this,r,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return r&&r.forEach(c=>{var l;this._localStreams?Ce(l=this._localStreams).call(l,c)||this._localStreams.push(c):this._localStreams=[c]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);let i=this._localStreams.indexOf(t);if(i===-1)return;this._localStreams.splice(i,1);let n=t.getTracks();this.getSenders().forEach(r=>{Ce(n).call(n,r.track)&&this.removeTrack(r)})})}}function A1(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(r=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),Ce(s=this._remoteStreams).call(s,r))return;this._remoteStreams.push(r);let c=new Event("addstream");c.stream=r,this.dispatchEvent(c)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(r=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(r)>=0)return;i._remoteStreams.push(r);let s=new Event("addstream");s.stream=r,i.dispatchEvent(s)})}),t.apply(i,arguments)}}}function w1(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,i=t.createOffer,n=t.createAnswer,r=t.setLocalDescription,s=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(d,h){let f=arguments.length>=2?arguments[2]:arguments[0],E=i.apply(this,[f]);return h?(E.then(d,h),Ie.resolve()):E},t.createAnswer=function(d,h){let f=arguments.length>=2?arguments[2]:arguments[0],E=n.apply(this,[f]);return h?(E.then(d,h),Ie.resolve()):E};let l=function(d,h,f){let E=r.apply(this,[d]);return f?(E.then(h,f),Ie.resolve()):E};t.setLocalDescription=l,l=function(d,h,f){let E=s.apply(this,[d]);return f?(E.then(h,f),Ie.resolve()):E},t.setRemoteDescription=l,l=function(d,h,f){let E=c.apply(this,[d]);return f?(E.then(h,f),Ie.resolve()):E},t.addIceCandidate=l}function I1(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let i=t.mediaDevices,n=i.getUserMedia.bind(i);t.mediaDevices.getUserMedia=r=>n(O1(r))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(i,n,r){t.mediaDevices.getUserMedia(i).then(n,r)}).bind(t))}function O1(e){return e&&e.video!==void 0?Object.assign({},e,{video:t1(e.video)}):e}function N1(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(i,n){if(i&&i.iceServers){let r=[];for(let s=0;s<i.iceServers.length;s++){let c=i.iceServers[s];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(tA("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,r.push(c)):r.push(i.iceServers[s])}i.iceServers=r}return new t(i,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function D1(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function L1(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);let n=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):i.offerToReceiveAudio!==!0||n||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);let r=this.getTransceivers().find(s=>s.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveVideo!==!0||r||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function P1(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var x1=Object.freeze({__proto__:null,shimAudioContext:P1,shimCallbacksAPI:w1,shimConstraints:O1,shimCreateOfferLegacy:L1,shimGetUserMedia:I1,shimLocalStreamsAPI:b1,shimRTCIceServerUrls:N1,shimRemoteStreamsAPI:A1,shimTrackEventTransceiver:D1}),k1=`	
\v\f\r \u2028\u2029\uFEFF`,Q5=Vs,$5=Pn,aA=k1,M1=z("".replace),e6=RegExp("^["+aA+"]+"),t6=RegExp("(^|[^"+aA+"])["+aA+"]+$"),i6=function(e){return function(t){var i=$5(Q5(t));return i=M1(i,e6,""),i=M1(i,t6,"$1"),i}},n6={trim:i6()},r6=Zc.PROPER,a6=w,U1=k1,s6=n6.trim;Ft({target:"String",proto:!0,forced:(function(e){return a6(function(){return!!U1[e]()||""[e]()!==""||r6&&U1[e].name!==e})})("trim")},{trim:function(){return s6(this)}});var o6=Xr("String","trim"),c6=ce,l6=o6,sA=String.prototype,d6=function(e){var t=e.trim;return typeof e=="string"||e===sA||c6(sA,e)&&t===sA.trim?l6:t},rr=R(d6),V1={exports:{}};(function(e){let t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(i){return i.trim().split(`
`).map(n=>n.trim())},t.splitSections=function(i){return i.split(`
m=`).map((n,r)=>(r>0?"m="+n:n).trim()+`\r
`)},t.getDescription=function(i){let n=t.splitSections(i);return n&&n[0]},t.getMediaSections=function(i){let n=t.splitSections(i);return n.shift(),n},t.matchPrefix=function(i,n){return t.splitLines(i).filter(r=>r.indexOf(n)===0)},t.parseCandidate=function(i){let n;n=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");let r={foundation:n[0],component:{1:"rtp",2:"rtcp"}[n[1]]||n[1],protocol:n[2].toLowerCase(),priority:parseInt(n[3],10),ip:n[4],address:n[4],port:parseInt(n[5],10),type:n[7]};for(let s=8;s<n.length;s+=2)switch(n[s]){case"raddr":r.relatedAddress=n[s+1];break;case"rport":r.relatedPort=parseInt(n[s+1],10);break;case"tcptype":r.tcpType=n[s+1];break;case"ufrag":r.ufrag=n[s+1],r.usernameFragment=n[s+1];break;default:r[n[s]]===void 0&&(r[n[s]]=n[s+1])}return r},t.writeCandidate=function(i){let n=[];n.push(i.foundation);let r=i.component;r==="rtp"?n.push(1):r==="rtcp"?n.push(2):n.push(r),n.push(i.protocol.toUpperCase()),n.push(i.priority),n.push(i.address||i.ip),n.push(i.port);let s=i.type;return n.push("typ"),n.push(s),s!=="host"&&i.relatedAddress&&i.relatedPort&&(n.push("raddr"),n.push(i.relatedAddress),n.push("rport"),n.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(n.push("tcptype"),n.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(n.push("ufrag"),n.push(i.usernameFragment||i.ufrag)),"candidate:"+n.join(" ")},t.parseIceOptions=function(i){return i.substring(14).split(" ")},t.parseRtpMap=function(i){let n=i.substring(9).split(" "),r={payloadType:parseInt(n.shift(),10)};return n=n[0].split("/"),r.name=n[0],r.clockRate=parseInt(n[1],10),r.channels=n.length===3?parseInt(n[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(i){let n=i.payloadType;i.preferredPayloadType!==void 0&&(n=i.preferredPayloadType);let r=i.channels||i.numChannels||1;return"a=rtpmap:"+n+" "+i.name+"/"+i.clockRate+(r!==1?"/"+r:"")+`\r
`},t.parseExtmap=function(i){let n=i.substring(9).split(" ");return{id:parseInt(n[0],10),direction:n[0].indexOf("/")>0?n[0].split("/")[1]:"sendrecv",uri:n[1],attributes:n.slice(2).join(" ")}},t.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},t.parseFmtp=function(i){let n={},r,s=i.substring(i.indexOf(" ")+1).split(";");for(let c=0;c<s.length;c++)r=s[c].trim().split("="),n[r[0].trim()]=r[1];return n},t.writeFmtp=function(i){let n="",r=i.payloadType;if(i.preferredPayloadType!==void 0&&(r=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){let s=[];Object.keys(i.parameters).forEach(c=>{i.parameters[c]!==void 0?s.push(c+"="+i.parameters[c]):s.push(c)}),n+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return n},t.parseRtcpFb=function(i){let n=i.substring(i.indexOf(" ")+1).split(" ");return{type:n.shift(),parameter:n.join(" ")}},t.writeRtcpFb=function(i){let n="",r=i.payloadType;return i.preferredPayloadType!==void 0&&(r=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(s=>{n+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),n},t.parseSsrcMedia=function(i){let n=i.indexOf(" "),r={ssrc:parseInt(i.substring(7,n),10)},s=i.indexOf(":",n);return s>-1?(r.attribute=i.substring(n+1,s),r.value=i.substring(s+1)):r.attribute=i.substring(n+1),r},t.parseSsrcGroup=function(i){let n=i.substring(13).split(" ");return{semantics:n.shift(),ssrcs:n.map(r=>parseInt(r,10))}},t.getMid=function(i){let n=t.matchPrefix(i,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(i){let n=i.substring(14).split(" ");return{algorithm:n[0].toLowerCase(),value:n[1].toUpperCase()}},t.getDtlsParameters=function(i,n){return{role:"auto",fingerprints:t.matchPrefix(i+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(i,n){let r="a=setup:"+n+`\r
`;return i.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},t.parseCryptoLine=function(i){let n=i.substring(9).split(" ");return{tag:parseInt(n[0],10),cryptoSuite:n[1],keyParams:n[2],sessionParams:n.slice(3)}},t.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?t.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;let n=i.substring(7).split("|");return{keyMethod:"inline",keySalt:n[0],lifeTime:n[1],mkiValue:n[2]?n[2].split(":")[0]:void 0,mkiLength:n[2]?n[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},t.getCryptoParameters=function(i,n){return t.matchPrefix(i+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(i,n){let r=t.matchPrefix(i+n,"a=ice-ufrag:")[0],s=t.matchPrefix(i+n,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},t.writeIceParameters=function(i){let n="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(n+=`a=ice-lite\r
`),n},t.parseRtpParameters=function(i){let n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(i)[0].split(" ");n.profile=r[2];for(let c=3;c<r.length;c++){let l=r[c],d=t.matchPrefix(i,"a=rtpmap:"+l+" ")[0];if(d){let h=t.parseRtpMap(d),f=t.matchPrefix(i,"a=fmtp:"+l+" ");switch(h.parameters=f.length?t.parseFmtp(f[0]):{},h.rtcpFeedback=t.matchPrefix(i,"a=rtcp-fb:"+l+" ").map(t.parseRtcpFb),n.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(h.name.toUpperCase())}}}t.matchPrefix(i,"a=extmap:").forEach(c=>{n.headerExtensions.push(t.parseExtmap(c))});let s=t.matchPrefix(i,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach(c=>{s.forEach(l=>{c.rtcpFeedback.find(d=>d.type===l.type&&d.parameter===l.parameter)||c.rtcpFeedback.push(l)})}),n},t.writeRtpDescription=function(i,n){let r="";r+="m="+i+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,n.codecs.forEach(c=>{r+=t.writeRtpMap(c),r+=t.writeFmtp(c),r+=t.writeRtcpFb(c)});let s=0;return n.codecs.forEach(c=>{c.maxptime>s&&(s=c.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),n.headerExtensions&&n.headerExtensions.forEach(c=>{r+=t.writeExtmap(c)}),r},t.parseRtpEncodingParameters=function(i){let n=[],r=t.parseRtpParameters(i),s=r.fecMechanisms.indexOf("RED")!==-1,c=r.fecMechanisms.indexOf("ULPFEC")!==-1,l=t.matchPrefix(i,"a=ssrc:").map(S=>t.parseSsrcMedia(S)).filter(S=>S.attribute==="cname"),d=l.length>0&&l[0].ssrc,h,f=t.matchPrefix(i,"a=ssrc-group:FID").map(S=>S.substring(17).split(" ").map(y=>parseInt(y,10)));f.length>0&&f[0].length>1&&f[0][0]===d&&(h=f[0][1]),r.codecs.forEach(S=>{if(S.name.toUpperCase()==="RTX"&&S.parameters.apt){let y={ssrc:d,codecPayloadType:parseInt(S.parameters.apt,10)};d&&h&&(y.rtx={ssrc:h}),n.push(y),s&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:d,mechanism:c?"red+ulpfec":"red"},n.push(y))}}),n.length===0&&d&&n.push({ssrc:d});let E=t.matchPrefix(i,"b=");return E.length&&(E=E[0].indexOf("b=TIAS:")===0?parseInt(E[0].substring(7),10):E[0].indexOf("b=AS:")===0?1e3*parseInt(E[0].substring(5),10)*.95-16e3:void 0,n.forEach(S=>{S.maxBitrate=E})),n},t.parseRtcpParameters=function(i){let n={},r=t.matchPrefix(i,"a=ssrc:").map(l=>t.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);let s=t.matchPrefix(i,"a=rtcp-rsize");n.reducedSize=s.length>0,n.compound=s.length===0;let c=t.matchPrefix(i,"a=rtcp-mux");return n.mux=c.length>0,n},t.writeRtcpParameters=function(i){let n="";return i.reducedSize&&(n+=`a=rtcp-rsize\r
`),i.mux&&(n+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(n+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),n},t.parseMsid=function(i){let n,r=t.matchPrefix(i,"a=msid:");if(r.length===1)return n=r[0].substring(7).split(" "),{stream:n[0],track:n[1]};let s=t.matchPrefix(i,"a=ssrc:").map(c=>t.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");return s.length>0?(n=s[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(i){let n=t.parseMLine(i),r=t.matchPrefix(i,"a=max-message-size:"),s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);let c=t.matchPrefix(i,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:n.fmt,maxMessageSize:s};let l=t.matchPrefix(i,"a=sctpmap:");if(l.length>0){let d=l[0].substring(10).split(" ");return{port:parseInt(d[0],10),protocol:d[1],maxMessageSize:s}}},t.writeSctpDescription=function(i,n){let r=[];return r=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+n.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+n.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+n.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+n.port+" "+n.protocol+` 65535\r
`],n.maxMessageSize!==void 0&&r.push("a=max-message-size:"+n.maxMessageSize+`\r
`),r.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(i,n,r){let s,c=n!==void 0?n:2;return s=i||t.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(i,n){let r=t.splitLines(i);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(i){return t.splitLines(i)[0].split(" ")[0].substring(2)},t.isRejected=function(i){return i.split(" ",2)[1]==="0"},t.parseMLine=function(i){let n=t.splitLines(i)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(i){let n=t.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;let n=t.splitLines(i);for(let r=0;r<n.length;r++)if(n[r].length<2||n[r].charAt(1)!=="=")return!1;return!0},e.exports=t})(V1);var j1=V1.exports,Xf=R(j1),u6=g({__proto__:null,default:Xf},[j1]);function wT(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){let n=new t(i),r=Xf.parseCandidate(i.candidate),s=Object.assign(n,r);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(i)},e.RTCIceCandidate.prototype=t.prototype,Ch(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function oA(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Ch(e,"icecandidate",t=>{if(t.candidate){let i=Xf.parseCandidate(t.candidate.candidate);i.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return t})}function IT(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let i=function(l){if(!l||!l.sdp)return!1;let d=Xf.splitSections(l.sdp);return d.shift(),d.some(h=>{let f=Xf.parseMLine(h);return f&&f.kind==="application"&&f.protocol.indexOf("SCTP")!==-1})},n=function(l){let d=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(d===null||d.length<2)return-1;let h=parseInt(d[1],10);return h!=h?-1:h},r=function(l){let d=65536;return t.browser==="firefox"&&(d=t.version<57?l===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),d},s=function(l,d){let h=65536;t.browser==="firefox"&&t.version===57&&(h=65535);let f=Xf.matchPrefix(l.sdp,"a=max-message-size:");return f.length>0?h=parseInt(f[0].substr(19),10):t.browser==="firefox"&&d!==-1&&(h=2147483637),h},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){let{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){let l=n(arguments[0]),d=r(l),h=s(arguments[0],l),f;f=d===0&&h===0?Number.POSITIVE_INFINITY:d===0||h===0?Math.max(d,h):Math.min(d,h);let E={};Object.defineProperty(E,"maxMessageSize",{get:()=>f}),this._sctp=E}return c.apply(this,arguments)}}function OT(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(n,r){let s=n.send;n.send=function(){let c=arguments[0],l=c.length||c.size||c.byteLength;if(n.readyState==="open"&&r.sctp&&l>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(n,arguments)}}let i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let n=i.apply(this,arguments);return t(n,this),n},Ch(e,"datachannel",n=>(t(n.channel,n.target),n))}function cA(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{let n=t[i];t[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{let s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;let c=new Event("connectionstatechange",r);s.dispatchEvent(c)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function lA(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;let i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let r=n.sdp.split(`
`).filter(s=>rr(s).call(s)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&n instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:n.type,sdp:r}):n.sdp=r}return i.apply(this,arguments)}}function NT(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Ie.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Ie.resolve())})}function DT(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let n=arguments[0]||{};if(typeof n!="object"||n.type&&n.sdp)return i.apply(this,arguments);if(n={type:n.type,sdp:n.sdp},!n.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n.type="offer";break;default:n.type="answer"}return n.sdp||n.type!=="offer"&&n.type!=="answer"?i.apply(this,[n]):(n.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(r=>i.apply(this,[r]))})}var h6=Object.freeze({__proto__:null,removeExtmapAllowMixed:lA,shimAddIceCandidateNullOrEmpty:NT,shimConnectionState:cA,shimMaxMessageSize:IT,shimParameterlessSetLocalDescription:DT,shimRTCIceCandidate:wT,shimRTCIceCandidateRelayProtocol:oA,shimSendThrowTypeError:OT});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},i=$O,n=(function(s){let c={browser:null,version:null};if(s===void 0||!s.navigator)return c.browser="Not a browser.",c;let{navigator:l}=s;if(l.mozGetUserMedia)c.browser="firefox",c.version=AT(l.userAgent,/Firefox\/(\d+)\./,1);else if(l.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)c.browser="chrome",c.version=AT(l.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!l.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=AT(l.userAgent,/AppleWebKit\/(\d+)\./,1),c.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return c})(e),r={browserDetails:n,commonShim:h6,extractVersion:AT,disableLog:J5,disableWarnings:Z5,sdp:u6};switch(n.browser){case"chrome":if(!p1||!nA||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),r;if(n.version===null)return i("Chrome shim can not determine version, not shimming."),r;i("adapter.js shimming chrome."),r.browserShim=p1,NT(e,n),DT(e),r1(e,n),a1(e),nA(e,n),s1(e),u1(e,n),o1(e),c1(e),l1(e),h1(e,n),wT(e),oA(e),cA(e),IT(e,n),OT(e),lA(e,n);break;case"firefox":if(!C1||!rA||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),r;i("adapter.js shimming firefox."),r.browserShim=C1,NT(e,n),DT(e),f1(e,n),rA(e,n),m1(e),g1(e),_1(e),E1(e),S1(e),v1(e),T1(e),y1(e),R1(e),wT(e),cA(e),IT(e,n),OT(e);break;case"safari":if(!x1||!t.shimSafari)return i("Safari shim is not included in this adapter release."),r;i("adapter.js shimming safari."),r.browserShim=x1,NT(e,n),DT(e),N1(e),L1(e),w1(e),b1(e),A1(e),D1(e),I1(e),P1(e),wT(e),oA(e),IT(e,n),OT(e),lA(e,n);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var dA=ae;Ft({global:!0,forced:dA.globalThis!==dA},{globalThis:dA});var B1=R(ae),uA={exports:{}};(function(e,t){(function(i,n){var r="function",s="undefined",c="object",l="string",d="major",h="model",f="name",E="type",S="vendor",y="version",D="architecture",O="console",N="mobile",k="tablet",U="smarttv",B="wearable",J="embedded",K="Amazon",H="Apple",ee="ASUS",ue="BlackBerry",me="Browser",ye="Chrome",pt="Firefox",mt="Google",nt="Huawei",jt="LG",Mt="Microsoft",Hn="Motorola",pe="Opera",Ae="Samsung",Me="Sharp",Ee="Sony",I="Xiaomi",G="Zebra",X="Facebook",Re="Chromium OS",dt="Mac OS",li=" Browser",Qi=function(Yi){for(var $i={},di=0;di<Yi.length;di++)$i[Yi[di].toUpperCase()]=Yi[di];return $i},is=function(Yi,$i){return typeof Yi===l&&Us($i).indexOf(Us(Yi))!==-1},Us=function(Yi){return Yi.toLowerCase()},R0=function(Yi,$i){if(typeof Yi===l)return Yi=Yi.replace(/^\s\s*/,""),typeof $i===s?Yi:Yi.substring(0,500)},Qh=function(Yi,$i){for(var di,zr,vo,Vi,bl,Ot,To=0;To<$i.length&&!bl;){var $h=$i[To],Tc=$i[To+1];for(di=zr=0;di<$h.length&&!bl&&$h[di];)if(bl=$h[di++].exec(Yi))for(vo=0;vo<Tc.length;vo++)Ot=bl[++zr],typeof(Vi=Tc[vo])===c&&Vi.length>0?Vi.length===2?typeof Vi[1]==r?this[Vi[0]]=Vi[1].call(this,Ot):this[Vi[0]]=Vi[1]:Vi.length===3?typeof Vi[1]!==r||Vi[1].exec&&Vi[1].test?this[Vi[0]]=Ot?Ot.replace(Vi[1],Vi[2]):n:this[Vi[0]]=Ot?Vi[1].call(this,Ot,Vi[2]):n:Vi.length===4&&(this[Vi[0]]=Ot?Vi[3].call(this,Ot.replace(Vi[1],Vi[2])):n):this[Vi]=Ot||n;To+=2}},Gm=function(Yi,$i){for(var di in $i)if(typeof $i[di]===c&&$i[di].length>0){for(var zr=0;zr<$i[di].length;zr++)if(is($i[di][zr],Yi))return di==="?"?n:di}else if(is($i[di],Yi))return di==="?"?n:di;return $i.hasOwnProperty("*")?$i["*"]:Yi},DR={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},LR={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[f,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[f,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[f,y],[/opios[\/ ]+([\w\.]+)/i],[y,[f,pe+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[y,[f,pe+" GX"]],[/\bopr\/([\w\.]+)/i],[y,[f,pe]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[y,[f,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[y,[f,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[f,y],[/quark(?:pc)?\/([-\w\.]+)/i],[y,[f,"Quark"]],[/\bddg\/([\w\.]+)/i],[y,[f,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[f,"UC"+me]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[y,[f,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[f,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[f,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[y,[f,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[y,[f,"Smart Lenovo "+me]],[/(avast|avg)\/([\w\.]+)/i],[[f,/(.+)/,"$1 Secure "+me],y],[/\bfocus\/([\w\.]+)/i],[y,[f,pt+" Focus"]],[/\bopt\/([\w\.]+)/i],[y,[f,pe+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[f,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[f,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[f,pe+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[f,"MIUI"+li]],[/fxios\/([\w\.-]+)/i],[y,[f,pt]],[/\bqihoobrowser\/?([\w\.]*)/i],[y,[f,"360"]],[/\b(qq)\/([\w\.]+)/i],[[f,/(.+)/,"$1Browser"],y],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[f,/(.+)/,"$1"+li],y],[/samsungbrowser\/([\w\.]+)/i],[y,[f,Ae+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[y,[f,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[f,"Sogou Mobile"],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[f,y],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[f],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[y,f],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[f,X],y],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[f,y],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[f,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[y,[f,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[f,ye+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[f,ye+" WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[f,"Android "+me]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[f,y],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[y,[f,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[y,f],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[f,[y,Gm,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[f,y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[f,"Netscape"],y],[/(wolvic|librewolf)\/([\w\.]+)/i],[f,y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[f,pt+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[f,[y,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[f,[y,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[D,"amd64"]],[/(ia32(?=;))/i],[[D,Us]],[/((?:i[346]|x)86)[;\)]/i],[[D,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[D,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[D,"armhf"]],[/windows (ce|mobile); ppc;/i],[[D,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[D,/ower/,"",Us]],[/(sun4\w)[;\)]/i],[[D,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[D,Us]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[S,Ae],[E,k]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[h,[S,Ae],[E,N]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[h,[S,H],[E,N]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[S,H],[E,k]],[/(macintosh);/i],[h,[S,H]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[S,Me],[E,N]],[/(?:honor)([-\w ]+)[;\)]/i],[h,[S,"Honor"],[E,N]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[h,[S,nt],[E,k]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[S,nt],[E,N]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[h,/_/g," "],[S,I],[E,N]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[h,/_/g," "],[S,I],[E,k]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[S,"OPPO"],[E,N]],[/\b(opd2\d{3}a?) bui/i],[h,[S,"OPPO"],[E,k]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[S,"Vivo"],[E,N]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[h,[S,"Realme"],[E,N]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[S,Hn],[E,N]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[S,Hn],[E,k]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[S,jt],[E,k]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[S,jt],[E,N]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[h,[S,"Lenovo"],[E,k]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[h,/_/g," "],[S,"Nokia"],[E,N]],[/(pixel c)\b/i],[h,[S,mt],[E,k]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[S,mt],[E,N]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[S,Ee],[E,N]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[S,Ee],[E,k]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[S,"OnePlus"],[E,N]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[S,K],[E,k]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[S,K],[E,N]],[/(playbook);[-\w\),; ]+(rim)/i],[h,S,[E,k]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[S,ue],[E,N]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[S,ee],[E,k]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[S,ee],[E,N]],[/(nexus 9)/i],[h,[S,"HTC"],[E,k]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[S,[h,/_/g," "],[E,N]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[h,[S,"TCL"],[E,k]],[/(itel) ((\w+))/i],[[S,Us],h,[E,Gm,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[S,"Acer"],[E,k]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[S,"Meizu"],[E,N]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[h,[S,"Ulefone"],[E,N]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[h,[S,"Energizer"],[E,N]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[h,[S,"Cat"],[E,N]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[h,[S,"Smartfren"],[E,N]],[/droid.+; (a(?:015|06[35]|142p?))/i],[h,[S,"Nothing"],[E,N]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[S,h,[E,N]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[S,h,[E,k]],[/(surface duo)/i],[h,[S,Mt],[E,k]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[S,"Fairphone"],[E,N]],[/(u304aa)/i],[h,[S,"AT&T"],[E,N]],[/\bsie-(\w*)/i],[h,[S,"Siemens"],[E,N]],[/\b(rct\w+) b/i],[h,[S,"RCA"],[E,k]],[/\b(venue[\d ]{2,7}) b/i],[h,[S,"Dell"],[E,k]],[/\b(q(?:mv|ta)\w+) b/i],[h,[S,"Verizon"],[E,k]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[S,"Barnes & Noble"],[E,k]],[/\b(tm\d{3}\w+) b/i],[h,[S,"NuVision"],[E,k]],[/\b(k88) b/i],[h,[S,"ZTE"],[E,k]],[/\b(nx\d{3}j) b/i],[h,[S,"ZTE"],[E,N]],[/\b(gen\d{3}) b.+49h/i],[h,[S,"Swiss"],[E,N]],[/\b(zur\d{3}) b/i],[h,[S,"Swiss"],[E,k]],[/\b((zeki)?tb.*\b) b/i],[h,[S,"Zeki"],[E,k]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[S,"Dragon Touch"],h,[E,k]],[/\b(ns-?\w{0,9}) b/i],[h,[S,"Insignia"],[E,k]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[S,"NextBook"],[E,k]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[S,"Voice"],h,[E,N]],[/\b(lvtel\-)?(v1[12]) b/i],[[S,"LvTel"],h,[E,N]],[/\b(ph-1) /i],[h,[S,"Essential"],[E,N]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[S,"Envizen"],[E,k]],[/\b(trio[-\w\. ]+) b/i],[h,[S,"MachSpeed"],[E,k]],[/\btu_(1491) b/i],[h,[S,"Rotor"],[E,k]],[/(shield[\w ]+) b/i],[h,[S,"Nvidia"],[E,k]],[/(sprint) (\w+)/i],[S,h,[E,N]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[S,Mt],[E,N]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[S,G],[E,k]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[S,G],[E,N]],[/smart-tv.+(samsung)/i],[S,[E,U]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[S,Ae],[E,U]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[S,jt],[E,U]],[/(apple) ?tv/i],[S,[h,H+" TV"],[E,U]],[/crkey/i],[[h,ye+"cast"],[S,mt],[E,U]],[/droid.+aft(\w+)( bui|\))/i],[h,[S,K],[E,U]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[S,Me],[E,U]],[/(bravia[\w ]+)( bui|\))/i],[h,[S,Ee],[E,U]],[/(mitv-\w{5}) bui/i],[h,[S,I],[E,U]],[/Hbbtv.*(technisat) (.*);/i],[S,h,[E,U]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[S,R0],[h,R0],[E,U]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[E,U]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[S,h,[E,O]],[/droid.+; (shield) bui/i],[h,[S,"Nvidia"],[E,O]],[/(playstation [345portablevi]+)/i],[h,[S,Ee],[E,O]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[S,Mt],[E,O]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[h,[S,Ae],[E,B]],[/((pebble))app/i],[S,h,[E,B]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[S,H],[E,B]],[/droid.+; (glass) \d/i],[h,[S,mt],[E,B]],[/droid.+; (wt63?0{2,3})\)/i],[h,[S,G],[E,B]],[/droid.+; (glass) \d/i],[h,[S,mt],[E,B]],[/(pico) (4|neo3(?: link|pro)?)/i],[S,h,[E,B]],[/; (quest( \d| pro)?)/i],[h,[S,X],[E,B]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[S,[E,J]],[/(aeobc)\b/i],[h,[S,K],[E,J]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[h,[E,N]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[E,k]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[E,k]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[E,N]],[/(android[-\w\. ]{0,9});.+buil/i],[h,[S,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[f,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[f,y],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[f,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[f,y],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,f]],os:[[/microsoft (windows) (vista|xp)/i],[f,y],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[f,[y,Gm,DR]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[y,Gm,DR],[f,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[f,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[f,dt],[y,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[y,f],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[f,y],[/\(bb(10);/i],[y,[f,ue]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[y,[f,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[f,pt+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[f,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[y,[f,"watchOS"]],[/crkey\/([\d\.]+)/i],[y,[f,ye+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[f,Re],y],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[f,y],[/(sunos) ?([\w\.\d]*)/i],[[f,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[f,y]]},ns=function(Yi,$i){if(typeof Yi===c&&($i=Yi,Yi=n),!(this instanceof ns))return new ns(Yi,$i).getResult();var di=typeof i!==s&&i.navigator?i.navigator:n,zr=Yi||(di&&di.userAgent?di.userAgent:""),vo=di&&di.userAgentData?di.userAgentData:n,Vi=$i?(function(Ot,To){var $h={};for(var Tc in Ot)To[Tc]&&To[Tc].length%2==0?$h[Tc]=To[Tc].concat(Ot[Tc]):$h[Tc]=Ot[Tc];return $h})(LR,$i):LR,bl=di&&di.userAgent==zr;return this.getBrowser=function(){var Ot={};return Ot[f]=n,Ot[y]=n,Qh.call(Ot,zr,Vi.browser),Ot[d]=(function(To){return typeof To===l?To.replace(/[^\d\.]/g,"").split(".")[0]:n})(Ot[y]),bl&&di&&di.brave&&typeof di.brave.isBrave==r&&(Ot[f]="Brave"),Ot},this.getCPU=function(){var Ot={};return Ot[D]=n,Qh.call(Ot,zr,Vi.cpu),Ot},this.getDevice=function(){var Ot={};return Ot[S]=n,Ot[h]=n,Ot[E]=n,Qh.call(Ot,zr,Vi.device),bl&&!Ot[E]&&vo&&vo.mobile&&(Ot[E]=N),bl&&Ot[h]=="Macintosh"&&di&&typeof di.standalone!==s&&di.maxTouchPoints&&di.maxTouchPoints>2&&(Ot[h]="iPad",Ot[E]=k),Ot},this.getEngine=function(){var Ot={};return Ot[f]=n,Ot[y]=n,Qh.call(Ot,zr,Vi.engine),Ot},this.getOS=function(){var Ot={};return Ot[f]=n,Ot[y]=n,Qh.call(Ot,zr,Vi.os),bl&&!Ot[f]&&vo&&vo.platform&&vo.platform!="Unknown"&&(Ot[f]=vo.platform.replace(/chrome os/i,Re).replace(/macos/i,dt)),Ot},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return zr},this.setUA=function(Ot){return zr=typeof Ot===l&&Ot.length>500?R0(Ot,500):Ot,this},this.setUA(zr),this};ns.VERSION="0.7.40",ns.BROWSER=Qi([f,y,d]),ns.CPU=Qi([D]),ns.DEVICE=Qi([h,S,E,O,N,U,k,B,J]),ns.ENGINE=ns.OS=Qi([f,y]),e.exports&&(t=e.exports=ns),t.UAParser=ns;var Cl=typeof i!==s&&(i.jQuery||i.Zepto);if(Cl&&!Cl.ua){var PR=new ns;Cl.ua=PR.getResult(),Cl.ua.get=function(){return PR.getUA()},Cl.ua.set=function(Yi){PR.setUA(Yi);var $i=PR.getResult();for(var di in $i)Cl.ua[di]=$i[di]}}})(typeof window=="object"?window:v)})(uA,uA.exports);var p6=R(uA.exports),F1=Ga.clear;Ft({global:!0,bind:!0,forced:ae.clearImmediate!==F1},{clearImmediate:F1});var G1=ae,f6=fe,m6=Ye,_6=Xl,E6=mn,g6=yr,S6=Ur,v6=G1.Function,T6=/MSIE .\./.test(E6)||_6==="BUN"&&(function(){var e=G1.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")})(),y6=Ft,H1=ae,W1=Ga.set,R6=function(e,t){var i=1;return T6?function(n,r){var s=S6(arguments.length,1)>i,c=m6(n)?n:v6(n),l=s?g6(arguments,i):[],d=s?function(){f6(c,this,l)}:c;return e(d)}:e},z1=H1.setImmediate?R6(W1):W1;y6({global:!0,bind:!0,forced:H1.setImmediate!==z1},{setImmediate:z1});var K1=R(Dr.setImmediate),C6=ae,b6=rl,A6=_n,w6=Ur,I6=Ct;Ft({global:!0,dontCallGetSet:!0,forced:w(function(){return I6&&Object.getOwnPropertyDescriptor(C6,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){w6(arguments.length,1),b6(A6(e))}});var Y1=R(Dr.queueMicrotask);function q1(e,t){return function(){return e.apply(t,arguments)}}let{toString:O6}=Object.prototype,{getPrototypeOf:hA}=Object,{iterator:LT,toStringTag:X1}=Symbol,PT=(pA=Object.create(null),e=>{let t=O6.call(e);return pA[t]||(pA[t]=t.slice(8,-1).toLowerCase())});var pA;let ro=e=>(e=e.toLowerCase(),t=>PT(t)===e),xT=e=>t=>typeof t===e,{isArray:Jf}=Array,vg=xT("undefined"),J1=ro("ArrayBuffer"),N6=xT("string"),ga=xT("function"),Z1=xT("number"),kT=e=>e!==null&&typeof e=="object",MT=e=>{if(PT(e)!=="object")return!1;let t=hA(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||X1 in e||LT in e)},D6=ro("Date"),L6=ro("File"),P6=ro("Blob"),x6=ro("FileList"),k6=ro("URLSearchParams"),[M6,U6,V6,j6]=["ReadableStream","Request","Response","Headers"].map(ro);function Tg(e,t){let i,n,{allOwnKeys:r=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Jf(e))for(i=0,n=e.length;i<n;i++)t.call(null,e[i],i,e);else{let s=r?Object.getOwnPropertyNames(e):Object.keys(e),c=s.length,l;for(i=0;i<c;i++)l=s[i],t.call(null,e[l],l,e)}}function Q1(e,t){t=t.toLowerCase();let i=Object.keys(e),n,r=i.length;for(;r-- >0;)if(n=i[r],t===n.toLowerCase())return n;return null}let bh=B1!==void 0?B1:typeof self<"u"?self:typeof window<"u"?window:global,$1=e=>!vg(e)&&e!==bh,B6=(fA=typeof Uint8Array<"u"&&hA(Uint8Array),e=>fA&&e instanceof fA);var fA;let F6=ro("HTMLFormElement"),eN=(e=>{let{hasOwnProperty:t}=e;return(i,n)=>t.call(i,n)})(Object.prototype),G6=ro("RegExp"),tN=(e,t)=>{let i=Object.getOwnPropertyDescriptors(e),n={};Tg(i,(r,s)=>{let c;(c=t(r,s,e))!==!1&&(n[s]=c||r)}),Object.defineProperties(e,n)},H6=ro("AsyncFunction"),iN=(nN=typeof K1=="function",rN=ga(bh.postMessage),nN?K1:rN?(mA="axios@".concat(Math.random()),UT=[],bh.addEventListener("message",e=>{let{source:t,data:i}=e;t===bh&&i===mA&&UT.length&&UT.shift()()},!1),e=>{UT.push(e),bh.postMessage(mA,"*")}):e=>setTimeout(e));var nN,rN,mA,UT;let W6=Y1!==void 0?Y1.bind(bh):typeof process<"u"&&process.nextTick||iN;var Oe={isArray:Jf,isArrayBuffer:J1,isBuffer:function(e){return e!==null&&!vg(e)&&e.constructor!==null&&!vg(e.constructor)&&ga(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||ga(e.append)&&((t=PT(e))==="formdata"||t==="object"&&ga(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&J1(e.buffer),t},isString:N6,isNumber:Z1,isBoolean:e=>e===!0||e===!1,isObject:kT,isPlainObject:MT,isReadableStream:M6,isRequest:U6,isResponse:V6,isHeaders:j6,isUndefined:vg,isDate:D6,isFile:L6,isBlob:P6,isRegExp:G6,isFunction:ga,isStream:e=>kT(e)&&ga(e.pipe),isURLSearchParams:k6,isTypedArray:B6,isFileList:x6,forEach:Tg,merge:function e(){let{caseless:t}=$1(this)&&this||{},i={},n=(r,s)=>{let c=t&&Q1(i,s)||s;MT(i[c])&&MT(r)?i[c]=e(i[c],r):MT(r)?i[c]=e({},r):Jf(r)?i[c]=r.slice():i[c]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&Tg(arguments[r],n);return i},extend:function(e,t,i){let{allOwnKeys:n}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Tg(t,(r,s)=>{i&&ga(r)?e[s]=q1(r,i):e[s]=r},{allOwnKeys:n}),e},trim:e=>rr(e)?rr(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,i,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,t,i,n)=>{let r,s,c,l={};if(t=t||{},e==null)return t;do{for(r=Object.getOwnPropertyNames(e),s=r.length;s-- >0;)c=r[s],n&&!n(c,e,t)||l[c]||(t[c]=e[c],l[c]=!0);e=i!==!1&&hA(e)}while(e&&(!i||i(e,t))&&e!==Object.prototype);return t},kindOf:PT,kindOfTest:ro,endsWith:(e,t,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=t.length;let n=e.indexOf(t,i);return n!==-1&&n===i},toArray:e=>{if(!e)return null;if(Jf(e))return e;let t=e.length;if(!Z1(t))return null;let i=new Array(t);for(;t-- >0;)i[t]=e[t];return i},forEachEntry:(e,t)=>{let i=(e&&e[LT]).call(e),n;for(;(n=i.next())&&!n.done;){let r=n.value;t.call(e,r[0],r[1])}},matchAll:(e,t)=>{let i,n=[];for(;(i=e.exec(t))!==null;)n.push(i);return n},isHTMLForm:F6,hasOwnProperty:eN,hasOwnProp:eN,reduceDescriptors:tN,freezeMethods:e=>{tN(e,(t,i)=>{if(ga(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;let n=e[i];ga(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(e,t)=>{let i={},n=r=>{r.forEach(s=>{i[s]=!0})};return Jf(e)?n(e):n(String(e).split(t)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,i,n){return i.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:Q1,global:bh,isContextDefined:$1,isSpecCompliantForm:function(e){return!!(e&&ga(e.append)&&e[X1]==="FormData"&&e[LT])},toJSONObject:e=>{let t=new Array(10),i=(n,r)=>{if(kT(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[r]=n;let s=Jf(n)?[]:{};return Tg(n,(c,l)=>{let d=i(c,r+1);!vg(d)&&(s[l]=d)}),t[r]=void 0,s}}return n};return i(e,0)},isAsyncFn:H6,isThenable:e=>e&&(kT(e)||ga(e))&&ga(e.then)&&ga(e.catch),setImmediate:iN,asap:W6,isIterable:e=>e!=null&&ga(e[LT])};function Xt(e,t,i,n,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),i&&(this.config=i),n&&(this.request=n),r&&(this.response=r,this.status=r.status?r.status:null)}Oe.inherits(Xt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Oe.toJSONObject(this.config),code:this.code,status:this.status}}});let aN=Xt.prototype,sN={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{sN[e]={value:e}}),Object.defineProperties(Xt,sN),Object.defineProperty(aN,"isAxiosError",{value:!0}),Xt.from=(e,t,i,n,r,s)=>{let c=Object.create(aN);return Oe.toFlatObject(e,c,function(l){return l!==Error.prototype},l=>l!=="isAxiosError"),Xt.call(c,e.message,t,i,n,r),c.cause=e,c.name=e.name,s&&Object.assign(c,s),c};function _A(e){return Oe.isPlainObject(e)||Oe.isArray(e)}function oN(e){return Oe.endsWith(e,"[]")?e.slice(0,-2):e}function cN(e,t,i){return e?e.concat(t).map(function(n,r){return n=oN(n),!i&&r?"["+n+"]":n}).join(i?".":""):t}let z6=Oe.toFlatObject(Oe,{},null,function(e){return/^is[A-Z]/.test(e)});function VT(e,t,i){if(!Oe.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;let n=(i=Oe.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,y){return!Oe.isUndefined(y[S])})).metaTokens,r=i.visitor||h,s=i.dots,c=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&Oe.isSpecCompliantForm(t);if(!Oe.isFunction(r))throw new TypeError("visitor must be a function");function d(S){if(S===null)return"";if(Oe.isDate(S))return S.toISOString();if(!l&&Oe.isBlob(S))throw new Xt("Blob is not supported. Use a Buffer instead.");return Oe.isArrayBuffer(S)||Oe.isTypedArray(S)?l&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function h(S,y,D){let O=S;if(S&&!D&&typeof S=="object"){if(Oe.endsWith(y,"{}"))y=n?y:y.slice(0,-2),S=JSON.stringify(S);else if(Oe.isArray(S)&&(function(N){return Oe.isArray(N)&&!N.some(_A)})(S)||(Oe.isFileList(S)||Oe.endsWith(y,"[]"))&&(O=Oe.toArray(S)))return y=oN(y),O.forEach(function(N,k){!Oe.isUndefined(N)&&N!==null&&t.append(c===!0?cN([y],k,s):c===null?y:y+"[]",d(N))}),!1}return!!_A(S)||(t.append(cN(D,y,s),d(S)),!1)}let f=[],E=Object.assign(z6,{defaultVisitor:h,convertValue:d,isVisitable:_A});if(!Oe.isObject(e))throw new TypeError("data must be an object");return(function S(y,D){if(!Oe.isUndefined(y)){if(f.indexOf(y)!==-1)throw Error("Circular reference detected in "+D.join("."));f.push(y),Oe.forEach(y,function(O,N){(!(Oe.isUndefined(O)||O===null)&&r.call(t,O,Oe.isString(N)?rr(N).call(N):N,D,E))===!0&&S(O,D?D.concat(N):[N])}),f.pop()}})(e),t}function lN(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(i){return t[i]})}function EA(e,t){this._pairs=[],e&&VT(e,this,t)}let dN=EA.prototype;function K6(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function uN(e,t,i){if(!t)return e;let n=i&&i.encode||K6;Oe.isFunction(i)&&(i={serialize:i});let r=i&&i.serialize,s;if(s=r?r(t,i):Oe.isURLSearchParams(t)?t.toString():new EA(t,i).toString(n),s){let c=e.indexOf("#");c!==-1&&(e=e.slice(0,c)),e+=(e.indexOf("?")===-1?"?":"&")+s}return e}dN.append=function(e,t){this._pairs.push([e,t])},dN.toString=function(e){let t=e?function(i){return e.call(this,i,lN)}:lN;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};var hN=class{constructor(){this.handlers=[]}use(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Oe.forEach(this.handlers,function(t){t!==null&&e(t)})}},pN={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},fN={exports:{}},Y6=Ft,q6=Ct,mN=dr.f;Y6({target:"Object",stat:!0,forced:Object.defineProperty!==mN,sham:!q6},{defineProperty:mN});var _N=Dr.Object,X6=fN.exports=function(e,t,i){return _N.defineProperty(e,t,i)};_N.defineProperty.sham&&(X6.sham=!0);var EN=R(fN.exports),J6=TypeError,gN=os,Z6=Ju,Q6=$n,$6=xi("species"),SN=Array,ej=function(e){var t;return gN(e)&&(t=e.constructor,(Z6(t)&&(t===SN||gN(t.prototype))||Q6(t)&&(t=t[$6])===null)&&(t=void 0)),t===void 0?SN:t},vN=function(e,t){return new(ej(e))(t===0?0:t)},tj=w,ij=ss,nj=xi("species"),TN=function(e){return ij>=51||!tj(function(){var t=[];return(t.constructor={})[nj]=function(){return{foo:1}},t[e](Boolean).foo!==1})},rj=Ft,aj=w,sj=os,oj=$n,cj=Pa,lj=No,yN=function(e){if(e>9007199254740991)throw J6("Maximum allowed index exceeded");return e},RN=Pb,dj=vN,uj=TN,hj=ss,CN=xi("isConcatSpreadable"),pj=hj>=51||!aj(function(){var e=[];return e[CN]=!1,e.concat()[0]!==e}),fj=function(e){if(!oj(e))return!1;var t=e[CN];return t!==void 0?!!t:sj(e)};rj({target:"Array",proto:!0,forced:!pj||!uj("concat")},{concat:function(e){var t,i,n,r,s,c=cj(this),l=dj(c,0),d=0;for(t=-1,n=arguments.length;t<n;t++)if(fj(s=t===-1?c:arguments[t]))for(r=lj(s),yN(d+r),i=0;i<r;i++,d++)i in s&&RN(l,d,s[i]);else yN(d+1),RN(l,d++,s);return l.length=d,l}});var bN={},mj=$e,_j=bo,AN=ls.f,Ej=yr,wN=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];bN.f=function(e){return wN&&mj(e)==="Window"?(function(t){try{return AN(t)}catch{return Ej(wN)}})(e):AN(_j(e))};var Zf={},gj=xi;Zf.f=gj;var IN=Dr,Sj=an,vj=Zf,Tj=dr.f,En=function(e){var t=IN.Symbol||(IN.Symbol={});Sj(t,e)||Tj(t,e,{value:vj.f(e)})},yj=ze,Rj=er,Cj=xi,bj=kn,ON=function(){var e=Rj("Symbol"),t=e&&e.prototype,i=t&&t.valueOf,n=Cj("toPrimitive");t&&!t[n]&&bj(t,n,function(r){return yj(i,this)},{})},Aj=xa,wj=La,Ij=Pa,Oj=No,Nj=vN;z([].push);var Dj=function(e){return function(t,i,n,r){for(var s,c,l=Ij(t),d=wj(l),h=Oj(d),f=Aj(i,n),E=0,S=r||Nj,y=void 0;h>E;E++)E in d&&(c=f(s=d[E],E,l));return y}},NN={forEach:Dj(0)},jT=Ft,yg=ae,gA=ze,Lj=z,Qf=Ct,$f=Pl,Pj=w,hr=an,xj=ce,SA=Wn,BT=bo,vA=Oo,kj=Pn,TA=_t,em=Yc,DN=ed,Mj=ls,LN=bN,Uj=Gc,PN=Vt,xN=dr,Vj=Hc,kN=We,MN=kn,jj=Hi,yA=la,UN=xn,VN=Io,Bj=xi,Fj=Zf,Gj=En,Hj=ON,Wj=ja,jN=Va,FT=NN.forEach,Sa=Xi("hidden"),GT="Symbol",Rg="prototype",zj=jN.set,BN=jN.getterFor(GT),ao=Object[Rg],Ah=yg.Symbol,HT=Ah&&Ah[Rg],Kj=yg.RangeError,Yj=yg.TypeError,RA=yg.QObject,FN=PN.f,wh=xN.f,GN=LN.f,qj=kN.f,HN=Lj([].push),hl=yA("symbols"),Cg=yA("op-symbols"),Xj=yA("wks"),CA=!RA||!RA[Rg]||!RA[Rg].findChild,WN=function(e,t,i){var n=FN(ao,t);n&&delete ao[t],wh(e,t,i),n&&e!==ao&&wh(ao,t,n)},bA=Qf&&Pj(function(){return em(wh({},"a",{get:function(){return wh(this,"a",{value:7}).a}})).a!==7})?WN:wh,AA=function(e,t){var i=hl[e]=em(HT);return zj(i,{type:GT,tag:e,description:t}),Qf||(i.description=t),i},WT=function(e,t,i){e===ao&&WT(Cg,t,i),SA(e);var n=vA(t);return SA(i),hr(hl,n)?(i.enumerable?(hr(e,Sa)&&e[Sa][n]&&(e[Sa][n]=!1),i=em(i,{enumerable:TA(0,!1)})):(hr(e,Sa)||wh(e,Sa,TA(1,em(null))),e[Sa][n]=!0),bA(e,n,i)):wh(e,n,i)},wA=function(e,t){SA(e);var i=BT(t),n=DN(i).concat(qN(i));return FT(n,function(r){Qf&&!gA(zN,i,r)||WT(e,r,i[r])}),e},zN=function(e){var t=vA(e),i=gA(qj,this,t);return!(this===ao&&hr(hl,t)&&!hr(Cg,t))&&(!(i||!hr(this,t)||!hr(hl,t)||hr(this,Sa)&&this[Sa][t])||i)},KN=function(e,t){var i=BT(e),n=vA(t);if(i!==ao||!hr(hl,n)||hr(Cg,n)){var r=FN(i,n);return!r||!hr(hl,n)||hr(i,Sa)&&i[Sa][n]||(r.enumerable=!0),r}},YN=function(e){var t=GN(BT(e)),i=[];return FT(t,function(n){hr(hl,n)||hr(UN,n)||HN(i,n)}),i},qN=function(e){var t=e===ao,i=GN(t?Cg:BT(e)),n=[];return FT(i,function(r){!hr(hl,r)||t&&!hr(ao,r)||HN(n,hl[r])}),n};$f||(Ah=function(){if(xj(HT,this))throw new Yj("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?kj(arguments[0]):void 0,t=VN(e),i=function(n){var r=this===void 0?yg:this;r===ao&&gA(i,Cg,n),hr(r,Sa)&&hr(r[Sa],t)&&(r[Sa][t]=!1);var s=TA(1,n);try{bA(r,t,s)}catch(c){if(!(c instanceof Kj))throw c;WN(r,t,s)}};return Qf&&CA&&bA(ao,t,{configurable:!0,set:i}),AA(t,e)},MN(HT=Ah[Rg],"toString",function(){return BN(this).tag}),MN(Ah,"withoutSetter",function(e){return AA(VN(e),e)}),kN.f=zN,xN.f=WT,Vj.f=wA,PN.f=KN,Mj.f=LN.f=YN,Uj.f=qN,Fj.f=function(e){return AA(Bj(e),e)},Qf&&jj(HT,"description",{configurable:!0,get:function(){return BN(this).description}})),jT({global:!0,wrap:!0,forced:!$f,sham:!$f},{Symbol:Ah}),FT(DN(Xj),function(e){Gj(e)}),jT({target:GT,stat:!0,forced:!$f},{useSetter:function(){CA=!0},useSimple:function(){CA=!1}}),jT({target:"Object",stat:!0,forced:!$f,sham:!Qf},{create:function(e,t){return t===void 0?em(e):wA(em(e),t)},defineProperty:WT,defineProperties:wA,getOwnPropertyDescriptor:KN}),jT({target:"Object",stat:!0,forced:!$f},{getOwnPropertyNames:YN}),Hj(),Wj(Ah,GT),UN[Sa]=!0;var XN=Pl&&!!Symbol.for&&!!Symbol.keyFor,Jj=Ft,Zj=er,Qj=an,$j=Pn,JN=la,e8=XN,IA=JN("string-to-symbol-registry"),t8=JN("symbol-to-string-registry");Jj({target:"Symbol",stat:!0,forced:!e8},{for:function(e){var t=$j(e);if(Qj(IA,t))return IA[t];var i=Zj("Symbol")(t);return IA[t]=i,t8[i]=t,i}});var i8=Ft,n8=an,r8=xl,a8=wo,s8=XN,ZN=la("symbol-to-string-registry");i8({target:"Symbol",stat:!0,forced:!s8},{keyFor:function(e){if(!r8(e))throw new TypeError(a8(e)+" is not a symbol");if(n8(ZN,e))return ZN[e]}});var QN=os,o8=Ye,$N=$e,c8=Pn,eD=z([].push),l8=Ft,tD=er,iD=fe,d8=ze,bg=z,nD=w,rD=Ye,aD=xl,sD=yr,u8=function(e){if(o8(e))return e;if(QN(e)){for(var t=e.length,i=[],n=0;n<t;n++){var r=e[n];typeof r=="string"?eD(i,r):typeof r!="number"&&$N(r)!=="Number"&&$N(r)!=="String"||eD(i,c8(r))}var s=i.length,c=!0;return function(l,d){if(c)return c=!1,d;if(QN(this))return d;for(var h=0;h<s;h++)if(i[h]===l)return d}}},h8=Pl,p8=String,Ud=tD("JSON","stringify"),zT=bg(/./.exec),oD=bg("".charAt),f8=bg("".charCodeAt),m8=bg("".replace),_8=bg(1 .toString),E8=/[\uD800-\uDFFF]/g,cD=/^[\uD800-\uDBFF]$/,lD=/^[\uDC00-\uDFFF]$/,dD=!h8||nD(function(){var e=tD("Symbol")("stringify detection");return Ud([e])!=="[null]"||Ud({a:e})!=="{}"||Ud(Object(e))!=="{}"}),uD=nD(function(){return Ud("\uDF06\uD834")!=='"\\udf06\\ud834"'||Ud("\uDEAD")!=='"\\udead"'}),g8=function(e,t){var i=sD(arguments),n=u8(t);if(rD(n)||e!==void 0&&!aD(e))return i[1]=function(r,s){if(rD(n)&&(s=d8(n,this,p8(r),s)),!aD(s))return s},iD(Ud,null,i)},S8=function(e,t,i){var n=oD(i,t-1),r=oD(i,t+1);return zT(cD,e)&&!zT(lD,r)||zT(lD,e)&&!zT(cD,n)?"\\u"+_8(f8(e,0),16):e};Ud&&l8({target:"JSON",stat:!0,forced:dD||uD},{stringify:function(e,t,i){var n=sD(arguments),r=iD(dD?g8:Ud,null,n);return uD&&typeof r=="string"?m8(r,E8,S8):r}});var hD=Gc,v8=Pa;Ft({target:"Object",stat:!0,forced:!Pl||w(function(){hD.f(1)})},{getOwnPropertySymbols:function(e){var t=hD.f;return t?t(v8(e)):[]}}),En("asyncIterator"),En("hasInstance"),En("isConcatSpreadable"),En("iterator"),En("match"),En("matchAll"),En("replace"),En("search"),En("species"),En("split");var T8=ON;En("toPrimitive"),T8();var y8=er,R8=ja;En("toStringTag"),R8(y8("Symbol"),"Symbol"),En("unscopables"),ja(ae.JSON,"JSON",!0);var C8=Dr.Symbol,b8=xi,A8=dr.f,pD=b8("metadata"),fD=Function.prototype;fD[pD]===void 0&&A8(fD,pD,{value:null}),En("asyncDispose"),En("dispose"),En("metadata");var w8=C8,I8=z,OA=er("Symbol"),O8=OA.keyFor,N8=I8(OA.prototype.valueOf),mD=OA.isRegisteredSymbol||function(e){try{return O8(N8(e))!==void 0}catch{return!1}};Ft({target:"Symbol",stat:!0},{isRegisteredSymbol:mD});for(var D8=la,_D=er,L8=z,P8=xl,x8=xi,KT=_D("Symbol"),ED=KT.isWellKnownSymbol,gD=_D("Object","getOwnPropertyNames"),k8=L8(KT.prototype.valueOf),SD=D8("wks"),NA=0,vD=gD(KT),M8=vD.length;NA<M8;NA++)try{var TD=vD[NA];P8(KT[TD])&&x8(TD)}catch{}var yD=function(e){if(ED&&ED(e))return!0;try{for(var t=k8(e),i=0,n=gD(SD),r=n.length;i<r;i++)if(SD[n[i]]==t)return!0}catch{}return!1};Ft({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:yD}),En("customMatcher"),En("observable"),Ft({target:"Symbol",stat:!0},{isRegistered:mD}),Ft({target:"Symbol",stat:!0,forced:!0},{isWellKnown:yD}),En("matcher"),En("metadataKey"),En("patternMatch"),En("replaceAll");var tm=R(w8),RD=R(Zf.f("iterator"));function Ag(e){return Ag=typeof tm=="function"&&typeof RD=="symbol"?function(t){return typeof t}:function(t){return t&&typeof tm=="function"&&t.constructor===tm&&t!==tm.prototype?"symbol":typeof t},Ag(e)}var U8=R(Zf.f("toPrimitive"));function V8(e){var t=(function(i,n){if(Ag(i)!="object"||!i)return i;var r=i[U8];if(r!==void 0){var s=r.call(i,n);if(Ag(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)})(e,"string");return Ag(t)=="symbol"?t:t+""}function L(e,t,i){return(t=V8(t))in e?EN(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var CD=R(V9),j8={isBrowser:!0,classes:{URLSearchParams:CD!==void 0?CD:EA,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};let DA=typeof window<"u"&&typeof document<"u",LA=typeof navigator=="object"&&navigator||void 0,B8=DA&&(!LA||["ReactNative","NativeScript","NS"].indexOf(LA.product)<0),F8=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",G8=DA&&window.location.href||"http://localhost";function bD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function AD(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?bD(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):bD(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var jr=AD(AD({},Object.freeze({__proto__:null,hasBrowserEnv:DA,hasStandardBrowserEnv:B8,hasStandardBrowserWebWorkerEnv:F8,navigator:LA,origin:G8})),j8),H8=Wn,W8=ze,z8=an,K8=ce,Y8=function(){var e=H8(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},wD=RegExp.prototype,ID=function(e){var t=e.flags;return t!==void 0||"flags"in wD||z8(e,"flags")||!K8(wD,e)?t:W8(Y8,e)},q8=ph.charAt,OD=ze,X8=Wn,J8=Ye,Z8=$e,Q8=/./.exec,$8=TypeError,eB=Ft,ND=ze,DD=qe,tB=ef,YT=hd,LD=Vs,PD=Pc,wg=Pn,iB=Wn,nB=$n,rB=$e,aB=v_,xD=ID,sB=Bs,oB=w,cB=lf,lB=function(e,t,i){return t+(i?q8(e,t).length:1)},dB=function(e,t){var i=e.exec;if(J8(i)){var n=OD(i,e,t);return n!==null&&X8(n),n}if(Z8(e)==="RegExp")return OD(Q8,e,t);throw new $8("RegExp#exec called on incompatible receiver")},kD=Va,uB=xi("matchAll"),MD="RegExp String",UD=MD+" Iterator",hB=kD.set,pB=kD.getterFor(UD),fB=TypeError,PA=DD("".indexOf),qT=DD("".matchAll),xA=!!qT&&!oB(function(){qT("a",/./)}),mB=tB(function(e,t,i,n){hB(this,{type:UD,regexp:e,string:t,global:i,unicode:n,done:!1})},MD,function(){var e=pB(this);if(e.done)return YT(void 0,!0);var t=e.regexp,i=e.string,n=dB(t,i);return n===null?(e.done=!0,YT(void 0,!0)):e.global?(wg(n[0])===""&&(t.lastIndex=lB(i,PD(t.lastIndex),e.unicode)),YT(n,!1)):(e.done=!0,YT(n,!1))}),VD=function(e){var t,i,n,r=iB(this),s=wg(e),c=cB(r,RegExp),l=wg(xD(r));return t=new c(c===RegExp?r.source:r,l),i=!!~PA(l,"g"),n=!!~PA(l,"u"),t.lastIndex=PD(r.lastIndex),new mB(t,s,i,n)};eB({target:"String",proto:!0,forced:xA},{matchAll:function(e){var t,i,n,r,s=LD(this);if(nB(e)){if(aB(e)&&(t=wg(LD(xD(e))),!~PA(t,"g")))throw new fB("`.matchAll` does not allow non-global regexes");if(xA)return qT(s,e);if((n=sB(e,uB))===void 0&&rB(e)==="RegExp"&&(n=VD),n)return ND(n,e,s)}else if(xA)return qT(s,e);return i=wg(s),r=new RegExp(e,"g"),ND(VD,r,i)}});var _B=Xr("String","matchAll"),EB=ce,gB=_B,kA=String.prototype,SB=function(e){var t=e.matchAll;return typeof e=="string"||e===kA||EB(kA,e)&&t===kA.matchAll?gB:t},vB=R(SB);function jD(e){function t(i,n,r,s){let c=i[s++];if(c==="__proto__")return!0;let l=Number.isFinite(+c),d=s>=i.length;return c=!c&&Oe.isArray(r)?r.length:c,d?(Oe.hasOwnProp(r,c)?r[c]=[r[c],n]:r[c]=n,!l):(r[c]&&Oe.isObject(r[c])||(r[c]=[]),t(i,n,r[c],s)&&Oe.isArray(r[c])&&(r[c]=(function(h){let f={},E=Object.keys(h),S,y=E.length,D;for(S=0;S<y;S++)D=E[S],f[D]=h[D];return f})(r[c])),!l)}if(Oe.isFormData(e)&&Oe.isFunction(e.entries)){let i={};return Oe.forEachEntry(e,(n,r)=>{t((function(s){return vB(Oe).call(Oe,/\w+|\[(\w*)]/g,s).map(c=>c[0]==="[]"?"":c[1]||c[0])})(n),r,i,0)}),i}return null}let MA={transitional:pN,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){let i=t.getContentType()||"",n=i.indexOf("application/json")>-1,r=Oe.isObject(e);if(r&&Oe.isHTMLForm(e)&&(e=new FormData(e)),Oe.isFormData(e))return n?JSON.stringify(jD(e)):e;if(Oe.isArrayBuffer(e)||Oe.isBuffer(e)||Oe.isStream(e)||Oe.isFile(e)||Oe.isBlob(e)||Oe.isReadableStream(e))return e;if(Oe.isArrayBufferView(e))return e.buffer;if(Oe.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(r){if(i.indexOf("application/x-www-form-urlencoded")>-1)return(function(c,l){return VT(c,new jr.classes.URLSearchParams,Object.assign({visitor:function(d,h,f,E){return jr.isNode&&Oe.isBuffer(d)?(this.append(h,d.toString("base64")),!1):E.defaultVisitor.apply(this,arguments)}},l))})(e,this.formSerializer).toString();if((s=Oe.isFileList(e))||i.indexOf("multipart/form-data")>-1){let c=this.env&&this.env.FormData;return VT(s?{"files[]":e}:e,c&&new c,this.formSerializer)}}return r||n?(t.setContentType("application/json",!1),(function(c,l,d){if(Oe.isString(c))try{return(l||JSON.parse)(c),rr(Oe).call(Oe,c)}catch(h){if(h.name!=="SyntaxError")throw h}return(d||JSON.stringify)(c)})(e)):e}],transformResponse:[function(e){let t=this.transitional||MA.transitional,i=t&&t.forcedJSONParsing,n=this.responseType==="json";if(Oe.isResponse(e)||Oe.isReadableStream(e))return e;if(e&&Oe.isString(e)&&(i&&!this.responseType||n)){let r=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(s){if(r)throw s.name==="SyntaxError"?Xt.from(s,Xt.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:jr.classes.FormData,Blob:jr.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Oe.forEach(["delete","get","head","post","put","patch"],e=>{MA.headers[e]={}});var UA=MA;let TB=Oe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),BD=Symbol("internals");function Ig(e){var t;return e&&rr(t=String(e)).call(t).toLowerCase()}function XT(e){return e===!1||e==null?e:Oe.isArray(e)?e.map(XT):String(e)}function VA(e,t,i,n,r){return Oe.isFunction(n)?n.call(this,t,i):(r&&(t=i),Oe.isString(t)?Oe.isString(n)?t.indexOf(n)!==-1:Oe.isRegExp(n)?n.test(t):void 0:void 0)}class JT{constructor(t){t&&this.set(t)}set(t,i,n){let r=this;function s(d,h,f){let E=Ig(h);if(!E)throw new Error("header name must be a non-empty string");let S=Oe.findKey(r,E);(!S||r[S]===void 0||f===!0||f===void 0&&r[S]!==!1)&&(r[S||h]=XT(d))}let c=(d,h)=>Oe.forEach(d,(f,E)=>s(f,E,h));if(Oe.isPlainObject(t)||t instanceof this.constructor)c(t,i);else if(Oe.isString(t)&&(t=rr(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(rr(l=t).call(l)))c((d=>{let h={},f,E,S;return d&&d.split(`
`).forEach(function(y){var D,O;S=y.indexOf(":"),f=rr(D=y.substring(0,S)).call(D).toLowerCase(),E=rr(O=y.substring(S+1)).call(O),!f||h[f]&&TB[f]||(f==="set-cookie"?h[f]?h[f].push(E):h[f]=[E]:h[f]=h[f]?h[f]+", "+E:E)}),h})(t),i);else if(Oe.isObject(t)&&Oe.isIterable(t)){let d,h,f={};for(let E of t){if(!Oe.isArray(E))throw TypeError("Object iterator must return a key-value pair");f[h=E[0]]=(d=f[h])?Oe.isArray(d)?[...d,E[1]]:[d,E[1]]:E[1]}c(f,i)}else t!=null&&s(i,t,n);var l;return this}get(t,i){if(t=Ig(t)){let n=Oe.findKey(this,t);if(n){let r=this[n];if(!i)return r;if(i===!0)return(function(s){let c=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,d;for(;d=l.exec(s);)c[d[1]]=d[2];return c})(r);if(Oe.isFunction(i))return i.call(this,r,n);if(Oe.isRegExp(i))return i.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,i){if(t=Ig(t)){let n=Oe.findKey(this,t);return!(!n||this[n]===void 0||i&&!VA(0,this[n],n,i))}return!1}delete(t,i){let n=this,r=!1;function s(c){if(c=Ig(c)){let l=Oe.findKey(n,c);!l||i&&!VA(0,n[l],l,i)||(delete n[l],r=!0)}}return Oe.isArray(t)?t.forEach(s):s(t),r}clear(t){let i=Object.keys(this),n=i.length,r=!1;for(;n--;){let s=i[n];t&&!VA(0,this[s],s,t,!0)||(delete this[s],r=!0)}return r}normalize(t){let i=this,n={};return Oe.forEach(this,(r,s)=>{var c;let l=Oe.findKey(n,s);if(l)return i[l]=XT(r),void delete i[s];let d=t?(function(h){return rr(h).call(h).toLowerCase().replace(/([a-z\d])(\w*)/g,(f,E,S)=>E.toUpperCase()+S)})(s):rr(c=String(s)).call(c);d!==s&&delete i[s],i[d]=XT(r),n[d]=!0}),this}concat(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return this.constructor.concat(this,...i)}toJSON(t){let i=Object.create(null);return Oe.forEach(this,(n,r)=>{n!=null&&n!==!1&&(i[r]=t&&Oe.isArray(n)?n.join(", "):n)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[i,n]=t;return i+": "+n}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){let i=new this(t);for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return r.forEach(c=>i.set(c)),i}static accessor(t){let i=(this[BD]=this[BD]={accessors:{}}).accessors,n=this.prototype;function r(s){let c=Ig(s);i[c]||((function(l,d){let h=Oe.toCamelCase(" "+d);["get","set","has"].forEach(f=>{Object.defineProperty(l,f+h,{value:function(E,S,y){return this[f].call(this,d,E,S,y)},configurable:!0})})})(n,s),i[c]=!0)}return Oe.isArray(t)?t.forEach(r):r(t),this}}JT.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Oe.reduceDescriptors(JT.prototype,(e,t)=>{let{value:i}=e,n=t[0].toUpperCase()+t.slice(1);return{get:()=>i,set(r){this[n]=r}}}),Oe.freezeMethods(JT);var so=JT;function jA(e,t){let i=this||UA,n=t||i,r=so.from(n.headers),s=n.data;return Oe.forEach(e,function(c){s=c.call(i,s,r.normalize(),t?t.status:void 0)}),r.normalize(),s}function FD(e){return!(!e||!e.__CANCEL__)}function im(e,t,i){Xt.call(this,e??"canceled",Xt.ERR_CANCELED,t,i),this.name="CanceledError"}function GD(e,t,i){let n=i.config.validateStatus;i.status&&n&&!n(i.status)?t(new Xt("Request failed with status code "+i.status,[Xt.ERR_BAD_REQUEST,Xt.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}Oe.inherits(im,Xt,{__CANCEL__:!0});let ZT=function(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=0,r=(function(s,c){s=s||10;let l=new Array(s),d=new Array(s),h,f=0,E=0;return c=c!==void 0?c:1e3,function(S){let y=Date.now(),D=d[E];h||(h=y),l[f]=S,d[f]=y;let O=E,N=0;for(;O!==f;)N+=l[O++],O%=s;if(f=(f+1)%s,f===E&&(E=(E+1)%s),y-h<c)return;let k=D&&y-D;return k?Math.round(1e3*N/k):void 0}})(50,250);return(function(s,c){let l,d,h=0,f=1e3/c,E=function(S){h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),l=null,d&&(clearTimeout(d),d=null),s.apply(null,S)};return[function(){let S=Date.now(),y=S-h;for(var D=arguments.length,O=new Array(D),N=0;N<D;N++)O[N]=arguments[N];y>=f?E(O,S):(l=O,d||(d=setTimeout(()=>{d=null,E(l)},f-y)))},()=>l&&E(l)]})(s=>{let c=s.loaded,l=s.lengthComputable?s.total:void 0,d=c-n,h=r(d);n=c,e({loaded:c,total:l,progress:l?c/l:void 0,bytes:d,rate:h||void 0,estimated:h&&l&&c<=l?(l-c)/h:void 0,event:s,lengthComputable:l!=null,[t?"download":"upload"]:!0})},i)},HD=(e,t)=>{let i=e!=null;return[n=>t[0]({lengthComputable:i,total:e,loaded:n}),t[1]]},WD=e=>function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return Oe.asap(()=>e(...i))};var yB=jr.hasStandardBrowserEnv?((e,t)=>i=>(i=new bT(i,jr.origin),e.protocol===i.protocol&&e.host===i.host&&(t||e.port===i.port)))(new bT(jr.origin),jr.navigator&&/(msie|trident)/i.test(jr.navigator.userAgent)):()=>!0,RB=jr.hasStandardBrowserEnv?{write(e,t,i,n,r,s){let c=[e+"="+encodeURIComponent(t)];Oe.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),Oe.isString(n)&&c.push("path="+n),Oe.isString(r)&&c.push("domain="+r),s===!0&&c.push("secure"),document.cookie=c.join("; ")},read(e){let t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function zD(e,t,i){let n=!(function(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)})(t);return e&&(n||i==0)?(function(r,s){return s?r.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):r})(e,t):t}function KD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}let YD=e=>e instanceof so?(function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i]!=null?arguments[i]:{};i%2?KD(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):KD(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t})({},e):e;function Ih(e,t){t=t||{};let i={};function n(h,f,E,S){return Oe.isPlainObject(h)&&Oe.isPlainObject(f)?Oe.merge.call({caseless:S},h,f):Oe.isPlainObject(f)?Oe.merge({},f):Oe.isArray(f)?f.slice():f}function r(h,f,E,S){return Oe.isUndefined(f)?Oe.isUndefined(h)?void 0:n(void 0,h,0,S):n(h,f,0,S)}function s(h,f){if(!Oe.isUndefined(f))return n(void 0,f)}function c(h,f){return Oe.isUndefined(f)?Oe.isUndefined(h)?void 0:n(void 0,h):n(void 0,f)}function l(h,f,E){return E in t?n(h,f):E in e?n(void 0,h):void 0}let d={url:s,method:s,data:s,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l,headers:(h,f,E)=>r(YD(h),YD(f),0,!0)};return Oe.forEach(Object.keys(Object.assign({},e,t)),function(h){let f=d[h]||r,E=f(e[h],t[h],h);Oe.isUndefined(E)&&f!==l||(i[h]=E)}),i}var qD=e=>{let t=Ih({},e),i,{data:n,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:c,headers:l,auth:d}=t;if(t.headers=l=so.from(l),t.url=uN(zD(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),d&&l.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),Oe.isFormData(n)){if(jr.hasStandardBrowserEnv||jr.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if((i=l.getContentType())!==!1){let[h,...f]=i?i.split(";").map(E=>rr(E).call(E)).filter(Boolean):[];l.setContentType([h||"multipart/form-data",...f].join("; "))}}if(jr.hasStandardBrowserEnv&&(r&&Oe.isFunction(r)&&(r=r(t)),r||r!==!1&&yB(t.url))){let h=s&&c&&RB.read(c);h&&l.set(s,h)}return t},CB=typeof XMLHttpRequest<"u"&&function(e){return new Ie(function(t,i){let n=qD(e),r=n.data,s=so.from(n.headers).normalize(),c,l,d,h,f,{responseType:E,onUploadProgress:S,onDownloadProgress:y}=n;function D(){h&&h(),f&&f(),n.cancelToken&&n.cancelToken.unsubscribe(c),n.signal&&n.signal.removeEventListener("abort",c)}let O=new XMLHttpRequest;function N(){if(!O)return;let U=so.from("getAllResponseHeaders"in O&&O.getAllResponseHeaders());GD(function(B){t(B),D()},function(B){i(B),D()},{data:E&&E!=="text"&&E!=="json"?O.response:O.responseText,status:O.status,statusText:O.statusText,headers:U,config:e,request:O}),O=null}O.open(n.method.toUpperCase(),n.url,!0),O.timeout=n.timeout,"onloadend"in O?O.onloadend=N:O.onreadystatechange=function(){O&&O.readyState===4&&(O.status!==0||O.responseURL&&O.responseURL.indexOf("file:")===0)&&setTimeout(N)},O.onabort=function(){O&&(i(new Xt("Request aborted",Xt.ECONNABORTED,e,O)),O=null)},O.onerror=function(){i(new Xt("Network Error",Xt.ERR_NETWORK,e,O)),O=null},O.ontimeout=function(){let U=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded",B=n.transitional||pN;n.timeoutErrorMessage&&(U=n.timeoutErrorMessage),i(new Xt(U,B.clarifyTimeoutError?Xt.ETIMEDOUT:Xt.ECONNABORTED,e,O)),O=null},r===void 0&&s.setContentType(null),"setRequestHeader"in O&&Oe.forEach(s.toJSON(),function(U,B){O.setRequestHeader(B,U)}),Oe.isUndefined(n.withCredentials)||(O.withCredentials=!!n.withCredentials),E&&E!=="json"&&(O.responseType=n.responseType),y&&([d,f]=ZT(y,!0),O.addEventListener("progress",d)),S&&O.upload&&([l,h]=ZT(S),O.upload.addEventListener("progress",l),O.upload.addEventListener("loadend",h)),(n.cancelToken||n.signal)&&(c=U=>{O&&(i(!U||U.type?new im(null,e,O):U),O.abort(),O=null)},n.cancelToken&&n.cancelToken.subscribe(c),n.signal&&(n.signal.aborted?c():n.signal.addEventListener("abort",c)));let k=(function(U){let B=/^([-+\w]{1,25})(:?\/\/|:)/.exec(U);return B&&B[1]||""})(n.url);k&&jr.protocols.indexOf(k)===-1?i(new Xt("Unsupported protocol "+k+":",Xt.ERR_BAD_REQUEST,e)):O.send(r||null)})},bB=(e,t)=>{let{length:i}=e=e?e.filter(Boolean):[];if(t||i){let n,r=new AbortController,s=function(h){if(!n){n=!0,l();let f=h instanceof Error?h:this.reason;r.abort(f instanceof Xt?f:new im(f instanceof Error?f.message:f))}},c=t&&setTimeout(()=>{c=null,s(new Xt("timeout ".concat(t," of ms exceeded"),Xt.ETIMEDOUT))},t),l=()=>{e&&(c&&clearTimeout(c),c=null,e.forEach(h=>{h.unsubscribe?h.unsubscribe(s):h.removeEventListener("abort",s)}),e=null)};e.forEach(h=>h.addEventListener("abort",s));let{signal:d}=r;return d.unsubscribe=()=>Oe.asap(l),d}},BA=R(_h),XD=Zf.f("asyncIterator"),AB=R(XD);function FA(e,t){this.v=e,this.k=t}function Ka(e){return function(){return new Og(e.apply(this,arguments))}}function Og(e){var t,i;function n(s,c){try{var l=e[s](c),d=l.value,h=d instanceof FA;BA.resolve(h?d.v:d).then(function(f){if(h){var E=s==="return"?"return":"next";if(!d.k||f.done)return n(E,f);f=e[E](f).value}r(l.done?"return":"normal",f)},function(f){n("throw",f)})}catch(f){r("throw",f)}}function r(s,c){switch(s){case"return":t.resolve({value:c,done:!0});break;case"throw":t.reject(c);break;default:t.resolve({value:c,done:!1})}(t=t.next)?n(t.key,t.arg):i=null}this._invoke=function(s,c){return new BA(function(l,d){var h={key:s,arg:c,resolve:l,reject:d,next:null};i?i=i.next=h:(t=i=h,n(s,c))})},typeof e.return!="function"&&(this.return=void 0)}function Dt(e){return new FA(e,0)}function QT(e){var t={},i=!1;function n(r,s){return i=!0,s=new BA(function(c){c(e[r](s))}),{done:!1,value:new FA(s,1)}}return t[tm!==void 0&&RD||"@@iterator"]=function(){return this},t.next=function(r){return i?(i=!1,r):n("next",r)},typeof e.throw=="function"&&(t.throw=function(r){if(i)throw i=!1,r;return n("throw",r)}),typeof e.return=="function"&&(t.return=function(r){return i?(i=!1,r):n("return",r)}),t}Og.prototype[typeof tm=="function"&&AB||"@@asyncIterator"]=function(){return this},Og.prototype.next=function(e){return this._invoke("next",e)},Og.prototype.throw=function(e){return this._invoke("throw",e)},Og.prototype.return=function(e){return this._invoke("return",e)};var GA=R(XD);function HA(e){var t,i,n,r=2;for(typeof Symbol<"u"&&(i=GA,n=Symbol.iterator);r--;){if(i&&(t=e[i])!=null)return t.call(e);if(n&&(t=e[n])!=null)return new $T(t.call(e));i="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function $T(e){function t(i){if(Object(i)!==i)return Ie.reject(new TypeError(i+" is not an object."));var n=i.done;return Ie.resolve(i.value).then(function(r){return{value:r,done:n}})}return $T=function(i){this.s=i,this.n=i.next},$T.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(i){var n=this.s.return;return n===void 0?Ie.resolve({value:i,done:!0}):t(n.apply(this.s,arguments))},throw:function(i){var n=this.s.return;return n===void 0?Ie.reject(i):t(n.apply(this.s,arguments))}},new $T(e)}let wB=function*(e,t){let i=e.byteLength;if(!t||i<t)return void(yield e);let n,r=0;for(;r<i;)n=r+t,yield e.slice(r,n),r=n},IB=(function(){var e=Ka(function*(t,i){var n,r=!1,s=!1;try{for(var c,l=HA(OB(t));r=!(c=yield Dt(l.next())).done;r=!1){let d=c.value;yield*QT(HA(wB(d,i)))}}catch(d){s=!0,n=d}finally{try{r&&l.return!=null&&(yield Dt(l.return()))}finally{if(s)throw n}}});return function(t,i){return e.apply(this,arguments)}})(),OB=(function(){var e=Ka(function*(t){if(t[GA])return void(yield*QT(HA(t)));let i=t.getReader();try{for(;;){let{done:n,value:r}=yield Dt(i.read());if(n)break;yield r}}finally{yield Dt(i.cancel())}});return function(t){return e.apply(this,arguments)}})(),JD=(e,t,i,n)=>{let r=IB(e,t),s,c=0,l=d=>{s||(s=!0,n&&n(d))};return new ReadableStream({async pull(d){try{let{done:h,value:f}=await r.next();if(h)return l(),void d.close();let E=f.byteLength;if(i){let S=c+=E;i(S)}d.enqueue(new Uint8Array(f))}catch(h){throw l(h),h}},cancel:d=>(l(d),r.return())},{highWaterMark:2})};function ZD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function QD(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?ZD(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ZD(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}let ey=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",$D=ey&&typeof ReadableStream=="function",NB=ey&&(typeof TextEncoder=="function"?(eL=new TextEncoder,e=>eL.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var eL;let tL=function(e){try{for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return!!e(...i)}catch{return!1}},DB=$D&&tL(()=>{let e=!1,t=new Request(jr.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),WA=$D&&tL(()=>Oe.isReadableStream(new Response("").body)),ty={stream:WA&&(e=>e.body)};var iL;ey&&(iL=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!ty[e]&&(ty[e]=Oe.isFunction(iL[e])?t=>t[e]():(t,i)=>{throw new Xt("Response type '".concat(e,"' is not supported"),Xt.ERR_NOT_SUPPORT,i)})}));let LB=async(e,t)=>Oe.toFiniteNumber(e.getContentLength())??(async n=>n==null?0:Oe.isBlob(n)?n.size:Oe.isSpecCompliantForm(n)?(await new Request(jr.origin,{method:"POST",body:n}).arrayBuffer()).byteLength:Oe.isArrayBufferView(n)||Oe.isArrayBuffer(n)?n.byteLength:(Oe.isURLSearchParams(n)&&(n+=""),Oe.isString(n)?(await NB(n)).byteLength:void 0))(t);var PB=ey&&(async e=>{let{url:t,method:i,data:n,signal:r,cancelToken:s,timeout:c,onDownloadProgress:l,onUploadProgress:d,responseType:h,headers:f,withCredentials:E="same-origin",fetchOptions:S}=qD(e);h=h?(h+"").toLowerCase():"text";let y,D=bB([r,s&&s.toAbortSignal()],c),O=D&&D.unsubscribe&&(()=>{D.unsubscribe()}),N;try{if(d&&DB&&i!=="get"&&i!=="head"&&(N=await LB(f,n))!==0){let K,H=new Request(t,{method:"POST",body:n,duplex:"half"});if(Oe.isFormData(n)&&(K=H.headers.get("content-type"))&&f.setContentType(K),H.body){let[ee,ue]=HD(N,ZT(WD(d)));n=JD(H.body,65536,ee,ue)}}Oe.isString(E)||(E=E?"include":"omit");let k="credentials"in Request.prototype;y=new Request(t,QD(QD({},S),{},{signal:D,method:i.toUpperCase(),headers:f.normalize().toJSON(),body:n,duplex:"half",credentials:k?E:void 0}));let U=await fetch(y),B=WA&&(h==="stream"||h==="response");if(WA&&(l||B&&O)){let K={};["status","statusText","headers"].forEach(me=>{K[me]=U[me]});let H=Oe.toFiniteNumber(U.headers.get("content-length")),[ee,ue]=l&&HD(H,ZT(WD(l),!0))||[];U=new Response(JD(U.body,65536,ee,()=>{ue&&ue(),O&&O()}),K)}h=h||"text";let J=await ty[Oe.findKey(ty,h)||"text"](U,e);return!B&&O&&O(),await new Ie((K,H)=>{GD(K,H,{data:J,headers:so.from(U.headers),status:U.status,statusText:U.statusText,config:e,request:y})})}catch(k){throw O&&O(),k&&k.name==="TypeError"&&/Load failed|fetch/i.test(k.message)?Object.assign(new Xt("Network Error",Xt.ERR_NETWORK,e,y),{cause:k.cause||k}):Xt.from(k,k&&k.code,e,y)}});let zA={http:null,xhr:CB,fetch:PB};Oe.forEach(zA,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});let nL=e=>"- ".concat(e),xB=e=>Oe.isFunction(e)||e===null||e===!1;var rL={getAdapter:e=>{e=Oe.isArray(e)?e:[e];let{length:t}=e,i,n,r={};for(let s=0;s<t;s++){let c;if(i=e[s],n=i,!xB(i)&&(n=zA[(c=String(i)).toLowerCase()],n===void 0))throw new Xt("Unknown adapter '".concat(c,"'"));if(n)break;r[c||"#"+s]=n}if(!n){let s=Object.entries(r).map(c=>{let[l,d]=c;return"adapter ".concat(l," ")+(d===!1?"is not supported by the environment":"is not available in the build")});throw new Xt("There is no suitable adapter to dispatch the request "+(t?s.length>1?`since :
`+s.map(nL).join(`
`):" "+nL(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n},adapters:zA};function KA(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new im(null,e)}function aL(e){return KA(e),e.headers=so.from(e.headers),e.data=jA.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),rL.getAdapter(e.adapter||UA.adapter)(e).then(function(t){return KA(e),t.data=jA.call(e,e.transformResponse,t),t.headers=so.from(t.headers),t},function(t){return FD(t)||(KA(e),t&&t.response&&(t.response.data=jA.call(e,e.transformResponse,t.response),t.response.headers=so.from(t.response.headers))),Ie.reject(t)})}let sL="1.9.0",iy={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{iy[e]=function(i){return typeof i===e||"a"+(t<1?"n ":" ")+e}});let oL={};iy.transitional=function(e,t,i){function n(r,s){return"[Axios v"+sL+"] Transitional option '"+r+"'"+s+(i?". "+i:"")}return(r,s,c)=>{if(e===!1)throw new Xt(n(s," has been removed"+(t?" in "+t:"")),Xt.ERR_DEPRECATED);return t&&!oL[s]&&(oL[s]=!0,console.warn(n(s," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,s,c)}},iy.spelling=function(e){return(t,i)=>(console.warn("".concat(i," is likely a misspelling of ").concat(e)),!0)};var ny={assertOptions:function(e,t,i){if(typeof e!="object")throw new Xt("options must be an object",Xt.ERR_BAD_OPTION_VALUE);let n=Object.keys(e),r=n.length;for(;r-- >0;){let s=n[r],c=t[s];if(c){let l=e[s],d=l===void 0||c(l,s,e);if(d!==!0)throw new Xt("option "+s+" must be "+d,Xt.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new Xt("Unknown option "+s,Xt.ERR_BAD_OPTION)}},validators:iy};let ac=ny.validators,ry=class{constructor(e){this.defaults=e||{},this.interceptors={request:new hN,response:new hN}}async request(e,t){try{return await this._request(e,t)}catch(i){if(i instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;let r=n.stack?n.stack.replace(/^.+\n/,""):"";try{i.stack?r&&!String(i.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+r):i.stack=r}catch{}}throw i}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Ih(this.defaults,t);let{transitional:i,paramsSerializer:n,headers:r}=t;i!==void 0&&ny.assertOptions(i,{silentJSONParsing:ac.transitional(ac.boolean),forcedJSONParsing:ac.transitional(ac.boolean),clarifyTimeoutError:ac.transitional(ac.boolean)},!1),n!=null&&(Oe.isFunction(n)?t.paramsSerializer={serialize:n}:ny.assertOptions(n,{encode:ac.function,serialize:ac.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),ny.assertOptions(t,{baseUrl:ac.spelling("baseURL"),withXsrfToken:ac.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=r&&Oe.merge(r.common,r[t.method]);r&&Oe.forEach(["delete","get","head","post","put","patch","common"],y=>{delete r[y]}),t.headers=so.concat(s,r);let c=[],l=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(t)===!1||(l=l&&y.synchronous,c.unshift(y.fulfilled,y.rejected))});let d=[],h;this.interceptors.response.forEach(function(y){d.push(y.fulfilled,y.rejected)});let f,E=0;if(!l){let y=[aL.bind(this),void 0];for(y.unshift.apply(y,c),y.push.apply(y,d),f=y.length,h=Ie.resolve(t);E<f;)h=h.then(y[E++],y[E++]);return h}f=c.length;let S=t;for(E=0;E<f;){let y=c[E++],D=c[E++];try{S=y(S)}catch(O){D.call(this,O);break}}try{h=aL.call(this,S)}catch(y){return Ie.reject(y)}for(E=0,f=d.length;E<f;)h=h.then(d[E++],d[E++]);return h}getUri(e){return uN(zD((e=Ih(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Oe.forEach(["delete","get","head","options"],function(e){ry.prototype[e]=function(t,i){return this.request(Ih(i||{},{method:e,url:t,data:(i||{}).data}))}}),Oe.forEach(["post","put","patch"],function(e){function t(i){return function(n,r,s){return this.request(Ih(s||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}ry.prototype[e]=t(),ry.prototype[e+"Form"]=t(!0)});var ay=ry;class YA{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Ie(function(r){i=r});let n=this;this.promise.then(r=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](r);n._listeners=null}),this.promise.then=r=>{let s,c=new Ie(l=>{n.subscribe(l),s=l}).then(r);return c.cancel=function(){n.unsubscribe(s)},c},t(function(r,s,c){n.reason||(n.reason=new im(r,s,c),i(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;let i=this._listeners.indexOf(t);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){let t=new AbortController,i=n=>{t.abort(n)};return this.subscribe(i),t.signal.unsubscribe=()=>this.unsubscribe(i),t.signal}static source(){let t;return{token:new YA(function(i){t=i}),cancel:t}}}var kB=YA;let qA={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(qA).forEach(e=>{let[t,i]=e;qA[i]=t});var MB=qA;let Xn=(function e(t){let i=new ay(t),n=q1(ay.prototype.request,i);return Oe.extend(n,ay.prototype,i,{allOwnKeys:!0}),Oe.extend(n,i,null,{allOwnKeys:!0}),n.create=function(r){return e(Ih(t,r))},n})(UA);Xn.Axios=ay,Xn.CanceledError=im,Xn.CancelToken=kB,Xn.isCancel=FD,Xn.VERSION=sL,Xn.toFormData=VT,Xn.AxiosError=Xt,Xn.Cancel=Xn.CanceledError,Xn.all=function(e){return Ie.all(e)},Xn.spread=function(e){return function(t){return e.apply(null,t)}},Xn.isAxiosError=function(e){return Oe.isObject(e)&&e.isAxiosError===!0},Xn.mergeConfig=Ih,Xn.AxiosHeaders=so,Xn.formToJSON=e=>jD(Oe.isHTMLForm(e)?new FormData(e):e),Xn.getAdapter=rL.getAdapter,Xn.HttpStatusCode=MB,Xn.default=Xn;var br=Xn;let UB=()=>{};function Ng(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:UB};return e.promise=new Ie((t,i)=>{e.resolve=n=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(n),e.value=n)},e.reject=n=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,i(n))}}),e}let sy=new Map,oy=new Map,sc=new Map,on=(function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e})({}),kt=(function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e})({}),cL=new p6,oo=cL.getResult(),XA=null;function wt(e){if(!XA){oo=cL.getResult();let t=(function(l){if(l.engine.name==="Blink"&&l.browser.name!=="WeChat")return kt.CHROME;switch(l.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return kt.CHROME;case"Safari":case"Mobile Safari":return kt.SAFARI;case"Edge":return kt.EDGE;case"Firefox":return kt.FIREFOX;case"QQ":case"QQBrowser":return kt.QQ;case"Opera":return kt.OPERA;case"WeChat":return kt.WECHAT;default:return l.browser.name||""}})(oo),i=lL(oo),n=(function(l){return l.os.name==="Windows"?l.os.version?l.os.name+" "+l.os.version:l.os.name:l.os.name||""})(oo),r=oo.os.version,s=lL(oo,!1),c=oo.device.type;if(!(t&&i&&n&&r))return{name:t,version:i,os:n,osVersion:r,browserVersion:s,deviceType:c};XA={name:t,version:i,os:n,osVersion:r,browserVersion:s,deviceType:c}}return XA}function lL(e){let t,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",i?t.split(".")[0]:t}function cy(){return wt().os}function dL(){let e=wt();return"".concat(e.os," ").concat(e.osVersion)}function ly(){let e=wt();return!!(oo.engine.name==="WebKit"&&e.os===on.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==kt.SAFARI||Jn()&&e.name!==kt.SAFARI)}function pl(){return wt().name===kt.CHROME}function wn(){return wt().name===kt.SAFARI}function uL(){let e=wt();if(e.name!==kt.SAFARI||!e.browserVersion)return!1;let t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function hL(){return wt().name===kt.EDGE}function bi(){return wt().name===kt.FIREFOX}function Jn(){return wt().os===on.IOS}function nm(e){let t=wt();return!(t.name!==kt.CHROME||!t.osVersion)&&Number(t.version)>=e}function pL(e){let t=wt();return!(t.name!==kt.CHROME||!t.osVersion)&&Number(t.version)<e}function JA(e,t,i){let n=wt();return!(n.name!==e||!n.osVersion)&&(i?Number(n.version)>=t&&Number(n.version)<=i:Number(n.version)===t)}function ZA(e){let t=wt();return!(t.name!==kt.EDGE||!t.osVersion)&&Number(t.version)>=e}function QA(e){let t=wt();return!(t.name!==kt.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function fL(e){let t=wt();return!(t.name!==kt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function mL(e,t,i){let n=wt();if(n.os!==on.IOS||!n.osVersion)return!1;let r=n.osVersion.split(".");return i?t&&Number(r[0])===e&&Number(r[1])>t||Number(r[0])>e:t?Number(r[0])===e&&Number(r[1])>=t||Number(r[0])>e:Number(r[0])>=e}function _L(e,t,i){let n=wt();if(n.os!==on.IOS||!n.osVersion)return!1;let r=n.osVersion.split(".");return t&&Number(r[0])===e&&Number(r[1])<t||Number(r[0])<e}function $A(e,t,i){let n=wt();if(n.name!==kt.SAFARI||!n.osVersion||!n.browserVersion)return!1;let r=n.browserVersion.split(".");return i?t&&Number(r[0])===e&&Number(r[1])<t||Number(r[0])<e:t?Number(r[0])===e&&Number(r[1])<=t||Number(r[0])<e:Number(r[0])<=e}function ew(e){let t=wt();return!(t.name!==kt.OPERA||!t.osVersion)&&Number(t.version)>=e}function EL(){let e=wt();if(e.os!==on.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function rm(){let e=wt();if(e.os!==on.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15}function tw(){let e=wt();if(e.os!==on.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===16}function gL(){let e=wt();if(e.os!==on.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Cs(){return wn()&&navigator.maxTouchPoints>0}function SL(){return wt().name===kt.WECHAT}function vL(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function iw(){let e=cy();return(function(){let{deviceType:t}=wt();return t==="mobile"||t==="tablet"})()||e===on.ANDROID||e===on.IOS||e===on.HARMONY_OS}function fl(){let e=wt();return e.name!==kt.EDGE&&e.name!==kt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function dy(){return cy()===on.ANDROID}function Dg(){let e=wt();return dy()&&(e.name===kt.CHROME||e.name===kt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function st(e,t,i){return(t=(function(n){var r=(function(s,c){if(typeof s!="object"||!s)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var d=l.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)})(n);return typeof r=="symbol"?r:r+""})(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function TL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function Te(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?TL(Object(i),!0).forEach(function(n){st(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):TL(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}let M=(function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e})({}),de=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(t),st(this,"code",void 0),st(this,"message",void 0),st(this,"data",void 0),st(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function co(e,t){if(typeof e!="boolean")throw new de(M.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function tn(e,t,i){if(!Ce(i).call(i,e))throw new de(M.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(i)))}function Jt(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<i||e>n||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!(function(r){return typeof r=="number"&&r%1==0})(e))throw new de(M.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(i,", ").concat(n,"]. integer only"))}function nw(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new de(M.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&Jt(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&Jt(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&Jt(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&Jt(e.ideal,"".concat(t,".ideal"),1,1/0)}else Jt(e,t,1,1/0)}function gn(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,r=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new de(M.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!yL(e,i,n,r))throw new de(M.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(i,",").concat(n,"].").concat(r?" ASCII characters only.":""))}function ml(e,t){if(!Array.isArray(e))throw new de(M.INVALID_PARAMS,"".concat(t," should be an array"))}function Ai(e){return e==null}function yL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,n=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=i&&e.length>=t&&(!n||(function(r){if(typeof r!="string")return!1;for(let s=0;s<r.length;s+=1){let c=r.charCodeAt(s);if(c<0||c>255)return!1}return!0})(e))}var Lg=(function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e})(Lg||{}),rw=(function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e})(rw||{});let RL=new class{constructor(){st(this,"_clientSize",null),st(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),st(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),st(this,"getStyle",e=>window.getComputedStyle(e,null)),st(this,"checkCssVisibleProperty",e=>{var t;let i=!0,n=this.getStyle(e),{display:r,visibility:s,opacity:c,filter:l}=n;return(r==="none"||Ce(t=["hidden","collapse"]).call(t,s)||Number(c)<.1)&&(i=!1),!!i&&(l&&l.split(" ").filter(d=>{var h;let f=d.split("(")[0];return Ce(h=["brightness","blur","opacity"]).call(h,f)}).map(d=>{let[h,f]=d.split(/\(|\)/);return[h,Number(f.match(/^[0-9\.]+/))]}).forEach(d=>{let[h,f]=d;switch(h){case"brightness":(f<.1||f>3)&&(i=!1);break;case"blur":f>3&&(i=!1);break;case"opacity":f<.1&&(i=!1)}}),i)}),st(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let i=!0,n=!0,r=c=>t(c),s=e;for(;s&&n;)r(s)||(i=!1,n=!1),s=s.parentElement,s||(n=!1);return i}),st(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),st(this,"getSizeAboutClient",e=>{let{width:t,height:i,left:n,right:r,top:s,bottom:c}=e.getBoundingClientRect(),l=this.getClientWidth(),d=this.getClientHeight();return{width:t,height:i,left:n,right:r,top:s,bottom:c,clientWidth:l,clientHeight:d,clientMin:Math.min(l,d)}}),st(this,"checkActualSize",()=>{let{width:e,height:t,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(e,t,i)}),st(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),st(this,"checkCoverForAPoint",(e,t,i)=>{let n=this.elementFromPoint(e,t);return n!==null&&n!==i}),st(this,"getPointPositionList",()=>{let{width:e,height:t,left:i,top:n}=this._clientSize,r=e/6,s=t/6,c=[],l=10**6;for(let d=0;d<5;d++)for(let h=0;h<5;h++){let f=(i*l+(d===0?.1:d===4?(r*d*l-1e5)/l:r*d)*l)/l,E=(n*l+(h===0?.1:h===4?(s*h*l-1e5)/l:s*h)*l)/l;c.push({x:f,y:E})}return[...c]}),st(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),st(this,"checkSizeIsVisible",(e,t,i)=>(e>50||i/e<=10)&&(t>50||i/t<=10)),st(this,"checkSizeOfPartInClient",()=>{let{left:e,right:t,top:i,bottom:n,clientHeight:r,clientWidth:s,clientMin:c}=this._clientSize,l,d,h,f;if(e<0)l=0;else{if(!(e<s))return!1;l=e}if(t<0)return!1;if(d=t<s?t:s,i<0)h=0;else{if(!(i<r))return!1;h=i}if(n<0)return!1;f=n<r?n:r;let E=d-l,S=f-h;return this.checkSizeIsVisible(E,S,c)}),st(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),st(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Lg.COVERED);{let t=this.checkActualSize(),i=this.checkSizeOfPartInClient();return t&&!i?this.returnHiddenResult(Lg.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Lg.SIZE)}}return this.returnHiddenResult(Lg.STYLE)}return this.returnHiddenResult(rw.UNMOUNTED)}return this.returnHiddenResult(rw.INVALID_HTML_ELEMENT)}),st(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function aw(e){return new TextEncoder().encode(e)}let CL=function(e,t){let i=new Uint8Array(e.byteLength+t.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(t),e.byteLength),i},sw=async e=>(function(t,i){let n="";return new Uint8Array(t).forEach(r=>{n+=r.toString(i).padStart(2,"0")}),n})(await crypto.subtle.digest("SHA-256",aw(e)),16);class vi{constructor(){st(this,"_events",{}),st(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(i=>i.listener):[]}on(t,i){this._events[t]||(this._events[t]=[]);let n=this._events[t];this._indexOfListener(n,i)===-1&&n.push({listener:i,once:!1})}once(t,i){this._events[t]||(this._events[t]=[]);let n=this._events[t];this._indexOfListener(n,i)===-1&&n.push({listener:i,once:!0})}off(t,i){if(!this._events[t])return;let n=this._events[t],r=this._indexOfListener(n,i);r!==-1&&n.splice(r,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);let i=this._events[t].map(c=>c);for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];for(let c=0;c<i.length;c+=1){let l=i[c];l.once&&this.off(t,l.listener),l.listener.apply(this,r||[])}}safeEmit(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];[...this._events[t]||[]].forEach(s=>{s.once&&this.off(t,s.listener);try{s.listener.apply(this,n)}catch(c){console.error("safeEmit event:".concat(t," error ").concat(c?.toString()))}})}_indexOfListener(t,i){let n=t.length;for(;n--;)if(t[n].listener===i)return n;return-1}}let Pg=null;function bL(){if(Pg)return Pg;if(window.electron)return Pg=window.electron;if(!window.require)return null;try{return Pg=window.require("electron"),Pg}catch{return null}}let Li=(function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e})({}),_i=(function(e){return e.TRACER="tracer",e})({});function AL(e){return Jt(e.timeout,"config.timeout",0,1e5),Jt(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Jt(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Jt(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let VB=(function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e})({}),Gt=(function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e})({});function xg(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function wL(e){return gn(e.turnServerURL,"turnServerURL"),gn(e.username,"username"),gn(e.password,"password"),e.udpport&&Jt(e.udpport,"udpport",1,99999,!0),e.forceturn&&co(e.forceturn,"forceturn"),e.security&&co(e.security,"security"),e.tcpport&&Jt(e.tcpport,"tcpport",1,99999,!0),!0}function ow(e){return e.level!==void 0&&tn(e.level,"level",[1,2,3]),e.delay!==void 0&&Jt(e.delay,"delay",0,3e3,!0),!0}let yt=(function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e})({}),In=(function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e})({}),aa=(function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({}),am=(function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({});function On(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];return e.getListeners(t).length===0?Ie.reject(new de(M.UNEXPECTED_ERROR,"can not emit promise")):new Ie((s,c)=>{e.emit(t,...n,s,c)})}function $t(e,t){if(e.getListeners(t).length===0)return Ie.resolve();for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];return On(e,t,...n)}function va(e,t){if(e.getListeners(t).length===0)return null;for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];return kg(e,t,...n)}function kg(e,t){let i=null,n=null;for(var r=arguments.length,s=new Array(r>2?r-2:0),c=2;c<r;c++)s[c-2]=arguments[c];if(e.emit(t,...s,l=>{i=l},l=>{n=l}),n!==null)throw n;if(i===null)throw new de(M.UNEXPECTED_ERROR,"handler is not sync");return i}let Bi=new class extends vi{set networkState(e){this.emit(am.NETWORK_STATE_CHANGE,e,this._networkState),e===aa.ONLINE?this.emit(am.ONLINE):e===aa.OFFLINE&&(this.onlineWaiter=new Ie(t=>{this.once(am.ONLINE,()=>{this.onlineWaiter=void 0,t(aa.ONLINE)})}),this.emit(am.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===aa.ONLINE}constructor(){super(),st(this,"_moduleName","network-indicator"),st(this,"_networkState",aa.ONLINE),st(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=aa.ONLINE}),window.addEventListener("offline",()=>{this.networkState=aa.OFFLINE})}};function uy(e,t){let i=e.indexOf(t);i!==-1&&e.splice(i,1)}function sm(e){let t=[];return e.forEach(i=>{t.indexOf(i)===-1&&t.push(i)}),t}function hy(e){Ie!==void 0?Ie.resolve().then(e):setTimeout(e,0)}function Ei(e){return JSON.parse(JSON.stringify(e))}function Oh(e){try{return Ei(e)}catch{return e}}let IL={};function Vd(e,t){IL[t]||(IL[t]=!0,e())}function Nh(e){let t=window.atob(e),i=new Uint8Array(new ArrayBuffer(t.length));for(let n=0;n<t.length;n+=1)i[n]=t.charCodeAt(n);return i}function jd(e){let t="";for(let i=0;i<e.length;i+=1)t+=String.fromCharCode(e[i]);return window.btoa(t)}function OL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(e);if(i.length>t)i=i.slice(0,t);else if(i.length<t){let n=new Uint8Array(t);n.set(i),i=n}return i}function NL(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let n=xr(t).call(t,(c,l)=>c+l.length,0),r=new Uint8Array(new ArrayBuffer(n)),s=0;return t.forEach(c=>{r.set(c,s),s+=c.length}),r}function oc(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function DL(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(i=>{t+=typeof i=="string"?oc(i):i.size}),t+138}function jB(e){let t=new de(M.TIMEOUT,"timeout");return new Ie((i,n)=>{window.setTimeout(()=>n(t),e)})}function Sn(e){return new Ie(t=>{window.setTimeout(t,e)})}function ei(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?"".concat(t).concat(i):"".concat(t).concat(i)+ei(e-i.length,"")}function Dh(){return ei(32,"").toUpperCase()}let py=()=>{},LL=new class{constructor(){st(this,"fnMap",new Map)}throttleByKey(e,t,i,n){for(var r=arguments.length,s=new Array(r>4?r-4:0),c=4;c<r;c++)s[c-4]=arguments[c];if(this.fnMap.has(t)){let l=this.fnMap.get(t);if(l.threshold!==i){l.fn(...l.args),clearTimeout(l.timer);let d=window.setTimeout(()=>{let h=this.fnMap.get(t);h&&h.fn(...h.args),this.fnMap.delete(t)},i);this.fnMap.set(t,{fn:e,threshold:i,timer:d,args:s,skipFn:n})}else l.skipFn&&l.skipFn(...l.args),this.fnMap.set(t,Te(Te({},l),{},{fn:e,args:s,skipFn:n}))}else{let l=window.setTimeout(()=>{let d=this.fnMap.get(t);d&&d.fn(...d.args),this.fnMap.delete(t)},i);this.fnMap.set(t,{fn:e,threshold:i,timer:l,args:s,skipFn:n})}}},PL=LL.throttleByKey.bind(LL);function xL(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function cw(e,t){if(!xL(e)||!xL(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){let i=[...e];for(let n=0;n<t.length;n++)i[n]=cw(e[n],t[n]);return i}{let i=Te({},e);for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(Object.prototype.hasOwnProperty.call(e,n)?i[n]=cw(e[n],t[n]):i[n]=t[n]);return i}}function kL(e,t){let i=[0];if(i=new Array(t).fill(0),e===0)return i;let n=0;for(;e>0&&(i[n]=255&e,e>>=8,n++,n!==t););return i}function om(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function lw(e){return xr(e).call(e,(t,i)=>t+i,0)}function ML(e){let t="0123456789abcdef";function i(B){let J,K="";for(J=0;J<=3;J++)K+=t.charAt(B>>8*J+4&15)+t.charAt(B>>8*J&15);return K}function n(B,J){let K=(65535&B)+(65535&J);return(B>>16)+(J>>16)+(K>>16)<<16|65535&K}function r(B,J,K,H,ee,ue){return n((function(me,ye){return me<<ye|me>>>32-ye})(n(n(J,B),n(H,ue)),ee),K)}function s(B,J,K,H,ee,ue,me){return r(J&K|~J&H,B,J,ee,ue,me)}function c(B,J,K,H,ee,ue,me){return r(J&H|K&~H,B,J,ee,ue,me)}function l(B,J,K,H,ee,ue,me){return r(J^K^H,B,J,ee,ue,me)}function d(B,J,K,H,ee,ue,me){return r(K^(J|~H),B,J,ee,ue,me)}let h=(function(B){let J,K=1+(B.length+8>>6),H=new Array(16*K);for(J=0;J<16*K;J++)H[J]=0;for(J=0;J<B.length;J++)H[J>>2]|=B.charCodeAt(J)<<J%4*8;return H[J>>2]|=128<<J%4*8,H[16*K-2]=8*B.length,H})(e),f,E,S,y,D,O=1732584193,N=-271733879,k=-1732584194,U=271733878;for(f=0;f<h.length;f+=16)E=O,S=N,y=k,D=U,O=s(O,N,k,U,h[f+0],7,-680876936),U=s(U,O,N,k,h[f+1],12,-389564586),k=s(k,U,O,N,h[f+2],17,606105819),N=s(N,k,U,O,h[f+3],22,-1044525330),O=s(O,N,k,U,h[f+4],7,-176418897),U=s(U,O,N,k,h[f+5],12,1200080426),k=s(k,U,O,N,h[f+6],17,-1473231341),N=s(N,k,U,O,h[f+7],22,-45705983),O=s(O,N,k,U,h[f+8],7,1770035416),U=s(U,O,N,k,h[f+9],12,-1958414417),k=s(k,U,O,N,h[f+10],17,-42063),N=s(N,k,U,O,h[f+11],22,-1990404162),O=s(O,N,k,U,h[f+12],7,1804603682),U=s(U,O,N,k,h[f+13],12,-40341101),k=s(k,U,O,N,h[f+14],17,-1502002290),N=s(N,k,U,O,h[f+15],22,1236535329),O=c(O,N,k,U,h[f+1],5,-165796510),U=c(U,O,N,k,h[f+6],9,-1069501632),k=c(k,U,O,N,h[f+11],14,643717713),N=c(N,k,U,O,h[f+0],20,-373897302),O=c(O,N,k,U,h[f+5],5,-701558691),U=c(U,O,N,k,h[f+10],9,38016083),k=c(k,U,O,N,h[f+15],14,-660478335),N=c(N,k,U,O,h[f+4],20,-405537848),O=c(O,N,k,U,h[f+9],5,568446438),U=c(U,O,N,k,h[f+14],9,-1019803690),k=c(k,U,O,N,h[f+3],14,-187363961),N=c(N,k,U,O,h[f+8],20,1163531501),O=c(O,N,k,U,h[f+13],5,-1444681467),U=c(U,O,N,k,h[f+2],9,-51403784),k=c(k,U,O,N,h[f+7],14,1735328473),N=c(N,k,U,O,h[f+12],20,-1926607734),O=l(O,N,k,U,h[f+5],4,-378558),U=l(U,O,N,k,h[f+8],11,-2022574463),k=l(k,U,O,N,h[f+11],16,1839030562),N=l(N,k,U,O,h[f+14],23,-35309556),O=l(O,N,k,U,h[f+1],4,-1530992060),U=l(U,O,N,k,h[f+4],11,1272893353),k=l(k,U,O,N,h[f+7],16,-155497632),N=l(N,k,U,O,h[f+10],23,-1094730640),O=l(O,N,k,U,h[f+13],4,681279174),U=l(U,O,N,k,h[f+0],11,-358537222),k=l(k,U,O,N,h[f+3],16,-722521979),N=l(N,k,U,O,h[f+6],23,76029189),O=l(O,N,k,U,h[f+9],4,-640364487),U=l(U,O,N,k,h[f+12],11,-421815835),k=l(k,U,O,N,h[f+15],16,530742520),N=l(N,k,U,O,h[f+2],23,-995338651),O=d(O,N,k,U,h[f+0],6,-198630844),U=d(U,O,N,k,h[f+7],10,1126891415),k=d(k,U,O,N,h[f+14],15,-1416354905),N=d(N,k,U,O,h[f+5],21,-57434055),O=d(O,N,k,U,h[f+12],6,1700485571),U=d(U,O,N,k,h[f+3],10,-1894986606),k=d(k,U,O,N,h[f+10],15,-1051523),N=d(N,k,U,O,h[f+1],21,-2054922799),O=d(O,N,k,U,h[f+8],6,1873313359),U=d(U,O,N,k,h[f+15],10,-30611744),k=d(k,U,O,N,h[f+6],15,-1560198380),N=d(N,k,U,O,h[f+13],21,1309151649),O=d(O,N,k,U,h[f+4],6,-145523070),U=d(U,O,N,k,h[f+11],10,-1120210379),k=d(k,U,O,N,h[f+2],15,718787259),N=d(N,k,U,O,h[f+9],21,-343485551),O=n(O,E),N=n(N,S),k=n(k,y),U=n(U,D);return i(O)+i(N)+i(k)+i(U)}let BB=1,UL=console,Vn=class{static setLogger(e){UL=e}constructor(e,t){st(this,"id",void 0),st(this,"lockingPromise",Ie.resolve()),st(this,"locks",0),st(this,"name",""),st(this,"lockId",void 0),this.lockId=BB++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){let i=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),n=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");UL.debug("".concat(i," ").concat(n))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);let i=new Ie(r=>{t=()=>{this.locks-=1,this.logger("unlocked",e),r()}}),n=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>i),n}};function cm(e,t){return function(i,n,r){let s=r.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let c=this[t];if(!c)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));let l=await c.lock("From ".concat(e,".").concat(n));try{for(var d=arguments.length,h=new Array(d),f=0;f<d;f++)h[f]=arguments[f];return await s.apply(this,h)}finally{l()}},r}}let zi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function dw(e,t){let i=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,i)}function lo(e,t,i,n){let r=Object.assign({},zi,n),s=r.timeout,c=async()=>{await(function(h){return new Ie(f=>{window.setTimeout(f,h)})})(s),s*=r.timeoutFactor,s=Math.min(r.maxRetryTimeout,s)},l=!1,d=new Ie(async(h,f)=>{t=t||(()=>!1),i=i||(()=>!0);for(let E=0;E<r.maxRetryCount;E+=1){if(l)return f(new de(M.OPERATION_ABORTED));try{let S=await e();if(!t(S,E)||E+1===r.maxRetryCount)return h(S);await c()}catch(S){if(!i(S,E)||E+1===r.maxRetryCount)return f(S);await c()}}});return d.cancel=()=>l=!0,d}let fy,VL=class{constructor(e){st(this,"input",[]),st(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:xr(e=this.input).call(e,(t,i)=>t+i)/this.input.length}},my=0,uw=0;function hw(e,t,i,n){return new Ie((r,s)=>{t.responseType=t.responseType||"json",t.data&&!i?(t.data=JSON.stringify(t.data),my+=oc(t.data)):i&&(t.data.size?my+=t.data.size:t.data instanceof FormData?my+=DL(t.data):my+=oc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,br.request(t).then(c=>{typeof c.data=="string"?uw+=oc(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?uw+=c.data.byteLength:uw+=oc(JSON.stringify(c.data)),r(c.data)}).catch(c=>{br.isCancel(c)?s(new de(M.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?s(new de(M.NETWORK_TIMEOUT,c.message)):c.response?s(new de(M.NETWORK_RESPONSE_ERROR,c.response.status)):s(new de(M.NETWORK_ERROR,c.message))})})}async function FB(e,t){let i=new Blob([t.data],{type:"buffer"});return await hw(e,Te(Te({},t),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}let jL=()=>window.isSecureContext!==void 0;function bs(e){if(Array.isArray(e))return e.map(i=>i);if(!BL(e))return e;let t={};for(let i in e){let n=e[i];BL(n)||Array.isArray(n)?t[i]=bs(n):t[i]=n}return t}function BL(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let pw=class{constructor(e){st(this,"input",[]),st(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}},cc={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Mg={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:cc,remoteCandidate:cc},updateInterval:0},FL={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},GL={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},HL={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},WL={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0},fw=class{constructor(e,t){st(this,"onFirstVideoReceived",void 0),st(this,"onFirstVideoDecoded",void 0),st(this,"onFirstAudioReceived",void 0),st(this,"onFirstVideoDecodedTimeout",void 0),st(this,"onFirstAudioDecoded",void 0),st(this,"onSelectedLocalCandidateChanged",void 0),st(this,"onSelectedRemoteCandidateChanged",void 0),st(this,"videoIsReady",!1),st(this,"videoIsReady2",{}),st(this,"pc",void 0),st(this,"options",void 0),st(this,"intervalTimer",void 0),st(this,"stats",bs(Mg)),st(this,"isFirstVideoReceived",{}),st(this,"isFirstVideoDecoded",{}),st(this,"isFirstAudioReceived",{}),st(this,"isFirstAudioDecoded",{}),st(this,"isFirstVideoDecodedTimeout",{}),st(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Ie(e=>{e({local:Te({},cc),remote:Te({},cc)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let t=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"],n=0,r=0,s=0,c=0;for(let l of i)e[l].forEach((d,h)=>{if(!this.lossRateWindowStats[t-1][l][h]||!this.lossRateWindowStats[0][l][h])return;let f=this.lossRateWindowStats[t-1][l][h].packets-this.lossRateWindowStats[0][l][h].packets,E=this.lossRateWindowStats[t-1][l][h].packetsLost-this.lossRateWindowStats[0][l][h].packetsLost;l==="videoSend"||l==="audioSend"?(n+=f,s+=E):(r+=f,c+=E),Number.isNaN(f)||Number.isNaN(f)?d.packetLostRate=0:d.packetLostRate=f<=0||E<=0?0:E/(f+E)});e.sendPacketLossRate=n<=0||s<=0?0:s/(n+s),e.recvPacketLossRate=r<=0||c<=0?0:c/(r+c)}},GB=class extends fw{constructor(){super(...arguments),st(this,"_stats",Mg),st(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=bs(Mg);let i=t.filter(r=>r.type==="ssrc");this.processSSRCStats(i);let n=t.find(r=>r.type==="VideoBwe");n&&this.processBandwidthStats(n),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var i;let n=Ce(i=t.id).call(i,"send");switch("".concat(t.mediaType,"_").concat(n?"send":"recv")){case"video_send":{let r=bs(GL);r.codec=t.googCodecName,r.adaptionChangeReason="none",t.googCpuLimitedResolution&&(r.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(r.adaptionChangeReason="bandwidth"),r.avgEncodeMs=Number(t.googAvgEncodeMs),r.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},r.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},r.firsCount=Number(t.googFirReceived),r.nacksCount=Number(t.googNacksReceived),r.plisCount=Number(t.googPlisReceived),r.frameCount=Number(t.framesEncoded),r.bytes=Number(t.bytesSent),r.packets=Number(t.packetsSent),r.packetsLost=Number(t.packetsLost),r.ssrc=Number(t.ssrc),r.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(r),this._stats.rtt=r.rttMs;break}case"video_recv":{let r=bs(FL),s=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(r.codec=t.googCodecName,r.targetDelayMs=Number(t.googTargetDelayMs),r.renderDelayMs=Number(t.googRenderDelayMs),r.currentDelayMs=Number(t.googCurrentDelayMs),r.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),r.decodeMs=Number(t.googDecodeMs),r.maxDecodeMs=Number(t.googMaxDecodeMs),r.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},r.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},r.decodeFrameRate=Number(t.googFrameRateDecoded),r.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},r.jitterBufferMs=Number(t.googJitterBufferMs),r.firsCount=Number(t.googFirsSent),r.nacksCount=Number(t.googNacksSent),r.plisCount=Number(t.googPlisSent),r.framesDecodeCount=Number(t.framesDecoded),r.bytes=Number(t.bytesReceived),r.packets=Number(t.packetsReceived),r.packetsLost=Number(t.packetsLost),r.ssrc=Number(t.ssrc),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,r.decodedFrame.width,r.decodedFrame.height),this.isFirstVideoDecoded[r.ssrc]=!0),s){let c=s.stats,l=Date.now()-s.lts;r.framesDecodeFreezeTime=c.framesDecodeFreezeTime,r.framesDecodeInterval=c.framesDecodeInterval,r.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=l,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<s.stats.framesDecodeCount&&(r.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:Te({},r),lts:Date.now()}),this._stats.videoRecv.push(r);break}case"audio_recv":{let r=bs(WL);r.codec=t.googCodecName,r.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,r.decodingCNG=Number(t.googDecodingCNG),r.decodingCTN=Number(t.googDecodingCTN),r.decodingCTSG=Number(t.googDecodingCTSG),r.decodingNormal=Number(t.googDecodingNormal),r.decodingPLC=Number(t.googDecodingPLC),r.decodingPLCCNG=Number(t.googDecodingPLCCNG),r.expandRate=Number(t.googExpandRate),r.accelerateRate=Number(t.googAccelerateRate),r.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),r.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),r.speechExpandRate=Number(t.googSpeechExpandRate),r.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),r.jitterBufferMs=Number(t.googJitterBufferMs),r.jitterMs=Number(t.googJitterReceived),r.bytes=Number(t.bytesReceived),r.packets=Number(t.packetsReceived),r.packetsLost=Number(t.packetsLost),r.ssrc=Number(t.ssrc),r.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),r.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.decodingNormal>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),this._stats.audioRecv.push(r);break}case"audio_send":{let r=bs(HL);r.codec=t.googCodecName,r.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,r.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),r.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),r.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),r.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),r.bytes=Number(t.bytesSent),r.packets=Number(t.packetsSent),r.packetsLost=Number(t.packetsLost),r.ssrc=Number(t.ssrc),r.rttMs=Number(t.googRtt||0),this._stats.rtt=r.rttMs,this._stats.audioSend.push(r);break}}})}_getStats(){return new Ie((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){let t=[];return e.result().forEach(i=>{let n={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(r=>{n[r]=i.stat(r)}),t.push(n)}),t}},Ug=(function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e})({}),_y=(function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e})({}),mw=(function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e})({}),Ta=(function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e})({});var lm=(function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e})(lm||{});function Vg(e,t,i,n){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:lm.kNone;if(!t)return;let s=Number(t[i]);if(typeof s!="number")return;let c=Number(t[n]);if(typeof c!="number")return;if(!e)return c?s/c*r:void 0;let l=Number(e[i]);if(typeof l!="number")return;let d=Number(e[n]);if(typeof d!="number")return;let h=c-d;return h?(s-l)/h*r:void 0}let zL=class extends fw{constructor(){super(...arguments),st(this,"_stats",Mg),st(this,"report",void 0),st(this,"lastDecodeVideoReceiverStats",new Map),st(this,"lastVideoFramesRecv",new Map),st(this,"lastVideoFramesSent",new Map),st(this,"lastVideoFramesDecode",new Map),st(this,"lastVideoFramesOutput",new Map),st(this,"lastVideoJBDelay",new Map),st(this,"lastAudioJBDelay",new Map),st(this,"mediaBytesSent",new Map),st(this,"mediaBytesRetransmit",new Map),st(this,"mediaBytesTargetEncode",new Map),st(this,"lastDecodeAudioReceiverStats",new Map),st(this,"lastAudioConcealment",new Map),st(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=bs(Mg),this.report.forEach(e=>{switch(e.type){case Ta.OUTBOUND:case Ta.INBOUND:{let t=e.mediaType||e.kind,i=!t&&"frameWidth"in e,n=!t&&!("frameWidth"in e);e.type===Ta.OUTBOUND?t==="audio"||n?this.processAudioOutboundStats(e):(t==="video"||i)&&this.processVideoOutboundStats(e):e.type===Ta.INBOUND&&(t==="audio"||n?this.processAudioInboundStats(e):(t==="video"||i)&&this.processVideoInboundStats(e));break}case Ta.TRANSPORT:{let t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case Ta.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let e=await this.pc.getStats(),t={local:Te({},cc),remote:Te({},cc)};return e.forEach(i=>{let n;if(i.type===Ta.TRANSPORT&&(n=e.get(i.selectedCandidatePairId)),i.type===Ta.CANDIDATE_PAIR&&i.selected&&(n=i),n){let r=(s,c)=>{s.type=c.type,s.id=c.id,c.address&&(s.address=c.address),c.candidateType&&(s.candidateType=c.candidateType),c.port&&(s.port=c.port),c.priority&&(s.priority=c.priority),c.protocol&&(s.protocol=c.protocol),c.relayProtocol&&(s.relayProtocol=c.relayProtocol)};if(n.localCandidateId){let s=e.get(n.localCandidateId);s&&r(t.local,s)}if(n.remoteCandidateId){let s=e.get(n.remoteCandidateId);s&&r(t.remote,s)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){let t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){let t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===Ta.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===Ta.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===Ta.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Te({},t),Te({},this.stats.selectedCandidatePair.localCandidate)),e.type===Ta.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Te({},t),Te({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(n=>n.ssrc===e.ssrc);t||(t=bs(WL),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;let i=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Vg(i,t,"totalProcessingDelay","jitterBufferEmittedCount",lm.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,i,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,Te({},t))}calculateAudioFreeze(e,t,i){let n=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&n!=null){let r=n.lts,s=i.timestamp,c=s-r;if(c<=0)return;let l=e.concealedSamples-t.concealedSamples-0,d=n.nonSilent+l,h=e.totalSamplesReceived-t.totalSamplesReceived;if(h<=0)return;let f=80*h/c,E=200*h/c,S=c/h,y=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,d>f&&(n.plc80>0?(e.freezeSamples80+=l,e.freezeMs80+=Math.round(l*S)):(e.freezeSamples80+=d,e.freezeMs80+=Math.round(d*S)),y=n.plc80+1);let D=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,d>E&&(n.plc200>0?(e.freezeSamples200+=l,e.freezeMs200+=Math.round(l*S)):(e.freezeSamples200+=d,e.freezeMs200+=Math.round(d*S)),D=n.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:l,lts:s,plc80:y,plc200:D})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:i.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(c=>c.ssrc===e.ssrc);t||(t=bs(FL),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;let i=this.lastDecodeVideoReceiverStats.get(t.ssrc),n=this.lastVideoFramesDecode.get(t.ssrc),r=this.lastVideoFramesOutput.get(t.ssrc),s=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){let c=t.decodedFrame?t.decodedFrame.width:0,l=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,c,l),this.isFirstVideoDecoded[t.ssrc]=!0}if(i){let c=i.stats,l=s-i.lts;t.framesDecodeFreezeTime=c.framesDecodeFreezeTime,t.framesDecodeInterval=c.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&l>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(i.lts=Date.now(),t.framesDecodeInterval=l,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<c.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(i.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-i.qpSum)/(e.framesDecoded-i.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Vg(i?.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Vg(i?.stats,t,"totalProcessingDelay","framesDecodeCount",lm.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Vg(i?.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",lm.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Vg(i?.stats,t,"totalInterFrameDelay","framesDecodeCount",lm.kMillisecondsFromSeconds),n&&s-n.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-n.count)/((s-n.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:t.decodeFrameRate})):n?t.decodeFrameRate=n.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:0}),t.framesDroppedCount&&e.framesReceived&&(r&&s-r.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-r.count)/((s-r.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:Math.max(t.outputFrameRate,0)})):r?t.outputFrameRate=r.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Te({},t),lts:i?i.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(n=>n.ssrc===e.ssrc);t||(t=bs(GL),this._stats.videoSend.push(t));let i=this.mediaBytesSent.get(e.ssrc);if(i)i.add(e.bytesSent);else{let n=new pw(10);n.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,n)}if(e.retransmittedBytesSent!==void 0){let n=this.mediaBytesRetransmit.get(e.ssrc);if(n)n.add(e.retransmittedBytesSent);else{let r=new pw(10);r.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,r)}}if(e.totalEncodedBytesTarget){let n=this.mediaBytesTargetEncode.get(e.ssrc);if(n)n.add(e.totalEncodedBytesTarget);else{let r=new pw(10);r.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,r)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){let n=this.lastEncoderMs.get(e.ssrc);if(!n||n.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{let r=e.framesEncoded-n.lastFrameCount,s=e.totalEncodeTime-n.lastEncoderTime;t.avgEncodeMs=1e3*s/r}}if(e.framesEncoded&&e.qpSum){let n=this.lastEncoderMs.get(e.ssrc);!n||n.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-n.lastQpSum)/(e.framesEncoded-n.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let n=this.findRemoteStatsId(e.ssrc,Ta.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(i=>i.ssrc===e.ssrc);if(t||(t=bs(HL),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let i=this.findRemoteStatsId(e.ssrc,Ta.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,t)}}findRemoteStatsId(e,t){var i;let n=Array.from(Cr(i=this.report).call(i)).find(r=>r.type===t&&r.ssrc===e);return n?n.id:null}processVideoMediaSource(e,t){let i=this.report.get(e);i&&i.width&&i.height&&i.framesPerSecond&&(t.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(e,t){let i=this.report.get(e);i&&(t.inputLevel=i.audioLevel)}processVideoTrackSenderStats(e,t,i){var n,r,s,c;let l=t?this.report.get(t):void 0,d=(n=l?.framesSent)!==null&&n!==void 0?n:e.framesSent;if(typeof d!="number")return;let h=(r=l?.frameWidth)!==null&&r!==void 0?r:e.frameWidth,f=(s=l?.frameHeight)!==null&&s!==void 0?s:e.frameHeight,E=(c=l?.framesPerSecond)!==null&&c!==void 0?c:e.framesPerSecond;if(typeof h=="number"&&typeof f=="number"||(h=0,f=0),E==null){let S=Date.now(),y=this.lastVideoFramesSent.get(i.ssrc);y&&S-y.lts>=800?(E=Math.round((d-y.count)/((S-y.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:d,lts:S,rate:E})):y?E=y.rate:this.lastVideoFramesSent.set(i.ssrc,{count:d,lts:S,rate:0})}i.sentFrame={width:h,height:f,frameRate:Math.max(0,E)}}processVideoTrackReceiverStats(e,t,i){var n,r,s,c,l;let d=t?this.report.get(t):void 0,h=(n=d?.framesReceived)!==null&&n!==void 0?n:e.framesReceived,f=(r=d?.frameWidth)!==null&&r!==void 0?r:e.frameWidth,E=(s=d?.frameHeight)!==null&&s!==void 0?s:e.frameHeight,S=(c=d?.jitterBufferDelay)!==null&&c!==void 0?c:e.jitterBufferDelay,y=(l=d?.jitterBufferEmittedCount)!==null&&l!==void 0?l:e.jitterBufferEmittedCount;if(typeof h=="number"){let D=this.lastVideoFramesRecv.get(i.ssrc),O=Date.now();i.framesReceivedCount=h;let N=0;D&&O-D.lts>=800?(N=Math.round((h-D.count)/((O-D.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:h,lts:O,rate:N})):D?N=D.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:h,lts:O,rate:0}),i.receivedFrame={width:f||0,height:E||0,frameRate:N||0},i.decodedFrame={width:f||0,height:E||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:f||0,height:E||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(S&&y){let D=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},O=D.jitterBufferMs,N=y-D.jitterBufferEmittedCount;N>0&&(O=1e3*(S-D.jitterBufferDelay)/N),i.jitterBufferMs=O,i.currentDelayMs=Math.round(O),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:S,jitterBufferEmittedCount:y,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(e,t,i){var n,r,s,c;let l=t?this.report.get(t):void 0,d=(n=(r=l?.echoReturnLoss)!==null&&r!==void 0?r:e.echoReturnLoss)!==null&&n!==void 0?n:0,h=(s=(c=l?.echoReturnLossEnhancement)!==null&&c!==void 0?c:e.echoReturnLossEnhancement)!==null&&s!==void 0?s:0;i.aecReturnLoss=d,i.aecReturnLossEnhancement=h}processAudioTrackReceiverStats(e,t,i){var n,r,s,c,l,d,h,f,E;let S=t?this.report.get(t):void 0,y=(n=S?.removedSamplesForAcceleration)!==null&&n!==void 0?n:e.removedSamplesForAcceleration,D=(r=S?.totalSamplesReceived)!==null&&r!==void 0?r:e.totalSamplesReceived,O=(s=S?.jitterBufferDelay)!==null&&s!==void 0?s:e.jitterBufferDelay,N=(c=S?.jitterBufferEmittedCount)!==null&&c!==void 0?c:e.jitterBufferEmittedCount,k=(l=S?.audioLevel)!==null&&l!==void 0?l:e?.audioLevel,U=(d=S?.totalSamplesDuration)!==null&&d!==void 0?d:e?.totalSamplesDuration,B=(h=S?.concealedSamples)!==null&&h!==void 0?h:e.concealedSamples,J=(f=S?.silentConcealedSamples)!==null&&f!==void 0?f:e.silentConcealedSamples,K=(E=S?.concealmentEvents)!==null&&E!==void 0?E:e.concealmentEvents;if(typeof D=="number"&&(i.totalSamplesReceived=D),typeof J=="number"&&(i.silentConcealedSamples=J),typeof K=="number"&&(i.concealmentEvents=K),typeof B=="number"&&(i.concealedSamples=B),y&&D&&(i.accelerateRate=y/D),O&&N){let ee=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},ue=ee.jitterBufferMs,me=N-ee.jitterBufferEmittedCount;me>0&&(ue=1e3*(O-ee.jitterBufferDelay)/me),i.jitterBufferMs=Math.round(ue),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:O,jitterBufferEmittedCount:N,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=k;let H=1920;U&&D&&(H=D/U/50,i.receivedFrames=Math.round(D/H)),B&&(i.droppedFrames=Math.round(B/H))}processRemoteInboundStats(e,t){let i=this.report.get(e);i&&(t.packetsLost=i.packetsLost,i.roundTripTime&&(t.rttMs=1e3*i.roundTripTime),i.jitter&&(t.jitterMs=1e3*i.jitter),i.timestamp&&(t.timestamp=i.timestamp))}getCodecFromCodecStats(e){let t=this.report.get(e);if(!t)return"";let i=t.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let e=0,t=null,i=null;this.mediaBytesSent.forEach(r=>{e+=r.diffMean()}),this.mediaBytesRetransmit.forEach(r=>{t=t===null?r.diffMean():t+r.diffMean()}),this.mediaBytesTargetEncode.forEach(r=>{i=i===null?r.diffMean():i+r.diffMean()});let n=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*n/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},HB=class extends fw{updateStats(){return Ie.resolve()}};function _w(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,s=(function(){let c=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return c&&c[0]?Number(c[0].split("/")[1]):null})();return s?s<76?new GB(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:n,firstVideoDecodedTimeout:r}):new zL(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:n,firstVideoDecodedTimeout:r}):(function(c){if(!window.RTCStatsReport)return!1;let l=c.getStats();return!!(l instanceof Ie||(function(d){return!!d&&(typeof d=="object"||typeof d=="function")&&typeof d.then=="function"})(l))})(e)?new zL(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:n,firstVideoDecodedTimeout:r}):new HB(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:n,firstVideoDecodedTimeout:r})}let KL="websdk_ng_install_id";function Ew(){try{if(j("INSTALL_ID"))return j("INSTALL_ID");let e=window.localStorage.getItem(KL);return e||(e=Dh(),window.localStorage.setItem(KL,e)),Kt("INSTALL_ID",e),e}catch{return}}let Ya=(function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){let i=t[1],n=t[2];return"".concat(i,".").concat(n)}return"4.0.0.999"})("4.24.0"),gw=(function(){try{return JSON.parse("true")===!0}catch{return!0}})(),Lh=(function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e})({}),Nn=(function(){let e="us".concat("erna","me"),t="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");let n=i.join(""),r=[];for(let l=0;l<6;l++)r.push("1");let s=r.join(""),c={};return c[e]=n,c[t]=s,Object.assign(c,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})})();window.DEFAULT_TURN_CONFIG=Nn;let Ey={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},Sw={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},vw="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",Tw={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},pi=Te(Te(Te(Te({},Tw),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:Sw,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Ey),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function Kt(e,t,i){var n,r,s;Ce(n=Object.keys(pi)).call(n,e)&&(!i&&Ce(r=Object.keys(uo)).call(r,e)||(pi[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(pi.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(s=!!t,pi.USE_NEW_NETWORK_CONFIG=s,s&&(pi.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],pi.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],pi.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],pi.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],pi.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",pi.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",pi.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(pi.ENABLE_INSTANT_VIDEO=!0,pi.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(pi.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(pi.NEW_TURN_MODE||(pi.NEW_TURN_MODE=4))))}function j(e){return pi[e]}gw||(pi.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],pi.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],pi.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],pi.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],pi.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],pi.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],pi.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",pi.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",pi.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",pi.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",pi.AREAS=["NORTH_AMERICA","OVERSEA"]);let YL=(function(e){return e[e.REALTIME=1]="REALTIME",e})({}),uo={};var ot=(function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e})(ot||{});let jg=(function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e})({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});let qL=128,WB=96,XL=1e3,dm=10,zB=0;var JL=(()=>{var e={8:(n,r,s)=>{s.r(r),s.d(r,{Parser:()=>me,Printer:()=>jt,parse:()=>Ae,print:()=>Me});let c=`
`,l="".concat("\r").concat(c),d=" ",h;function f(Ee){return Ee>="0"&&Ee<="9"}function E(Ee){return Ee>="!"&&Ee<="~"}function S(Ee){return E(Ee)||Ee>=""&&Ee<=""}function y(Ee){return Ee==="!"||Ee>="#"&&Ee<="'"||Ee>="*"&&Ee<="+"||Ee>="-"&&Ee<="."||Ee>="0"&&Ee<="9"||Ee>="A"&&Ee<="Z"||Ee>="^"&&Ee<="~"}function D(Ee){return Ee>="1"&&Ee<="9"}function O(Ee){return Ee>="A"&&Ee<="Z"||Ee>="a"&&Ee<="z"}function N(Ee){return Ee==="d"||Ee==="h"||Ee==="m"||Ee==="s"}function k(Ee){return Ee>""&&Ee<"	"||Ee>"\v"&&Ee<"\f"||Ee>""&&Ee<""}function U(Ee){return O(Ee)||f(Ee)||Ee==="+"||Ee==="/"}function B(Ee){return f(Ee)||O(Ee)||Ee==="+"||Ee==="/"||Ee==="-"||Ee==="_"}function J(Ee){return O(Ee)||f(Ee)||Ee==="+"||Ee==="/"}function K(Ee,I){var G=Object.keys(Ee);if(Object.getOwnPropertySymbols){var X=Object.getOwnPropertySymbols(Ee);I&&(X=X.filter(function(Re){return Object.getOwnPropertyDescriptor(Ee,Re).enumerable})),G.push.apply(G,X)}return G}function H(Ee){for(var I=1;I<arguments.length;I++){var G=arguments[I]!=null?arguments[I]:{};I%2?K(Object(G),!0).forEach(function(X){ee(Ee,X,G[X])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ee,Object.getOwnPropertyDescriptors(G)):K(Object(G)).forEach(function(X){Object.defineProperty(Ee,X,Object.getOwnPropertyDescriptor(G,X))})}return Ee}function ee(Ee,I,G){return I in Ee?Object.defineProperty(Ee,I,{value:G,enumerable:!0,configurable:!0,writable:!0}):Ee[I]=G,Ee}(function(Ee){Ee.VERSION="v",Ee.ORIGIN="o",Ee.SESSION_NAME="s",Ee.INFORMATION="i",Ee.URI="u",Ee.EMAIL="e",Ee.PHONE="p",Ee.CONNECTION="c",Ee.BANDWIDTH="b",Ee.TIME="t",Ee.REPEAT="r",Ee.ZONE_ADJUSTMENTS="z",Ee.KEY="k",Ee.ATTRIBUTE="a",Ee.MEDIA="m"})(h||(h={}));class ue{consumeText(I,G){let X=G;for(;X<I.length;){let Re=I[X];if(Re==="\0"||Re==="\r"||Re===c)break;X+=1}if(X-G==0)throw new Error("Invalid text, at ".concat(I));return X}consumeUnicastAddress(I,G,X){return this.consumeTill(I,G,d)}consumeOneOrMore(I,G,X){let Re=G;for(;X(I[Re]);)Re++;if(Re-G==0)throw new Error("Invalid rule at ".concat(G,"."));return Re}consumeSpace(I,G){if(I[G]===d)return G+1;throw new Error("Invalid space at ".concat(G,"."))}consumeIP4Address(I,G){let X=G;for(let Re=0;Re<4;Re++)if(X=this.consumeDecimalUChar(I,X),Re!==3){if(I[X]!==".")throw new Error("Invalid IP4 address.");X++}return X}consumeDecimalUChar(I,G){let X=G;for(let dt=0;dt<3&&f(I[X]);dt++,X++);if(X-G==0)throw new Error("Invalid decimal uchar.");let Re=parseInt(I.slice(G,X));if(Re>=0&&Re<=255)return X;throw new Error("Invalid decimal uchar")}consumeIP6Address(I,G){let X=this.consumeHexpart(I,G);return I[X]===":"&&(X+=1,X=this.consumeIP4Address(I,X)),X}consumeHexpart(I,G){let X=G;if(I[X]===":"&&I[X+1]===":"){X+=2;try{X=this.consumeHexseq(I,X)}catch{}return X}if(X=this.consumeHexseq(I,X),I[X]===":"&&I[X+1]===":"){X+=2;try{X=this.consumeHexseq(I,X)}catch{}return X}return X}consumeHexseq(I,G){let X=G;for(;X=this.consumeHex4(I,X),I[X]===":"&&I[X+1]!==":";)X+=1;return X}consumeHex4(I,G){let X=0;for(;X<4;X++)if(!((Re=I[G+X])>="0"&&Re<="9"||Re>="a"&&Re<="f"||Re>="A"&&Re<="F")){if(X===0)throw new Error("Invalid hex 4");break}var Re;return G+X}consumeFQDN(I,G){let X=G;for(;f(I[X])||O(I[X])||I[X]==="-"||I[X]===".";)X+=1;if(X-G<4)throw new Error("Invalid FQDN");return X}consumeExtnAddr(I,G){return this.consumeOneOrMore(I,G,S)}consumeMulticastAddress(I,G,X){switch(X){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(I,G);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(I,G);default:try{return this.consumeFQDN(I,G)}catch{return this.consumeExtnAddr(I,G)}}}consumeIP6MulticastAddress(I,G){let X=this.consumeHexpart(I,G);return I[X]==="/"?this.consumeInteger(I,X+1):X}consumeIP4MulticastAddress(I,G){let X=G+3,Re=I.slice(G,X),dt=parseInt(Re);if(dt<224||dt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let li=0;li<3;li++){if(I[X]!==".")throw new Error("Invalid IP4 multicast address.");X+=1,X=this.consumeDecimalUChar(I,X)}return I[X]==="/"&&(X+=1),X=this.consumeTTL(I,X),I[X]==="/"&&(X=this.consumeInteger(I,X)),X}consumeInteger(I,G){if(!D(I[G]))throw new Error("Invalid integer.");for(G+=1;f(I[G]);)G+=1;return G}consumeTTL(I,G){if(I[G]==="0")return G+1;if(!D(I[G]))throw new Error("Invalid TTL.");G+=1;for(let X=0;X<2&&f(I[G]);X++)G+=1;return G}consumeToken(I,G){return this.consumeOneOrMore(I,G,y)}consumeTime(I,G){let X=G;if(I[X]==="0")return X+1;for(D(I[X])&&(X+=1);f(I[X]);)X++;if(X-G<10)throw new Error("Invalid time");return X}consumeAddress(I,G){return this.consumeTill(I,G,d)}consumeTypedTime(I,G){let X=G;return X=this.consumeOneOrMore(I,X,f),N(I[X])?X+1:X}consumeRepeatInterval(I,G){if(!D(I[G]))throw new Error("Invalid repeat interval");for(G+=1;f(I[G]);)G+=1;return N(I[G])&&(G+=1),G}consumePort(I,G){return this.consumeOneOrMore(I,G,f)}consume(I,G,X){for(let Re=0;Re<X.length;Re++){if(G+Re>=I.length)throw new Error("consume exceeding value length");if(I[G+Re]!==X[Re])throw new Error("consume ".concat(X," failed at ").concat(Re))}return G+X.length}consumeTill(I,G,X){let Re=G;for(;Re<I.length&&(typeof X!="string"||I[Re]!==X)&&(typeof X!="function"||!X(I[Re]));)Re++;return Re}}class me extends ue{constructor(){super(),ee(this,"records",[]),ee(this,"currentLine",0)}parse(I){let G=this.probeEOL(I);this.records=I.split(G).filter(Cl=>!!rr(Cl).call(Cl)).map(this.parseLine),this.currentLine=0;let X=this.parseVersion(),Re=this.parseOrigin(),dt=this.parseSessionName(),li=this.parseInformation(),Qi=this.parseUri(),is=this.parseEmail(),Us=this.parsePhone(),R0=this.parseConnection(),Qh=this.parseBandWidth(),Gm=this.parseTimeFields(),DR=this.parseKey(),LR=this.parseSessionAttribute(),ns=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:X,origin:Re,sessionName:dt,information:li,uri:Qi,emails:is,phones:Us,connection:R0,bandwidths:Qh,timeFields:Gm,key:DR,attributes:LR,mediaDescriptions:ns}}getCurrentRecord(){let I=this.records[this.currentLine];if(!I)throw new Error("Record doesn't exit.");return I}probeEOL(I){for(let G=0;G<I.length;G++)if(I[G]===c)return I[G-1]==="\r"?l:c;throw new Error("Invalid newline character.")}parseLine(I,G){if(I.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let X=I[0];if(I[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:X,value:I.slice(2),line:G,cur:0}}parseSessionAttribute(){let I=new pt;for(;this.currentLine<this.records.length;){let G=this.getCurrentRecord();if(G.type!==h.ATTRIBUTE)break;let X={attField:this.extractOneOrMore(G,Re=>y(Re)&&Re!==":"),_cur:0};G.value[G.cur]===":"&&(G.cur+=1,X.attValue=this.extractOneOrMore(G,k)),I.parse(X),this.currentLine++}return I.digest()}parseMediaAttributes(I){let G=new mt(I);for(;this.currentLine<this.records.length;){let X=this.getCurrentRecord();if(X.type!==h.ATTRIBUTE)break;let Re={attField:this.extractOneOrMore(X,dt=>y(dt)&&dt!==":"),_cur:0};X.value[X.cur]===":"&&(X.cur+=1,Re.attValue=this.extractOneOrMore(X,k)),G.parse(Re),this.currentLine++}return G.digest()}parseKey(){let I=this.getCurrentRecord();if(I.type===h.KEY){if(I.value==="prompt"||I.value==="clear:"||I.value==="base64:"||I.value==="uri:")return I.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let I=this.getCurrentRecord();if(I.type===h.ZONE_ADJUSTMENTS){let G=[];for(;;)try{let X=this.extract(I,this.consumeTime);this.consumeSpaceForRecord(I);let Re=!1;I.value[I.cur]==="-"&&(Re=!0,I.cur+=1);let dt=this.extract(I,this.consumeTypedTime);G.push({time:X,typedTime:dt,back:Re})}catch{break}if(G.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,G}return[]}parseRepeat(){let I=[];for(;;){let G=this.getCurrentRecord();if(G.type!==h.REPEAT)break;{let X=this.extract(G,this.consumeRepeatInterval),Re=this.parseTypedTime(G);I.push({repeatInterval:X,typedTimes:Re}),this.currentLine++}}return I}parseTypedTime(I){let G=[];for(;;)try{this.consumeSpaceForRecord(I),G.push(this.extract(I,this.consumeTypedTime))}catch{break}if(G.length===0)throw new Error("Invalid typed time.");return G}parseTime(){let I=this.getCurrentRecord(),G=this.extract(I,this.consumeTime);this.consumeSpaceForRecord(I);let X=this.extract(I,this.consumeTime);return this.currentLine++,{startTime:G,stopTime:X}}parseBandWidth(){let I=[];for(;this.currentLine<this.records.length;){let G=this.getCurrentRecord();if(G.type!==h.BANDWIDTH)break;{let X=this.extractOneOrMore(G,y);if(G.value[G.cur]!==":")throw new Error("Invalid bandwidth field.");G.cur++;let Re=this.extractOneOrMore(G,f);I.push({bwtype:X,bandwidth:Re}),this.currentLine++}}return I}parseVersion(){let I=this.getCurrentRecord();if(I.type!==h.VERSION)throw new Error("first sdp record must be version");let G=I.value.slice(0,this.consumeOneOrMore(I.value,0,f));if(G.length!==I.value.length)throw new Error('invalid proto version, "v='.concat(I.value,'"'));return this.currentLine++,G}parseOrigin(){let I=this.getCurrentRecord();if(I.type!==h.ORIGIN)throw new Error("second line of sdp must be origin");let G=this.extractOneOrMore(I,S);this.consumeSpaceForRecord(I);let X=this.extractOneOrMore(I,f);this.consumeSpaceForRecord(I);let Re=this.extractOneOrMore(I,f);this.consumeSpaceForRecord(I);let dt=this.extractOneOrMore(I,y);this.consumeSpaceForRecord(I);let li=this.extractOneOrMore(I,y);this.consumeSpaceForRecord(I);let Qi=this.extract(I,this.consumeUnicastAddress);return this.currentLine++,{username:G,sessId:X,sessVersion:Re,nettype:dt,addrtype:li,unicastAddress:Qi}}parseSessionName(){let I=this.getCurrentRecord();if(I.type===h.SESSION_NAME){let G=this.extract(I,this.consumeText);return this.currentLine++,G}}parseInformation(){let I=this.getCurrentRecord();if(I.type!==h.INFORMATION)return;let G=this.extract(I,this.consumeText);return this.currentLine++,G}parseUri(){let I=this.getCurrentRecord();if(I.type===h.URI)return this.currentLine++,I.value}parseEmail(){let I=[];for(;;){let G=this.getCurrentRecord();if(G.type!==h.EMAIL)break;I.push(G.value),this.currentLine++}return I}parsePhone(){let I=[];for(;;){let G=this.getCurrentRecord();if(G.type!==h.PHONE)break;I.push(G.value),this.currentLine++}return I}parseConnection(){let I=this.getCurrentRecord();if(I.type===h.CONNECTION){let G=this.extractOneOrMore(I,y);this.consumeSpaceForRecord(I);let X=this.extractOneOrMore(I,y);this.consumeSpaceForRecord(I);let Re=this.extract(I,this.consumeAddress);return this.currentLine++,{nettype:G,addrtype:X,address:Re}}}parseMedia(){let I=this.getCurrentRecord(),G=this.extract(I,this.consumeToken);this.consumeSpaceForRecord(I);let X=this.extract(I,this.consumePort);I.value[I.cur]==="/"&&(I.cur+=1,X+=this.extract(I,this.consumeInteger)),this.consumeSpaceForRecord(I);let Re=[];for(Re.push(this.extract(I,this.consumeToken));I.value[I.cur]==="/";)I.cur+=1,Re.push(this.extract(I,this.consumeToken));if(Re.length===0)throw new Error("Invalid proto");let dt=this.parseFmt(I);return this.currentLine++,{mediaType:G,port:X,protos:Re,fmts:dt}}parseTimeFields(){let I=[];for(;this.getCurrentRecord().type===h.TIME;){let G=this.parseTime(),X=this.parseRepeat(),Re=this.parseZone();I.push({time:G,repeats:X,zones:Re})}return I}parseMediaDescription(){let I=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.MEDIA;){let G=this.parseMedia(),X=this.parseInformation(),Re=this.parseConnections(),dt=this.parseBandWidth(),li=this.parseKey(),Qi=this.parseMediaAttributes(G);I.push({media:G,information:X,connections:Re,bandwidths:dt,key:li,attributes:Qi})}return I}parseConnections(){let I=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.CONNECTION;)I.push(this.parseConnection());return I}parseFmt(I){let G=[];for(;;)try{this.consumeSpaceForRecord(I),G.push(this.extract(I,this.consumeToken))}catch{break}if(G.length===0)throw new Error("Invalid fmts");return G}extract(I,G){for(var X=arguments.length,Re=new Array(X>2?X-2:0),dt=2;dt<X;dt++)Re[dt-2]=arguments[dt];let li=G.call(this,I.value,I.cur,...Re),Qi=I.value.slice(I.cur,li);return I.cur=li,Qi}extractOneOrMore(I,G){let X=this.consumeOneOrMore(I.value,I.cur,G),Re=I.value.slice(I.cur,X);return I.cur=X,Re}consumeSpaceForRecord(I){if(I.value[I.cur]!==d)throw new Error("Invalid space at ".concat(I.cur,"."));I.cur+=1}}class ye extends ue{constructor(){super(...arguments),ee(this,"attributes",void 0),ee(this,"digested",!1)}extractOneOrMore(I,G,X){let Re=this.consumeOneOrMore(I.attValue,I._cur,G),dt=I.attValue.slice(I._cur,Re),[li,Qi]=X||[];if(typeof li=="number"&&dt.length<li)throw new Error("error in length, should be more or equal than ".concat(li," characters."));if(typeof Qi=="number"&&dt.length>Qi)throw new Error("error in length, should be less or equal than ".concat(Qi," characters."));return I._cur=Re,dt}consumeAttributeSpace(I){if(I.attValue[I._cur]!==d)throw new Error("Invalid space at ".concat(I._cur,"."));I._cur+=1}extract(I,G){if(!I.attValue)throw new Error("Nothing to extract from attValue.");for(var X=arguments.length,Re=new Array(X>2?X-2:0),dt=2;dt<X;dt++)Re[dt-2]=arguments[dt];let li=G.call(this,I.attValue,I._cur,...Re),Qi=I.attValue.slice(I._cur,li);return I._cur=li,Qi}atEnd(I){if(!I.attValue)throw new Error;return I._cur>=I.attValue.length}peekChar(I){if(!I.attValue)throw new Error;return I.attValue[I._cur]}peek(I,G){if(!I.attValue)throw new Error;for(let X=0;X<G.length;X++)if(G[X]!==I.attValue[I._cur+X])return!1;return!0}parseIceUfrag(I){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(I,U,[4,256])}parseIcePwd(I){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(I,U,[22,256])}parseIceOptions(I){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let G=[];for(;!this.atEnd(I);){G.push(this.extractOneOrMore(I,U));try{this.consumeAttributeSpace(I)}catch(X){if(this.atEnd(I))break;throw X}}this.attributes.iceOptions=G}parseFingerprint(I){let G=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);let X=this.extract(I,this.consumeTill);this.attributes.fingerprints.push({hashFunction:G,fingerprint:X})}parseExtmap(I){let G=this.extractOneOrMore(I,f),X;this.peekChar(I)==="/"&&(this.extract(I,this.consume,"/"),X=this.extract(I,this.consumeToken)),this.consumeAttributeSpace(I);let Re=this.extract(I,this.consumeTill,d),dt=H(H({entry:parseInt(G,10)},X&&{direction:X}),{},{extensionName:Re});this.peekChar(I)===d&&(this.consumeAttributeSpace(I),dt.extensionAttributes=this.extract(I,this.consumeTill)),this.attributes.extmaps.push(dt)}parseSetup(I){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let G=this.extract(I,this.consumeTill);if(G!=="active"&&G!=="passive"&&G!=="actpass"&&G!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=G}}class pt extends ye{constructor(){super(...arguments),ee(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(I){if(this.digested)throw new Error("already digested");try{switch(I.attField){case"group":this.parseGroup(I);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(I);break;case"ice-pwd":this.parseIcePwd(I);break;case"ice-options":this.parseIceOptions(I);break;case"fingerprint":this.parseFingerprint(I);break;case"setup":this.parseSetup(I);break;case"tls-id":this.parseTlsId(I);break;case"identity":this.parseIdentity(I);break;case"extmap":this.parseExtmap(I);break;case"msid-semantic":this.parseMsidSemantic(I);break;default:I.ignored=!0,this.attributes.unrecognized.push(I)}}catch(G){throw console.error("parsing session attribute ".concat(I.attField,' error, "a=').concat(I.attField,":").concat(I.attValue,'"')),G}if(!I.ignored&&I.attValue&&!this.atEnd(I))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(I){let G=this.extract(I,this.consumeToken),X=[];for(;!this.atEnd(I)&&this.peekChar(I)===d;)this.consumeAttributeSpace(I),X.push(this.extract(I,this.consumeToken));this.attributes.groups.push({semantic:G,identificationTag:X})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(I){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(I,B)}parseIdentity(I){let G=this.extractOneOrMore(I,J),X=[];for(;!this.atEnd(I)&&this.peekChar(I)===d;){this.consumeAttributeSpace(I);let Re=this.extract(I,this.consumeToken);this.extract(I,this.consume,"=");let dt=this.extractOneOrMore(I,li=>li!==d&&k(li));X.push({name:Re,value:dt})}this.attributes.identities.push({assertionValue:G,extensions:X})}parseMsidSemantic(I){this.peekChar(I)===d&&this.consumeAttributeSpace(I);let G={semantic:this.extract(I,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(I)}catch{break}if(this.peekChar(I)==="*"){this.extract(I,this.consume,"*"),G.applyForAll=!0;break}{let X=this.extract(I,this.consumeTill,d);G.identifierList.push(X)}}this.attributes.msidSemantic=G}}class mt extends ye{constructor(I){super(),ee(this,"attributes",void 0),I.protos.indexOf("RTP")!==-1||I.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(I){if(this.digested)throw new Error("already digested");try{switch(I.attField){case"extmap":this.parseExtmap(I);break;case"setup":this.parseSetup(I);break;case"ice-ufrag":this.parseIceUfrag(I);break;case"ice-pwd":this.parseIcePwd(I);break;case"ice-options":this.parseIceOptions(I);break;case"candidate":this.parseCandidate(I);break;case"remote-candidate":this.parseRemoteCandidate(I);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(I);break;case"rtpmap":this.parseRtpmap(I);break;case"ptime":this.parsePtime(I);break;case"maxptime":this.parseMaxPtime(I);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(I);break;case"ssrc":this.parseSSRC(I);break;case"fmtp":this.parseFmtp(I);break;case"rtcp-fb":this.parseRtcpFb(I);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(I);break;case"mid":this.parseMid(I);break;case"msid":this.parseMsid(I);break;case"imageattr":this.parseImageAttr(I);break;case"rid":this.parseRid(I);break;case"simulcast":this.parseSimulcast(I);break;case"sctp-port":this.parseSctpPort(I);break;case"max-message-size":this.parseMaxMessageSize(I);break;case"ssrc-group":this.parseSSRCGroup(I);break;default:I.ignored=!0,this.attributes.unrecognized.push(I)}}catch(G){throw console.error("parsing media attribute ".concat(I.attField,' error, "a=').concat(I.attField,":").concat(I.attValue,'"')),G}if(!I.ignored&&I.attValue&&!this.atEnd(I))throw new Error("attribute parsing error")}parseCandidate(I){let G=this.extractOneOrMore(I,U,[1,32]);this.consumeAttributeSpace(I);let X=this.extractOneOrMore(I,f,[1,5]);this.consumeAttributeSpace(I);let Re=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);let dt=this.extractOneOrMore(I,f,[1,10]);this.consumeAttributeSpace(I);let li=this.extract(I,this.consumeAddress);this.consumeAttributeSpace(I);let Qi=this.extract(I,this.consumePort);this.consumeAttributeSpace(I),this.extract(I,this.consume,"typ"),this.consumeAttributeSpace(I);let is={foundation:G,componentId:X,transport:Re,priority:dt,connectionAddress:li,port:Qi,type:this.extract(I,this.consumeToken),extension:{}};for(this.peek(I," raddr")&&(this.extract(I,this.consume," raddr"),this.consumeAttributeSpace(I),is.relAddr=this.extract(I,this.consumeAddress)),this.peek(I," rport")&&(this.extract(I,this.consume," rport"),this.consumeAttributeSpace(I),is.relPort=this.extract(I,this.consumePort));this.peekChar(I)===d;){this.consumeAttributeSpace(I);let Us=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I),is.extension[Us]=this.extractOneOrMore(I,E)}this.attributes.candidates.push(is)}parseRemoteCandidate(I){let G=[];for(;;){let X=this.extractOneOrMore(I,f,[1,5]);this.consumeAttributeSpace(I);let Re=this.extract(I,this.consumeAddress);this.consumeAttributeSpace(I);let dt=this.extract(I,this.consumePort);G.push({componentId:X,connectionAddress:Re,port:dt});try{this.consumeAttributeSpace(I)}catch{break}}this.attributes.remoteCandidatesList.push(G)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(I){let G=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);let X=this.extract(I,this.consumeTill,"/");this.extract(I,this.consume,"/");let Re={encodingName:X,clockRate:this.extractOneOrMore(I,f)};this.atEnd(I)||this.peekChar(I)!=="/"||(this.extract(I,this.consume,"/"),Re.encodingParameters=parseInt(this.extract(I,this.consumeTill),10));let dt=this.attributes.payloads.find(li=>li.payloadType===parseInt(G,10));dt?dt.rtpMap=Re:this.attributes.payloads.push({payloadType:parseInt(G,10),rtpMap:Re,rtcpFeedbacks:[]})}parsePtime(I){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(I,this.consumeTill)}parseMaxPtime(I){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(I,this.consumeTill)}parseDirection(I){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=I.attField}parseSSRC(I){let G=this.extractOneOrMore(I,f);this.consumeAttributeSpace(I);let X=this.extract(I,this.consumeTill,":"),Re;this.peekChar(I)===":"&&(this.extract(I,this.consume,":"),Re=this.extract(I,this.consumeTill));let dt=this.attributes.ssrcs.find(li=>li.ssrcId===parseInt(G,10));dt?dt.attributes[X]=Re:this.attributes.ssrcs.push({ssrcId:parseInt(G,10),attributes:{[X]:Re}})}parseFmtp(I){let G=this.extract(I,this.consumeTill,d);this.consumeAttributeSpace(I);let X=this.extract(I,this.consumeTill),Re={};X.split(";").forEach(li=>{let[Qi,is]=li.split("=");Qi=rr(Qi).call(Qi);let Us=typeof is=="string"?rr(is).call(is):null;typeof Qi=="string"&&Qi.length>0&&(Re[Qi]=Us)});let dt=this.attributes.payloads.find(li=>li.payloadType===parseInt(G,10));dt?dt.fmtp={parameters:Re}:this.attributes.payloads.push({payloadType:parseInt(G,10),rtcpFeedbacks:[],fmtp:{parameters:Re}})}parseFmtParameters(I){let G={},X=this.extract(I,this.consumeTill,"=");I._cur++;let Re=this.extract(I,this.consumeTill,";");for(G[X]=Re;I.attValue[I._cur]===";";){let dt=this.extract(I,this.consumeTill,"=");I._cur++;let li=this.extract(I,this.consumeTill,";");G[dt]=li}return G}parseRtcpFb(I){let G="";G=this.peekChar(I)==="*"?this.extract(I,this.consume,"*"):this.extract(I,this.consumeTill,d),this.consumeAttributeSpace(I);let X=this.extract(I,this.consumeTill,d),Re;if(X==="trr-int")Re={type:X,interval:this.extract(I,this.consumeTill)};else{let dt={type:X};this.peekChar(I)===d&&(this.consumeAttributeSpace(I),dt.parameter=this.extract(I,this.consumeToken),this.peekChar(I)===d&&(dt.additional=this.extract(I,this.consumeTill))),Re=dt}if(G==="*")this.attributes.rtcpFeedbackWildcards.push(Re);else{let dt=this.attributes.payloads.find(li=>li.payloadType===parseInt(G,10));dt?dt.rtcpFeedbacks.push(Re):this.attributes.payloads.push({payloadType:parseInt(G,10),rtcpFeedbacks:[Re]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(I){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let G={port:this.extract(I,this.consumePort)};this.peekChar(I)===d&&(this.consumeAttributeSpace(I),G.netType=this.extractOneOrMore(I,y),this.consumeAttributeSpace(I),G.addressType=this.extractOneOrMore(I,y),this.consumeAttributeSpace(I),G.address=this.extract(I,this.consumeAddress)),this.attributes.rtcp=G}parseMsid(I){let G={id:this.extractOneOrMore(I,y,[1,64])};this.peekChar(I)===d&&(this.consumeAttributeSpace(I),G.appdata=this.extractOneOrMore(I,y,[1,64])),this.attributes.msids.push(G)}parseImageAttr(I){this.attributes.imageattr.push(I.attValue)}parseRid(I){let G=this.extractOneOrMore(I,Re=>O(Re)||f(Re)||Re==="_"||Re==="-");this.consumeAttributeSpace(I);let X={id:G,direction:this.extract(I,this.consumeToken),params:[]};if(this.peekChar(I)===d){if(this.consumeAttributeSpace(I),this.peek(I,"pt=")){this.extract(I,this.consume,"pt=");let Re=[];for(;;){let dt=this.extract(I,this.consumeToken);Re.push(dt);try{this.extract(I,this.consume,",")}catch{break}}X.payloads=Re,this.peekChar(I)===d&&this.extract(I,this.consume,d)}for(;;){let Re=this.extract(I,this.consumeToken);switch(Re){case"depend":{let dt={type:Re,rids:this.extract(I,this.consume,"=").split(",")};X.params.push(dt);break}default:{let dt={type:Re};this.peekChar(I)==="="&&(this.extract(I,this.consume,"="),dt.val=this.extract(I,this.consumeTill,";")),X.params.push(dt)}}try{this.extract(I,this.consume,";")}catch{break}}}this.attributes.rids.push(X)}parseSimulcast(I){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=I.attValue,this.extract(I,this.consumeTill)}parseSctpPort(I){this.attributes.sctpPort=this.extractOneOrMore(I,f,[1,5])}parseMaxMessageSize(I){this.attributes.maxMessageSize=this.extractOneOrMore(I,f,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(I){this.attributes.mid=this.extract(I,this.consumeToken)}parseSSRCGroup(I){let G=this.extract(I,this.consumeToken),X=[];for(;;)try{this.consumeAttributeSpace(I);let Re=this.extract(I,this.consumeInteger);X.push(parseInt(Re,10))}catch{break}this.attributes.ssrcGroups.push({semantic:G,ssrcIds:X})}}function nt(Ee,I,G){return I in Ee?Object.defineProperty(Ee,I,{value:G,enumerable:!0,configurable:!0,writable:!0}):Ee[I]=G,Ee}class jt{constructor(){nt(this,"eol",l)}print(I,G){let X="";return G&&(this.eol=G),X+=this.printVersion(I.version),X+=this.printOrigin(I.origin),X+=this.printSessionName(I.sessionName),X+=this.printInformation(I.information),X+=this.printUri(I.uri),X+=this.printEmail(I.emails),X+=this.printPhone(I.phones),X+=this.printConnection(I.connection),X+=this.printBandwidth(I.bandwidths),X+=this.printTimeFields(I.timeFields),X+=this.printKey(I.key),X+=this.printSessionAttributes(I.attributes),X+=this.printMediaDescription(I.mediaDescriptions),X}printVersion(I){return"v=".concat(I).concat(this.eol)}printOrigin(I){return"o=".concat(I.username," ").concat(I.sessId," ").concat(I.sessVersion," ").concat(I.nettype," ").concat(I.addrtype," ").concat(I.unicastAddress).concat(this.eol)}printSessionName(I){return I?"s=".concat(I).concat(this.eol):""}printInformation(I){return I?"i=".concat(I).concat(this.eol):""}printUri(I){return I?"u=".concat(I).concat(this.eol):""}printEmail(I){let G="";for(let X of I)G+="e=".concat(X).concat(this.eol);return G}printPhone(I){let G="";for(let X of I)G+="e=".concat(X).concat(this.eol);return G}printConnection(I){return I?"c=".concat(I.nettype," ").concat(I.addrtype," ").concat(I.address).concat(this.eol):""}printBandwidth(I){let G="";for(let X of I)G+="b=".concat(X.bwtype,":").concat(X.bandwidth).concat(this.eol);return G}printTimeFields(I){let G="";for(let X of I){G+="t=".concat(X.time.startTime," ").concat(X.time.startTime).concat(this.eol);for(let Re of X.repeats)G+="r=".concat(Re.repeatInterval," ").concat(Re.typedTimes.join(" ")).concat(this.eol);X.zoneAdjustments&&(G+="z=",G+="z=".concat(X.zoneAdjustments.map(Re=>"".concat(Re.time," ").concat(Re.back?"-":""," ").concat(Re.typedTime)).join(" ")).concat(this.eol),G+=this.eol)}return G}printKey(I){return I?"k=".concat(I).concat(this.eol):""}printAttributes(I){let G="";for(let X of I)G+="a=".concat(X.attField).concat(X.attValue?":".concat(X.attValue):"").concat(this.eol);return G}printMediaDescription(I){let G="";for(let X of I)G+=this.printMedia(X.media),G+=this.printInformation(X.information),G+=this.printConnections(X.connections),G+=this.printBandwidth(X.bandwidths),G+=this.printKey(X.key),G+=this.printMediaAttributes(X);return G}printConnections(I){let G="";for(let X of I)G+=this.printConnection(X);return G}printMedia(I){return"m=".concat(I.mediaType," ").concat(I.port," ").concat(I.protos.join("/")," ").concat(I.fmts.join(" ")).concat(this.eol)}printSessionAttributes(I){return new Hn(this.eol).print(I)}printMediaAttributes(I){return new pe(this.eol).print(I)}}class Mt{constructor(I){nt(this,"eol",void 0),this.eol=I}printIceUfrag(I){return I===void 0?"":"a=ice-ufrag:".concat(I).concat(this.eol)}printIcePwd(I){return I===void 0?"":"a=ice-pwd:".concat(I).concat(this.eol)}printIceOptions(I){return I===void 0?"":"a=ice-options:".concat(I.join(d)).concat(this.eol)}printFingerprints(I){return I.length>0?I.map(G=>"a=fingerprint:".concat(G.hashFunction).concat(d).concat(G.fingerprint)).join(this.eol)+this.eol:""}printExtmap(I){return I.map(G=>"a=extmap:".concat(G.entry).concat(G.direction?"/".concat(G.direction):"").concat(d).concat(G.extensionName).concat(G.extensionAttributes?"".concat(d).concat(G.extensionAttributes):"").concat(this.eol)).join("")}printSetup(I){return I===void 0?"":"a=setup:".concat(I).concat(this.eol)}printUnrecognized(I){return I.map(G=>"a=".concat(G.attField).concat(G.attValue?":".concat(G.attValue):"").concat(this.eol)).join("")}}class Hn extends Mt{print(I){let G="";return G+=this.printGroups(I.groups),G+=this.printMsidSemantic(I.msidSemantic),G+=this.printIceLite(I.iceLite),G+=this.printIceUfrag(I.iceUfrag),G+=this.printIcePwd(I.icePwd),G+=this.printIceOptions(I.iceOptions),G+=this.printFingerprints(I.fingerprints),G+=this.printSetup(I.setup),G+=this.printTlsId(I.tlsId),G+=this.printIdentity(I.identities),G+=this.printExtmap(I.extmaps),G+=this.printUnrecognized(I.unrecognized),G}printGroups(I){let G="";return I.length>0&&(G+=I.map(X=>"a=group:".concat(X.semantic).concat(X.identificationTag.map(Re=>"".concat(d).concat(Re)).join("")).concat(this.eol)).join("")),G}printIceLite(I){return I===void 0?"":"a=ice-lite"+this.eol}printTlsId(I){return I?"a=tls-id:".concat(I).concat(this.eol):""}printIdentity(I){return I.length===0?"":I.map(G=>"a=identity:".concat(G.assertionValue).concat(G.extensions.map(X=>"".concat(d).concat(X.name).concat(X.value?"=".concat(X.value):"")))).join(this.eol)+this.eol}printMsidSemantic(I){if(!I)return"";let G="a=msid-semantic:".concat(I.semantic);return I.applyForAll?G+="".concat(d,"*"):I.identifierList.length>0&&(G+=I.identifierList.map(X=>"".concat(d).concat(X))),G+this.eol}}class pe extends Mt{print(I){let G=I.attributes,X="";return X+=this.printRTCP(G.rtcp),X+=this.printIceUfrag(G.iceUfrag),X+=this.printIcePwd(G.icePwd),X+=this.printIceOptions(G.iceOptions),X+=this.printCandidates(G.candidates),X+=this.printRemoteCandidatesList(G.remoteCandidatesList),X+=this.printEndOfCandidates(G.endOfCandidates),X+=this.printFingerprints(G.fingerprints),X+=this.printSetup(G.setup),X+=this.printMid(G.mid),X+=this.printExtmap(G.extmaps),X+=this.printRTPRelated(G),X+=this.printPtime(G.ptime),X+=this.printMaxPtime(G.maxPtime),X+=this.printDirection(G.direction),X+=this.printSSRCGroups(G.ssrcGroups),X+=this.printSSRC(G.ssrcs),X+=this.printRTCPMux(G.rtcpMux),X+=this.printRTCPMuxOnly(G.rtcpMuxOnly),X+=this.printRTCPRsize(G.rtcpRsize),X+=this.printMSId(G.msids),X+=this.printImageattr(G.imageattr),X+=this.printRid(G.rids),X+=this.printSimulcast(G.simulcast),X+=this.printSCTPPort(G.sctpPort),X+=this.printMaxMessageSize(G.maxMessageSize),X+=this.printUnrecognized(G.unrecognized),X}printCandidates(I){return I.map(G=>"a=candidate:".concat(G.foundation).concat(d).concat(G.componentId).concat(d).concat(G.transport).concat(d).concat(G.priority).concat(d).concat(G.connectionAddress).concat(d).concat(G.port).concat(d,"typ").concat(d).concat(G.type).concat(G.relAddr?"".concat(d,"raddr").concat(d).concat(G.relAddr):"").concat(G.relPort?"".concat(d,"rport").concat(d).concat(G.relPort):"").concat(Object.keys(G.extension).map(X=>"".concat(d).concat(X).concat(d).concat(G.extension[X])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(I){return I.map(G=>"a=remote-candidates:".concat(G.join(d)).concat(this.eol)).join("")}printEndOfCandidates(I){return I===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(I){if(!I.payloads)return"";let G=I.payloads,X="";X+=I.rtcpFeedbackWildcards.map(Re=>this.printRTCPFeedback("*",Re)).join("");for(let Re of G)X+=this.printRtpMap(Re.payloadType,Re.rtpMap),X+=this.printFmtp(Re.payloadType,Re.fmtp),X+=Re.rtcpFeedbacks.map(dt=>this.printRTCPFeedback(Re.payloadType,dt)).join("");return X}printFmtp(I,G){if(!G)return"";let X=Object.keys(G.parameters);return X.length===1&&G.parameters[X[0]]===null?"a=fmtp:".concat(I).concat(d).concat(X[0]).concat(this.eol):"a=fmtp:".concat(I).concat(d).concat(Object.keys(G.parameters).map(Re=>"".concat(Re,"=").concat(G.parameters[Re])).join(";")).concat(this.eol)}printRtpMap(I,G){return G?"a=rtpmap:".concat(I).concat(d).concat(G.encodingName,"/").concat(G.clockRate).concat(G.encodingParameters?"/".concat(G.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(I,G){let X="a=rtcp-fb:".concat(I).concat(d),Re=G;return Re.type==="trr-int"?X+="ttr-int".concat(d).concat(Re.interval):(X+="".concat(Re.type),Re.parameter&&(X+="".concat(d).concat(Re.parameter),Re.additional&&(X+="".concat(d).concat(Re.additional)))),X+this.eol}printPtime(I){return I===void 0?"":"a=ptime:".concat(I).concat(this.eol)}printMaxPtime(I){return I===void 0?"":"a=maxptime:".concat(I).concat(this.eol)}printDirection(I){return I===void 0?"":"a=".concat(I).concat(this.eol)}printSSRC(I){return I.map(G=>Object.keys(G.attributes).map(X=>"a=ssrc:".concat(G.ssrcId.toString(10)).concat(d).concat(X).concat(G.attributes[X]?":".concat(G.attributes[X]):"").concat(this.eol)).join("")).join("")}printRTCPMux(I){return I===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(I){return I===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(I){return I===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(I){if(I===void 0)return"";let G="a=rtcp:".concat(I.port);return I.netType&&(G+="".concat(d).concat(I.netType)),I.addressType&&(G+="".concat(d).concat(I.addressType)),I.address&&(G+="".concat(d).concat(I.address)),G+this.eol}printMSId(I){return I.map(G=>"a=msid:".concat(G.id).concat(G.appdata?"".concat(d).concat(G.appdata):"").concat(this.eol)).join("")}printImageattr(I){return I.map(G=>"a=imageattr:".concat(G).concat(this.eol)).join("")}printRid(I){return I.map(G=>{let X="a=rid:".concat(G.id).concat(d).concat(G.direction);return G.payloads&&(X+="".concat(d,"pt=").concat(G.payloads.join(","))),G.params.length>0&&(X+="".concat(d).concat(G.params.map(Re=>Re.type==="depend"?"depend=".concat(Re.rids.join(",")):"".concat(Re.type,"=").concat(Re.val)).join(";"))),X+this.eol}).join("")}printSimulcast(I){return I===void 0?"":"a=simulcast:".concat(I).concat(this.eol)}printSCTPPort(I){return I===void 0?"":"a=sctp-port:".concat(I).concat(this.eol)}printMaxMessageSize(I){return I===void 0?"":"a=max-message-size:".concat(I).concat(this.eol)}printMid(I){return I===void 0?"":"a=mid:".concat(I).concat(this.eol)}printSSRCGroups(I){return I.map(G=>"a=ssrc-group:".concat(G.semantic).concat(G.ssrcIds.map(X=>"".concat(d).concat(X.toString(10))).join("")).concat(this.eol)).join("")}}function Ae(Ee){return new me().parse(Ee)}function Me(Ee,I){return new jt().print(Ee,I)}}},t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={exports:{}};return e[n](r,r.exports,i),r.exports}return i.d=(n,r)=>{for(var s in r)i.o(r,s)&&!i.o(n,s)&&Object.defineProperty(n,s,{enumerable:!0,get:r[s]})},i.o=(n,r)=>Object.prototype.hasOwnProperty.call(n,r),i.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},i(8)})();function Br(e){return JL.parse(e)}function Bd(e,t){return JL.print(e,t)}var KB=Xr("Array","keys"),YB=Hs,qB=an,XB=ce,JB=KB,yw=Array.prototype,ZB={DOMTokenList:!0,NodeList:!0},QB=function(e){var t=e.keys;return e===yw||XB(yw,e)&&t===yw.keys||qB(ZB,YB(e))?JB:t},Fr=R(QB);function wi(e,t,i){return(t=(function(n){var r=(function(s,c){if(typeof s!="object"||!s)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var d=l.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)})(n);return typeof r=="symbol"?r:r+""})(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function ZL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function ht(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?ZL(Object(i),!0).forEach(function(n){wi(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ZL(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}let QL=new class extends vi{constructor(){super(...arguments),wi(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class $B{constructor(t){wi(this,"logger",void 0),wi(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];this.logger.debug(...this.prefixLists,...i)}info(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];this.logger.info(...this.prefixLists,...i)}warning(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];this.logger.warning(...this.prefixLists,...i)}error(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];this.logger.error(...this.prefixLists,...i)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function Rw(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function $L(){let e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?t?.[0]+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}let qa={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},gy=Date.now(),Bg=e=>{for(let t in qa)if(Object.prototype.hasOwnProperty.call(qa,t)&&qa[t]===e)return t;return"DEFAULT"},C=new class{constructor(){wi(this,"proxyServerURL",void 0),wi(this,"logLevel",qa.DEBUG),wi(this,"uploadState","collecting"),wi(this,"uploadLogWaitingList",[]),wi(this,"uploadLogUploadingList",[]),wi(this,"uploadErrorCount",0),wi(this,"currentLogID",0),wi(this,"url",void 0),wi(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let n=[qa.DEBUG].concat(t);this.log.apply(this,n)}info(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let n=[qa.INFO].concat(t);this.log.apply(this,n)}warning(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let n=[qa.WARNING].concat(t);this.log.apply(this,n)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let n=[qa.ERROR].concat(t);this.log.apply(this,n)}upload(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let n=[qa.DEBUG].concat(t);this.uploadLog.apply(this,n)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Kt("UPLOAD_LOG",!0)}disableLogUpload(){Kt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new $B(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Date.now()-gy<100)return void setTimeout(()=>{this.log(...t)},Date.now()-gy);let n=Math.max(0,Math.min(4,t[0]));if(t[0]=Rw()+" Agora-SDK [".concat(Bg(n),"]:"),this.appendLogToWaitingList(n,...t),n<this.logLevel)return;let r=Rw()+" %cAgora-SDK [".concat(Bg(n),"]:"),s=[];if(!j("USE_NEW_LOG"))switch(n){case qa.DEBUG:s=[r,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,s);break;case qa.INFO:s=[r,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,s);break;case qa.WARNING:s=[r,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,s);break;case qa.ERROR:s=[r,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Date.now()-gy<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-gy);let n=Math.max(0,Math.min(4,t[0]));t[0]=Rw()+" Agora-SDK [".concat(Bg(n),"]:"),this.appendLogToWaitingList(n,...t)}appendLogToWaitingList(e){if(!j("UPLOAD_LOG"))return;for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];Array.isArray(i[0])?i[0][0]=$L()+" Agora-SDK [".concat(Bg(e),"]:"):i[0]=$L()+" Agora-SDK [".concat(Bg(e),"]:");let r="";i.forEach(s=>{typeof s=="object"&&(s=JSON.stringify(s)),r+="".concat(s," ")}),this.uploadLogWaitingList.push({payload_str:r,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){let e=this.uploadLogUploadingList,t={sdk_version:Ya,process_id:j("PROCESS_ID"),payload:JSON.stringify(e)};return lo(async()=>{let i=await br.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(j("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(j("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(i.data!=="OK"){let n=new Error("unexpected upload log response");throw n.response=i,n}},()=>(this.uploadLogUploadingList=[],!1),i=>{let n={status:-1,message:i.message,errorRange:e.map(r=>r.log_item_id)};return i.response?(n.status=i.response.status,n.data=i.response.data,n.headers=i.response.headers):i.request&&(n.status=i.request.status),QL.reportLogUploadError(n),!0},{timeout:j("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:j("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,j("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var eP;function eF(e){return gn(e.reportId,"params.reportId",0,100,!1),gn(e.category,"params.category",0,100,!1),gn(e.event,"params.event",0,100,!1),gn(e.label,"params.label",0,100,!1),Jt(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(eP={}).FREE="free",eP.UPLOADING="uploading",(function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"})({});let tF={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},nn=(function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e})({}),fi=(function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e})({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let iF=(function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e})({});function Ze(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,i,n){let r=n.value;if(typeof r=="function"){let s=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);n.value=function(){for(var c,l=arguments.length,d=new Array(l),h=0;h<l;h++)d[h]=arguments[h];let f=d;if(e.argsMap)try{f=e.argsMap(this,...d)}catch(S){C.warning(S),f=[]}try{JSON.stringify(f)}catch{C.warning("arguments for method ".concat(s,".").concat(String(i)," not serializable for apiInvoke.")),f=[]}let E=(e.report||He).reportApiInvoke(this._sessionId||null,{id:this._clientId||((c=this.store)===null||c===void 0?void 0:c.clientId)||this._ID,name:"".concat(s,".").concat(String(i)),options:f,tag:_i.TRACER,reportResult:e.reportResult},e.throttleTime);try{let S=r.apply(this,d);return S instanceof Ie?S.then(y=>(E.onSuccess(e.reportResult&&y),y)).catch(y=>{throw E.onError(y),y}):(E.onSuccess(e.reportResult&&S),S)}catch(S){throw E.onError(S),S}}}return n}}let He=new class{constructor(){wi(this,"baseInfoMap",new Map),wi(this,"proxyServer",void 0),wi(this,"eventUploadTimer",void 0),wi(this,"setSessionIdTimer",void 0),wi(this,"url",void 0),wi(this,"sids",new Set),wi(this,"backupUrl",void 0),wi(this,"_appId",void 0),wi(this,"_aid",0),wi(this,"keyEventUploadPendingItems",[]),wi(this,"normalEventUploadPendingItems",[]),wi(this,"apiInvokeUploadPendingItems",[]),wi(this,"apiInvokeCount",0),wi(this,"apiInvokeLoggedCount",0),wi(this,"ltsList",[]),wi(this,"lastSendNormalEventTime",Date.now()),wi(this,"customReportCounterTimer",void 0),wi(this,"customReportCount",0),wi(this,"extApiInvoke",async e=>{for(let t of e){let i=ht(ht({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:_i.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),j("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),j("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[i,n]=t;return i+n}),16)||0}reportApiInvoke(e,t,i){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;let n=Date.now();this.apiInvokeCount+=1;let r=this.apiInvokeCount,s=!!j("SHOW_REPORT_INVOKER_LOG"),c=!!j("SHOW_REPORT_USER_INVOKER_LOG"),l=s||c&&t.id;l&&(this.apiInvokeLoggedCount+=1);let d=this.apiInvokeLoggedCount;function h(y,D){if(l){let O="[apiInvoke-".concat(d,"]");if(t.id&&(O+="[".concat(t.id,"]")),t.name&&(O+="[".concat(t.name,"]"),t.name===Li.JOIN))return C.info("".concat(O," ").concat(y));C.info("".concat(O," ").concat(y),y==="start"?t.options:D||"")}}let f=()=>({tag:t.tag,invokeId:r,sid:e,name:t.name,apiInvokeTime:n,options:t.options,states:t.states||null});h("start");let E=!1;Sn(t.timeout).then(()=>{E||(this.sendApiInvoke(ht(ht({},f()),{},{error:M.API_INVOKE_TIMEOUT,success:!1})),h("timeout"))});let S=new de(M.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:y=>{let D=()=>{if(E)throw S;return E=!0,this.sendApiInvoke(ht(ht({},f()),{},{success:!0},t.reportResult&&{result:y})),h("onSuccess"),y};return i?PL(D,t.name+"Success",i,()=>E=!0):D()},onError:y=>{let D=()=>{if(E)throw y;E=!0,this.sendApiInvoke(ht(ht({},f()),{},{success:!1,error:y})),h("onFailure",y.toString())};return i?PL(D,t.name+"Error",i,()=>E=!0):D()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;let i=Date.now(),n=this.createBaseInfo(e,i);n.cname=t.cname;let r=Object.assign({},{willUploadConsoleLog:j("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:gw?"global":"oversea",areas:j("AREAS")&&j("AREAS").join(",")},t.extend),{stringUid:s,channelProfile:c,channelMode:l,isABTestSuccess:d,lsid:h,clientRole:f}=t,E=Date.now(),S=ht(ht({},n),{},{eventType:nn.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:vw,lts:E,elapse:E-i,extend:JSON.stringify(r),mode:t.mode,process:j("PROCESS_ID"),appType:j("APP_TYPE"),success:!0,version:Ya,stringUid:s,channelProfile:c,channelMode:l,isABTestSuccess:d,lsid:h,clientType:Ce(y=window.navigator.userAgent).call(y,"AgoraWebView")?42:20,clientRole:f,serviceId:j("PROCESS_ID"),extensionID:j("PLUGIN_INFO").join(",")||""});var y;this.send({type:fi.SESSION,data:S},!0)}joinChooseServer(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let n=i.info,r=Date.now(),s=ht(ht({},n),{},{role:t.role,eventType:nn.JOIN_CHOOSE_SERVER,lts:r,eventElapse:t.elapse||r-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:r-i.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:fi.JOIN_CHOOSE_SERVER,data:s},!0)}reqUserAccount(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let n=i.info,r=Date.now(),s=ht(ht({},n),{},{eventType:nn.REQ_USER_ACCOUNT,lts:r,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||r-i.startTime,eventElapse:r-t.lts,extend:JSON.stringify(t.extend)});this.send({type:fi.REQ_USER_ACCOUNT,data:s},!0)}joinGateway(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let n=i.info;t.vid&&(n.vid=t.vid),n.uid=t.uid,n.cid=t.cid;let r=Date.now(),{firstSuccess:s,addr:c,isProxy:l}=t,d=r-i.startTime,h=ht(ht({},n),{},{eventType:nn.JOIN_GATEWAY,lts:r,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:d,eventElapse:r-t.lts,firstSuccess:s,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:Ew(),isABTestSuccess:t.isABTestSuccess?1:0}),f=h.success?1:0;if(t.succ&&(i.lastJoinSuccessTime=r),s)this.send({type:fi.JOIN_GATEWAY,data:h},!0);else{let E;if(c)if(l){let y=c.match(/h=(\d{1,3}-){3}\d{1,3}/g),D=c.match(/p=[0-9]{1,6}/g);E={isSuccess:f,gatewayIp:y&&y.length?y[0].split("=")[1].replace(/-/g,"."):"",port:D&&D.length?D[0].split("=")[1]:"",isProxy:l?1:0}}else{let y=c.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),D=c.match(/(:|p=)[0-9]{1,6}/g);E={isSuccess:f,gatewayIp:y&&y.length?y[0].split("//")[1].replace(/-/g,"."):"",port:D&&D.length?D[0].split(/:|p=/g)[1]:"",isProxy:l?1:0}}else E={isSuccess:f,gatewayIp:"",port:"",isProxy:l?1:0};delete h.success,delete h.eventType,delete h.firstSuccess,h.vid=Number(h.vid);let S=Object.assign({},h,E,{eventType:nn.REJOIN_GATEWAY});this.send({type:fi.RE_JOIN_GATEWAY,data:S},!0)}}joinChannelTimeout(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let n=Date.now(),r=ht(ht({},i.info),{},{lts:n,timeout:t,elapse:n-i.startTime});this.send({type:fi.JOIN_CHANNEL_TIMEOUT,data:r},!0)}publish(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let n=i.info,r=Date.now(),s=ht(ht({},n),{},{eventType:nn.PUBLISH,lts:r,eventElapse:t.eventElapse,elapse:r-i.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:fi.PUBLISH,data:s},!0)}subscribe(e,t,i){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,s=Date.now(),c=ht(ht({},r),{},{eventType:nn.SUBSCRIBE,lts:s,eventElapse:t.eventElapse,elapse:s-n.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?c.peerSuid=t.peerid:c.peer=t.peerid,this.send({type:fi.SUBSCRIBE,data:c},!0)}wsCompressorInit(e){var t;let i=[...Fr(t=this.baseInfoMap).call(t)],n=i.length?i[0]:"UnableToGetSid",r=this.baseInfoMap.get(n);if(!r)return;let s=r.info,c=Date.now(),l=ht(ht({},s),{},{eventType:nn.WS_COMPRESSOR_INIT,lts:c,eventElapse:e.eventElapse,elapse:c-r.startTime,status:e.status?1:2});this.send({type:fi.WS_COMPRESSOR_INIT,data:l},!0)}firstXLAPeerFirstVideoFrame(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let n=i.info,r=Date.now(),s=t.peerPubStatusMs-(i.lastJoinSuccessTime||r),c=ht(ht({},n),{},{elapse:r-i.startTime,eventType:nn.XLA_PEER_FIRST_VIDEO_FRAME,lts:r,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:s,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>s?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:fi.XLA_PEER_FIRST_VIDEO_FRAME,data:c},!0)}firstRemoteVideoDecode(e,t,i,n){let r=this.baseInfoMap.get(e);if(!r)return;let s=r.info,c=Date.now(),l=ht(ht(ht({},s),n),{},{elapse:c-r.startTime,eventType:t,lts:c,firstDecodeFrame:Math.max((n.firstFrame||c)-r.startTime,0),apEnd:Math.max(n.apEnd-r.startTime,0),apStart:Math.max(n.apStart-r.startTime,0),joinGwEnd:Math.max(n.joinGwEnd-r.startTime,0),joinGwStart:Math.max(n.joinGwStart-r.startTime,0),pcEnd:Math.max(n.pcEnd-r.startTime,0),pcStart:Math.max(n.pcStart-r.startTime,0),subscriberEnd:Math.max(n.subscriberEnd-r.startTime,0),subscriberStart:Math.max(n.subscriberStart-r.startTime,0),videoAddNotify:Math.max(n.videoAddNotify-r.startTime,0)});this.send({type:i,data:l},!0)}firstRemoteFrame(e,t,i,n){let r=this.baseInfoMap.get(e);if(!r)return;let s=r.info,c=Date.now(),l=ht(ht(ht({},s),n),{},{elapse:c-r.startTime,eventType:t,lts:c});this.send({type:i,data:l},!0)}abTest(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let n=i.info,r=Date.now(),s=ht(ht(ht({},n),t),{},{vid:n.vid===void 0?0:Number(n.vid),elapse:r-i.startTime,eventType:nn.AB_TEST,lts:r});this.send({type:fi.AB_TEST,data:s},!0)}pcStats(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let n=i.info,r=Date.now(),s=ht(ht(ht({},n),t),{},{vid:n.vid===void 0?0:Number(n.vid),elapse:r-i.startTime,eventType:nn.PC_STATS,lts:r,preallocation:t.preallocation?1:0});this.send({type:fi.PC_STATS,data:s},!0)}updateRemoteRTPCapabilities(e,t){if(e){let i=this.baseInfoMap.get(e);if(!i)return;let n=i.info,r=Date.now(),s=ht(ht(ht({},n),t),{},{vid:n.vid===void 0?0:Number(n.vid),eventType:nn.UPDATE_REMOTE_RTPCAPABILITIES,lts:r});this.send({type:fi.UPDATE_REMOTE_RTPCAPABILITIES,data:s},!0)}}onGatewayStream(e,t,i,n){let r=this.baseInfoMap.get(e);if(!r)return;let s=r.info,c=Date.now(),l=ht(ht(ht({},s),n),{},{eventType:t,lts:c});this.send({type:i,data:l},!0)}streamSwitch(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let n=i.info,r=Date.now(),s=ht(ht({},n),{},{eventType:nn.STREAM_SWITCH,lts:r,isDual:t.isdual,elapse:r-i.startTime,success:t.succ});this.send({type:fi.STREAM_SWITCH,data:s},!0)}requestProxyAppCenter(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let n=i.info,r=Date.now(),s=ht(ht({},n),{},{eventType:nn.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-t.lts,elapse:r-i.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:fi.REQUEST_PROXY_APPCENTER,data:s},!0)}requestProxyWorkerManager(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let n=i.info,r=Date.now(),s=ht(ht({},n),{},{eventType:nn.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-t.lts,elapse:r-i.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:fi.REQUEST_PROXY_WORKER_MANAGER,data:s},!0)}setProxyServer(e){this.proxyServer=e,e?C.debug("reportProxyServerurl: ".concat(e)):C.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let n=i.info,r=Date.now(),s=ht(ht({},n),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:r,elapse:r-i.startTime,joinChannelSuccessElapse:r-(i.lastJoinSuccessTime||r),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:fi.PEER_PUBLISH_STATUS,data:s},!0)}workerEvent(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let n=i.info,r=Date.now();(function(s,c,l){let d=s[c];if(!d||typeof d!="string")return[s];s[c]="";let h=oc(JSON.stringify(s)),f=0,E=[],S=0;for(let y=0;y<d.length;y++)S+=d.charCodeAt(y)<=127?1:3,S<=l-h||(E[E.length]=Te(Te({},s),{},{[c]:d.substring(f,y)}),f=y,S=d.charCodeAt(y)<=127?1:3);return f!==d.length-1&&(E[E.length]=Te(Te({},s),{},{[c]:d.substring(f)})),E})(ht(ht(ht({},n),t),{},{elapse:r-i.startTime,lts:r,productType:"WebRTC"}),"payload",1300).forEach(s=>this.send({type:fi.WORKER_EVENT,data:s},!0))}apworkerEvent(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let n=i.info,r=Date.now(),s=ht(ht(ht({},n),t),{},{elapse:r-i.startTime,lts:r});this.send({type:fi.AP_WORKER_EVENT,data:s},!0)}joinWebProxyAP(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let n=i.info,r=Date.now(),s=ht(ht(ht({},n),t),{},{elapse:r-i.startTime,lts:r,extend:t.extend||void 0});this.send({type:fi.JOIN_WEB_PROXY_AP,data:s},!0)}WebSocketQuit(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let n=i.info,r=Date.now(),s=ht(ht(ht({},n),t),{},{elapse:r-i.startTime,lts:r});this.send({type:fi.WEBSOCKET_QUIT,data:s},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>j("CUSTOM_REPORT_LIMIT"))throw new de(M.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let i=Date.now(),n=t.map(r=>({type:fi.USER_ANALYTICS,data:ht(ht({sid:e},r),{},{lts:i})}));try{j("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(n):await this.postDataToStatsCollector(n)}catch(r){throw C.error("send custom report message failed",r.toString()),new de(M.CUSTOM_REPORT_SEND_FAILED,r.message)}}sendApiInvoke(e){let t=j("NOT_REPORT_EVENT");if(e.tag&&Ce(t)&&Ce(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;let i=this.baseInfoMap.get(e.sid);if(!i)return this.apiInvokeUploadPendingItems.push(e),!1;let{cname:n,uid:r,cid:s}=i.info,c;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof de){let{code:d,message:h}=e.error;c=d||h||e.error.toString()}else c=e.error.toString();let l={invokeId:e.invokeId,sid:e.sid,cname:n,cid:s,uid:r,lts:e.lts,success:e.success,elapse:e.lts-i.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?c:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:fi.API_INVOKE,data:l},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){let e=this.apiInvokeUploadPendingItems;if(e.length===0)return;let t=Array.from(this.sids).find(i=>i!==null);t&&e.forEach(i=>{i&&(i.sid=t,this.sendApiInvoke(Object.assign({},i)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>j("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){let i=[],n=[];for(;e.length;){let s=e.shift();i.length<20?i.push(s):n.push(s)}e.push(...n);for(let s of[...i]){var r;this.ltsList.indexOf(s.data.lts)!==-1?(s.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s.data.lts)):(this.ltsList.push(s.data.lts),lt(r=this.ltsList).call(r,(c,l)=>c-l))}return t||(this.lastSendNormalEventTime=Date.now()),j("ENABLE_EVENT_REPORT")&&i.length&&(j("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((s=>c=>{j("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(s):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(s),this.normalEventUploadPendingItems.length>j("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-j("NORMAL_EVENT_QUEUE_CAPACITY")),C.warning("report: drop normal events"))))})(i)),e}async postDataToStatsCollector2(e){Bi.networkState===aa.OFFLINE&&await Ie.race([Bi.onlineWaiter,Sn(2*zi.maxRetryTimeout)]);let t=r=>{let s=new Uint8Array;return r.forEach(c=>{let l=aw(JSON.stringify(c.data)),d=new ArrayBuffer(5),h=(E=>{let S=0;return Object.entries(fi).forEach(y=>{let[D,O]=y;O===E.type&&(S=iF[D])}),S})(c),f=new DataView(d);f.setUint16(0,l.byteLength,!0),f.setUint8(2,255&h),f.setUint8(3,h>>>8&255),f.setUint8(4,h>>>16&255),s=CL(s,new Uint8Array(d)),s=CL(s,l)}),s},i="event",n=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(j("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(j("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let r=0;r<2;r+=1){r===1&&(n=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(j("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(j("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await hw(n,{timeout:1e4,data:t(e),headers:ht(ht({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(s){if(r===1)throw s;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=(l=>{let d=l&&l.data.sid&&this.baseInfoMap.get(l.data.sid);return d&&d.info.vid&&+d.info.vid||0})(e[0]),n=i?void 0:this._aid,r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(l=>JSON.stringify(l)),vid:i,aid:n};Bi.networkState===aa.OFFLINE&&await Ie.race([Bi.onlineWaiter,Sn(2*zi.maxRetryTimeout)]);let s=t?"/events/proto-raws":"/events/messages",c=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(j("EVENT_REPORT_DOMAIN"),"&p=").concat(j("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(j("EVENT_REPORT_DOMAIN"),":").concat(j("STATS_COLLECTOR_PORT")).concat(s));for(let l=0;l<2;l+=1){l===1&&(c=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(j("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(j("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(j("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(j("STATS_COLLECTOR_PORT")).concat(s)));try{t?await FB(c,{timeout:1e4,data:r}):await hw(c,{timeout:1e4,data:r})}catch(d){if(l===1)throw d;continue}return}}createBaseInfo(e,t){let i=Object.assign({},tF);return i.sid=e,this.baseInfoMap.set(e,{info:i,startTime:t}),i}reportResourceTiming(e,t){let i=performance.getEntriesByName(e),n=i[i.length-1];n&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:n,tag:_i.TRACER}).onSuccess()}};QL.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Bi.networkState,He.reportApiInvoke(null,{name:"logUploadError",options:e,tag:_i.TRACER}).onSuccess("logUploadError")});class te extends de{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),wi(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,C)}throw(){super.throw(C)}}let vn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Lt(){return vn}function tP(){return"setSinkId"in HTMLAudioElement.prototype&&(!j("RESTRICTION_SET_PLAYBACK_DEVICE")||(pl()||hL())&&!iw())}function Sy(){return!vn.supportUnifiedPlan||j("CHROME_FORCE_PLAN_B")&&fl()}function Cw(e){return!(bi()||pL(87)||Sy()||!j("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||j("FORCE_DISABLE_AUTO_SUB")))}function iP(e){return!!j("ENABLE_INSTANT_VIDEO")||!(e==null||!e.autoSubscribe||j("FORCE_DISABLE_AUTO_SUB"))}let Tn=(function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e})({});function um(e,t,i){return{sampleRate:e,stereo:t,bitrate:i}}function Pt(e,t,i,n,r){return{width:e,height:t,frameRate:i,bitrateMin:n,bitrateMax:r}}function As(e,t,i,n,r){return{width:{max:e},height:{max:t},frameRate:i,bitrateMin:n,bitrateMax:r}}function bw(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}let nF={"90p":Pt(160,90),"90p_1":Pt(160,90),"120p":Pt(160,120,15,30,65),"120p_1":Pt(160,120,15,30,65),"120p_3":Pt(120,120,15,30,50),"120p_4":Pt(212,120),"180p":Pt(320,180,15,30,140),"180p_1":Pt(320,180,15,30,140),"180p_3":Pt(180,180,15,30,100),"180p_4":Pt(240,180,15,30,120),"240p":Pt(320,240,15,40,200),"240p_1":Pt(320,240,15,40,200),"240p_3":Pt(240,240,15,40,140),"240p_4":Pt(424,240,15,40,220),"360p":Pt(640,360,15,80,400),"360p_1":Pt(640,360,15,80,400),"360p_3":Pt(360,360,15,80,260),"360p_4":Pt(640,360,30,80,600),"360p_6":Pt(360,360,30,80,400),"360p_7":Pt(480,360,15,80,320),"360p_8":Pt(480,360,30,80,490),"360p_9":Pt(640,360,15,80,800),"360p_10":Pt(640,360,24,80,800),"360p_11":Pt(640,360,24,80,1e3),"480p":Pt(640,480,15,100,500),"480p_1":Pt(640,480,15,100,500),"480p_2":Pt(640,480,30,100,1e3),"480p_3":Pt(480,480,15,100,400),"480p_4":Pt(640,480,30,100,750),"480p_6":Pt(480,480,30,100,600),"480p_8":Pt(848,480,15,100,610),"480p_9":Pt(848,480,30,100,930),"480p_10":Pt(640,480,10,100,400),"720p":Pt(1280,720,15,120,1130),"720p_auto":Pt(1280,720,30,900,3e3),"720p_1":Pt(1280,720,15,120,1130),"720p_2":Pt(1280,720,30,120,2e3),"720p_3":Pt(1280,720,30,120,1710),"720p_5":Pt(960,720,15,120,910),"720p_6":Pt(960,720,30,120,1380),"1080p":Pt(1920,1080,15,120,2080),"1080p_1":Pt(1920,1080,15,120,2080),"1080p_2":Pt(1920,1080,30,120,3e3),"1080p_3":Pt(1920,1080,30,120,3150),"1080p_5":Pt(1920,1080,60,120,4780),"1440p":Pt(2560,1440,30,120,4850),"1440p_1":Pt(2560,1440,30,120,4850),"1440p_2":Pt(2560,1440,60,120,7350),"4k":Pt(3840,2160,30,120,8910),"4k_1":Pt(3840,2160,30,120,8910),"4k_3":Pt(3840,2160,60,120,13500)},rF={"480p":As(640,480,5),"480p_1":As(640,480,5),"480p_2":As(640,480,30),"480p_3":As(640,480,15),"720p":As(1280,720,5),"720p_auto":Pt(1280,720,30,900,3e3),"720p_1":As(1280,720,5),"720p_2":As(1280,720,30),"720p_3":As(1280,720,15),"1080p":As(1920,1080,5),"1080p_1":As(1920,1080,5),"1080p_2":As(1920,1080,30),"1080p_3":As(1920,1080,15)},aF={"1SL1TL":bw(1,1),"3SL3TL":bw(3,3),"2SL3TL":bw(2,3)};function ws(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},nF[e]):e}function Aw(e){return typeof e=="string"?Object.assign({},rF[e]):e}function vy(e){return typeof e=="string"?Object.assign({},aF[e]):e}let sF={speech_low_quality:um(16e3,!1),speech_standard:um(32e3,!1,18),music_standard:um(48e3,!1),standard_stereo:um(48e3,!0,56),high_quality:um(48e3,!1,128),high_quality_stereo:um(48e3,!0,192)};function Ty(e){return typeof e=="string"?Object.assign({},sF[e]):e}let hm=[];function nP(e){return tn(e,"mediaSource",["screen","window","application"]),!0}let je=(function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e})({}),Zt=(function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e})({}),pm=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e})({}),oF=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e})({}),cF=(function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e})({}),Ph=(function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e})({}),fm=(function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e})({}),Xa=(function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e})({}),mm=(function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e})({}),ya=(function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e})({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});let ww={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},Iw={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},rP={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},lF={uplinkNetworkQuality:0,downlinkNetworkQuality:0},aP={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},pr=(function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e})({}),Ra=(function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e})({}),Fg=(function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e})({}),xh=(function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e})({}),jn=(function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e})({}),lc=(function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e})({}),Ow={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},yy=(function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e})({});function At(e,t,i,n,r){var s,c,l={};return Object.keys(n).forEach(function(d){l[d]=n[d]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=xr(s=Lp(c=i.slice()).call(c)).call(s,function(d,h){return h(e,t,d)||d},l),r&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(r):void 0,l.initializer=void 0),l.initializer===void 0?(Object.defineProperty(e,t,l),null):l}function $(e,t,i){return(t=(function(n){var r=(function(s,c){if(typeof s!="object"||!s)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var d=l.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)})(n);return typeof r=="symbol"?r:r+""})(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function sP(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function ai(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?sP(Object(i),!0).forEach(function(n){$(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):sP(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}class oP extends vi{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Ph.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,i){super(),$(this,"trackMediaType",void 0),$(this,"_ID",void 0),$(this,"_rtpTransceiver",void 0),$(this,"_lowRtpTransceiver",void 0),$(this,"_hints",[]),$(this,"_isClosed",!1),$(this,"_originMediaStreamTrack",void 0),$(this,"mediaStreamTrack",void 0),$(this,"_external",{}),this._ID=i||ei(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,(function(n){Ce(hm).call(hm,n)||hm.push(n)})(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Vd(()=>{var i;He.reportApiInvoke(null,{name:Li.GET_MEDIA_STREAM_TRACK,options:[],tag:_i.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===pm.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,(function(t){let i=hm.indexOf(t);i!==-1&&hm.splice(i,1)})(this),this.emit(fm.CLOSED),this.removeAllListeners(Ph.SEI_RECEIVED)}_updateRtpTransceiver(t,i){if(i===pm.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Ph.TRANSCEIVER_UPDATED,t,i)}}class _m extends oP{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,i){super(t,i),$(this,"_enabled",!0),$(this,"_muted",!1),$(this,"_isExternalTrack",!1),$(this,"_isClosed",!1),$(this,"_enabledMutex",void 0),$(this,"processor",void 0),$(this,"_processorContext",void 0),$(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Vn("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,i;return(t=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,C.debug("[".concat(this.getTrackId(),"] close")),this.emit(je.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,i){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=n,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await $t(this,je.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){C.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(fm.TRACK_ENDED)}stateCheck(t,i){if(C.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(i,"]")),co(i,t),this._enabled&&this._muted&&t==="enabled"&&i===!1)throw new de(M.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",C);if(!this._enabled&&!this._muted&&t==="muted"&&i===!0)throw new de(M.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",C)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Ie.resolve([])}}let cP=window.AudioContext||window.webkitAudioContext,Ca=null,Yt=new class extends vi{constructor(){super(...arguments),$(this,"prevState",void 0),$(this,"curState",void 0),$(this,"currentTime",void 0),$(this,"currentTimeStuckAt",void 0),$(this,"interruptDetectorTrack",void 0),$(this,"onLocalAudioTrackMute",()=>{C.info("ios15-interruption-start"),this.emit(Tn.IOS_15_16_INTERRUPTION_START)}),$(this,"onLocalAudioTrackUnmute",async()=>{C.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?C.info("ios15-interruption-end-canceled"):(Ca&&await Ca.suspend(),this.emit(Tn.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){C.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){C.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Em(){if(!Ca){if((function(){if(!cP)return void C.error("your browser is not support web audio");C.info("create audio context");let e=ai({},j("WEBAUDIO_INIT_OPTIONS"));C.debug("audio context init option:",JSON.stringify(e)),Ca=new cP(e),Yt.curState=Ca.state,Ca.onstatechange=()=>{Yt.prevState=Yt.curState,Yt.curState=Ca?Ca.state:void 0;let{prevState:t,curState:i}=Yt,n=i==="running",r=i==="interrupted",s=t==="running",c=t==="suspended",l=t==="interrupted",d=wt().osVersion;(Jn()||Cs())&&s&&r&&(C.info("ios".concat(d,"-interruption-start")),Yt.emit(Tn.IOS_INTERRUPTION_START)),(Jn()||Cs())&&(c||l)&&n&&(C.info("ios".concat(d,"-interruption-end")),Yt.emit(Tn.IOS_INTERRUPTION_END)),t!==i&&Yt.emit(Tn.STATE_CHANGE,i,t)},setInterval(()=>{var t;let i=(t=Ca)===null||t===void 0?void 0:t.currentTime;Yt.currentTime!==i?(Yt.currentTimeStuckAt&&(C.debug("AudioContext current time resume at ".concat(i)),Yt.currentTimeStuckAt=void 0),Yt.currentTime=i):(i!==Yt.currentTimeStuckAt&&(He.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:_i.TRACER}).onSuccess(),C.warning("AudioContext current time stuck at ".concat(i))),Yt.currentTimeStuckAt=i)},5e3),(async function(t){let i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],n,r=!1,s=!1,c=!1;function l(O){t.state==="running"?d(!1):Jn()||Cs()?t.state==="suspended"&&(d(!0),O&&t.resume().then(h,h)):t.state!=="closed"&&(d(!0),O&&t.resume().then(h,h))}function d(O){if(r!==O){r=O;for(let N=0,k=i;N<k.length;N+=1){let U=k[N];O?window.addEventListener(U,f,{capture:!0,passive:!0}):window.removeEventListener(U,f,{capture:!0,passive:!0})}}}function h(){l(!1)}function f(){l(!0)}function E(O){if(!c)if(n.paused)if(O){let N;S(!1),c=!0;try{N=n.play(),N?N.then(y,y):(n.addEventListener("playing",y),n.addEventListener("abort",y),n.addEventListener("error",y))}catch{y()}}else S(!0);else S(!1)}function S(O){if(s!==O){s=O;for(let N=0,k=i;N<k.length;N++){let U=k[N];O?window.addEventListener(U,D,{capture:!0,passive:!0}):window.removeEventListener(U,D,{capture:!0,passive:!0})}}}function y(){n.removeEventListener("playing",y),n.removeEventListener("abort",y),n.removeEventListener("error",y),c=!1,E(!1)}function D(){E(!0)}if(Jn()){let O=t.createMediaStreamDestination(),N=document.createElement("div");N.innerHTML="<audio x-webkit-airplay='deny'></audio>",n=N.children.item(0),n.controls=!1,n.disableRemotePlayback=!0,n.preload="auto",n.srcObject=O.stream,E(!0)}Yt.on(Tn.STATE_CHANGE,function(){l(!0)}),l(!1)})(Ca)})(),!Ca)throw new de(M.NOT_SUPPORTED,"can not create audio context");return Ca}return Ca}function kh(e){if((function(){if(Nw!==null)return Nw;let n=Em(),r=n.createBufferSource(),s=n.createGain(),c=n.createGain();r.connect(s),r.connect(c),r.disconnect(s);let l=!1;try{r.disconnect(s)}catch{l=!0}return r.disconnect(),Nw=l,l})())return;let t=e.connect,i=e.disconnect;e.connect=(n,r,s)=>{var c;return e._inputNodes||(e._inputNodes=[]),Ce(c=e._inputNodes).call(c,n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,r,s)):t.call(e,n,r)),e},e.disconnect=(n,r,s)=>{i.call(e),n?uy(e._inputNodes,n):e._inputNodes=[];for(let c of e._inputNodes)t.call(e,c)}}let Nw=null;function Dw(e,t){let i=!1,n=1/t;if(j("DISABLE_WEBAUDIO")){let r=window.setInterval(()=>{i?window.clearInterval(r):e(performance.now()/1e3)},1e3*n)}else{let r=Em(),s=r.createGain();s.gain.value=0,s.connect(r.destination);let c=()=>{if(i)return void(s=null);let l=r.createOscillator();l.onended=c,l.connect(s),l.start(0),l.stop(r.currentTime+n),e(r.currentTime)};c()}return()=>{i=!0}}class lP{constructor(){$(this,"context",void 0),$(this,"analyserNode",void 0),$(this,"sourceNode",void 0),this.context=Em(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Jn()||Cs()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{let n=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(n);for(let r=0;r<t.length;++r)t[r]=n[r]/128-1}let i=xr(t).call(t,(n,r)=>n+r*r,0)/t.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,i;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{C.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class dP extends vi{get processSourceNode(){return this.sourceNode}set processedNode(t){var i;if(!this.isDestroyed&&this._processedNode!==t){try{var n;(n=this.sourceNode)===null||n===void 0||n.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),$(this,"outputNode",void 0),$(this,"outputTrack",void 0),$(this,"isPlayed",!1),$(this,"sourceNode",void 0),$(this,"context",void 0),$(this,"audioBufferNode",void 0),$(this,"destNode",void 0),$(this,"audioOutputLevel",0),$(this,"volumeLevelAnalyser",void 0),$(this,"_processedNode",void 0),$(this,"playNode",void 0),$(this,"isDestroyed",!1),$(this,"onNoAudioInput",void 0),$(this,"isNoAudioInput",!1),$(this,"_noAudioInputCount",0),this.context=Em(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),kh(this.outputNode),this.volumeLevelAnalyser=new lP}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(ya.ON_AUDIO_BUFFER,(function(n){for(let r=0;r<n.outputBuffer.numberOfChannels;r+=1){let s=n.outputBuffer.getChannelData(r);for(let c=0;c<s.length;c+=1)s[c]=0}return n.inputBuffer})(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Lt().webAudioMediaStreamDest)throw new de(M.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&hy(()=>{Yt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Jn()||Cs()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let i=this.volumeLevelAnalyser.getAnalyserNode(),n;i.getFloatTimeDomainData?(n=new Float32Array(i.fftSize),i.getFloatTimeDomainData(n)):(n=new Uint8Array(i.fftSize),i.getByteTimeDomainData(n));let r=!1;for(let s=0;s<n.length;s++)n[s]!==0&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await Sn(200),await this.checkHasAudioInput(t?t+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,i;(t=this.processedNode)===null||t===void 0||t.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class uP extends dP{get isFreeze(){return!1}constructor(t,i,n){var r;if(super(),$(this,"sourceNode",void 0),$(this,"track",void 0),$(this,"clonedTrack",void 0),$(this,"audioElement",void 0),$(this,"isCurrentTrackCloned",!1),$(this,"isRemoteTrack",!1),$(this,"originVolumeLevelAnalyser",void 0),$(this,"rebuildWebAudio",async()=>{if(C.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void C.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>C.info("resume success")),C.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let l=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?l.stop():this.isCurrentTrackCloned=!0;let d=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(d),kh(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let h=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(h,this.context.currentTime),kh(this.outputNode),this.emit(ya.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=d,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new de(M.UNEXPECTED_ERROR);this.track=t;let s=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(s),kh(this.sourceNode),n){let l=n.clone();l.enabled=!0,this.clonedTrack=l,C.debug("create an unmuted track ".concat(l.id," from the original track ").concat(n.id," to get the volume"));let d=this.context.createMediaStreamSource(new MediaStream([l]));kh(d),this.originVolumeLevelAnalyser=new lP,this.originVolumeLevelAnalyser.updateSource(d)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;let c=wt();i&&c.os===on.IOS&&Number((r=c.osVersion)===null||r===void 0?void 0:r.split(".")[0])<15&&(Yt.on(Tn.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(l=>{l||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;let i=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(i),kh(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ya.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Yt.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){let i=t.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),C.debug("create an unmuted track ".concat(i.id," from the original track ").concat(t.id," to get the volume"));let n=this.context.createMediaStreamSource(new MediaStream([i]));kh(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function hP(e,t,i){let n=(s,c)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||c:s:c,r={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:n(t.height,1080),maxWidth:n(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(r.video.mandatory.maxFrameRate=t.frameRate.max,r.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(r.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(r)}async function dF(e,t){let i=await pP(e.mediaSource),{sourceId:n,audio:r}=await(function(s){let c=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Ie((l,d)=>{let h=document.createElement("div");h.innerText="share screen",h.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let f=document.createElement("div");f.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let E=document.createElement("div");E.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",E.setAttribute("style","height: 12%;");let S=document.createElement("div");S.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let y=document.createElement("div");y.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let D=document.createElement("button");D.innerHTML="cancel",D.setAttribute("style","width: 85px;"),D.onclick=()=>{document.body.removeChild(k);let U=new Error("NotAllowedError");U.name="NotAllowedError",d(U)};let O=c,N=document.createElement("div");if(c){let U=document.createElement("input");U.setAttribute("type","checkbox");let B=document.createElement("span");U.setAttribute("style","margin-right: 6px;"),B.innerText="Share audio",U.checked=O,U.onchange=()=>{O=U.checked},N.appendChild(U),N.appendChild(B)}y.appendChild(N),y.appendChild(D),f.appendChild(E),f.appendChild(S),f.appendChild(y);let k=document.createElement("div");k.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),k.appendChild(h),k.appendChild(f),document.body.appendChild(k),s.map(U=>{if(U.id){let B=document.createElement("div");B.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let J=U.thumbnail;try{let{width:K}=J.getSize();K>1920&&(J=J.resize({width:1920}))}catch(K){throw K&&K.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),K}B.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+J.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+U.name.replace(/[\u00A0-\u9999<>\&]/g,function(K){return"&#"+K.charCodeAt(0)+";"})+"</span>",B.onclick=()=>{document.body.removeChild(k),l({sourceId:U.id,audio:O})},S.appendChild(B)}})})})(i,t);return await hP(n,e,r)}async function pP(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);let i=bL();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new de(M.ELECTRON_IS_NULL);let n=null;try{var r;n=((r=i.desktopCapturer)===null||r===void 0?void 0:r.getSources({types:t}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{n=null}n&&n.then||(n=new Ie((s,c)=>{i.desktopCapturer.getSources({types:t},(l,d)=>{l?c(l):s(d)})}));try{return await n}catch(s){throw new de(M.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}let Lw=new Vn("safari"),fP=!1,mP=!1;async function ba(e,t){let i=0,n=null;for(;i<2;)try{n=await uF(e,t,i>0);break}catch(r){if(r instanceof de)throw C.error("[".concat(t,"] ").concat(r.toString())),r;let s=Ry(r.name||r.code||r,r.message);if(s.code===M.MEDIA_OPTION_INVALID){C.debug("[".concat(t,"] detect media option invalid, retry")),i+=1,await Sn(500);continue}throw C.error("[".concat(t,"] ").concat(s.toString())),s}if(!n)throw new de(M.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return n}async function uF(e,t,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new de(M.NOT_SUPPORTED,"can not find getUserMedia");i&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let n=Lt(),r=new MediaStream;if(e.audioSource&&r.addTrack(e.audioSource),e.videoSource&&r.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return C.debug("Using Video Source/ Audio Source"),r;if(e.screen)if(bL())e.screen.sourceId?gm(r,await hP(e.screen.sourceId,e.screen,!!e.screenAudio)):gm(r,await dF(e.screen,!!e.screenAudio));else if(pl()&&e.screen.extensionId&&e.screen.mandatory){if(!n.getStreamFromExtension)throw new de(M.NOT_SUPPORTED,"This browser does not support screen sharing");C.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));let S=await(c=e.screen.extensionId,l=t,new Ie((y,D)=>{try{chrome.runtime.sendMessage(c,{getStream:!0},O=>{if(!O||!O.streamId)return C.error("[".concat(l,"] No response from Chrome Plugin. Plugin not installed properly"),O),void D(new de(M.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));y(O.streamId)})}catch(O){C.error("[".concat(l,"] AgoraRTC screensharing plugin is not accessible(").concat(c,")"),O.toString()),D(new de(M.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=S,gm(r,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(n.getDisplayMedia){var s;e.screen.mediaSource&&nP(e.screen.mediaSource);let S={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(s=e.screen.displaySurface)!==null&&s!==void 0?s:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:y,surfaceSwitching:D,systemAudio:O,preferCurrentTab:N}=e.screen,k={selfBrowserSurface:y,surfaceSwitching:D,systemAudio:O,preferCurrentTab:N};!y&&delete k.selfBrowserSurface,!D&&delete k.surfaceSwitching,!O&&delete k.systemAudio,!N&&delete k.preferCurrentTab,C.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:S,audio:e.screenAudio,controls:k})),gm(r,await navigator.mediaDevices.getDisplayMedia(ai({video:S,audio:e.screenAudio},k)))}else{if(!bi())throw C.error("[".concat(t,"] This browser does not support screenSharing")),new de(M.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&nP(e.screen.mediaSource);let S={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};C.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(S))),gm(r,await navigator.mediaDevices.getUserMedia(S))}}var c,l;if(!e.video&&!e.audio)return r;let d={video:e.video,audio:e.audio},h=j("MEDIA_DEVICE_CONSTRAINTS");if(h)try{typeof h=="string"&&(h=JSON.parse(h)),d=cw(d,h)}catch{}C.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(d)),wt();let f,E=null;(wn()||Jn()||ly())&&(E=await Lw.lock());try{f=await navigator.mediaDevices.getUserMedia(d)}catch(S){throw E&&E(),S}return d.audio&&(fP=!0),d.video&&(mP=!0),gm(r,f),E&&E(),r}function Ry(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new de(M.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new de(M.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new de(M.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new de(M.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new de(M.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new de(M.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return C.error("getUserMedia unexpected error",e),new de(M.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function gm(e,t){let i=e.getVideoTracks()[0],n=e.getAudioTracks()[0],r=t.getVideoTracks()[0],s=t.getAudioTracks()[0];s&&(n&&e.removeTrack(n),e.addTrack(s)),r&&(i&&e.removeTrack(i),e.addTrack(r))}let Aa=new class extends vi{get state(){return this._state}set state(e){e!==this._state&&(this.emit(xh.STATE_CHANGE,e),this._state=e)}constructor(){super(),$(this,"_state",Fg.IDLE),$(this,"isAccessMicrophonePermission",!1),$(this,"isAccessCameraPermission",!1),$(this,"lastAccessMicrophonePermission",!1),$(this,"lastAccessCameraPermission",!1),$(this,"checkdeviceMatched",!1),$(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(j("ENUMERATE_DEVICES_INTERVAL")||(dy()||cy()===on.HARMONY_OS)&&fl())&&this.updateDevicesInfo()},j("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>C.error(e.toString()))}async enumerateDevices(e,t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new de(M.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let n=await navigator.mediaDevices.enumerateDevices(),r=this.checkMediaDeviceInfoIsOk(n),s=!this.isAccessMicrophonePermission&&e,c=!this.isAccessCameraPermission&&t;r.audio&&(s=!1),r.video&&(c=!1);let l=null,d=null,h=null;if(!i&&(s||c)){if(Lw.isLocked&&(C.debug("[device manager] wait GUM lock"),(await Lw.lock())(),C.debug("[device manager] GUM unlock")),fP&&(s=!1,this.isAccessMicrophonePermission=!0),mP&&(c=!1,this.isAccessCameraPermission=!0),C.debug("[device manager] check media device permissions",e,t,s,c),s&&c){try{h=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(f){let E=Ry(f.name||f.code||f,f.message);if(E.code===M.PERMISSION_DENIED)throw E;C.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{l=await navigator.mediaDevices.getUserMedia({audio:e})}catch(f){let E=Ry(f.name||f.code||f,f.message);if(E.code===M.PERMISSION_DENIED)throw E;C.warning("getUserMedia failed in getDevices",E)}this.isAccessMicrophonePermission=!0}else if(c){try{d=await navigator.mediaDevices.getUserMedia({video:t})}catch(f){let E=Ry(f.name||f.code||f,f.message);if(E.code===M.PERMISSION_DENIED)throw E;C.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0}C.debug("[device manager] mic permission",e,"cam permission",t)}try{let f=await navigator.mediaDevices.enumerateDevices();return l&&l.getTracks().forEach(E=>E.stop()),d&&d.getTracks().forEach(E=>E.stop()),h&&h.getTracks().forEach(E=>E.stop()),l=null,d=null,h=null,f}catch(f){return l&&l.getTracks().forEach(E=>E.stop()),d&&d.getTracks().forEach(E=>E.stop()),h&&h.getTracks().forEach(E=>E.stop()),l=null,d=null,h=null,new de(M.ENUMERATE_DEVICES_FAILED,f.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(i=>{i.device.label===e&&(t=i.device.deviceId)}),t}async getDeviceById(e){let t=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===e);if(!t)throw new de(M.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Fg.INITING;try{await this.updateDevicesInfo(),this.state=Fg.INITEND}catch(e){throw C.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Fg.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new de(M.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){let e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),i=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let r=e.find(c=>c.kind==="audioinput"&&c.deviceId==="default"),s=e.find(c=>c.kind==="audiooutput"&&c.deviceId==="default");r&&s?s.groupId===r.groupId?C.debug("[device-check] default input ".concat(r.label," and output ").concat(s.label," is the same group")):C.debug("[device-check] default input ".concat(r.label," and output ").concat(s.label," is not the same group")):C.debug("[device-check] default input or output not found")}let n=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(r=>{if(!r.deviceId)return;let s=this.deviceInfoMap.get("".concat(r.kind,"_").concat(r.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){let c={initAt:t,updateAt:t,device:r,state:"ACTIVE"};this.deviceInfoMap.set("".concat(r.kind,"_").concat(r.deviceId),c),i.push(c)}s&&(s.updateAt=t)}),this.deviceInfoMap.forEach((r,s)=>{r.state==="ACTIVE"&&r.updateAt!==t&&(r.state="INACTIVE",i.push(r))}),this.state!==Fg.INITEND)return n.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(n.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(r=>{switch(r.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(xh.RECORDING_DEVICE_CHANGED,r);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(xh.CAMERA_DEVICE_CHANGED,r);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(xh.PLAYOUT_DEVICE_CHANGED,r)}}),n.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),n.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){let t=e.filter(r=>r.kind==="audioinput"),i=e.filter(r=>r.kind==="videoinput"),n={audio:!1,video:!1};for(let r of t)if(r.label&&r.deviceId){n.audio=!0;break}for(let r of i)if(r.label&&r.deviceId){n.video=!0;break}return n}},Pw=!1,wa=new class extends vi{constructor(){super(...arguments),$(this,"onAutoplayFailed",void 0),$(this,"onAudioAutoplayFailed",void 0)}};function _P(){if(wt(),!Pw){let e=t=>{t.preventDefault(),Pw=!1,Dg()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Pw=!0,Dg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),C.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),wa.onAutoplayFailed?wa.onAutoplayFailed():wa.onAudioAutoplayFailed?C.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):C.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),wa.emit("autoplay-failed")}}function EP(e,t,i,n){if(!e)return;let r=He.getBaseInfoBySessionId(e);if(!r)return;let s=r.info,c=Date.now(),l=ai(ai({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:c,elapse:c-r.startTime,cbRegistered:wa.onAutoplayFailed||wa.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:t,trackId:n,extend:void 0});He.send({type:fi.AUTOPLAY_FAILED,data:l},!0)}let hF=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Ar=new class{constructor(){$(this,"onAutoplayFailed",void 0),$(this,"elementMap",new Map),$(this,"elementStateMap",new Map),$(this,"elementsNeedToResume",[]),$(this,"sinkIdMap",new Map),$(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[i,n]=t,r=this.elementStateMap.get(i),s=n.srcObject.getAudioTracks()[0],c=s&&s.readyState;if(C.debug("resume after interrupted, ele: ".concat(r," audio: ").concat(c," ").concat(e)),c==="live"){if(e)return n.pause(),void n.play();if(Yt.curState==="running")return rm()?(n.pause(),void n.play()):void(r&&r==="paused"&&n.play())}})}),$(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,i]=e,n=i.srcObject.getAudioTracks()[0];n&&n.readyState==="live"&&(C.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),Yt.on(Tn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Yt.on(Tn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Yt.on(Tn.STATE_CHANGE,()=>{Jn()&&Yt.prevState==="suspended"&&Yt.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){let i=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),i)try{await i.setSinkId(t)}catch(n){throw new de(M.PERMISSION_DENIED,"can not set sink id: "+n.toString())}}play(e,t,i,n){if(this.elementMap.has(t))return;let r=document.createElement("audio");r.autoplay=!0,r.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,r),this.elementMap.set(t,r),this.elementStateMap.set(t,jn.INIT),this.setVolume(t,i);let s=this.sinkIdMap.get(t);if(s)try{r.setSinkId(s).catch(l=>{C.warning("[".concat(t,"] set sink id failed"),l.toString())})}catch(l){C.warning("[".concat(t,"] set sink id failed"),l.toString())}let c=r.play();c&&c.then&&c.catch(l=>{n&&EP(n,"audio",l.message,t),C.warning("audio element play warning",l.toString()),this.elementMap.has(t)&&l.name==="NotAllowedError"&&(C.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(r),hy(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),_P()}))})}updateTrack(e,t){let i=this.elementMap.get(e);i&&(i.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){let i=this.elementMap.get(e);i&&(t=Math.max(0,Math.min(100,t)),i.volume=t/100)}stop(e){let t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;let i=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(i,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){hF.forEach(i=>{t.addEventListener(i,n=>{let r=this.elementStateMap.get(e),s=n.type==="pause"?"paused":n.type;if(C.debug("[".concat(e,"] audio-element-status change ").concat(r," => ").concat(s)),n.type==="error"){let c=t?.error;c&&C.error("[".concat(e,"] media error, code: ").concat(c.code,", message: ").concat(c.message))}this.elementStateMap.set(e,s)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(i=>{C.debug("Auto resume audio element success")}).catch(i=>{C.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new Ie(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Dg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Ii(){return function(e,t,i){let n=i.value;return typeof n=="function"&&(i.value=function(){this._isClosed&&new de(M.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",C);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];let l=n.apply(this,s);return l instanceof Ie?new Ie((d,h)=>{l.then(d).catch(h)}):l}),i}}class gP extends vi{constructor(t){super(),$(this,"name","VideoProcessorDestination"),$(this,"ID","0"),$(this,"_source",void 0),$(this,"videoContext",void 0),$(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new de(M.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new de(M.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(pr.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(pr.ON_TRACK,void 0)}}class SP extends vi{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,i){super(),$(this,"constraintsMap",new Map),$(this,"statsRegistry",[]),$(this,"usageRegistry",[]),$(this,"trackId",void 0),$(this,"direction",void 0),$(this,"_chained",!1),this.trackId=t,this.direction=i}async getConstraints(){return await On(this,Ra.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,i){var n;return C.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(i,t),$t(this,Ra.REQUEST_UPDATE_CONSTRAINTS,Array.from(Cr(n=this.constraintsMap).call(n)))}async requestRevertConstraints(t){var i;if(this.constraintsMap.has(t))return C.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),$t(this,Ra.REQUEST_UPDATE_CONSTRAINTS,Array.from(Cr(i=this.constraintsMap).call(i)))}registerStats(t,i,n){this.statsRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name&&r.type===i)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:i,cb:n})}unregisterStats(t,i){let n=this.statsRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name&&r.type===i);n!==-1&&this.statsRegistry.splice(n,1)}gatherStats(){let t=[];for(let{processorID:i,processorName:n,type:r,cb:s}of this.statsRegistry)try{let c=s();t.push({processorID:i,processorName:n,type:r,stats:c})}catch(c){C.error(new de(M.UNEXPECTED_ERROR,c.message))}return t}registerUsage(t,i){this.usageRegistry.find(n=>n.processorID===t.ID&&n.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:i})}unregisterUsage(t){let i=this.usageRegistry.findIndex(n=>n.processorID===t.ID&&n.processorName===t.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:i}of this.usageRegistry)try{let n=i();n instanceof Ie&&(n=await n),t.push(ai(ai({},n),{},{direction:this.direction}))}catch(n){C.error("gather extension usage error",n)}return t}getDirection(){return this.direction}}class vP extends vi{constructor(t){super(),$(this,"name","AudioProcessorDestination"),$(this,"ID","0"),$(this,"inputTrack",void 0),$(this,"inputNode",void 0),$(this,"audioProcessorContext",void 0),$(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new de(M.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new de(M.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(pr.ON_TRACK,void 0),this.emit(pr.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(pr.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(pr.ON_NODE,this.inputNode))}}class TP extends vi{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,i,n){super(),$(this,"constraintsMap",new Map),$(this,"statsRegistry",[]),$(this,"audioContext",void 0),$(this,"trackId",void 0),$(this,"direction",void 0),$(this,"usageRegistry",[]),$(this,"_chained",!1),this.audioContext=t,this.trackId=i,this.direction=n}async getConstraints(){return On(this,Ra.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,i){var n;return C.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(i,t),$t(this,Ra.REQUEST_UPDATE_CONSTRAINTS,Array.from(Cr(n=this.constraintsMap).call(n)))}async requestRevertConstraints(t){var i;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),$t(this,Ra.REQUEST_UPDATE_CONSTRAINTS,Array.from(Cr(i=this.constraintsMap).call(i)))}registerStats(t,i,n){this.statsRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name&&r.type===i)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:i,cb:n})}unregisterStats(t,i){let n=this.statsRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name&&r.type===i);n!==-1&&this.statsRegistry.splice(n,1)}gatherStats(){let t=[];for(let{processorID:i,processorName:n,type:r,cb:s}of this.statsRegistry)try{let c=s();t.push({processorID:i,processorName:n,type:r,stats:c})}catch(c){C.error(new de(M.UNEXPECTED_ERROR,c.message))}return t}registerUsage(t,i){this.usageRegistry.find(n=>n.processorID===t.ID&&n.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:i})}unregisterUsage(t){let i=this.usageRegistry.findIndex(n=>n.processorID===t.ID&&n.processorName===t.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:i}of this.usageRegistry)try{let n=i();n instanceof Ie&&(n=await n),t.push(ai(ai({},n),{},{direction:this.direction}))}catch(n){C.error("gather extension usage error",n)}return t}getDirection(){return this.direction}}class xw extends vi{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),$(this,"context",void 0),$(this,"processSourceNode",void 0),$(this,"outputTrack",void 0),$(this,"processedNode",void 0),$(this,"clonedTrack",void 0),$(this,"outputNode",void 0),this.outputNode=new pF}setVolume(){}createOutputTrack(){throw new de(M.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class pF{disconnect(){}connect(){}}function yP(e){return new Ie((t,i)=>{let n=!1,r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.autoplay=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(r);let s=Jn()?"canplay":"playing";r.addEventListener(s,()=>{let c=r.videoWidth,l=r.videoHeight;!c&&bi()||(n=!0,r.srcObject=null,r.remove(),t([c,l]))}),r.srcObject=new MediaStream([e]),r.play().catch(py),setTimeout(()=>{n||(r.srcObject=null,r.remove(),t([r.videoWidth,r.videoHeight]))},4e3)})}function Cy(e){let t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});let i=ws(e.encoderConfig);return i.width!=null&&(t.width=i.width),i.height!=null&&(t.height=i.height),!vL()&&i.frameRate&&(t.frameRate=i.frameRate),hL()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),bi()&&(t.frameRate={ideal:30,max:30}),t}function RP(e){let t={};return vL()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,pl()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function CP(e){let t=RP(e);if(e.encoderConfig){let i=Ty(e.encoderConfig);t.channelCount=i.stereo?2:1,t.sampleRate=i.sampleRate,t.sampleSize=i.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),dy()&&(t.sampleRate=void 0),t}let fF=e=>{let t=e._encoderConfig;if(!t)return;let{frameRate:i,width:n,height:r}=e.getMediaStreamTrackSettings(),{frameRate:s=i,width:c=n,height:l=r}=t;if(!s||!c||!l)return;c=om(c),l=om(l),s=om(s);let{max:d,min:h}=(function(y,D,O){let N=200*Math.pow(O/15,.6)*Math.pow(y*D/640/360,.75);return{min:Math.floor(N),max:Math.floor(4*N)}})(c,l,s),{bitrateMax:f,bitrateMin:E}=t||{};f||C.debug("calculate bitrate: [w: ".concat(c,", h: ").concat(l,", fps: ").concat(s,"] => [brMax: ").concat(f,", brMin: ").concat(E,"]"));let{maxFramerate:S}=j("ENCODER_CONFIG_LIMIT");return S&&typeof S=="number"&&(s=Math.min(s,S)),{frameRate:s,bitrateMax:f||d,bitrateMin:E||h,scaleResolutionDownBy:1,scale:0}},bP=async(e,t,i)=>await(async(n,r,s)=>{let c=(function(h){let f=[];for(let E=0;E<h.length;E+=2)f.push(parseInt(h.slice(E,E+2),16));return Uint8Array.from(f)})(ML(""+r+s)).slice(0,16),l=c.slice(0,12),d=await window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:l},d,n))})(e.buffer,t,i),kw=e=>{let t=document.createElement("canvas");return t.width=2,t.height=2,new Ie((i,n)=>{t.toBlob(async r=>{if(t.remove(),r){let s=await AP(r);i({buffer:s,width:t.width,height:t.height})}else n(new de(M.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},AP=async e=>{let t=await e.arrayBuffer();return new Uint8Array(t)};var wP,IP,OP,NP,DP,LP,PP,xP,kP,MP,UP,VP,jP,BP,FP,GP,HP,WP,Ti,zP,KP,YP,qP,XP,JP,dc,ZP,QP,$P,ex,tx,ix,nx,rx,ax,sx,ox,cx,lx,Dn;let Oi=(wP=Ze({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),IP=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),OP=Ii(),NP=cm("LocalAudioTrack","_enabledMutex"),DP=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),LP=Ii(),PP=cm("LocalAudioTrack","_enabledMutex"),xP=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),kP=Ii(),MP=Ii(),UP=Ii(),VP=Ze({argsMap:e=>[e.getTrackId()]}),jP=Ii(),BP=Ze({argsMap:e=>[e.getTrackId()]}),FP=Ii(),GP=Ze({argsMap:e=>[e.getTrackId()]}),HP=Ze({argsMap:(e,t)=>[e.getTrackId(),t.name]}),WP=Ze({argsMap:e=>[e.getTrackId()]}),At((Ti=class extends _m{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Ar.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,i,n){super(e,i),$(this,"trackMediaType",mm.AUDIO),$(this,"_encoderConfig",void 0),$(this,"_trackSource",void 0),$(this,"metadata",[]),$(this,"_enabled",!0),$(this,"_volume",100),$(this,"_useAudioElement",!0),$(this,"_bypassWebAudio",!1),$(this,"processor",void 0),$(this,"_processorContext",void 0),$(this,"_processorDestination",void 0),$(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!n,this._trackSource=new xw,j("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),j("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),wn()&&!Ca?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Jt(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Ar.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void C.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,$t(this,je.NEED_REPLACE_TRACK,this).then(()=>{C.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{C.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!tP())throw new de(M.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ar.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,i){return this._setEnabled(e,t,i)}async _setEnabled(e,t,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(C.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await $t(this,je.NEED_ENABLE_TRACK,this),C.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(n){throw i||(this._enabled=!1),C.error("[".concat(this.getTrackId(),"] setEnabled to true error"),n.toString()),n}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await $t(this,je.NEED_DISABLE_TRACK,this)}catch(n){throw i||(this._enabled=!0),C.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,C.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await $t(this,je.NEED_MUTE_TRACK,this):await $t(this,je.NEED_UNMUTE_TRACK,this))}getStats(){return Vd(()=>{C.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),va(this,je.GET_STATS)||ai({},ww)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ya.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ya.ON_AUDIO_BUFFER),this._source.on(ya.ON_AUDIO_BUFFER,i=>e(i))}play(){C.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(C.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Ar.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){C.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Ar.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];C.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ar.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await $t(this,je.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Ie.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new de(M.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new de(M.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(pr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await $t(this,je.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await $t(this,je.NEED_REPLACE_TRACK,this))}),e.on(pr.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(pr.ON_TRACK),e.removeAllListeners(pr.ON_NODE)}bindProcessorContextEvents(e){e.on(Ra.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Ra.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof xw&&(this._trackSource=new uP(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new TP(this._source.context,this.getTrackId(),"local"),t=new vP(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(ya.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Ar.stop(this.getTrackId()),this._source.play()),$t(this,je.NEED_REPLACE_MIXING_TRACK,this).then(()=>{C.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{C.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[wP],Object.getOwnPropertyDescriptor(Ti.prototype,"setVolume"),Ti.prototype),At(Ti.prototype,"setPlaybackDevice",[IP,OP],Object.getOwnPropertyDescriptor(Ti.prototype,"setPlaybackDevice"),Ti.prototype),At(Ti.prototype,"setEnabled",[NP,DP,LP],Object.getOwnPropertyDescriptor(Ti.prototype,"setEnabled"),Ti.prototype),At(Ti.prototype,"setMuted",[PP,xP,kP],Object.getOwnPropertyDescriptor(Ti.prototype,"setMuted"),Ti.prototype),At(Ti.prototype,"getStats",[MP],Object.getOwnPropertyDescriptor(Ti.prototype,"getStats"),Ti.prototype),At(Ti.prototype,"setAudioFrameCallback",[UP],Object.getOwnPropertyDescriptor(Ti.prototype,"setAudioFrameCallback"),Ti.prototype),At(Ti.prototype,"play",[VP,jP],Object.getOwnPropertyDescriptor(Ti.prototype,"play"),Ti.prototype),At(Ti.prototype,"stop",[BP,FP],Object.getOwnPropertyDescriptor(Ti.prototype,"stop"),Ti.prototype),At(Ti.prototype,"close",[GP],Object.getOwnPropertyDescriptor(Ti.prototype,"close"),Ti.prototype),At(Ti.prototype,"pipe",[HP],Object.getOwnPropertyDescriptor(Ti.prototype,"pipe"),Ti.prototype),At(Ti.prototype,"unpipe",[WP],Object.getOwnPropertyDescriptor(Ti.prototype,"unpipe"),Ti.prototype),Ti),Gg=(zP=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),KP=Ii(),YP=cm("MicrophoneAudioTrack","_enabledMutex"),qP=Ze({argsMap:(e,t,i)=>[e.getTrackId(),t,i]}),XP=Ii(),JP=Ze({argsMap:e=>[e.getTrackId()]}),At((dc=class extends Oi{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,i,n){super(e,t.encoderConfig?Ty(t.encoderConfig):{},n,j("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),$(this,"_config",void 0),$(this,"_deviceName","default"),$(this,"_constraints",void 0),$(this,"_originalConstraints",void 0),$(this,"_enabled",!0),this._config=t,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(rm()||tw())&&Yt.bindInterruptDetectorTrack(this)}async setDevice(e){if(C.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{let t=await Aa.getDeviceById(e),i={};i.audio=ai({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let n=null;try{n=await ba(i,this.getTrackId())}catch(r){throw C.error("[".concat(this.getTrackId(),"] setDevice failed"),r.toString()),n=await ba({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw C.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{let t=await Aa.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw C.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}C.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,i){if(t)return C.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(C.info("[".concat(this.getTrackId(),"] start setEnabled"),e),j("AUTO_RESET_AUDIO_ROUTE")&&(Jn()||Cs())){let c=navigator.audioSession;c&&(e||(c.type="playback"),c.type="auto")}if(!e){var n;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(n=this._source.clonedTrack)===null||n===void 0||n.stop(),i||(this._enabled=!1);try{await $t(this,je.NEED_DISABLE_TRACK,this)}catch(c){throw C.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}let r=ai({},this._constraints),s=Aa.searchDeviceIdByName(this._deviceName);s&&!r.deviceId&&(r.deviceId=s);try{i||(this._enabled=!0);let c=await ba({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await $t(this,je.NEED_ENABLE_TRACK,this)}catch(c){throw i||(this._enabled=!1),C.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}C.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(rm()||tw())&&Yt.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Jn()||Cs())&&this._enabled&&!this._isClosed&&Yt.duringInterruption){let e=async()=>{Yt.off(Tn.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(C.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Yt.on(Tn.IOS_INTERRUPTION_END,e)}else C.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(fm.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,i=Aa.searchDeviceIdByName(this._deviceName);if(i&&!t.deviceId&&(t.deviceId=i),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();let n=await ba({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Ra.REQUEST_UPDATE_CONSTRAINTS,async(t,i,n)=>{try{let r=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(r),i()}catch(r){n(r)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Ra.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[zP,KP],Object.getOwnPropertyDescriptor(dc.prototype,"setDevice"),dc.prototype),At(dc.prototype,"setEnabled",[YP,qP,XP],Object.getOwnPropertyDescriptor(dc.prototype,"setEnabled"),dc.prototype),At(dc.prototype,"close",[JP],Object.getOwnPropertyDescriptor(dc.prototype,"close"),dc.prototype),dc),mF=(ZP=Ze({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),QP=Ii(),$P=Ze({argsMap:e=>[e.getTrackId()]}),ex=Ii(),tx=Ze({argsMap:e=>[e.getTrackId()]}),ix=Ii(),nx=Ze({argsMap:e=>[e.getTrackId()]}),rx=Ii(),ax=Ze({argsMap:e=>[e.getTrackId()]}),sx=Ii(),ox=Ze({argsMap:e=>[e.getTrackId()]}),cx=Ze({argsMap:e=>[e.getTrackId()]}),lx=Ii(),At((Dn=class extends Oi{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,i,n){super(t.createOutputTrack(),i,n),$(this,"source",void 0),$(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(ya.AUDIO_SOURCE_STATE_CHANGE,r=>{this.safeEmit(fm.SOURCE_STATE_CHANGE,r)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Jt(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[ZP,QP],Object.getOwnPropertyDescriptor(Dn.prototype,"startProcessAudioBuffer"),Dn.prototype),At(Dn.prototype,"pauseProcessAudioBuffer",[$P,ex],Object.getOwnPropertyDescriptor(Dn.prototype,"pauseProcessAudioBuffer"),Dn.prototype),At(Dn.prototype,"seekAudioBuffer",[tx,ix],Object.getOwnPropertyDescriptor(Dn.prototype,"seekAudioBuffer"),Dn.prototype),At(Dn.prototype,"resumeProcessAudioBuffer",[nx,rx],Object.getOwnPropertyDescriptor(Dn.prototype,"resumeProcessAudioBuffer"),Dn.prototype),At(Dn.prototype,"stopProcessAudioBuffer",[ax,sx],Object.getOwnPropertyDescriptor(Dn.prototype,"stopProcessAudioBuffer"),Dn.prototype),At(Dn.prototype,"close",[ox],Object.getOwnPropertyDescriptor(Dn.prototype,"close"),Dn.prototype),At(Dn.prototype,"setAudioBufferPlaybackSpeed",[cx,lx],Object.getOwnPropertyDescriptor(Dn.prototype,"setAudioBufferPlaybackSpeed"),Dn.prototype),Dn);class Ji extends Oi{get __className__(){return"MixingAudioTrack"}get isActive(){for(let t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){let t=Em().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,ei(8,"track-mix-")),$(this,"trackList",void 0),$(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(C.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):C.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){C.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}uy(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){let t={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(i=>{i instanceof Ji?i.emit(Ph.TRANSCEIVER_UPDATED,t):i._updateRtpTransceiver(t)}))}}class _F extends dP{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(ya.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),$(this,"audioBuffer",void 0),$(this,"sourceNode",void 0),$(this,"startPlayTime",0),$(this,"startPlayOffset",0),$(this,"pausePlayTime",0),$(this,"options",void 0),$(this,"currentLoopCount",0),$(this,"currentPlaybackSpeed",100),$(this,"_currentState","stopped"),this.audioBuffer=t,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):C.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let dx=new Map;function ux(e,t){if(e.length===0||t.length===0)return 1/0;let i=lw(e),n=lw(t);return Math.floor(n/i)}class Mw{get rendFrameRate(){let t=Math.max(1,ux(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:jn.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(C.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var i;t!==this._videoState&&(this._videoState=t,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(t){$(this,"trackId",void 0),$(this,"config",void 0),$(this,"onFirstVideoFrameDecoded",void 0),$(this,"onFirstVideoFrameRender",void 0),$(this,"onVideoStateChanged",void 0),$(this,"freezeTimeCounterList",[]),$(this,"renderFreezeAccTime",0),$(this,"renderFreezeAccTime2",0),$(this,"isKeepLastFrame",!1),$(this,"isDestroyed",!1),$(this,"timeUpdatedCount",0),$(this,"freezeTime",0),$(this,"playbackTime",0),$(this,"lastTimeUpdatedTime",0),$(this,"autoplayFailed",!1),$(this,"videoTrack",void 0),$(this,"videoElement",void 0),$(this,"cacheVideoElement",void 0),$(this,"internal",!1),$(this,"_render_interframe_delays",[]),$(this,"_render_interframe_delays_sizes",[]),$(this,"_videoState",lc.VideoStateStopped),$(this,"videoElementCheckInterval",void 0),$(this,"videoElementFreezeTimeout",void 0),$(this,"_videoElementStatus",jn.NONE),$(this,"_isInPage",!0),$(this,"isGettingVideoDimensions",!1),$(this,"startGetVideoDimensions",()=>{let i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return C.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),$(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Yt.curState==="running"&&(C.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(dL())),gL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),$(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":i.type==="play"&&C.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=jn.PLAYING;break;case"loadeddata":if(this.videoState=lc.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=jn.CANPLAY;break;case"stalled":this.videoElementStatus=jn.STALLED;break;case"suspend":this.videoElementStatus=jn.SUSPEND;break;case"pause":this.videoElementStatus=jn.PAUSED,Jn()||Cs()||wn()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(C.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=jn.WAITING;break;case"abort":this.videoElementStatus=jn.ABORT;break;case"ended":this.videoElementStatus=jn.ENDED;break;case"emptied":this.videoElementStatus=jn.EMPTIED;break;case"error":{let n=this.videoElement.error;n&&(this.videoElementStatus=jn.ERROR,C.error("[".concat(this.trackId,"] media error: ").concat(n.message," (").concat(n.code,")")));break}case"timeupdate":{let n=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=n);let r=n-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=n,uc.lastVisibleTime<uc.lastHiddenTime||s<uc.lastHiddenTime||s<uc.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(r>j("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=r),this.playbackTime+=r;this.playbackTime>=6e3;){this.playbackTime-=6e3;let c=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(c),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),$(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(C.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(dL())),gL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Yt.on(Tn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Yt.on(Tn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){let i=this.videoElement.play();i&&i.catch&&i.catch(r=>{t&&EP(t,"video",r.message,this.trackId),r.name==="NotAllowedError"?(C.warning("detected video element autoplay failed",r),this.autoplayFailed=!0,this.handleAutoPlayFailed()):C.warning("[".concat(this.trackId,"] play warning: "),r)});let n=wt();if((n.name==="Safari"&&Number(n.version)===15||rm())&&i&&i.then){let r=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(r).catch(r)}}getCurrentFrame(){let t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;let i=t.getContext("2d");if(!i)return C.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,t.width,t.height);let n=i.getImageData(0,0,t.width,t.height);return t.remove(),n}async getCurrentFrameToUint8Array(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;let r=n.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,n.width,n.height),new Ie((s,c)=>{n.toBlob(async l=>{if(n.remove(),l){let d=await AP(l);s({buffer:d,width:n.width,height:n.height})}else c(new de(M.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,i<0?.1:i>1?1:i)})):await kw(t)}destroy(){this.isDestroyed=!0,Yt.off(Tn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Yt.off(Tn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=lc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=jn.INIT,!this.videoElementCheckInterval&&(hx.forEach(s=>{this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=(function(s){return s!==document.body&&document.body.contains(s)})(this.videoElement)},1e3),j("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,i;let s,c=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",c),this.videoElementFreezeTimeout=window.setTimeout(l,j("VIDEO_FREEZE_DURATION")))},l=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===lc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=lc.VideoStateFrozen:document.addEventListener("visibilitychange",c))},d=(h,f)=>{if(this.videoElementStatus===jn.PLAYING){if(s){let y=f.presentationTime-s.presentationTime,D=f.presentedFrames-s.presentedFrames;this._render_interframe_delays_sizes.push(D),this._render_interframe_delays.push(y);let O=lw(this._render_interframe_delays_sizes),N=O-this._render_interframe_delays_sizes[0];if(O>30&&N>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===lc.VideoStateStarting&&(this.videoState=lc.VideoStateDecoding),this.videoState===lc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(l,j("VIDEO_FREEZE_DURATION"))),y<j("VIDEO_FREEZE_DURATION")&&this.videoState===lc.VideoStateFrozen&&(this.videoState=lc.VideoStateDecoding),y>j("VIDEO_FREEZE_DURATION")&&uc.lastVisibleTime>=uc.lastHiddenTime&&s.timestamp>uc.lastVisibleTime&&s.timestamp>uc.lastHiddenTime){let k=Math.min(66,ux(this._render_interframe_delays_sizes,this._render_interframe_delays)),U=Math.max(0,y-(D-1)*k);this.renderFreezeAccTime2+=U>k?U:0,this.renderFreezeAccTime+=y}}s=ai(ai({},f),{},{timestamp:h})}else this.isSkipCalcRenderFreezeTime()&&(s=ai(ai({},f),{},{timestamp:h}));var E,S;j("ENABLE_VIDEO_FRAME_CALLBACK")&&((E=(S=this.videoElement).requestVideoFrameCallback)===null||E===void 0||E.call(S,d))};(t=(i=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(i,d)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),dy()&&!j("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let n=wt();n.name==="Safari"&&Number(n.version)===15||rm()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,bi()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,bi()&&this.videoElement.load());let r=this.videoElement.play();r!==void 0&&r.catch(s=>{C.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}resetVideoElement(){hx.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=jn.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===jn.DESTROYED||this.internal}handleAutoPlayFailed(){let t=i=>{i.preventDefault(),this.videoElement.play().then(()=>{C.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(n=>{C.error(n)}),this.autoplayFailed=!1,Dg()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Dg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),_P()}}let hx=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Uw extends Mw{constructor(t){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),$(this,"container",void 0),$(this,"slot",void 0),this.slot=t.element,this.internal=i,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;let i=t.element;var n;!this.internal||this.slot?(i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()):(this.slot=i,i&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(n=this.slot)===null||n===void 0||n.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var i;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,n):await kw(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",j("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var px,fx,mx,_x,Ex,gx,Sx,vx,Tx,yx,Rx,Cx,bx,Ax,wx,Ix,Ox,Nx,Dx,Lx,Px,xx,kx,Mx,Ux,Vx,jx,Bx,St,Fx,Gx,Hx,Wx,zx,Kx,Yx,qx,Ia;let oi=(px=Ze({argsMap:(e,t,i)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),fx=Ii(),mx=Ze({argsMap:e=>[e.getTrackId()]}),_x=cm("LocalVideoTrack","_enabledMutex"),Ex=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),gx=Ii(),Sx=cm("LocalVideoTrack","_enabledMutex"),vx=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),Tx=Ii(),yx=Ze({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),Rx=Ii(),Cx=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),bx=Ii(),Ax=Ii(),wx=Ze({argsMap:(e,t,i)=>[e.getTrackId(),t,i]}),Ix=Ii(),Ox=Ii(),Nx=Ii(),Dx=Ze({argsMap:e=>[e.getTrackId()]}),Lx=Ii(),Px=Ii(),xx=Ii(),kx=Ii(),Mx=Ii(),Ux=Ze({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Vx=Ze({argsMap:e=>[e.getTrackId()]}),jx=Ze({argsMap:e=>[e.getTrackId()]}),Bx=Ze({argsMap:(e,t,i)=>[e.getTrackId(),t.label,i]}),St=class WV extends _m{get videoHeight(){if(wn()){let{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(wn()){let{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==jn.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,i,n,r,s,c){if(super(t,s),$(this,"trackMediaType",mm.VIDEO),$(this,"_player",void 0),$(this,"isUseScaleResolutionDownBy",!1),$(this,"_videoVisibleTimer",null),$(this,"_previousVideoVisibleStatus",void 0),$(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),$(this,"_encoderConfig",void 0),$(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),$(this,"_optimizationMode",void 0),$(this,"_saveEncodeBitrateRatio",1),$(this,"_videoHeight",void 0),$(this,"_videoWidth",void 0),$(this,"_forceBitrateLimit",void 0),$(this,"_enabled",!0),$(this,"_processorDestination",void 0),$(this,"_processorContext",void 0),wn()){let{width:l,height:d}=t.getSettings();this._videoWidth=l,this._videoHeight=d}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=n,this._optimizationMode=r,this._hints=c||[],i&&this._hints.indexOf(Zt.CUSTOM_TRACK)!==-1?this._encoderConfig=Ei(i):this._encoderConfig=i,this._hints.indexOf(Zt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(JA(kt.CHROME,115)&&cy().indexOf("Windows")!==-1){let l=(function(d,h){if("VideoFrame"in window&&"TransformStream"in window&&Lt().supportWebRTCInsertableStream){let f=new MediaStreamTrackProcessor(d),E=new MediaStreamTrackGenerator({kind:"video"}),S,y,D=Date.now(),O=()=>{N&&(clearInterval(N),N=void 0),S&&(S.close(),S=void 0),d.stop(),y=void 0,E.removeEventListener("ended",O)},N=window.setInterval(()=>{if(y&&S&&Date.now()-D>1e3)try{E.readyState==="live"?y.enqueue(S.clone()):O()}catch{O()}},1e3),k=new TransformStream({transform:(U,B)=>{E.readyState==="live"?(y=B,D=Date.now(),S===void 0?(S=U,B.enqueue(U.clone())):(B.enqueue(S),S=U)):U.close()}});return E.addEventListener("ended",O),f.readable.pipeThrough(k).pipeTo(E.writable),E}})(t);l&&(C.info("local screen video track begin to inject frame"),this._mediaStreamTrack=l)}i&&this._hints.indexOf(Zt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new SP(this.getTrackId(),"local"),this._processorDestination=new gP(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){let r=document.getElementById(t);r?t=r:(C.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}C.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));let n=ai(ai(ai({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(n):(t instanceof HTMLVideoElement?this._player=new Mw(n):this._player=new Uw(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let r=this.getVideoElementVisibleStatus();this.safeEmit(fm.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},j("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,C.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,i){if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(C.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await $t(this,je.NEED_DISABLE_TRACK,this)}catch(n){throw C.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}return i||(this._enabled=!1),void C.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await $t(this,je.NEED_ENABLE_TRACK,this)}catch(n){throw C.error("[".concat(this.getTrackId(),"] setEnabled to true error"),n.toString()),n}C.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,C.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await $t(this,je.NEED_MUTE_TRACK,this):await $t(this,je.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),C.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await $t(this,je.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(C)}}}async setEncoderConfiguration(t,i){if(!this._enabled)throw new de(M.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=ws(t),j("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){let n=Cy({encoderConfig:t});(wn()||Jn()||Cs())&&(n.deviceId=void 0),C.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(n));try{await this._originMediaStreamTrack.applyConstraints(n),this.updateMediaStreamTrackResolution()}catch(r){let s=new de(M.UNEXPECTED_ERROR,r.toString());throw C.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=t,this._hints.indexOf(Zt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await $t(this,je.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(C)}}getStats(){return Vd(()=>{C.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),va(this,je.GET_STATS)||ai({},Iw)}async setBeautyEffect(t){C.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,i):await kw(t)}async findClosestProfile(){let{width:t,height:i,frameRate:n}=this.getMediaStreamTrackSettings(),{width:r,height:s,frameRate:c}=this._encoderConfig||{},l=om(this._videoWidth||t||r||0),d=om(this._videoHeight||i||s||0),h=(function(f,E,S){if(!Array.isArray(j("VIDEO_ENCODER_CONFIG_LIST"))||j("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;let y=Math.min(f,E);return!(y>=480)&&ai(ai({},j("VIDEO_ENCODER_CONFIG_LIST").find(D=>D.height>y)),{},{frameRate:S})})(l,d,om(n||c||15));if(h)return C.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(l,"x").concat(d," => ").concat(JSON.stringify(h))),this.setEncoderConfiguration(h)}async setBitrateLimit(t){C.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void C.error(M.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let i=this._optimizationMode;try{this._optimizationMode=t,await $t(this,je.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(n){throw this._optimizationMode=i,C.error("[".concat(this.getTrackId(),"] set optimization mode failed"),n.toString()),n}C.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return C.error(M.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,C.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){yP(this._originMediaStreamTrack).then(t=>{let[i,n]=t;this._videoHeight=n,this._videoWidth=i}).catch(py)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new de(M.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");C.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=ws(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Zt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await $t(this,je.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(C)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:t,height:i,frameRate:n}=this.getMediaStreamTrackSettings();if(!t||!i||!n)return;let{bitrateMax:r,bitrateMin:s}=this._encoderConfig;if(s==null||r==null){let{max:c,min:l}=(function(d,h,f,E,S){let y=j("BITRATE_ADAPTER_TYPE");if(y==="DEFAULT_BITRATE")return{min:E,max:S};if(S===void 0){let D=Math.floor(200*Math.pow(f/15,.6)*Math.pow(d*h/640/360,.75));S=y==="STANDARD_BITRATE"?4*D:2*D,E=E??D}else E=E??Math.floor(S/10);return{min:E,max:S}})(t,i,n,s,r);if(this._encoderConfig.bitrateMin=l,this._encoderConfig.bitrateMax=c,j("VIDEO_STANDARD_BITRATE_VERSION")&&s==null&&r==null){let[d,h]=(function(f,E,S){let y=4*Math.floor(2e5*Math.pow(S/15,.6)*Math.pow(f*E/230400,.75)),D=f*E,O=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),N=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]),k=Cr(O).call(O).next().value,U=1;if(O.has(D))k=O.get(D);else{var B;let ye=lt(B=Array.from(O.entries())).call(B,(mt,nt)=>{let[jt]=mt,[Mt]=nt;return jt-Mt}),pt=ye.find(mt=>{let[nt]=mt;return nt>D});if(pt){let mt=ye.indexOf(pt);if(mt>0){let nt=ye[mt-1],jt=(D-nt[0])/(pt[0]-nt[0]);k=nt[1]+jt*(pt[1]-nt[1])}else k=pt[1]}else k=ye[ye.length-1][1]}if(N.has(D))U=N.get(D);else{var J;let ye=lt(J=Array.from(N.entries())).call(J,(mt,nt)=>{let[jt]=mt,[Mt]=nt;return jt-Mt}),pt=ye.find(mt=>{let[nt]=mt;return nt>D});if(pt){let mt=ye.indexOf(pt);if(mt>0){let nt=ye[mt-1],jt=(D-nt[0])/(pt[0]-nt[0]);U=nt[1]+jt*(pt[1]-nt[1])}else U=pt[1]}else U=ye[ye.length-1][1]}let K=j("VIDEO_NEW_BITRATE_RATIO");K&&K>0&&(k=K/100);let H=Math.floor(y*k),ee=Math.floor(65e4*Math.pow(f*E/230400,.5)*Math.pow(S/15,.69)),ue=H,me=j("VIDEO_STANDARD_BITRATE_VERSION");return me&&me>0&&(me===1?ue=y:me===2?ue=H:me===3&&(ue=ee)),[Math.floor(ue/1e3),U]})(t,i,n);this._encoderConfig.bitrateMax=d,this._encoderConfig.bitrateMin=l?Math.min(l,d):d,this._saveEncodeBitrateRatio=h,C.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(i,", fps: ").concat(n,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else C.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(i,", fps: ").concat(n,"] => [brMax: ").concat(c,", brMin: ").concat(l,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,i;let n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),r={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:n?.parentElement},{element:s,slot:c}=r;if(this.isPlaying&&s instanceof HTMLVideoElement&&c instanceof HTMLElement){let l=RL.checkOneElementVisible(s),d=Object.assign({},l);if(d.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=d.visible;let h=He.reportApiInvoke(null,{tag:_i.TRACER,name:Li.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});d.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(d.reason))}return d}return}catch(n){throw new de(M.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new de(M.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;let t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n=this._encoderConfig;t&&(n=ai(ai({},n),ws(t))),n=Oh(n);let r=ei(8,"track-video-cloned-"),s=new WV(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,n,Oh(this._scalabilityMode),this._optimizationMode,r,Oh(this._hints));return t&&n&&s.setEncoderConfiguration(n),C.debug("clone video track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(i)),s}async replaceTrack(t,i){if(!(t instanceof MediaStreamTrack))throw new de(M.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new de(M.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Vd(()=>{He.reportApiInvoke(null,{name:Li.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:_i.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!j("ENABLE_VIDEO_SEI")||!j("ENABLE_ENCODED_TRANSFORM"))return void C.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new de(M.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let i=this.getRTCRtpTransceiver();if(!i)return void C.warning("Video track is not published, SEI can not be send");let n=i.sender.getParameters();if(n.codecs.length===0)return;let r=n.codecs[0].mimeType.toLocaleLowerCase();r==="video/h264"||r==="video/h265"?this.safeEmit("sei-to-send",t):C.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(pr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await $t(this,je.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await $t(this,je.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(pr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Ra.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Ra.REQUEST_CONSTRAINTS)}},At(St.prototype,"play",[px,fx],Object.getOwnPropertyDescriptor(St.prototype,"play"),St.prototype),At(St.prototype,"stop",[mx],Object.getOwnPropertyDescriptor(St.prototype,"stop"),St.prototype),At(St.prototype,"setEnabled",[_x,Ex,gx],Object.getOwnPropertyDescriptor(St.prototype,"setEnabled"),St.prototype),At(St.prototype,"setMuted",[Sx,vx,Tx],Object.getOwnPropertyDescriptor(St.prototype,"setMuted"),St.prototype),At(St.prototype,"setSaveEncodeBitrateRatio",[yx,Rx],Object.getOwnPropertyDescriptor(St.prototype,"setSaveEncodeBitrateRatio"),St.prototype),At(St.prototype,"setEncoderConfiguration",[Cx,bx],Object.getOwnPropertyDescriptor(St.prototype,"setEncoderConfiguration"),St.prototype),At(St.prototype,"getStats",[Ax],Object.getOwnPropertyDescriptor(St.prototype,"getStats"),St.prototype),At(St.prototype,"setBeautyEffect",[wx,Ix],Object.getOwnPropertyDescriptor(St.prototype,"setBeautyEffect"),St.prototype),At(St.prototype,"getCurrentFrameData",[Ox],Object.getOwnPropertyDescriptor(St.prototype,"getCurrentFrameData"),St.prototype),At(St.prototype,"getCurrentFrameImage",[Nx],Object.getOwnPropertyDescriptor(St.prototype,"getCurrentFrameImage"),St.prototype),At(St.prototype,"findClosestProfile",[Dx,Lx],Object.getOwnPropertyDescriptor(St.prototype,"findClosestProfile"),St.prototype),At(St.prototype,"setBitrateLimit",[Px],Object.getOwnPropertyDescriptor(St.prototype,"setBitrateLimit"),St.prototype),At(St.prototype,"setOptimizationMode",[xx],Object.getOwnPropertyDescriptor(St.prototype,"setOptimizationMode"),St.prototype),At(St.prototype,"setScalabiltyMode",[kx],Object.getOwnPropertyDescriptor(St.prototype,"setScalabiltyMode"),St.prototype),At(St.prototype,"updateMediaStreamTrackResolution",[Mx],Object.getOwnPropertyDescriptor(St.prototype,"updateMediaStreamTrackResolution"),St.prototype),At(St.prototype,"pipe",[Ux],Object.getOwnPropertyDescriptor(St.prototype,"pipe"),St.prototype),At(St.prototype,"unpipe",[Vx],Object.getOwnPropertyDescriptor(St.prototype,"unpipe"),St.prototype),At(St.prototype,"close",[jx],Object.getOwnPropertyDescriptor(St.prototype,"close"),St.prototype),At(St.prototype,"replaceTrack",[Bx],Object.getOwnPropertyDescriptor(St.prototype,"replaceTrack"),St.prototype),St),by=(Fx=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),Gx=Ii(),Hx=cm("CameraVideoTrack","_enabledMutex"),Wx=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),zx=Ii(),Kx=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),Yx=Ii(),qx=Ze({argsMap:e=>[e.getTrackId()]}),Ia=class zV extends oi{get __className__(){return"CameraVideoTrack"}constructor(t,i,n,r,s,c){super(t,ws(i.encoderConfig),r,s,c),$(this,"_config",void 0),$(this,"_originalConstraints",void 0),$(this,"_constraints",void 0),$(this,"_enabled",!0),$(this,"_deviceName","default"),$(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(rm()||tw())&&!(function(){let l=wt();if(l.os!==on.IOS||!l.osVersion)return!1;let d=l.osVersion.split(".");return Number(d[0])===15&&Number(d[1])>=2})()&&SL()&&this._enabled&&!this._isClosed&&(C.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=n,this._constraints=n,this._deviceName=t.label,this._encoderConfig=ws(this._config.encoderConfig),Yt.on(Tn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Yt.on(Tn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(C.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{let i=await Aa.getDeviceById(t),n={};n.video=ai({},this._constraints),n.video.deviceId={exact:t},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await ba(n,this.getTrackId())}catch(s){throw C.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),r=await ba({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(i){throw C.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{let i=await Aa.getDeviceById(t);this._deviceName=i.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(i){throw C.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}C.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){C.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));let i={video:ai(ai({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let n=null;try{n=await ba(i,this.getTrackId())}catch(r){throw C.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),r.toString()),n=await ba({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=ai({},i.video),C.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,i){if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(C.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let n=await ba({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1)}await $t(this,je.NEED_ENABLE_TRACK,this)}catch(n){throw C.error("[".concat(this.getTrackId(),"] setEnabled true error"),n.toString()),n}this.updateMediaStreamTrackResolution(),C.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await $t(this,je.NEED_DISABLE_TRACK,this)}catch(n){throw C.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}C.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,i){if(!this._enabled)throw new de(M.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=ws(t),j("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);let n=Ei(this._config);n.encoderConfig=t;let r=Cy(n);(wn()||Jn()||Cs())&&(r.deviceId=void 0),C.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(s){let c=new de(M.UNEXPECTED_ERROR,s.toString());throw C.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}this._config=n,this._constraints=r,this._originalConstraints=r,this._encoderConfig=t,this._hints.indexOf(Zt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await $t(this,je.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(C)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Jn()||Cs())&&this._enabled&&!this._isClosed&&Yt.duringInterruption){let t=async()=>{Yt.off(Tn.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(C.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Yt.on(Tn.IOS_INTERRUPTION_END,t)}else C.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(fm.TRACK_ENDED)}async renewMediaStreamTrack(t){let i=t||this._constraints,n=Aa.searchDeviceIdByName(this._deviceName);if(n&&!i.deviceId&&(i.deviceId={exact:n}),this._enabled){let r=await ba({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Yt.off(Tn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Yt.off(Tn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n=this._encoderConfig;t&&(n=ai(ai({},n),ws(t))),n=Oh(n);let r=ei(8,"track-cam-cloned-"),s=new zV(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,Oh(ai(ai({},this._config),{},{encoderConfig:n})),Oh(this._constraints),Oh(this._scalabilityMode),this._optimizationMode,r);return t&&n&&s.setEncoderConfiguration(n),C.debug("clone track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(i)),s}bindProcessorContextEvents(){this.processorContext.on(Ra.REQUEST_UPDATE_CONSTRAINTS,async(t,i,n)=>{try{let r=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(r),i()}catch(r){n(r)}}),this.processorContext.on(Ra.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},At(Ia.prototype,"setDevice",[Fx,Gx],Object.getOwnPropertyDescriptor(Ia.prototype,"setDevice"),Ia.prototype),At(Ia.prototype,"setEnabled",[Hx,Wx,zx],Object.getOwnPropertyDescriptor(Ia.prototype,"setEnabled"),Ia.prototype),At(Ia.prototype,"setEncoderConfiguration",[Kx,Yx],Object.getOwnPropertyDescriptor(Ia.prototype,"setEncoderConfiguration"),Ia.prototype),At(Ia.prototype,"close",[qx],Object.getOwnPropertyDescriptor(Ia.prototype,"close"),Ia.prototype),Ia);function Vw(e,t,i,n){i.optimizationMode&&(n&&n.width&&n.height?(i.encoderConfig=ai(ai({},n),{},{bitrateMin:n.bitrateMin,bitrateMax:n.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(t.contentHint=i.optimizationMode,t.contentHint===i.optimizationMode?C.debug("[".concat(e,"] set content hint to"),i.optimizationMode):C.debug("[".concat(e,"] set content hint failed")))):C.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var Xx,Jx,Zx,Qx,Ja,$x,ek,tk,ik,nk,rk,ar;class ak extends oP{getUserId(){return this._userId}constructor(t,i,n,r){super(t,"track-".concat(t.kind,"-").concat(i,"-").concat(r.clientId,"_").concat(ei(5,""))),$(this,"_userId",void 0),$(this,"_uintId",void 0),$(this,"_isDestroyed",!1),$(this,"store",void 0),$(this,"processor",void 0),$(this,"processorContext",void 0),this._userId=i,this._uintId=n,this.store=r}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,C.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Sm=(Xx=Ze({argsMap:(e,t,i)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),Jx=Ze({argsMap:e=>[e.getTrackId()]}),Zx=Ze({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Qx=Ze({argsMap:e=>[e.getTrackId()]}),At((Ja=class extends ak{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==jn.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,i,n,r){super(e,t,i,n),$(this,"_videoVisibleTimer",null),$(this,"_previousVideoVisibleStatus",void 0),$(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),$(this,"trackMediaType",mm.VIDEO),$(this,"_videoWidth",void 0),$(this,"_videoHeight",void 0),$(this,"_player",void 0),$(this,"_prePlayer",void 0),$(this,"processorDestination",void 0),$(this,"processorContext",void 0),this._prePlayer=r,this.updateMediaStreamTrackResolution(),this.processorContext=new SP(this.getTrackId(),"remote"),this.processorDestination=new gP(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Vd(()=>{C.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),va(this,je.GET_STATS)||ai({},aP)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Xa.PLAY_START),typeof e=="string"){let n=document.getElementById(e);n?e=n:(C.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}C.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let i=ai(ai({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(i);else{let n=!1,r=!1;e instanceof HTMLVideoElement?(this._player=new Mw(i),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,r=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,n=this._player.videoState>0,this._player.updateConfig(i)):this._player=new Uw(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Xa.FIRST_FRAME_DECODED),r&&this.safeEmit(Xa.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=s=>{this.safeEmit(Xa.VIDEO_STATE_CHANGED,s)},n&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let n=this.getVideoElementVisibleStatus();this.safeEmit(Xa.VIDEO_ELEMENT_VISIBLE_STATUS,n)}catch{}},j("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Xa.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,C.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){yP(this._originMediaStreamTrack).then(e=>{let[t,i]=e;this._videoHeight=i,this._videoWidth=t}).catch(py)}_updatePlayerSource(){C.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;let i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),n={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:i?.parentElement},{element:r,slot:s}=n;if(this.isPlaying&&r instanceof HTMLVideoElement&&s instanceof HTMLElement){let c=RL.checkOneElementVisible(r),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;let d=He.reportApiInvoke(null,{tag:_i.TRACER,name:Li.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?d.onSuccess("Video is visible"):d.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(i){throw new de(M.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new de(M.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(pr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(pr.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Ph.SEI_RECEIVED,e)}}).prototype,"play",[Xx],Object.getOwnPropertyDescriptor(Ja.prototype,"play"),Ja.prototype),At(Ja.prototype,"stop",[Jx],Object.getOwnPropertyDescriptor(Ja.prototype,"stop"),Ja.prototype),At(Ja.prototype,"pipe",[Zx],Object.getOwnPropertyDescriptor(Ja.prototype,"pipe"),Ja.prototype),At(Ja.prototype,"unpipe",[Qx],Object.getOwnPropertyDescriptor(Ja.prototype,"unpipe"),Ja.prototype),Ja),vm=($x=Ze({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),ek=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),tk=Ze({argsMap:e=>[e.getTrackId()]}),ik=Ze({argsMap:e=>[e.getTrackId()]}),nk=Ze({argsMap:(e,t)=>[e.getTrackId(),t.name]}),rk=Ze({argsMap:e=>[e.getTrackId()]}),At((ar=class extends ak{get isPlaying(){return this._useAudioElement?Ar.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,i,n){super(e,t,i,n),$(this,"trackMediaType",mm.AUDIO),$(this,"_source",void 0),$(this,"_useAudioElement",!0),$(this,"_volume",100),$(this,"processorContext",void 0),$(this,"processorDestination",void 0),$(this,"_played",!1),$(this,"_bypassWebAudio",!1),j("DISABLE_WEBAUDIO")?(this._source=new xw,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new uP(e,!0),j("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ya.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Xa.FIRST_FRAME_DECODED)}),this.processorContext=new TP(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new vP(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ya.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ya.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ya.ON_AUDIO_BUFFER),this._source.on(ya.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?Ar.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!tP())throw new de(M.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ar.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Vd(()=>{C.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),va(this,je.GET_STATS)||ai({},rP)}play(){C.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(C.debug("[".concat(this.getTrackId(),"] use audio element to play")),Ar.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){C.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Ar.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];C.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ar.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new de(M.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new de(M.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new de(M.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(pr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(pr.ON_NODE,e=>{this._source.processedNode=e;let t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(pr.ON_TRACK),this.processorDestination.removeAllListeners(pr.ON_NODE)}}).prototype,"setVolume",[$x],Object.getOwnPropertyDescriptor(ar.prototype,"setVolume"),ar.prototype),At(ar.prototype,"setPlaybackDevice",[ek],Object.getOwnPropertyDescriptor(ar.prototype,"setPlaybackDevice"),ar.prototype),At(ar.prototype,"play",[tk],Object.getOwnPropertyDescriptor(ar.prototype,"play"),ar.prototype),At(ar.prototype,"stop",[ik],Object.getOwnPropertyDescriptor(ar.prototype,"stop"),ar.prototype),At(ar.prototype,"pipe",[nk],Object.getOwnPropertyDescriptor(ar.prototype,"pipe"),ar.prototype),At(ar.prototype,"unpipe",[rk],Object.getOwnPropertyDescriptor(ar.prototype,"unpipe"),ar.prototype),ar),uc=new class extends vi{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),$(this,"_lastHiddenTime",0),$(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),C.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class sk extends vi{constructor(t,i){super(),$(this,"trackMediaType",mm.DATA),$(this,"_version",1),$(this,"_type",3),$(this,"_config",void 0),$(this,"_originDataChannel",void 0),$(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),$(this,"_dataStreamPacketHandler",{serialize:n=>n,deserialize:n=>n}),$(this,"_datachannelEventMap",new Map),this._config=t,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return j("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,i;return(t=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,i;return(t=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Ie((t,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();let n=setTimeout(()=>{var r;i(new de(M.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((r=this._originDataChannel)===null||r===void 0?void 0:r.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(n),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(n),new de(M.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new de(M.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){let t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[yy.OPEN,yy.CLOSE,yy.ERROR].forEach(i=>{let n=()=>{this.emit(i)};this._datachannelEventMap.set(i,n),t.addEventListener(i,n)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[n,r]=i;t.removeEventListener(n,r)}),this._datachannelEventMap.clear()}}class EF extends sk{constructor(t){super(t),$(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let n=i.data.slice(0,this._dataStreamPacketHeader.byteLength),r=new DataView(n).getUint8(3);if(r!==this.id)return void(j("SHOW_DATASTREAM2_LOG")&&C.debug("invalid datachannel id: ".concat(r," !== ").concat(this.id)));let s=i.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(yy.MESSAGE,s)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class gF extends sk{send(t){if(this._originDataChannel){let i=t;i=this._dataStreamPacketHandler.serialize(t);let n=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);n.set(new Uint8Array(this._dataStreamPacketHeader),0),n.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(n.buffer)}}}function Ay(){let e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>bT.revokeObjectURL(e),0),new Worker(bT.createObjectURL(e))}let ok=71,jw=1,Bw=2,Fw=1,ck=2;var Fd=(function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e})(Fd||{});function Gw(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=e.getUint8(0);if(i!==ok)return;let n=e.getUint16(1),r=jw+Bw+n,s=new Uint8Array(e.byteLength-r);s.set(new Uint8Array(e.buffer,r,e.byteLength-r));let c={m:i,tlvLen:n,tlv:[],frame:s},l=jw+Bw;for(;l<r;){let d=e.getUint8(l),h=e.getUint16(l+Fw),f=Fw+ck;if(d===Fd.AUDIO_LEVEL){let E=e.getUint8(l+f);for(let S=1;S<h;S++)E=E<<8|e.getUint8(l+f+S);c.tlv.push({tag:d,length:h,value:t?127^E>>1:127&E})}else if(d===Fd.METADATA||d===Fd.AUDIO_64_BIT_PTS){let E=new Uint8Array(h);for(let S=0;S<h;S++)E[S]=e.getUint8(l+f+S);c.tlv.push({tag:d,length:h,value:E})}l+=f+h}return c}let wy=new Map,Iy=127,Mh=1e-10,Hw=139/13,Oy=new Map;function Ww(e,t,i){let n="".concat(e,"-").concat(t,"-").concat(i),r=0;return Oy.has(n)?r=Oy.get(n):(r=Math.log((function(s,c){let l=s-c;c<l&&(c=l);let d=1;for(let h=s,f=1;h>c;h--,f++)d=d*h/f;return d})(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(i)+i*e,Oy.set(n,r)),r<Mh&&(r=Mh),r}function lk(e,t,i){let n=t.length,r=e.length/n,s=!1;for(let c=0,l=0;c<n;c++){let d=0;for(let h=l+r;l<h;l++)e[l]>i&&d++;t[c]!==d&&(t[c]=d,s=!0)}return s}window.cache=Oy;let SF=0;class dk{constructor(t){$(this,"id",void 0),$(this,"immediates",[]),$(this,"lastNonSilence",-1),$(this,"immediateSpeechActivityScore",Mh),$(this,"lastLevelChangedTime",Date.now()),$(this,"levels",[]),$(this,"longs",[]),$(this,"longSpeechActivityScore",Mh),$(this,"mediums",[]),$(this,"mediumSpeechActivityScore",Mh),$(this,"minLevel",0),$(this,"nextMinLevel",0),$(this,"nextMinLevelWindowLength",0),$(this,"energyScore",0),this.id=t||"".concat(SF++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){let t=this.immediates,i=this.levels,n=this.minLevel+Hw,r=!1;for(let s=0;s<t.length;++s){let c=i[s];c<n&&(c=0);let l=Math.floor(c/Hw);t[s]!==l&&(t[s]=l,r=!0)}return r}computeLongs(){return lk(this.mediums,this.longs,4)}computeMediums(){return lk(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=Ww(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=Ww(this.longs[0],10,47),this.longSpeechActivityScore>Mh&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=Ww(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(Lp(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,i){if(this.lastLevelChangedTime<=i){this.lastLevelChangedTime=i;let n=t;return t<0&&(n=0),t>Iy&&(n=Iy),this.levels.unshift(n),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(n),n>=this.minLevel+Hw?n:n/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let i=Math.sqrt(this.minLevel*this.nextMinLevel);i<0?i=0:i>Iy&&(i=Iy),this.minLevel=i,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class vF{constructor(t){$(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{let i=this.algorithm.runInDecisionMaker(this);i<=0?t=!0:setTimeout(this.execute.bind(this),i)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class zw{constructor(t,i,n){$(this,"isDominant",void 0),$(this,"energyRanking",void 0),$(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=i,this.energyScore=n}}class TF extends vi{constructor(t){super(),$(this,"dominantId",null),$(this,"lastDecisionTime",0),$(this,"lastLevelChangedTime",0),$(this,"lastLevelIdleTime",0),$(this,"relativeSpeechActivities",[]),$(this,"speakers",new Map),$(this,"enableSilence",!1),$(this,"timeoutToSilenceInterval",0),$(this,"decisionMaker",null),$(this,"loudest",[]),$(this,"numLoudestToTrack",3),$(this,"energyExpireTimeMs",250),$(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,i=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,i!=null&&(this.energyExpireTimeMs=i),n!=null&&(this.energyAlphaPct=n),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(i=>i.id===t)}levelChanged(t,i){let n=Date.now(),r=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<n&&(this.lastLevelChangedTime=n,this.maybeStartDecisionMaker());let s=r.levelChanged(i,n);return this.updateLoudestList(r,s,n)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(i=>{this.speakers.has(i.id)||this.speakers.set(i.id,i)})}removeSpeakers(t){t.forEach(i=>{this.speakers.delete(i.id)})}getOrCreateSpeaker(t){let i=this.speakers.get(t);return i||(i=new dk(t),this.speakers.set(t,i),this.maybeStartDecisionMaker()),i}updateLoudestList(t,i,n){let r=t.id===this.dominantId;if(i<0){let d=0;for(;d<this.loudest.length&&this.loudest[d]!==t;)++d;return new zw(r,d,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*i+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new zw(r,0,t.energyScore);let s=n-this.energyExpireTimeMs,c=0;for(;c<this.loudest.length;){let d=this.loudest[c];if(d.getLastLevelChangedTime()<s&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(c,1);else if(d.id!==t.id)++c;else if(this.loudest.splice(c,1),this.loudest.length<this.numLoudestToTrack)break}let l=0;for(;l<this.loudest.length&&!(this.loudest[l].energyScore<t.energyScore);)++l;return l<this.numLoudestToTrack&&(this.loudest.splice(l,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new zw(r,l,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new vF(this),this.decisionMaker.execute())}makeDecision(t){let i=null,n=null,r=this.speakers.size,s=null;if(r===0)s=null;else if(r===1){var c;let l=Cr(c=this.speakers).call(c).next().value;this.enableSilence&&l&&(s=l.id,l.evaluateSpeechActivityScores(t),t-l.lastNonSilence>this.timeoutToSilenceInterval&&(s=null))}else{let l=this.dominantId==null?null:this.speakers.get(this.dominantId);if(l==null){let f=this.speakers.entries().next();f.value&&(s=f.value[0],l=f.value[1])}else s=l.id;l?.evaluateSpeechActivityScores(t);let d=this.relativeSpeechActivities,h=2;for(let f of this.speakers.entries()){let[E,S]=f;if(S===l)continue;S.evaluateSpeechActivityScores(t);for(let N=0;N<d.length;++N){let k=l==null?Mh:l.getSpeechActivityScore(N);d[N]=Math.log(S.getSpeechActivityScore(N)/k)}let y=d[0],D=d[1],O=d[2];y>3&&D>2&&O>0&&D>h&&(h=D,s=E)}this.enableSilence&&l!=null&&s===l.id&&t-l.lastNonSilence>this.timeoutToSilenceInterval&&(s=null)}s==null&&!this.enableSilence||s===this.dominantId||(i=this.dominantId,this.dominantId=s,n=this.dominantId),n==null&&!this.enableSilence||n===i||this.emit("ActiveSpeakerChanged",n)}_runInDecisionMaker(){let t=Date.now(),i=300-(t-this.lastLevelIdleTime),n=0;i<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):n=i;let r=300-(t-this.lastDecisionTime);return r<=0&&(this.lastDecisionTime=t,this.makeDecision(t),r=300-(Date.now()-t)),r>0&&n>r&&(n=r),n}timeoutIdleLevels(t){let i=[];for(let r of Cr(n=this.speakers).call(n)){var n;let s=t-r.getLastLevelChangedTime();36e5<s&&(this.dominantId==null||r.id!==this.dominantId)?i.push(r.id):300<s&&r.levelTimedOut()}i.forEach(r=>this.speakers.delete(r))}}let Tm=new Map,ho=null,Ny=null,uk=3,Uh=[],po=new Map,Dy=new Map;class yF{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,i){$(this,"id",void 0),$(this,"track",void 0),$(this,"score",0),$(this,"active",!0),$(this,"muted",!1),$(this,"timer",0),$(this,"actives",0),$(this,"inactives",0),this.id=t,this.track=i,this.setActive(po.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){let t=this.active;this.active=this.activeRate>=.8;let{actives:i,inactives:n}=(function(){let r=[],s=[];return Array.from(Cr(po).call(po)).forEach(c=>{c.active?r.push(c):s.push(c)}),{actives:r,inactives:s}})();if(i.length>3){let r;i.forEach(s=>{(!r||r.score>s.score)&&(r=s)}),r&&r.setActive(!1)}if(i.length<3&&n.length>0){let r;n.forEach(s=>{(!r||r.score<s.score)&&s.id!==this.id&&(r=s)}),r&&t&&!this.active&&(r.samples>40&&r.activeRate-this.activeRate>.4?r.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){let t=(function(i){let n;return Array.from(Cr(po).call(po)).forEach(r=>{!r.active||r.id===i||r.samples<40||(!n||r.score<n.score)&&(n=r)}),n})(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){let t=(function(i){let n;return Array.from(Cr(po).call(po)).forEach(r=>{r.active||r.id===i||r.samples<40||(!n||r.score>n.score)&&(n=r)}),n})(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Ly;function hk(e){let t=po.get(e);t&&(po.delete(e),t.clearTimer())}let Py=new Map,RF=new Map,Kw="video/h264",Yw="video/h265";function pk(e,t,i){let n=new Uint8Array(e,t,i),r=[],s=0;for(;r.length<i;)s+3<i&&n[s]===0&&n[s+1]===0&&n[s+2]===3&&(n[s+3]===0||n[s+3]===1||n[s+3]===2||n[s+3]===3)?(r.push(n[s],n[s+1],n[s+3]),s+=4):(r.push(n[s]),s++);return new Uint8Array(r)}function fk(e){let t=e.length,i=[],n=0;for(;n<t;)n+2<t&&e[n]===0&&e[n+1]===0&&(e[n+2]===0||e[n+2]===1||e[n+2]===2||e[n+2]===3)?(i.push(e[n],e[n+1],3,e[n+2]),n+=3):(i.push(e[n]),n++);return new Uint8Array(i)}function mk(e){if(e.length<5)return"";let t=-1;for(let r=0;r<e.length-3;r++){if(e[r]===0&&e[r+1]===0&&e[r+2]===1){t=r;break}if(r<e.length-4&&e[r]===0&&e[r+1]===0&&e[r+2]===0&&e[r+3]===1){t=r;break}}if(t===-1)return"";let i=t+(e[t+2]===0?4:3);if(i>=e.length)return"";let n=e[i];return 128&n?"":(n>>1&63)>=32||i+1<e.length&&!(248&e[i+1])?Yw:(31&n)<=31?Kw:""}let xy=new Map,Hg=new Map;(function(){let e=wt();vn.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),vn.getStreamFromExtension=e.name===kt.CHROME&&Number(e.version)>34,vn.supportUnifiedPlan=(function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t=new RTCPeerConnection,i=!1;try{t.addTransceiver("audio"),i=!0}catch{}return t.close(),i})(),vn.supportMinBitrate=e.name===kt.CHROME||e.name===kt.EDGE,vn.supportSetRtpSenderParameters=(function(){let t=wt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!fl()||!(!wn()&&!ly())||t.name===kt.FIREFOX&&Number(t.version)>=64)})(),e.name===kt.SAFARI&&(Number(e.version)>=14?vn.supportDualStream=!0:vn.supportDualStream=!1),vn.webAudioMediaStreamDest=(function(){let t=wt();return!(t.name===kt.SAFARI&&Number(t.version)<12)})(),vn.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",vn.supportWebGL=typeof WebGLRenderingContext<"u",vn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,fl()||(vn.webAudioWithAEC=!0),vn.supportShareAudio=(function(){let t=wt();return(t.os===on.WIN_10||t.os===on.WIN_81||t.os===on.WIN_7||t.os===on.LINUX||t.os===on.MAC_OS||t.os===on.CHROMIUM_OS)&&t.name===kt.CHROME&&Number(t.version)>=74})(),vn.supportDataChannel=!!(nm(76)||QA(68)||fL(14)),vn.supportPCSetConfiguration=(function(){let t=window.RTCPeerConnection;return!bi()&&!!t&&t.prototype.setConfiguration instanceof Function})(),vn.supportWebRTCEncodedTransform=nm(87)||uL()||QA(117),vn.supportWebRTCInsertableStream=(function(){let t=wt();return(t.name===kt.CHROME||t.name===kt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window})(),vn.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,vn.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,hy(()=>{vn.supportDualStreamEncoding=(function(){let t=wt();return!!j("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&j("CHROME_DUAL_STREAM_USE_ENCODING"))})(),C.debug("browser ua: ",navigator.userAgent),C.info("browser info: ",e),C.info("browser compatibility: ",vn)})})();let CF=["CHINA","GLOBAL"],_k=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Vh=[],ym=[];function jh(e,t){return!!t&&Vh.some(i=>i.uid===e&&i.channelName===t)}function qw(){return ym.length>0}var bF=NN.forEach,Ek=kc("forEach")?[].forEach:function(e){return bF(this,e,arguments.length>1?arguments[1]:void 0)};Ft({target:"Array",proto:!0,forced:[].forEach!==Ek},{forEach:Ek});var AF=Xr("Array","forEach"),wF=Hs,IF=an,OF=ce,NF=AF,Xw=Array.prototype,DF={DOMTokenList:!0,NodeList:!0},LF=function(e){var t=e.forEach;return e===Xw||OF(Xw,e)&&t===Xw.forEach||IF(DF,wF(e))?NF:t},PF=R(LF),xF=Pa,gk=ed;Ft({target:"Object",stat:!0,forced:w(function(){gk(1)})},{keys:function(e){return gk(xF(e))}});var kF=R(Dr.Object.keys),MF=R(ko),UF=R(P_),VF=Ft,Sk=os,jF=Ju,BF=$n,vk=bp,FF=No,GF=bo,HF=Pb,WF=xi,zF=yr,KF=TN("slice"),YF=WF("species"),Jw=Array,qF=Math.max;VF({target:"Array",proto:!0,forced:!KF},{slice:function(e,t){var i,n,r,s=GF(this),c=FF(s),l=vk(e,c),d=vk(t===void 0?c:t,c);if(Sk(s)&&(i=s.constructor,(jF(i)&&(i===Jw||Sk(i.prototype))||BF(i)&&(i=i[YF])===null)&&(i=void 0),i===Jw||i===void 0))return zF(s,l,d);for(n=new(i===void 0?Jw:i)(qF(d-l,0)),r=0;l<d;l++,r++)l in s&&HF(n,r,s[l]);return n.length=r,n}});var XF=Xr("Array","slice"),JF=ce,ZF=XF,Zw=Array.prototype,QF=function(e){var t=e.slice;return e===Zw||JF(Zw,e)&&t===Zw.slice?ZF:t},$F=R(QF);function Fe(e,t,i,n,r){var s,c,l,d={};return PF(s=kF(n)).call(s,function(h){d[h]=n[h]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=MF(c=UF(l=$F(i).call(i)).call(l)).call(c,function(h,f){return f(e,t,h)||h},d),r&&d.initializer!==void 0&&(d.value=d.initializer?d.initializer.call(r):void 0,d.initializer=void 0),d.initializer===void 0?(EN(e,t,d),null):d}let ky=(function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e})({}),Qw=(function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e})({}),Is=(function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e})({}),fr=(function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e})({}),Xe=(function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e})({}),si=(function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e})({}),at=(function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e})({}),et=(function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e})({}),Wg=(function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e})({}),Rt=(function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e})({}),mr=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({}),ut=(function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e})({});function My(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw C.error("Invalid Channel Name ".concat(e)),new te(M.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Uy(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||yL(e,1,255)))throw new te(M.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&C.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let _l=(function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e})({}),e7={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},$w={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function eI(e,t){gn(e.url,"".concat(t,".url"),1,1e3,!1),Ai(e.x)||Jt(e.x,"".concat(t,".x"),0,1e4),Ai(e.y)||Jt(e.y,"".concat(t,".y"),0,1e4),Ai(e.width)||Jt(e.width,"".concat(t,".width"),0,1e4),Ai(e.height)||Jt(e.height,"".concat(t,".height"),0,1e4),Ai(e.zOrder)||Jt(e.zOrder,"".concat(t,".zOrder"),0,255),Ai(e.alpha)||Jt(e.alpha,"".concat(t,".alpha"),0,1,!1)}let t7={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},Gd=(function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e})({}),tI=(function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e})({}),Zi=(function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e})({});function Tk(e){if(!e.channelName)throw new te(M.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new te(M.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&gn(e.token,"info.token",1,2047),Uy(e.uid),My(e.channelName),!0}let _r=(function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e})({}),El=(function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e})({}),Gr=(function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e})({}),Rm=(function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e})({}),Wt=(function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e})({}),hn=(function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e})({}),Vy=(function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e})({}),cn=(function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e})({}),Ut=(function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e})({}),yk=[Ut.AFRICA,Ut.ASIA,Ut.CHINA,Ut.EUROPE,Ut.GLOBAL,Ut.INDIA,Ut.JAPAN,Ut.NORTH_AMERICA,Ut.OCEANIA,Ut.OVERSEA,Ut.SOUTH_AMERICA],Bn=(function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e})({}),jy={CHINA:{},ASIA:{CODE:Bn.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Bn.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Bn.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Bn.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Bn.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Bn.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Bn.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Bn.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Bn.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Bn.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Bn.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Bn.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Bn.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};gw&&(jy.CHINA={CODE:Bn.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let zg=(function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e})({});function Rk(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class Ck extends vi{constructor(t,i){super(),L(this,"onICEConnectionStateChange",void 0),L(this,"onConnectionStateChange",void 0),L(this,"onDTLSTransportStateChange",void 0),L(this,"onDTLSTransportError",void 0),L(this,"onICETransportStateChange",void 0),L(this,"onFirstAudioReceived",void 0),L(this,"onFirstVideoReceived",void 0),L(this,"onFirstAudioDecoded",void 0),L(this,"onFirstVideoDecoded",void 0),L(this,"onFirstVideoRender",void 0),L(this,"onFirstVideoDecodedTimeout",void 0),L(this,"onSelectedLocalCandidateChanged",void 0),L(this,"onSelectedRemoteCandidateChanged",void 0),L(this,"onICECandidateError",void 0),L(this,"getLocalVideoStats",void 0)}}class bk extends Ck{constructor(t,i){super(t,i),L(this,"establishPromise",void 0)}}let ke=(function(e){return e.VIDEO="video",e.AUDIO="audio",e})({}),Fn=(function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e})({}),gl=(function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e})({}),Ak=["disconnected","failed"],ge=(function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e})({}),Ht=(function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e})({}),Ke=(function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e})({}),Os=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),Ns=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),pn=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),wk=(function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e})({}),hc=(function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e})({}),Za=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),fo=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),Cm=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),Ui=(function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e})({}),bm=(function(e){return e.ABORT="abort",e})({}),Hd=(function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e})({}),i7=(function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e})({}),n7={[ky.ACCESS_POINT]:{[fr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[fr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[fr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[fr.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[fr.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[fr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[fr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[ky.UNILBS]:{[Is.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Is.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Is.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Is.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Is.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Is.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Is.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Is.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Is.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Is.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Is.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Is.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[ky.STRING_UID_ALLOCATOR]:{[Qw.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Qw.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Qw.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Am(e){let t=n7[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};let i=t[e%1e4];if(!i){if(Math.floor(e/1e4)===ky.ACCESS_POINT){let n=e%1e4;if(n.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(n.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}let r7={[Xe.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Xe.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Xe.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Xe.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Xe.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Xe.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Xe.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Xe.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Xe.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Xe.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Xe.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Xe.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Xe.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Xe.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Xe.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Xe.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Xe.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Xe.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Xe.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Xe.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Xe.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Xe.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Xe.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Xe.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Xe.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Xe.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Xe.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Xe.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Xe.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Xe.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Xe.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Xe.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Xe.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Xe.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Xe.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Xe.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Xe.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Xe.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Xe.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Xe.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Xe.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Xe.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Xe.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Xe.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Xe.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Xe.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Xe.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Xe.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Xe.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Xe.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Xe.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Xe.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Xe.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Xe.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Xe.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Xe.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Xe.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Xe.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Xe.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Xe.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Xe.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Xe.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Xe.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Xe.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Kg(e){return r7[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function Ik(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function iI(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Ik(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ik(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}function nI(e,t){if(typeof e=="string")return e;let{proxy:i,host:n,port:r}=e;if(t){let s=j("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(n,"/ws/?p=").concat(Number(r)+150):"wss://".concat(n,":").concat(s,"/ws/?p=").concat(Number(r)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(n,"&p=").concat(r):"wss://".concat(n,":").concat(r)}let a7=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,s7=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,o7=/wss:\/\/(.+):([0-9]+)\/?/,c7=/wss:\/\/(.[^\/]+)\/?/,l7=0;class d7{constructor(t,i){L(this,"id",0),L(this,"store",void 0),L(this,"recordIndex",void 0),L(this,"websockets",[]),L(this,"try443PortDuration",2e3),L(this,"forceCloseWSDuration",5e3),L(this,"try443PortTimeout",null),L(this,"forceCloseTimeout",null),L(this,"isTry443PortFailed",!1),L(this,"isNormalPortFailed",!1),L(this,"useDoubleDomain",!1),L(this,"useProxy",!1),L(this,"startTime",Date.now()),this.id=++l7,this.try443PortDuration=j("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;let i=Date.now()-this.startTime;for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];C.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...r)}createWebSocket(t,i,n){this.logger("createWebSocket:",t,{isTry443Port:i,hasTimeoutDetection:n});let r=j("GATEWAY_DOMAINS"),s=Date.now(),c=[],l=r.find(S=>{var y;return Ce(y=t.host).call(y,S)});l||(this.useDoubleDomain=!1);let d=[];if(this.useDoubleDomain)r.forEach(S=>{d.push(nI(iI(iI({},t),{},{host:t.host.replace(l,S)}),i))});else{let S=iI({},t);if(i&&l){let y=r.find(D=>D!==l);y&&(S.host=S.host.replace(l,y))}d.push(nI(S,i))}try{d.forEach(S=>{let y=new WebSocket(S);y.binaryType="arraybuffer",c.push(y),this.logger("ws is connecting:",y.url)})}catch(S){if(this.logger("ws create failed"),c.forEach(y=>y.close()),c.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,i,n);if(!i&&Number(t.port)!==443)return this.createWebSocket(t,!0,n);throw new te(M.WS_ERR,"init websocket failed! Error: ".concat(S.toString()))}let h=Ng();this.store&&this.store.recordJoinChannelService({urls:c.map(S=>S.url),service:"gateway"},this.recordIndex),c.forEach(S=>{S.onopen=()=>{this.logger("onopen: ws ".concat(S.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach(y=>{y!==S&&(y.onopen=null,y.onclose=null,y.onmessage=null,y.close(),this.logger("close backup websocket: ".concat(y.url)))}),this.websockets.length=0,h.resolve(S)},S.onclose=y=>{this.logger("onclose: ws ".concat(S.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(S.readyState));let D=c.every(O=>O.readyState===WebSocket.CLOSED||O.readyState===WebSocket.CLOSING);this.logger("".concat(i?"443":"47xx"," websocket closed, all failed: ").concat(D)),D&&(i||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(y.reason)),h.reject({code:y.code,reason:Vy.A_ROUND_WS_FAILED})):!i&&D&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),E()),i?this.isTry443PortFailed=D:this.isNormalPortFailed=D},S.onmessage=y=>this.logger("".concat(S.url," onmessage: ").concat(y.data))}),this.websockets.push(...c);let f=()=>{this.websockets.forEach(S=>S.readyState!==WebSocket.OPEN&&S.close())},E=()=>{if(h.isResolved)return f();wt().os===on.MAC_OS&&bi()&&f(),this.createWebSocket(t,!0,!0).then(S=>{h.resolve(S)}).catch(S=>{this.isNormalPortFailed&&h.reject(S),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",h.isResolved),this.forceCloseTimeout=null,f()},this.forceCloseWSDuration)};return n||(()=>{if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,f()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",h.isResolved),this.try443PortTimeout=null,E()},this.try443PortDuration)})(),h.promise}chooseBestWebsocket(t,i,n,r){return this.useDoubleDomain=!!i,typeof t=="string"&&(t=(function(s){let c,l,d;return[,c,l,d]=s.match(a7)||[],c||([,l,d]=s.match(s7)||[]),l&&d||([,l,d]=s.match(o7)||[]),l&&d||([,l]=s.match(c7)||[]),l||C.warning("un-destructible url: ",s),{proxy:c,host:l,port:d||"443"}})(t)),this.recordIndex=r,this.useProxy=!!t.proxy,n&&this.useProxy&&(C.warn("cannot use 443 only when use proxy"),n=!1),this.createWebSocket(t,!!n,!1).finally(()=>this.clearTimeout())}}function Ok(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}class Nk extends vi{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var i;Ce(i=["tryNext","recover"]).call(i,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(ut.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(ut.CONNECTED):this._state==="closed"?this.emit(ut.CLOSED):this._state==="failed"&&this.emit(ut.FAILED))}resetReconnectCount(t){C.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,i){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3&&arguments[3]!==void 0&&arguments[3],s=arguments.length>4&&arguments[4]!==void 0&&arguments[4],c=arguments.length>5?arguments[5]:void 0;super(),L(this,"_websocketUrl",null),L(this,"connectionID",0),L(this,"currentURLIndex",0),L(this,"urls",[]),L(this,"_reconnectMode","tryNext"),L(this,"reconnectReason",void 0),L(this,"_initMutex",void 0),L(this,"name",void 0),L(this,"_state","closed"),L(this,"reconnectInterrupter",void 0),L(this,"websocket",void 0),L(this,"retryConfig",void 0),L(this,"reconnectCount",0),L(this,"forceCloseTimeout",5e3),L(this,"onlineReconnectListener",void 0),L(this,"useCompress",void 0),L(this,"tryDoubleDomain",!1),L(this,"use443PortOnly",!1),L(this,"wsInflateLength",0),L(this,"wsDeflateLength",0),L(this,"closeEstablishingWs",()=>{}),L(this,"store",void 0),L(this,"joinGatewayRecordIndex",void 0),this.store=c,this.name=t,this.retryConfig=(function(E){for(var S=1;S<arguments.length;S++){var y=arguments[S]!=null?arguments[S]:{};S%2?Ok(Object(y),!0).forEach(function(D){L(E,D,y[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(y)):Ok(Object(y)).forEach(function(D){Object.defineProperty(E,D,Object.getOwnPropertyDescriptor(y,D))})}return E})({},i),this.useCompress=n,this.tryDoubleDomain=r,this.use443PortOnly=s,this._initMutex=new Vn("websocket",c?c.clientId:void 0);let{timeout:l,timeoutFactor:d}=i,h=Math.max(300,Math.floor(3*l/5)),f=Math.max(1.2,Math.floor(8*d)/10);aa.ONLINE&&(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=f),Bi.on(am.NETWORK_STATE_CHANGE,(E,S)=>{E!==S&&(this.resetReconnectCount("network state change: ".concat(S," -> ").concat(E)),E===aa.ONLINE?(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=f):(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=d))})}getConnection(){return this.websocket||void 0}async init(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,n=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=i,this.urls=t,this.state="connecting";try{var r;let s=Ng(),c=this.urls[this.currentURLIndex];(r=this.store)===null||r===void 0||r.beforeConnect(),(function(l){return!(Sy()||j("USE_NEW_TOKEN")||!j("ENABLE_PREALLOC_PC")&&(l==null||!l.autoSubscribe||j("FORCE_DISABLE_AUTO_SUB")))})(this.store)&&this.emit(wk.PRE_CONNECT_PC),this.createWebSocketConnection(c).then(s.resolve).catch(s.reject),this.once(ut.CLOSED,()=>{s.reject(new de(M.WS_DISCONNECT))}),this.once(ut.CONNECTED,s.resolve),await s.promise}catch{}finally{n()}}close(t,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let n=this.websocket;i?setTimeout(()=>n.close(),500):n.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,i){if(!this.websocket)return void C.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),C.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);let n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&n.bind(this.websocket)({code:9999,reason:i})}sendMessage(t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new de(M.WS_ABORT,"websocket is not ready");try{i||(t=JSON.stringify(t)),this.websocket.send(t)}catch(n){throw new de(M.WS_ERR,"send websocket message error"+n.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){let t=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var i;let n=Ng();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let r=f=>{var E;(E=this.store)===null||E===void 0||E.signalChannelOpen(),C.debug("[".concat(this.name,"] websocket opened:"),f),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n.resolve()},s=async f=>{var E;if(C.debug("[".concat(this.name,"] websocket close ").concat((E=this.websocket)===null||E===void 0?void 0:E.url,", code: ").concat(f.code,", reason: ").concat(f.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)n.reject(new de(M.WS_DISCONNECT,"websocket close: ".concat(f.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=f.reason,this.state="reconnecting");let S=va(this,ut.WILL_RECONNECT,this.reconnectMode,f.reason)||this.reconnectMode,y=await this.reconnectWithAction(S);if(this.state==="closed")return void C.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!y)return n.reject(new de(M.WS_DISCONNECT,"websocket reconnect failed: ".concat(f.code))),this.close(!0);n.resolve()}},c=f=>{this.emit(ut.ON_MESSAGE,f)},l=f=>{C.warn("[".concat(this.connectionID,"] ws open error ").concat(f))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),j("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=j("GATEWAY_WSS_ADDRESS")),C.debug("[".concat(this.name,"] start connect, url:"),t);let d=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var h;this._websocketUrl=nI(t);let f=await this.chooseBestWebsocketConnection(t);this.websocket=f,r&&r(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=c,this.websocket.onerror=l,(h=this.store)===null||h===void 0||h.recordJoinChannelService({endTs:Date.now(),status:"success"},d),this.joinGatewayRecordIndex=d}catch(f){let E=this.state==="closed",S=f instanceof de,y=S&&f.code===M.WS_ABORT,D=S&&f.code===M.WS_ERR,O=S?f.message:f&&(f.reason||f.toString());C.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(O)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:y?"aborted":"error",errors:[f]},d),E||D?(n.reject(E?new de(M.WS_DISCONNECT,"websocket is closed: ".concat(O)):new de(M.WS_ERR,"init websocket failed: ".concat(O))),D&&C.error("[".concat(this.name,"] init websocket failed: ").concat(O))):s&&s(f)}return n.promise}async reconnectWithAction(t){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;C.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Bi.isOnline||!Bi.onlineWaiter||(this.onlineReconnectListener=Bi.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let n=!0;if(this.reconnectInterrupter=()=>n=!1,i){let c=dw(this.reconnectCount,this.retryConfig);C.debug("[".concat(this.name,"] wait ").concat(c,"ms to reconnect websocket, mode: ").concat(t)),await Ie.race([Sn(c),this.onlineReconnectListener||new Ie(()=>{})])}if(this._state==="closed"||!n)return!1;this.reconnectCount+=1;let r=async(c,l)=>{this.emit(ut.RECONNECT_CREATE_CONNECTION,l),await this.createWebSocketConnection(c)};try{if(t==="retry")await r(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);C.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await r(this.urls[this.currentURLIndex],t)}else t==="recover"&&(C.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await On(this,ut.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],t))}catch(c){var s;C.error("[".concat(this.name,"] reconnect failed ").concat(c&&c.toString()));let l=c==null||(s=c.data)===null||s===void 0?void 0:s.desc;return Array.isArray(l)&&Ce(l).call(l,"dynamic key expired")?(this.emit(ut.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,i)}return!0}}class rI extends Nk{constructor(t,i){super(t,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,i){let n=Ng(),r=(function(c,l){return new d7(c,l)})(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{C.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),n.reject(new de(M.WS_ABORT,"choose best websocket aborted"))};let s=j("GATEWAY_DOMAINS");return C.debug("[choose-best-ws] currentDomain: ",t,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,i).then(n.resolve).catch(n.reject),n.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Yg extends Nk{constructor(t,i){super(t,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,i){return new Ie((n,r)=>{let s=!1,c=[];this.closeEstablishingWs=()=>{C.debug("[choose-best-ws] close establishing websockets"),c.forEach(D=>{D.onclose=null,D.onopen=null,D.onmessage=null,D.close()}),r(new de(M.WS_ABORT,"choose best websocket aborted"))};let l=j("GATEWAY_DOMAINS"),d,h=t.indexOf("?h="),f=l.find(D=>h!==-1?Ce(t).call(t,D,h):Ce(t).call(t,D));C.debug("[choose-best-ws] currentDomain: ",f,", domains: ",l);let E=!this.tryDoubleDomain||!f;if(!E&&f){var S;let D=Date.now();try{l.forEach(O=>{let N=h===-1?t.replace(f,O):t.substr(0,h)+t.substr(h).replace(f,O),k=new WebSocket(N);k.binaryType="arraybuffer",c.push(k),C.debug("[choose-best-ws] ws is connecting:",k.url)})}catch{for(C.debug("[choose-best-ws] ws create failed, fallback to single url"),c.forEach(O=>O.close());c.length;)c.pop();E=!0}(S=this.store)===null||S===void 0||S.recordJoinChannelService({urls:c.map(O=>O.url),service:"gateway"},i),c.forEach(O=>{O.onopen=()=>{if(s)return;let N=Date.now()-D;C.debug("[choose-best-ws] ws open cost ".concat(N,"ms")),c.filter(k=>k!==O).forEach(k=>{C.debug("[choose-best-ws]close backup websocket: ".concat(k.url)),k.close()}),s=!0,n(O)},O.onclose=N=>{d=N,!s&&(c.find(k=>!(k.readyState===WebSocket.CLOSED||k.readyState===WebSocket.CLOSING))||(C.debug("[choose-best-ws] all websocket is closed"),s=!0,r(d)))},O.onmessage=N=>{C.debug("[choose-best-ws]".concat(O.url," onmessage: ").concat(N.data))}}),Sn(this.forceCloseTimeout).then(()=>{c.forEach(O=>{O.readyState!==WebSocket.OPEN&&O.close()})})}if(E){var y;let D;C.debug("[choose-best-ws] use single url: ",t),(y=this.store)===null||y===void 0||y.recordJoinChannelService({urls:[t],service:"gateway"},i);try{D=new WebSocket(t),c.push(D),D.binaryType="arraybuffer"}catch(O){let N=new de(M.WS_ERR,"init websocket failed! Error: ".concat(O.toString()));return C.error("[".concat(this.name,"]").concat(N)),void r(N)}D.onopen=()=>{n(D)},D.onclose=O=>{r(O)},D.onmessage=O=>{C.debug("[choose-best-ws]".concat(D.url," onmessage: ").concat(O.data))},Sn(this.forceCloseTimeout).then(()=>{D&&D.readyState!==WebSocket.OPEN&&D.close()})}}).then(n=>(this.closeEstablishingWs=void 0,n)).catch(n=>{throw this.closeEstablishingWs=void 0,n})}}class u7 extends vi{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===si.CONNECTED?this.emit(at.WS_CONNECTED):t===si.RECONNECTING?this.emit(at.WS_RECONNECTING,this._websocketReconnectReason):t===si.CLOSED&&this.emit(at.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,i){super(),L(this,"_disconnectedReason",void 0),L(this,"_websocketReconnectReason",void 0),L(this,"_connectionState",si.CLOSED),L(this,"reconnectToken",void 0),L(this,"websocket",void 0),L(this,"openConnectionTime",void 0),L(this,"clientId",void 0),L(this,"lastMsgTime",Date.now()),L(this,"uploadCache",[]),L(this,"uploadCacheInterval",void 0),L(this,"rttRolling",new VL(5)),L(this,"pingpongTimer",void 0),L(this,"wsInflateDataTimer",void 0),L(this,"pingpongTimeoutCount",0),L(this,"ortc",void 0),L(this,"joinResponse",void 0),L(this,"multiIpOption",void 0),L(this,"initError",void 0),L(this,"spec",void 0),L(this,"store",void 0),L(this,"onWebsocketMessage",n=>{if(n.data instanceof ArrayBuffer)return void this.emit(at.ON_BINARY_DATA,n.data);let r=JSON.parse(n.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){let s="res-@".concat(r._id);this.emit(s,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){if(this.emit(r._type,r._message),r._type===Rt.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===Rt.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(Gt.UID_BANNED);break;case 15:this.close(Gt.IP_BANNED);break;case 16:this.close(Gt.CHANNEL_BANNED)}if(r._type===Rt.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case Xe.ERR_LICENSE_MISSING:this.close(Gt.LICENSE_MISSING);break;case Xe.ERR_LICENSE_EXPIRED:this.close(Gt.LICENSE_EXPIRED);break;case Xe.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Gt.LICENSE_MINUTES_EXCEEDED);break;case Xe.ERR_LICENSE_PERIOD_INVALID:this.close(Gt.LICENSE_PERIOD_INVALID);break;case Xe.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Gt.LICENSE_MULTIPLE_SDK_SERVICE);break;case Xe.ERR_LICENSE_ILLEGAL:this.close(Gt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=i,this.websocket=new rI("gateway-".concat(this.clientId),this.spec.retryConfig,!0,j("JOIN_GATEWAY_USE_DUAL_DOMAIN"),j("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===si.CONNECTED&&this.reconnect("retry",In.OFFLINE)})}async request(t,i,n,r){let s=ei(6,""),c={_id:s,_type:t,_message:i},l=this.websocket.connectionID,d=()=>new Ie((D,O)=>{if(this.connectionState===si.CONNECTED)return D();let N=()=>{this.off(at.WS_CLOSED,k),D()},k=()=>{this.off(at.WS_CONNECTED,N),O(new te(M.WS_ABORT))};this.once(at.WS_CONNECTED,N),this.once(at.WS_CLOSED,k),t!==et.PUBLISH&&t!==et.PUBLISH_DATASTREAM&&t!==et.SUBSCRIBE&&t!==et.SUBSCRIBE_DATASTREAM&&t!==et.UNSUBSCRIBE&&t!==et.UNSUBSCRIBE_DATASTREAM&&t!==et.UNPUBLISH&&t!==et.UNPUBLISH_DATASTREAM&&t!==et.CONTROL&&t!==et.RESTART_ICE||this.once(at.DISCONNECT_P2P,()=>{O(new te(M.DISCONNECT_P2P))}),t!==et.PUBLISH&&t!==et.RESTART_ICE||this.once(at.ABORT_P2P_EXECUTION,()=>{O(new te(M.DISCONNECT_P2P))})});if(this.connectionState!==si.CONNECTING&&this.connectionState!==si.RECONNECTING||t===et.JOIN||t===et.REJOIN||await d(),this.websocket.sendMessage(c,!0),r)return;let h=new Ie((D,O)=>{let N=!1,k=(B,J)=>{N=!0,D({isSuccess:B==="success",message:J||{}}),this.off(at.WS_CLOSED,U),this.off(at.WS_RECONNECTING,U),this.emit(at.REQUEST_SUCCESS,t,i)};this.once("res-@".concat(s),k);let U=()=>{O(new te(M.WS_ABORT,"type: ".concat(t))),this.off(at.WS_CLOSED,U),this.off(at.WS_RECONNECTING,U),this.off("res-@".concat(s),k)};this.once(at.WS_CLOSED,U),this.once(at.WS_RECONNECTING,U),Sn(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||N||(C.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(at.REQUEST_TIMEOUT,t,i))})}),f=null;try{f=await h}catch(D){if(this.connectionState===si.CLOSED||t===et.LEAVE)throw new te(M.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?D.throw():t===et.JOIN||t===et.REJOIN?null:(await d(),await this.request(t,i))}if(f.isSuccess)return f.message;let E=Number(f.message.error_code||f.message.code),S=Kg(E),y=new te(M.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(f.message.error_str),{code:E,data:f.message,desc:S.desc});return S.action==="success"?f.message:(C.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(S.desc,", action: ").concat(S.action)),E===Xe.ERR_TOO_MANY_BROADCASTERS?((t===et.JOIN||t===et.REJOIN)&&(this.initError=y,this.close()),y.throw()):S.action==="failed"?y.throw():S.action==="quit"?(this.initError=y,this.close(),y.throw()):(E===Xe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,C.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",In.MULTI_IP)):this.reconnect(S.action,In.SERVER_ERROR),t===et.JOIN||t===et.REJOIN?null:await this.request(t,i)))}waitMessage(t,i){return new Ie(n=>{let r=s=>{(!i||i(s))&&(this.off(t,r),n(s))};this.on(t,r)})}uploadWRTCStats(t){if(!this.store.sessionId)return void C.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Wg.WRTC_STATS,i)}upload(t,i){let n={_type:t,_message:i};try{this.websocket.sendMessage(n)}catch{let r=j("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>r&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==si.CONNECTED)return;let s=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(s._type,s._message)},j("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,i){let n={_type:t,_message:i};this.websocket.sendMessage(n)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ie((i,n)=>{this.once(at.WS_CONNECTED,()=>i(this.joinResponse)),this.once(at.WS_CLOSED,r=>n(this.initError||new te(M.WS_ABORT,r))),this.connectionState=si.CONNECTING,this.websocket.init(t).catch(n),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Gt.LEAVE,this.connectionState=si.CLOSED,C.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(at.ABORT_P2P_EXECUTION),this.store.signalConnected();let t=await On(this,at.REQUEST_JOIN_INFO);this.store.joinReq();let i=await this.request(et.JOIN,t);if(this.ortc=t?.ortc,this.store.joinRep(),!i)return this.emit(at.REPORT_JOIN_GATEWAY,Vy.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(at.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=si.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new te(M.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let t=kg(this,at.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;let i=await this.request(et.REJOIN,t);return!!i&&(this.connectionState=si.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(n=>{this.emit(Rt.ON_USER_ONLINE,{uid:n.uid}),n.audio&&this.emit(Rt.ON_ADD_AUDIO_STREAM,{uid:n.uid,uint_id:n.uint_id,audio:!0,ssrcId:n.audio_ssrc}),n.video&&this.emit(Rt.ON_ADD_VIDEO_STREAM,{uid:n.uid,uint_id:n.uint_id,video:!0,ssrcId:n.video_ssrc}),n.audio_mute?this.emit(Rt.MUTE_AUDIO,{uid:n.uid}):this.emit(Rt.UNMUTE_AUDIO,{uid:n.uid}),n.video_mute?this.emit(Rt.MUTE_VIDEO,{uid:n.uid}):this.emit(Rt.UNMUTE_VIDEO,{uid:n.uid}),n.audio_enable_local?this.emit(Rt.ENABLE_LOCAL_AUDIO,{uid:n.uid}):this.emit(Rt.DISABLE_LOCAL_AUDIO,{uid:n.uid}),n.video_enable_local?this.emit(Rt.ENABLE_LOCAL_VIDEO,{uid:n.uid}):this.emit(Rt.DISABLE_LOCAL_VIDEO,{uid:n.uid}),n.audio||n.video||this.emit(Rt.ON_REMOVE_STREAM,{uid:n.uid,uint_id:n.uint_id})}),!0)}reconnect(t,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,i)}async downgradeCodec(t){if(!this.ortc)return!1;let i={downgrade_codec:t,ortc:this.ortc};return!!await this.request(et.DOWNGRADE_CODEC,i)}handleNotification(t){C.debug("[".concat(this.clientId,"] receive notification: "),t);let i=Kg(t.code);if(t.code===28&&"detail"in t&&(C.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(at.RECOVER_NOTIFICATION,t.detail)),i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Gt.UID_BANNED),void this.close()):void this.reconnect(i.action,In.SERVER_ERROR);C.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=j("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=t&&(C.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>j("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",In.TIMEOUT):this.request(et.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let n=Date.now()-i;this.rttRolling.add(n),j("REPORT_STATS")&&this.send(et.PING_BACK,{pingpongElapse:n})}).catch(n=>{})}handleWsInflateData(){let{wsInflateLength:t,wsDeflateLength:i}=this.websocket.getWsInflateData();t!==0&&i!==0&&this.upload(Wg.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(ut.RECONNECT_CREATE_CONNECTION,t=>{this.emit(at.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(ut.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ut.CLOSED,()=>{this.connectionState=si.CLOSED}),this.websocket.on(ut.FAILED,()=>{this._disconnectedReason=Gt.NETWORK_ERROR,this.connectionState=si.CLOSED}),this.websocket.on(ut.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===si.CONNECTED?this.connectionState=si.RECONNECTING:this.connectionState=si.CONNECTING}),this.websocket.on(ut.WILL_RECONNECT,(t,i,n)=>{let r=kg(this,at.IS_P2P_DISCONNECTED),s=r||t!=="retry";r&&t==="retry"&&(C.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",i=Vy.P2P_DISCONNECTED),s&&(C.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(at.REPORT_JOIN_GATEWAY,i||Vy.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(at.DISCONNECT_P2P)),n(t)}),this.websocket.on(ut.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{C.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",In.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(at.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof te){if(t.code===M.UNEXPECTED_RESPONSE&&t.data.code===Xe.ERR_NO_AUTHORIZED)return this.initError=new te(M.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Gt.TOKEN_EXPIRE);C.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",In.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(ut.REQUEST_NEW_URLS,(t,i)=>{On(this,at.REQUEST_RECOVER,this.multiIpOption).then(t).catch(i)}),this.websocket.on(ut.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Rt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(wk.PRE_CONNECT_PC,()=>{this.emit(at.PRE_CONNECT_PC)})}}let h7=(function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e})({}),Fi=(function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e})({});function Dk(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function By(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Dk(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Dk(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}function Wd(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(j("TURN_DOMAIN")):(C.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function Fy(e){try{let t=j("GATEWAY_DOMAINS").concat(j("TURN_DOMAIN")).find(i=>Ce(e).call(e,i));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch{return C.debug("serverUrlToIp error, fallback to url",e),e}}function aI(e,t){e.addresses||(e.addresses=[]);let i=(function(l,d){if(j("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return l.map(E=>{let{ip:S,port:y}=E;return{address:"".concat(S,":").concat(y)}});let h=j("GATEWAY_DOMAINS"),f=h[1]&&Ce(d).call(d,h[1])?1:0;return l.map(E=>{let{domain_prefix:S,port:y,ip:D}=E;if(S)return{address:"".concat(S,".").concat(h[f++%h.length],":").concat(y)};let O=/^[\.\:\d]+$/.test(D),N=O?"".concat(D.replace(/[^\d]/g,"-"),".").concat(h[f++%h.length],":").concat(y):"".concat(D,":").concat(y);return O||C.debug("Cannot recognized as ip address: ".concat(D,", use as host3")),{ip:D,port:y,address:N}})})(e.addresses,t),n=Array.isArray(e.detail)&&e.detail[18];if(n&&typeof n=="string"){let l=n.split(";");for(let d=0;d<l.length;d++){var r;let h=rr(r=l[d]).call(r);i[d]&&h&&(i[d].ip6=h)}}let s=e.detail&&e.detail.candidate,c;if(s){let[l,d]=s.split(":");l&&d&&(c={port:Number(d),ip:l,address:"".concat(l,":").concat(d)})}return{gatewayAddrs:i,apGatewayAddress:c,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function sa(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function Lk(e){let t=e._encoderConfig;if(!t)return{};let i={resolution:t.width&&t.height?"".concat(sa(t.width),"x").concat(sa(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(i.maxFrameRate=t.frameRate,i.minFrameRate=t.frameRate):t.frameRate&&(i.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,i.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),i}function Pk(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function qg(e,t){let i,n,r;switch(t){case Fi.CHOOSE_SERVER:n=4096,r="choose server";break;case Fi.CLOUD_PROXY:n=1048576,r="proxy";break;case Fi.CLOUD_PROXY_5:n=4194304,r="proxy5";break;case Fi.CLOUD_PROXY_FALLBACK:n=4194310,r="proxy fallback";break;default:throw new te(M.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(s=>{s.buffer&&s.buffer.flag===n&&(i={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map(c=>By(By({},c),{},{ticket:s.buffer.cert})),server_ts:e.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:By(By({},s.buffer.detail),e.detail),flag:s.buffer.flag,opid:e.opid,cert:s.buffer.cert})}),!i)throw new te(M.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function xk(e,t){return await Ie.all(e.addresses.map(async i=>({address:Wd(i.ip),tcpport:i.port,udpport:i.port,username:t&&j("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Nn.username,password:t&&j("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await sw(t.toString()):Nn.password})))}function sI(e,t){let i=t.getMediaStreamTrack(!0).getSettings(),n=t.videoHeight||i.height,r=t.videoWidth||i.width;return n&&r?Math.max(Math.min(n,r)/Math.min(sa(e.height),sa(e.width)),1):(C.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function zd(e){let{candidateType:t,relayProtocol:i,type:n,address:r,port:s,protocol:c}=e,l={candidateType:t,relayProtocol:i,protocol:c};if(n!=="local-candidate"){let d=r.split(".");d.length>=4&&(d[1]="*",d[2]="*"),l.address=d.join("."),l.port=s}return l}function Bh(e){let t=e.split(":"),i=e.split(/[-.]/),n=Ce(e).call(e,"-")?"-":".",r=e;return t.length>1?i.length>1?(i[1]="**",r=i[0]+n+"**:"+t[t.length-1]):r=t.length>2?t[0]+n+"**:"+t[t.length-1]:"**:"+t[t.length-1]:i.length>1&&(r=i[0]+n+"**"),r}function Gy(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:j("SVC_MODE");if(j("ENABLE_SVC"))return(function(t){return t in _y})(e)?e:_y.L1T3}let kk={[ke.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[ke.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function Hy(e,t,i){t.forEach(n=>{var r;let s=kk[e].find(l=>{var d;let{key:h}=l;return Ce(d=n.extensionName).call(d,h)});if(!s)return;let c=i.find(l=>{let{extensionName:d}=l;return Ce(d).call(d,s.key)});c&&Ce(r=c.extensionName).call(r,"gdpr_forbidden")&&(n.extensionName=c.extensionName)})}function wm(e,t){t.forEach(i=>{var n;let r=kk[e].find(s=>{var c;let{key:l}=s;return Ce(c=i.extensionName).call(c,l)});Ce(n=i.extensionName).call(n,"gdpr_forbidden")&&r&&(i.extensionName=r.extensionName)})}function Mk(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Ce(e).call(e,"abs-send-time")}function Wy(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Ce(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function Uk(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function Vk(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Uk(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Uk(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}function Xg(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,{filterRTX:r,filterVideoFec:s,filterAudioFec:c,filterAudioCodec:l,filterVideoCodec:d,unsupportedVideoUplinkCodec:h,unsupportedVideoDownlinkCodec:f}=t,{useXR:E}=i,S=[],y=[],D=[],O=[],N=!1,k=!1;if(Br(e).mediaDescriptions.forEach(B=>{n&&n!==B.attributes.direction||(B.media.mediaType!=="video"||N||(y=B.attributes.payloads,O=B.attributes.extmaps,N=!0),B.media.mediaType!=="audio"||k||(S=B.attributes.payloads,D=B.attributes.extmaps,k=!0))}),!O||y.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!D||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(y.forEach(B=>{var J;(J=B.rtpMap)!==null&&J!==void 0&&J.clockRate&&(B.rtpMap.clockRate=parseInt(B.rtpMap.clockRate)),E&&B.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(B=>{var J;(J=B.rtpMap)!==null&&J!==void 0&&J.clockRate&&(B.rtpMap.clockRate=parseInt(B.rtpMap.clockRate)),E&&B.rtcpFeedbacks.push({type:"rrtr"})}),r&&(S=S.filter(B=>{var J;return((J=B.rtpMap)===null||J===void 0?void 0:J.encodingName.toLowerCase())!=="rtx"}),y=y.filter(B=>{var J;return((J=B.rtpMap)===null||J===void 0?void 0:J.encodingName.toLowerCase())!=="rtx"})),s){let B=y.filter(H=>{var ee;return/(red)|(ulpfec)|(flexfec)/i.test(((ee=H.rtpMap)===null||ee===void 0?void 0:ee.encodingName)||"")}),J=Yd(B,y).map(H=>H.payloadType),K=[...B.map(H=>H.payloadType),...J];y=y.filter(H=>!Ce(K).call(K,H.payloadType))}if(c&&(S=S.filter(B=>{var J;return!/(red)|(ulpfec)|(flexfec)/i.test(((J=B.rtpMap)===null||J===void 0?void 0:J.encodingName)||"")})),l&&l?.length>0&&(S=S.filter(B=>{var J;return Ce(l).call(l,((J=B.rtpMap)===null||J===void 0?void 0:J.encodingName.toLowerCase())||"")})),d&&d?.length>0){let B=y.filter(J=>{var K;return Ce(d).call(d,((K=J.rtpMap)===null||K===void 0?void 0:K.encodingName.toLowerCase())||"")});y=B.concat(r?[]:Yd(B,y))}let U=j("UNSUPPORTED_VIDEO_CODEC");if(U&&U.length>0){let B=y.filter(H=>H.rtpMap&&Ce(U).call(U,H.rtpMap.encodingName.toLowerCase())),J=Yd(B,y),K=B.concat(J).map(H=>H.payloadType);y=y.filter(H=>!Ce(K).call(K,H.payloadType)),C.debug("unsupportedVideoCodec: ".concat(U,", toBeRemoved: ").concat(K))}if(h&&h.length>0&&n==="sendonly"){let B=y.filter(H=>H.rtpMap&&Ce(h).call(h,H.rtpMap.encodingName.toLowerCase())),J=Yd(B,y),K=B.concat(J).map(H=>H.payloadType);y=y.filter(H=>!Ce(K).call(K,H.payloadType)),C.debug("unsupportedVideoUplinkCodec: ".concat(h,", toBeRemoved: ").concat(K))}if(f&&f.length>0&&n==="recvonly"){let B=y.filter(H=>H.rtpMap&&Ce(f).call(f,H.rtpMap.encodingName.toLowerCase())),J=Yd(B,y),K=B.concat(J).map(H=>H.payloadType);y=y.filter(H=>!Ce(K).call(K,H.payloadType)),C.debug("unsupportedVideoDownlinkCodec: ".concat(f,", toBeRemoved: ").concat(K))}return{audioCodecs:S,videoCodecs:y,audioExtensions:D,videoExtensions:O}}function Kd(e){let t=Br(e),i,n;for(let r of t.mediaDescriptions){if(!i){let s=r.attributes.iceUfrag,c=r.attributes.icePwd;if(!s||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:s,icePwd:c}}if(!n){let s=r.attributes.fingerprints;s.length>0&&(n={fingerprints:s})}}if(!n&&t.attributes.fingerprints.length>0&&(n={fingerprints:t.attributes.fingerprints}),!n||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:n}}function jk(e,t){let i=[],n=e.attributes.ssrcGroups.filter(c=>c.semantic==="FID"),r=e.attributes.ssrcGroups.find(c=>c.semantic==="SIM"),s=e.attributes.ssrcs;if(r)r.ssrcIds.forEach(c=>{var l;let d=(l=n.find(h=>h.ssrcIds[0]===c))===null||l===void 0?void 0:l.ssrcIds[1];i.push({ssrcId:c,rtx:t?d:void 0})});else if(n.length>0){let c=n[0].ssrcIds[0],l=n[0].ssrcIds[1];i.push({ssrcId:c,rtx:t?l:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:s[0].ssrcId})}return i}function Bk(e,t,i){let{cname:n}=e,r=[];t&&(r=Fk(t)),r.length===0&&(r=e.iceParameters.candidates.map(f=>({foundation:f.foundation,componentId:"1",transport:f.protocol,priority:f.priority.toString(),connectionAddress:f.ip,port:f.port.toString(),type:f.type,extension:{}})),C.debug("Using candidates from gateway."));let s={fingerprints:e.dtlsParameters.fingerprints.map(f=>({hashFunction:f.algorithm,fingerprint:f.fingerprint}))},c={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd},l;switch(e.dtlsParameters.role){case"server":l="passive";break;case"client":l="active";break;case"auto":l="actpass"}let d=Ky(e.rtpCapabilities),h=[];return Array.isArray(i)&&i.length>0&&i.forEach(f=>{h.push({kind:ke.VIDEO,ssrcMsg:[{ssrcId:f.v,rtx:f.v_rtx}],mslabel:"".concat(f.v,"_").concat(f.a)},{kind:ke.AUDIO,ssrcMsg:[{ssrcId:f.a}],mslabel:"".concat(f.v,"_").concat(f.a)})}),{dtlsParameters:s,iceParameters:c,candidates:r,rtpCapabilities:d,setup:l,cname:n,preSSRCs:h}}function Fk(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],C.debug("Using remote candidate from AP ".concat(Bh(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),C.debug("Using IPV6 remote candidate from AP ".concat(Bh(e.ip6),":").concat(e.port)))),t}function Jg(e,t,i){let n=[],r=[];return e.forEach(s=>{let{ssrcId:c,rtx:l}=s,d=ei(8,"track-"),h={ssrcId:c,attributes:Vk({label:d,mslabel:i=i||ei(10,""),msid:"".concat(i," ").concat(d)},t&&{cname:t})};if(n.push(h),l!==void 0){let f={ssrcId:l,attributes:Vk({label:d,mslabel:i,msid:"".concat(i," ").concat(d)},t&&{cname:t})};n.push(f),r.push({semantic:"FID",ssrcIds:[c,l]})}}),e.length>1&&r.push({semantic:"SIM",ssrcIds:e.map(s=>{let{ssrcId:c}=s;return c})}),{ssrcs:n,ssrcGroups:r}}function Im(e,t){t instanceof Oi&&e.attributes.payloads.forEach(i=>{var n;let r=(n=i.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase();if(!r||["opus","pcmu","pcma","g722"].indexOf(r)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),r==="opus"&&typeof j("OPUS_PTIME")=="number"?i.fmtp.parameters.ptime=j("OPUS_PTIME"):i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";let s=t._encoderConfig;s&&(r!=="pcmu"&&r!=="pcma"&&r!=="g722"&&(s.bitrate&&!bi()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1")),t instanceof Gg&&r==="opus"&&t._config.DTX&&(i.fmtp.parameters.usedtx="1"))})}function oI(e){let t=e.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function cI(e,t){var i;if(!(t instanceof oi&&t._encoderConfig&&t._hints.indexOf(Zt.SCREEN_TRACK)===-1))return;let n=t._encoderConfig;Lt().supportMinBitrate&&n.bitrateMin&&e.attributes.payloads.forEach(r=>{var s,c;Ce(s=["h264","h265","vp8","vp9","av1"]).call(s,((c=r.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-min-bitrate"]="".concat(n.bitrateMin))}),Lt().supportMinBitrate&&!Ce(i=t._hints).call(i,Zt.LOW_STREAM)&&n.bitrateMax&&e.attributes.payloads.forEach(r=>{var s,c;Ce(s=["h264","h265","vp8","vp9","av1"]).call(s,((c=r.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-start-bitrate"]="".concat(j("X_GOOGLE_START_BITRATE")||Math.floor(n.bitrateMax)))})}function Gk(e){if(e.media.mediaType!=="video")return;let t=wt();if(t.name!==kt.SAFARI&&t.os!==on.IOS)return;let i=e.attributes.extmaps.findIndex(n=>/video-orientation/g.test(n.extensionName));i!==-1&&e.attributes.extmaps.splice(i,1)}function zy(e,t,i){if(!t)return;let n,r;if(e.media.mediaType==="video"?(n=i.videoExtensions,r=i.videoCodecs):(n=i.audioExtensions,r=i.audioCodecs),t.twcc===!0){let s=n.find(c=>Wy(c.extensionName));if(s){let c=s.extensionName;e.attributes.extmaps.find(l=>Wy(l.extensionName))||e.attributes.extmaps.push({entry:s.entry,extensionName:c}),(function(l,d){return d.filter(h=>!!l.find(f=>f.payloadType===h.payloadType&&!!f.rtcpFeedbacks.find(E=>E.type==="transport-cc")))})(r,e.attributes.payloads).forEach(l=>{l.rtcpFeedbacks.find(d=>d.type==="transport-cc")||l.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){let s=e.attributes.extmaps.findIndex(c=>Wy(c.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach(c=>{let l=c.rtcpFeedbacks.findIndex(d=>d.type==="transport-cc");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}if(t.remb===!0){let s=n.find(c=>Mk(c.extensionName));if(s){let c=s.extensionName;e.attributes.extmaps.find(l=>l.extensionName===c)||e.attributes.extmaps.push({entry:s.entry,extensionName:c}),(function(l,d){return d.filter(h=>!!l.find(f=>f.payloadType===h.payloadType&&!!f.rtcpFeedbacks.find(E=>E.type==="goog-remb")))})(r,e.attributes.payloads).forEach(l=>{l.rtcpFeedbacks.find(d=>d.type==="goog-remb")||l.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){let s=e.attributes.extmaps.findIndex(c=>Mk(c.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach(c=>{let l=c.rtcpFeedbacks.findIndex(d=>d.type==="goog-remb");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}}function Hk(e,t,i){if(bi()||e.media.mediaType!=="video"||!(t instanceof oi)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!j("SIMULCAST")||i==="vp9"&&j("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;let n=i==="vp8"?2:t._scalabilityMode.numSpatialLayers,r=e.attributes.ssrcs[0],s=e.attributes.ssrcGroups.find(l=>l.semantic==="FID"&&l.ssrcIds[0]===r.ssrcId),c={semantic:"SIM",ssrcIds:[r.ssrcId]};for(let l=1;l<n;l++)e.attributes.ssrcs.push({ssrcId:r.ssrcId+l,attributes:Ei(r.attributes)}),c.ssrcIds.push(r.ssrcId+l),s&&(e.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+l,attributes:Ei(r.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[r.ssrcId+l,s.ssrcIds[1]+l]}));e.attributes.ssrcGroups.unshift(c)}async function Wk(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});let n=(await i.createOffer()).sdp,{send:r,recv:s,sendrecv:c}=(function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0,f=Xg(h,l,d,"sendonly"),E=Xg(h,l,d,"recvonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ds(f,E,"videoExtensions",S,y,D),Ds(f,E,"videoCodecs",S,y,D),Ds(f,E,"audioExtensions",S,y,D),Ds(f,E,"audioCodecs",S,y,D),j("RAISE_H264_BASELINE_PRIORITY")){let O=[],N=[];if(D.videoCodecs.forEach((k,U)=>{var B;if(((B=k.rtpMap)===null||B===void 0?void 0:B.encodingName.toLocaleLowerCase())==="h264"){var J,K;let H=D.videoCodecs[U+1],ee=H&&Xk(k,H),ue=(J=k.fmtp)===null||J===void 0?void 0:J.parameters["profile-level-id"],me=(K=k.fmtp)===null||K===void 0?void 0:K.parameters["packetization-mode"];!ue||ue!==j("FIRST_H264_PROFILE_LEVEL_ID")||j("FIRST_PACKETIZATION_MODE")&&me!==j("FIRST_PACKETIZATION_MODE")?ee?N.push([k,H]):N.push([k]):ee?O.push([k,H]):O.push([k])}}),O.length>0&&N.length>0){C.debug("raising H264 baseline profile priority"),D.videoCodecs.forEach((U,B)=>{var J;if(((J=U.rtpMap)===null||J===void 0?void 0:J.encodingName.toLocaleLowerCase())==="h264"){let K=Xk(U,D.videoCodecs[B+1]),H=O.shift()||N.shift()||[];H.length>0&&(K?D.videoCodecs.splice(B,2,...H):D.videoCodecs.splice(B,1,...H))}});let k=y.videoCodecs.filter(U=>{var B,J;return((B=U.rtpMap)===null||B===void 0?void 0:B.encodingName.toLocaleLowerCase())==="h264"&&((J=U.fmtp)===null||J===void 0?void 0:J.parameters["profile-level-id"])!==j("FIRST_H264_PROFILE_LEVEL_ID")});if(k.length>0){let U=Yd(k,y.videoCodecs).map(J=>J.payloadType),B=[...k.map(J=>J.payloadType),...U];y.videoCodecs=y.videoCodecs.filter(J=>!Ce(B).call(B,J.payloadType))}j("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(U=>{var B,J;return!(((B=U.rtpMap)===null||B===void 0?void 0:B.encodingName.toLocaleLowerCase())==="h264"&&((J=U.fmtp)===null||J===void 0?void 0:J.parameters["profile-level-id"])!==j("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:S,recv:y,sendrecv:D}}return{send:S,recv:y,sendrecv:D}})(e,t,n);try{i.close()}catch{}return{send:r,recv:s,sendrecv:c}}function zk(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Xg(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ds(e,t,"videoExtensions",i,n,r),Ds(e,t,"videoCodecs",i,n,r),Ds(e,t,"audioExtensions",i,n,r),Ds(e,t,"audioCodecs",i,n,r),j("RAISE_H264_BASELINE_PRIORITY")){let s=r.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]==="42001f");if(s!==-1){let c=r.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(c<s){C.debug("raising H264 baseline profile priority");let l=r.videoCodecs[s];r.videoCodecs.splice(s,1),r.videoCodecs.splice(c,0,l)}c!==-1&&(n.videoCodecs=n.videoCodecs.filter(l=>!(l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:n,sendrecv:r}}function Ds(e,t,i,n,r,s){if(i==="videoExtensions"||i==="audioExtensions"){let c=[];return e[i].forEach(l=>{t[i].some((d,h)=>{if(l.entry===d.entry&&l.extensionName===d.extensionName)return c.push(h),!0})?s[i].push(l):n[i].push(l)}),void t[i].forEach((l,d)=>{c.indexOf(d)===-1&&r[i].push(l)})}if(i==="videoCodecs"||i==="audioCodecs"){let c=[];return e[i].forEach(l=>{t[i].some((d,h)=>{if(l.payloadType===d.payloadType&&JSON.stringify(l)===JSON.stringify(d))return c.push(h),!0})?s[i].push(l):n[i].push(l)}),void t[i].forEach((l,d)=>{c.indexOf(d)===-1&&r[i].push(l)})}}function Ky(e){let{send:t,recv:i,sendrecv:n}=e;if(!n){if(!t||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:i}}let r,s;return t?(r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r.audioCodecs=[...t.audioCodecs,...n.audioCodecs],r.videoCodecs=[...t.videoCodecs,...n.videoCodecs],r.audioExtensions=[...t.audioExtensions,...n.audioExtensions],r.videoExtensions=[...t.videoExtensions,...n.videoExtensions]):r=n,i?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...i.audioCodecs,...n.audioCodecs],s.videoCodecs=[...i.videoCodecs,...n.videoCodecs],s.audioExtensions=[...i.audioExtensions,...n.audioExtensions],s.videoExtensions=[...i.videoExtensions,...n.videoExtensions]):s=n,{send:r,recv:s}}function Om(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var i;return((i=t.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Zg(e,t,i,n){let r=[];if(e===ke.VIDEO){if(j("H264_PROFILE_LEVEL_ID")&&n==="h264"&&(r=t.videoCodecs.filter(s=>{var c;return Ce(c=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(c,n)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===j("H264_PROFILE_LEVEL_ID")})),!Array.isArray(r)||r.length===0){let s=[],c=[],l=[],d=[];if(i.videoCodecs.forEach(h=>{let f=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"";Ce(f).call(f,n)?s.push(h):Ce(f).call(f,"vp9")?c.push(h):Ce(f).call(f,"vp8")?l.push(h):Ce(f).call(f,"h264")&&d.push(h)}),s.length===0){let h="";c.length!==0?(s=c,h="vp9"):l.length!==0?(s=l,h="vp8"):d.length!==0&&(s=d,h="h264"),C.warning("codec ".concat(n," not included in rtpCapabilities, fallback to default payloads: ").concat(h))}s.length!==0&&(r=t.videoCodecs.filter(h=>s.some(f=>f.payloadType===h.payloadType)))}if(r.length===0&&(C.warning("codec ".concat(n," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),r=t.videoCodecs),j("USE_PUB_RTX")||j("USE_SUB_RTX")){let s=Yd(r,t.videoCodecs);r=[...r,...s]}}else{r=t.audioCodecs.filter(c=>{var l;return Ce(l=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(l,n)});let s=t.audioCodecs.filter(c=>{var l;return Ce(l=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(l,"red")});r.length===0&&(C.warning("codec ".concat(n," not included in rtpCapabilities, fallback to opus")),r=t.audioCodecs.filter(c=>{var l;return Ce(l=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(l,"opus")})),j("ENABLE_AUDIO_RED")&&s.length!==0&&(r=[...s,...r])}return r}function Yd(e,t){let i=e.map(n=>n.payloadType.toString());return t.filter(n=>n.rtpMap&&n.rtpMap.encodingName==="rtx"&&n.fmtp&&n.fmtp.parameters.apt&&Ce(i).call(i,n.fmtp&&n.fmtp.parameters.apt))}async function qd(e,t,i){let n=t.toString(),r=Yk(n,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:n});let s=await e.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let c=s.sdp;c=Kk(c,i||{}),r?.(c||""),await e.setLocalDescription({type:"answer",sdp:c})}function Kk(e,t,i){let n=Br(e),{useXR:r}=t;return n.mediaDescriptions.forEach(s=>{var c;s.attributes.mid&&(Array.isArray(i)&&!Ce(i).call(i,s.attributes.mid)||(s.media.mediaType==="audio"&&Om(s),r&&Ce(c=["audio","video"]).call(c,s.media.mediaType)&&s.attributes.payloads.forEach(l=>{l.rtcpFeedbacks.findIndex(d=>d.type==="rrtr")===-1&&l.rtcpFeedbacks.push({type:"rrtr"})})))}),Bd(n)}function Yk(e,t,i,n){if(j("SDP_LOGGING"))return C.upload("exchanging ".concat(i," ").concat(t," SDP during P2PConnection.").concat(n,`
`),e),t==="offer"?r=>{Yk(r,"answer",i==="local"?"remote":"local",n)}:void 0}function qk(e){let t=j("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(i=>Ce(e).call(e,i))}function Xk(e,t){try{var i;return((i=e.fmtp)===null||i===void 0?void 0:i.parameters.apt)===t.payloadType.toString()}catch{return!1}}function Jk(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function Oa(e,t){return typeof j(e)===t?j(e):void 0}function p7(){try{let e=j("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:(function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i]!=null?arguments[i]:{};i%2?Jk(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Jk(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t})({},e)}catch(e){return C.debug("handle gateway attributes failed: ",e),{}}}let Zk={};function Xd(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&C.debug("install service ".concat(e.name)),Zk[e.name]=e}function Sl(e){let t=Zk[e];if(!t)throw new de(M.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function Qk(e,t){return Sl("DataStream").create(e,t)}function Yy(){return Sl("InterceptFrame").create()}function $k(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function Zn(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?$k(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):$k(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}let lI=new Map;class f7 extends vi{get state(){return this._state}set state(t){if(t===this._state)return;let i=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(hn.CONNECTION_STATE_CHANGE,t,i,this._disconnectedReason):this.emit(hn.CONNECTION_STATE_CHANGE,t,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){C.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,i){var n,r,s;super(),L(this,"store",void 0),L(this,"joinInfo",void 0),L(this,"key",void 0),L(this,"ntpOffset",0),L(this,"signal",void 0),L(this,"role",void 0),L(this,"isPreallocation",void 0),L(this,"isPreSub",void 0),L(this,"inChannelInfo",{joinAt:null,duration:0}),L(this,"spec",void 0),L(this,"_state","DISCONNECTED"),L(this,"_statsCollector",void 0),L(this,"_disconnectedReason",void 0),L(this,"isSignalRecover",!1),L(this,"hasChangeBGPAddress",!1),L(this,"trafficStatsInterval",void 0),L(this,"networkQualityInterval",void 0),L(this,"_joinGatewayStartTime",0),L(this,"_signalTimeout",!1),L(this,"_clientRoleOptions",void 0),L(this,"_isProactiveJoin",!1),this.store=t,this.spec=i,this.signal=this.store.useP2P?(n={spec:Zn(Zn({},i),{},{retryConfig:i.websocketRetryConfig}),store:t},(r=(s=Sl("P2PChannel")).createSubmodule)===null||r===void 0?void 0:r.call(s,n)):new u7(Zn(Zn({},i),{},{retryConfig:i.websocketRetryConfig}),t),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}async join(t,i,n){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let r=Date.now(),s=lI.get(t.cname);if(s||(s=new Map,lI.set(t.cname,s)),this._isProactiveJoin=!0,s.has(t.uid)){let h=new te(M.UID_CONFLICT);throw He.joinGateway(t.sid,{lts:r,succ:!1,ec:h.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),h}s.set(t.uid,!0),this.joinInfo=t,this.key=i;let c=0;this.joinGatewayStartTime=r;let l=t.proxyServer;try{C.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(c));let h=t.gatewayAddrs.map(f=>{let{address:E}=f,[S,y]=E.split(":"),D={host:S,port:y};return t.proxyServer&&(D.proxy=t.proxyServer),D});c=(await this.signal.init(h)).uid,C.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(c," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(h){var d;throw C.error("[".concat(this.store.clientId,"] User join failed"),h.toString()),He.joinGateway(t.sid,{lts:r,succ:!1,ec:((d=h.data)===null||d===void 0?void 0:d.desc)||h.code,errorMsg:h.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!l,signalChannel:"0",preload:t.preload}),s.delete(t.uid),this.signal.close(),h}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),C.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(h=>{C.warning("[".concat(this.store.clientId,"] get traffic stats error"),h.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(hn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(hn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(hn.NETWORK_QUALITY,{uplinkNetworkQuality:Pk(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:Pk(this._statsCollector.trafficStats.B_dnq)}):this.emit(hn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),c}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==Gt.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==si.CONNECTED||await(function(n,r){return r===1/0?n:Ie.race([n,jB(r)])})(this.signal.request(et.LEAVE,void 0,!0),3e3)}catch(n){C.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),n)}this.signal.close(i),i!==Gt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,i,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(M.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let r={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:j("PUB_EXTEND"),twcc:!!j("PUBLISH_TWCC"),rtx:!!j("USE_PUB_RTX")};try{return(await this.signal.request(et.PUBLISH,r,!0))._message}catch(s){if(n&&s.data&&s.data.code===Xe.ERR_PUBLISH_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(t,i),this.publish(t,i,!1);throw s}}async publishDataChannel(t,i,n){var r;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(M.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let s={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(r=i.maxRetransmits)!==null&&r!==void 0?r:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(et.PUBLISH_DATASTREAM,s,!0)}catch(c){if(n&&c.data&&c.data.code===Xe.ERR_PUBLISH_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),c.toString()),await this.tryUnpubDataChannelBeforeRepub(t,i),this.publishDataChannel(t,i,!1);throw c}}async unpublish(t,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(M.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(et.UNPUBLISH,{stream_id:i,ortc:t},!0)}catch(n){C.warning("[".concat(this.store.clientId,"] unpublish warning: "),n)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(M.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Ie.all(t.map(i=>this.signal.request(et.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){C.warning("unpublish datachannels warning: ",i)}}async presubscribe(t,i,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(M.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let r={stream_id:t,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!j("SUBSCRIBE_TWCC"),rtx:!!j("USE_SUB_RTX")||void 0,extend:j("SUB_EXTEND"),svc:Array.isArray(j("SVC"))&&j("SVC").length!==0?j("SVC"):void 0};try{return await this.signal.request(et.PRE_SUBSCRIBE,r,!0)}catch(s){if(n&&s.data&&s.data.code===Xe.ERR_SUBSCRIBE_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(t,i,!1);throw s}}async subscribe(t,i,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(M.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let r={stream_id:t,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!j("SUBSCRIBE_TWCC"),rtx:!!j("USE_SUB_RTX"),extend:j("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(j("SVC"))&&j("SVC").length!==0?j("SVC"):void 0};try{return(await this.signal.request(et.SUBSCRIBE,r,!0))._message}catch(s){if(n&&s.data&&s.data.code===Xe.ERR_SUBSCRIBE_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(t,i),await this.subscribe(t,i,!1);throw s}}async subscribeDataChannel(t,i,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(M.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let r={uid:t,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(et.SUBSCRIBE_DATASTREAM,r,!0)}catch(s){if(n&&s.data&&s.data.code===Xe.ERR_SUBSCRIBE_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(t,i),await this.subscribeDataChannel(t,i,!1);throw s}}async subscribeAll(t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(M.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let n={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!j("USE_SUB_RTX"),twcc:!!j("SUBSCRIBE_TWCC"),svc:Array.isArray(j("SVC"))&&j("SVC").length!==0?j("SVC"):void 0};try{return await this.signal.request(et.SUBSCRIBE_STREAMS,n,!0)}catch(r){if(i&&r.data&&r.data.code===Xe.ERR_SUBSCRIBE_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),r.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw r}}async setVideoProfile(t){let i=(function(n){if(!(n.bitrateMax&&n.bitrateMin&&n.frameRate&&n.height&&n.width))return;let r=n.frameRate,s=n.width,c=n.height,l=!0;return typeof r!="number"&&(r=r.exact||r.ideal||r.max||r.min||0,r||(l=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(l=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,r||(l=!1)),l?{stream_type:0,width:s,height:c,fps:r,start_bps:1e3*n.bitrateMax,min_bps:1e3*n.bitrateMin,target_bps:1e3*n.bitrateMax}:void 0})(t);if(i)return this.signal.request(et.SET_VIDEO_PROFILE,i);C.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,i){try{await this.signal.request(et.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:i},!0)}catch(n){C.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),n)}}async unsubscribeDataChannel(t,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(M.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Ie.all(t.map(n=>this.signal.request(et.UNSUBSCRIBE_DATASTREAM,{stream_id:n,uid:i},!0)))}catch(n){C.warning("unsubscribeDataChannel warning: ",n)}}async massUnsubscribe(t){try{await this.signal.request(et.UNSUBSCRIBE_STREAMS,t,!0)}catch(i){C.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(t){let{iceParameters:i,dtlsParameters:n,rtpCapabilities:r}=t;return{gatewayEstablishParams:await this.signal.request(et.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:n,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(et.GATEWAY_INFO)}async renewToken(t){await this.signal.request(et.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,i){i&&(this._clientRoleOptions=Object.assign({},i)),j("CLIENT_ROLE_OPTIONS")&&(C.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(j("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},j("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),j("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},j("CLIENT_ROLE_OPTIONS")),C.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(j("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let n,r=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(n=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0;let s=Object.assign({},i);delete s.delay,delete s.level,await this.signal.request(et.SET_CLIENT_ROLE,Zn(Zn({role:t,level:r,delay:n},s),{},{client_ts:Date.now()})),this.role=t}async setRemoteVideoStreamType(t,i){await this.signal.request(et.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:i})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(et.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,i){await this.signal.request(et.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:i})}async pickSVCLayer(t,i){await this.signal.request(et.PICK_SVC_LAYER,{stream_id:t,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(t){await this.signal.request(et.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,i,n){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,i,n)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Zn({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(et.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let t=lI.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let t=(function(i){let n;return n=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),n?{username:Nn.username,password:Nn.password,turnServerURL:n[2],tcpport:parseInt(n[3])+30,udpport:parseInt(n[3])+30,forceturn:!1}:null})((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Zn(Zn({},Nn),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;let t=await this.signal.request(et.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(i=>{let n=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(r=>r.peer_uid===i.peer_uid);n&&n.B_st!==i.B_st&&hy(()=>{this.emit(hn.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var i,n;if(!this.joinInfo||!this.key)throw new te(M.UNEXPECTED_ERROR,"can not generate join message, no join info");let r=Object.assign({},this.joinInfo.apResponse),s=j("REPORT_APP_SCENARIO");if(typeof s!="string")try{s=JSON.stringify(s)}catch{s=void 0}var c;s&&s.length>128&&(s=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(hn.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,Ce(ym).call(ym,c)||ym.push(c);let l=Cw(this.store),d=!((i=this.isPreallocation)===null||i===void 0||!i.call(this)),h=iP(this.store),f=p7(),E=nm(87)||uL()||QA(117),S=((function(){let D=wt();if(D.name!==kt.SAFARI||!D.browserVersion)return!1;let O=D.browserVersion.split(".");return Number(O[0])>18||Number(O[0])===18&&Number(O[1])>=4})()||mL(18,4,!1))&&$A(18,6,!0)&&this.spec.codec==="h264"&&j("ENABLE_ABSSENDTIME_AS_SENTTS"),y=Zn({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Ya,browser:navigator.userAgent,process_id:j("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:j("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:Zn(Zn({enableEncodedTransform:(!!j("ENABLE_AUDIO_METADATA")||!!j("ENABLE_AUDIO_PTS"))&&E||!!j("ENABLE_AUDIO_TOPN")&&JA(kt.CHROME,87,116)||void 0,enableAudioMetadata:!!j("ENABLE_AUDIO_METADATA")&&E,enableAudioPts:!!j("ENABLE_AUDIO_PTS")&&E,topnSmoothLevel:j("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:j("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:j("TOPN_SWITCH_HOLD_MS"),topnAudioGain:j("TOPN_AUDIO_GAIN"),enablePublishedUserList:j("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:j("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Oa("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Oa("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Oa("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:j("USE_PUB_RTX")===!0||j("USE_SUB_RTX")===!0||void 0,disableFEC:j("DISABLE_FEC"),enableNTPReport:!!j("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:h,enableFulllinkAvSync:!!j("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Oa("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!j("FORCE_ENABLE_AUT_CC")||!Sy()&&(!!j("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!j("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Oa("USE_XR","boolean"),enableLossbasedBwe:Oa("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!j("FORCE_ENABLE_AUT_CC")||!Sy()&&(!!j("ENABLE_AUT_CC")||void 0),enableCCFallback:Oa("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:d,preSubNum:l?Oa("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Oa("PUBLISH_TWCC","boolean"),enableSubTWCC:Oa("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Oa("USE_PUB_RTX","boolean"),enableSubRTX:Oa("USE_SUB_RTX","boolean"),enableSubSVC:j("ENABLE_SVC")?j("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(j("SVC"))&&j("SVC").length!==0?j("SVC"):void 0,enableSvcExtended:j("ENABLE_SVC")&&Array.isArray(j("SVC_EXTENDED"))&&j("SVC_EXTENDED").length!==0?j("SVC_EXTENDED"):void 0},f),{},{audioDuplicate:Oa("ENABLE_AUDIO_RED","boolean")?(n=Oa("AUDIO_DUPLICATE_NUM","number"))!==null&&n!==void 0?n:2:void 0,senttsUsesAbsSendTime:!!S||void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(y.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(y.aes_mode=this.joinInfo.aesmode,j("ENCRYPT_AES")?(y.aes_secret=this.joinInfo.aespassword,y.aes_encrypt=!0):y.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(y.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(y.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),this.joinInfo.defaultVideoStream!==void 0&&(y.default_video_stream=this.joinInfo.defaultVideoStream),y}getRejoinMessage(){if(!this.joinInfo)throw new te(M.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(at.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(at.WS_RECONNECTING,t=>{this.joinInfo&&He.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||In.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",He.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(at.WS_CLOSED,t=>{let i;switch(t){case Gt.LEAVE:i=In.LEAVE;break;case Gt.UID_BANNED:case Gt.IP_BANNED:case Gt.CHANNEL_BANNED:case Gt.SERVER_ERROR:i=In.SERVER_ERROR;break;case Gt.FALLBACK:i=In.FALLBACK;break;case Gt.LICENSE_MISSING:case Gt.LICENSE_EXPIRED:case Gt.LICENSE_MINUTES_EXCEEDED:case Gt.LICENSE_PERIOD_INVALID:case Gt.LICENSE_MULTIPLE_SDK_SERVICE:case Gt.LICENSE_ILLEGAL:case Gt.TOKEN_EXPIRE:i=t;break;default:i=In.NETWORK_ERROR}C.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+In.NETWORK_ERROR)),this.joinInfo&&He.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Gt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=t,t!==Gt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(at.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){let t=j("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(C.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(He.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){let t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void C.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));Kt("EVENT_REPORT_DOMAIN",t[1]),Kt("EVENT_REPORT_BACKUP_DOMAIN",t[1]),Kt("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(Rt.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(at.REQUEST_RECOVER,(t,i,n)=>{if(!this.joinInfo)return n(new te(M.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,On(this,hn.REQUEST_NEW_GATEWAY_LIST).then(i).catch(n)}),this.signal.on(at.REQUEST_JOIN_INFO,async(t,i,n)=>{var r,s,c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));let l=Ei((r=this.joinInfo)===null||r===void 0?void 0:r.turnServer);if(j("NEW_TURN_MODE")&&l&&((s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer)==="disabled"){var d;let S=l.servers.map(O=>"turnServerURL"in O&&j("USE_TURN_IP")?Zn(Zn({},O),{},{turnServerURL:Fy(O.turnServerURL)}):O),y=(d=l.serversFromGateway)===null||d===void 0?void 0:d.map(O=>j("USE_TURN_IP")?Zn(Zn({},O),{},{turnServerURL:Fy(O.turnServerURL)}):O),D=this.signal.currentURLIndex;S.length>0&&(S=[S[D%S.length]],l.servers=S),Array.isArray(y)&&y.length>0&&(y=[y[0]],l.serversFromGateway=y),C.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(D))}let{iceParameters:h,dtlsParameters:f,rtpCapabilities:E}=await On(this,hn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:l,cloudProxyServer:(c=this.joinInfo)===null||c===void 0?void 0:c.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:f,rtpCapabilities:E,version:"2"}}))}catch(S){i(S)}}),this.signal.on(at.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(at.REPORT_JOIN_GATEWAY,(t,i)=>{if(!this.joinInfo)return;let n,r="";var s;t instanceof te?(n=((s=t.data)===null||s===void 0?void 0:s.desc)||t.code,r=t.message):n=t,He.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:n,errorMsg:r,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(at.IS_P2P_DISCONNECTED,t=>{t(kg(this,hn.IS_P2P_DISCONNECTED))}),this.signal.on(at.DISCONNECT_P2P,()=>{this.emit(hn.DISCONNECT_P2P)}),this.signal.on(at.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(at.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(at.JOIN_RESPONSE,t=>{let i=this.getCurrentGatewayAddress();this.emit(hn.JOIN_RESPONSE,t,i)}),this.signal.on(at.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var t,i;this.updateTurnConfigFromSignal();let r=this.getCurrentGatewayAddress(),s=Ei((t=this.joinInfo)===null||t===void 0?void 0:t.turnServer);if(j("NEW_TURN_MODE")&&s&&((i=this.joinInfo)===null||i===void 0?void 0:i.cloudProxyServer)==="disabled"){var n;let l=s.servers.map(f=>"turnServerURL"in f&&j("USE_TURN_IP")?Zn(Zn({},f),{},{turnServerURL:Fy(f.turnServerURL)}):f),d=(n=s.serversFromGateway)===null||n===void 0?void 0:n.map(f=>j("USE_TURN_IP")?Zn(Zn({},f),{},{turnServerURL:Fy(f.turnServerURL)}):f),h=this.signal.currentURLIndex;l.length>0&&(l=[l[h%l.length]],s.servers=l),Array.isArray(d)&&d.length>0&&(d=[d[0]],s.serversFromGateway=d),C.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(h,",in pre pc"))}let c=j("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&c){let l=Fk(r);this.emit(hn.PRE_CONNECT_PC,{candidates:l,fingerprint:c,turnServer:s})}}}),this.signal.on(at.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof j("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(j("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,i){try{await this.signal.request(et.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[i]},!0)}catch(n){throw C.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),n),n}}async tryUnsubDataChannelBeforeResub(t,i){try{await this.signal.request(et.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(n){throw C.warning("unsubscribe datachannel warning",n),n}}async tryUnpubBeforeRepub(t,i){try{await this.signal.request(et.UNPUBLISH,{stream_id:t,ortc:i},!0)}catch(n){throw C.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),n),n}}async tryUnpubDataChannelBeforeRepub(t,i){try{await this.signal.request(et.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(n){throw C.warning("unpublish datastream warning: ",n),n}}async tryMassUnsubBeforeResub(t){let i={users:t.map(n=>({stream_id:n.stream_id,stream_type:n.stream_type}))};try{await this.signal.request(et.UNSUBSCRIBE_STREAMS,i,!0)}catch(n){throw C.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),n),n}}async muteLocal(t,i){let n={action:t.find(r=>r.stream_type===Wt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:i};try{await this.signal.request(et.CONTROL,n,!0,!0)}catch(r){throw C.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),r),r}}async unmuteLocal(t,i){let n={action:t.find(r=>r.stream_type===Wt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:i};try{await this.signal.request(et.CONTROL,n,!0,!0)}catch(r){throw C.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),r),r}}async muteRemote(t,i){let n={action:t===ke.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(et.CONTROL,n,!0,!0)}catch(r){throw C.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),r),r}}async unmuteRemote(t,i){let n={action:t===ke.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(et.CONTROL,n,!0,!0)}catch(r){throw C.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),r),r}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,i){this.signal.upload(t,i)}getSignalRTT(){return this.signal.rtt}async restartICE(t){let i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(et.RESTART_ICE,i,!0)}catch(n){throw C.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),n),n}}reconnect(t,i){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,i||In.P2P_FAILED)}getCurrentGatewayAddress(){var t,i;if(!j("GATEWAY_WSS_ADDRESS"))return j("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(C.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(et.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}}let qy=0,dI=0;function mo(e,t,i,n){return new Ie((r,s)=>{t.timeout=t.timeout||j("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!i?(t.data=JSON.stringify(t.data),qy+=oc(t.data)):i&&(t.data.size?qy+=t.data.size:t.data instanceof FormData?qy+=DL(t.data):qy+=oc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,br.request(t).then(c=>{typeof c.data=="string"?dI+=oc(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?dI+=c.data.byteLength:dI+=oc(JSON.stringify(c.data)),n&&r({data:c.data,headers:c.headers}),r(c.data)}).catch(c=>{br.isCancel(c)?s(new te(M.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?s(new te(M.NETWORK_TIMEOUT,c.message)):c.response?s(new te(M.NETWORK_RESPONSE_ERROR,c.response.status)):s(new te(M.NETWORK_ERROR,c.message))})})}(function(){var e;function t(pe){var Ae=0;return function(){return Ae<pe.length?{done:!1,value:pe[Ae++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(pe,Ae,Me){return pe==Array.prototype||pe==Object.prototype||(pe[Ae]=Me.value),pe},n,r=(function(pe){pe=[typeof globalThis=="object"&&globalThis,pe,typeof window=="object"&&window,typeof self=="object"&&self,typeof v=="object"&&v];for(var Ae=0;Ae<pe.length;++Ae){var Me=pe[Ae];if(Me&&Me.Math==Math)return Me}throw Error("Cannot find global object")})(this);function s(pe,Ae){if(Ae)e:{var Me=r;pe=pe.split(".");for(var Ee=0;Ee<pe.length-1;Ee++){var I=pe[Ee];if(!(I in Me))break e;Me=Me[I]}(Ae=Ae(Ee=Me[pe=pe[pe.length-1]]))!=Ee&&Ae!=null&&i(Me,pe,{configurable:!0,writable:!0,value:Ae})}}function c(pe){return(pe={next:pe})[Symbol.iterator]=function(){return this},pe}function l(pe){var Ae=typeof Symbol<"u"&&Symbol.iterator&&pe[Symbol.iterator];return Ae?Ae.call(pe):{next:t(pe)}}if(s("Symbol",function(pe){function Ae(I,G){this.A=I,i(this,"description",{configurable:!0,writable:!0,value:G})}if(pe)return pe;Ae.prototype.toString=function(){return this.A};var Me="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Ee=0;return function I(G){if(this instanceof I)throw new TypeError("Symbol is not a constructor");return new Ae(Me+(G||"")+"_"+Ee++,G)}}),s("Symbol.iterator",function(pe){if(pe)return pe;pe=Symbol("Symbol.iterator");for(var Ae="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Me=0;Me<Ae.length;Me++){var Ee=r[Ae[Me]];typeof Ee=="function"&&typeof Ee.prototype[pe]!="function"&&i(Ee.prototype,pe,{configurable:!0,writable:!0,value:function(){return c(t(this))}})}return pe}),typeof Object.setPrototypeOf=="function")n=Object.setPrototypeOf;else{var d;e:{var h={};try{h.__proto__={a:!0},d=h.a;break e}catch{}d=!1}n=d?function(pe,Ae){if(pe.__proto__=Ae,pe.__proto__!==Ae)throw new TypeError(pe+" is not extensible");return pe}:null}var f=n;function E(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function S(pe){if(pe.m)throw new TypeError("Generator is already running");pe.m=!0}function y(pe,Ae){return pe.h=3,{value:Ae}}function D(pe){this.g=new E,this.G=pe}function O(pe,Ae,Me,Ee){try{var I=Ae.call(pe.g.j,Me);if(!(I instanceof Object))throw new TypeError("Iterator result "+I+" is not an object");if(!I.done)return pe.g.m=!1,I;var G=I.value}catch(X){return pe.g.j=null,pe.g.s(X),N(pe)}return pe.g.j=null,Ee.call(pe.g,G),N(pe)}function N(pe){for(;pe.g.h;)try{var Ae=pe.G(pe.g);if(Ae)return pe.g.m=!1,{value:Ae.value,done:!1}}catch(Me){pe.g.v=void 0,pe.g.s(Me)}if(pe.g.m=!1,pe.g.l){if(Ae=pe.g.l,pe.g.l=null,Ae.F)throw Ae.D;return{value:Ae.return,done:!0}}return{value:void 0,done:!0}}function k(pe){this.next=function(Ae){return pe.o(Ae)},this.throw=function(Ae){return pe.s(Ae)},this.return=function(Ae){return(function(Me,Ee){S(Me.g);var I=Me.g.j;return I?O(Me,"return"in I?I.return:function(G){return{value:G,done:!0}},Ee,Me.g.return):(Me.g.return(Ee),N(Me))})(pe,Ae)},this[Symbol.iterator]=function(){return this}}function U(pe,Ae){return Ae=new k(new D(Ae)),f&&pe.prototype&&f(Ae,pe.prototype),Ae}if(E.prototype.o=function(pe){this.v=pe},E.prototype.s=function(pe){this.l={D:pe,F:!0},this.h=this.C||this.u},E.prototype.return=function(pe){this.l={return:pe},this.h=this.u},D.prototype.o=function(pe){return S(this.g),this.g.j?O(this,this.g.j.next,pe,this.g.o):(this.g.o(pe),N(this))},D.prototype.s=function(pe){return S(this.g),this.g.j?O(this,this.g.j.throw,pe,this.g.o):(this.g.s(pe),N(this))},s("Array.prototype.entries",function(pe){return pe||function(){return(function(Ae,Me){Ae instanceof String&&(Ae+="");var Ee=0,I=!1,G={next:function(){if(!I&&Ee<Ae.length){var X=Ee++;return{value:Me(X,Ae[X]),done:!1}}return I=!0,{done:!0,value:void 0}}};return G[Symbol.iterator]=function(){return G},G})(this,function(Ae,Me){return[Ae,Me]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var B=function(pe,Ae){for(var Me=0;Me<pe.length;Me++)Ae(pe[Me])},J=function(pe){return pe.replace(/\r?\n|\r/g,`\r
`)},K=function(pe,Ae,Me){return Ae instanceof Blob?(Me=Me!==void 0?Me+"":typeof Ae.name=="string"?Ae.name:"blob",Ae.name===Me&&Object.prototype.toString.call(Ae)!=="[object Blob]"||(Ae=new File([Ae],Me)),[String(pe),Ae]):[String(pe),String(Ae)]},H=function(pe,Ae){if(pe.length<Ae)throw new TypeError(Ae+" argument required, but only "+pe.length+" present.")},ee=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,ue=ee.FormData,me=ee.XMLHttpRequest&&ee.XMLHttpRequest.prototype.send,ye=ee.Request&&ee.fetch,pt=ee.navigator&&ee.navigator.sendBeacon,mt=ee.Element&&ee.Element.prototype,nt=ee.Symbol&&Symbol.toStringTag;nt&&(Blob.prototype[nt]||(Blob.prototype[nt]="Blob"),"File"in ee&&!File.prototype[nt]&&(File.prototype[nt]="File"));try{new File([],"")}catch{ee.File=function(pe,Ae,Me){return pe=new Blob(pe,Me||{}),Object.defineProperties(pe,{name:{value:Ae},lastModified:{value:+(Me&&Me.lastModified!==void 0?new Date(Me.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),nt&&Object.defineProperty(pe,nt,{value:"File"}),pe}}var jt=function(pe){return pe.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Mt=function(pe){this.i=[];var Ae=this;pe&&B(pe.elements,function(Me){if(Me.name&&!Me.disabled&&Me.type!=="submit"&&Me.type!=="button"&&!Me.matches("form fieldset[disabled] *"))if(Me.type==="file"){var Ee=Me.files&&Me.files.length?Me.files:[new File([],"",{type:"application/octet-stream"})];B(Ee,function(I){Ae.append(Me.name,I)})}else Me.type==="select-multiple"||Me.type==="select-one"?B(Me.options,function(I){!I.disabled&&I.selected&&Ae.append(Me.name,I.value)}):Me.type==="checkbox"||Me.type==="radio"?Me.checked&&Ae.append(Me.name,Me.value):(Ee=Me.type==="textarea"?J(Me.value):Me.value,Ae.append(Me.name,Ee))})};if((e=Mt.prototype).append=function(pe,Ae,Me){H(arguments,2),this.i.push(K(pe,Ae,Me))},e.delete=function(pe){H(arguments,1);var Ae=[];pe=String(pe),B(this.i,function(Me){Me[0]!==pe&&Ae.push(Me)}),this.i=Ae},e.entries=function pe(){var Ae,Me=this;return U(pe,function(Ee){if(Ee.h==1&&(Ae=0),Ee.h!=3)return Ae<Me.i.length?Ee=y(Ee,Me.i[Ae]):(Ee.h=0,Ee=void 0),Ee;Ae++,Ee.h=2})},e.forEach=function(pe,Ae){H(arguments,1);for(var Me=l(this),Ee=Me.next();!Ee.done;Ee=Me.next()){var I=l(Ee.value);Ee=I.next().value,I=I.next().value,pe.call(Ae,I,Ee,this)}},e.get=function(pe){H(arguments,1);var Ae=this.i;pe=String(pe);for(var Me=0;Me<Ae.length;Me++)if(Ae[Me][0]===pe)return Ae[Me][1];return null},e.getAll=function(pe){H(arguments,1);var Ae=[];return pe=String(pe),B(this.i,function(Me){Me[0]===pe&&Ae.push(Me[1])}),Ae},e.has=function(pe){H(arguments,1),pe=String(pe);for(var Ae=0;Ae<this.i.length;Ae++)if(this.i[Ae][0]===pe)return!0;return!1},e.keys=function pe(){var Ae,Me,Ee,I,G=this;return U(pe,function(X){if(X.h==1&&(Ae=l(G),Me=Ae.next()),X.h!=3)return Me.done?void(X.h=0):(Ee=Me.value,I=l(Ee),y(X,I.next().value));Me=Ae.next(),X.h=2})},e.set=function(pe,Ae,Me){H(arguments,2),pe=String(pe);var Ee=[],I=K(pe,Ae,Me),G=!0;B(this.i,function(X){X[0]===pe?G&&(G=!Ee.push(I)):Ee.push(X)}),G&&Ee.push(I),this.i=Ee},e.values=function pe(){var Ae,Me,Ee,I,G=this;return U(pe,function(X){if(X.h==1&&(Ae=l(G),Me=Ae.next()),X.h!=3)return Me.done?void(X.h=0):(Ee=Me.value,(I=l(Ee)).next(),y(X,I.next().value));Me=Ae.next(),X.h=2})},Mt.prototype._asNative=function(){for(var pe=new ue,Ae=l(this),Me=Ae.next();!Me.done;Me=Ae.next()){var Ee=l(Me.value);Me=Ee.next().value,Ee=Ee.next().value,pe.append(Me,Ee)}return pe},Mt.prototype._blob=function(){var pe="----formdata-polyfill-"+Math.random(),Ae=[],Me="--"+pe+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Ee,I){return typeof Ee=="string"?Ae.push(Me+jt(J(I))+`"\r
\r
`+J(Ee)+`\r
`):Ae.push(Me+jt(J(I))+'"; filename="'+jt(Ee.name)+`"\r
Content-Type: `+(Ee.type||"application/octet-stream")+`\r
\r
`,Ee,`\r
`)}),Ae.push("--"+pe+"--"),new Blob(Ae,{type:"multipart/form-data; boundary="+pe})},Mt.prototype[Symbol.iterator]=function(){return this.entries()},Mt.prototype.toString=function(){return"[object FormData]"},mt&&!mt.matches&&(mt.matches=mt.matchesSelector||mt.mozMatchesSelector||mt.msMatchesSelector||mt.oMatchesSelector||mt.webkitMatchesSelector||function(pe){for(var Ae=(pe=(this.document||this.ownerDocument).querySelectorAll(pe)).length;0<=--Ae&&pe.item(Ae)!==this;);return-1<Ae}),nt&&(Mt.prototype[nt]="FormData"),me){var Hn=ee.XMLHttpRequest.prototype.setRequestHeader;ee.XMLHttpRequest.prototype.setRequestHeader=function(pe,Ae){Hn.call(this,pe,Ae),pe.toLowerCase()==="content-type"&&(this.B=!0)},ee.XMLHttpRequest.prototype.send=function(pe){pe instanceof Mt?(pe=pe._blob(),this.B||this.setRequestHeader("Content-Type",pe.type),me.call(this,pe)):me.call(this,pe)}}ye&&(ee.fetch=function(pe,Ae){return Ae&&Ae.body&&Ae.body instanceof Mt&&(Ae.body=Ae.body._blob()),ye.call(this,pe,Ae)}),pt&&(ee.navigator.sendBeacon=function(pe,Ae){return Ae instanceof Mt&&(Ae=Ae._asNative()),pt.call(this,pe,Ae)}),ee.FormData=Mt}})();let Qg=()=>{let e=j("AREAS");return e.length===0&&e.push(Ut.GLOBAL),xr(e).call(e,(t,i,n)=>{let r=eM(i);return r?n===0?r:"".concat(t,",").concat(r):t},"")},eM=e=>e===Ut.OVERSEA?"".concat(Bn.ASIA,",").concat(Bn.EUROPE,",").concat(Bn.AFRICA,",").concat(Bn.NORTH_AMERICA,",").concat(Bn.SOUTH_AMERICA,",").concat(Bn.OCEANIA):Bn[e],m7=e=>{let t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(i=>{let n=jy[i],r=Object.keys(n);r&&r.map(s=>{s!=="CODE"&&(t[s]=t[s].concat(n[s]))})}),t},Xy={GLOBAL:{ASIA:[Ut.CHINA,Ut.JAPAN,Ut.INDIA,Ut.KOREA,Ut.HKMC],EUROPE:[],NORTH_AMERICA:[Ut.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Jy=Object.keys(Xy[Ut.GLOBAL]),uI=[Ut.CHINA,Ut.NORTH_AMERICA,Ut.EUROPE,Ut.ASIA,Ut.JAPAN,Ut.INDIA,Ut.OCEANIA,Ut.SOUTH_AMERICA,Ut.AFRICA,Ut.KOREA,Ut.HKMC,Ut.US],_7=function(e,t){let i=[];if(Ce(e).call(e,Ut.GLOBAL)){let s=[Ut.GLOBAL,Ut.OVERSEA],c=Object.keys(jy);if(t===Ut.GLOBAL)throw new te(M.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Ut.CHINA)i=[Ut.OVERSEA];else if(r=t,Ce(Jy).call(Jy,r)){let l=(n=t,Xy[Ut.GLOBAL][n]||[]),d=[...s,t,...l];i=c.filter(h=>!Ce(d).call(d,h))}else if((function(l){let d=!1;return Jy.forEach(h=>{var f;Ce(f=Xy[Ut.GLOBAL][h]).call(f,l)&&(d=!0)}),d})(t)){let l=(function(h){let f;return Jy.forEach(E=>{var S;Ce(S=Xy[Ut.GLOBAL][E]).call(S,h)&&(f=E)}),f})(t),d=[...s,l,t];i=c.filter(h=>!Ce(d).call(d,h))}else i=e;i=(function(l){let d=[];return uI.forEach(h=>{Ce(l).call(l,h)&&d.push(h)}),d.concat(l.filter(h=>!Ce(uI).call(uI,h)))})(i)}else i=e;var n,r;return i};function tM(e){var t,i;if(!e&&Ce(t=j("AREAS")).call(t,Ut.EXTENSIONS))return C.debug("update area from ap : reset"),void hI(CF,!0);if(!Ce(i=j("AREAS")).call(i,Ut.GLOBAL)||!e)return;let n=jy.EXTENSIONS;n&&(n={CODE:eM(Ut.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},C.debug("update area from ap success: ".concat(e,",config is "),n),Kt("AREAS",[Ut.EXTENSIONS],!0),Object.keys(n).map(r=>{r==="LOG_UPLOAD_SERVER"||r==="EVENT_REPORT_DOMAIN"||r==="EVENT_REPORT_BACKUP_DOMAIN"||r==="PROXY_SERVER_TYPE3"?Kt(r,n[r][0]):Kt(r,n[r])}))}function hI(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=He.reportApiInvoke(null,{name:Li.SET_AREA,options:e,tag:_i.TRACER});try{let n=[];if(typeof e=="string"&&(n=[e]),Array.isArray(e)&&(e.forEach(s=>{if(!Ce(yk).call(yk,s))throw new te(M.INVALID_PARAMS,"invalid area code")}),n=e),Object.prototype.toString.call(e)==="[object Object]"){let{areaCode:s,excludedArea:c}=e;if(!s)throw new te(M.INVALID_PARAMS,"area code is needed");let l=s;typeof s=="string"&&(l=[s]),n=c?_7(l,c):l}if(!t){if(uo.AREAS){let s=new te(M.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(s),void C.warning("setArea is prohibited because of config-distribute")}if(Ce(n).call(n,Ut.GLOBAL)&&j("AREAS")===Ut.EXTENSIONS){let s=new te(M.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(s),void C.warning("setArea is prohibited because of ap extensions")}}Kt("AREAS",n,t);let r=m7(n);Object.keys(r).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?Kt(s,r[s][0]):Kt(s,r[s])}),C.debug("set area success:",n.join(","))}catch(n){throw i.onError(n),n}i.onSuccess()}function iM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function pc(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?iM(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):iM(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}let pI=1;function E7(e,t,i,n,r){pI+=1;let s={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:pI,requestId:pI,version:Ya,cname:i.cname},c={service_name:t,json_body:JSON.stringify(s)},l,d,h=e[0];return lo(async()=>{l=Date.now();let f=await mo(h,{data:c,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(d=Date.now()-l,f.code!==0){let y=new te(M.UNEXPECTED_RESPONSE,"live streaming ap error, code"+f.code,{retry:!0,responseTime:d});throw C.error(y.toString()),y}let E=JSON.parse(f.json_body);if(E.code!==200){let y=new te(M.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(E.code,", reason: ").concat(E.reason),{code:E.code,responseTime:d});throw C.error(y.toString()),y}if(!E.servers||E.servers.length===0){let y=new te(M.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:E.code,responseTime:d});throw C.error(y.toString()),y}let S=(function(y,D){return{addressList:y.servers.map(O=>"wss://".concat(O.address.replace(/\./g,"-"),".").concat(j("WORKER_DOMAIN"),":").concat(O.wss,"?serviceName=").concat(encodeURIComponent(D))),workerToken:y.workerToken,vid:y.vid}})(E,t);return j("LIVE_STREAMING_ADDRESS")&&(S.addressList=j("LIVE_STREAMING_ADDRESS")instanceof Array?j("LIVE_STREAMING_ADDRESS"):[j("LIVE_STREAMING_ADDRESS")]),pc(pc({},S),{},{responseTime:d})},(f,E)=>(He.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(f.addressList),firstSuccess:E===0,responseTime:d,serverIp:e[E%e.length]}),!1),(f,E)=>(He.apworkerEvent(i.sid,{success:!1,sc:f.data&&f.data.code||200,serviceName:t,responseTime:d,serverIp:e[E%e.length]}),!!(f.code!==M.OPERATION_ABORTED&&f.code!==M.UNEXPECTED_RESPONSE||f.data&&f.data.retry)&&(h=e[(E+1)%e.length],!0)),r)}let fI=1;function nM(e,t,i,n){let{url:r,areaCode:s}=e,{clientId:c,sid:l}=t,d=Date.now(),h,f=t.role,[E,S]=_I(t,s,[Fi.CHOOSE_SERVER]),y=Bi.networkState;return lo(async()=>{y&&Bi.networkState===aa.OFFLINE&&Bi.onlineWaiter&&await Ie.race([Bi.onlineWaiter,Sn(n&&n.maxRetryTimeout||zi.maxRetryTimeout)]),y=Bi.networkState;let{data:D,headers:O}=await mo(r,{data:E,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=O.http3==="1"?1:-1,He.reportResourceTiming(r,l),aM(D,r,t,d,[Fi.CHOOSE_SERVER],h);let N=qg(D,Fi.CHOOSE_SERVER);return mI(N),aI(N,r)},D=>(D&&He.joinChooseServer(l,{role:f,lts:d,succ:!0,csAddr:r,opid:S,serverList:D.gatewayAddrs.map(O=>O.address),ec:null,cid:D.cid.toString(),uid:D.uid.toString(),csIp:D.csIp,unilbsServerIds:[Fi.CHOOSE_SERVER].toString(),isHttp3:h,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:D.res.detail&&D.res.detail[38]}),!1),D=>D.code!==M.OPERATION_ABORTED&&(D.code===M.CAN_NOT_GET_GATEWAY_SERVER?D.data.retry:(He.joinChooseServer(l,{role:f,lts:d,succ:!1,csAddr:r,serverList:null,opid:S,ec:D.code,csIp:D.data&&D.data.csIp,unilbsServerIds:[Fi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:y}),isHttp3:h,corssRegionTagReq:t.apRequestDetail}),C.warning("[".concat(c||"sid-".concat(l.slice(0,6)),"] Choose server network error, retry"),D),!0)),n)}function rM(e,t,i,n){let r,{url:s,areaCode:c,serviceIds:l}=e,d=Date.now(),h=t.role,[f,E]=_I(t,c,l),S;return lo(async()=>{S&&Bi.networkState===aa.OFFLINE&&Bi.onlineWaiter&&await Ie.race([Bi.onlineWaiter,Sn(n&&n.maxRetryTimeout||zi.maxRetryTimeout)]),S=Bi.networkState;let{data:y,headers:D}=await mo(s,{data:f,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r=D.http3==="1"?1:-1,He.reportResourceTiming(s,t.sid),aM(y,s,t,d,l,r);let O=qg(y,Fi.CHOOSE_SERVER),N=qg(y,t.cloudProxyServer==="proxy5"?Fi.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Fi.CLOUD_PROXY:Fi.CLOUD_PROXY_FALLBACK),k=performance.getEntriesByName(s),U=k[k.length-1],B;return U&&(B={name:U.name,protocol:"nextHopProtocol"in U?U.nextHopProtocol:"",dnscost:"domainLookupEnd"in U&&"domainLookupStart"in U&&typeof U.domainLookupEnd=="number"&&typeof U.domainLookupStart=="number"?U.domainLookupEnd-U.domainLookupStart:-1,tcpTlsCost:"connectEnd"in U&&"connectStart"in U&&typeof U.connectEnd=="number"&&typeof U.connectStart=="number"?U.connectEnd-U.connectStart:-1,reqCost:"requestStart"in U&&typeof U.requestStart=="number"&&"responseEnd"in U&&typeof U.responseEnd=="number"?U.responseEnd-U.requestStart:-1,handleCost:"leave_ts"in y&&"enter_ts"in y&&typeof y.leave_ts=="number"&&typeof y.enter_ts=="number"?y.leave_ts-y.enter_ts:-1}),mI(O),{gatewayInfo:aI(O,s),proxyInfo:N,url:s,resourceTimingInfo:B}},y=>(y.gatewayInfo&&He.joinChooseServer(t.sid,{role:h,lts:d,succ:!0,csAddr:s,serverList:y.gatewayInfo.gatewayAddrs.map(D=>D.address),ec:null,opid:E,cid:y.gatewayInfo.cid.toString(),uid:y.gatewayInfo.uid.toString(),csIp:y.gatewayInfo.csIp,unilbsServerIds:l.toString(),isHttp3:r,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:y.gatewayInfo.res.detail&&y.gatewayInfo.res.detail[38],resourceTimingInfo:y.resourceTimingInfo?JSON.stringify(y.resourceTimingInfo):void 0}),y.proxyInfo&&He.joinWebProxyAP(t.sid,{lts:d,sucess:1,apServerAddr:s,turnServerAddrList:y.proxyInfo.addresses.map(D=>D.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:l.toString()}),!1),y=>y.code!==M.OPERATION_ABORTED&&(y.code===M.CAN_NOT_GET_GATEWAY_SERVER?y.data.retry:(He.joinWebProxyAP(t.sid,{lts:d,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:y.code,eventType:t.cloudProxyServer,unilbsServerIds:l.toString(),extend:JSON.stringify({networkState:S})}),C.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),y),!0)),n)}let aM=(e,t,i,n,r,s)=>{let{sid:c,clientId:l,cloudProxyServer:d}=i,h=[],f=E=>{E.flag===4096?He.joinChooseServer(c,{role:i.role,lts:n,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:E.error.message,csIp:E.error.data&&E.error.data.csIp,unilbsServerIds:r.toString(),isHttp3:s,corssRegionTagReq:i.apRequestDetail}):E.flag!==1048576&&E.flag!==4194304&&E.flag!==4194310||He.joinWebProxyAP(c,{lts:n,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:E.error.code,eventType:d,unilbsServerIds:r.toString()})};if(e.response_body.forEach(E=>{let S=E.buffer.code;if(E.uri===23&&S===0&&!E.buffer.edges_services)if(E.buffer.flag===4194310)C.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),E.buffer.edges_services=[];else{let y={error:new te(M.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:E.buffer.flag};h.push(y),f(y)}if(S!==0){let y=Am(S),D={error:new te(M.CAN_NOT_GET_GATEWAY_SERVER,y.desc,{desc:y.desc,retry:y.retry,csIp:e.detail[502]}),flag:E.buffer.flag};E.buffer.flag===4194310?C.warning(D.error.toString()):h.push(D),f(D)}}),h.length)throw C.warning("[".concat(l||"sid-".concat(c.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(h.map(E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message,", retry: ").concat(E.error.data.retry)).join(" | "))),new te(M.CAN_NOT_GET_GATEWAY_SERVER,h.map(E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message)).join(" | "),{retry:!!h.find(E=>E.error.data.retry),csIp:e.detail[502],desc:[...new Set(h.map(E=>{var S;return E==null||(S=E.error)===null||S===void 0||(S=S.data)===null||S===void 0?void 0:S.desc}).filter(E=>!!E))]})},mI=e=>{var t,i,n,r;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new te(M.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(j("AP_AREA")&&((n=e.detail)!==null&&n!==void 0&&n[23]&&typeof((r=e.detail)===null||r===void 0?void 0:r[23])=="string"?tM(e.detail[23].toLowerCase()):tM()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((i=e.detail)===null||i===void 0?void 0:i[19])=="string"){let c=e.detail[19],l=c?.split(";");for(let d=0;d<l.length;d++){var s;let h=rr(s=l[d]).call(s);e.addresses[d]&&l&&(e.addresses[d].fingerprint=h)}}if(j("GATEWAY_ADDRESS")&&j("GATEWAY_ADDRESS").length>0){C.debug("assign gateway address to",j("GATEWAY_ADDRESS"));let c=j("GATEWAY_ADDRESS").map(l=>{var d,h;let f=(d=(h=e.addresses.find(E=>E.ip===l.ip&&E.port===l.port))===null||h===void 0?void 0:h.fingerprint)!==null&&d!==void 0?d:"";return{ip:l.ip,port:l.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:f}});e.addresses=c}},g7=(e,t)=>{if(e.response_body&&e.response_body.length){let i=e.response_body[0];if(i.buffer.code!==0){let n=Am(i.buffer.code);throw new te(M.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(n.desc),{retry:n.retry})}return i.buffer.ticket}throw C.debug("update ticket request received ap response without response body:",t),new te(M.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},_I=(e,t,i)=>{let n=Math.floor(Math.random()*1e12),r=e.role==="host"?"1":e.role==="audience"?"2":void 0,s={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:pc(pc(pc({6:e.stringUid,11:t,12:j("USE_NEW_TOKEN")?"1":void 0},r?{17:r}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:i,uid:e.uid||0}}]};s.request_bodies.forEach(l=>{e.multiIP&&e.multiIP.gateway_ip&&(l.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});let c=new FormData;return c.append("request",JSON.stringify(s)),[c,n]},S7=(e,t)=>{let i=Math.floor(Math.random()*1e12),n={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(s=>({ip:s.ip,port:s.port}))}}]},r=new FormData;return r.append("request",JSON.stringify(n)),[r,i]},Nm=0;function Dm(e){return Ie.all(e.map(t=>t.then(i=>{throw i},i=>i))).then(t=>{throw t},t=>t)}let $g=async e=>{let{fragementLength:t,referenceList:i,asyncMapHandler:n,allFailedhandler:r,promisesCollector:s}=e,c=0,l=t,d,h=0,f=async()=>{let E=(()=>{let S=c*l,y=S+l;return i.slice(S,y).map(n)})();s&&s.push(...E);try{d=await Dm(E)}catch(S){if(h+=l,c++,!(h>=i.length))return void await f();r(S)}E.forEach(S=>S.cancel())};return await f(),d},sM=async e=>{let{referenceList:t,asyncMapHandler:i,closeFn:n}=e,r=t.length,s=0,c=async()=>{let l=i(t.shift());try{return await l}catch(d){if(s++,s>=r||n!=null&&n(d))throw d;return c()}};return c()};async function v7(){if(typeof VideoDecoder>"u")return!0;let e,t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],r=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],s=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],c=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new Ie((l,d)=>{let h;(async function(){e&&e.state!=="closed"||await(async function(){e=new VideoDecoder({output:E=>{E.close(),clearTimeout(h),l(!0)},error:E=>{clearTimeout(h),l(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})})();let f=[t,i,n,r,s,c];for(let E=0;E<f.length;E++){let S=new EncodedVideoChunk({type:E==0?"key":"delta",timestamp:33333*E,duration:33333,data:new Uint8Array(f[E])});try{await e.decode(S)}catch{return void l(!1)}}})(),h=setTimeout(()=>{l(!1)},5e3)})}async function EI(e,t,i,n){return{gatewayInfo:await(async function(r,s,c,l){let d=null,h=[],f=async()=>{let S=j("WEBCS_DOMAIN").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(O=>({url:r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(O+"/api/v2/transpond/webrtc?v=2"):"https://".concat(O,"/api/v2/transpond/webrtc?v=2"),areaCode:Qg()})),y=l.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(O=>O.url)}),D=await $g({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:O=>(C.debug("[".concat(r.clientId,"] Connect to choose_server:"),O.url),nM(O,r,s,c)),allFailedhandler:O=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},y),O[0]},promisesCollector:h});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},y),D},E=async()=>{if(await Sn(1e3),d!==null)return d;let S=j("WEBCS_DOMAIN_BACKUP_LIST").map(O=>({url:r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(O+"/api/v2/transpond/webrtc?v=2"):"https://".concat(O,"/api/v2/transpond/webrtc?v=2"),areaCode:Qg()})),y=l.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(O=>O.url)}),D=await $g({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:O=>(C.debug("[".concat(r.clientId,"] Connect to backup choose_server:"),O.url),nM(O,r,s,c)),allFailedhandler:O=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},y),O[0]},promisesCollector:h});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},y),D};try{return d=await Dm([f(),E()]),h.length&&h.forEach(S=>S.cancel&&typeof S.cancel=="function"&&S.cancel()),d}catch(S){throw S[0]}})(e,t,i,n)}}async function oM(e,t,i,n,r){let s=e.cloudProxyServer;if(s==="disabled"){if(e.useLocalAccessPoint)return await EI(e,t,i,r);if(j("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:S,proxyInfo:y}=await dM(e,t,i,r);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:S};let D=y.map(O=>({turnServerURL:O.address,tcpport:O.tcpport||Nn.tcpport,udpport:O.udpport||Nn.udpport,username:O.username||Nn.username,password:O.password||Nn.password,forceturn:!1,security:!0}));if(r.useP2P){var c;let O=(c=e.uid)!==null&&c!==void 0?c:S.uid,N="glb:".concat(O.toString()),k=await sw(N),U=y.map(B=>({turnServerURL:B.address,tcpport:B.tcpport||Nn.tcpport,udpport:B.udpport||Nn.udpport,username:N,password:k,forceturn:!1,security:!0}));D.push(...U)}return e.turnServer={mode:"manual",servers:D},{gatewayInfo:S}}return await EI(e,t,i,r)}let{proxyInfo:l,gatewayInfo:d}=await dM(e,t,i,r),h={gatewayInfo:d},f=l.map(S=>({turnServerURL:S.address,tcpport:s==="proxy3"?void 0:S.tcpport?S.tcpport:Nn.tcpport,udpport:s==="proxy4"?void 0:S.udpport?S.udpport:Nn.udpport,username:S.username||Nn.username,password:S.password||Nn.password,forceturn:s!=="proxy4",security:s==="proxy5"}));if(r.useP2P){var E;let S=(E=e.uid)!==null&&E!==void 0?E:d.uid,y="glb:".concat(S.toString()),D=await sw(y),O=l.map(N=>({turnServerURL:N.address,tcpport:s==="proxy3"?void 0:N.tcpport||Nn.tcpport,udpport:s==="proxy4"?void 0:N.udpport||Nn.udpport,username:y,password:D,forceturn:s!=="proxy4",security:s==="proxy5"}));f.push(...O)}return e.turnServer={mode:"manual",servers:f},C.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(s)),h}async function cM(e,t,i,n,r){let s=j("ACCOUNT_REGISTER").slice(0,j("AJAX_REQUEST_CONCURRENT")),c=[];c=t.proxyServer?s.map(d=>"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1")):s.map(d=>"https://".concat(d,"/api/v1"));let l=r?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:c});try{let d=await(async function(h,f,E,S,y){let D=Date.now(),O={sid:E.sid,opid:10,appid:E.appId,string_uid:f},N=h[0],k=await lo(()=>mo(N+"".concat(N.indexOf("?")===-1?"?":"&","action=stringuid"),{data:O,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(U,B)=>{if(U.code===0){if(U.uid<=0||U.uid>=Math.pow(2,32))throw C.error("Invalid Uint Uid ".concat(f," => ").concat(U.uid),U),He.reqUserAccount(O.sid,{lts:D,success:!1,serverAddr:N,stringUid:O.string_uid,uid:U.uid,errorCode:M.INVALID_UINT_UID_FROM_STRING_UID,extend:O}),new te(M.INVALID_UINT_UID_FROM_STRING_UID);return He.reqUserAccount(O.sid,{lts:D,success:!0,serverAddr:N,stringUid:O.string_uid,uid:U.uid,errorCode:null,extend:O}),!1}let J=Am(U.code);return J.retry&&(N=h[(B+1)%h.length]),He.reqUserAccount(O.sid,{lts:D,success:!1,serverAddr:N,stringUid:O.string_uid,uid:U.uid,errorCode:J.desc,extend:O}),J.retry},(U,B)=>U.code!==M.OPERATION_ABORTED&&(He.reqUserAccount(O.sid,{lts:D,success:!1,serverAddr:N,stringUid:O.string_uid,uid:null,errorCode:U.code,extend:O}),N=h[(B+1)%h.length],!0),y);if(k.code!==0){let U=Am(k.code);throw new te(M.UNEXPECTED_RESPONSE,U.desc)}return k})(c,e,t,i,n);return r?.recordJoinChannelService({status:"success",endTs:Date.now()},l),d.uid}catch(d){throw r?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[d]},l),d}}async function T7(e,t,i){let n=j("ACCOUNT_REGISTER"),r=[];r=t.proxyServer?n.map(s=>"https://".concat(t.proxyServer,"/ap/?url=").concat(s+"/api/v1")):n.map(s=>"https://".concat(s,"/api/v1"));try{return await sM({referenceList:r,asyncMapHandler:s=>(async function(c,l,d,h){let f=Date.now(),E={sid:d.sid,opid:10,appid:d.appId,string_uid:l};try{let S=await mo(c+"".concat(c.indexOf("?")===-1?"?":"&","action=stringuid"),{data:E,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(S.code!==0){let y=Am(S.code);throw new te(M.UNEXPECTED_RESPONSE,"preload sua error:".concat(y.desc),y)}if(S.uid<=0||S.uid>=Math.pow(2,32))throw new te(M.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:f,url:c,req:E,uid:S.uid,elapse:Date.now()-f}}catch(S){throw S}})(s,e,t,i),closeFn:s=>s.code===M.OPERATION_ABORTED||s.code===M.UNEXPECTED_RESPONSE&&!s.data.retry})}catch(s){throw s}}async function y7(e,t,i){let n=j("CDS_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(d=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1"):"https://".concat(d,"/api/v1?action=config")),r=n.map(d=>(function(h,f,E,S){let y=wt(),D={flag:64,cipher_method:0,features:pc(pc(pc(pc(pc({install_id:Ew(),device:y.name,system:y.os,system_general:navigator.userAgent,vendor:f.appId,version:Ya,cname:f.cname,session_id:f.sid,proxyServer:f.proxyServer,sdk_type:h7.WEB_RTC,browser_name:y.name,browser_version:y.version,user_agent:navigator.userAgent,channel_name:f.cname},f.stringUid&&{string_uid:f.stringUid}),f.uid&&{uid:f.uid+""}),y.os&&{os_name:y.os}),y.osVersion&&{os_version:y.osVersion}),{},{detail:""})};return lo(()=>mo(h,{data:D,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,O=>O.code!==M.OPERATION_ABORTED,S)})(d,e,t,i)),s=null,c=null,l={};try{s=await Dm(r)}catch(d){if(d.code===M.OPERATION_ABORTED)throw d;c=d}if(r.forEach(d=>d.cancel()),He.reportApiInvoke(e.sid,{name:Li.REQUEST_CONFIG_DISTRIBUTE,options:{error:c,res:s}}).onSuccess(),s&&s.test_tags)try{l=(function(d){if(!d.test_tags)return{};let h=d.test_tags,f=Object.keys(h),E={};return f.forEach(S=>{var y;let D=rr(y=S.slice(4)).call(y),O=JSON.parse(h[S]),N=O[1];E[D]={tag:O[0]||"",value:N}}),E})(s)}catch{}return l}async function lM(e,t){let i=j("WEBCS_DOMAIN").concat(j("WEBCS_DOMAIN_BACKUP_LIST")).map(n=>({url:"https://".concat(n,"/api/v2/transpond/webrtc?v=2"),areaCode:Qg(),serviceIds:[Fi.CHOOSE_SERVER,Fi.CLOUD_PROXY_FALLBACK]}));try{return await sM({referenceList:i,asyncMapHandler:n=>(async function(r,s,c){let l,{url:d,areaCode:h,serviceIds:f}=r,E=Date.now(),[S,y]=_I(s,h,f),D=Bi.networkState;try{D&&Bi.networkState===aa.OFFLINE&&Bi.onlineWaiter&&await Ie.race([Bi.onlineWaiter,Sn(zi.maxRetryTimeout)]),D=Bi.networkState;let{data:O,headers:N}=await mo(d,{data:S,cancelToken:c,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l=N.http3==="1"?1:-1,(B=>{let J=[];if(B.response_body.forEach(K=>{let H=K.buffer.code;if(K.uri===23&&H===0&&!K.buffer.edges_services)if(K.buffer.flag===4194310)K.buffer.edges_services=[];else{let ee={error:new te(M.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:B.detail[502]}),flag:K.buffer.flag};J.push(ee)}if(H!==0){let ee=Am(H),ue={error:new te(M.CAN_NOT_GET_GATEWAY_SERVER,ee.desc,{desc:ee.desc,retry:ee.retry,csIp:B.detail[502]}),flag:K.buffer.flag};K.buffer.flag===4194310?C.warning(ue.error.toString()):J.push(ue)}}),J.length)throw new te(M.CAN_NOT_GET_GATEWAY_SERVER,J.map(K=>"flag: ".concat(K.flag,", message: ").concat(K.error.message)).join(" | "),{retry:!!J.find(K=>K.error.data.retry),csIp:B.detail[502],desc:[...new Set(J.map(K=>{var H;return K==null||(H=K.error)===null||H===void 0||(H=H.data)===null||H===void 0?void 0:H.desc}).filter(K=>!!K))]})})(O);let k=qg(O,Fi.CHOOSE_SERVER),U=qg(O,Fi.CLOUD_PROXY_FALLBACK);return mI(k),{gatewayInfo:aI(k,d),proxyInfo:U,opid:y,requestTime:E,url:d,isHttp3:l,elapse:Date.now()-E}}catch(O){throw O}})(n,e,t),closeFn:n=>n.code===M.OPERATION_ABORTED||n.code===M.CAN_NOT_GET_GATEWAY_SERVER&&!n.data.retry})}catch(n){throw n}}async function dM(e,t,i,n){let r=j("PROXY_SERVER_TYPE3"),s=(y,D,O)=>{let N=O||r;return Array.isArray(N)&&(N=D%2==0&&r[1]||r[0]),"https://".concat(N,"/ap/?url=").concat(y)},c=null,l=[],d=async()=>{let y=j("WEBCS_DOMAIN").slice(0,j("AJAX_REQUEST_CONCURRENT")).map((N,k)=>{let U;return U=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(N,"/api/v2/transpond/webrtc?v=2"),k,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(N,"/api/v2/transpond/webrtc?v=2"):s("".concat(N,"/api/v2/transpond/webrtc?v=2"),k),{url:U,areaCode:Qg(),serviceIds:[Fi.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Fi.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Fi.CLOUD_PROXY:Fi.CLOUD_PROXY_FALLBACK]}}),D=n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(N=>N.url)}),O=await $g({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:N=>(C.debug("[".concat(e.clientId,"] Connect to choose_server:"),N.url),rM(N,e,t,i)),allFailedhandler:N=>{throw n.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},D),N[0]},promisesCollector:l});return n.recordJoinChannelService({endTs:Date.now(),status:"success"},D),O},h=async()=>{if(await Sn(1e3),c!==null)return c;let y=j("WEBCS_DOMAIN_BACKUP_LIST").map((N,k)=>{let U;return U=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(N,"/api/v2/transpond/webrtc?v=2"),k,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(N,"/api/v2/transpond/webrtc?v=2"):s("".concat(N,"/api/v2/transpond/webrtc?v=2"),k),{url:U,areaCode:Qg(),serviceIds:[Fi.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Fi.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Fi.CLOUD_PROXY:Fi.CLOUD_PROXY_FALLBACK]}}),D=n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(N=>N.url)}),O=await $g({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:N=>(C.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),N.url),rM(N,e,t,i)),allFailedhandler:N=>{throw n.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},D),N[0]},promisesCollector:l});return n.recordJoinChannelService({endTs:Date.now(),status:"success"},D),O},f,E,S;try{({gatewayInfo:f,proxyInfo:E,url:S}=await Dm([d(),h()]))}catch(y){throw y[0]}if(l.length&&l.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),!f||!E)throw new te(M.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=S,e.cloudProxyServer!=="disabled"&&Array.isArray(r)&&S){let y=/^https?:\/\/(.+?)(\/.*)?$/.exec(S)[1];Ce(r).call(r,y)&&(e.proxyServer=y,C.setProxyServer(y),He.setProxyServer(y))}return c={gatewayInfo:f,proxyInfo:await xk(E,f.uid)},c}async function R7(e,t,i){let n=j("UAP_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(s=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")),r=n.map(s=>(function(c,l,d,h){let f={command:"convergeAllocateEdge",sid:l.sid,appId:l.appId,token:l.token,ts:Date.now(),version:Ya,cname:l.cname,uid:l.uid.toString(),requestId:fI,seq:fI};fI+=1;let E={service_name:"tele_channel",json_body:JSON.stringify(f)};return lo(async()=>{let S=await mo(c,{data:E,cancelToken:d,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(S.code!==0){let D=new te(M.UNEXPECTED_RESPONSE,"cross channel ap error, code"+S.code,{retry:!0});throw C.error(D.toString()),D}let y=JSON.parse(S.json_body);if(y.code!==200){let D=new te(M.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(y.code,", reason: ").concat(y.reason));throw C.error(D.toString()),D}if(!y.servers||y.servers.length===0){let D=new te(M.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw C.error(D.toString()),D}return{vid:y.vid,workerToken:y.workerToken,addressList:(j("CHANNEL_MEDIA_RELAY_SERVERS")||y.servers).map(D=>"wss://".concat(D.address.replace(/\./g,"-"),".").concat(j("WORKER_DOMAIN"),":").concat(D.wss))}},void 0,S=>!!(S.code!==M.OPERATION_ABORTED&&S.code!==M.UNEXPECTED_RESPONSE||S.data&&S.data.retry),h)})(s,e,t,i));try{let s=await Dm(r);return r.forEach(c=>c.cancel()),s}catch(s){throw s[0]}}async function C7(e,t,i){let n=null,r=[],s=async c=>{let l=j(c?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(d=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v2/transpond/webrtc?v=2"):"https://".concat(d,"/api/v2/transpond/webrtc?v=2"));return c&&(await Sn(1e3),n!==null)?n:await $g({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:d=>(C.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(c?"backup":""," choose_server:"),d),(function(h,f,E,S){let[y]=S7(f,[Fi.CHOOSE_SERVER]),D=Bi.networkState;return lo(async()=>{D&&Bi.networkState===aa.OFFLINE&&Bi.onlineWaiter&&await Ie.race([Bi.onlineWaiter,Sn(S&&S.maxRetryTimeout||zi.maxRetryTimeout)]),D=Bi.networkState;let O=await mo(h,{data:y,cancelToken:E,headers:{"Content-Type":"multipart/form-data;"}},!0);return g7(O,h)},()=>!1,O=>O.code!==M.OPERATION_ABORTED&&(O.code===M.UPDATE_TICKET_FAILED?O.data.retry:(C.warning("[".concat(f.clientId,"] update ticket network error, retry"),O),!0)),S)})(d,e,t,i)),allFailedhandler:d=>{throw d[0]},promisesCollector:r})};try{return n=await Dm([s(!1),s(!0)]),r.length&&r.forEach(c=>c.cancel&&typeof c.cancel=="function"&&c.cancel()),n}catch(c){throw c[0]}}function uM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function gI(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?uM(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):uM(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}class b7 extends vi{get isSuccess(){return!!this.configs}constructor(t,i){super(),L(this,"configs",void 0),L(this,"store",void 0),L(this,"joinInfo",void 0),L(this,"cancelToken",void 0),L(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),L(this,"interval",void 0),L(this,"mutex",void 0),L(this,"mutableParamsRead",!1),L(this,"configCache",{}),L(this,"limit_bitrate",void 0),this.mutex=new Vn("config-distribute",t),this.store=i}startGetConfigDistribute(t,i){this.joinInfo=t,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),j("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},j("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,He.reportApiInvoke(null,{options:void 0,name:Li.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:_i.TRACER}).onSuccess(JSON.stringify(uo))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void C.debug("[config-distribute] get config distribute interrupted have no joininfo");let t,i=await this.mutex.lock();try{t=await y7(this.joinInfo,this.cancelToken,this.retryConfig),C.debug("[config-distribute] get config distribute",JSON.stringify(t));let n=(function(r){var s;let c=lt(s=Object.keys(r).filter(h=>/^webrtc_ng_global_parameter/.test(h))).call(s);for(let h=0;h<c.length;h++)for(let f=c.length-1;f>h;f--){let E=c[f],S=r[E].value;if(typeof S.__priority=="number"){let y=S.__priority,D=c[f-1],O=r[D].value;if(typeof O.__priority=="number"){if(!(y>O.__priority))continue;{let N=E;c[f]=c[f-1],c[f-1]=N}}else{let N=E;c[f]=c[f-1],c[f-1]=N}}}let l=Date.now(),d={};return c.forEach(h=>{let f=r[h].value.__expires;f&&f<=l||(d[h]=r[h])}),d})(t);this.cacheGlobalParameterConfig(n),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=n}catch(n){let r=new te(M.NETWORK_RESPONSE_ERROR,n);C.warning("[config-distribute] ".concat(r.toString()))}finally{i()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){Rk(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(zg.UPDATE_BITRATE_LIMIT,t):this.emit(zg.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&gI({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{let i={},n=Object.keys(t),r=[];n.forEach(s=>{let c=t[s].value;i[s]=c;let l=c.__id;if(l&&this.configCache[s]&&this.configCache[s].__id===l)return;let d=c.__type,h=t[s].value,f=t[s].tag,E=0;d?d===YL.REALTIME&&(E=1):Object.keys(h).some(S=>Object.prototype.hasOwnProperty.call(Tw,S)||!qw()&&Object.prototype.hasOwnProperty.call(Ey,S)?(E=1,!0):void 0),r.push({tag:f,isApplied:E,feature:s,params:JSON.stringify(c)})}),r.forEach(s=>{let{tag:c,feature:l,params:d,isApplied:h}=s;this.store.sessionId&&He.abTest(this.store.sessionId,{intSucc:1,isApplied:h,tag:c,feature:l,params:d,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=i}catch(i){C.debug("handleABTestConfigDistribute error",i)}}cacheGlobalParameterConfig(t){let i=(function(r){let s={};return Object.keys(r).forEach(c=>{let l=r[c].value,d=l.__expires,h=l.__type;Object.keys(l).forEach(f=>{f==="__id"||f==="__type"||f==="__priority"||f==="__expires"||Object.prototype.hasOwnProperty.call(s,f)||(s[f]=gI(gI({value:l[f]},d&&{expires:d}),h&&{type:h}))})}),s})(t);try{var n;let r=(n=i.LIMIT_BITRATE)===null||n===void 0?void 0:n.value;delete i.LIMIT_BITRATE,r&&Rk(r)&&this.handleBitrateLimit(r),this.limit_bitrate=r,this.handleGlobalParameterConfig(i),this.handleABTestConfigDistribute(t),(function(l){try{let d=Date.now();Object.keys(l).forEach(h=>{let{value:f,type:E,expires:S}=l[h];S&&S<=d||((E===YL.REALTIME||Object.prototype.hasOwnProperty.call(Tw,h))&&(uo[h]=f,pi[h]=f,C.debug("Update realtime parameters from config distribute",h,f)),E||qw()||!Object.prototype.hasOwnProperty.call(Ey,h)||(uo[h]=f,pi[h]=f,C.debug("Update gateway parameters from config distribute",h,f)))})}catch(d){C.error("Error update config immediately: ".concat(l),d.message)}})(i);let s=JSON.stringify(i),c=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",c),C.debug("Caching global parameters ".concat(s))}catch(r){C.error("Error caching global parameters:",r.message)}}handleGlobalParameterConfig(t){try{let i=Date.now();Object.keys(t).forEach(n=>{if(n==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(pi,n)){let{value:r,expires:s}=t[n];if(s&&s<=i)return;(function(c,l){try{return typeof c=="object"&&typeof l=="object"&&JSON.stringify(c)===JSON.stringify(l)}catch{return!1}})(pi[n],r)||(uo[n]=r,pi[n]=r,this.emit(zg.UPDATE_CLIENT_ROLE_OPTIONS,r),C.debug("Updating client role options: ".concat(JSON.stringify(r))))}})}catch(i){C.error("Error handling global parameter config:",i.message)}}}class A7 extends vi{constructor(){super(...arguments),L(this,"resultStorage",new Map)}setLocalAudioStats(t,i,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(n,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(n,i))}setLocalVideoStats(t,i,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(n,i)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(n,i)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(n)),!i.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(n))}setRemoteAudioStats(t,i){let n=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(i))}setRemoteVideoStats(t,i){let n=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(i))}record(t,i,n){if(j("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});let r=this.resultStorage.get(t);if(!r)return;r.result.push(n);let s=t==="VIDEO_ENCODE_FAILED"?j("ENCODE_EXCEPTION_TIMES"):5;if(r.result.length>=s){var c;let l=Ce(c=r.result).call(c,!0);r.isPrevNormal&&!l&&this.emit("exception",SI[t],t,i),!r.isPrevNormal&&l&&this.emit("exception",SI[t]+2e3,t+"_RECOVER",i),r.isPrevNormal=l,r.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,i){return i instanceof Ji&&!i.isActive||!!i.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,i){let n=null;i._encoderConfig&&i._encoderConfig.frameRate&&(n=sa(i._encoderConfig.frameRate));let r=t.captureFrameRate;return!n||!r||!(n>10&&r<5||n<10&&n>=5&&r<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var i;return!(!t.codecType||Ce(i=j("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(i,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,i){return!!i.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,i){return i instanceof Ji&&!i.isActive||!!i.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}let SI={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},Gn=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){let i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(i.length>0){let n=i[i.length-1];return Math.round(performance.now()-n.startTime)}return 0}measureFromPublishStart(e,t){let i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(i.length>0){let n=i[i.length-1];return Math.round(performance.now()-n.startTime)}return 0}};function hM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function Fh(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?hM(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):hM(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}class e0{constructor(t){L(this,"store",void 0),L(this,"onStatsException",void 0),L(this,"onUploadPublishDuration",void 0),L(this,"onStatsChanged",void 0),L(this,"onVideoCodecChanged",void 0),L(this,"localStats",new Map),L(this,"remoteStats",new Map),L(this,"updateStatsInterval",void 0),L(this,"trafficStats",void 0),L(this,"trafficStatsPeerList",[]),L(this,"uplinkStats",void 0),L(this,"exceptionMonitor",void 0),L(this,"p2pChannel",void 0),L(this,"scalabilityMode",_y.L1T1),L(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new A7,this.exceptionMonitor.on("exception",(i,n,r)=>{this.onStatsException&&this.onStatsException(i,n,r)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ge.LocalAudioTrack)||Fh({},ww)}getLocalVideoTrackStats(){return this.localStats.get(ge.LocalVideoTrack)||Fh({},Iw)}getRemoteAudioTrackStats(t){let i=(s,c)=>{if(!this.trafficStats)return c;let l=this.trafficStats.peer_delay.find(d=>d.peer_uid===s);return l&&(c.publishDuration=l.B_ppad+(Date.now()-this.trafficStats.timestamp)),c},n={};if(t){var r;let s=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.audioStats;s&&(n[t]=i(t,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[c,{audioStats:l}]=s;l&&(n[c]=i(c,l))});return n}getRemoteNetworkQualityStats(t){let i={};if(t){var n;let r=(n=this.remoteStats.get(t))===null||n===void 0?void 0:n.networkStats;r&&(i[t]=r)}else Array.from(this.remoteStats.entries()).forEach(r=>{let[s,{networkStats:c}]=r;c&&(i[s]=c)});return i}getRemoteVideoTrackStats(t){let i=(s,c)=>{if(!this.trafficStats)return c;let l=this.trafficStats.peer_delay.find(d=>d.peer_uid===s);return l&&(c.publishDuration=l.B_ppvd+(Date.now()-this.trafficStats.timestamp)),c},n={};if(t){var r;let s=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.videoStats;s&&(n[t]=i(t,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[c,{videoStats:l}]=s;l&&(n[c]=i(c,l))});return n}getRTCStats(){let t=0,i=0,n=0,r=0,s=this.localStats.get(ge.LocalAudioTrack);s&&(t+=s.sendBytes,i+=s.sendBitrate);let c=this.localStats.get(ge.LocalVideoTrack);c&&(t+=c.sendBytes,i+=c.sendBitrate);let l=this.localStats.get(ge.LocalVideoLowTrack);l&&(t+=l.sendBytes,i+=l.sendBitrate),this.remoteStats.forEach(h=>{let{audioStats:f,videoStats:E}=h;f&&(n+=f.receiveBytes,r+=f.receiveBitrate),E&&(n+=E.receiveBytes,r+=E.receiveBitrate)});let d=1;return this.trafficStats&&(d+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:d,SendBitrate:i,SendBytes:t,RecvBytes:n,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),t.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var n;let r=(n=this.p2pChannel)===null||n===void 0?void 0:n.getRemoteMedia(i.peer_uid),s=r!=null&&r.videoSSRC?Gn.measureFromSubscribeStart(this.store.clientId,r.videoSSRC):0,c=r!=null&&r.audioSSRC?Gn.measureFromSubscribeStart(this.store.clientId,r.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,s>c?s:c),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&C.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,i,n){if(!t)return!1;let r=!!n&&i.framesDecodeFreezeTime>n.framesDecodeFreezeTime,s=!n||i.framesDecodeCount>n.framesDecodeCount;return r||!s}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(i=>{let[n,r]=i;switch(n){case ge.LocalVideoTrack:case ge.LocalVideoLowTrack:{let l=r,d=Fh({},Iw),h=t.getStats(),f=t.getLocalMedia(n);if(h){let E=h.videoSend.find(S=>S.ssrc===f?.ssrcs[0].ssrcId);if(E){let S=t.getLocalVideoSize(),y=t.getEncoderConfig(ge.LocalVideoTrack);var s;(E.codec==="H264"||E.codec==="H265"||E.codec==="VP8"||E.codec==="VP9"||E.codec==="AV1X"||E.codec==="AV1")&&(d.codecType=E.codec,l?.codecType!==E.codec&&((s=this.onVideoCodecChanged)===null||s===void 0||s.call(this,E.codec.toLocaleLowerCase()))),d.sendBytes=E.bytes,d.sendBitrate=l?8*Math.max(0,d.sendBytes-l.sendBytes):0,E.inputFrame?(d.captureFrameRate=E.inputFrame.frameRate,d.captureResolutionHeight=E.inputFrame.height,d.captureResolutionWidth=E.inputFrame.width):S&&(d.captureResolutionWidth=S.width,d.captureResolutionHeight=S.height),E.sentFrame?(d.sendFrameRate=E.sentFrame.frameRate,d.sendResolutionHeight=E.sentFrame.height,d.sendResolutionWidth=E.sentFrame.width):S&&(d.sendResolutionWidth=S.width,d.sendResolutionHeight=S.height),E.avgEncodeMs&&(d.encodeDelay=E.avgEncodeMs),y&&y.bitrateMax?d.targetSendBitrate=1e3*y.bitrateMax:E.targetBitrate&&(d.targetSendBitrate=E.targetBitrate),d.sendPackets=E.packets,d.sendPacketsLost=E.packetsLost,d.sendJitterMs=E.jitterMs,d.sendRttMs=E.rttMs,d.totalDuration=l?l.totalDuration+1:1,d.totalFreezeTime=l?l.totalFreezeTime:0,this.isLocalVideoFreeze(E)&&(d.totalFreezeTime+=1),E.scalabilityMode&&this.scalabilityMode!==E.scalabilityMode&&(C.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(E.scalabilityMode)),this.scalabilityMode=E.scalabilityMode)}this.trafficStats&&(d.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var c;this.localStats.set(n,d),(l?.sendResolutionWidth!==d.sendResolutionWidth||l?.sendResolutionHeight!==d.sendResolutionHeight)&&((c=this.onStatsChanged)===null||c===void 0||c.call(this,"resolution",{width:d.sendResolutionWidth,height:d.sendResolutionHeight})),d&&f&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,f.track,d);break}case ge.LocalAudioTrack:{let l=r,d=Fh({},ww),h=t.getStats(),f=t.getLocalMedia(n);if(h){let E=h.audioSend.find(S=>S.ssrc===f?.ssrcs[0].ssrcId);if(E){if(E.codec!=="opus"&&E.codec!=="aac"&&E.codec!=="PCMU"&&E.codec!=="PCMA"&&E.codec!=="G722"||(d.codecType=E.codec),E.inputLevel)d.sendVolumeLevel=Math.round(32767*E.inputLevel);else{let S=t.getLocalAudioVolume();S&&(d.sendVolumeLevel=Math.round(32767*S))}d.sendBytes=E.bytes,d.sendPackets=E.packets,d.sendPacketsLost=E.packetsLost,d.sendJitterMs=E.jitterMs,d.sendRttMs=E.rttMs,d.sendBitrate=l?8*Math.max(0,d.sendBytes-l.sendBytes):0}}this.trafficStats&&(d.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ge.LocalAudioTrack,d),d&&f&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,f.track,d);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(i=>{var n,r;let[s,{videoStats:c,audioStats:l,videoPcStats:d}]=i,h=l,f=c,E=d,S=Fh({},rP),y=Fh({},aP),D=Fh({},lF),{audioTrack:O,videoTrack:N,audioSSRC:k,videoSSRC:U}=t.getRemoteMedia(s),B;B=this.store.useP2P?t.getStats(!0):t.getStats();let J=(n=B)===null||n===void 0?void 0:n.audioRecv.find(ue=>ue.ssrc===k),K=(r=B)===null||r===void 0?void 0:r.videoRecv.find(ue=>ue.ssrc===U),H=this.trafficStats&&this.trafficStats.peer_delay.find(ue=>ue.peer_uid===s);if(J&&(J.codec!=="opus"&&J.codec!=="aac"&&J.codec!=="PCMU"&&J.codec!=="PCMA"&&J.codec!=="G722"||(S.codecType=J.codec),J.outputLevel?S.receiveLevel=Math.round(32767*J.outputLevel):O&&(S.receiveLevel=Math.round(32767*O.getVolumeLevel())),S.receiveBytes=J.bytes,S.receivePackets=J.packets,S.receivePacketsLost=J.packetsLost,S.receivePacketsDiscarded=J.packetsDiscarded,S.packetLossRate=S.receivePacketsLost/(S.receivePackets+S.receivePacketsLost),S.receiveBitrate=h?8*Math.max(0,S.receiveBytes-h.receiveBytes):0,S.totalDuration=h?h.totalDuration+1:1,S.totalFreezeTime=h?h.totalFreezeTime:0,S.freezeRate=S.totalFreezeTime/S.totalDuration,S.receiveDelay=J.jitterBufferMs,S.totalDuration>10&&e0.isRemoteAudioFreeze(O)&&(S.totalFreezeTime+=1)),K){var ee;K.codec!=="H264"&&K.codec!=="H265"&&K.codec!=="VP8"&&K.codec!=="VP9"&&K.codec!=="AV1X"&&K.codec!=="AV1"||(y.codecType=K.codec),y.receiveBytes=K.bytes,y.receiveBitrate=f?8*Math.max(0,y.receiveBytes-f.receiveBytes):0,y.decodeFrameRate=K.decodeFrameRate<0?0:K.decodeFrameRate,y.renderFrameRate=K.decodeFrameRate<0?0:K.decodeFrameRate,K.outputFrame&&(y.renderFrameRate=K.outputFrame.frameRate),K.receivedFrame?(y.receiveFrameRate=K.receivedFrame.frameRate,y.receiveResolutionHeight=K.receivedFrame.height,y.receiveResolutionWidth=K.receivedFrame.width):N&&(y.receiveResolutionHeight=N._videoHeight||0,y.receiveResolutionWidth=N._videoWidth||0),K.framesRateFirefox!==void 0&&(y.receiveFrameRate=Math.round(K.framesRateFirefox)),y.receivePackets=K.packets,y.receivePacketsLost=K.packetsLost,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost);let ue=f?f.totalFreezeTime:0,me=f?f.totalDuration:0;y.totalDuration=f?f.totalDuration+1:1,y.totalFreezeTime=(ee=K.totalFreezesDuration)!==null&&ee!==void 0?ee:ue||0,y.receiveDelay=K.jitterBufferMs||0;let ye=!!U&&t.getRemoteVideoIsReady(U);K.totalFreezesDuration===void 0&&N&&ye&&e0.isRemoteVideoFreeze(N,K,E)&&(y.totalFreezeTime+=1),y.freezeRate=Math.max(0,Math.min((y.totalFreezeTime-ue)/(y.totalDuration-me),1))}H&&(S.end2EndDelay=H.B_ad,y.end2EndDelay=H.B_vd,S.transportDelay=H.B_ed,y.transportDelay=H.B_ed,S.currentPacketLossRate=H.B_ealr4/100,y.currentPacketLossRate=H.B_evlr4/100,D.uplinkNetworkQuality=H.B_punq?H.B_punq:0,D.downlinkNetworkQuality=H.B_pdnq?H.B_pdnq:0),this.remoteStats.set(s,{audioStats:S,videoStats:y,videoPcStats:K,networkStats:D}),O&&this.exceptionMonitor.setRemoteAudioStats(O,S),N&&this.exceptionMonitor.setRemoteVideoStats(N,y)})}}class pM{constructor(){L(this,"destChannelMediaInfos",new Map),L(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){Tk(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){Tk(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){My(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function fM(e){if(!(e instanceof pM))return new te(M.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo(),i=e.getDestChannelMediaInfo();if(!t)return new te(M.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new te(M.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Jd{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,i){L(this,"uid",void 0),L(this,"_uintid",void 0),L(this,"_trust_in_room_",!0),L(this,"_trust_audio_enabled_state_",!0),L(this,"_trust_video_enabled_state_",!0),L(this,"_trust_audio_mute_state_",!0),L(this,"_trust_video_mute_state_",!0),L(this,"_audio_muted_",!1),L(this,"_video_muted_",!1),L(this,"_audio_enabled_",!0),L(this,"_video_enabled_",!0),L(this,"_audio_added_",!1),L(this,"_video_added_",!1),L(this,"_is_pre_created",!1),L(this,"_video_pre_subscribed",!1),L(this,"_audio_pre_subscribed",!1),L(this,"_trust_video_stream_added_state_",!0),L(this,"_trust_audio_stream_added_state_",!0),L(this,"_audioTrack",void 0),L(this,"_videoTrack",void 0),L(this,"_dataChannels",[]),L(this,"_audioSSRC",void 0),L(this,"_videoSSRC",void 0),L(this,"_audioOrtc",void 0),L(this,"_videoOrtc",void 0),L(this,"_cname",void 0),L(this,"_rtxSsrcId",void 0),L(this,"_videoMid",void 0),L(this,"_audioMid",void 0),this.uid=t,this._uintid=i}}function mM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function vI(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?mM(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):mM(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}let Zy="9",TI=2e4,Qy=4e4;function _M(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function vl(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?_M(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_M(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var Lm=(function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e})(Lm||{});let $y=new Map;function EM(e,t,i,n){let{scale:r}=e;if(r===0&&n===Lm.UP||r>=t.length-1&&n===Lm.DOWN)return e;let s=vl(vl({},e),{},{scale:n===Lm.DOWN?++r:--r});switch(i){case"maintain-framerate":s=vl(vl({},s),t[r].motion);break;case"maintain-resolution":s=vl(vl({},s),t[r].detail);break;case"balanced":s=vl(vl({},s),t[r].balanced)}return s}function gM(e,t){if(t){let i={overUse:0,underUse:0,adaptationList:SM(t)};$y.set(e,i)}else $y.delete(e)}function SM(e){let t=vl({},e),{bitrateMax:i,frameRate:n,scaleResolutionDownBy:r,bitrateMin:s}=t,{MIN_FRAME_RATE:c,MAX_THRESHOLD_FRAMERATE:l,MAX_SCALE:d,BITRATE_MIN_THRESHOLD:h,BITRATE_MAX_THRESHOLD:f,BWE_SCALE_UP_THRESHOLD:E,BWE_SCALE_DOWN_THRESHOLD:S,PERF_SCALE_DOWN_THRESHOLD:y,PERF_SCALE_UP_THRESHOLD:D,BALANCE_BITRATE_FACTOR:O,BALANCE_FRAMERATE_FACTOR:N,BALANCE_RESOLUTION_FACTOR:k,MOTION_RESOLUTION_FACTOR:U,MOTION_BITRATE_FACTOR:B,DETAIL_FRAMERATE_FACTOR:J,DETAIL_BITRATE_FACTOR:K}=Sw,H=Math.min(t.frameRate,l),ee=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(S,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(y,1)*H),fps_up:n},balanced:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:i,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:i,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:i,bitrateMin:s}}];for(let ue=1;ue<=d;ue++){let me={bwe_up:Math.round(Math.pow(E,ue)*i),bwe_down:Math.round(Math.pow(S,ue+1)*i),fps_up:Math.round(Math.pow(D,ue)*H),fps_down:Math.round(Math.pow(y,ue+1)*H)},ye={scaleResolutionDownBy:r/Math.pow(k,ue),frameRate:Math.max(Math.round(Math.pow(N,ue)*n),c),bitrateMax:Math.max(Math.round(Math.pow(O,ue)*i),f),bitrateMin:Math.max(Math.round(Math.pow(O,ue)*s),h)},pt={scaleResolutionDownBy:r/Math.pow(U,ue),frameRate:n,bitrateMax:Math.max(Math.round(Math.pow(B,ue)*i),f),bitrateMin:Math.max(Math.round(Math.pow(B,ue)*s),h)},mt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(J,ue)*n),c),bitrateMax:Math.max(Math.round(Math.pow(K,ue)*i),f),bitrateMin:Math.max(Math.round(Math.pow(K,ue)*s),h)};ee.push({scale:ue,threshold:me,balanced:ye,motion:pt,detail:mt})}return ee}function w7(e,t,i,n,r,s){let c=$y.get(e)||{overUse:0,underUse:0,adaptationList:SM(r)},{adaptationList:l}=c;$y.set(e,c);let{OVERUSE_TIMES_THRESHOLD:d,UNDERUSE_TIMES_THRESHOLD:h}=Sw,{scale:f}=n,E,S;return typeof t=="number"&&t>0&&(function(y,D,O,N){if(D>=O.length)return!1;let{threshold:{fps_down:k}}=O[D];return j("FORCE_AG_HIGH_FRAMERATE")&&N==="maintain-framerate"&&(k=O[0].threshold.fps_down),y<k})(t,f,l,s)&&(c.overUse++,S=Ug.CPU,c.overUse>d)||typeof i=="number"&&i>0&&(function(y,D,O){if(D>=O.length)return!1;let{threshold:{bwe_down:N}}=O[D];return y<N})(i,f,l)&&(c.overUse++,S=Ug.BANDWIDTH,c.overUse>d)?(c.overUse=0,c.underUse=0,E=EM(n,l,s,Lm.DOWN),[E,S]):(typeof t=="number"&&t>0&&typeof i=="number"&&i>0&&(function(y,D,O,N){if(D===0)return;let{threshold:{fps_up:k}}=O[D];return j("FORCE_AG_HIGH_FRAMERATE")&&N==="maintain-framerate"&&(k=O[1].threshold.fps_up),y>k})(t,f,l,s)&&(function(y,D,O){if(D===0)return;let{threshold:{bwe_up:N}}=O[D];return y>N})(i,f,l)&&(c.underUse++,c.underUse>h&&(c.overUse=0,c.underUse=0,E=EM(n,l,s,Lm.UP),E.scale===0&&(S=Ug.NONE))),[E,S])}function vM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function yI(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?vM(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):vM(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}let eR=new Map;function tR(e,t){let i=eR.get(e);if(i){let{timer:n}=i;window.clearTimeout(n),eR.delete(e)}t.qualityLimitationReason=Ug.NONE,gM(e)}function I7(e,t){var i;let n;switch(t){case ge.LocalAudioTrack:n=Wt.Audio;break;case ge.LocalVideoTrack:n=Ce(i=e._hints).call(i,Zt.SCREEN_TRACK)?Wt.Screen:Wt.High;break;case ge.LocalVideoLowTrack:n=Wt.Low}return n}function RI(e){let t=Lt();if(e.some(i=>i._bypassWebAudio))throw new de(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new de(M.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function CI(e,t){RI(e);let i=new Ji;return e.forEach(n=>i.addAudioTrack(n)),i}let O7=!Lt().supportUnifiedPlan||j("CHROME_FORCE_PLAN_B")&&fl();function iR(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;return O7?(i={spec:t,store:e},Sl("PlanBConnection").create(i)):new Qa(t,e)}function bI(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function TM(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(xg(e.turnServer.servers))return!1;if(j("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var It;function yM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function _o(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?yM(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):yM(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}let Qa=(It=class ep extends bk{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,i;return(t=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var i;return Ce(i=Object.keys(jg)).call(i,t)}))]}constructor(t,i){super(t,i),L(this,"id",ei(5,"connection-")),L(this,"store",void 0),L(this,"peerConnection",void 0),L(this,"forceTurn",!1),L(this,"remoteSDP",void 0),L(this,"initialOffer",void 0),L(this,"transportEventReceiver",void 0),L(this,"statsFilter",void 0),L(this,"extension",{useXR:j("USE_XR")}),L(this,"localCapabilities",void 0),L(this,"remoteCodecs",void 0),L(this,"localCandidateCount",0),L(this,"allCandidatesReceived",!1),L(this,"isPreallocation",!1),L(this,"preMediaMap",new Map),L(this,"dataStreamChannelMap",new Map),L(this,"establishPromise",void 0),L(this,"recoveredDataChannelIds",[]),L(this,"currentDataChannelId",1),L(this,"supportAV1RtpSpec",!1),L(this,"mutex",void 0),L(this,"qualityLimitationReason",Ug.NONE),L(this,"isFirstConnected",!1),this.store=i,this.forceTurn=TM(t),this.mutex=new Vn("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(ep.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=_w(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,bi()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,i){if(this.remoteCodecs=i,!this.remoteSDP)return void C.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(t,i,this.store.codec)){let n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n);let s=this.remoteSDP.toString();r?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else C.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let r=Kd(n.sdp),s=await Wk({filterRTX:!j("USE_PUB_RTX")&&!j("USE_SUB_RTX"),filterVideoFec:j("FILTER_VIDEO_FEC"),filterAudioFec:j("FILTER_AUDIO_FEC"),filterVideoCodec:j("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:j("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:j("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=Ky(s),this.initialOffer=n,j("ENABLE_SVC")&&this.store.codec=="av1"){let l=await(async function(){try{let d=new RTCPeerConnection;d.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:_y.L1T3}]});let h=await d.createOffer();if(!h.sdp)return void d.close();let f=Br(h.sdp).mediaDescriptions[0];if(!f)return;let E=f.attributes.extmaps.find(S=>S.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return d.close(),E}catch{return}})();var t;l&&(this.supportAV1RtpSpec=!0,(t=s.send)===null||t===void 0||t.videoExtensions.push(l))}let c;return n.sdp&&qk(n.sdp)&&(c=Ei(s),(i=c).send&&(wm(ke.VIDEO,i.send.videoExtensions),wm(ke.AUDIO,i.send.audioExtensions)),i.recv&&(wm(ke.VIDEO,i.recv.videoExtensions),wm(ke.AUDIO,i.recv.audioExtensions)),i.sendrecv&&(wm(ke.VIDEO,i.sendrecv.videoExtensions),wm(ke.AUDIO,i.sendrecv.audioExtensions))),_o(_o({},r),{},{rtpCapabilities:c||s,offerSDP:n.sdp})}catch(n){throw new de(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}var i}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&qk(this.initialOffer.sdp)&&(i=t.rtpCapabilities,n=this.localCapabilities,i.send&&(Hy(ke.VIDEO,i.send.videoExtensions,n.send.videoExtensions),Hy(ke.AUDIO,i.send.audioExtensions,n.send.audioExtensions)),i.recv&&(Hy(ke.VIDEO,i.recv.videoExtensions,n.recv.videoExtensions),Hy(ke.AUDIO,i.recv.audioExtensions,n.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Ei(this._localCapabilities)}get rtpCapabilities(){return Ei(this._rtpCapabilities)}get candidates(){return Ei(this._candidates)}get iceParameters(){return Ei(this._iceParameters)}get dtlsParameters(){return Ei(this._dtlsParameters)}constructor(d){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1],f=arguments.length>2&&arguments[2]!==void 0&&arguments[2];L(this,"sessionDesc",void 0),L(this,"_localCapabilities",void 0),L(this,"_rtpCapabilities",void 0),L(this,"_candidates",void 0),L(this,"_originCandidates",void 0),L(this,"_iceParameters",void 0),L(this,"_isUseExtmapAllowMixed",void 0),L(this,"_isUseLocalCodecs",void 0),L(this,"_dtlsParameters",void 0),L(this,"setup",void 0),L(this,"currentMidIndex",void 0),L(this,"cname",void 0),L(this,"useLocalCodecsMids",[]),L(this,"preloadSsrcs",[]),L(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=h,this._isUseLocalCodecs=f,d=Ei(d);let{iceParameters:E,dtlsParameters:S,candidates:y,rtpCapabilities:D,setup:O,localCapabilities:N,cname:k}=d;this._rtpCapabilities=D,this._candidates=y,this._originCandidates=Ei(y),this._iceParameters=E,this._dtlsParameters=S,this._localCapabilities=N,this.setup=O,this.cname=k,[this.sessionDesc]=this.updateRemoteRTPCapabilities(D),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(d){return d.length===this.preloadSsrcs.length&&d.every(h=>{var f;return Ce(f=this.preloadSsrcs).call(f,h)})}preloadRemoteMedia(d){let h=0,f=[],E=[];for(;d>0;){let S=[vI({ssrcId:Qy+h},j("USE_SUB_RTX")?{rtx:Qy+h+1}:{})],y="".concat(Qy+h,"_").concat(TI+h),{ssrcs:D,ssrcGroups:O}=Jg(S,this.cname,j("SYNC_GROUP")?y:void 0),N=this.preCreateOrRecycleSendMedia("video",D,O,void 0),k=[{ssrcId:TI+h}],U="".concat(Qy+h,"_").concat(TI+h),{ssrcs:B,ssrcGroups:J}=Jg(k,this.cname,j("SYNC_GROUP")?U:void 0),K=this.preCreateOrRecycleSendMedia("audio",B,J,void 0);d--,h+=2,f.push(N,K),E.push(D[0].ssrcId,B[0].ssrcId)}return this.useLocalCodecsMids.push(...f),this.preloadSsrcs=E,{mids:f,preSSRCs:E,isAvailable:!0}}preCreateOrRecycleSendMedia(d,h,f,E){let S=this.rtpCapabilities.send.videoCodecs,y=this._isUseLocalCodecs||S.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;C.debug("create or recycle send media without remote rtp capabilities, ssrcs ",h[0].ssrcId);let D=d===ke.VIDEO?y.videoCodecs:y.audioCodecs,O=d===ke.VIDEO?y.videoExtensions:y.audioExtensions;this.currentMidIndex+=1;let N="".concat(this.currentMidIndex),k={media:{mediaType:d,port:Zy,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.map(U=>U.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:O,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h,ssrcGroups:f,rtcpFeedbackWildcards:[],payloads:D,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(N)}};return k=this.mungSendMediaDesc(k,E),this.sessionDesc.mediaDescriptions.push(k),this.updateBundleMids(),N}toString(){return Bd(this.sessionDesc)}send(d,h,f,E){let{ssrcs:S,ssrcGroups:y}=Jg(h,this.cname,j("SYNC_GROUP")?f:void 0),D=this.findPreloadMediaDesc(S);if(D){if(bi()&&this.firefoxSsrcMidMap.set(S[0].ssrcId,D.attributes.mid),E&&(E.twcc||E.remb)){let O=this.sessionDesc.mediaDescriptions.indexOf(D);return this.sessionDesc.mediaDescriptions[O]=this.mungSendMediaDesc(D,E),{mid:D.attributes.mid,needExchangeSDP:!0}}return{mid:D.attributes.mid,needExchangeSDP:!1}}{let O=this.findAvailableMediaIndex(d,S),N;return O===-1||O===1&&(wn()||(function(){let k=wt();return!(k.name!==kt.CHROME||!k.osVersion)&&Number(k.version)<=90})()||j("ENABLE_ENCODED_TRANSFORM")&&pl())||O===0&&!(function(k){let U=wt();return!(U.name!==kt.FIREFOX||!U.osVersion)&&Number(U.version)===k})(138)&&j("USE_SUB_RTX")||EL()?(N=this.createOrRecycleSendMedia(d,S,y,"sendonly",E),this.updateBundleMids()):(N=Ei(this.sessionDesc.mediaDescriptions[O]),N.attributes.direction="sendonly",N.attributes.ssrcs=S,N.attributes.ssrcGroups=y,this.sessionDesc.mediaDescriptions[O]=this.mungSendMediaDesc(N,E)),bi()&&this.firefoxSsrcMidMap.set(S[0].ssrcId,N.attributes.mid),{mid:N.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:d,needExchangeSDP:h}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:d.attributes.mid,needExchangeSDP:h}}batchSend(d){let h=d.map(S=>{let{kind:y,ssrcMsg:D,mslabel:O}=S;return this.send(y,D,O)}),f=[],E=!1;return h.forEach(S=>{let{mid:y,needExchangeSDP:D}=S;D&&(E=!0),f.push(y)}),{mids:f,needExchangeSDP:E}}stopSending(d){let h=this.sessionDesc.mediaDescriptions.filter(f=>f.attributes.mid&&d.indexOf(f.attributes.mid)!==-1);if(h.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");h.forEach(f=>{f.attributes.mid==="0"||bi()||EL()?f.attributes.ssrcs=[]:(f.attributes.ssrcs=[],f.attributes.direction="inactive",f.media.port="0")}),this.updateBundleMids()}mute(d){let h=this.sessionDesc.mediaDescriptions.find(f=>f.attributes.mid===d);if(!h)throw new Error("mediaDescription not found with ".concat(d," in remote SDP when calling RemoteSDP.mute."));h.attributes.direction="inactive"}unmute(d){let h=this.sessionDesc.mediaDescriptions.find(f=>f.attributes.mid===d);if(!h)throw new Error("mediaDescription not found with ".concat(d," in remote SDP when calling RemoteSDP.unmute."));h.attributes.direction="sendonly"}muteRemote(d){let h=this.sessionDesc.mediaDescriptions.filter(f=>Ce(d).call(d,f.attributes.mid||""));if(h.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");h.forEach(f=>{f.attributes.direction="inactive"})}unmuteRemote(d){let h=this.sessionDesc.mediaDescriptions.filter(f=>Ce(d).call(d,f.attributes.mid||""));if(h.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");h.forEach(f=>{f.attributes.direction="recvonly"})}receive(d,h,f,E){d.forEach((S,y)=>{this.createOrRecycleRecvMedia(S,[],"recvonly",h,f,E[y])}),this.updateBundleMids()}stopReceiving(d){let h=this.sessionDesc.mediaDescriptions.filter(f=>d.indexOf(f.attributes.mid)!==-1);if(h.length!==d.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");h.forEach(f=>{f.media.port="0",f.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(d){let h=this.sessionDesc||Br((f=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(f?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var f;this._rtpCapabilities=d;let E=!1,S=this.rtpCapabilities.send,y=this.localCapabilities.send,D=this.localCapabilities.recv,O=D.videoCodecs,N=D.audioCodecs,k=D.videoExtensions,U=D.audioExtensions;for(let H of h.mediaDescriptions){var B;if(H.attributes.direction!=="sendonly"||typeof H.attributes.mid!="string"||!Ce(B=this.useLocalCodecsMids).call(B,H.attributes.mid)){if(E=!0,H.attributes.iceUfrag=this._iceParameters.iceUfrag,H.attributes.icePwd=this._iceParameters.icePwd,H.attributes.fingerprints=this._dtlsParameters.fingerprints,H.attributes.candidates=this._candidates,H.attributes.setup=this.setup,H.media.mediaType==="application"&&(H.attributes.sctpPort="5000"),H.media.mediaType==="video")if(this._isUseLocalCodecs&&H.attributes.direction==="sendonly"){var J;H.media.fmts=O.map(ue=>ue.payloadType.toString(10)),H.attributes.payloads=O,H.attributes.extmaps=k;let ee=H.attributes.mid;typeof ee!="string"||Ce(J=this.useLocalCodecsMids).call(J,ee)||this.useLocalCodecsMids.push(ee)}else if(S.videoCodecs.length===0){let ee=y.videoCodecs.filter(ue=>{var me,ye;return(me=ue.rtpMap)===null||me===void 0?void 0:Ce(ye=me.encodingName.toLowerCase()).call(ye,"vp8")})||[y.videoCodecs[0]];H.media.fmts=ee.map(ue=>ue.payloadType.toString(10)),H.attributes.payloads=ee,H.attributes.extmaps=[]}else H.media.fmts=S.videoCodecs.map(ee=>ee.payloadType.toString(10)),H.attributes.payloads=S.videoCodecs,H.attributes.extmaps=S.videoExtensions;if(H.media.mediaType==="audio")if(this._isUseLocalCodecs&&H.attributes.direction==="sendonly"){var K;H.media.fmts=N.map(ue=>ue.payloadType.toString(10)),H.attributes.payloads=N,H.attributes.extmaps=U;let ee=H.attributes.mid;typeof ee!="string"||Ce(K=this.useLocalCodecsMids).call(K,ee)||this.useLocalCodecsMids.push(ee)}else if(S.audioCodecs.length===0){let ee=y.audioCodecs.filter(ue=>{var me,ye;return(me=ue.rtpMap)===null||me===void 0?void 0:Ce(ye=me.encodingName.toLowerCase()).call(ye,"opus")})||[y.audioCodecs[0]];H.media.fmts=ee.map(ue=>ue.payloadType.toString(10)),H.attributes.payloads=ee,H.attributes.extmaps=[]}else H.media.fmts=S.audioCodecs.map(ee=>ee.payloadType.toString(10)),H.attributes.payloads=S.audioCodecs,H.attributes.extmaps=S.audioExtensions,Om(H)}}return this.sessionDesc=h,this.currentMidIndex=h.mediaDescriptions.length-1,[this.sessionDesc,E]}updateCandidates(d){let h=this._originCandidates.filter(E=>E.transport==="udp"),f=[];if(h.forEach(E=>{f.push(vI(vI({},E),{},{foundation:"tcpcandidate",priority:Number(E.priority)-1+"",transport:"tcp",port:Number(E.port)+90+""}))}),h.length!==0){switch(d){case Fn.TCP_RELAY:this._candidates=f;break;case Fn.UDP_TCP_RELAY:case Fn.RELAY:this._candidates=[...h,...f];break;default:this._candidates=h}for(let E of this.sessionDesc.mediaDescriptions)E.attributes.candidates=this.candidates}}restartICE(d){d=Ei(d),this._iceParameters=d,this.sessionDesc.mediaDescriptions.forEach(h=>{h.attributes.iceUfrag=d.iceUfrag,h.attributes.icePwd=d.icePwd})}predictReceivingMids(d){let h=[];for(let f=0;f<d;f++)h.push((this.currentMidIndex+f+1).toString(10));return h}findAvailableMediaIndex(d,h){return this.sessionDesc.mediaDescriptions.findIndex(f=>{let E=f.media.mediaType===d&&f.media.port!=="0"&&(f.attributes.direction==="sendonly"||f.attributes.direction==="sendrecv")&&f.attributes.ssrcs.length===0;if(bi()){if(E){let S=this.firefoxSsrcMidMap.get(h[0].ssrcId);return!(S||f.attributes.mid!=="0"&&f.attributes.mid!=="1")||!(!S||S!==f.attributes.mid)}return!1}return E})}createOrRecycleDataChannel(){for(let f of this.sessionDesc.mediaDescriptions)if(f.media.mediaType==="application")return{mediaDesc:f,needExchangeSDP:!1};this.currentMidIndex+=1;let d="".concat(this.currentMidIndex),h={media:{mediaType:"application",port:Zy,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(d),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(h),{mediaDesc:h,needExchangeSDP:!0}}createOrRecycleRecvMedia(d,h,f,E,S,y){let D=d._mediaStreamTrack.kind,O=this.rtpCapabilities.recv,N=Zg(D,O,this.localCapabilities.send,D===ke.VIDEO?E:S),k=D===ke.VIDEO?O.videoExtensions:O.audioExtensions;this.currentMidIndex+=1;let U="".concat(this.currentMidIndex),B={media:{mediaType:D,port:Zy,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.map(K=>K.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:k,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:N,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:f,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(U)}};B=this.mungRecvMediaDsec(B,d,y);let J=this.findFirstClosedMedia(D);if(J){let K=this.sessionDesc.mediaDescriptions.indexOf(J);this.sessionDesc.mediaDescriptions[K]=B}else this.sessionDesc.mediaDescriptions.push(B);return B}updateRemoteDtlsParameters(d){let h=new Set(this._dtlsParameters.fingerprints.map(S=>S.fingerprint)),f=new Set(d.map(S=>S.fingerprint)),E=!1;h.size!==f.size&&(E=!0);for(let S of h)f.has(S)||(E=!0);return E}updateRemoteCodec(d,h,f){let E=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(B=>B.rtpMap&&B.rtpMap.encodingName.toLowerCase()||"").filter(B=>{var J;return Ce(J=Object.keys(jg)).call(J,B)}))],S=new Set(h);if(E.every(B=>S.has(B)))return C.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(h)),!1;let y=this._rtpCapabilities.recv.videoCodecs.filter(B=>h.some(J=>{var K;return Ce(K=B.rtpMap&&B.rtpMap.encodingName.toLowerCase()||"").call(K,J)}));if(y.length===0)return C.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(E," codecs: ").concat(h)),!1;let D=[...new Set(y.map(B=>B.rtpMap&&B.rtpMap.encodingName.toLowerCase()||""))],O;if(C.debug("updateRemoteCodec, from ".concat(E," to ").concat(D)),d.length===0)O=this.sessionDesc.mediaDescriptions.filter(B=>B.media.mediaType==="video"&&B.attributes.direction==="recvonly");else if(O=this.sessionDesc.mediaDescriptions.filter(B=>B.attributes.mid&&B.media.mediaType==="video"&&Ce(d).call(d,B.attributes.mid)&&B.attributes.direction==="recvonly"),O.length!==d.length)return C.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(d,", codecs: ").concat(h)),!1;if(j("USE_PUB_RTX")||j("USE_SUB_RTX")){let B=Yd(y,this.rtpCapabilities.recv.videoCodecs);y.push(...B)}this._rtpCapabilities.recv.videoCodecs=y;let N=this.localCapabilities.send,k=this.rtpCapabilities.recv,U=Zg(ke.VIDEO,k,N,f);return O.forEach(B=>{let J=U.map(K=>K.payloadType.toString(10));C.debug("updateRemoteCodec mid: ".concat(B.attributes.mid,", from"),B.attributes.payloads,"to",U),B.attributes.payloads=U,B.media.fmts=J}),!0}createOrRecycleSendMedia(d,h,f,E,S){let y=this.rtpCapabilities.send.videoCodecs,D=this._isUseLocalCodecs||y.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,O=d===ke.VIDEO?D.videoCodecs:D.audioCodecs,N=d===ke.VIDEO?D.videoExtensions:D.audioExtensions;this.currentMidIndex+=1;let k="".concat(this.currentMidIndex),U={media:{mediaType:d,port:Zy,protos:["UDP","TLS","RTP","SAVPF"],fmts:O.map(J=>J.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:N,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h,ssrcGroups:f,rtcpFeedbackWildcards:[],payloads:O,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:E,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(k)}};U=this.mungSendMediaDesc(U,S);let B=this.findFirstClosedMedia(d);if(B){let J=this.sessionDesc.mediaDescriptions.indexOf(B);this.sessionDesc.mediaDescriptions[J]=U}else this.sessionDesc.mediaDescriptions.push(U);return U}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(d=>d.media.port!=="0").map(d=>d.attributes.mid)}mungRecvMediaDsec(d,h,f){let E=Ei(d);return oI(E),Im(E,h),cI(E,h),Gk(E),zy(E,f,this.localCapabilities.send),E}mungSendMediaDesc(d,h){let f=Ei(d);return zy(f,h,this.localCapabilities.recv),Om(f),f}updateRecvMedia(d,h){let f=this.sessionDesc.mediaDescriptions.findIndex(E=>E.attributes.mid===d);if(f!==-1){let E=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[f],h);this.sessionDesc.mediaDescriptions[f]=E}}bumpMid(d){this.currentMidIndex+=d}findFirstClosedMedia(d){return this.sessionDesc.mediaDescriptions.find(h=>bi()?h.media.port==="0"&&h.media.mediaType===d:h.media.port==="0")}findPreloadMediaDesc(d){return this.sessionDesc.mediaDescriptions.find(h=>{var f;return((f=h.attributes)===null||f===void 0||(f=f.ssrcs[0])===null||f===void 0?void 0:f.ssrcId)===d[0].ssrcId})}getSSRC(d){var h;return(h=this.sessionDesc.mediaDescriptions.find(f=>f.attributes.mid===d))===null||h===void 0?void 0:h.attributes.ssrcs}}(_o(_o({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!j("ENABLE_PRE_SUB_WITH_PRE_PC")||!j("PRE_USE_LOCAL_CODECS"))&&Cw(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let r=this.remoteSDP.toString(),s=Kk(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c?.(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});let l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),Cw(this.store))if(t.preallocation&&j("ENABLE_PRE_SUB_WITH_PRE_PC")){let d=j("PRE_SUB_NUM"),{mids:h,preSSRCs:f}=this.remoteSDP.preloadRemoteMedia(d);await qd(this.peerConnection,this.remoteSDP,this.extension),C.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(f)),this.presetMedia(h,f)}else{let{preSSRCs:d=[]}=t,h=d.map(E=>E.ssrcMsg[0].ssrcId);if(d.length===0)return;let{mids:f}=this.remoteSDP.batchSend(d.map(E=>Object.assign({},E)));await qd(this.peerConnection,this.remoteSDP,this.extension),C.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(h)),this.presetMedia(f,h)}}catch(r){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}var i,n}presetMedia(t,i){t.forEach((n,r)=>{this.peerConnection.getTransceivers().forEach(s=>{if(s.mid!=null&&n===s.mid&&s.receiver.track){let c=s.receiver.track,l;c.kind==="video"&&j("ENABLE_PRE_RENDER")&&(l=new Uw({trackId:"track-".concat(c.kind,"-unknown-").concat(this.store.clientId,"_").concat(ei(5,""))},!0),l.updateVideoTrack(c),l.onFirstVideoFrameRender=()=>{var d;let h=this.preMediaMap.get(i[r]);h&&(h.firstVideoRender=Date.now()),(d=this.onFirstVideoRender)===null||d===void 0||d.call(this,i[r])},l.play(this.store.sessionId||void 0)),this.preMediaMap.set(i[r],{mid:n,track:c,player:l,transceiver:s})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let i=!1,{rtpCapabilities:n}=t;if([,i]=this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){let c=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);i=i||c}let{preSSRCs:r=[]}=t,s=r.map(c=>c.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(s)){let c=[],l=[];if(Array.from(this.preMediaMap.entries()).every(d=>{let[h,{mid:f,player:E,track:S}]=d;return c.push(f),l.push(h),this.preMediaMap.delete(h),E&&E.destroy(),!0}),c.length>0&&(this.remoteSDP.stopSending(c),await qd(this.peerConnection,this.remoteSDP,this.extension),C.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(l)),He.reportApiInvoke(this.store.sessionId,{name:Li.PRELOAD_MEDIA_FAILED,options:[r,l],tag:_i.TRACER}).onSuccess()),r.length>0){let{mids:d}=this.remoteSDP.batchSend(r.map(h=>Object.assign({},h)));await qd(this.peerConnection,this.remoteSDP,this.extension),C.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(s)),this.presetMedia(d,s)}}i?(await qd(this.peerConnection,this.remoteSDP,this.extension),C.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):C.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(i){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(t,i,n){var r=this;return Ka(function*(){let s=yield Dt(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let c=[],l=Gy();t.forEach(N=>{let k=r.peerConnection.addTransceiver(N._mediaStreamTrack,_o({direction:"sendonly"},N.trackMediaType==="video"&&r.supportAV1RtpSpec&&l?{sendEncodings:[{scalabilityMode:l}]}:{}));c.push(k),N._updateRtpTransceiver(k)}),bi()&&j("SIMULCAST")===!0&&(yield Dt(r.applySimulcastForFirefox(c,t)));let d=yield Dt(r.peerConnection.createOffer()),h=r.remoteSDP.predictReceivingMids(t.length),f=r.mungSendOfferSDP(d.sdp,t,h),E=Br(f),S=h.map(N=>{let k=E.mediaDescriptions.find(U=>U.attributes.mid===N);if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return jk(k,j("USE_PUB_RTX"))}),y;try{y=yield S}catch(N){y=[],r.remoteSDP.receive(t,i,n,y);let k=r.remoteSDP.toString();throw yield Dt(r.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Dt(r.peerConnection.setRemoteDescription({type:"answer",sdp:k})),yield Dt(r.stopSending(h,!0)),N}r.remoteSDP.receive(t,i,n,y);let D=r.remoteSDP.toString(),O=r.logSDPExchange(f,"offer","local","send");return yield Dt(r.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Dt(r.applySimulcastEncodings(c,t)),yield Dt(r.applySendEncodings(c,t)),O?.(D),yield Dt(r.peerConnection.setRemoteDescription({type:"answer",sdp:D})),c.map((N,k)=>{let U=h[k];return{localSSRC:S[k],id:U,transceiver:N}})}catch(c){throw c instanceof de?c:new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{s()}})()}async createDataChannels(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(t);if(n&&n.readyState==="open")C.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");n=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:j("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,n)}i.forEach(s=>{s._updateOriginDataChannel(n)});let{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){let s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});let c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c),C.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else C.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(n){throw n instanceof de?n:new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(n.toString()))}}async stopDataChannels(t){try{let i=this.dataStreamChannelMap.get(t);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(t)}catch(i){throw i instanceof de?i:new de(M.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(t,i){let n=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let r=this.peerConnection.getTransceivers().filter(d=>t.indexOf(d.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(d=>{var h;tR(this.id+d.mid,this),d.direction="inactive",(h=d.stop)===null||h===void 0||h.call(d)});let s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);let l=this.remoteSDP.toString();c?.(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{n&&n()}}async receive(t,i,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:s,needExchangeSDP:c}=this.remoteSDP.send(t,i,n,r);c&&(await qd(this.peerConnection,this.remoteSDP,this.extension),C.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));let l=this.peerConnection.getTransceivers().find(d=>d.mid===s);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:s,transceiver:l}}catch(s){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:i,needExchangeSDP:n}=this.remoteSDP.batchSend(t);return n&&(await qd(this.peerConnection,this.remoteSDP,this.extension),C.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(r=>{let s=this.peerConnection.getTransceivers().find(c=>c.mid===r);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:r,transceiver:s}})}catch(i){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(s=>{Array.from(this.preMediaMap.entries()).some(c=>{let[l,{mid:d,player:h}]=c;if(d===s)return this.preMediaMap.delete(l),h&&h.destroy(),!0})}),this.remoteSDP.stopSending(t);let i=this.remoteSDP.toString(),n=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let r=await this.peerConnection.createAnswer();n?.(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(i){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let i=this.remoteSDP.toString(),n=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let r=await this.peerConnection.createAnswer();n?.(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(i){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let i=this.remoteSDP.toString(),n=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let r=await this.peerConnection.createAnswer();n?.(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(i){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(c=>{c.direction="inactive"});let n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(t);let s=this.remoteSDP.toString();r?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(c,l)=>{c.direction="sendonly"});let n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);let s=this.remoteSDP.toString();r?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(t){var i=this;return Ka(function*(){let n=yield Dt(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let r=Lt().supportPCSetConfiguration,s=j("FORCE_TURN_TCP")||i.forceTurn;if(t===Fn.RELAY&&!r)return;if(r&&!s){let E=t===Fn.RELAY?"relay":"all",S=i.peerConnection.getConfiguration();S.iceTransportPolicy!==E&&(C.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(S.iceTransportPolicy,"] to [").concat(E,"]")),S.iceTransportPolicy=E,i.peerConnection.setConfiguration(S))}i.remoteSDP.updateCandidates(t);let c=yield Dt(i.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let l=Kd(c.sdp),{remoteIceParameters:d}=yield l.iceParameters;i.remoteSDP.restartICE(d);let h=i.remoteSDP.toString(),f=i.logSDPExchange(c.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield Dt(i.peerConnection.setLocalDescription(c)),f?.(h),yield Dt(i.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(r){C.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),r)}finally{n()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;let t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Fn.TCP_RELAY),await qd(this.peerConnection,this.remoteSDP,this.extension)}catch(i){C.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(i=>{tR(this.id+i.mid,this)}),this.preMediaMap.forEach(i=>{let{player:n}=i;n&&n.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return _o(_o({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[i],[t]);this.remoteSDP.updateRecvMedia(t,i);let s=this.remoteSDP.toString(),c=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),c?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new de(M.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(t,i){let n=this.peerConnection.getTransceivers().filter(r=>r.mid===t);n.length===1&&(this.isVP8Simulcast(i)?bi()||await this.applySimulcastEncodings(n,[i]):await this.applySendEncodings(n,[i]))}setStatsRemoteVideoIsReady(t,i){this.statsFilter.setVideoIsReady2(t,i)}async replaceTrack(t,i){let n=this.peerConnection.getTransceivers().find(r=>r.mid===i);n&&await n.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let i=t[0].transport.iceTransport,{local:n,remote:r}=i.getSelectedCandidatePair();return{local:_o(_o({},cc),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:_o(_o({},cc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var i;let n="code: ".concat(t.errorCode,", message: ").concat(t.errorText),r=t.port?"local: ".concat(t.port):"",s=Bh(t.url||"");C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(n,"), url: ").concat(s||"",", host_candidate:").concat(r)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,n)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},j("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let i={iceServers:[]},n=t.cloudProxyServer||"disabled";return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&(xg(t.turnServer.servers)?i.iceServers=t.turnServer.servers:j("NEW_TURN_MODE")&&i.iceServers&&n==="disabled"?(j("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&i.iceServers.push(...ep.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):i.iceServers.push(...ep.newTurnServerConfigToIceServers(t.turnServer.servers)),j("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...ep.turnServerConfigToIceServers(t.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...ep.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),j("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(i.iceTransportPolicy="relay")}))),j("ENABLE_ENCODED_TRANSFORM")&&Lt().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(t){let i=[];return t.forEach(n=>{n.security?n.tcpport&&i.push({username:n.username,credential:n.password,credentialType:"password",urls:"turns:".concat(Wd(n.turnServerURL),":").concat(n.tcpport,"?transport=tcp")}):(n.udpport&&!j("FORCE_TURN_TCP")&&i.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.udpport,"?transport=udp")}),n.tcpport&&i.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(t){let i=[];return t.forEach(n=>{let r=j("NEW_TURN_MODE");r===1?i.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":3478?transport=udp")}):r===2?i.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":3478?transport=tcp")}):r===3?i.push({username:n.username,credential:n.password,credentialType:"password",urls:"turns:".concat(Wd(n.turnServerURL),":443?transport=tcp")}):r===4&&(i.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":3478?transport=udp")}),i.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":3478?transport=tcp")}),i.push({username:n.username,credential:n.password,credentialType:"password",urls:"turns:".concat(Wd(n.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(t){let i=t.transport;if(i){this.transportEventReceiver=t,i.onstatechange=()=>{var r;i!=null&&i.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,i.state))},i.onerror=r=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in r?r.error:r)};let n=i.iceTransport;n&&(n.onstatechange=()=>{let r=i?.iceTransport.state;var s;r&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,r))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){let{local:r,remote:s}=n.getSelectedCandidatePair()||{};if(r&&s){let c=r.address+":"+r.port,l=s.address+":"+s.port;C.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Bh(c)),", remote ").concat(JSON.stringify(Bh(l))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,i){var n,r;if(i||(i=this.peerConnection.getSenders().find(O=>O.track===t._mediaStreamTrack)),!i)return C.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return C.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Lt().supportSetRtpSenderParameters)return C.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let s={},c={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}let l=(function(O,N){return O.getTransceivers().find(k=>k.sender.track===N||k.receiver.track===N)})(this.peerConnection,t._mediaStreamTrack),d=fF(t);if((function(O){var N;return!(!j("ENABLE_AG_ADAPTATION")||!(O instanceof by||Ce(N=O._hints).call(N,Zt.CUSTOM_TRACK))||!j("FORCE_SUPPORT_AG_ADAPTATION")&&!(mL(14,0,!1)&&_L(17,4)||fL(14)&&$A(17,4,!0)))})(t)&&l&&i&&d&&this.getLocalVideoStats&&Ce(n=["vp8","vp9"]).call(n,this.store.codec)){var h;let O=s.degradationPreference||(Ce(h=t._hints).call(h,Zt.CUSTOM_TRACK)?j("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(N,k,U,B,J,K){if(tR(N,U),J(k),B!=="balanced"&&B!=="maintain-framerate"&&B!=="maintain-resolution")return;let H=-1;gM(N,k);let ee=window.setInterval(()=>{let me=eR.get(N);if(!j("ENABLE_AG_ADAPTATION")||!me)return tR(N,U),void J(k);let ye=K();if(ye.sendPackets>0&&ye.OutgoingAvailableBandwidth>0){if(H===-1)return void(H=Date.now());if(Date.now()-H<1e3)return;let pt=ye.sendFrameRate,mt=ye.OutgoingAvailableBandwidth,[nt,jt]=w7(N,pt,mt,me.adaptationConfig,k,B);jt&&(U.qualityLimitationReason=jt),nt&&me.adaptationConfig.scale!==nt.scale&&(C.debug("[".concat(N,"] applyAdaptation: ").concat(U.qualityLimitationReason,`
           sendFps `).concat(pt,", bwe ").concat(mt,", switch from ").concat(me.adaptationConfig.scale," to ").concat(nt.scale," ")),me.adaptationConfig=yI(yI({},me.adaptationConfig),nt),J(nt))}},j("CHECK_LOCAL_STATS_INTERVAL")),ue=yI({},k);eR.set(N,{timer:ee,adaptationConfig:ue,originConfig:k,adaptationFunc:J}),C.debug("[".concat(N,"] start adaptation, originConfig: ").concat(JSON.stringify(k),", degradationPreference: ").concat(B))})(this.id+l.mid,d,this,O,N=>{i&&this.updateAdaptation(i,N)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var f;let{bitrateMax:O,frameRate:N,scaleResolutionDownBy:k}=t._encoderConfig;O&&(c.maxBitrate=1e3*O),(Ce(f=t._hints).call(f,Zt.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(N&&(c.maxFramerate=sa(N)),k&&k>=1&&(c.scaleResolutionDownBy=k))}let{maxFramerate:E}=j("ENCODER_CONFIG_LIMIT");if(E&&typeof E=="number"&&(c.maxFramerate=c.maxFramerate?Math.min(c.maxFramerate,E):E),j("DSCP_TYPE")&&fl()){var S;let O=j("DSCP_TYPE");Ce(S=["very-low","low","medium","high"]).call(S,O)&&(c.networkPriority=O)}let y=i.getParameters(),D=(r=y.encodings)===null||r===void 0?void 0:r[0];bi()&&!D&&(s.encodings=[c]),D&&Object.assign(D,c),Object.assign(y,s),C.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),await i.setParameters(y),await(async function(O,N,k){try{var U;if(!Lt().supportSetRtpSenderParameters||!(function(ee){return ee==="vp9"||ee==="av1"})(O)||!j("ENABLE_SVC"))return;let B={},J={},K=N.getParameters(),H=(U=K.encodings)===null||U===void 0?void 0:U[0];J.scalabilityMode=Gy(k),H&&Object.assign(H,J),Object.assign(K,B),await N.setParameters(K),C.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(K.encodings)))}catch(B){C.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",B)}})(this.store.codec,i,j("SVC_MODE"))}async updateAdaptation(t,i){var n,r;if(!t)return C.debug("[updateAdaptation] no rtpSender found");if(!Lt().supportSetRtpSenderParameters)return C.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let s={},{bitrateMax:c,frameRate:l,scaleResolutionDownBy:d}=i;c&&(s.maxBitrate=1e3*c),l&&(s.maxFramerate=sa(l)),d&&d>=1&&Ce(n=["vp8","vp9"]).call(n,this.store.codec)&&(s.scaleResolutionDownBy=d);let h=t.getParameters(),f=(r=h.encodings)===null||r===void 0?void 0:r[0];f&&Object.assign(f,s),Object.assign(h,{});try{await t.setParameters(h),C.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(h.encodings)))}catch(E){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?C.debug("[updateAdaptation] peerConnection not connected}"):C.debug("[updateAdaptation] updateRtpSenderEncodings failed",E):C.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,i){try{if(!Lt().supportSetRtpSenderParameters||t.length!==i.length)return;for(let n=0;n<t.length;n++){let r=t[n],s=i[n];s instanceof oi&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,r.sender)}}catch{C.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,i,n){let r=Br(t);return i.forEach((s,c)=>{let l=n[c],d=r.mediaDescriptions.find(h=>h.attributes.mid===l);d&&(Im(d,s),Hk(d,s,this.store.codec))}),Bd(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,i,n)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,t,i,n)},this.statsFilter.onSelectedLocalCandidateChanged=(t,i)=>{var n;(n=this.onSelectedLocalCandidateChanged)===null||n===void 0||n.call(this,t,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,i)=>{var n;(n=this.onSelectedRemoteCandidateChanged)===null||n===void 0||n.call(this,t,i)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,i){if(t.length===i.length)for(let d=0;d<t.length;d++){var n,r,s,c,l;let h=t[d],f=i[d];if(f instanceof oi&&!Ce(n=f._hints).call(n,Zt.LOW_STREAM)&&(r=f._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((s=f._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=f._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=f._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){let E={},S={high:1e3*(f._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];let y=h.sender.getParameters();await h.sender.setParameters(Object.assign(y,E))}}}async applySimulcastEncodings(t,i){if(!bi()&&t.length===i.length)for(let n=0;n<t.length;n++){let r=i[n];if(r instanceof oi&&this.isVP8Simulcast(r)){let s=t[n],c={},l={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];let d=s.sender.getParameters();await s.sender.setParameters(Object.assign(d,c))}}}isVP8Simulcast(t){var i,n,r,s,c;return!!(t instanceof oi&&j("SIMULCAST")&&this.store.codec==="vp8"&&!Ce(i=t._hints).call(i,Zt.LOW_STREAM)&&(n=t._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((r=t._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((c=t._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(t,i,n,r){if(j("SDP_LOGGING"))return C.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(i," SDP during P2PConnection.").concat(r,`
`),t),i==="offer"?s=>{this.logSDPExchange(s,"answer",n==="local"?"remote":"local",r)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;let i=this.remoteSDP.getSSRC(t);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(t){if(Lt().supportPCSetConfiguration){let i=ep.resolvePCConfiguration(t);this.peerConnection.setConfiguration(i)}t.isPreallocation&&(this.isPreallocation=!0)}},Fe(It.prototype,"updateRemoteRTPCapabilities",[wr],Object.getOwnPropertyDescriptor(It.prototype,"updateRemoteRTPCapabilities"),It.prototype),Fe(It.prototype,"connect",[wr],Object.getOwnPropertyDescriptor(It.prototype,"connect"),It.prototype),Fe(It.prototype,"updateRemoteConnect",[wr],Object.getOwnPropertyDescriptor(It.prototype,"updateRemoteConnect"),It.prototype),Fe(It.prototype,"createDataChannels",[wr],Object.getOwnPropertyDescriptor(It.prototype,"createDataChannels"),It.prototype),Fe(It.prototype,"receive",[wr],Object.getOwnPropertyDescriptor(It.prototype,"receive"),It.prototype),Fe(It.prototype,"batchReceive",[wr],Object.getOwnPropertyDescriptor(It.prototype,"batchReceive"),It.prototype),Fe(It.prototype,"stopReceiving",[wr],Object.getOwnPropertyDescriptor(It.prototype,"stopReceiving"),It.prototype),Fe(It.prototype,"muteRemote",[wr],Object.getOwnPropertyDescriptor(It.prototype,"muteRemote"),It.prototype),Fe(It.prototype,"unmuteRemote",[wr],Object.getOwnPropertyDescriptor(It.prototype,"unmuteRemote"),It.prototype),Fe(It.prototype,"muteLocal",[wr],Object.getOwnPropertyDescriptor(It.prototype,"muteLocal"),It.prototype),Fe(It.prototype,"unmuteLocal",[wr],Object.getOwnPropertyDescriptor(It.prototype,"unmuteLocal"),It.prototype),Fe(It.prototype,"close",[wr],Object.getOwnPropertyDescriptor(It.prototype,"close"),It.prototype),Fe(It.prototype,"updateEncoderConfig",[wr],Object.getOwnPropertyDescriptor(It.prototype,"updateEncoderConfig"),It.prototype),Fe(It.prototype,"updateSendParameters",[wr],Object.getOwnPropertyDescriptor(It.prototype,"updateSendParameters"),It.prototype),Fe(It.prototype,"replaceTrack",[wr],Object.getOwnPropertyDescriptor(It.prototype,"replaceTrack"),It.prototype),Fe(It.prototype,"updateAdaptation",[wr],Object.getOwnPropertyDescriptor(It.prototype,"updateAdaptation"),It.prototype),Fe(It.prototype,"getRemoteSSRC",[wr],Object.getOwnPropertyDescriptor(It.prototype,"getRemoteSSRC"),It.prototype),It);function wr(e,t,i){let n=e[t];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let r=this.mutex,s=await r.lock("From P2PConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await n.apply(this,l)}finally{s()}},i}function AI(e,t){let i=document.createElement("video"),n=document.createElement("canvas");i.setAttribute("style","display:none"),n.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),n.width=sa(t.width),n.height=sa(t.height);let r=sa(t.framerate||15);document.body.append(i),document.body.append(n);let s=e._mediaStreamTrack;i.srcObject=new MediaStream([s]),i.play();let c=n.getContext("2d");if(!c)throw new te(M.UNEXPECTED_ERROR,"can not get canvas context");let l=Lt(),d=n.captureStream(l.supportRequestFrame?0:r).getVideoTracks()[0];d.canvas||(d.canvas=n),n.startCapture=()=>{if(!i)return n.stopCapture&&n.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){let f=i.videoWidth,E=i.videoHeight/f,S=n.width*E;Math.abs(S-n.height)>=2&&(C.debug("adjust low stream resolution","".concat(n.width,"x").concat(n.height," -> ").concat(n.width,"x").concat(S)),n.height=S)}c.drawImage(i,0,0,n.width,n.height),d.requestFrame&&d.requestFrame(),s!==e._mediaStreamTrack&&(s=e._mediaStreamTrack,i.srcObject=new MediaStream([s]))},n.stopCapture=Dw(()=>n.startCapture&&n.startCapture(),r);let h=d.stop;return d.stop=()=>{h.call(d),i&&(i.remove(),i.srcObject=null,i=null),n&&(n.width=0,n.remove(),n.stopCapture&&n.stopCapture(),n.startCapture=void 0,n.stopCapture=void 0,n=null),C.debug("clean low stream renderer")},d}var RM=(function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e})(RM||{}),Eo=(function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e})(Eo||{}),ct=(function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e})(ct||{}),yn=(function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e})(yn||{}),Ir=(function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e})(Ir||{}),nR=(function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e})(nR||{});let Gh=1e3,rR=6,t0=3,N7=Math.max(rR,t0,60);function Je(e,t,i){i!=null&&Number.isFinite(i)&&(e[t]=Math.round(Math.max(0,i)))}function CM(e){let t={[Ir.CONN_TYPE]:0,[Ir.RTT]:e.rtt,[Ir.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let i=e.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(t[Ir.CONN_TYPE]=1),i==="tcp"&&(t[Ir.CONN_TYPE]=3),i==="tls"&&(t[Ir.CONN_TYPE]=4);break}case"srflx":t[Ir.CONN_TYPE]=2;break;case"unknown":t[Ir.CONN_TYPE]=5;break;default:t[Ir.CONN_TYPE]=0}return t}function bM(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class AM extends vi{constructor(t){super(),L(this,"store",void 0),L(this,"uploadWRTCStatsTimer",void 0),L(this,"uploadOutboundDenoiserStatsTimer",void 0),L(this,"uploadExtStatsTimer",void 0),L(this,"uploadExtUsageStatsTimer",void 0),L(this,"uploadInboundExtStatsTimer",void 0),L(this,"requestStats",void 0),L(this,"requestTransportStats",void 0),L(this,"requestLocalMedia",void 0),L(this,"requestRemoteMedia",void 0),L(this,"requestAllTracks",void 0),L(this,"requestVideoIsReady",void 0),L(this,"requestUploadStats",void 0),L(this,"requestUpload",void 0),L(this,"uploadOutboundStarted",!1),L(this,"uploadInboundStarted",!1),L(this,"uploadTransportStarted",!1),L(this,"uploadBaseStatsStarted",!1),L(this,"uploadExtensionUsageStarted",!1),L(this,"lastRecvStats",void 0),L(this,"lastSendStats",void 0),L(this,"lastRefRecvStats",void 0),L(this,"lastRefSendStats",void 0),L(this,"lastNormalRecvStats",void 0),L(this,"lastNormalSendStats",void 0),L(this,"lastExtendStats",{}),L(this,"needUploadStats",{}),L(this,"needUploadRenderFreezeTime",!0),L(this,"lastUploadCompensateTime",-1),L(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;let i=t%t0==0,n=t%rR==0,r=t%60==0,s,c;if(this.uploadTransportStarted&&(s=this.requestStats(),this.store.useP2P&&(c=this.requestStats(!0))),!s&&this.uploadOutboundStarted&&(s=this.requestStats()),!c&&this.uploadInboundStarted&&(c=this.requestStats(!0)),s||c){var l;let d={};if(this.uploadTransportStarted&&s){let f=this.getTransportStats(s,c,i);f&&(d.misc=[f])}if(this.uploadOutboundStarted&&s){let f=this.getOutboundStats(s,n?this.lastNormalSendStats:void 0,i?this.lastRefSendStats:void 0,this.lastSendStats,r);f&&(d.outbound=[f])}if(this.uploadInboundStarted&&c){this.uploadCompensateStats(t);let f=this.getInboundStats(c,n?this.lastNormalRecvStats:void 0,i?this.lastRefRecvStats:void 0,this.lastRecvStats);f&&(d.inbound=f)}let h=(l=this.requestTransportStats)===null||l===void 0?void 0:l.call(this).connectState;h&&(Array.isArray(d.misc)?d.misc[0]&&d.misc[0].addition&&(d.misc[0].addition[nR.RTC_PEER_CONNECTION_STATE]=mw[h]):d.misc=[{addition:{[nR.RTC_PEER_CONNECTION_STATE]:mw[h]}}]),this.needUploadStats.sendType&&(Array.isArray(d.outbound)&&d.outbound[0]&&d.outbound[0].high&&(d.outbound[0].high[RM.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(d)}this.lastRecvStats=c,this.lastSendStats=s,n&&(this.lastNormalRecvStats=c,this.lastNormalSendStats=s),i&&(this.lastRefRecvStats=c,this.lastRefSendStats=s)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var i,n;let r=(i=this.requestTransportStats)===null||i===void 0?void 0:i.call(this);return void(r&&((n=this.requestUploadStats)===null||n===void 0||n.call(this,{misc:[{addition:{[nR.RTC_PEER_CONNECTION_STATE]:mw[r.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===N7+1&&(t=1)},Gh)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;let i=t%t0==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!i)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());let n=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=n,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;let r=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*r;let s=this.requestStats(!0);new Array(r).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;let c={};if(this.uploadInboundStarted&&s){let l=this.requestRemoteMedia()||[],d=[];l.forEach(h=>{let[f,E]=h,S={peer:f.uid};if(f._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(f._videoSSRC)&&E.has(ke.VIDEO)&&f.videoTrack){let y=(function(D,O,N){if(!O.videoRecv.find(U=>U.ssrc===D))return;let k={};if(N&&N._player){let U=N._player,{renderFreezeAccTime2:B,videoElementStatus:J}=U;if(uc.visibility==="visible"&&J===jn.PLAYING&&Lt().supportRequestVideoFrameCallback){let K=Math.min(6e3,B);U.renderFreezeAccTime2=Math.max(0,B-K),Je(k,Eo.Video_Render_Freeze_Time_Render2,K),j("USE_NEW_RENDER_FREEZE_TIME")&&Je(k,Eo.Video_Render_Freeze_Time_Render,K)}}return k})(f._videoSSRC,s,f.videoTrack);y&&(S.video=y)}S.video&&d.push(S)}),d.length>0&&(c.inbound=d,this.requestUploadStats(c))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,i,n){if(!this.requestStats)return;if(!n)return t.rtt==null?void 0:{addition:{[Ir.RTT]:t.rtt,[Ir.CONN_TYPE]:void 0,[Ir.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};let r=CM(t);if(this.store.useP2P){if(i){let s=CM(i);r[Ir.CONN_TYPE]+=s[Ir.CONN_TYPE]<<3}r[Ir.CONN_TYPE]+=110}else r[Ir.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(t,i,n,r,s){if(!this.requestUploadStats||!this.requestLocalMedia)return;let c=this.requestLocalMedia();if(!c||c.length===0)return;let l,d,h;return c.forEach(f=>{let[E,{track:S,ssrcs:y}]=f;switch(E){case ge.LocalVideoLowTrack:case ge.LocalVideoTrack:if(E===ge.LocalVideoTrack){var D;let O=(function(B,J,K,H,ee,ue){let me=J.videoSend.find(nt=>nt.ssrc===B);if(!me)return;let ye={},{sentFrame:pt,inputFrame:mt}=me;if(H&&(Je(ye,Eo.Video_Send_Qp_Sum,me.qpSumPerFrame),mt&&pt)){let nt=mt.frameRate,jt=pt.frameRate;ye[Eo.Video_Send_Freeze]=(function(Mt,Hn){let pe=!0;return pe=!(Mt<=5)&&(Mt<=10?Hn<3:Mt<=20?Hn<4:Hn<5),pe})(nt,jt)?1:0}if(ee){switch(pt&&(Je(ye,ct.Video_Send_Height,pt.height),Je(ye,ct.Video_Send_Width,pt.width),Je(ye,ct.Video_Send_Frame_Rate,pt.frameRate)),ye[ct.Video_Send_Disabled]=K._originMediaStreamTrack&&!K._originMediaStreamTrack.enabled||K._mediaStreamTrack&&!K._mediaStreamTrack.enabled?1:0,me.adaptionChangeReason){case"none":ye[ct.Video_Send_Adaptation]=0;break;case"cpu":ye[ct.Video_Send_Adaptation]=1;break;case"bandwidth":ye[ct.Video_Send_Adaptation]=2;break;case"other":ye[ct.Video_Send_Adaptation]=3}let nt=0;me.adaptionChangeReason&&(nt+=bM(me.adaptionChangeReason)),J.qualityLimitationReason&&(nt+=bM(J.qualityLimitationReason)<<3),ye[ct.Video_Send_Adaptation]=nt,ye[ct.Video_Send_Player_Status]=Ow[K._player?K._player.videoElementStatus:"uninit"],Je(ye,ct.Video_Send_Nacks,me.nacksCount),Je(ye,ct.Video_Send_Plis,me.plisCount),Je(ye,ct.Video_Send_Firs,me.firsCount),Je(ye,ct.Video_Send_Avg_Encode,me.avgEncodeMs),Je(ye,ct.Video_Send_Huge_Frame_Sent,me.hugeFramesSent),Je(ye,ct.Video_Send_Bytes_Retransmit,me.retransmittedBytesSent),Je(ye,ct.Video_Send_Packages_Retransmit,me.retransmittedPacketsSent),Je(ye,ct.Video_Send_Key_Frames_Encoded,me.keyFramesEncoded);let jt=ee.videoSend.find(Mt=>Mt.ssrc===B);if(jt){let Mt=Gh*t0;jt.timestamp&&me.timestamp&&(Mt=me.timestamp-jt.timestamp),jt.packets!=null&&me.packets!=null&&Je(ye,ct.Video_Send_Package_Rate,1e3*(me.packets-jt.packets)/Mt),me.packetsLost!=null&&jt.packetsLost!=null&&Je(ye,ct.Video_Send_Package_Lost,me.packetsLost-jt.packetsLost),jt.bytes!=null&&me.bytes!=null&&Je(ye,ct.Video_Send_Bitrate,8*(me.bytes-jt.bytes)/Mt)}}return ye})(y[0].ssrcId,t,S,i,n),N=S.__className__==="CameraVideoTrack"?3:Ce(D=S._hints).call(D,Zt.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==N||s)&&(this.needUploadStats={sendType:N},this.lastExtendStats.sendType=N);let k=S&&(function(B,J,K,H){let ee=J.videoSend.find(me=>me.ssrc===B);if(!ee)return null;let ue={};if(H){let me=ee.inputFrame,ye=me&&me.height||K.videoHeight||0,pt=me&&me.width||K.videoWidth||0,mt=me&&me.frameRate||0;Je(ue,ct.Video_Capture_Height,ye),Je(ue,ct.Video_Capture_Width,pt),Je(ue,ct.Video_Capture_Frame_Rate,mt)}return ue})(y[0].ssrcId,t,S,!!n),U=(function(B,J){let K={};return J&&(Je(K,ct.Video_Send_Retransmit,B.bitrate.retransmit),Je(K,ct.Video_Send_Target_Encoded,B.bitrate.targetEncoded),Je(K,ct.Video_Send_Actual_Encoded,B.bitrate.actualEncoded),Je(K,ct.Video_Send_Transmit,B.bitrate.transmit),Je(K,ct.Video_Send_Bandwidth,B.sendBandwidth)),K})(t,!!n);d=Object.assign({},O,k,U)}else h=(function(O,N,k,U,B){let J=N.videoSend.find(H=>H.ssrc===O);if(!J)return;let K={};if(U){let H=J.sentFrame;H&&(Je(K,ct.Video_Send_Low_Height,H.height),Je(K,ct.Video_Send_Low_Width,H.width),Je(K,ct.Video_Send_Low_Frame_Rate,H.frameRate));let ee=U.videoSend.find(ue=>ue.ssrc===O);if(ee){let ue=Gh*rR;ee.timestamp&&J.timestamp&&(ue=J.timestamp-ee.timestamp),ee.packets!=null&&J.packets!=null&&Je(K,ct.Video_Send_Low_Package_Rate,1e3*(J.packets-ee.packets)/ue),J.packetsLost!=null&&ee.packetsLost!=null&&Je(K,ct.Video_Send_Low_Package_Lost,J.packetsLost-ee.packetsLost),ee.bytes!=null&&J.bytes!=null&&Je(K,ct.Video_Send_Low_Bitrate,8*(J.bytes-ee.bytes)/ue)}}return K})(y[0].ssrcId,t,0,n);break;case ge.LocalAudioTrack:l=S&&(function(O,N,k,U,B,J){let K=N.audioSend.find(ee=>ee.ssrc===O);if(!K)return;let H={};if(B){H[ct.Audio_Send_Disabled]=k._originMediaStreamTrack&&!k._originMediaStreamTrack.enabled||k._mediaStreamTrack&&!k._mediaStreamTrack.enabled?1:0;let ee=100*k._source.getAccurateVolumeLevel(),ue=K.inputLevel;if(ue!=null){let ye=Math.ceil(50*Math.log10(100*ue+1));Je(H,ct.Audio_Send_Level,ye)}Je(H,ct.Audio_Capture_PCM_Level,ee),Je(H,ct.Audio_Send_AEC_Return_Loss,K.aecReturnLoss),Je(H,ct.Audio_Send_AEC_Return_Loss_Enhancement,K.aecReturnLossEnhancement),Je(H,ct.Audio_Send_Bytes_Retransmit,K.retransmittedBytesSent),Je(H,ct.Audio_Send_Packages_Retransmit,K.retransmittedPacketsSent),H[ct.Audio_Send_Freeze]=0;let me=B.audioSend.find(ye=>ye.ssrc===O);if(me){let ye=Gh*rR;me.timestamp&&K.timestamp&&(ye=K.timestamp-me.timestamp),me.bytes!=null&&K.bytes!=null&&Je(H,ct.Audio_Send_Bitrate,8*(K.bytes-me.bytes)/ye),me.packets!=null&&K.packets!=null&&Je(H,ct.Audio_Send_Package_Rate,1e3*(K.packets-me.packets)/ye)}}return H})(y[0].ssrcId,t,S,0,n)}}),{high:d,low:h,audio:l}}getInboundStats(t,i,n,r){if(!this.requestRemoteMedia)return;let s=this.requestRemoteMedia()||[],c=[];return s.forEach(l=>{let[d,h]=l,f={peer:d.uid};if(h.has(ke.VIDEO)&&d.videoTrack){let E=d._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(d._videoSSRC)||!1,S=d.videoTrack?(function(y,D,O,N,k,U,B,J){let K=D.videoRecv.find(nt=>nt.ssrc===y);if(!K)return;let H={},{receivedFrame:ee,outputFrame:ue,decodeFrameRate:me}=K;Je(H,yn.Video_Render_Frame_Rate_Decode,me),K.framesRateFirefox&&Je(H,yn.Video_Recv_Frame_Rate,K.framesRateFirefox),ee&&Je(H,yn.Video_Recv_Frame_Rate,ee.frameRate),Je(H,yn.Video_Recv_Frame_Dropped,K.framesDroppedCount),Je(H,yn.Video_Recv_Bytes_Retransmit,K.retransmittedBytesReceived),Je(H,yn.Video_Recv_Packages_Retransmit,K.retransmittedPacketsReceived),Je(H,yn.Video_Recv_Packages_Discarded,K.packetsDiscarded),Je(H,yn.Video_Recv_Avg_Decode,K.avgDecodeMs),Je(H,yn.Video_Recv_Avg_Processing_Delay,K.avgProcessingDelayMs),Je(H,yn.Video_Recv_Avg_Assembly_Time,K.avgFramesAssembledFromMultiplePacketsMs),Je(H,yn.Video_Recv_Avg_Inter_Frame_Delay,K.avgInterFrameDelayMs),Je(H,yn.Video_Recv_Key_Frames_Decoded,K.keyFramesDecoded);let ye=J&&J.videoRecv.find(nt=>nt.ssrc===y);if(ye){let nt=D.timestamp-J.timestamp||Gh;K.packetsLost!=null&&ye.packetsLost!=null&&Je(H,yn.Video_Recv_Package_Lost,K.packetsLost-ye.packetsLost),ye.bytes!=null&&K.bytes!=null&&Je(H,yn.Video_Recv_Bitrate,8*(K.bytes-ye.bytes)/nt),ye.packets!=null&&K.packets!=null&&Je(H,yn.Video_Recv_Package_Rate,1e3*(K.packets-ye.packets)/nt)}let pt=U&&U.videoRecv.find(nt=>nt.ssrc===y);if(pt&&(Je(H,Eo.Video_Recv_Qp_Sum,K.qpSumPerFrame),H[Eo.Video_Recv_Freeze]=N&&e0.isRemoteVideoFreeze(O,K,pt)?1:0),B){var mt;let nt=B.videoRecv.find(Mt=>Mt.ssrc===y);ee?(Je(H,ct.Video_Recv_Height,ee.height),Je(H,ct.Video_Recv_Width,ee.width)):O&&(Je(H,ct.Video_Recv_Height,O._videoHeight||0),Je(H,ct.Video_Recv_Width,O._videoWidth||0)),ue&&Je(H,ct.Video_Recv_Frame_Rate_Output,ue.frameRate);let jt=(mt=O._player)===null||mt===void 0?void 0:mt.rendFrameRate.toFixed(0);if(jt&&Je(H,ct.Video_Render_Frame_Rate_Render,+jt),Je(H,ct.Video_Recv_Jitter_Buffer,K.jitterBufferMs),Je(H,ct.Video_Recv_Current_Delay,K.currentDelayMs),Je(H,ct.Video_Recv_Firs,K.firsCount),Je(H,ct.Video_Recv_Nacks,K.nacksCount),Je(H,ct.Video_Recv_Plis,K.plisCount),O){H[ct.Video_Recv_Disabled]=O._originMediaStreamTrack.enabled&&O._mediaStreamTrack.enabled?0:1;let Mt=O._player;if(Mt){let{freezeTimeCounterList:Hn,renderFreezeAccTime:pe,renderFreezeAccTime2:Ae,videoElementStatus:Me}=Mt;if(Hn&&Hn.length>0&&Je(H,Eo.Video_Render_Freeze_Time,Hn.splice(0,1)[0]),k&&uc.visibility==="visible"&&Me===jn.PLAYING&&Lt().supportRequestVideoFrameCallback){let Ee=Math.min(6e3,Ae);Mt.renderFreezeAccTime2=Math.max(0,Ae-Ee),Je(H,Eo.Video_Render_Freeze_Time_Render2,Ee);let I=Math.min(6e3,pe);Mt.renderFreezeAccTime=Math.max(0,pe-I),Je(H,Eo.Video_Render_Freeze_Time_Render,j("USE_NEW_RENDER_FREEZE_TIME")?Ee:I)}if(typeof K.totalFreezesDuration=="number"){let Ee=nt&&nt.totalFreezesDuration?K.totalFreezesDuration-nt.totalFreezesDuration:K.totalFreezesDuration;Je(H,ct.Video_Render_Freeze_Duration,1e3*Ee)}}}if(H[ct.Video_Recv_Player_Status]=Ow[O._player?O._player.videoElementStatus:"uninit"],nt&&K.totalInterFrameDelay!==void 0&&K.totalSquaredInterFrameDelay!==void 0&&nt.totalInterFrameDelay!==void 0&&nt.totalSquaredInterFrameDelay!==void 0){let Mt=K.totalInterFrameDelay-nt.totalInterFrameDelay,Hn=K.totalSquaredInterFrameDelay-nt.totalSquaredInterFrameDelay,pe=K.framesDecodeCount-nt.framesDecodeCount,Ae=Mt/pe*1e3,Me=Math.round(1e3*Math.sqrt((Hn-Math.pow(Mt,2)/pe)/pe));!isNaN(Me)&&Ae+Me>Math.max(3*Ae,Ae+150)&&(H[ct.Video_Recv_I_Frame_Delay]=Me)}}return H})(d._videoSSRC,t,d.videoTrack,E===!0,this.needUploadRenderFreezeTime,i,n,r):void 0;S&&(f.video=S)}if(h.has(ke.AUDIO)&&d.audioTrack){let E=d.audioTrack?(function(S,y,D,O,N,k){let U=y.audioRecv.find(H=>H.ssrc===S);if(!U)return;let B={};Je(B,yn.Audio_Recv_Jitter,U.jitterMs),Je(B,yn.Audio_Recv_Bytes_Retransmit,U.retransmittedBytesReceived),Je(B,yn.Audio_Recv_Packages_Retransmit,U.retransmittedPacketsReceived),Je(B,yn.Audio_Recv_Packages_Discarded,U.packetsDiscarded),Je(B,yn.Audio_Recv_Avg_Processing_Delay,U.avgProcessingDelayMs);let J=k&&k.audioRecv.find(H=>H.ssrc===S);if(J){let H=Gh;U.packets!=null&&J.packets!=null&&Je(B,yn.Audio_Recv_Package_Rate,1e3*(U.packets-J.packets)/H),U.packetsLost!=null&&J.packetsLost!=null&&Je(B,yn.Audio_Recv_Package_Lost,U.packetsLost-J.packetsLost)}if(O){let{receivedFrames:H,droppedFrames:ee}=U;H!=null&&ee!=null&&(B[Eo.Audio_Recv_Freeze]=(K=H)===0||100*ee/K>20?1:0)}var K;if(N){let H=100*D._source.getAccurateVolumeLevel(),ee=U.outputLevel;if(ee!=null){let me=Math.ceil(50*Math.log10(100*ee+1));Je(B,ct.Audio_Render_Level,me)}Je(B,ct.Audio_Recv_PCM_Level,H),D&&(B[ct.Audio_Recv_Disabled]=D._originMediaStreamTrack.enabled&&D._mediaStreamTrack.enabled?0:1),Je(B,ct.Audio_Recv_Jitter_Buffer,U.jitterBufferMs),Je(B,ct.Audio_Recv_Current_Delay,U.jitterBufferMs),B[ct.Audio_Recv_Player_Status]=Ow[Ar.getPlayerState(D.getTrackId())];let ue=N.audioRecv.find(me=>me.ssrc===S);if(ue){ue.bytes!=null&&U.bytes!=null&&Je(B,ct.Audio_Recv_Bitrate,8*(U.bytes-ue.bytes)/(Gh*t0));let me=U.concealedSamples-ue.concealedSamples;me>0&&Je(B,ct.Audio_Recv_Concealed_Samples,me);let ye=U.totalSamplesReceived-ue.totalSamplesReceived;ye>0&&Je(B,ct.Audio_Recv_Total_Samples_Received,ye);let pt=U.freezeSamples80-ue.freezeSamples80;pt>0&&Je(B,ct.Audio_Render_Freeze_Samples_80ms,pt);let mt=U.freezeSamples200-ue.freezeSamples200;mt>0&&Je(B,ct.Audio_Render_Freeze_Samples_200ms,mt);let nt=U.freezeMs80-ue.freezeMs80;Je(B,ct.Audio_Render_Freeze_Time_80ms,nt<0?0:nt);let jt=U.freezeMs200-ue.freezeMs200;Je(B,ct.Audio_Render_Freeze_Time_200ms,jt<0?0:jt)}}return B})(d._audioSSRC,t,d.audioTrack,i,n,r):void 0;E&&(f.audio=E)}(f.video||f.audio)&&c.push(f)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,c}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let t=(this.requestAllTracks()||[]).find(i=>i instanceof Gg);if(t&&t._external.getDenoiserStats){let i=t._external.getDenoiserStats();i&&this.requestUpload(Wg.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[i,n]=t;n.has(ke.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)}),n.has(ke.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let i=Date.now(),n={connectionInterval:j("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i},r=[],s=this.requestAllTracks&&this.requestAllTracks()||[];for(let h of s)!h.muted&&h.enabled&&(r=r.concat(await h.getProcessorUsage()));let c=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[h,f]of c)f.has(ke.VIDEO)&&h.videoTrack&&(r=r.concat(await h.videoTrack.getProcessorUsage())),f.has(ke.AUDIO)&&h.audioTrack&&(r=r.concat(await h.audioTrack.getProcessorUsage()));if(r.length===0)return;n.details=(function(h,f){let E={};for(let{id:O,value:N,level:k,direction:U}of h){var S;let B=(S=f.get(O))!==null&&S!==void 0?S:0,J=N===2?B+j("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:B;var y,D;f.set(O,J),E[O]?(N===2&&(E[O].value=N),k>E[O].level&&(E[O].level=k),U==="remote"&&(E[O].remoteUidCount+=1),E[O].totalTs=(y=f.get(O))!==null&&y!==void 0?y:0):E[O]={value:N,level:k,remoteUidCount:U==="local"?0:1,totalTs:(D=f.get(O))!==null&&D!==void 0?D:0}}return Object.keys(E).map(O=>{let{level:N,value:k,totalTs:U}=E[O];return{id:O,level:N,value:k,totalTs:U}})})(r,t);let l=Date.now(),d=l>i?l:i+1;this.requestUpload&&this.requestUpload(Wg.EXTENSION_USAGE_STATS,{usageStats:n,sendTs:d})},j("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}let D7=j("ICE_RESTART_INTERVAL"),aR=new Map,Pm=new Map,Zd=[Fn.UDP_TCP_RELAY,Fn.TCP_RELAY,Fn.RELAY],wI=j("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Lt().supportPCSetConfiguration;function wM(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=aR.get(e.id);i&&(window.clearTimeout(i),aR.delete(e.id));let n=Pm.get(e.id);t&&n&&n.index===Zd.length-1&&(C.debug("[".concat(e.id,"] reset ICE restart policy")),Pm.delete(e.id))}function IM(e,t,i){if(aR.size===0&&Pm.size===0&&(Array.isArray(j("RESTART_SEQUENCE"))&&j("RESTART_SEQUENCE").length>0&&!(function(l,d){if(l.length!==d.length)return!1;for(let h=0;h<l.length;h+=1){let f=l[h];if(l.filter(E=>E===f).length!==d.filter(E=>E===f).length)return!1}return!0})(Zd,j("RESTART_SEQUENCE"))&&(Zd=j("RESTART_SEQUENCE").filter(l=>{var d;if(Ce(d=Object.values(Fn)).call(d,l))return!0}),C.debug("use reconnection policy from config distribution, queues: ".concat(Zd.join(" => ")))),wI=j("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Lt().supportPCSetConfiguration),Zd.length===0)return void i();let n,{index:r=0,type:s}=Pm.get(e.id)||{};if(wI&&s===Fn.RELAY)return void i();let c=s&&r>=Zd.length-1;if(wI)s=Fn.RELAY;else{if(c)return void i();s?(r++,s=Zd[r]):(s=Zd[0],r=0)}C.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(s,", index: ").concat(r)),t(s),Pm.set(e.id,{index:r,type:s}),n=window.setTimeout(()=>IM(e,t,i),D7),aR.set(e.id,n)}var vt;function OM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function fc(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?OM(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):OM(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}function NM(e){var t,i,n,r=2;for(typeof Symbol<"u"&&(i=GA,n=Symbol.iterator);r--;){if(i&&(t=e[i])!=null)return t.call(e);if(n&&(t=e[n])!=null)return new sR(t.call(e));i="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function sR(e){function t(i){if(Object(i)!==i)return Ie.reject(new TypeError(i+" is not an object."));var n=i.done;return Ie.resolve(i.value).then(function(r){return{value:r,done:n}})}return sR=function(i){this.s=i,this.n=i.next},sR.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(i){var n=this.s.return;return n===void 0?Ie.resolve({value:i,done:!0}):t(n.apply(this.s,arguments))},throw:function(i){var n=this.s.return;return n===void 0?Ie.reject(i):t(n.apply(this.s,arguments))}},new sR(e)}let i0=(vt=class extends vi{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(Ke.StateChange,t,this._state)}constructor(e,t){super(),L(this,"isPlanB",void 0),L(this,"store",void 0),L(this,"statsUploader",void 0),L(this,"connection",void 0),L(this,"localTrackMap",new Map),L(this,"remoteUserMap",new Map),L(this,"localDataChannels",[]),L(this,"remoteDataChannelMap",new Map),L(this,"pendingLocalTracks",[]),L(this,"pendingRemoteTracks",[]),L(this,"pendingLocalDataChannels",[]),L(this,"pendingRemoteDataChannels",[]),L(this,"statsCollector",void 0),L(this,"shouldForwardP2PCreation",void 0),L(this,"iceFailedCount",0),L(this,"dtlsFailedCount",0),L(this,"mutex",void 0),L(this,"_state",Ht.Disconnected),L(this,"_pcStatsUploadType",j("NEW_ICE_RESTART")?gl.FIRST_CONNECTION:gl.OLD_FIRST_CONNECTION),L(this,"_isStartRestartIce",!1),L(this,"_restartTimer",void 0),L(this,"_isTryConnecting",!1),L(this,"_iceError",null),L(this,"_forceTurn",!1),L(this,"_isWaitPcToRePub",!1),L(this,"handleMuteLocalTrack",async(i,n,r)=>{let s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Ht.Connected)return void r(new de(M.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let c=this.filterTobeMutedTracks(i);if(c.length===0)return void n();let l=c.find(h=>h[0]==="videoLowTrack");if(l){let h=l[1];this.store.enableInstantMuteRestore?(h.track._originMediaStreamTrack.enabled=!1,C.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):h.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?C.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(c.map(h=>{let[,{id:f}]=h;return f}));let d=this.createMuteMessage(c);await $t(this,Ke.RequestMuteLocal,d),n()}catch(c){r(c)}finally{s()}}),L(this,"handleUnmuteLocalTrack",async(i,n,r)=>{let s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Ht.Connected)return void r(new de(M.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let c=this.filterTobeUnmutedTracks(i);if(c.length===0)return void n();let l=c.find(h=>h[0]==="videoLowTrack");if(l){let h=l[1];if(this.store.enableInstantMuteRestore)h.track._originMediaStreamTrack.enabled=!0,C.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(h.track._originMediaStreamTrack.stop(),!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Lt().supportDualStreamEncoding){let f=i._mediaStreamTrack.clone();h.track._mediaStreamTrack=f,h.track._originMediaStreamTrack=f}else{let f=AI(i,kg(this,Ke.RequestLowStreamParameter));h.track._mediaStreamTrack=f,h.track._originMediaStreamTrack=f}await new Ie((f,E)=>{this.handleReplaceTrack(h.track,f,E,!0)})}}this.store.enableInstantMuteRestore?C.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(c.map(h=>{let[,{id:f}]=h;return f}));let d=this.createUnmuteMessage(c);await $t(this,Ke.RequestUnmuteLocal,d),n()}catch(c){r(c)}finally{s()}}),L(this,"handleUpdateVideoEncoder",async(i,n,r,s)=>{let c;s||(c=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{let d=this.localTrackMap.get(ge.LocalVideoTrack);if(!this.connection||!d||d.track!==i||this.state!==Ht.Connected)return void n();let{id:h,track:f}=d;await this.connection.updateSendParameters(h,f),await this.connection.updateEncoderConfig(h,f),this.emit(Ke.UpdateVideoEncoder,f),n()}catch(d){r(d)}finally{var l;(l=c)===null||l===void 0||l()}}),L(this,"handleUpdateVideoSendParameters",async(i,n,r)=>{let s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let c=this.localTrackMap.get(ge.LocalVideoTrack);if(!this.connection||!c||c.track!==i||this.state!==Ht.Connected)return void n();let{id:l,track:d}=c;await this.connection.updateSendParameters(l,d),n()}catch(c){r(c)}finally{s()}}),L(this,"handleReplaceMixingTrack",async(i,n,r,s)=>{if(!this.connection||this.state!==Ht.Connected)return void n();let c=CI([i]),l;C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(c.getTrackId(),"]")),typeof s=="boolean"&&s||(l=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,c),n()}catch(h){r(h)}finally{var d;(d=l)===null||d===void 0||d()}}),L(this,"handleReplaceTrack",async(i,n,r,s)=>{let c;C.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;let h=Array.from(this.localTrackMap.entries()).find(f=>{let[,{track:E}]=f;return i===E});if(!this.connection||!h||this.state!==Ht.Connected)return void n();if(await((l=this.connection)===null||l===void 0?void 0:l.replaceTrack(i,h[1].id)),this.isPlanB){let f=h[1];f.id=i._mediaStreamTrack.id,this.localTrackMap.set(h[0],f)}if(h[0]===ge.LocalVideoTrack&&!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Lt().supportDualStreamEncoding){let f=this.localTrackMap.get(ge.LocalVideoLowTrack);if(f){let E=i._mediaStreamTrack.clone();f.track._originMediaStreamTrack.stop(),f.track._mediaStreamTrack=E,f.track._originMediaStreamTrack=E,await new Ie((S,y)=>{this.handleReplaceTrack(f.track,S,y,!0)})}}n()}catch(h){r(h)}finally{var d;(d=c)===null||d===void 0||d()}}),L(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),L(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),L(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),L(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),L(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new AM(this.store),this.bindStatsUploaderEvents(),this.mutex=new Vn("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Lt().supportUnifiedPlan||j("CHROME_FORCE_PLAN_B")&&fl(),this.shouldForwardP2PCreation=j("FORWARD_P2P_CREATION")&&Lt().supportPCSetConfiguration&&iw(),this.shouldForwardP2PCreation&&(this.connection=iR(this.store),this.emit(Ke.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var i;this.state=Ht.New,this._forceTurn=TM(e),C.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));let n=this.shouldForwardP2PCreation&&((i=this.connection)===null||i===void 0?void 0:i.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||n||t)&&((n||t)&&this.connection&&(C.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=iR(this.store,e),this.emit(Ke.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new de(M.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=j("NEW_ICE_RESTART")?gl.FIRST_CONNECTION:gl.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new de(M.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===Ht.Connected){if(this.connection instanceof Qa&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return C.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),He.reportApiInvoke(this.store.sessionId,{name:Li.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:_i.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Ke.RequestReconnect)});await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ht.Connected}updateRemoteRTPCapabilities(e){let t=Array.from(this.localTrackMap.entries()).filter(r=>{var s;let[c]=r;return Ce(s=[ge.LocalVideoLowTrack,ge.LocalVideoTrack]).call(s,c)}),i=t.map(r=>{let[,{id:s}]=r;return s}),n=t.map(r=>{let[s]=r;return s});if(this.connection instanceof Qa){if(He.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(n),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Ce(e).call(e,this.store.codec)){let r=["vp9","vp8","h264"].find(s=>Ce(e).call(e,s));r&&(this.store.codec=r,C.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(r,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async getEstablishParams(){var e;if(this.connection instanceof Qa&&this.connection.peerConnectionState!=="closed"&&Ce(e=[Ht.New,Ht.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Ht.Connected){if(this.state===Ht.Disconnected)throw new de(M.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(i=>{var n;Ce(n=this.pendingLocalDataChannels).call(n,i)||this.pendingLocalDataChannels.push(i)}),[]}let t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(i=>{let n=Date.now();this.store.publish(i.id.toString(),"datachannel",n)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(i=>{this.localDataChannels.push(i);let n=Date.now();this.store.publish(i.id+"","datachannel",void 0,n)}),e.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(e,t,i){var n=this;return Ka(function*(){let r=yield Dt(n.mutex.lock("From P2PChannel.publish"));try{var s;let c=n.connection&&Ce(s=["disconnected","failed"]).call(s,n.connection.peerConnectionState);if(!n.connection||n.state!==Ht.Connected||c){if(n.state===Ht.Disconnected)throw new de(M.UNEXPECTED_ERROR,"PeerConnection already disconnected.");n.throwIfTrackTypeNotMatch(e);let d=e.filter(h=>n.pendingLocalTracks.indexOf(h)===-1);return n.pendingLocalTracks=n.pendingLocalTracks.concat(d),void(c&&(n._isWaitPcToRePub=!0))}n.store.pubId=n.store.pubId+1,Gn.markPublishStart(n.store.clientId,n.store.pubId);let l=n.filterTobePublishedTracks(e,t,i);if(l.length===0)return void(yield Dt(n.tryToUnmuteAudio(e)));yield*QT(NM(n.doPublish(n.connection,l)))}finally{r()}})()}doPublish(e,t){var i=this;return Ka(function*(){t.forEach(S=>{let{track:y,type:D}=S,O=Date.now();i.store.publish(y.getTrackId(),D===ge.LocalAudioTrack?"audio":"video",O)}),i.bindLocalTrackEvents(t);let n=t.map(S=>{let{track:y}=S;return y}),r=yield Dt(e.send(n,i.store.codec,i.store.audioCodec)),s=(yield Dt(r.next())).value,c=i.createGatewayPublishMessage(t,s),l;try{l=yield c}catch(S){throw r.throw(S),S?.code===M.WS_ABORT&&t.forEach(y=>{let{track:D}=y;i.pendingLocalTracks.indexOf(D)===-1&&i.pendingLocalTracks.push(D)}),i.unbindLocalTrackEvents(t),S}let d=i.mapPubResToRemoteConfig(c,l,n),h=(yield Dt(r.next(d))).value;if(i.state===Ht.Disconnected)throw new de(M.UNEXPECTED_ERROR,"PeerConnection already disconnected.");j("ENABLE_VIDEO_SEI");let f=j("ENABLE_ENCODED_TRANSFORM"),E=j("ENABLE_AUDIO_METADATA");n.forEach(async S=>{let y=S.getRTCRtpTransceiver();if(!y||!f)return;let{interceptLocalVideoFrame:D,interceptLocalAudioFrame:O}=Yy();S.trackMediaType===ke.VIDEO?await D(y.sender,S):S.trackMediaType===ke.AUDIO&&await O(y.sender,{metadata:E?()=>{let N=S.metadata.shift();return N&&N.value}:void 0})}),t.forEach(S=>{let{type:y}=S;i.statsCollector.addLocalStats(y)}),i.assignLocalTracks(t,h),i.statsUploader.startUploadOutboundStats(),t.forEach(S=>{let{track:y,type:D}=S,O=Date.now();i.store.publish(y.getTrackId(),D===ge.LocalAudioTrack?"audio":"video",void 0,O)})})()}async updateVideoStreamParameter(e,t){let i=this.localTrackMap.get(t);if(!i||!this.connection)return;if(!(i.track instanceof oi))return C.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");let{track:n}=i,r=(function(s,c){let l={};return s.height&&s.width&&(l.scaleResolutionDownBy=sI(s,c)),l.maxFramerate=s.framerate?sa(s.framerate):void 0,l.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,l})(e,n);if(n._encoderConfig||(n._encoderConfig={}),t!==ge.LocalVideoLowTrack||!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Lt().supportDualStreamEncoding)r.scaleResolutionDownBy!=null&&(n._encoderConfig.scaleResolutionDownBy=r.scaleResolutionDownBy);else{let s=n._originMediaStreamTrack;if(!s.canvas)return C.warn("[".concat(n.getTrackId(),"] no canvas on track"));(function(c,l){let d=c.canvas;l.width&&(d.width=sa(l.width)),l.height&&(d.height=sa(l.height)),l.framerate&&(d.stopCapture&&d.stopCapture(),d.stopCapture=Dw(()=>{!d.startCapture&&d.stopCapture&&d.stopCapture(),d.startCapture&&d.startCapture()},sa(l.framerate)))})(s,e)}r.maxBitrate!=null&&(n._encoderConfig.bitrateMax=r.maxBitrate/1e3),r.maxFramerate!=null&&(n._encoderConfig.frameRate&&typeof n._encoderConfig.frameRate=="object"?n._encoderConfig.frameRate.max=r.maxFramerate:n._encoderConfig.frameRate={max:r.maxFramerate}),C.debug("[".concat(n.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(n._encoderConfig))),await this.connection.updateRtpSenderEncodings(n)}publishLowStream(e){var t=this;return Ka(function*(){if(!t.connection||t.state!==Ht.Connected)return;let i=yield Dt(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let r=t.localTrackMap.get(ge.LocalVideoTrack);if(!r)throw new de(M.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(ge.LocalVideoLowTrack))throw new de(M.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));let s=[{track:t.getLowVideoTrack(r.track,e),type:ge.LocalVideoLowTrack}];if(yield*QT(NM(t.doPublish(t.connection,s))),r.track.muted||!r.track.enabled){var n;let c=(n=t.localTrackMap.get(ge.LocalVideoLowTrack))===null||n===void 0?void 0:n.id;c!==void 0&&(yield Dt(t.connection.muteLocal([c])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(C.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await On(this,Ke.RequestRePublish,this.pendingLocalTracks),this.emit(Ke.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(C.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await On(this,Ke.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){let{user:i,kind:n}=this.pendingRemoteTracks[t];(n!==ke.AUDIO||i._audio_added_&&i._audioSSRC)&&(n!==ke.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await On(this,Ke.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:t,kind:i}of this.pendingRemoteTracks)await this.subscribe(t,i,i===ke.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:i}=t;this.emit(Ke.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Ht.Connected)return void e.forEach(n=>{let r=this.pendingLocalTracks.indexOf(n);r!==-1&&this.pendingLocalTracks.splice(r,1)});let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let i=t.find(n=>n[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Ht.Connected)return void e.forEach(i=>{let n=this.pendingLocalDataChannels.indexOf(i);n!==-1&&this.pendingLocalDataChannels.splice(n,1)});let t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(i=>{let n=this.localDataChannels.indexOf(i);n!==-1&&this.localDataChannels.splice(n,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Ht.Connected)return;let e=this.localTrackMap.get(ge.LocalVideoLowTrack);if(!e)return;e.track.close();let t=[[ge.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){let i=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(n=>{let[,{id:r}]=n;return r})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(n=>{let[r,{track:s}]=n;return{type:r,track:s}})),t.forEach(n=>{let[r]=n;this.statsCollector.removeLocalStats(r)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Ht.Connected)throw new de(M.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let i=t.filter(n=>{var r;return!((r=this.remoteDataChannelMap.get(e))!==null&&r!==void 0&&r.get(n.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(n=>{var r;this.remoteDataChannelMap.has(e)?(r=this.remoteDataChannelMap.get(e))===null||r===void 0||r.set(n.id,n):this.remoteDataChannelMap.set(e,new Map([[n.id,n]]));let s=this.pendingRemoteDataChannels.findIndex(c=>{let{user:l,id:d}=c;return l.uid===e.uid&&d===n.id});s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),i.map(n=>n.id)}async subscribe(e,t,i,n,r){var s;if(!this.connection||this.state!==Ht.Connected)throw new de(M.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(e))!==null&&s!==void 0&&s.has(t))return;let c,l,d,h,f=this.connection.getPreMedia(i);if(f)C.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),d=f.transceiver,c=f.track,l=f.mid,h=f.player,f.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:f.firstVideoRender});else if(r){let y=r.find(O=>{let{stream_type:N}=O;return N===t});if(!y)throw new de(M.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));let D=await this.connection.receive(t,y.ssrcs,String(e._uintid),y.attributes);this.connection instanceof Qa&&(d=D.transceiver),c=D.track,l=D.id}else{let y=await this.connection.receive(t,[{ssrcId:i,rtx:n}],String(e._uintid),void 0);this.connection instanceof Qa&&(d=y.transceiver),c=y.track,l=y.id}if(t===ke.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(c):(e._audioTrack=new vm(c,e.uid,e._uintid,this.store),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),d&&e._audioTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(c):(e._videoTrack=new Sm(c,e.uid,e._uintid,this.store,h),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(Xa.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(Xa.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),h?e._videoTrack.once(Xa.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(Xa.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),d&&e._videoTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(e,e._videoTrack)),d&&j("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:y,interceptRemoteAudioFrame:D}=Yy();t==ke.VIDEO?await y(d.receiver,{onSei:j("ENABLE_VIDEO_SEI")&&(O=>{var N;return(N=e._videoTrack)===null||N===void 0?void 0:N._onSei(O)})}):t==ke.AUDIO&&await D(d.receiver,{enableTopn:!!j("ENABLE_AUDIO_TOPN"),enableMetadata:!!j("ENABLE_AUDIO_METADATA"),enablePts:!!j("ENABLE_AUDIO_PTS"),onMetadata:O=>{this.safeEmit(Ke.AudioMetadata,O)},onPts:O=>{this.safeEmit(Ke.AudioPts,O)}})}let E=this.remoteUserMap.get(e);E?E.set(t,l):this.remoteUserMap.set(e,new Map([[t,l]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let S=this.pendingRemoteTracks.findIndex(y=>{let{user:D,kind:O}=y;return D.uid===e.uid&&t===O});S!==-1&&(this.pendingRemoteTracks.splice(S,1),this.emit(Ke.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Ht.Connected)throw new de(M.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(r=>{var s;let{user:c,mediaType:l}=r;return!((s=this.remoteUserMap.get(c))!==null&&s!==void 0&&s.has(l))});let t=[],i=new Map;e.forEach(r=>{if(!this.connection)return;let s=this.connection.getPreMedia(r.ssrcId);if(s){let{track:c,mid:l,transceiver:d,player:h}=s;i.set(r.ssrcId,{track:c,id:l,transceiver:d,player:h})}else t.push(r)});let n=await this.connection.batchReceive(t.map(r=>{let{user:s,mediaType:c,ssrcId:l,rtxSsrcId:d}=r;return{kind:c,ssrcMsg:[{ssrcId:l,rtx:d}],mslabel:String(s._uintid)}}));t.forEach((r,s)=>{i.set(r.ssrcId,n[s])});for(let{user:r,mediaType:s,ssrcId:c}of e){let l=i.get(c);if(!l)return void C.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(r.uid," subscribe data,").concat(s,", ").concat(c));let{track:d,id:h,transceiver:f,player:E}=l;if(f&&j("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:O}=Yy();s==ke.VIDEO?await D(f.receiver,{onSei:j("ENABLE_VIDEO_SEI")&&(N=>{var k;return(k=r._videoTrack)===null||k===void 0?void 0:k._onSei(N)})}):s==ke.AUDIO&&await O(f.receiver,{enableTopn:!!j("ENABLE_AUDIO_TOPN"),enableMetadata:!!j("ENABLE_AUDIO_METADATA"),enablePts:!!j("ENABLE_AUDIO_PTS"),onMetadata:N=>{this.safeEmit(Ke.AudioMetadata,N)},onPts:N=>{this.safeEmit(Ke.AudioPts,N)}})}if(s===ke.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(d):(r._audioTrack=new vm(d,r.uid,r._uintid,this.store),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),f&&r._audioTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(d):(r._videoTrack=new Sm(d,r.uid,r._uintid,this.store,E),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),f&&r._videoTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(r,r._videoTrack)),j("ENABLE_VIDEO_SEI")&&f){let{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:O}=Yy();s==ke.VIDEO?await D(f.receiver,{onSei:N=>{var k;(k=r._videoTrack)===null||k===void 0||k._onSei(N)}}):s==ke.AUDIO&&await O(f.receiver)}let S=this.remoteUserMap.get(r);S?S.set(s,h):this.remoteUserMap.set(r,new Map([[s,h]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadInboundStats();let y=this.pendingRemoteTracks.findIndex(D=>{let{user:O,kind:N}=D;return O.uid===r.uid&&s===N});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(Ke.MediaReconnectEnd,r.uid))}}async unsubscribe(e,t,i){let n=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:d}=c;return t!==void 0?l.uid===e.uid&&t===d:l.uid===e.uid});if(n.forEach(c=>{let l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.connection&&this.state===Ht.Connected||i||n.forEach(c=>{let{kind:l}=c;var d;if(l===ke.AUDIO)(d=e._audioTrack)===null||d===void 0||d._destroy(),e._audioTrack=void 0;else if(l===ke.VIDEO){var h;(h=e._videoTrack)===null||h===void 0||h._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Ht.Connected)return;let r=this.filterTobeUnSubscribedTracks(e,t);if(r.length===0)return;await this.connection.stopReceiving(r.map(c=>{let[,{id:l}]=c;return l}));let s=this.createUnsubscribeMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(c=>{let[l,{kind:d}]=c;var h,f;if(d===ke.VIDEO&&l._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),d===ke.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),i||((f=l._videoTrack)===null||f===void 0||f._destroy(),l._videoTrack=void 0);else if(d===ke.AUDIO){var E;this.unbindRemoteTrackEvents(l._audioTrack),!i&&((E=l._audioTrack)===null||E===void 0||E._destroy(),l._audioTrack=void 0)}}),s}async unsubscribeDataChannel(e,t){if(t.forEach(r=>{let s=this.pendingRemoteDataChannels.findIndex(c=>c.id===r.id);s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),!this.connection)return;let i=this.filterTobeUnSubscribedDataChannels(e,t);if(i.length===0)return;t.forEach(r=>{r._close()});let n=this.remoteDataChannelMap.get(e);return i.forEach(r=>{n&&n.delete(r.id)}),n&&n.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(r=>r.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(let{user:r,mediaType:s}of e){let c=this.pendingRemoteTracks.filter(l=>{let{user:d,kind:h}=l;return s!==void 0?d.uid===r.uid&&s===h:d.uid===r.uid});c.forEach(l=>{let d=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(d,1)}),t=t.concat(c)}if(!this.connection||this.state!==Ht.Connected)return void t.forEach(r=>{let{user:s,kind:c}=r;var l;if(c===ke.AUDIO)(l=s._audioTrack)===null||l===void 0||l._destroy(),s._audioTrack=void 0;else if(c===ke.VIDEO){var d;(d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0}});let i=xr(e).call(e,(r,s)=>{let{user:c,mediaType:l}=s,d=this.filterTobeUnSubscribedTracks(c,l);return r.concat(d)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(r=>{let[,{id:s}]=r;return s}));let n=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(r=>{let[s,{kind:c}]=r;var l,d;if(c===ke.VIDEO&&s._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),c===ke.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0;else if(c===ke.AUDIO){var h;this.unbindRemoteTrackEvents(s._audioTrack),(h=s._audioTrack)===null||h===void 0||h._destroy(),s._audioTrack=void 0}}),n}isPreSubScribe(e){return!this.connection||this.state!==Ht.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;let i=this.remoteUserMap.get(e);if(!i)return void C.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(t))return void C.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let n=t===ke.VIDEO?e._videoSSRC:e._audioSSRC;n!==void 0&&this.connection.setStatsRemoteVideoIsReady(n,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;let i=this.remoteUserMap.get(e);if(!i)return void C.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(t)||C.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){let t=this.localTrackMap.get(ge.LocalAudioTrack),i=t&&t.track;i&&i.metadata.push(e)}getAllTracks(e){let t=this.localTrackMap.get(ge.LocalAudioTrack);if(t?.track instanceof Ji){let i=t.track;return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return r!==ge.LocalAudioTrack}).filter(n=>{let[r]=n;return!(e&&r===ge.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[n]=i;return!(e&&n===ge.LocalVideoLowTrack)}).map(i=>{let[,{track:n}]=i;return n})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,i,n,r){if(e){let c=this.localTrackMap.get(ge.LocalAudioTrack),l=n?this.localTrackMap.get(ge.LocalVideoLowTrack):this.localTrackMap.get(ge.LocalVideoTrack);He.publish(this.store.sessionId,{eventElapse:Gn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c?.track.getTrackLabel(),videoName:l?.track.getTrackLabel(),screenshare:l?.track._hints.indexOf(Zt.SCREEN_TRACK)!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var s;i||(i=[]);let c=i.find(d=>d instanceof Oi),l=n?(s=this.localTrackMap.get(ge.LocalVideoTrack))===null||s===void 0?void 0:s.track:i.find(d=>d instanceof oi);He.publish(this.store.sessionId,{eventElapse:Gn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c?.getTrackLabel(),videoName:l?.getTrackLabel(),screenshare:l?._hints.indexOf(Zt.SCREEN_TRACK)!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(e,t,i,n){let r=n===ke.VIDEO?i._videoSSRC:i._audioSSRC;r&&He.subscribe(this.store.sessionId,{succ:e,ec:t,video:n===ke.VIDEO,audio:n===ke.AUDIO,peerid:i.uid,subscribeRequestid:r,p2pid:this.store.p2pId,eventElapse:Gn.measureFromSubscribeStart(this.store.clientId,r),preSsrc:this.isPreSubScribe(r)})}reset(){C.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Vn("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=iR(this.store),this.emit(Ke.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(ge.LocalAudioTrack);if(e?.track instanceof Ji){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(i=>{t.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Ht.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(ge.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(ge.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof oi||t&&t.track instanceof Oi?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}getRemoteMedia(e){var t;let i=Array.from(Fr(t=this.remoteUserMap).call(t)).find(n=>n.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[n]=i;return{uid:n.uid,level:n.audioTrack?100*n.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(ge.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=lt(e).call(e,(i,n)=>i.level-n.level),e}async disconnectForReconnect(){this.connection&&(C.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Ht.Reconnecting,j("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var i;t._videoTrack&&t._videoTrack._player&&((i=t._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=iR(this.store),this.emit(Ke.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[i,{track:n}]=e;switch(i){case ge.LocalVideoTrack:Ce(t=n._hints).call(t,Zt.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case ge.LocalAudioTrack:n instanceof Ji?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);case ge.LocalVideoLowTrack:}}),this.emit(Ke.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;Array.from(Fr(i).call(i)).forEach(n=>{this.setPendingRemoteMedia(t,n)}),this.emit(Ke.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,i]=e;Array.from(Fr(i).call(i)).forEach(n=>{this.setPendingRemoteDataChannel(t,n)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),C.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(let i of this.pendingRemoteDataChannels){let{user:n,id:r}=i;if((e instanceof Jd?e.uid:e)===n.uid&&r===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(let i of this.pendingRemoteTracks){let{user:n,kind:r}=i;if((e instanceof Jd?e.uid:e)===n.uid&&t===r)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Ka(function*(){if(!t.connection||t.state!==Ht.Connected)return;let i=yield Dt(t.mutex.lock("From P2PChannel.restartICE")),n;try{n=yield Dt(t.connection.restartICE(e));let s=yield Dt(n.next());if(s.done)return;let c=s.value,l=yield c;switch(bI(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Fn.UDP_TCP_RELAY:t._pcStatsUploadType=gl.UDP_TCP_RESTART;break;case Fn.TCP_RELAY:t._pcStatsUploadType=gl.TCP_RESTART;break;case Fn.RELAY:t._pcStatsUploadType=gl.RELAY_RESTART;break;default:t._pcStatsUploadType=gl.OLD_RESTART}t._isTryConnecting=!0,n.next(l)}catch(s){var r;(r=n)===null||r===void 0||r.throw(s)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=this.localTrackMap.get(ge.LocalVideoTrack),i=this.localTrackMap.get(ge.LocalAudioTrack),n=e.videoSend.find(y=>y.ssrc===t?.ssrcs[0].ssrcId),r=e.audioSend.find(y=>y.ssrc===i?.ssrcs[0].ssrcId);if(!n||!r)return 1;let s=va(this,Ke.NeedSignalRTT),c=n?n.rttMs:void 0,l=r?r.rttMs:void 0,d=c&&l?(c+l)/2:c||l,h=(d&&s?(d+s)/2:d||s)||0,f=100*e.sendPacketLossRate*.7/50+.3*h/1500,E=f<.17?1:f<.36?2:f<.59?3:f<.1?4:5,S=t?.track;if(S&&S._encoderConfig&&S._hints.indexOf(Zt.SCREEN_TRACK)===-1){let y=S._encoderConfig.bitrateMax,D=e.bitrate.actualEncoded;if(y&&D){let O=(1e3*y-D)/(1e3*y);return _k[O<.15?0:O<.3?1:O<.45?2:O<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[n]=i,r=n._audioSSRC,s=n._videoSSRC,c=e.audioRecv.find(D=>D.ssrc===r),l=e.videoRecv.find(D=>D.ssrc===s);if(!c&&!l)return void(t+=1);let d=va(this,Ke.NeedSignalRTT),h=e.rtt,f=(h&&d?(h+d)/2:h||d)||0,E=c?c.jitterMs:void 0,S=e.recvPacketLossRate,y=.7*S*100/50+.3*f/1500;E&&(y=.6*S*100/50+.2*f/1500+.2*E/400),t+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Ie((t,i)=>{this.handleMuteLocalTrack(e,t,i)})}async replaceTrack(e,t){var i;if(C.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Ht.Connected)return;let n=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:c}]=s;return e===c});if(!n)return;let r=n[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:r}]),this.bindLocalTrackEvents([{track:t,type:r}]),n[1].track=t),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(t,n[1].id)),this.isPlanB){let s=n[1];s.id=t._mediaStreamTrack.id,this.localTrackMap.set(r,s)}if(r===ge.LocalVideoTrack&&!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Lt().supportDualStreamEncoding){let s=this.localTrackMap.get(ge.LocalVideoLowTrack);if(s){let c=e._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=c,s.track._originMediaStreamTrack=c,await new Ie((l,d)=>{this.handleReplaceTrack(s.track,l,d,!0)})}}}filterTobePublishedTracks(e,t,i){let n=[],r=this.getAllTracks();e=sm(e=e.filter(d=>r.indexOf(d)===-1));let s,c=!1,l=this.localTrackMap.get(ge.LocalAudioTrack);for(let d of e){if(d instanceof oi&&(this.localTrackMap.has(ge.LocalVideoTrack)||c?new de(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(n.push({track:d,type:ge.LocalVideoTrack}),c=!0),t)){let h=this.getLowVideoTrack(d,i);n.push({track:h,type:ge.LocalVideoLowTrack})}if(d instanceof Oi)if(l){let h=l.track;if(h instanceof Ji)RI([d]),h.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0);else{let f=CI([h,d]);C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(f.getTrackId(),"]")),this.replaceTrack(h,f)}}else s instanceof Ji?(RI([d]),s.addAudioTrack(d)):s||!d._useAudioElement&&Lt().webAudioMediaStreamDest&&!d._bypassWebAudio?s=CI(s?[d,s]:[d]):s=d}return s&&(C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),n.push({track:s,type:ge.LocalAudioTrack})),n}filterTobeUnpublishedTracks(e){let t=[],i=this.getAllTracks();e=sm(e=e.filter(n=>i.indexOf(n)!==-1));for(let n of e){if(n instanceof Oi){let r=this.localTrackMap.get(ge.LocalAudioTrack);if(!r)continue;r.track instanceof Ji?(r.track.removeAudioTrack(n),this.unbindLocalAudioTrackEvents(n),r.track.trackList.length===0&&(t.push([ge.LocalAudioTrack,r]),r.track.close())):t.push([ge.LocalAudioTrack,r])}if(n instanceof oi){let r=this.localTrackMap.get(ge.LocalVideoTrack);if(!r)continue;t.push([ge.LocalVideoTrack,r]);let s=this.localTrackMap.get(ge.LocalVideoLowTrack);s&&t.push([ge.LocalVideoLowTrack,s])}}return t}filterTobePublishedDataChannels(e){return e=(e=sm(e)).filter(t=>this.localDataChannels.findIndex(i=>i.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=sm(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:i,type:n}=t;switch(n){case ge.LocalVideoTrack:i.addListener(je.GET_STATS,this.handleGetLocalVideoStats),i.addListener(je.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(je.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(je.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(je.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ge.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case ge.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Ji?e.trackList.forEach(i=>{i.addListener(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(je.GET_STATS,this.handleGetLocalAudioStats),i.addListener(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(je.GET_STATS,this.handleGetLocalAudioStats),e.addListener(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(je.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(je.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[i,{track:n}]=t;return{track:n,type:i}})),e.forEach(t=>{let{track:i,type:n}=t;switch(n){case ge.LocalVideoTrack:i.off(je.GET_STATS,this.handleGetLocalVideoStats),i.off(je.GET_RTC_STATS,this.handleGetRTCStats),i.off(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(je.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(je.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(je.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ge.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case ge.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ji?e.trackList.forEach(t=>{t.off(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(je.GET_STATS,this.handleGetLocalAudioStats),t.off(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(je.GET_STATS,this.handleGetLocalAudioStats),e.off(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(je.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(je.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Sm&&t.addListener(je.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),t instanceof vm&&t.addListener(je.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(je.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;i.has(ke.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),i.has(ke.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((i,n)=>{var r;let s,c,{track:l,type:d}=i;switch(d){case ge.LocalAudioTrack:s=Wt.Audio,c={dtx:l instanceof Gg&&l._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ge.LocalVideoTrack:s=Ce(r=l._hints).call(r,Zt.SCREEN_TRACK)?Wt.Screen:Wt.High,c=fc(fc({},Lk(l)),{},{codec:this.store.codec,svc_mode:Gy()});break;case ge.LocalVideoLowTrack:s=Wt.Low,c=fc(fc({},Lk(l)),{},{codec:this.store.codec,svc_mode:Gy()})}return{stream_type:s,attributes:c,ssrcs:t[n]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var i;let n,[r,{track:s,ssrcs:c,id:l}]=t;switch(r){case ge.LocalVideoTrack:n=Ce(i=s._hints).call(i,Zt.SCREEN_TRACK)?Wt.Screen:Wt.High;break;case ge.LocalAudioTrack:n=Wt.Audio;break;case ge.LocalVideoLowTrack:n=Wt.Low}return{stream_type:n,ssrcs:c,mid:l}})}assignLocalTracks(e,t){e.forEach((i,n)=>{let{track:r,type:s}=i;this.localTrackMap.set(s,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[i]=t;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Ke.PeerConnectionStateChange,t),t==="connecting"&&e instanceof Qa&&!bi()&&j("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},j("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Qa&&wM(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=gl.DISCONNECTED_OR_FAILED,va(this,Ke.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){let i=this.pendingLocalTracks.map(r=>r.getTrackId()),n=this.pendingLocalDataChannels.map(r=>"dc_".concat(r.id));He.reportApiInvoke(this.store.sessionId,{name:Li.REPUB_AFTER_PC_CONNECTED,options:i.concat(n),tag:_i.TRACER}).onSuccess(),this.republish()}if(j("NEW_ICE_RESTART")&&e instanceof Qa&&!bi()&&!this._forceTurn){if(Ce(Ak).call(Ak,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let i=r=>{bI(e)&&(C.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(r)),va(this,Ke.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ke.RequestRestartICE,r))},n=()=>{bI(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),C.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Ke.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{IM(e,i,n)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&j("ICE_RESTART")&&va(this,Ke.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ke.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Ke.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Ke.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),He.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:_i.TRACER}).onSuccess(),this.emit(Ke.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var i;let n=Array.from(Fr(i=this.remoteUserMap).call(i)).find(s=>s._audioSSRC===t);var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),(r=n.audioTrack)===null||r===void 0||r.emit(Xa.FIRST_FRAME_DECODED),He.firstRemoteFrame(this.store.sessionId,nn.FIRST_AUDIO_DECODE,fi.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:Gn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var i;let n=Array.from(Fr(i=this.remoteUserMap).call(i)).find(r=>r._audioSSRC===t);n&&He.firstRemoteFrame(this.store.sessionId,nn.FIRST_AUDIO_RECEIVED,fi.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:Gn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,i,n)=>{var r;let s=Array.from(Fr(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);s&&this.store.firstVideoFrameDecoded(s.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,i,n)},e.onFirstVideoRender=t=>{var i;let n=Array.from(Fr(i=this.remoteUserMap).call(i)).find(r=>r._videoSSRC===t);n&&(this.store.firstVideoFrameDecoded(n.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(n))},e.onFirstVideoReceived=t=>{var i;let n=Array.from(Fr(i=this.remoteUserMap).call(i)).find(r=>r._videoSSRC===t);n&&(this.store.firstVideoFrameDecoded(n.uid,{firstReceived:Date.now()}),He.firstRemoteFrame(this.store.sessionId,nn.FIRST_VIDEO_RECEIVED,fi.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:Gn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(t,i)=>{let n=t.candidateType==="relay",r=i.candidateType==="relay";i.candidateType!=="unknown"&&n===r||this.emit(Ke.ConnectionTypeChange,n),C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(zd(i))," -> ").concat(JSON.stringify(zd(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,i)=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(zd(i))," -> ").concat(JSON.stringify(zd(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let t=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return fc(fc({},t),i)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof Qa&&(function(t){Pm.delete(t.id),wM(t)})(e),e.close(),this.emit(Ke.PeerConnectionStateChange,"closed"),(function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0})(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let i=this.localTrackMap.get(ge.LocalAudioTrack);if(e instanceof Oi&&i?.track instanceof Ji)return i.track.isActive||t.push([ge.LocalAudioTrack,i]),t;let n=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return e===s});if(n&&(t.push(n),n[0]===ge.LocalVideoTrack)){let r=this.localTrackMap.get(ge.LocalVideoLowTrack);r&&t.push([ge.LocalVideoLowTrack,r])}return t}filterTobeUnmutedTracks(e){let t=[],i=this.localTrackMap.get(ge.LocalAudioTrack);if(e instanceof Oi&&i?.track instanceof Ji)return i.track.isActive&&t.push([ge.LocalAudioTrack,i]),t;let n=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return e===s});if(n)if(n[0]===ge.LocalVideoTrack){t.push(n);let r=this.localTrackMap.get(ge.LocalVideoLowTrack);r&&t.push([ge.LocalVideoLowTrack,r])}else t.push(n);return t}createMuteMessage(e){return e.map(t=>{var i;let n,[r,{track:s,ssrcs:c,id:l}]=t;switch(r){case ge.LocalAudioTrack:n=Wt.Audio;break;case ge.LocalVideoTrack:n=Ce(i=s._hints).call(i,Zt.SCREEN_TRACK)?Wt.Screen:Wt.High;break;case ge.LocalVideoLowTrack:n=Wt.Low}return{stream_type:n,ssrcs:c,mid:l}})}createUnmuteMessage(e){return e.map(t=>{var i;let n,[r,{track:s,ssrcs:c,id:l}]=t;switch(r){case ge.LocalAudioTrack:n=Wt.Audio;break;case ge.LocalVideoTrack:n=Ce(i=s._hints).call(i,Zt.SCREEN_TRACK)?Wt.Screen:Wt.High;break;case ge.LocalVideoLowTrack:n=Wt.Low}return{stream_type:n,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(e,t){let i=[],n=this.remoteUserMap.get(e);if(!n)return i;if(t){let r=n.get(t);if(!r)return i;i.push([e,{kind:t,id:r}])}else Array.from(n.entries()).forEach(r=>{let[s,c]=r;i.push([e,{kind:s,id:c}])});return i}filterTobeUnSubscribedDataChannels(e,t){let i=[];return t.forEach(n=>{var r;(r=this.remoteDataChannelMap.get(e))!==null&&r!==void 0&&r.has(n.id)&&i.push(n)}),i}createUnsubscribeMessage(e){let t=[];return e.forEach(i=>{let[n,{kind:r,id:s}]=i;switch(r){case ke.VIDEO:return void(n._videoSSRC&&t.push({stream_type:ke.VIDEO,ssrcId:n._videoSSRC}));case ke.AUDIO:return void(n._audioSSRC&&t.push({stream_type:ke.AUDIO,ssrcId:n._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){let t=new Map;return e.forEach(i=>{let[n,{kind:r}]=i;if(t.has(n)){let s=t.get(n);r===ke.VIDEO?s|=cn.Video:s|=cn.Audio,t.set(n,s)}else r===ke.VIDEO?t.set(n,cn.Video):t.set(n,cn.Audio)}),{users:Array.from(t.entries()).map(i=>{let[n,r]=i;return{stream_id:n.uid,stream_type:r}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[i,{kind:n}]=t,r=this.remoteUserMap.get(i);r&&(r.delete(n),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(ge.LocalVideoTrack),i=this.localTrackMap.get(ge.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Ie((n,r)=>{this.handleUpdateVideoEncoder(t.track,n,r,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Ie((n,r)=>{this.handleUpdateVideoEncoder(i.track,n,r,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof Qa&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof Qa&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,i){return e.map((n,r)=>{var s;let{stream_type:c}=n,l=(s=t.find(d=>{let{stream_type:h}=d;return c===h}))===null||s===void 0?void 0:s.attributes;if(l&&j("DISABLE_SCREEN_SHARE_REMB")){let d=i[r]._hints;(Ce(d).call(d,Zt.SCREEN_TRACK)||Ce(d).call(d,Zt.SCREEN_LOW_TRACK))&&(l.remb=!1,C.debug("disable remb for screen share, hints:",d))}return l})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof Oi){var t;let n=this.filterTobeUnmutedTracks(e[i]);if(n.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(n.map(s=>{let[,{id:c}]=s;return c})));let r=this.createUnmuteMessage(n);return void await $t(this,Ke.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Ke.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Ke.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Sn(dw(this.dtlsFailedCount,zi)),this.emit(Ke.RequestReconnect)}async reconnectP2P(){let e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await On(this,Ke.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Ke.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(ge.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof oi)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof oi).length>1)throw new de(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Oi).length>1&&(e.some(t=>t instanceof Oi&&t._bypassWebAudio)||!Lt().webAudioMediaStreamDest))throw new de(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof oi&&this.pendingLocalTracks.some(i=>i instanceof oi))throw new de(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Oi&&this.pendingLocalTracks.some(i=>i instanceof Oi)&&(!Lt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Oi&&i._bypassWebAudio)))throw new de(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var i;let n=!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Lt().supportDualStreamEncoding,r=fc(fc({},{width:160,height:120,framerate:15,bitrate:50}),t),s;s=n?e._mediaStreamTrack.clone():AI(e,r);let c=ei(8,"track-low-"),l=new oi(s,fc(fc({},n&&{scaleResolutionDownBy:sI(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,c);return l.on(Ph.TRANSCEIVER_UPDATED,d=>{e._updateRtpTransceiver(d,pm.LOW_STREAM)}),l._hints.push(Zt.LOW_STREAM),Ce(i=e._hints).call(i,Zt.SCREEN_TRACK)&&l._hints.push(Zt.SCREEN_LOW_TRACK),e.on("sei-to-send",d=>{l.emit("sei-to-send",d)}),e.addListener(je.NEED_CLOSE,()=>{l.close()}),l}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,i){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Qa){var r,s,c,l;let d=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:h,dtlsTransportState:f,peerConnectionState:E}=this.connection,{local:S,remote:y}=await this.connection.getSelectedCandidatePair();He.pcStats(this.store.sessionId,{startTime:d,eventElapse:e-d||0,iceconnectionsate:h,dtlsstate:f,connectionstate:E,intSucc:t?1:2,error:this._iceError||n||"",selectedLocalCandidateProtocol:(r=S?.protocol)!==null&&r!==void 0?r:"",selectedLocalCandidateType:(s=S.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(S.address,":").concat(S.port),selectedRemoteCandidateProtocol:(c=y.protocol)!==null&&c!==void 0?c:"",selectedRemoteCandidateType:(l=y.candidateType)!==null&&l!==void 0?l:"",selectedRemoteCandidateAddress:"".concat(y.address,":").concat(y.port),restartCnt:i,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){let t=this.store.keyMetrics,i=t.firstVideoFrameDecoded.find(f=>f.userId===e.uid);if(!i)return;let{isInternalUpload:n,isExternalUpload:r}=i;if(n&&r)return;let{subscribeEnd:s,firstPreRender:c,peerPublishDuration:l,peerPubStatusMs:d}=i,{firstRender:h=0}=i;if(s&&(h||c)&&l&&d){i.isInternalUpload=!0;let{playEnd:f}=i;f&&(i.isExternalUpload=!0);let{firstPreRender:E=0}=i;h=E||h;let S=e.videoTrack,y={peer:e._uintid,width:S?._videoWidth||0,height:S?._videoHeight||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:l,peerPubStatusMs:d,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:i.userJoinNotify||0,videoAddNotify:i.videoAddNotify||0,subscribeStart:i.subscribeStart||0,subscribeEnd:i.subscribeEnd||0,firstReceived:i.firstReceived||0,firstDecoded:i.firstDecoded||0,firstPreRender:E||0,firstRender:f?Math.max(h,f):Math.max(h,s),playStart:i.playStart||0,playEnd:i.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:iP(this.store)};He.firstXLAPeerFirstVideoFrame(this.store.sessionId,y)}}reportVideoFirstFrameDecoded(e,t,i,n){var r;let s=Array.from(Fr(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===e);if(s){n||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());let c=this.store.keyMetrics,l=c.subscribe.find(d=>d.userId===s.uid&&d.type==="video");He.firstRemoteVideoDecode(this.store.sessionId,nn.FIRST_VIDEO_DECODE,fi.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:i,subscribeElapse:Gn.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:l?.subscribeEnd||0,subscriberStart:l?.subscribeStart||0,videoAddNotify:l?.streamAdded||0,state:n?1:0,firstFrame:l?.firstFrame||0})}}async remoteMediaSsrcChanged(e,t,i){if(!this.connection)return!1;let n=this.remoteUserMap.get(e);if(!n)return!1;let r=n.get(t);if(!r)return!1;let s=await this.connection.getRemoteSSRC(r);return s!==void 0&&s!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:i}]=e;t===ge.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,pm.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},Fe(vt.prototype,"startP2PConnection",[sr],Object.getOwnPropertyDescriptor(vt.prototype,"startP2PConnection"),vt.prototype),Fe(vt.prototype,"connect",[sr],Object.getOwnPropertyDescriptor(vt.prototype,"connect"),vt.prototype),Fe(vt.prototype,"updateRemoteRTPCapabilities",[sr],Object.getOwnPropertyDescriptor(vt.prototype,"updateRemoteRTPCapabilities"),vt.prototype),Fe(vt.prototype,"publishDataChannel",[sr],Object.getOwnPropertyDescriptor(vt.prototype,"publishDataChannel"),vt.prototype),Fe(vt.prototype,"unpublish",[sr],Object.getOwnPropertyDescriptor(vt.prototype,"unpublish"),vt.prototype),Fe(vt.prototype,"unpublishDataChannel",[sr],Object.getOwnPropertyDescriptor(vt.prototype,"unpublishDataChannel"),vt.prototype),Fe(vt.prototype,"unpublishLowStream",[sr],Object.getOwnPropertyDescriptor(vt.prototype,"unpublishLowStream"),vt.prototype),Fe(vt.prototype,"subscribeDataChannel",[sr],Object.getOwnPropertyDescriptor(vt.prototype,"subscribeDataChannel"),vt.prototype),Fe(vt.prototype,"subscribe",[sr],Object.getOwnPropertyDescriptor(vt.prototype,"subscribe"),vt.prototype),Fe(vt.prototype,"massSubscribe",[sr],Object.getOwnPropertyDescriptor(vt.prototype,"massSubscribe"),vt.prototype),Fe(vt.prototype,"unsubscribe",[sr],Object.getOwnPropertyDescriptor(vt.prototype,"unsubscribe"),vt.prototype),Fe(vt.prototype,"unsubscribeDataChannel",[sr],Object.getOwnPropertyDescriptor(vt.prototype,"unsubscribeDataChannel"),vt.prototype),Fe(vt.prototype,"massUnsubscribe",[sr],Object.getOwnPropertyDescriptor(vt.prototype,"massUnsubscribe"),vt.prototype),Fe(vt.prototype,"muteRemote",[sr],Object.getOwnPropertyDescriptor(vt.prototype,"muteRemote"),vt.prototype),Fe(vt.prototype,"unmuteRemote",[sr],Object.getOwnPropertyDescriptor(vt.prototype,"unmuteRemote"),vt.prototype),Fe(vt.prototype,"hasRemoteMediaWithLock",[sr],Object.getOwnPropertyDescriptor(vt.prototype,"hasRemoteMediaWithLock"),vt.prototype),Fe(vt.prototype,"disconnectForReconnect",[sr],Object.getOwnPropertyDescriptor(vt.prototype,"disconnectForReconnect"),vt.prototype),Fe(vt.prototype,"updateBitrateLimit",[sr],Object.getOwnPropertyDescriptor(vt.prototype,"updateBitrateLimit"),vt.prototype),Fe(vt.prototype,"remoteMediaSsrcChanged",[sr],Object.getOwnPropertyDescriptor(vt.prototype,"remoteMediaSsrcChanged"),vt.prototype),vt);function sr(e,t,i){let n=e[t];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let r=this.mutex,s=await r.lock("From P2PChannel.".concat(t));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await n.apply(this,l)}finally{s()}},i}function DM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function LM(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?DM(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):DM(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}let L7=Date.now(),P7=20,II=new Map,oR=new Map;async function PM(e){let t=II.get(e),i=Array.isArray(t)&&t[t.length-1],n=oR.get(e);if(!i)return void(n.isSyncing=!1);let r={uid:i.uid,payload:i.payload};n.firstRecvTs===0&&(n.firstRecvTs=i.recvTs,n.firstSendTs=i.sendTs);let s=i.sendTs-n.firstSendTs,c=s-(Date.now()-n.firstRecvTs);c>0&&(n.firstRecvTs=Date.now()-s);let l=i.mediaDelay+c;l<=0?(t.pop(),xM(i.context,r),l=0):l=Math.min(l,P7),setTimeout(()=>t.length&&PM(e),l)}function xM(e,t){e.safeEmit(yt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function x7(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return xM(i,{uid:e.uid,payload:e.payload});let n="".concat(i.id,"-").concat(e.uid),r=II.get(n)||[],s=r.findIndex(h=>e.sendTs>=h.sendTs),c=LM(LM({},e),{},{context:i,mediaDelay:t,recvTs:Date.now()});s===-1?r.push(c):r.splice(s,0,c),II.set(n,r);let l=!1;var d;oR.has(n)?l=!((d=oR.get(n))===null||d===void 0||!d.isSyncing):oR.set(n,{isSyncing:l,firstRecvTs:0,firstSendTs:0}),l||PM(n)}let k7=wt().name;function kM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function MM(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?kM(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):kM(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}let xm="websdk_ng_cache_parameter",M7=j("MAX_PRELOAD_ASYNC_LENGTH"),U7=1e4,Hh=new Map,Wh=[],OI=null,NI=0,DI=0,cR=new Map,V7=(function(e,t){let i=[],n=0,r=async()=>{let s=i.shift();s&&await s(),i.length>0&&n<t?r():n--};return async function(){for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];return new Ie(async(d,h)=>{i.push(async()=>{try{let f=await e(...c);d(f)}catch(f){h(f)}}),n<t&&(n++,r())})}})(UM,M7),LI=br.CancelToken.source();async function UM(e,t,i,n,r,s){try{if(!j("ENABLE_PRELOAD"))return;if(!Lt().supportWebCrypto)return void Vd(()=>{C.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new de(M.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&gn(i,"token",1,2047),gn(e,"appid",1,2047),My(t),n&&Uy(n);let c=Dh();C.debug("preload channel ".concat(t,", uid is ").concat(n));let l={appId:e,cname:t,token:i||e,uid:typeof n!="string"?n:null,sid:c,proxyServer:r},d,h;typeof n=="string"?(l.stringUid=n,[h,d]=await Ie.all([T7(n,{sid:c,appId:e},LI.token),lM(MM(MM({},l),{},{token:i||e,uid:0}),LI.token)]),l.uid=h.uid,d.gatewayInfo.uid=l.uid,d.gatewayInfo.res.uid=l.uid):(s&&(l.stringUid=s),d=await lM(l,LI.token));let f={sid:c,appId:e,cname:t,token:i||e,uid:l.stringUid||n,intUid:l.uid||d.gatewayInfo.uid,stringUid:l.stringUid,ts:Date.now(),sua:h,ap:d};await(async function(E){let S;try{E.uid&&jM({appId:E.appId,cname:E.cname,token:E.token,uid:E.uid,stringUid:E.stringUid});let y=HM(E),D=await(async function(N,k){try{let U=await window.crypto.subtle.importKey("raw",OL(k),"AES-GCM",!1,["encrypt"]),B=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},U,Nh(window.btoa(JSON.stringify(N))));return jd(new Uint8Array(B))}catch{return}})(E,E.token||E.appId);if(!D)return;S=GM(xm);let O=S?JSON.parse(S):[];O.push({[y]:D}),O.length>j("AP_CACHE_NUM")&&O.shift(),lR(xm,JSON.stringify(O))}catch(y){C.warn("Error caching server parameters:",y.message),lR(xm,"")}})(f),NI++}catch(c){throw DI++,(function(l){OI||(OI=window.setTimeout(()=>{let h="";cR.forEach((f,E)=>{h+="".concat(E,": ").concat(f," ;")}),He.reportApiInvoke(null,{name:Li.PRELOAD,options:{success:NI,failed:DI,err:h}}).onError(l),NI=0,DI=0,cR.clear(),OI=null},U7));let d=cR.get(l.code)||0;cR.set(l.code,d+1)})(c),c}}async function VM(e){try{if(j("AP_REQUEST_DETAIL")||j("ENABLE_ROLE_SELECT_EDGE"))return;let t=jM(e);if(!t||e.cloudProxyServer!=="disabled")return;let i=await(async function(n,r){try{let s=await window.crypto.subtle.importKey("raw",OL(r),"AES-GCM",!1,["decrypt"]),c=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,Nh(n));return JSON.parse(window.atob(jd(new Uint8Array(c))))}catch{return}})(t,e.token||e.appId);if(!i||!(function(n,r){return n.cname===r.cname&&n.appId===r.appId&&n.token===r.token?r.stringUid?n.stringUid===r.stringUid:typeof r.uid=="number"?n.uid===r.uid:n.uid==r.uid:!1})(i,e))return;if(i&&Date.now()-i.ts<j("AP_CACHE_LIFETIME"))return i}catch(t){C.warn("Error get preloadInfo",t.message)}}function jM(e){let t;try{if(t=GM(xm),!t)return;let i=JSON.parse(t),n=HM(e),r=(function(c,l){for(let d=c.length-1;d>=0;d--)if(l(c[d]))return d;return-1})(i,c=>n in c);if(r===-1)return;let s=i.splice(r,1)[0];return lR(xm,JSON.stringify(i)),s[n]}catch(i){C.warn("Error delete preload info: ".concat(t),i.message),lR(xm,"")}}function PI(e){if(e){let t=Hh.get(e);t&&(window.clearTimeout(t),t=null,Hh.delete(e)),Ce(Wh).call(Wh,e)||e.cloudProxyServer!=="disabled"||Wh.push(e)}if(Hh.size<j("AP_CACHE_NUM")&&Wh.length>0){let t=Wh.shift();Hh.set(t,window.setTimeout(async()=>{let{appId:i,cname:n,token:r,stringUid:s,uid:c,proxyServer:l}=t;try{await V7(i,n,r,c,l,s),Hh.has(t)&&PI(t)}catch(d){C.warn("update preload failed",d.message),BM(t)}},j("AP_UPDATE_INTERVAL")))}}function BM(e){let t=Wh.indexOf(e);t!==-1&&Wh.splice(t,1);let i=Hh.get(e);i&&(window.clearTimeout(i),i=null,Hh.delete(e),PI())}function FM(e,t){let i=e.sua,n=e.ap;t&&i&&He.reqUserAccount(e.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:t,uid:e.intUid,errorCode:null,extend:i.req}),He.reportResourceTiming(e.ap.url,e.sid),He.joinWebProxyAP(e.sid,{lts:n.requestTime,elapse:n.elapse,sucess:1,apServerAddr:n.url,turnServerAddrList:n.proxyInfo.addresses.map(r=>r.ip).join(","),eventType:"disabled",unilbsServerIds:[Fi.CHOOSE_SERVER,Fi.CLOUD_PROXY_FALLBACK].toString()}),He.joinChooseServer(e.sid,{lts:n.requestTime,elapse:n.elapse,succ:!0,csAddr:n.url,opid:n.opid,serverList:n.gatewayInfo.gatewayAddrs.map(r=>r.address),ec:null,cid:n.gatewayInfo.cid.toString(),uid:n.gatewayInfo.uid.toString(),csIp:n.gatewayInfo.csIp,unilbsServerIds:[Fi.CHOOSE_SERVER].toString(),isHttp3:n.isHttp3})}function GM(e){return window.atob(window.localStorage.getItem(e)||"")}function lR(e,t){window.localStorage.setItem(e,window.btoa(t))}function HM(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),ML(t)}function j7(e){let t=(function(){let i=G7.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}})();return(function(i,n){let r=i.appId;r!==void 0&&(Gi(n,10),Qd(n,r));let s=i.cid;s!==void 0&&(Gi(n,16),Gi(n,s));let c=i.cname;c!==void 0&&(Gi(n,26),Qd(n,c));let l=i.deviceId;l!==void 0&&(Gi(n,34),Qd(n,l));let d=i.elapse;d!==void 0&&(Gi(n,40),$d(n,d));let h=i.fileSize;h!==void 0&&(Gi(n,48),$d(n,km(h)));let f=i.height;f!==void 0&&(Gi(n,56),$d(n,km(f)));let E=i.jpg;E!==void 0&&(Gi(n,66),Gi(n,E.length),zM(n,E));let S=i.networkType;S!==void 0&&(Gi(n,72),$d(n,km(S)));let y=i.osType;y!==void 0&&(Gi(n,80),$d(n,km(y)));let D=i.requestId;D!==void 0&&(Gi(n,90),Qd(n,D));let O=i.sdkVersion;O!==void 0&&(Gi(n,98),Qd(n,O));let N=i.sequence;N!==void 0&&(Gi(n,104),$d(n,km(N)));let k=i.sid;k!==void 0&&(Gi(n,114),Qd(n,k));let U=i.timestamp;U!==void 0&&(Gi(n,120),$d(n,U));let B=i.uid;B!==void 0&&(Gi(n,128),Gi(n,B));let J=i.vid;J!==void 0&&(Gi(n,136),Gi(n,J));let K=i.width;K!==void 0&&(Gi(n,144),$d(n,km(K)));let H=i.service;H!==void 0&&(Gi(n,152),Gi(n,H));let ee=i.callbackData;ee!==void 0&&(Gi(n,162),Gi(n,ee.length),zM(n,ee));let ue=i.ticket;ue!==void 0&&(Gi(n,170),Qd(n,ue));let me=i.vendorConfigs;me!==void 0&&(Gi(n,178),Qd(n,me))})(e,t),(function(i){let n=i.bytes,r=i.limit;return n.length===r?n:n.subarray(0,r)})(t)}function B7(e){return(function(i){let n={};e:for(;!H7(i);){let r=n0(i);switch(r>>>3){case 0:break e;case 1:n.code=n0(i);break;case 2:n.msg=KM(i,n0(i));break;case 3:n.requestId=KM(i,n0(i));break;case 4:n.timestamp=W7(i,!1);break;default:F7(i,7&r)}}return n})({bytes:t=e,offset:0,limit:t.length});var t}function F7(e,t){switch(t){case 0:for(;128&Ls(e););break;case 2:xI(e,n0(e));break;case 5:xI(e,4);break;case 1:xI(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function km(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let G7=[];function xI(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function H7(e){return e.offset>=e.limit}function dR(e,t){let i=e.bytes,n=e.offset,r=e.limit,s=n+t;if(s>i.length){let c=new Uint8Array(2*s);c.set(i),e.bytes=c}return e.offset=s,s>r&&(e.limit=s),n}function WM(e,t){let i=e.offset;if(i+t>e.limit)throw new Error("Read past limit");return e.offset+=t,i}function zM(e,t){let i=dR(e,t.length);e.bytes.set(t,i)}function KM(e,t){let i=WM(e,t),n=String.fromCharCode,r=e.bytes,s="",c="";for(let l=0;l<t;l++){let d,h,f,E,S=r[l+i];128&S?(224&S)==192?l+1>=t?c+=s:(d=r[l+i+1],(192&d)!=128?c+=s:(E=(31&S)<<6|63&d,E<128?c+=s:(c+=n(E),l++))):(240&S)==224?l+2>=t?c+=s:(d=r[l+i+1],h=r[l+i+2],(49344&(d|h<<8))!=32896?c+=s:(E=(15&S)<<12|(63&d)<<6|63&h,E<2048||E>=55296&&E<=57343?c+=s:(c+=n(E),l+=2))):(248&S)==240?l+3>=t?c+=s:(d=r[l+i+1],h=r[l+i+2],f=r[l+i+3],(12632256&(d|h<<8|f<<16))!=8421504?c+=s:(E=(7&S)<<18|(63&d)<<12|(63&h)<<6|63&f,E<65536||E>1114111?c+=s:(E-=65536,c+=n(55296+(E>>10),56320+(1023&E)),l+=3))):c+=s:c+=n(S)}return c}function Qd(e,t){let i=t.length,n=0;for(let c=0;c<i;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<i&&(l=(l<<10)+t.charCodeAt(++c)-56613888),n+=l<128?1:l<2048?2:l<65536?3:4}Gi(e,n);let r=dR(e,n),s=e.bytes;for(let c=0;c<i;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<i&&(l=(l<<10)+t.charCodeAt(++c)-56613888),l<128?s[r++]=l:(l<2048?s[r++]=l>>6&31|192:(l<65536?s[r++]=l>>12&15|224:(s[r++]=l>>18&7|240,s[r++]=l>>12&63|128),s[r++]=l>>6&63|128),s[r++]=63&l|128)}}function Ls(e){return e.bytes[WM(e,1)]}function YM(e,t){let i=dR(e,1);e.bytes[i]=t}function n0(e){let t,i=0,n=0;do t=Ls(e),i<32&&(n|=(127&t)<<i),i+=7;while(128&t);return n}function Gi(e,t){for(t>>>=0;t>=128;)YM(e,127&t|128),t>>>=7;YM(e,t)}function W7(e,t){let i,n=0,r=0,s=0;return i=Ls(e),n=127&i,128&i&&(i=Ls(e),n|=(127&i)<<7,128&i&&(i=Ls(e),n|=(127&i)<<14,128&i&&(i=Ls(e),n|=(127&i)<<21,128&i&&(i=Ls(e),r=127&i,128&i&&(i=Ls(e),r|=(127&i)<<7,128&i&&(i=Ls(e),r|=(127&i)<<14,128&i&&(i=Ls(e),r|=(127&i)<<21,128&i&&(i=Ls(e),s=127&i,128&i&&(i=Ls(e),s|=(127&i)<<7))))))))),{low:n|r<<28,high:r>>>4|s<<24,unsigned:t}}function $d(e,t){let i=t.low>>>0,n=(t.low>>>28|t.high<<4)>>>0,r=t.high>>>24,s=r===0?n===0?i<16384?i<128?1:2:i<1<<21?3:4:n<16384?n<128?5:6:n<1<<21?7:8:r<128?9:10,c=dR(e,s),l=e.bytes;switch(s){case 10:l[c+9]=r>>>7&1;case 9:l[c+8]=s!==9?128|r:127&r;case 8:l[c+7]=s!==8?n>>>21|128:n>>>21&127;case 7:l[c+6]=s!==7?n>>>14|128:n>>>14&127;case 6:l[c+5]=s!==6?n>>>7|128:n>>>7&127;case 5:l[c+4]=s!==5?128|n:127&n;case 4:l[c+3]=s!==4?i>>>21|128:i>>>21&127;case 3:l[c+2]=s!==3?i>>>14|128:i>>>14&127;case 2:l[c+1]=s!==2?i>>>7|128:i>>>7&127;case 1:l[c]=s!==1?128|i:127&i}}let qM={},XM={},uR=4294967296,z7=uR*uR,K7=z7/2;ZM(0,!0);let JM=ZM(0),Y7=r0(0,-2147483648,!1),q7=r0(-1,2147483647,!1);function ZM(e,t){let i,n,r;return t?(r=0<=(e>>>=0)&&e<256)&&(n=XM[e],n)?n:(i=r0(e,0,!0),r&&(XM[e]=i),i):(r=-128<=(e|=0)&&e<128)&&(n=qM[e],n)?n:(i=r0(e,e<0?-1:0,!1),r&&(qM[e]=i),i)}function r0(e,t,i){return{low:0|e,high:0|t,unsigned:!!i}}function QM(e,t){if(isNaN(e))return JM;{if(e<=-9223372036854776e3)return Y7;if(e+1>=K7)return q7}return e<0?JM:r0(e%uR|0,e/uR|0,t)}function $M(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}class kI extends vi{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let i=this._connectionState;this._connectionState=t,this.emit(fo.CONNECTION_STATE_CHANGE,t,i)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var i;super(),L(this,"name","AgoraRTCImageModeration"),L(this,"_connectionState",Za.CONNECTING),L(this,"_sequence",0),L(this,"_moderationStartTime",void 0),L(this,"_workerConnection",void 0),L(this,"_workerMessageLengthLimit",void 0),L(this,"_qualityRatio",void 0),L(this,"_connectInfo",void 0),L(this,"_cancelTokenSource",br.CancelToken.source()),L(this,"_retryConfig",void 0),L(this,"_moderationInterval",void 0),L(this,"_moderationTimer",null),L(this,"_moderationMode",1),L(this,"_quality",1),L(this,"_qualityTimer",null),L(this,"_ticket",void 0),L(this,"_moderationIntervalMinimum",void 0),L(this,"_uploadFailedNum",0),L(this,"_uploadNum",0),L(this,"_uploadTimer",null),L(this,"_extraInfo",void 0),L(this,"_vendor",""),L(this,"_encoder",new TextEncoder),L(this,"_moderationId",void 0),L(this,"inspectImage",()=>{if(this.connectionState!==Za.CONNECTED)throw new te(M.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Za.CONNECTED?this.requestToInspectImage():C.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=ei(5,"image-moderation-"),this._workerMessageLengthLimit=j("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=j("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=t.interval)!==null&&i!==void 0?i:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=j("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Yg("worker-"+this._moderationId,zi),this.on(fo.STATE_CHANGE,(n,r)=>{C.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Cm[n]," ").concat(r||""))}),this.handleWorkerEvents()}async init(t,i){this.emit(fo.STATE_CHANGE,Cm.CONNECT_AP),this._connectInfo=t;let n=this._cancelTokenSource.token;return this._retryConfig=i,new Ie((r,s)=>{this.on(fo.CONNECTION_STATE_CHANGE,(c,l)=>{c===Za.CONNECTED&&r()}),this.requestAP(t,n,i).then(c=>{this.connectWorker(c)}).catch(c=>{s(c)})})}updateConfig(t){var i;this._moderationInterval=(i=t.interval)!==null&&i!==void 0?i:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),C.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===Za.CONNECTED&&this.inspectImage()}async requestAP(t,i,n){let r=j("WEBCS_DOMAIN").map(d=>"https://".concat(d,"/api/v1")),s=await(function(d,h,f,E){let{appId:S,areaCode:y,cname:D,sid:O,token:N,uid:k}=h;Nm++;let U="moderation_plugin",B={service_name:U,json_body:JSON.stringify({appId:S,areaCode:y,cname:D,command:"allocateEdge",requestId:Nm,seq:Nm,sid:O,appToken:N,ts:Date.now(),uid:k+""})},J,K,H=d[0];return lo(async()=>{J=Date.now();let ee=await mo(H,{data:B,cancelToken:f,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(K=Date.now()-J,ee.code!==0){let ye=new te(M.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ee.code,{retry:!0,responseTime:K});throw C.error(ye.toString()),ye}let ue=JSON.parse(ee.json_body);if(ue.code!==200){let ye=new te(M.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(ue.code,", reason: ").concat(ue.reason),{code:ue.code,responseTime:K});throw C.error(ye.toString()),ye}if(!ue.servers||!Array.isArray(ue.servers)||ue.servers.length===0){let ye=new te(M.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:ue.code,responseTime:K});throw C.error(ye.toString()),ye}if(!ue.servers.some(ye=>!!ye.wss)){let ye=new te(M.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:ue.code,responseTime:K});throw C.error(ye.toString()),ye}let me=j("IMAGE_MODERATION_WORKER_HOST");return{addressList:ue.servers.map(ye=>{let{address:pt,wss:mt}=ye;if(pt&&mt)return"wss://".concat(pt.replace(/\./g,"-"),".").concat(me,":").concat(mt,"/moderation")}).filter(ye=>!!ye),workerToken:ue.workerToken,vid:ue.vid,ticket:ue.appTicket,responseTime:K}},(ee,ue)=>(He.apworkerEvent(O,{success:!0,sc:200,serviceName:U,responseDetail:JSON.stringify(ee.addressList),firstSuccess:ue===0,responseTime:K,serverIp:d[ue%d.length]}),!1),(ee,ue)=>(He.apworkerEvent(O,{success:!1,sc:ee.data&&ee.data.code||200,serviceName:U,responseTime:K,serverIp:d[ue%d.length]}),!!(ee.code!==M.OPERATION_ABORTED&&ee.code!==M.UNEXPECTED_RESPONSE||ee.data&&ee.data.retry)&&(H=d[(ue+1)%d.length],!0)),E)})(r,t,i,n);this.emit(fo.STATE_CHANGE,Cm.AP_CONNECTED);let{addressList:c,ticket:l}=s;return this._ticket=l,c}async connectWorker(t){this.emit(fo.STATE_CHANGE,Cm.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(ut.CONNECTED,async()=>{this.emit(fo.STATE_CHANGE,Cm.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Za.CONNECTED}),this._workerConnection.on(ut.CLOSED,()=>{this.connectionState=Za.CLOSED}),this._workerConnection.on(ut.FAILED,()=>{this.connectionState=Za.CLOSED}),this._workerConnection.on(ut.RECONNECTING,()=>{this.connectionState=this.connectionState===Za.CONNECTED?Za.RECONNECTING:Za.CONNECTING}),this._workerConnection.on(ut.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let i=B7(new Uint8Array(t.data));j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&C.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,C.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{He.reportApiInvoke(this._connectInfo.sid||null,{name:Li.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:_i.TRACER}).onError(new te(M.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},j("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else C.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(ut.WILL_RECONNECT,(t,i,n)=>{t==="recover"&&n(t),n("tryNext")}),this._workerConnection.on(ut.REQUEST_NEW_URLS,(t,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(i)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){let t=va(this,fo.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&C.debug("Only the track being played can be inspected"));this._sequence++;let n=await this.generateRequestData(t,i);this._workerConnection.sendMessage(n,!0,!0)}else j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&C.debug("Only the track being published can be inspected")}async generateRequestData(t,i){let{appId:n,cname:r,cid:s,vid:c,sid:l,uid:d}=i,h=Date.now(),f=await t.getCurrentFrameImage("image/jpeg",this.quality),E=await bP(f,n,r),S=this._sequence+"-"+s+"-"+d+"-"+h+"-"+ei(12,""),y={appId:n,cid:s,cname:r,deviceId:"",elapse:kI.intToLong(Number(h-this._moderationStartTime)),fileSize:f.buffer.byteLength,height:f.height,width:f.width,jpg:E,networkType:6,osType:7,requestId:S,sdkVersion:"4.24.0",sequence:this._sequence,sid:l,timestamp:QM(h),uid:d,vid:c,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete y.callbackData;let D=j7(y);if(D.byteLength<this._workerMessageLengthLimit){if(j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let O=(function(N){for(var k=1;k<arguments.length;k++){var U=arguments[k]!=null?arguments[k]:{};k%2?$M(Object(U),!0).forEach(function(B){L(N,B,U[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(U)):$M(Object(U)).forEach(function(B){Object.defineProperty(N,B,Object.getOwnPropertyDescriptor(U,B))})}return N})({},y);delete O.jpg,C.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(O))}return D}{let O=this.quality*this._qualityRatio;return this.quality=O,await this.generateRequestData(t,{appId:n,cname:r,cid:s,vid:c,sid:l,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=br.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Za.CLOSED,this.emit(fo.STATE_CHANGE,Cm.CLOSED)}}function eU(e){if(Jt(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new te(M.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new te(M.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}let X7={name:"ImageModeration",create:function(e){let{config:t}=e;return eU(t),new kI(t)}};var tU,iU,nU,rU,aU,sU,oU,cU,lU,dU,uU,hU,pU,fU,mU,_U,EU,gU,SU,vU,TU,yU,RU,CU,bU,AU,wU,IU,OU,NU,DU,LU,PU,xU,kU,MU,UU,VU,jU,BU,FU,xe;function GU(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function Ps(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?GU(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):GU(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}Vn.setLogger(C);let J7=(tU=Ze(),iU=Ze({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof _m))return[t];t=[t]}return t.map(i=>i?Object(i).toString():"null")}}),nU=Ze({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==mm.DATA?(Array.isArray(t)||(t=[t]),t.map(i=>i.getTrackId())):[t.getChannelId()])}),rU=Ze({argsMap:(e,t,i,n)=>[typeof t=="object"?t.uid:t,i,n]}),aU=Ze({argsMap:(e,t,i)=>[t,i]}),sU=Ze({argsMap:(e,t)=>t.map(i=>{let{user:n,mediaType:r}=i;return[n?.uid,r]})}),oU=Ze({argsMap:(e,t,i,n)=>[typeof t=="object"?t.uid:t,i,n]}),cU=Ze({argsMap:(e,t)=>t.map(i=>{let{user:n,mediaType:r}=i;return{uid:n?.uid,mediaType:r}})}),lU=Ze(),dU=Ze(),uU=Ze(),hU=Ze(),pU=Ze(),fU=Ze(),mU=Ze(),_U=Ze(),EU=Ze(),gU=Ze(),SU=Ze(),vU=Ze(),TU=Ze(),yU=Ze(),RU=Ze(),CU=Ze({argsMap:(e,t)=>[t]}),bU=Ze(),AU=Ze(),wU=Ze(),IU=Ze(),OU=Ze(),NU=Ze(),DU=Ze(),LU=Ze(),PU=Ze({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),xU=Ze(),kU=Ze(),MU=Ze(),UU=Ze(),VU=Ze(),jU=Ze(),BU=Ze({reportResult:!0}),FU=Ze(),xe=class extends vi{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let i;if(super(),L(this,"store",void 0),L(this,"_uid",void 0),L(this,"_channelName",void 0),L(this,"_uintUid",void 0),L(this,"_users",[]),L(this,"_config",void 0),L(this,"_clientId",void 0),L(this,"_appId",void 0),L(this,"_sessionId",null),L(this,"_key",void 0),L(this,"_rtmConfig",{}),L(this,"_joinInfo",void 0),L(this,"_gateway",void 0),L(this,"_statsCollector",void 0),L(this,"_configDistribute",void 0),L(this,"_leaveMutex",void 0),L(this,"_publishMutex",void 0),L(this,"_renewTokenMutex",void 0),L(this,"_subscribeMutex",void 0),L(this,"_encryptionMode","none"),L(this,"_encryptionSecret",null),L(this,"_encryptionSalt",null),L(this,"_encryptDataStream",!1),L(this,"_encryptDataStreamKey",null),L(this,"_encryptDataStreamIv",null),L(this,"_proxyServer",void 0),L(this,"_turnServer",{servers:[],mode:"auto"}),L(this,"_cloudProxyServerMode","disabled"),L(this,"_isDualStreamEnabled",!1),L(this,"_defaultStreamFallbackType",void 0),L(this,"_lowStreamParameter",void 0),L(this,"_streamFallbackTypeCacheMap",new Map),L(this,"_remoteStreamTypeCacheMap",new Map),L(this,"_axiosCancelSource",br.CancelToken.source()),L(this,"_audioVolumeIndicationInterval",void 0),L(this,"_networkQualityInterval",void 0),L(this,"_userOfflineTimeout",void 0),L(this,"_streamRemovedTimeout",void 0),L(this,"_liveTranscodeStreamingClient",void 0),L(this,"_liveRawStreamingClient",void 0),L(this,"_channelMediaRelayClient",void 0),L(this,"_networkQualitySensitivity","normal"),L(this,"_p2pChannel",void 0),L(this,"_useLocalAccessPoint",!1),L(this,"_setLocalAPVersion",void 0),L(this,"_joinAndNotLeaveYet",!1),L(this,"_numberOfJoinCount",0),L(this,"_joinResponse",null),L(this,"_remoteDefaultVideoStreamType",void 0),L(this,"_inspect",void 0),L(this,"_moderation",void 0),L(this,"_license",void 0),L(this,"_pendingPublishedUsers",[]),L(this,"ntpAlignErrorCount",0),L(this,"remoteInboundOffset",0),L(this,"_peerConnectionState",void 0),L(this,"_handleLocalTrackEnable",(r,s,c)=>{this.publish(r,!1).then(s).catch(c)}),L(this,"_handleLocalTrackDisable",(r,s,c)=>{this.unpublish(r).then(s).catch(c)}),L(this,"_handleUserOnline",r=>{if(j("BLOCK_LOCAL_CLIENT")&&jh(r.uid,this.channelName))return void C.debug("[".concat(r.uid,"] will be ignored in local"));this.isStringUID&&typeof r.uid!="string"&&C.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let s=this._users.find(c=>c.uid===r.uid);if(s)s._trust_in_room_=!0,s._is_pre_created&&(s._is_pre_created=!1,this.safeEmit(yt.USER_JOINED,s));else{let c=new Jd(r.uid,r.uint_id||r.uid);this._users.push(c),C.debug("[".concat(this._clientId,"] user online"),r.uid),this.store.firstVideoFrameDecoded(c.uid,{userJoinNotify:Date.now()}),this.safeEmit(yt.USER_JOINED,c)}}),L(this,"_handleUserOffline",r=>{if(j("BLOCK_LOCAL_CLIENT")&&jh(r.uid,this.channelName))return;let s=this._users.find(c=>c.uid===r.uid);s&&(this._handleRemoveStream(r),this._handleRemoveDataChannels(r),s._audio_pre_subscribed||s._video_pre_subscribed?s._is_pre_created=!0:uy(this._users,s),this._remoteStreamTypeCacheMap.delete(s.uid),this._streamFallbackTypeCacheMap.delete(s.uid),C.debug("[".concat(this._clientId,"] user offline"),r.uid,"reason:",r.reason),this.safeEmit(yt.USER_LEAVED,s,r.reason))}),L(this,"_handleAddAudioOrVideoStream",(r,s,c,l,d,h,f,E)=>{if(j("BLOCK_LOCAL_CLIENT")&&jh(s,this.channelName))return;let S=this._users.find(D=>D.uid===s);if(!S)return void C.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));C.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(r)),this.store.subscribe(S.uid,r,void 0,void 0,void 0,Date.now()),r==="video"&&this.store.firstVideoFrameDecoded(S.uid,{videoAddNotify:Date.now()});let y=r==="audio"?S.hasAudio:S.hasVideo;if(S._uintid||(S._uintid=h||s),r==="audio"?S._trust_audio_stream_added_state_=!0:S._trust_video_stream_added_state_=!0,r==="audio"?(S._audio_added_=!0,c!==void 0&&(S._audioSSRC=c),l!==void 0&&(S._cname=l),f&&(S._audioOrtc=f)):(S._video_added_=!0,c!==void 0&&(S._videoSSRC=c),l!==void 0&&(S._cname=l),E!==void 0&&(S._rtxSsrcId=E),f&&(S._videoOrtc=f)),(r==="audio"?S.hasAudio:S.hasVideo)&&!y&&(C.info("[".concat(this._clientId,"] remote user ").concat(S.uid," published ").concat(r)),this.safeEmit(yt.USER_PUBLISHED,S,r)),r==="video"?He.onGatewayStream(this._sessionId,nn.ON_ADD_VIDEO_STREAM,fi.ON_ADD_VIDEO_STREAM,{peer:h||s,ssrc:S._videoSSRC}):He.onGatewayStream(this._sessionId,nn.ON_ADD_AUDIO_STREAM,fi.ON_ADD_AUDIO_STREAM,{peer:h||s,ssrc:S._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(S,r,c).then(D=>{if(D&&(C.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(S.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof i0))return this._p2pChannel.unsubscribe(S,r,!0).then(()=>this._subscribe(S,r,!0).catch(O=>{C.error("[".concat(this._clientId,"] resubscribe error"),O.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(S,r)&&(C.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(S.uid," after reconnect.")),this._subscribe(S,r,!0).catch(D=>{C.error("[".concat(this._clientId,"] resubscribe error"),D.toString())})),r==="video"&&!wn()&&!Jn()){let D=this._getEncodingName(d);D?.toLocaleLowerCase()==jg.av1&&v7().then(O=>{O||this._gateway.downgradeCodec(D)})}}),L(this,"_handleRemoveStream",r=>{if(j("BLOCK_LOCAL_CLIENT")&&jh(r.uid,this.channelName))return;let s=this._users.find(l=>l.uid===r.uid);if(!s)return void C.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));C.debug("[".concat(this._clientId,"] stream removed with uid ").concat(r.uid));let c=()=>{};s.hasAudio&&s.hasVideo?c=()=>{C.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(yt.USER_UNPUBLISHED,s,"audio"),C.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(yt.USER_UNPUBLISHED,s,"video")}:s.hasVideo?c=()=>{C.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(yt.USER_UNPUBLISHED,s,"video")}:s.hasAudio&&(c=()=>{C.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(yt.USER_UNPUBLISHED,s,"audio")}),s._video_pre_subscribed||s._audio_pre_subscribed||(s._trust_audio_stream_added_state_=!0,s._trust_video_stream_added_state_=!0,s._audio_added_=!1,s._video_added_=!1,this._p2pChannel instanceof i0&&this._p2pChannel.unsubscribe(s).then(l=>{if(l)return this._gateway.unsubscribe(l,s.uid)}),s._audioSSRC=void 0,s._videoSSRC=void 0,s._audioOrtc=void 0,s._videoOrtc=void 0,s._rtxSsrcId=void 0),He.onGatewayStream(this._sessionId,nn.ON_REMOVE_STREAM,fi.ON_REMOVE_STREAM,{peer:r.uint_id||r.uid}),c()}),L(this,"_handleSetStreamLocalEnable",(r,s,c)=>{if(j("BLOCK_LOCAL_CLIENT")&&jh(s,this.channelName))return;let l=this._users.find(f=>f.uid===s);if(!l)return void C.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));C.debug("[".concat(this._clientId,"] local ").concat(r," ").concat(c?"enabled":"disabled"," with uid ").concat(s));let d=r==="audio"?l.hasAudio:l.hasVideo;if(r==="audio"){l._trust_audio_enabled_state_=!0;let f=l._audio_enabled_;if(l._audio_enabled_=c,l._audio_enabled_===f)return;{let E=l._audio_enabled_?"enable-local-audio":"disable-local-audio";C.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(s,", msg: ").concat(E)),this.safeEmit(yt.USER_INFO_UPDATED,s,E)}}else{l._trust_video_enabled_state_=!0;let f=l._video_enabled_;if(l._video_enabled_=c,l._video_enabled_===f)return;{let E=l._video_enabled_?"enable-local-video":"disable-local-video";C.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(E)),this.safeEmit(yt.USER_INFO_UPDATED,s,E)}}let h=r==="audio"?l.hasAudio:l.hasVideo;return d!==h?!d&&h?(C.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(r)),void this.safeEmit(yt.USER_PUBLISHED,l,r)):(r==="video"&&l._videoTrack&&l._videoTrack._destroy(),r==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,r),C.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(r)),void this.safeEmit(yt.USER_UNPUBLISHED,l,r)):void 0}),L(this,"_handleMuteStream",(r,s,c)=>{if(j("BLOCK_LOCAL_CLIENT")&&jh(r,this.channelName))return;C.debug("[".concat(this._clientId,"] receive mute message"),r,s,c);let l=this._users.find(f=>f.uid===r);if(!l)return void C.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r));let d=s==="audio"?l.hasAudio:l.hasVideo;if(s==="audio"){l._trust_audio_mute_state_=!0;let f=l._audio_muted_;if(l._audio_muted_=c,l._audio_muted_===f)return;{let E=l._audio_muted_?"mute-audio":"unmute-audio";C.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(E)),this.safeEmit(yt.USER_INFO_UPDATED,r,E)}}else{l._trust_video_mute_state_=!0;let f=l._video_muted_;if(l._video_muted_=c,l._video_muted_===f)return;{let E=l._video_muted_?"mute-video":"unmute-video";C.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(E)),this.safeEmit(yt.USER_INFO_UPDATED,r,E)}}let h=s==="audio"?l.hasAudio:l.hasVideo;if(d!==h){if(!d&&h)return(s==="audio"?l._audioSSRC:l._videoSSRC)?(C.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(s)),void this.safeEmit(yt.USER_PUBLISHED,l,s)):void C.warning("[".concat(this._clientId,"] remote user ").concat(r," receive ").concat(s," unmute message  before add stream message, ").concat(s," SSRC doesn't exist yet."));s==="video"&&l._videoTrack&&!l._video_pre_subscribed&&l._videoTrack._destroy(),s==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,s),C.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(s)),this.safeEmit(yt.USER_UNPUBLISHED,l,s)}}),L(this,"_handleP2PLost",async r=>{C.debug("[".concat(this._clientId,"] receive p2p lost"),r),parseInt(r.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():C.warning("[".concat(this._clientId,"] P2PLost stream not found"),r)}),L(this,"_handleTokenWillExpire",()=>{C.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(yt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),L(this,"_handleBeforeUnload",r=>{r.type==="beforeunload"&&r.returnValue!==void 0&&r.returnValue!==""||(this.leave(),C.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),L(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(yt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let r={downlinkNetworkQuality:0,uplinkNetworkQuality:0};r.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),r.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(yt.NETWORK_QUALITY,r)}),L(this,"_handleP2PAddAudioOrVideoStream",(r,s,c,l)=>{let d=this._users.find(f=>f.uid===s);if(!d)return void C.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));C.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(r)),this.store.subscribe(d.uid,r,void 0,void 0,void 0,Date.now());let h=r==="audio"?d.hasAudio:d.hasVideo;r==="audio"?d._trust_audio_stream_added_state_=!0:d._trust_video_stream_added_state_=!0,r==="audio"?(d._audio_added_=!0,c!==void 0&&(d._audioSSRC=c),l!==void 0&&(d._audioMid=l)):(d._video_added_=!0,c!==void 0&&(d._videoSSRC=c),l!==void 0&&(d._videoMid=l)),(r==="audio"?d.hasAudio:d.hasVideo)&&!h&&(C.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published ").concat(r)),this.safeEmit(yt.USER_PUBLISHED,d,r)),this._p2pChannel.hasPendingRemoteMedia(d,r)&&(C.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(d.uid," after reconnect.")),this._subscribe(d,r,!0).catch(f=>{C.error("[".concat(this._clientId,"] resubscribe error"),f.toString())}))}),this._config=e,this._clientId=t||ei(5,"client-"),this.store=new class{constructor(r,s,c,l){st(this,"state",void 0),this.state={codec:r,audioCodec:s,mode:c,clientId:l,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Lh.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(r){this.state=(function(s,c){switch(c.type){case ot.SET_SESSION_ID:return Te(Te({},s),{},{sessionId:c.sessionId});case ot.SET_P2P_ID:return Te(Te({},s),{},{p2pId:c.p2pId});case ot.SET_UID:return Te(Te({},s),{},{uid:c.uid});case ot.SET_INT_UID:return Te(Te({},s),{},{intUid:c.intUid});case ot.SET_PUB_ID:return Te(Te({},s),{},{pubId:c.pubId});case ot.KEY_METRIC_CLIENT_CREATED:return Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{clientCreated:c.metric})});case ot.KEY_METRIC_JOIN_START:return Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{joinStart:c.metric})});case ot.KEY_METRIC_PRELOAD_START:return Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{preloadStart:c.metric})});case ot.KEY_METRIC_PRELOAD_END:return Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{preloadEnd:c.metric})});case ot.KEY_METRIC_JOIN_END:return Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{joinEnd:c.metric})});case ot.KEY_METRIC_REQUEST_AP_START:return Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{requestAPStart:c.metric})});case ot.KEY_METRIC_REQUEST_AP_END:return Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{requestAPEnd:c.metric})});case ot.KEY_METRIC_REQUEST_SUA_END:return Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{requestSUAEnd:c.metric})});case ot.KEY_METRIC_BEFORE_CONNECT:return Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{beforeConnect:c.metric})});case ot.KEY_METRIC_PEER_RECEIVER:return Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{peerReceiver:c.metric})});case ot.KEY_METRIC_SIGNAL_CONNECTED:return Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{signalConnected:c.metric})});case ot.KEY_METRIC_JOIN_REQ:return Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{joinReq:c.metric})});case ot.KEY_METRIC_JOIN_REP:return Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{joinRep:c.metric})});case ot.KEY_METRIC_JOIN_GATEWAY_START:return Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{joinGatewayStart:c.metric})});case ot.KEY_METRIC_JOIN_GATEWAY_END:return Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{joinGatewayEnd:c.metric})});case ot.KEY_METRIC_PEER_CONNECTION_START:return Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{peerConnectionStart:c.metric})});case ot.KEY_METRIC_PEER_CONNECTION_END:return Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{peerConnectionEnd:c.metric})});case ot.KEY_METRIC_DESCRIPTION_START:return Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{descriptionStart:c.metric})});case ot.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{signalChannelOpen:c.metric})});case ot.KEY_METRIC_ICE_CONNECTION_END:return Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{iceConnectionEnd:c.metric})});case ot.KEY_METRIC_PUBLISH:{let l=s.keyMetrics.publish,d=l.findIndex(h=>h.trackId===c.metric.trackId);return d!==-1?(l[d]=Te(Te({},l[d]),c.metric),Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{publish:[...l]})})):Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{publish:[...s.keyMetrics.publish,c.metric]})})}case ot.KEY_METRIC_SUBSCRIBE:{let l=s.keyMetrics.subscribe,d=l.findIndex(h=>h.userId===c.metric.userId&&h.type===c.metric.type);return d!==-1?(l[d]=Te(Te({},l[d]),c.metric),Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{subscribe:[...l]})})):Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{subscribe:[...s.keyMetrics.subscribe,c.metric]})})}case ot.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{let l=s.keyMetrics.firstVideoFrameDecoded,d=l.findIndex(h=>h.userId===c.metric.userId);return d!==-1?(l[d]=Te(Te({},l[d]),c.metric),Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{firstVideoFrameDecoded:[...l]})})):Te(Te({},s),{},{keyMetrics:Te(Te({},s.keyMetrics),{},{firstVideoFrameDecoded:[...s.keyMetrics.firstVideoFrameDecoded,c.metric]})})}case ot.RESET_FIRST_VIDEO_FRAME_DECODED:return s.keyMetrics.firstVideoFrameDecoded=[],s;case ot.SET_CLOUD_PROXY_SERVER_MODE:return s.cloudProxyServerMode=c.mode,s;case ot.RECORD_JOIN_CHANNEL_SERVICE:return typeof c.index!="number"?s.joinChannelServiceRecords=[...s.joinChannelServiceRecords,c.record]:(s.joinChannelServiceRecords[c.index]=Te(Te({},s.joinChannelServiceRecords[c.index]),c.record),s.joinChannelServiceRecords=[...s.joinChannelServiceRecords]),s;case ot.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return s.joinChannelServiceRecords=[],s;case ot.RESET_KEY_METRICS:return s.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},s;case ot.SET_USE_P2P:return Te(Te({},s),{},{useP2P:c.val});case ot.SET_TRANSPORT_TYPE:return Te(Te({},s),{},{p2pTransport:c.val});default:return s}})(this.state,r)}set autoSubscribe(r){this.state.autoSubscribe=r}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(r){this.state.enableInstantMuteRestore=r}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(r){this.dispatch({type:ot.SET_SESSION_ID,sessionId:r})}get sessionId(){return this.state.sessionId}set cid(r){this.state.cid=r}get cid(){return this.state.cid}set codec(r){this.state.codec=r}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(r){this.dispatch({type:ot.SET_P2P_ID,p2pId:r})}get p2pId(){return this.state.p2pId}set dcId(r){this.dispatch({type:ot.SET_DC_ID,dcId:r})}get dcId(){return this.state.dcId}set uid(r){this.dispatch({type:ot.SET_UID,uid:r})}get uid(){return this.state.uid}set intUid(r){this.dispatch({type:ot.SET_INT_UID,intUid:r})}get intUid(){return this.state.intUid}set pubId(r){this.dispatch({type:ot.SET_PUB_ID,pubId:r})}get pubId(){return this.state.pubId}set cloudProxyServerMode(r){this.dispatch({type:ot.SET_CLOUD_PROXY_SERVER_MODE,mode:r})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(r){this.dispatch({type:ot.SET_USE_P2P,val:r})}get useP2P(){return this.state.useP2P}set p2pTransport(r){this.dispatch({type:ot.SET_TRANSPORT_TYPE,val:r})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(r){this.state.hasStartJoinChannel=r}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(r){this.state.isABTestSuccess=r}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:ot.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ot.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:ot.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:ot.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:ot.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ot.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ot.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:ot.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:ot.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:ot.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:ot.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:ot.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:ot.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ot.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ot.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ot.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ot.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(r,s){this.dispatch({type:ot.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:Te({userId:r},s)})}descriptionStart(){this.dispatch({type:ot.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ot.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ot.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(r,s,c,l){this.dispatch({type:ot.KEY_METRIC_PUBLISH,metric:Te(Te({trackId:r,type:s},c&&{publishStart:c}),l&&{publishEnd:l})})}subscribe(r,s,c,l,d,h,f){this.dispatch({type:ot.KEY_METRIC_SUBSCRIBE,metric:Te(Te(Te(Te(Te({userId:r,type:s},c&&{subscribeStart:c}),l&&{subscribeEnd:l}),d&&{firstFrame:d}),h&&{streamAdded:h}),f&&{firstDecoded:f})})}massSubscribe(r,s,c,l){r.forEach(d=>{this.dispatch({type:ot.KEY_METRIC_SUBSCRIBE,metric:Te(Te(Te({userId:d.userId,type:d.type},s&&{subscribeStart:s}),c&&{subscribeEnd:c}),l&&{firstFrame:l})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(r,s){r.service==="gateway"&&Array.isArray(r.urls)&&(r.urls=r.urls.map(c=>c.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof s!="number"?(this.dispatch({type:ot.RECORD_JOIN_CHANNEL_SERVICE,record:Te(Te({},r),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(s<0||s>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ot.RECORD_JOIN_CHANNEL_SERVICE,record:r,index:s}),s)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ot.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ot.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:ot.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Vn("client-leave",this._clientId),this._publishMutex=new Vn("client-publish",this._clientId),this._renewTokenMutex=new Vn("client-renewtoken",this._clientId),this._subscribeMutex=new Vn("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),C.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Ya," build: ").concat(vw,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{ow(e.clientRoleOptions),i=Object.assign({},e.clientRoleOptions)}catch(r){C.warning("[".concat(this._clientId,"] ").concat(r.toString()))}var n;this._statsCollector=new e0(this.store),this._statsCollector.onStatsException=(r,s,c)=>{C.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(r,", msg: ").concat(s,", uid: ").concat(c)),r===SI.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(l=>{l instanceof by&&j("ENABLE_ENCODE_EXCEPTION")&&l.findClosestProfile()}),this.safeEmit(yt.EXCEPTION,{code:r,msg:s,uid:c})},this._statsCollector.onUploadPublishDuration=(r,s,c,l)=>{let d=this._users.find(h=>h.uid===r);d&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(d._uintid,{peerPublishDuration:c,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(d)),He.peerPublishStatus(this._sessionId,{subscribeElapse:l,audioPublishDuration:s,videoPublishDuration:c,peer:d._uintid}))},this._statsCollector.onVideoCodecChanged=r=>{if(j("VIDEO_STANDARD_BITRATE_VERSION")&&(r==="av1"||r==="h265"||r==="h264")){let s=this.localTracks.find(c=>c instanceof oi);s&&s._saveEncodeBitrateRatio!==1&&s.setSaveEncodeBitrateRatio(r==="h264"?j("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new f7(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||zi,httpRetryConfig:e.httpRetryConfig||zi,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:i}),this._configDistribute=new b7(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(n={store:this.store,statsCollector:this._statsCollector},Sl("P2PChannel").create(n)),this._handleP2PEvents()):this._p2pChannel=new i0(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,i,n,r){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],c=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Kt("JOIN_GATEWAY_USE_443PORT_ONLY",s),Kt("JOIN_GATEWAY_USE_DUAL_DOMAIN",c);let l=this._gateway.signal.websocket;return l instanceof rI&&(l.use443PortOnly=s,l.tryDoubleDomain=c),(async function(d,h,f){sy.get(d)||sy.set(d,[]),oy.get(d)||oy.set(d,h),sc.get(d)||sc.set(d,0);let E=sy.get(d),S=oy.get(d);if(!E||!S)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(sc.get(d)===S){let k=Ng();E.push(k),await k.promise}sc.set(d,sc.get(d)+1);for(var y=arguments.length,D=new Array(y>3?y-3:0),O=3;O<y;O++)D[O-3]=arguments[O];let N=await f(...D);return sc.set(d,sc.get(d)-1),sc.get(d)===S-1&&E.length>0&&(E[0].resolve(),E.shift()),sc.get(d)===0&&(sy.set(d,[]),oy.set(d,0),sc.set(d,0)),N})("client.join",j("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,i,n,r)}async join(e,t,i,n,r){let s=++this._numberOfJoinCount;this.store.joinStart(),n&&(this.store.uid=n);let c=(fy||fy||(fy=(window.location.protocol.split(":")[0]||"").toUpperCase(),fy))==="HTTPS",l=jL()?window.isSecureContext:"Browser Not Support";(!jL()&&!c||!window.isSecureContext)&&C.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let d;He.setAppId(e);try{if(!i&&i!==null)throw new te(M.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));if(i&&gn(i,"token",1,2047),gn(e,"appid",1,2047),My(t),n&&Uy(n),r)if(typeof r=="string")gn(r,"optionalInfo",1,256),d=r;else{if(typeof r!="object")throw new te(M.INVALID_PARAMS,"Invalid options: options is not a string or object");{let{autoSubscribe:N,enableInstantMuteRestore:k}=r;N&&(co(N,"autoSubscribe"),C.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(N)),this.store.autoSubscribe=N),k&&(co(k,"enableInstantMuteRestore"),C.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(k)),this.store.enableInstantMuteRestore=k)}}}catch(N){throw He.reportApiInvoke(Dh(),{name:Li.JOIN,options:[e,t,i,n],states:{isHttps:c,isSecureContext:l},tag:_i.TRACER}).onError(N),N}if(this._leaveMutex.isLocked&&(C.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),C.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let N=new te(M.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw He.reportApiInvoke(Dh(),{name:Li.JOIN,options:[e,t,i,n],states:{isHttps:c,isSecureContext:l},tag:_i.TRACER}).onError(N),N}this._gateway.state="CONNECTING",this.store.preloadStart();let h=await VM({appId:e,cname:t,uid:n,stringUid:typeof n=="string"?n:void 0,token:i||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new te(M.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let f=h?.sid||Dh();C.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(s)),this._sessionId||(this._sessionId=f,this.store.sessionId=this._sessionId);let E=He.reportApiInvoke(f,{id:this._clientId,name:Li.JOIN,options:[e,t,i,n],states:{isHttps:c,isSecureContext:l},tag:_i.TRACER}),S=Ps(Ps(Ps({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof n!="string"?n:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:d,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!h},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:j("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(S.setLocalAPVersion=this._setLocalAPVersion),typeof n=="string"&&(S.stringUid=n,this._uintUid?(S.uid=this._uintUid,this._uintUid=void 0):S.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(S.aesmode=this._encryptionMode,S.aespassword=await(async N=>{let k=(function(K){let H=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),ee=new Uint8Array(new ArrayBuffer(H.length));for(let ue=0;ue<H.length;ue+=1)ee[ue]=H.charCodeAt(ue);return ee})(),U=await window.crypto.subtle.importKey("spki",k,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),B=aw(N),J=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},U,B);return(function(K){let H="";for(let ee=0;ee<K.length;ee+=1)H+=String.fromCharCode(K[ee]);return window.btoa(H)})(new Uint8Array(J))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new te(M.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(S.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let N=new TextEncoder,k=j("USE_PURE_ENCRYPTION_MASTER_KEY")?N.encode(S.appId+this._encryptionSecret+this._encryptionSecret):N.encode(S.appId+S.cname+this._encryptionSecret);this._encryptDataStreamIv=await(async function(U,B,J){let K=await window.crypto.subtle.importKey("raw",B,"PBKDF2",!1,["deriveBits","deriveKey"]),H=U==="aes-128-gcm2"?128:256,ee=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:XL,hash:"SHA-256",salt:J},K,H+WB);return new Uint8Array(ee).subarray(H/8)})(this._encryptionMode,k,Nh(this._encryptionSalt)),this._encryptDataStreamKey=await(async function(U,B,J){let K=await window.crypto.subtle.importKey("raw",B,"PBKDF2",!1,["deriveBits","deriveKey"]),H=U==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:XL,hash:"SHA-256",salt:J},K,{name:"AES-GCM",length:H},!0,["encrypt","decrypt"])})(this._encryptionMode,k,Nh(this._encryptionSalt))}else l?C.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):C.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,C.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:S.stringUid});let y=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&y===this._sessionId&&He.joinChannelTimeout(this._sessionId,5)},5e3);try{var D;let N,k=S.cloudProxyServer;if(Ce(D=["proxy3","proxy4","proxy5"]).call(D,k)){let H=j("PROXY_SERVER_TYPE3");Array.isArray(H)?S.proxyServer=H[0]:S.proxyServer=H}if(He.setProxyServer(S.proxyServer),C.setProxyServer(S.proxyServer),this.store.requestAPStart(),h){if(C.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(S.stringUid?", ".concat(S.stringUid," => ").concat(h.intUid):""," ")),S.stringUid&&!S.uid&&(S.uid=h.intUid),N={gatewayInfo:h.ap.gatewayInfo},j("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&S.turnServer.mode==="auto")if(h.ap.proxyInfo.addresses.length===0)C.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let H=(await xk(h.ap.proxyInfo,h.ap.gatewayInfo.uid)).map(ee=>({turnServerURL:ee.address,tcpport:ee.tcpport||Nn.tcpport,udpport:ee.udpport||Nn.udpport,username:ee.username||Nn.username,password:ee.password||Nn.password,forceturn:!1,security:!0}));S.turnServer={mode:"manual",servers:H}}FM(h,S.stringUid)}else{if(S.stringUid&&!S.uid){let H;[H,N]=await Ie.all([cM(S.stringUid,S,this._axiosCancelSource.token,this._config.httpRetryConfig||zi,this.store).finally(()=>{this.store.requestSUAEnd()}),oM(S,this._axiosCancelSource.token,this._config.httpRetryConfig||zi,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),C.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(S.stringUid," => ").concat(H)),S.uid=H,N.gatewayInfo.uid=H,N.gatewayInfo.res.uid=H}else N=await oM(S,this._axiosCancelSource.token,this._config.httpRetryConfig||zi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new te(M.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(S,this._axiosCancelSource.token),this._configDistribute.on(zg.UPDATE_BITRATE_LIMIT,H=>{this._p2pChannel.updateBitrateLimit(H)}),this._configDistribute.on(zg.UPDATE_CLIENT_ROLE_OPTIONS,H=>{this._setClientRoleOptions(H)})},0),this._key=i||e;let U=N.gatewayInfo,B=S.uid?S.uid:U.uid;this._joinInfo=Ps(Ps({},S),{},{cid:U.cid,uid:B,vid:U.vid,apResponse:U.res,apGatewayAddress:U.apGatewayAddress,uni_lbs_ip:U.uni_lbs_ip,gatewayAddrs:U.gatewayAddrs}),this.store.intUid=B,this.store.cid=U.cid;let J=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new te(M.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));E.onSuccess(J),this._appId=e,this._channelName=S.cname,this._uid=J,this.store.uid=J,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(wn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let K=S.stringUid?"string uid: ".concat(S.stringUid,",uid: ").concat(S.uid):"uid: ".concat(this._uid);return C.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(K)),setTimeout(()=>{C.startUpload()},5e3),this.store.joinEnd(),O=this,Ce(Vh).call(Vh,O)||Vh.push(O),this._cloudProxyServerMode==="disabled"&&Lt().supportWebCrypto&&j("ENABLE_PRELOAD")&&PI(this._joinInfo),J}catch(N){let k=Array.isArray(N)?N[0]:N;throw k&&k.code===M.OPERATION_ABORTED?C.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),k):C.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),k),k.code!==M.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),E.onError(k),k}var O}_joinGateway(){if(!this._joinInfo||!this._key)throw new te(M.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!j("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){C.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(wn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),(function(t){let i=Vh.indexOf(t);i!==-1&&Vh.splice(i,1)})(this),this._statsCollector.stopUpdateStats();let e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return C.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Gt.LEAVE),C.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof _m))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new te(M.INVALID_PARAMS,"param list is empty");let i=e;if(this._gateway.role==="audience")throw new te(M.INVALID_OPERATION,"audience can not publish stream");for(let r of i){if(!(r instanceof _m))throw new te(M.INVALID_PARAMS,"parameter is not local track");if(!r._enabled&&t)throw new te(M.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(r.getTrackId()))}C.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(r=>"".concat(r.getTrackId()," "))));let n=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&i.forEach(r=>{let s=this._configDistribute.getBitrateLimit();r instanceof oi&&s&&r.setBitrateLimit(s.uplink)});try{await this._publishHighStream(i),C.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(r=>"".concat(r.getTrackId()," "))))}catch(r){throw C.error("[".concat(this._clientId,"] publish error"),r.toString()),r}finally{n()}}async _publishDataChannel(e){if(e==null)throw new te(M.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));Jt(e.id,"id",0,65535,!0),co(e.ordered,"ordered"),gn(e.metadata,"metadata",0,512),C.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(r=>r.id===e.id)!==-1)throw new te(M.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new te(M.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(M.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&j("FORCE_TURN")&&!j("TURN_ENABLE_TCP")&&!j("TURN_ENABLE_UDP"))throw new te(M.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let i=(function(r){return Qk(r,!1)})(e),n=await this._p2pChannel.publishDataChannel([i]);if(n.length>0){if(typeof i._originDataChannelId!="number")throw C.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new te(M.CREATE_DATACHANNEL_ERROR);try{await Ie.all(n.map(r=>this._uid&&this._gateway.publishDataChannel(this._uid,r,!0))),await i._waitTillOpen()}catch(r){if(r.code!==M.DISCONNECT_P2P)throw r}}return C.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw C.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new te(M.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof _m))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);C.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(n=>"".concat(n.getTrackId()," "))," "));let i=await this._publishMutex.lock();try{if(this.store.useP2P){let n=await this._p2pChannel.unpublish(t);n&&await this._gateway.sendExtensionMessage(Ui.UNPUBLISH,{unpubMsg:n},!0)}else{let n=await this._p2pChannel.unpublish(t);n&&await this._gateway.unpublish(n,this._uid),C.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(r=>"".concat(r.getTrackId()))))}}catch(n){throw C.error("[".concat(this._clientId,"] unpublish error"),n.toString()),n}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),C.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));let t=await this._publishMutex.lock();try{let i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),C.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(n=>"".concat(n.id))))}catch(i){throw C.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{t&&t()}}async subscribe(e,t,i){if(!(e instanceof Jd)){let n=this.remoteUsers.find(r=>r.uid===e);if(!n)throw new te(M.INVALID_REMOTE_USER,"user is not in the channel");e=n}return t==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,t)}async presubscribe(e,t){if(tn(t,"mediaType",["audio","video"]),this.store.useP2P)throw new te(M.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new te(M.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(M.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let i=t===ke.AUDIO,n=t===ke.VIDEO,r=await this._subscribeMutex.lock();try{let{ssrcId:s,ortc:c,rtxSsrcId:l,cname:d,uint_id:h}=await this._gateway.presubscribe(e,t,!0);if(s==null)throw new te(M.UNEXPECTED_RESPONSE,"no ssrc id");let f=this._users.find(S=>S.uid===e);f||(f=new Jd(e,h||e),f._is_pre_created=!0,this._users.push(f)),d&&(f._cname=d),f._uintid||(f._uintid=h||e),i&&(f._audioSSRC=s,f._audio_pre_subscribed=!0,c&&(f._audioOrtc=c)),n&&(f._videoSSRC=s,f._video_pre_subscribed=!0,c&&(f._videoOrtc=c),l!=null&&(f._rtxSsrcId=l)),C.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(f,t,s,l,c);let E=i?f._audioTrack:f._videoTrack;if(!E)throw new te(M.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(f._trust_audio_stream_added_state_=!0,f._audio_added_=!0),n&&(f._trust_video_stream_added_state_=!0,f._video_added_=!0),E}catch(s){throw C.error("[".concat(this._clientId,"] presub user ").concat(e," error"),s),s}finally{r()}}async _subscribeDataChannel(e,t){var i;if(Jt(t,"channelId",0,65535,!0),!this._joinInfo)throw new te(M.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(M.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===e))throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new te(M.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new te(M.INVALID_REMOTE_USER,"user is not published");let n=(i=e._dataChannels)===null||i===void 0?void 0:i.find(c=>c.id===t);if(!n)throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new te(M.REMOTE_USER_IS_NOT_PUBLISHED);let r=await this._subscribeMutex.lock();C.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let c=await this._p2pChannel.subscribeDataChannel(e,[n]);if(c&&Ce(c).call(c,n.id))try{var s;if(typeof n._originDataChannelId!="number")throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new te(M.CREATE_DATACHANNEL_ERROR);let l={id:n.id,datachannelId:n._originDataChannelId,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:(s=n.metadata)!==null&&s!==void 0?s:""};await this._gateway.subscribeDataChannel(e.uid,l,!0),await n._waitTillOpen()}catch(l){if(l?.code!==M.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[n]),l;await this._p2pChannel.unsubscribeDataChannel(e,[n]),this._p2pChannel.setPendingRemoteDataChannel(e,n.id)}return C.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),n}finally{r()}}async _p2pSubscribe(e,t,i){if(tn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new te(M.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(M.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(r=>r===e)){let r=new te(M.INVALID_REMOTE_USER,"user is not in the channel");throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),r}if(!e.hasAudio&&!e.hasVideo){let r=new te(M.INVALID_REMOTE_USER,"user is not published");throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),r}if(!i&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){let r=new te(M.REMOTE_USER_IS_NOT_PUBLISHED);throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),r}let n=await this._subscribeMutex.lock();C.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let s=t==="audio"?e._audioSSRC:e._videoSSRC,c=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,s,c)}catch(s){throw s}C.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(s=>{C.warning("[".concat(this._clientId,"] auto set fallback failed"),s)});let r=t==="audio"?e._audioTrack:e._videoTrack;if(!r)throw new te(M.UNEXPECTED_ERROR,"can not find remote track in user object");return r}catch(r){throw C.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),r),r}finally{n()}}async _subscribe(e,t,i){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(tn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new te(M.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(M.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===e)){let d=new te(M.INVALID_REMOTE_USER,"user is not in the channel");throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),d}if(!e.hasAudio&&!e.hasVideo){let d=new te(M.INVALID_REMOTE_USER,"user is not published");throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),d}if(!(i||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){let d=new te(M.REMOTE_USER_IS_NOT_PUBLISHED);throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),d}let n=t==="audio"?e._audioSSRC:e._videoSSRC,r=t==="audio"?e._audioOrtc:e._videoOrtc,s=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?ke.AUDIO:ke.VIDEO,ssrcId:n};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});let l=await this._subscribeMutex.lock();C.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let h=t==="audio"?e._audioSSRC:e._videoSSRC;h!==void 0&&h!==n&&(n=h,r=t==="audio"?e._audioOrtc:e._videoOrtc,s=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?ke.AUDIO:ke.VIDEO,ssrcId:n}),Gn.markSubscribeStart(this.store.clientId,n),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,n,s,r);try{this._p2pChannel.isPreSubScribe(n)||await this._gateway.subscribe(e.uid,c,!0)}catch(f){if(f?.code!==M.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),f;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(h){throw this._p2pChannel.reportSubscribeEvent(!1,h?.code,e,t),h}C.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(h=>{C.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});let d=t==="audio"?e._audioTrack:e._videoTrack;if(!d)throw new te(M.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),d}catch(d){throw C.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),d),d}finally{l()}}async massSubscribe(e){if(ml(e,"subscribeList"),!this._joinInfo)throw new te(M.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(M.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t=Date.now(),i=new Map,n=await this._subscribeMutex.lock();C.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(l=>{let{user:d,mediaType:h}=l;return"user: ".concat(d?.uid,", mediaType: ").concat(h)}).join("; ")));let r=(e=[...e]).map(l=>{let{user:d,mediaType:h}=l;return{user:d,mediaType:h}}),s=await this._p2pChannel.globalLock();try{var c;for(let d=e.length-1;d>=0;d--){let h=e[d],{user:f,mediaType:E}=h;if(tn(E,"mediaType",["audio","video"]),!f){let D=new te(M.INVALID_PARAMS,"user property does not exist in subscribeList item");throw C.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),D}if(!this._users.find(D=>D===f)){let D=new te(M.INVALID_REMOTE_USER,"user is not in the channel");C.error("[".concat(this._clientId,"] can not massSubscribe ").concat(f.uid,", this user is not in the channel")),r[d].error=D,e.splice(d,1);continue}if(E==="audio"&&(!f.hasAudio||f._audioSSRC===void 0)||E==="video"&&(!f.hasVideo||f._videoSSRC===void 0)){let D=new te(M.REMOTE_USER_IS_NOT_PUBLISHED);C.error("[".concat(this._clientId,"] can not subscribe ").concat(f.uid," with mediaType ").concat(E,", remote user is not published")),r[d].error=D,e.splice(d,1);continue}let S=cn.Video|cn.LwoVideo,y=i.get(f);if(y){if(E==="video"?y&S:y&cn.Audio){e.splice(d,1),C.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(f.uid,", mediaType:").concat(E," twice"));continue}i.set(f,y|(E==="video"?S:cn.Audio))}else i.set(f,E==="video"?S:cn.Audio)}for(let d=e.length-1;d>=0;d--){let h=e[d],{user:f,mediaType:E}=h,S=cn.Video|cn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(f,E)){await this._p2pChannel.unmuteRemoteNoLock(f,E);let y=i.get(f);i.set(f,E==="video"?y^S:y^cn.Audio),e.splice(d,1)}}this.store.massSubscribe(e.map(d=>({userId:d.user.uid,type:d.mediaType})),t);let l=xr(c=Array.from(i.entries())).call(c,(d,h)=>{let[f,E]=h;if(E===0)return d;let S={stream_id:f.uid,stream_type:E};return E&cn.Audio&&(S.audio_ssrc=f._audioSSRC),E&cn.Video&&(S.video_ssrc=f._videoSSRC),d.push(S),d},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(h=>{let{user:f,mediaType:E}=h;return{user:f,mediaType:E,ssrcId:E===ke.VIDEO?f._videoSSRC:f._audioSSRC,rtxSsrcId:E===ke.VIDEO?f._rtxSsrcId:void 0}}));let d=new Map;if(l=l.filter(h=>h.video_ssrc&&!this._p2pChannel.isPreSubScribe(h.video_ssrc)||h.audio_ssrc&&!this._p2pChannel.isPreSubScribe(h.audio_ssrc)||!h.video_ssrc&&!h.audio_ssrc),l.length>0&&((await this._gateway.subscribeAll(l,!0))?.users||[]).forEach(f=>{let{stream_id:E,video_error_code:S,audio_error_code:y,error_code:D}=f;(S||y||D)&&d.set(E,{video_error_code:S,audio_error_code:y,error_code:D})}),Array.from(d.entries()).length>0){let h=[];Array.from(d.entries()).forEach(f=>{let[E,S]=f,y=this.remoteUsers.find(D=>D.uid===E);if(y){let D;S.error_code||S.video_error_code&&S.audio_error_code?D=void 0:S.video_error_code?D=ke.VIDEO:S.audio_error_code&&(D=ke.AUDIO),h.push({user:y,mediaType:D})}}),h.length>0&&await this._p2pChannel.massUnsubscribeNoLock(h)}for(let h of r){let f=d.get(h.user.uid);if(f){let E=f.error_code||h.mediaType==="audio"&&f.audio_error_code||h.mediaType==="video"&&f.video_error_code;if(E){let S=Kg(E);C.error("user:".concat(h.user.uid," mediaType:").concat(h.mediaType," has massSubscribe error ").concat(S.desc)),h.error=new te(M.SUBSCRIBE_FAILED,"code ".concat(E,": ").concat(S.desc))}}h.error||(h.mediaType==="video"?h.track=h.user.videoTrack:h.track=h.user.audioTrack)}return this.store.massSubscribe(r.filter(h=>!h.error).map(h=>({userId:h.user.uid,type:h.mediaType})),void 0,Date.now()),r.forEach(h=>{var f;He.subscribe(this.store.sessionId,{succ:!!h.error,ec:((f=h.error)===null||f===void 0?void 0:f.code)||null,video:h.mediaType===ke.VIDEO,audio:h.mediaType===ke.AUDIO,peerid:h.user.uid,subscribeRequestid:h.mediaType===ke.VIDEO?h.user._videoSSRC:h.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(h.user._videoSSRC)},!0)}),C.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(h=>{let{user:f,mediaType:E}=h;return"user: ".concat(f?.uid,", mediaType: ").concat(E)}).join("; "))),r}catch(d){throw await this._p2pChannel.massUnsubscribeNoLock(e),d}}finally{s(),n()}}async unsubscribe(e,t,i){if(!(e instanceof Jd)){let r=this.remoteUsers.find(s=>s.uid===e);if(!r)throw new te(M.INVALID_REMOTE_USER,"user is not in the channel");e=r}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(t&&tn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new te(M.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(r=>r===e)){let r=new te(M.INVALID_REMOTE_USER,"user is not in the channel");throw C.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),r}C.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));let n=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{let r=await this._p2pChannel.unsubscribe(e,t);r&&await this._gateway.unsubscribe(r,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&uy(this._users,e),C.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(r){if(r.code===M.DISCONNECT_P2P)return void C.warning("disconnecting p2p, abort unsubscribe request.");throw C.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),r.toString()),r}finally{n()}}async _unsubscribeDataChannel(e,t){if(t&&Jt(t,"id",0,65535,!0),!this._joinInfo)throw new te(M.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(n=>n===e)){let n=new te(M.INVALID_REMOTE_USER,"user is not in the channel");throw C.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),n}let i;if(typeof t=="number"){let n=e._dataChannels.find(r=>r.id===t);n&&(i=[n])}else i=e._dataChannels;if(i===void 0){let n=new te(M.REMOTE_USER_IS_NOT_PUBLISHED);throw C.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),n}C.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i.map(n=>n.id)));try{let n=await this._p2pChannel.unsubscribeDataChannel(e,i);n&&await this._gateway.unsubscribeDataChannel(n,e.uid),C.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(n))}catch(n){if(n.code===M.DISCONNECT_P2P)return void C.warning("disconnecting p2p, abort unsubscribe request.");throw C.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),n.toString()),n}}async massUnsubscribe(e){if(ml(e,"unsubscribeList"),!this._joinInfo)throw new te(M.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");C.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:n,mediaType:r}=i;return"user: ".concat(n?.uid,", mediaType: ").concat(r,";")}).join())),e=[...e];let t=new Map;for(let i=e.length-1;i>=0;i--){let{user:n,mediaType:r}=e[i];if(!n){let c=new te(M.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw C.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),c}if(tn(r,"mediaType",["video","audio",void 0]),!this._users.find(c=>c===n)){C.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),e.splice(i,1);continue}let s=cn.Video|cn.LwoVideo;if(t.has(n)){let c=t.get(n),l;switch(r){case"video":l=c&s;break;case"audio":l=c&cn.Audio;break;default:l=c&(cn.Audio|s)}if(l){C.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(n.uid,",mediaType:").concat(r," twice.")),e.splice(i,1);continue}r?r==="audio"?t.set(n,c|cn.Audio):r==="video"&&t.set(n,c|s):t.set(n,c|cn.Audio|s)}else r?r==="audio"?t.set(n,cn.Audio):r==="video"&&t.set(n,s):t.set(n,cn.Audio|s)}try{let i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),C.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(n=>{let{user:r,mediaType:s}=n;return"user: ".concat(r?.uid,", mediaType: ").concat(s,";")}).join()))}catch(i){if(i.code===M.DISCONNECT_P2P)return void C.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw C.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new de(M.INVALID_PARAMS);Ai(i.width)||nw(i.width,"streamParameter.width"),Ai(i.height)||nw(i.height,"streamParameter.height"),Ai(i.framerate)||nw(i.framerate,"streamParameter.framerate"),Ai(i.bitrate)||Jt(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&C.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),C.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,ge.LocalVideoLowTrack)}async enableDualStream(){if(!Lt().supportDualStream)throw He.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new te(M.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new te(M.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw He.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,He.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),C.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new te(M.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(ge.LocalVideoLowTrack))try{let e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw He.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,He.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),C.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if((function(n){tn(n,"role",["audience","host"])})(e),t&&ow(t),this.mode==="rtc"||this.mode==="p2p")throw C.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new te(M.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new te(M.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new te(M.INVALID_OPERATION,"can not set client role to audience when publishing stream");let i=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==i&&j("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",In.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),C.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&ow(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{C.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;let t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;let i=t.timestamp-Date.now();return Math.abs(i)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(gn(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new te(M.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new te(M.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,He.setProxyServer(this._proxyServer),C.setProxyServer(this._proxyServer),C.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new te(M.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new te(M.INVALID_OPERATION,"You have already set the proxy")}if(xg(e))return this._turnServer={servers:e,mode:"original-manual"},void C.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>wL(i)),this._turnServer={servers:e,mode:"manual"},C.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new te(M.INVALID_OPERATION,"you should set license before join channel");if(gn(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new te(M.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,C.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new te(M.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new te(M.INVALID_OPERATION,"You have already set the proxy");let t=[3,4,5],i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new te(M.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new te(M.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,C.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new te(M.INVALID_OPERATION,"Stop proxy server after leave channel");He.setProxyServer(),C.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",C.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new te(M.INVALID_PARAMS,"accessPoints is required.");ml(e.accessPoints.serverList,"accessPoints.serverList"),gn(e.accessPoints.domain,"accessPoints.domain");let t=(S,y)=>{Jt(S,y,0,65535,!0)},i=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new te(M.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");j("CLOSE_AFB_FOR_LOCAL_AP")&&(Kt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Kt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let n=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,r=e.accessPoints.domain,s=e.accessPoints.serverList.map(S=>n.test(S)?"".concat(S.replace(/\./g,"-"),".").concat(r):S),c=s.map(S=>"".concat(S,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Kt("WEBCS_DOMAIN",c),Kt("WEBCS_DOMAIN_BACKUP_LIST",c),Kt("GATEWAY_DOMAINS",[r]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(ml(e.report.hostname,"report.hostname"),Kt("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Kt("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Kt("EVENT_REPORT_DOMAIN",s[0]),Kt("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let l=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),l=e.report.port),Kt("STATS_COLLECTOR_PORT",l),e.report?Kt("ENABLE_EVENT_REPORT",!0):Kt("ENABLE_EVENT_REPORT",!1);let d="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(ml(e.log.hostname,"log.hostname"),d=e.log.hostname[0]):d=s[0];let h=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),h=e.log.port),Kt("LOG_UPLOAD_SERVER","".concat(d,":").concat(h));let f=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(ml(e.cds.hostname,"cds.hostname"),f=e.cds.hostname):f=s;let E=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),E=e.cds.port),Kt("CDS_AP",f.map(S=>"".concat(S,":").concat(E))),e.cds?Kt("ENABLE_CONFIG_DISTRIBUTE",!0):Kt("ENABLE_CONFIG_DISTRIBUTE",!1),C.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(ml(e,"serverList"),gn(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new te(M.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(n=>i.test(n)?"".concat(n.replace(/\./g,"-"),".").concat(t):n),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Kt("WEBCS_DOMAIN",e),Kt("WEBCS_DOMAIN_BACKUP_LIST",e),Kt("GATEWAY_DOMAINS",[t]),Kt("EVENT_REPORT_DOMAIN",e[0]),Kt("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Kt("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),C.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(tn(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw C.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else C.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){tn(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{let i=this._users.find(n=>n.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw C.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}C.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){tn(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(i){throw C.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}C.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,i,n){(function(s){tn(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),gn(t,"secret");let r=["aes-128-gcm2","aes-256-gcm2"];if(Ce(r).call(r,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new te(M.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new te(M.INVALID_PARAMS,"current encrypt mode does not need salt");if(n){if(co(n,"encryptDataStream"),!Ce(r).call(r,e))throw new te(M.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||C.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,i&&(this._encryptionSalt=jd(i))}async renewToken(e){if(gn(e,"token",1,2047),!this._key||!this._joinInfo)throw new te(M.INVALID_OPERATION,"renewToken should not be called before user join");let t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let i=await this._renewTokenMutex.lock();try{if(j("USE_NEW_TOKEN")){C.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let n=await C7(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||zi);C.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:n})}else C.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});C.debug("[".concat(this._clientId,"] renewToken success"))}catch(n){throw this._key=t,this._joinInfo.token=t,C.error("[".concat(this._clientId,"] renewToken failed"),n.toString()),n}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?C.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(yt.VOLUME_INDICATOR,e)},j("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new te(M.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new te(M.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new te(M.LIVE_STREAMING_TASK_CONFLICT);let i=t?_l.TRANSCODE:_l.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(_l.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){let t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!t.length)throw new te(M.INVALID_PARAMS,"can not find live streaming url to stop");await Ie.all(t.map(i=>i&&i.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){fM(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){fM(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof i0&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new te(M.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){let r=new TextEncoder;e.payload=r.encode(e.payload)}let n=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ce(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(n=!0,e.payload=await(async function(r,s,c){var l;let d=xr(l=Array.from(c)).call(l,(O,N)=>O+N,0),h={serverTs:0,seq:zB++,length:c.length,checkSum:d},f=new Uint8Array(kL(d,2)),E=new ArrayBuffer(dm),S=new DataView(E);S.setUint32(0,h.serverTs),S.setUint16(4,h.seq),S.setUint16(6,h.length),S.setUint16(8,h.checkSum);let y=16-c.length%16;c=NL(c,new Uint8Array(y));let D=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:qL,additionalData:f},s,c);return NL(new Uint8Array(E),new Uint8Array(D))})(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new te(M.INVALID_PARAMS,n?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(et.DATA_STREAM,{payload:jd(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-L7},!i)}sendMetadata(e){if(!this._joinInfo)throw new te(M.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new te(M.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(et.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:jd(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(eF),!this._joinInfo)throw new te(M.INVALID_OPERATION,"can not send custom report, not joined");await He.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){let e=this._statsCollector.getRemoteNetworkQualityStats();if(j("DELETE_NEQ_AFTER_USER_LEAVE")){let t=this._users.map(i=>i.uid+"");Object.keys(e).forEach(i=>{Ce(t).call(t,i)||delete e[i]})}return e}async pickSVCLayer(e,t){tn(t.spatialLayer,"spatialLayer",[0,1,2,3]),tn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(i){throw C.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){let{apRTM:t=!1,rtmFlag:i}=e;if(co(t,"apRTM"),Jt(i,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=i,C.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(C.debug("[".concat(this._clientId,"] reset client")),(function(e){let t=ym.indexOf(e);t!==-1&&ym.splice(t,1)})(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=br.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&BM(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&He.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Vn("client-publish",this._clientId),this._subscribeMutex=new Vn("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var i;let n=e||Dh();e?C.debug("[".concat(this._clientId,"] new Session ").concat(n)):C.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(n));let r=e?"":this._sessionId||"";this._sessionId=n,this.store.sessionId=n,He.addSid(n);let s={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:t?.stringUid||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:r,clientRole:this.role==="audience"?2:1};He.sessionInit(this._sessionId,Ps({cname:t.channel,appid:t.appId},s)),this._joinInfo&&(this._joinInfo.sid=n),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=n)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new te(M.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(M.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&j("FORCE_TURN")&&!j("TURN_ENABLE_TCP")&&!j("TURN_ENABLE_UDP"))throw new te(M.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");C.debug("[".concat(this._clientId,"] publish high stream"));try{let i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){let n=(await i.next()).value;if(n){try{await this._gateway.sendExtensionMessage(Ui.PUBLISH,n,!0)}catch(r){throw i.throw(r),r}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let n=(await i.next()).value;if(n){var t;let r;try{r=await this._gateway.publish(this._uid,n,!0)}catch(s){if(s.code!==M.DISCONNECT_P2P)throw i.throw(s),s}await i.next(((t=r)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let r of e)r instanceof oi&&r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig).catch(s=>{C.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!r.muted&&r.enabled||await this._p2pChannel.muteLocalTrack(r)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i?.code,e),i?.code===M.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new te(M.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(M.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));C.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n=(await i.next()).value;if(n){var t;let r;try{r=await this._gateway.publish(this._uid,n,!0)}catch(s){if(s.code!==M.DISCONNECT_P2P)throw i.throw(s),s}i.next(((t=r)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i?.code,void 0,!0),i?.code===M.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){let t=()=>{if(!this._joinInfo||!this._appId)return new te(M.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let i=(n={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Sl("LiveStreaming").create(n));var n;return i.onLiveStreamError=(r,s)=>{He.reportApiInvoke(this._sessionId,{name:Li.ON_LIVE_STREAM_ERROR,options:[r,s],tag:_i.TRACER}).onSuccess(),this.safeEmit(yt.LIVE_STREAMING_ERROR,r,s)},i.onLiveStreamWarning=(r,s)=>{He.reportApiInvoke(this._sessionId,{name:Li.ON_LIVE_STREAM_WARNING,options:[r,s],tag:_i.TRACER}).onSuccess(),this.safeEmit(yt.LIVE_STREAMING_WARNING,r,s)},i.on(tI.REQUEST_WORKER_MANAGER_LIST,(r,s,c)=>{if(!this._joinInfo)return c(new te(M.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(l,d,h,f){let E=j("UAP_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(S=>d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(S+"/api/v1?action=uap"):"https://".concat(S,"/api/v1?action=uap"));return await E7(E,l,d,h,f)})(r,this._joinInfo,this._axiosCancelSource.token,zi).then(s).catch(c)}),i};return e===_l.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new te(M.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:t,sendResolutionHeight:i}=this.getLocalVideoStats(),n=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:i}},Sl("ChannelMediaRelay").create(e));n.on("state",r=>{r===Gr.RELAY_STATE_FAILURE&&n&&n.dispose(),this.safeEmit(yt.CHANNEL_MEDIA_RELAY_STATE,r)}),n.on("event",r=>{this.safeEmit(yt.CHANNEL_MEDIA_RELAY_EVENT,r)}),this._channelMediaRelayClient=n,this._statsCollector.onStatsChanged=(r,s)=>{var c;r==="resolution"&&((c=this._channelMediaRelayClient)===null||c===void 0||c.setVideoProfile(s))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){let{added:i,deleted:n}=e,r=[];if(t){let s=[];this._users.forEach(c=>{c._dataChannels.forEach(l=>{i.every(d=>d.uid!==c._uintid||d.stream_id!==l.id)&&s.push({uid:c._uintid,stream_id:l.id,ordered:l.ordered,max_retrans_times:l.maxRetransmits,metadata:l.metadata})})}),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(i)&&i.length>0&&i.forEach(s=>{let{uid:c,stream_id:l,ordered:d,max_retrans_times:h,metadata:f}=s,E=this._users.find(S=>S._uintid===c);if(!E)return void C.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(C.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(c)),Ce(r).call(r,E)||r.push(E),E._uintid||(E._uintid=c),E._dataChannels.findIndex(S=>S.id===s.stream_id)===-1){let S={id:l,ordered:!!d,maxRetransmits:h,metadata:f},y=(function(D){return Qk(D,!0)})(S);E._dataChannels.push(y),C.info("[".concat(this._clientId,"] remote user ").concat(E.uid," published datachannel")),t||this.safeEmit(yt.USER_PUBLISHED,E,"datachannel",S)}this._p2pChannel.hasPendingRemoteDataChannel(E,s.stream_id)&&(C.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(E.uid," after reconnect.")),this._subscribeDataChannel(E,s.stream_id).catch(S=>{C.error("[".concat(this._clientId,"] resubscribe datachannel error"),S.toString())}))}),t&&(this.safeEmit(yt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(n)&&n.length>0&&n.forEach(s=>{let{uid:c,stream_id:l}=s,d=this._users.find(f=>f._uintid===c);if(!d)return void C.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let h=d._dataChannels.find(f=>f.id===s.stream_id);h&&(C.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(c)),this._p2pChannel.unsubscribeDataChannel(d,[h]).then(f=>{if(d._dataChannels=d._dataChannels.filter(E=>E!==h),f)return this._gateway.unsubscribeDataChannel(f,d.uid)}),C.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished datachannel ,id:").concat(h.id)),this.safeEmit(yt.USER_UNPUBLISHED,d,"datachannel",h._config))})}_getEncodingName(e){var t;if(!this._joinResponse)return;let i=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(i)for(let r of i){var n;if(r.payloadType===e)return r==null||(n=r.rtpMap)===null||n===void 0?void 0:n.encodingName}}_handleRemoveDataChannels(e){let t=this._users.find(i=>i.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){C.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));let i=()=>{C.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(n=>{this.safeEmit(yt.USER_UNPUBLISHED,t,"datachannel",n._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(n=>{if(n)return this._gateway.unsubscribeDataChannel(n,t.uid)}),i()}}else C.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(hn.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void C.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),i=Date.now();Object.keys(t).forEach(n=>{let{value:r,type:s,expires:c}=t[n];c&&c<=i||s||qw()||!Object.prototype.hasOwnProperty.call(Ey,n)||(uo[n]=r,pi[n]=r,C.debug("Update gateway parameters from config distribute",n,r))})}catch(t){C.error("Error update config from local cache",t.message)}})()}),this._gateway.on(hn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(hn.CONNECTION_STATE_CHANGE,(e,t,i)=>{var n;if(i===Gt.FALLBACK)return;let r=()=>{this.safeEmit(yt.CONNECTION_STATE_CHANGE,e,t,i)};if(He.reportApiInvoke(this._sessionId||((n=this._gateway.joinInfo)===null||n===void 0?void 0:n.sid)||null,{name:Li.CONNECTION_STATE_CHANGE,options:[e,t,i],tag:_i.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:i})),C.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void r();if(e==="RECONNECTING")this._users.forEach(c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._is_pre_created||(c._audio_pre_subscribed||(c._audioSSRC=void 0,c._audioOrtc=void 0),c._video_pre_subscribed||(c._videoSSRC=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),c._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach((c,l)=>{this._gateway.setStreamFallbackOption(l,c).catch(d=>{C.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),d)})}),this._remoteStreamTypeCacheMap.forEach((c,l)=>{this._gateway.setRemoteVideoStreamType(l,c).catch(d=>{C.warning("[".concat(this._clientId,"] auto set remote stream type failed"),d)})}),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{C.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(c=>{C.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(c=>!c._trust_in_room_).forEach(c=>{C.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(c=>{c._trust_audio_mute_state_||(C.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,ke.AUDIO,!1)),c._trust_video_mute_state_||(C.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,ke.VIDEO,!1)),c._trust_audio_enabled_state_||(C.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(C.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(C.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(C.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(C.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))}))},1e3))}r()}),this._gateway.on(hn.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new te(M.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i,n=await VM(Ps(Ps({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));n?(i=n.ap,FM(n),this._joinInfo.preload=!0):(i=await EI(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||zi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);let r=[];i.gatewayInfo.gatewayAddrs.forEach(s=>{let{address:c}=s,[l,d]=c.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:l,port:d}):r.push({host:l,port:d})}),e(r)}catch(i){t(i)}}),this._gateway.on(hn.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(yt.NETWORK_QUALITY,e)}),this._gateway.on(hn.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(yt.STREAM_TYPE_CHANGED,e,t),He.reportApiInvoke(this._sessionId,{name:Li.STREAM_TYPE_CHANGE,options:[e,t],tag:_i.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(hn.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(hn.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,i)=>{try{let n=await this._p2pChannel.getEstablishParams();n&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(n=await this._p2pChannel.startP2PConnection(e)),t(n)}catch(n){i(n)}}),this._gateway.on(hn.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let i;this._joinResponse=e,e.attributes?i=e.attributes.userAttributes.preSubSsrcs:C.debug("no attributes in joinResponse");let n=Bk(e.ortc,t,i);this._p2pChannel.connect(n)}),this._gateway.on(hn.PRE_CONNECT_PC,async e=>{let{candidates:t,fingerprint:i,turnServer:n}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){let{cert:s,cid:c}=this._joinInfo.apResponse,l="".concat(c,"_").concat(s);if(l.length<4||l.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:n,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var r;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(c,"_").concat(s),icePwd:"".concat(c,"_").concat(s)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(r=j("FINGERPRINT"))!==null&&r!==void 0?r:i}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(d){d.code&&d.code===M.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:n,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Rt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Rt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Rt.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(Rt.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Rt.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Rt.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Rt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Rt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Rt.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,ke.AUDIO,!0)),this._gateway.signal.on(Rt.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,ke.AUDIO,!1)),this._gateway.signal.on(Rt.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,ke.VIDEO,!0)),this._gateway.signal.on(Rt.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,ke.VIDEO,!1)),this._gateway.signal.on(Rt.RECEIVE_METADATA,e=>{let t=Nh(e.metadata);this.safeEmit(yt.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Rt.ON_DATA_STREAM,async e=>{var t;if(!e)return;let i=Nh(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ce(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<dm)throw new te(M.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(dm));i=await(async function(r,s,c){let l=c.subarray(0,dm),d=l.slice(8,dm),h=(d[0]<<8)+d[1],f=(l[6]<<8)+l[7],E=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:r,tagLength:qL,additionalData:new Uint8Array(kL(h,2))},s,c.subarray(dm));return new Uint8Array(E).subarray(0,f)})(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let n=0;if(e.ordered||e.syncWithAudio){let r=this._p2pChannel.getStats(),s=this.remoteUsers.find(l=>l.uid===e.uid);n=r?.audioRecv.find(l=>l.ssrc===s?._audioSSRC)?.jitterBufferMs}(n==null||Number.isNaN(n))&&(n=0),x7(Ps(Ps({},e),{},{payload:i}),n,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Rt.ON_CRYPT_ERROR,()=>{Vd(()=>{C.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(yt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Rt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Rt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{C.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Gt.TOKEN_EXPIRE),this.safeEmit(yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Rt.ON_STREAM_FALLBACK_UPDATE,e=>{C.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(yt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Rt.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),C.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Rt.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Rt.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(at.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case et.PUBLISH:{if(!t)return;let r=t.ortc;if(r){var i,n;let s=r.some(d=>{let{stream_type:h}=d;return h===Wt.Audio}),c=r.some(d=>{let{stream_type:h}=d;return h!==Wt.Audio}),l=r.some(d=>{let{stream_type:h}=d;return h===Wt.Screen||h===Wt.ScreenLow});t.state==="offer"&&He.publish(this._joinInfo.sid,{eventElapse:Gn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:M.TIMEOUT,audio:s,video:c,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:l,audioName:s?(i=r.find(d=>{let{stream_type:h}=d;return h===Wt.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:c?(n=r.find(d=>{let{stream_type:h}=d;return h!==Wt.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0})}break}case et.SUBSCRIBE:t&&He.subscribe(this._joinInfo.sid,{succ:!1,ec:M.TIMEOUT,audio:t.stream_type===ke.AUDIO,video:t.stream_type===ke.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Gn.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(Rt.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Rt.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;j("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(n=>!jh(n.string_id||n.stream_id,this.channelName)));let t=[],i=[];for(let n of e.users){let r=this._users.find(f=>f._uintid===n.stream_id);r?r._trust_in_room_=!0:(r=new Jd(n.string_id||n.stream_id,n.stream_id),this._users.push(r),this.store.firstVideoFrameDecoded(r.uid,{userJoinNotify:Date.now()}),this.getListeners(yt.PUBLISHED_USER_LIST).length===0&&(C.debug("[".concat(this._clientId,"] user online"),n.stream_id),this.safeEmit(yt.USER_JOINED,r)));let s=cn.Audio&n.stream_type,c=(cn.Video|cn.LwoVideo)&n.stream_type,l=(65280&n.stream_type)!=0,d=s&&r.hasAudio,h=c&&r.hasVideo;c&&(r._trust_video_stream_added_state_=!0,r._video_added_=!0,r._videoSSRC=n.video_ssrc,r._rtxSsrcId=n.video_rtx),s&&(r._trust_audio_stream_added_state_=!0,r._audio_added_=!0,r._audioSSRC=n.audio_ssrc),s&&!d&&this.getListeners(yt.PUBLISHED_USER_LIST).length===0&&(C.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published audio")),this.safeEmit(yt.USER_PUBLISHED,r,"audio")),c&&!h&&this.getListeners(yt.PUBLISHED_USER_LIST).length===0&&(C.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published video")),this.safeEmit(yt.USER_PUBLISHED,r,"video")),(s&&!d||c&&!h||l)&&t.push(r),c&&this._p2pChannel.hasPendingRemoteMedia(r,"video")&&i.push({user:r,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(r,"audio")&&i.push({user:r,mediaType:"audio"})}i.length>0&&(C.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(n=>"user: ".concat(n.user.uid,", mediaType: ").concat(n.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(n=>{C.error("[".concat(this._clientId,"] mass resubscribe error"),n.toString())})),this.getListeners(yt.PUBLISHED_USER_LIST).length>0?j("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(C.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(n=>n.uid).join(", "))),this.safeEmit(yt.PUBLISHED_USER_LIST,t)):C.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(n=>n.uid).join(", ")))}),this._gateway.signal.on(Rt.ON_RTP_CAPABILITY_CHANGE,e=>{let{video_codec:t}=e;this._p2pChannel instanceof i0&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(i=>i.toLowerCase()).filter(i=>{var n;return Ce(n=Object.keys(jg)).call(n,i)}))})}_handleP2PEvents(){this._gateway.signal.on(Rt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Ui.PUBLISH,(e,t,i)=>{let{uid:n}=e;e.forEach(r=>{let{kind:s,ssrcs:c,mid:l,isMuted:d}=r;this._handleP2PAddAudioOrVideoStream(s,n,c[0].ssrcId,l);let h=this._users.find(f=>f.uid===n);return h&&this.store.useP2P?this._p2pChannel.mockSubscribe(h,s,c[0].ssrcId,l).then(()=>{t()}).catch(i):t(),this._handleMuteStream(n,s,!!d)})}),this._gateway.signal.on(Ui.CALL,async(e,t,i)=>{if(this.store.useP2P)try{var n;t(await this._p2pChannel.startP2P({turnServer:(n=this._joinInfo)===null||n===void 0?void 0:n.turnServer},e))}catch(r){i(r)}}),this._gateway.signal.on(at.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Ui.UNPUBLISH,async(e,t,i)=>{if(this.store.useP2P){let{unpubMsg:n,uid:r}=e,s=this._users.find(c=>c.uid===r);if(!s)return C.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r)),void t();try{n.forEach(async c=>{let{stream_type:l}=c,d=l===Wt.Audio?ke.AUDIO:ke.VIDEO;await this._p2pChannel.unsubscribe(s,d),this._handleMuteStream(r,d,!0)}),t()}catch(c){i(c)}}}),this._gateway.signal.on(Ui.CONTROL,async(e,t)=>{let{action:i}=e;switch(i){case Hd.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,ke.VIDEO,!0);break;case Hd.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,ke.AUDIO,!0);break;case Hd.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,ke.VIDEO,!1);break;case Hd.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,ke.AUDIO,!1)}}),this._gateway.signal.on(Ui.RESTART_ICE,async(e,t,i)=>{if(this.store.useP2P)try{let{direction:n,iceParameter:r}=e;n!==mr.SEND_ONLY||r?t(await this._p2pChannel.restartICE(n,r)):(this._p2pChannel.handleDisconnect(n),t())}catch(n){i(n)}}),this._gateway.signal.on(Ui.CANDIDATE,e=>{if(this.store.useP2P){let{candidate:t,direction:i}=e;this._p2pChannel.addRemoteCandidate(t,i)}}),this._p2pChannel.on(Ke.RequestP2PRestartICE,async(e,t,i)=>{try{let{direction:n}=e;t(await this._gateway.sendExtensionMessage(Ui.RESTART_ICE,e,n===mr.SEND_ONLY))}catch(n){i(n)}}),this._p2pChannel.on(Ke.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Ui.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Ke.RequestP2PMuteLocal,async(e,t,i)=>{try{await this._gateway.sendExtensionMessage(Ui.CONTROL,e,!0),t()}catch(n){i(n)}}),this._p2pChannel.on(Ke.RequestP2PUnmuteRemote,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(n){n.code===M.DISCONNECT_P2P?t():i(n)}else t()}),this._p2pChannel.on(Ke.RequestP2PMuteRemote,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(n){n.code===M.DISCONNECT_P2P?t():i(n)}else t()}),this._p2pChannel.on(Ke.StateChange,(e,t)=>{t===Ht.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Ke.PeerConnectionStateChange,e=>{let t=this._peerConnectionState;e!==t&&(this.safeEmit(yt.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(Ke.RequestMuteLocal,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(n){n.code===M.DISCONNECT_P2P?t():i(n)}else t()}),this._p2pChannel.on(Ke.RequestUnmuteLocal,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(n){n.code===M.DISCONNECT_P2P?t():i(n)}else t()}),this._p2pChannel.on(Ke.RequestRePublish,(e,t,i)=>{this.publish(e,!1).then(t).catch(i)}),this._p2pChannel.on(Ke.RequestRePublishDataChannel,(e,t,i)=>{Ie.all(e.map(async n=>{let r=await this._p2pChannel.publishDataChannel([n]);try{r.forEach(s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)})}catch(s){if(s.code!==M.DISCONNECT_P2P)throw s}})).then(t).catch(i)}),this._p2pChannel.on(Ke.RequestReSubscribe,async(e,t,i)=>{try{for(let{user:n,kind:r}of e)r===ke.VIDEO?await this.subscribe(n,"video"):await this.subscribe(n,"audio");t()}catch(n){i(n)}}),this._p2pChannel.on(Ke.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Ke.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Ke.MediaReconnectStart,e=>{this.safeEmit(yt.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Ke.MediaReconnectEnd,e=>{this.safeEmit(yt.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Ke.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Ke.RequestRestartICE,async e=>{if(this.store.useP2P)return;let t=await this._p2pChannel.restartICE(e),i=await t.next();if(i.done)return;let n=i.value,r;try{r=await this._gateway.restartICE({iceParameters:n})}catch(c){return void t.throw(c)}let{iceParameters:s}=(function(c){let l=c.iceParameters;return{iceParameters:{iceUfrag:l.iceUfrag,icePwd:l.icePwd}}})(r);await t.next({remoteIceParameters:s})}),this._p2pChannel.on(Ke.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Ke.RequestReconnectPC,async()=>{var e;let{iceParameters:t,dtlsParameters:i,rtpCapabilities:n}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:r,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:i,rtpCapabilities:n}),c=Bk(r,s);await this._p2pChannel.connect(c),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Ke.RequestUnpublishForReconnectPC,async(e,t,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):i()}),this._p2pChannel.on(Ke.P2PLost,()=>{this.safeEmit(yt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Ke.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Ke.ConnectionTypeChange,e=>{this.safeEmit(yt.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Ke.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Ke.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Ke.AudioMetadata,e=>{this.safeEmit(yt.AUDIO_METADATA,e)}),this._p2pChannel.on(Ke.AudioPts,e=>{this.safeEmit(yt.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new te(M.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new te(M.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let i=(t={config:e},Sl("ContentInspect").create(t));this._inspect=i,this.handleVideoInspectEvents(i);let{appId:n,cname:r,sid:s,token:c,uid:l,cid:d,vid:h}=this._joinInfo;await i.init({appId:n,areaCode:"",cname:r,sid:s,token:c,uid:l,cid:d,vid:h?Number(h):0},zi)}catch(i){throw Array.isArray(i)?i[0]:i}var t}handleVideoInspectEvents(e){e.on(pn.CONNECTION_STATE_CHANGE,(t,i)=>{if(this.safeEmit(yt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,i),i===Os.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(yt.CONTENT_INSPECT_ERROR,new te(M.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(pn.INSPECT_RESULT,(t,i)=>{var n;if(i?.code===M.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return C.debug("Stop inspect content because that has left channel"),this==null||(n=this._inspect)===null||n===void 0||n.close(),void(this._inspect=void 0);this.safeEmit(yt.CONTENT_INSPECT_RESULT,t,i)}),e.on(pn.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new te(M.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(co(e,"enabled"),e){if(!t)throw new te(M.INVALID_PARAMS,"config is required");if(eU(t),!this._joinInfo)throw new te(M.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{let n=(i={config:t},Sl("ImageModeration").create(i));this._moderation=n,this.handleImageModerationEvents(n);let{appId:r,cname:s,sid:c,token:l,uid:d,cid:h,vid:f}=this._joinInfo;await n.init({appId:r,areaCode:"",cname:s,sid:c,token:l,uid:d,cid:h,vid:f?Number(f):0},zi)}}catch(n){throw Array.isArray(n)?n[0]:n}}else{var i;if(!this._moderation)throw new te(M.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(n){throw Array.isArray(n)?n[0]:n}}}handleImageModerationEvents(e){e.on(fo.CONNECTION_STATE_CHANGE,(t,i)=>{if(this.safeEmit(yt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,i),t===Za.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new te(M.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(fo.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(e){if((function(t){tn(t,"transport",["default","auto","relay","sd-rtn"])})(e),this.mode!=="p2p")throw new te(M.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,C.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return C.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){co(e,"enabled"),Kt("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Fe(xe.prototype,"leave",[tU],Object.getOwnPropertyDescriptor(xe.prototype,"leave"),xe.prototype),Fe(xe.prototype,"publish",[iU],Object.getOwnPropertyDescriptor(xe.prototype,"publish"),xe.prototype),Fe(xe.prototype,"unpublish",[nU],Object.getOwnPropertyDescriptor(xe.prototype,"unpublish"),xe.prototype),Fe(xe.prototype,"subscribe",[rU],Object.getOwnPropertyDescriptor(xe.prototype,"subscribe"),xe.prototype),Fe(xe.prototype,"presubscribe",[aU],Object.getOwnPropertyDescriptor(xe.prototype,"presubscribe"),xe.prototype),Fe(xe.prototype,"massSubscribe",[sU],Object.getOwnPropertyDescriptor(xe.prototype,"massSubscribe"),xe.prototype),Fe(xe.prototype,"unsubscribe",[oU],Object.getOwnPropertyDescriptor(xe.prototype,"unsubscribe"),xe.prototype),Fe(xe.prototype,"massUnsubscribe",[cU],Object.getOwnPropertyDescriptor(xe.prototype,"massUnsubscribe"),xe.prototype),Fe(xe.prototype,"setLowStreamParameter",[lU],Object.getOwnPropertyDescriptor(xe.prototype,"setLowStreamParameter"),xe.prototype),Fe(xe.prototype,"enableDualStream",[dU],Object.getOwnPropertyDescriptor(xe.prototype,"enableDualStream"),xe.prototype),Fe(xe.prototype,"disableDualStream",[uU],Object.getOwnPropertyDescriptor(xe.prototype,"disableDualStream"),xe.prototype),Fe(xe.prototype,"setClientRole",[hU],Object.getOwnPropertyDescriptor(xe.prototype,"setClientRole"),xe.prototype),Fe(xe.prototype,"_setClientRoleOptions",[pU],Object.getOwnPropertyDescriptor(xe.prototype,"_setClientRoleOptions"),xe.prototype),Fe(xe.prototype,"setProxyServer",[fU],Object.getOwnPropertyDescriptor(xe.prototype,"setProxyServer"),xe.prototype),Fe(xe.prototype,"setTurnServer",[mU],Object.getOwnPropertyDescriptor(xe.prototype,"setTurnServer"),xe.prototype),Fe(xe.prototype,"setLicense",[_U],Object.getOwnPropertyDescriptor(xe.prototype,"setLicense"),xe.prototype),Fe(xe.prototype,"startProxyServer",[EU],Object.getOwnPropertyDescriptor(xe.prototype,"startProxyServer"),xe.prototype),Fe(xe.prototype,"stopProxyServer",[gU],Object.getOwnPropertyDescriptor(xe.prototype,"stopProxyServer"),xe.prototype),Fe(xe.prototype,"setLocalAccessPointsV2",[SU],Object.getOwnPropertyDescriptor(xe.prototype,"setLocalAccessPointsV2"),xe.prototype),Fe(xe.prototype,"setLocalAccessPoints",[vU],Object.getOwnPropertyDescriptor(xe.prototype,"setLocalAccessPoints"),xe.prototype),Fe(xe.prototype,"setRemoteDefaultVideoStreamType",[TU],Object.getOwnPropertyDescriptor(xe.prototype,"setRemoteDefaultVideoStreamType"),xe.prototype),Fe(xe.prototype,"setRemoteVideoStreamType",[yU],Object.getOwnPropertyDescriptor(xe.prototype,"setRemoteVideoStreamType"),xe.prototype),Fe(xe.prototype,"setStreamFallbackOption",[RU],Object.getOwnPropertyDescriptor(xe.prototype,"setStreamFallbackOption"),xe.prototype),Fe(xe.prototype,"setEncryptionConfig",[CU],Object.getOwnPropertyDescriptor(xe.prototype,"setEncryptionConfig"),xe.prototype),Fe(xe.prototype,"renewToken",[bU],Object.getOwnPropertyDescriptor(xe.prototype,"renewToken"),xe.prototype),Fe(xe.prototype,"enableAudioVolumeIndicator",[AU],Object.getOwnPropertyDescriptor(xe.prototype,"enableAudioVolumeIndicator"),xe.prototype),Fe(xe.prototype,"startLiveStreaming",[wU],Object.getOwnPropertyDescriptor(xe.prototype,"startLiveStreaming"),xe.prototype),Fe(xe.prototype,"setLiveTranscoding",[IU],Object.getOwnPropertyDescriptor(xe.prototype,"setLiveTranscoding"),xe.prototype),Fe(xe.prototype,"stopLiveStreaming",[OU],Object.getOwnPropertyDescriptor(xe.prototype,"stopLiveStreaming"),xe.prototype),Fe(xe.prototype,"startChannelMediaRelay",[NU],Object.getOwnPropertyDescriptor(xe.prototype,"startChannelMediaRelay"),xe.prototype),Fe(xe.prototype,"updateChannelMediaRelay",[DU],Object.getOwnPropertyDescriptor(xe.prototype,"updateChannelMediaRelay"),xe.prototype),Fe(xe.prototype,"stopChannelMediaRelay",[LU],Object.getOwnPropertyDescriptor(xe.prototype,"stopChannelMediaRelay"),xe.prototype),Fe(xe.prototype,"sendCustomReportMessage",[PU],Object.getOwnPropertyDescriptor(xe.prototype,"sendCustomReportMessage"),xe.prototype),Fe(xe.prototype,"pickSVCLayer",[xU],Object.getOwnPropertyDescriptor(xe.prototype,"pickSVCLayer"),xe.prototype),Fe(xe.prototype,"setRTMConfig",[kU],Object.getOwnPropertyDescriptor(xe.prototype,"setRTMConfig"),xe.prototype),Fe(xe.prototype,"enableContentInspect",[MU],Object.getOwnPropertyDescriptor(xe.prototype,"enableContentInspect"),xe.prototype),Fe(xe.prototype,"disableContentInspect",[UU],Object.getOwnPropertyDescriptor(xe.prototype,"disableContentInspect"),xe.prototype),Fe(xe.prototype,"setImageModeration",[VU],Object.getOwnPropertyDescriptor(xe.prototype,"setImageModeration"),xe.prototype),Fe(xe.prototype,"setP2PTransport",[jU],Object.getOwnPropertyDescriptor(xe.prototype,"setP2PTransport"),xe.prototype),Fe(xe.prototype,"getJoinChannelServiceRecords",[BU],Object.getOwnPropertyDescriptor(xe.prototype,"getJoinChannelServiceRecords"),xe.prototype),Fe(xe.prototype,"setPublishAudioFilterEnabled",[FU],Object.getOwnPropertyDescriptor(xe.prototype,"setPublishAudioFilterEnabled"),xe.prototype),xe);class a0{constructor(t,i){L(this,"id",0),L(this,"element",void 0),L(this,"peerPair",void 0),L(this,"context",void 0),L(this,"audioPlayerElement",void 0),L(this,"audioTrack",void 0),a0.count+=1,this.id=a0.count,this.element=t,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{let i=document.createElement("audio");i.srcObject=new MediaStream([t.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;let t=async(n,r)=>{let s=r==="offer"?await n.createOffer():await n.createAnswer();return await n.setLocalDescription(s),n.iceGatheringState==="complete"?n.localDescription:new Ie(c=>{n.onicegatheringstatechange=()=>{n.iceGatheringState==="complete"&&c(n.localDescription)}})},i=async(n,r)=>await n.setRemoteDescription(r);try{let n=await t(this.peerPair[0],"offer");await i(this.peerPair[1],n);let r=await t(this.peerPair[1],"answer");await i(this.peerPair[0],r)}catch(n){throw new te(M.LOCAL_AEC_ERROR,n.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let i;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(i)}catch(r){throw new te(M.LOCAL_AEC_ERROR,r.toString()).print()}if(!i)throw new te(M.LOCAL_AEC_ERROR,"no dest node when local aec").print();let n=i.stream.getAudioTracks()[0];return this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let t=this.element,i=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){C.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var HU,hR;L(a0,"count",0);let Z7=window.AudioContext||window.webkitAudioContext,Q7=new(HU=Ze({report:He}),Fe((hR=class{constructor(){L(this,"units",[]),L(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return C.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Z7);let t=this.units.find(i=>i&&i.getElement()===e);return t||(t=new a0(e,this.context),this.units.push(t)),t.startEchoCancellation(),C.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return wt().name!==kt.SAFARI}}).prototype,"processExternalMediaAEC",[HU],Object.getOwnPropertyDescriptor(hR.prototype,"processExternalMediaAEC"),hR.prototype),hR);function WU(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function zU(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?WU(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):WU(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}let MI=window||document;function KU(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!MI)return;let i=Ki._cspEventHandlerPointer;if(i&&t)return void console.error(i,t);let n=r=>{if(!(r&&r.blockedURI&&(Ki.onSecurityPolicyViolation||Ki.getListeners(hc.SECURITY_POLICY_VIOLATION).length>0)))return;let s=r.blockedURI;j("CSP_DETECTED_HOSTNAME_LIST").some(c=>Ce(s).call(s,c))&&(Ki.onSecurityPolicyViolation&&typeof Ki.onSecurityPolicyViolation=="function"&&Ki.onSecurityPolicyViolation(r),Ki.getListeners(hc.SECURITY_POLICY_VIOLATION).length>0&&Ki.safeEmit(hc.SECURITY_POLICY_VIOLATION,r))};i&&MI.removeEventListener("securitypolicyviolation",i),(t||e&&typeof e=="function"||Ki.getListeners(hc.SECURITY_POLICY_VIOLATION).length>0)&&MI.addEventListener("securitypolicyviolation",n),Ki._cspEventHandlerPointer=n}var $7=ce,eG=ID,YU=RegExp.prototype,tG=function(e){return e===YU||$7(YU,e)?eG(e):e.flags},or=R(tG);function Mm(e){let t=e.length;for(;--t>=0;)e[t]=0}let UI=256,qU=286,s0=30,o0=15,VI=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),pR=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),iG=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),XU=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Tl=new Array(576);Mm(Tl);let c0=new Array(60);Mm(c0);let l0=new Array(512);Mm(l0);let d0=new Array(256);Mm(d0);let jI=new Array(29);Mm(jI);let fR=new Array(s0);function BI(e,t,i,n,r){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=n,this.max_length=r,this.has_stree=e&&e.length}let JU,ZU,QU;function FI(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Mm(fR);let $U=e=>e<256?l0[e]:l0[256+(e>>>7)],u0=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Na=(e,t,i)=>{e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,u0(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},mc=(e,t,i)=>{Na(e,i[2*t],i[2*t+1])},e3=(e,t)=>{let i=0;do i|=1&e,e>>>=1,i<<=1;while(--t>0);return i>>>1},t3=(e,t,i)=>{let n=new Array(16),r,s,c=0;for(r=1;r<=o0;r++)c=c+i[r-1]<<1,n[r]=c;for(s=0;s<=t;s++){let l=e[2*s+1];l!==0&&(e[2*s]=e3(n[l]++,l))}},i3=e=>{let t;for(t=0;t<qU;t++)e.dyn_ltree[2*t]=0;for(t=0;t<s0;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},n3=e=>{e.bi_valid>8?u0(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},r3=(e,t,i,n)=>{let r=2*t,s=2*i;return e[r]<e[s]||e[r]===e[s]&&n[t]<=n[i]},GI=(e,t,i)=>{let n=e.heap[i],r=i<<1;for(;r<=e.heap_len&&(r<e.heap_len&&r3(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!r3(t,n,e.heap[r],e.depth));)e.heap[i]=e.heap[r],i=r,r<<=1;e.heap[i]=n},a3=(e,t,i)=>{let n,r,s,c,l=0;if(e.sym_next!==0)do n=255&e.pending_buf[e.sym_buf+l++],n+=(255&e.pending_buf[e.sym_buf+l++])<<8,r=e.pending_buf[e.sym_buf+l++],n===0?mc(e,r,t):(s=d0[r],mc(e,s+UI+1,t),c=VI[s],c!==0&&(r-=jI[s],Na(e,r,c)),n--,s=$U(n),mc(e,s,i),c=pR[s],c!==0&&(n-=fR[s],Na(e,n,c)));while(l<e.sym_next);mc(e,256,t)},HI=(e,t)=>{let i=t.dyn_tree,n=t.stat_desc.static_tree,r=t.stat_desc.has_stree,s=t.stat_desc.elems,c,l,d,h=-1;for(e.heap_len=0,e.heap_max=573,c=0;c<s;c++)i[2*c]!==0?(e.heap[++e.heap_len]=h=c,e.depth[c]=0):i[2*c+1]=0;for(;e.heap_len<2;)d=e.heap[++e.heap_len]=h<2?++h:0,i[2*d]=1,e.depth[d]=0,e.opt_len--,r&&(e.static_len-=n[2*d+1]);for(t.max_code=h,c=e.heap_len>>1;c>=1;c--)GI(e,i,c);d=s;do c=e.heap[1],e.heap[1]=e.heap[e.heap_len--],GI(e,i,1),l=e.heap[1],e.heap[--e.heap_max]=c,e.heap[--e.heap_max]=l,i[2*d]=i[2*c]+i[2*l],e.depth[d]=(e.depth[c]>=e.depth[l]?e.depth[c]:e.depth[l])+1,i[2*c+1]=i[2*l+1]=d,e.heap[1]=d++,GI(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((f,E)=>{let S=E.dyn_tree,y=E.max_code,D=E.stat_desc.static_tree,O=E.stat_desc.has_stree,N=E.stat_desc.extra_bits,k=E.stat_desc.extra_base,U=E.stat_desc.max_length,B,J,K,H,ee,ue,me=0;for(H=0;H<=o0;H++)f.bl_count[H]=0;for(S[2*f.heap[f.heap_max]+1]=0,B=f.heap_max+1;B<573;B++)J=f.heap[B],H=S[2*S[2*J+1]+1]+1,H>U&&(H=U,me++),S[2*J+1]=H,J>y||(f.bl_count[H]++,ee=0,J>=k&&(ee=N[J-k]),ue=S[2*J],f.opt_len+=ue*(H+ee),O&&(f.static_len+=ue*(D[2*J+1]+ee)));if(me!==0){do{for(H=U-1;f.bl_count[H]===0;)H--;f.bl_count[H]--,f.bl_count[H+1]+=2,f.bl_count[U]--,me-=2}while(me>0);for(H=U;H!==0;H--)for(J=f.bl_count[H];J!==0;)K=f.heap[--B],K>y||(S[2*K+1]!==H&&(f.opt_len+=(H-S[2*K+1])*S[2*K],S[2*K+1]=H),J--)}})(e,t),t3(i,h,e.bl_count)},s3=(e,t,i)=>{let n,r,s=-1,c=t[1],l=0,d=7,h=4;for(c===0&&(d=138,h=3),t[2*(i+1)+1]=65535,n=0;n<=i;n++)r=c,c=t[2*(n+1)+1],++l<d&&r===c||(l<h?e.bl_tree[2*r]+=l:r!==0?(r!==s&&e.bl_tree[2*r]++,e.bl_tree[32]++):l<=10?e.bl_tree[34]++:e.bl_tree[36]++,l=0,s=r,c===0?(d=138,h=3):r===c?(d=6,h=3):(d=7,h=4))},o3=(e,t,i)=>{let n,r,s=-1,c=t[1],l=0,d=7,h=4;for(c===0&&(d=138,h=3),n=0;n<=i;n++)if(r=c,c=t[2*(n+1)+1],!(++l<d&&r===c)){if(l<h)do mc(e,r,e.bl_tree);while(--l!=0);else r!==0?(r!==s&&(mc(e,r,e.bl_tree),l--),mc(e,16,e.bl_tree),Na(e,l-3,2)):l<=10?(mc(e,17,e.bl_tree),Na(e,l-3,3)):(mc(e,18,e.bl_tree),Na(e,l-11,7));l=0,s=r,c===0?(d=138,h=3):r===c?(d=6,h=3):(d=7,h=4)}},c3=!1,l3=(e,t,i,n)=>{Na(e,0+(n?1:0),3),n3(e),u0(e,i),u0(e,~i),i&&e.pending_buf.set(e.window.subarray(t,t+i),e.pending),e.pending+=i};var nG=e=>{c3||((()=>{let t,i,n,r,s,c=new Array(16);for(n=0,r=0;r<28;r++)for(jI[r]=n,t=0;t<1<<VI[r];t++)d0[n++]=r;for(d0[n-1]=r,s=0,r=0;r<16;r++)for(fR[r]=s,t=0;t<1<<pR[r];t++)l0[s++]=r;for(s>>=7;r<s0;r++)for(fR[r]=s<<7,t=0;t<1<<pR[r]-7;t++)l0[256+s++]=r;for(i=0;i<=o0;i++)c[i]=0;for(t=0;t<=143;)Tl[2*t+1]=8,t++,c[8]++;for(;t<=255;)Tl[2*t+1]=9,t++,c[9]++;for(;t<=279;)Tl[2*t+1]=7,t++,c[7]++;for(;t<=287;)Tl[2*t+1]=8,t++,c[8]++;for(t3(Tl,287,c),t=0;t<s0;t++)c0[2*t+1]=5,c0[2*t]=e3(t,5);JU=new BI(Tl,VI,257,qU,o0),ZU=new BI(c0,pR,0,s0,o0),QU=new BI(new Array(0),iG,0,19,7)})(),c3=!0),e.l_desc=new FI(e.dyn_ltree,JU),e.d_desc=new FI(e.dyn_dtree,ZU),e.bl_desc=new FI(e.bl_tree,QU),e.bi_buf=0,e.bi_valid=0,i3(e)},rG=(e,t,i,n)=>{let r,s,c=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(l=>{let d,h=4093624447;for(d=0;d<=31;d++,h>>>=1)if(1&h&&l.dyn_ltree[2*d]!==0)return 0;if(l.dyn_ltree[18]!==0||l.dyn_ltree[20]!==0||l.dyn_ltree[26]!==0)return 1;for(d=32;d<UI;d++)if(l.dyn_ltree[2*d]!==0)return 1;return 0})(e)),HI(e,e.l_desc),HI(e,e.d_desc),c=(l=>{let d;for(s3(l,l.dyn_ltree,l.l_desc.max_code),s3(l,l.dyn_dtree,l.d_desc.max_code),HI(l,l.bl_desc),d=18;d>=3&&l.bl_tree[2*XU[d]+1]===0;d--);return l.opt_len+=3*(d+1)+5+5+4,d})(e),r=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=r&&(r=s)):r=s=i+5,i+4<=r&&t!==-1?l3(e,t,i,n):e.strategy===4||s===r?(Na(e,2+(n?1:0),3),a3(e,Tl,c0)):(Na(e,4+(n?1:0),3),((l,d,h,f)=>{let E;for(Na(l,d-257,5),Na(l,h-1,5),Na(l,f-4,4),E=0;E<f;E++)Na(l,l.bl_tree[2*XU[E]+1],3);o3(l,l.dyn_ltree,d-1),o3(l,l.dyn_dtree,h-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,c+1),a3(e,e.dyn_ltree,e.dyn_dtree)),i3(e),n&&n3(e)},aG=(e,t,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,t===0?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(d0[i]+UI+1)]++,e.dyn_dtree[2*$U(t)]++),e.sym_next===e.sym_end),sG=e=>{Na(e,2,3),mc(e,256,Tl),(t=>{t.bi_valid===16?(u0(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},oG={_tr_init:nG,_tr_stored_block:l3,_tr_flush_block:rG,_tr_tally:aG,_tr_align:sG},h0=(e,t,i,n)=>{let r=65535&e|0,s=e>>>16&65535|0,c=0;for(;i!==0;){c=i>2e3?2e3:i,i-=c;do r=r+t[n++]|0,s=s+r|0;while(--c);r%=65521,s%=65521}return r|s<<16|0};let cG=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})());var Er=(e,t,i,n)=>{let r=cG,s=n+i;e^=-1;for(let c=n;c<s;c++)e=e>>>8^r[255&(e^t[c])];return-1^e},zh={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},mR={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};let{_tr_init:lG,_tr_stored_block:WI,_tr_flush_block:dG,_tr_tally:eu,_tr_align:uG}=oG,{Z_NO_FLUSH:tu,Z_PARTIAL_FLUSH:hG,Z_FULL_FLUSH:pG,Z_FINISH:xs,Z_BLOCK:d3,Z_OK:Or,Z_STREAM_END:u3,Z_STREAM_ERROR:_c,Z_DATA_ERROR:fG,Z_BUF_ERROR:zI,Z_DEFAULT_COMPRESSION:mG,Z_FILTERED:_G,Z_HUFFMAN_ONLY:_R,Z_RLE:EG,Z_FIXED:gG,Z_DEFAULT_STRATEGY:SG,Z_UNKNOWN:vG,Z_DEFLATED:ER}=mR,KI=286,TG=30,yG=19,RG=2*KI+1,CG=15,Kh=258,Ec=262,Um=42,Yh=113,p0=666,qh=(e,t)=>(e.msg=zh[t],t),h3=e=>2*e-(e>4?9:0),iu=e=>{let t=e.length;for(;--t>=0;)e[t]=0},bG=e=>{let t,i,n,r=e.w_size;t=e.hash_size,n=t;do i=e.head[--n],e.head[n]=i>=r?i-r:0;while(--t);t=r,n=t;do i=e.prev[--n],e.prev[n]=i>=r?i-r:0;while(--t)},nu=(e,t,i)=>(t<<e.hash_shift^i)&e.hash_mask,$a=e=>{let t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,t.pending===0&&(t.pending_out=0))},es=(e,t)=>{dG(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,$a(e.strm)},Pi=(e,t)=>{e.pending_buf[e.pending++]=t},f0=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},YI=(e,t,i,n)=>{let r=e.avail_in;return r>n&&(r=n),r===0?0:(e.avail_in-=r,t.set(e.input.subarray(e.next_in,e.next_in+r),i),e.state.wrap===1?e.adler=h0(e.adler,t,r,i):e.state.wrap===2&&(e.adler=Er(e.adler,t,r,i)),e.next_in+=r,e.total_in+=r,r)},p3=(e,t)=>{let i,n,r=e.max_chain_length,s=e.strstart,c=e.prev_length,l=e.nice_match,d=e.strstart>e.w_size-Ec?e.strstart-(e.w_size-Ec):0,h=e.window,f=e.w_mask,E=e.prev,S=e.strstart+Kh,y=h[s+c-1],D=h[s+c];e.prev_length>=e.good_match&&(r>>=2),l>e.lookahead&&(l=e.lookahead);do if(i=t,h[i+c]===D&&h[i+c-1]===y&&h[i]===h[s]&&h[++i]===h[s+1]){s+=2,i++;do;while(h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&s<S);if(n=Kh-(S-s),s=S-Kh,n>c){if(e.match_start=t,c=n,n>=l)break;y=h[s+c-1],D=h[s+c]}}while((t=E[t&f])>d&&--r!=0);return c<=e.lookahead?c:e.lookahead},Vm=e=>{let t=e.w_size,i,n,r;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Ec)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),bG(e),n+=t),e.strm.avail_in===0)break;if(i=YI(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=i,e.lookahead+e.insert>=3)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=nu(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=nu(e,e.ins_h,e.window[r+3-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Ec&&e.strm.avail_in!==0)},f3=(e,t)=>{let i,n,r,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,c=0,l=e.strm.avail_in;do{if(i=65535,r=e.bi_valid+42>>3,e.strm.avail_out<r||(r=e.strm.avail_out-r,n=e.strstart-e.block_start,i>n+e.strm.avail_in&&(i=n+e.strm.avail_in),i>r&&(i=r),i<s&&(i===0&&t!==xs||t===tu||i!==n+e.strm.avail_in)))break;c=t===xs&&i===n+e.strm.avail_in?1:0,WI(e,0,0,c),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,$a(e.strm),n&&(n>i&&(n=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,i-=n),i&&(YI(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(c===0);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),c?4:t!==tu&&t!==xs&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(r=e.window_size-e.strstart,e.strm.avail_in>r&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,r+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),r>e.strm.avail_in&&(r=e.strm.avail_in),r&&(YI(e.strm,e.window,e.strstart,r),e.strstart+=r,e.insert+=r>e.w_size-e.insert?e.w_size-e.insert:r),e.high_water<e.strstart&&(e.high_water=e.strstart),r=e.bi_valid+42>>3,r=e.pending_buf_size-r>65535?65535:e.pending_buf_size-r,s=r>e.w_size?e.w_size:r,n=e.strstart-e.block_start,(n>=s||(n||t===xs)&&t!==tu&&e.strm.avail_in===0&&n<=r)&&(i=n>r?r:n,c=t===xs&&e.strm.avail_in===0&&i===n?1:0,WI(e,e.block_start,i,c),e.block_start+=i,$a(e.strm)),c?3:1)},qI=(e,t)=>{let i,n;for(;;){if(e.lookahead<Ec){if(Vm(e),e.lookahead<Ec&&t===tu)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=nu(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-Ec&&(e.match_length=p3(e,i)),e.match_length>=3)if(n=eu(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=nu(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=nu(e,e.ins_h,e.window[e.strstart+1]);else n=eu(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(es(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===xs?(es(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(es(e,!1),e.strm.avail_out===0)?1:2},jm=(e,t)=>{let i,n,r;for(;;){if(e.lookahead<Ec){if(Vm(e),e.lookahead<Ec&&t===tu)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=nu(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-Ec&&(e.match_length=p3(e,i),e.match_length<=5&&(e.strategy===_G||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,n=eu(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=r&&(e.ins_h=nu(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(es(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(n=eu(e,0,e.window[e.strstart-1]),n&&es(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=eu(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===xs?(es(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(es(e,!1),e.strm.avail_out===0)?1:2};function gc(e,t,i,n,r){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=n,this.func=r}let m0=[new gc(0,0,0,0,f3),new gc(4,4,8,4,qI),new gc(4,5,16,8,qI),new gc(4,6,32,32,qI),new gc(4,4,16,16,jm),new gc(8,16,32,32,jm),new gc(8,16,128,128,jm),new gc(8,32,128,256,jm),new gc(32,128,258,1024,jm),new gc(32,258,258,4096,jm)];function AG(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ER,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*RG),this.dyn_dtree=new Uint16Array(2*(2*TG+1)),this.bl_tree=new Uint16Array(2*(2*yG+1)),iu(this.dyn_ltree),iu(this.dyn_dtree),iu(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(CG+1),this.heap=new Uint16Array(2*KI+1),iu(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*KI+1),iu(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}let _0=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.status!==Um&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Yh&&t.status!==p0?1:0},m3=e=>{if(_0(e))return qh(e,_c);e.total_in=e.total_out=0,e.data_type=vG;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Um:Yh,e.adler=t.wrap===2?0:1,t.last_flush=-2,lG(t),Or},_3=e=>{let t=m3(e);return t===Or&&(i=>{i.window_size=2*i.w_size,iu(i.head),i.max_lazy_match=m0[i.level].max_lazy,i.good_match=m0[i.level].good_length,i.nice_match=m0[i.level].nice_length,i.max_chain_length=m0[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(e.state),t},E3=(e,t,i,n,r,s)=>{if(!e)return _c;let c=1;if(t===mG&&(t=6),n<0?(c=0,n=-n):n>15&&(c=2,n-=16),r<1||r>9||i!==ER||n<8||n>15||t<0||t>9||s<0||s>gG||n===8&&c!==1)return qh(e,_c);n===8&&(n=9);let l=new AG;return e.state=l,l.strm=e,l.status=Um,l.wrap=c,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=r+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<r+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=t,l.strategy=s,l.method=i,_3(e)};var wG=(e,t)=>{if(_0(e)||t>d3||t<0)return e?qh(e,_c):_c;let i=e.state;if(!e.output||e.avail_in!==0&&!e.input||i.status===p0&&t!==xs)return qh(e,e.avail_out===0?zI:_c);let n=i.last_flush;if(i.last_flush=t,i.pending!==0){if($a(e),e.avail_out===0)return i.last_flush=-1,Or}else if(e.avail_in===0&&h3(t)<=h3(n)&&t!==xs)return qh(e,zI);if(i.status===p0&&e.avail_in!==0)return qh(e,zI);if(i.status===Um&&i.wrap===0&&(i.status=Yh),i.status===Um){let r=ER+(i.w_bits-8<<4)<<8,s=-1;if(s=i.strategy>=_R||i.level<2?0:i.level<6?1:i.level===6?2:3,r|=s<<6,i.strstart!==0&&(r|=32),r+=31-r%31,f0(i,r),i.strstart!==0&&(f0(i,e.adler>>>16),f0(i,65535&e.adler)),e.adler=1,i.status=Yh,$a(e),i.pending!==0)return i.last_flush=-1,Or}if(i.status===57){if(e.adler=0,Pi(i,31),Pi(i,139),Pi(i,8),i.gzhead)Pi(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Pi(i,255&i.gzhead.time),Pi(i,i.gzhead.time>>8&255),Pi(i,i.gzhead.time>>16&255),Pi(i,i.gzhead.time>>24&255),Pi(i,i.level===9?2:i.strategy>=_R||i.level<2?4:0),Pi(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Pi(i,255&i.gzhead.extra.length),Pi(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=Er(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Pi(i,0),Pi(i,0),Pi(i,0),Pi(i,0),Pi(i,0),Pi(i,i.level===9?2:i.strategy>=_R||i.level<2?4:0),Pi(i,3),i.status=Yh,$a(e),i.pending!==0)return i.last_flush=-1,Or}if(i.status===69){if(i.gzhead.extra){let r=i.pending,s=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+s>i.pending_buf_size;){let l=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+l),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>r&&(e.adler=Er(e.adler,i.pending_buf,i.pending-r,r)),i.gzindex+=l,$a(e),i.pending!==0)return i.last_flush=-1,Or;r=0,s-=l}let c=new Uint8Array(i.gzhead.extra);i.pending_buf.set(c.subarray(i.gzindex,i.gzindex+s),i.pending),i.pending+=s,i.gzhead.hcrc&&i.pending>r&&(e.adler=Er(e.adler,i.pending_buf,i.pending-r,r)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let r,s=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>s&&(e.adler=Er(e.adler,i.pending_buf,i.pending-s,s)),$a(e),i.pending!==0)return i.last_flush=-1,Or;s=0}r=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Pi(i,r)}while(r!==0);i.gzhead.hcrc&&i.pending>s&&(e.adler=Er(e.adler,i.pending_buf,i.pending-s,s)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let r,s=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>s&&(e.adler=Er(e.adler,i.pending_buf,i.pending-s,s)),$a(e),i.pending!==0)return i.last_flush=-1,Or;s=0}r=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Pi(i,r)}while(r!==0);i.gzhead.hcrc&&i.pending>s&&(e.adler=Er(e.adler,i.pending_buf,i.pending-s,s))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&($a(e),i.pending!==0))return i.last_flush=-1,Or;Pi(i,255&e.adler),Pi(i,e.adler>>8&255),e.adler=0}if(i.status=Yh,$a(e),i.pending!==0)return i.last_flush=-1,Or}if(e.avail_in!==0||i.lookahead!==0||t!==tu&&i.status!==p0){let r=i.level===0?f3(i,t):i.strategy===_R?((s,c)=>{let l;for(;;){if(s.lookahead===0&&(Vm(s),s.lookahead===0)){if(c===tu)return 1;break}if(s.match_length=0,l=eu(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,l&&(es(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,c===xs?(es(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(es(s,!1),s.strm.avail_out===0)?1:2})(i,t):i.strategy===EG?((s,c)=>{let l,d,h,f,E=s.window;for(;;){if(s.lookahead<=Kh){if(Vm(s),s.lookahead<=Kh&&c===tu)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(h=s.strstart-1,d=E[h],d===E[++h]&&d===E[++h]&&d===E[++h])){f=s.strstart+Kh;do;while(d===E[++h]&&d===E[++h]&&d===E[++h]&&d===E[++h]&&d===E[++h]&&d===E[++h]&&d===E[++h]&&d===E[++h]&&h<f);s.match_length=Kh-(f-h),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(l=eu(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(l=eu(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),l&&(es(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,c===xs?(es(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(es(s,!1),s.strm.avail_out===0)?1:2})(i,t):m0[i.level].func(i,t);if(r!==3&&r!==4||(i.status=p0),r===1||r===3)return e.avail_out===0&&(i.last_flush=-1),Or;if(r===2&&(t===hG?uG(i):t!==d3&&(WI(i,0,0,!1),t===pG&&(iu(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),$a(e),e.avail_out===0))return i.last_flush=-1,Or}return t!==xs?Or:i.wrap<=0?u3:(i.wrap===2?(Pi(i,255&e.adler),Pi(i,e.adler>>8&255),Pi(i,e.adler>>16&255),Pi(i,e.adler>>24&255),Pi(i,255&e.total_in),Pi(i,e.total_in>>8&255),Pi(i,e.total_in>>16&255),Pi(i,e.total_in>>24&255)):(f0(i,e.adler>>>16),f0(i,65535&e.adler)),$a(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Or:u3)},IG=(e,t)=>{let i=t.length;if(_0(e))return _c;let n=e.state,r=n.wrap;if(r===2||r===1&&n.status!==Um||n.lookahead)return _c;if(r===1&&(e.adler=h0(e.adler,t,i,0)),n.wrap=0,i>=n.w_size){r===0&&(iu(n.head),n.strstart=0,n.block_start=0,n.insert=0);let d=new Uint8Array(n.w_size);d.set(t.subarray(i-n.w_size,i),0),t=d,i=n.w_size}let s=e.avail_in,c=e.next_in,l=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,Vm(n);n.lookahead>=3;){let d=n.strstart,h=n.lookahead-2;do n.ins_h=nu(n,n.ins_h,n.window[d+3-1]),n.prev[d&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=d,d++;while(--h);n.strstart=d,n.lookahead=2,Vm(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=c,e.input=l,e.avail_in=s,n.wrap=r,Or},E0={deflateInit:(e,t)=>E3(e,t,ER,15,8,SG),deflateInit2:E3,deflateReset:_3,deflateResetKeep:m3,deflateSetHeader:(e,t)=>_0(e)||e.state.wrap!==2?_c:(e.state.gzhead=t,Or),deflate:wG,deflateEnd:e=>{if(_0(e))return _c;let t=e.state.status;return e.state=null,t===Yh?qh(e,fG):Or},deflateSetDictionary:IG,deflateInfo:"pako deflate (from Nodeca project)"};let OG=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var gR={assign:function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let i=t.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(let n in i)OG(i,n)&&(e[n]=i[n])}}return e},flattenChunks:e=>{let t=0;for(let n=0,r=e.length;n<r;n++)t+=e[n].length;let i=new Uint8Array(t);for(let n=0,r=0,s=e.length;n<s;n++){let c=e[n];i.set(c,r),r+=c.length}return i}};let g3=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{g3=!1}let g0=new Uint8Array(256);for(let e=0;e<256;e++)g0[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;g0[254]=g0[254]=1;var S0={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,i,n,r,s,c=e.length,l=0;for(r=0;r<c;r++)i=e.charCodeAt(r),(64512&i)==55296&&r+1<c&&(n=e.charCodeAt(r+1),(64512&n)==56320&&(i=65536+(i-55296<<10)+(n-56320),r++)),l+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(l),s=0,r=0;s<l;r++)i=e.charCodeAt(r),(64512&i)==55296&&r+1<c&&(n=e.charCodeAt(r+1),(64512&n)==56320&&(i=65536+(i-55296<<10)+(n-56320),r++)),i<128?t[s++]=i:i<2048?(t[s++]=192|i>>>6,t[s++]=128|63&i):i<65536?(t[s++]=224|i>>>12,t[s++]=128|i>>>6&63,t[s++]=128|63&i):(t[s++]=240|i>>>18,t[s++]=128|i>>>12&63,t[s++]=128|i>>>6&63,t[s++]=128|63&i);return t},buf2string:(e,t)=>{let i=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let n,r,s=new Array(2*i);for(r=0,n=0;n<i;){let c=e[n++];if(c<128){s[r++]=c;continue}let l=g0[c];if(l>4)s[r++]=65533,n+=l-1;else{for(c&=l===2?31:l===3?15:7;l>1&&n<i;)c=c<<6|63&e[n++],l--;l>1?s[r++]=65533:c<65536?s[r++]=c:(c-=65536,s[r++]=55296|c>>10&1023,s[r++]=56320|1023&c)}}return((c,l)=>{if(l<65534&&c.subarray&&g3)return String.fromCharCode.apply(null,c.length===l?c:c.subarray(0,l));let d="";for(let h=0;h<l;h++)d+=String.fromCharCode(c[h]);return d})(s,r)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let i=t-1;for(;i>=0&&(192&e[i])==128;)i--;return i<0||i===0?t:i+g0[e[i]]>t?i:t}},S3=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};let v3=Object.prototype.toString,{Z_NO_FLUSH:NG,Z_SYNC_FLUSH:DG,Z_FULL_FLUSH:LG,Z_FINISH:PG,Z_OK:SR,Z_STREAM_END:xG,Z_DEFAULT_COMPRESSION:kG,Z_DEFAULT_STRATEGY:MG,Z_DEFLATED:UG}=mR;function vR(e){this.options=gR.assign({level:kG,method:UG,chunkSize:16384,windowBits:15,memLevel:8,strategy:MG},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new S3,this.strm.avail_out=0;let i=E0.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==SR)throw new Error(zh[i]);if(t.header&&E0.deflateSetHeader(this.strm,t.header),t.dictionary){let n;if(n=typeof t.dictionary=="string"?S0.string2buf(t.dictionary):v3.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,i=E0.deflateSetDictionary(this.strm,n),i!==SR)throw new Error(zh[i]);this._dict_set=!0}}function VG(e,t){let i=new vR(t);if(i.push(e,!0),i.err)throw i.msg||zh[i.err];return i.result}vR.prototype.push=function(e,t){let i=this.strm,n=this.options.chunkSize,r,s;if(this.ended)return!1;for(s=t===~~t?t:t===!0?PG:NG,typeof e=="string"?i.input=S0.string2buf(e):v3.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),(s===DG||s===LG)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(r=E0.deflate(i,s),r===xG)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),r=E0.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===SR;if(i.avail_out!==0){if(s>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},vR.prototype.onData=function(e){this.chunks.push(e)},vR.prototype.onEnd=function(e){e===SR&&(this.result=gR.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var jG={deflate:VG};let TR=16209;var BG=function(e,t){let i,n,r,s,c,l,d,h,f,E,S,y,D,O,N,k,U,B,J,K,H,ee,ue,me,ye=e.state;i=e.next_in,ue=e.input,n=i+(e.avail_in-5),r=e.next_out,me=e.output,s=r-(t-e.avail_out),c=r+(e.avail_out-257),l=ye.dmax,d=ye.wsize,h=ye.whave,f=ye.wnext,E=ye.window,S=ye.hold,y=ye.bits,D=ye.lencode,O=ye.distcode,N=(1<<ye.lenbits)-1,k=(1<<ye.distbits)-1;e:do{y<15&&(S+=ue[i++]<<y,y+=8,S+=ue[i++]<<y,y+=8),U=D[S&N];t:for(;;){if(B=U>>>24,S>>>=B,y-=B,B=U>>>16&255,B===0)me[r++]=65535&U;else{if(!(16&B)){if(!(64&B)){U=D[(65535&U)+(S&(1<<B)-1)];continue t}if(32&B){ye.mode=16191;break e}e.msg="invalid literal/length code",ye.mode=TR;break e}J=65535&U,B&=15,B&&(y<B&&(S+=ue[i++]<<y,y+=8),J+=S&(1<<B)-1,S>>>=B,y-=B),y<15&&(S+=ue[i++]<<y,y+=8,S+=ue[i++]<<y,y+=8),U=O[S&k];i:for(;;){if(B=U>>>24,S>>>=B,y-=B,B=U>>>16&255,!(16&B)){if(!(64&B)){U=O[(65535&U)+(S&(1<<B)-1)];continue i}e.msg="invalid distance code",ye.mode=TR;break e}if(K=65535&U,B&=15,y<B&&(S+=ue[i++]<<y,y+=8,y<B&&(S+=ue[i++]<<y,y+=8)),K+=S&(1<<B)-1,K>l){e.msg="invalid distance too far back",ye.mode=TR;break e}if(S>>>=B,y-=B,B=r-s,K>B){if(B=K-B,B>h&&ye.sane){e.msg="invalid distance too far back",ye.mode=TR;break e}if(H=0,ee=E,f===0){if(H+=d-B,B<J){J-=B;do me[r++]=E[H++];while(--B);H=r-K,ee=me}}else if(f<B){if(H+=d+f-B,B-=f,B<J){J-=B;do me[r++]=E[H++];while(--B);if(H=0,f<J){B=f,J-=B;do me[r++]=E[H++];while(--B);H=r-K,ee=me}}}else if(H+=f-B,B<J){J-=B;do me[r++]=E[H++];while(--B);H=r-K,ee=me}for(;J>2;)me[r++]=ee[H++],me[r++]=ee[H++],me[r++]=ee[H++],J-=3;J&&(me[r++]=ee[H++],J>1&&(me[r++]=ee[H++]))}else{H=r-K;do me[r++]=me[H++],me[r++]=me[H++],me[r++]=me[H++],J-=3;while(J>2);J&&(me[r++]=me[H++],J>1&&(me[r++]=me[H++]))}break}}break}}while(i<n&&r<c);J=y>>3,i-=J,y-=J<<3,S&=(1<<y)-1,e.next_in=i,e.next_out=r,e.avail_in=i<n?n-i+5:5-(i-n),e.avail_out=r<c?c-r+257:257-(r-c),ye.hold=S,ye.bits=y};let yR=15,FG=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),GG=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),HG=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),WG=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var v0=(e,t,i,n,r,s,c,l)=>{let d=l.bits,h,f,E,S,y,D,O=0,N=0,k=0,U=0,B=0,J=0,K=0,H=0,ee=0,ue=0,me=null,ye=new Uint16Array(16),pt=new Uint16Array(16),mt,nt,jt,Mt=null;for(O=0;O<=yR;O++)ye[O]=0;for(N=0;N<n;N++)ye[t[i+N]]++;for(B=d,U=yR;U>=1&&ye[U]===0;U--);if(B>U&&(B=U),U===0)return r[s++]=20971520,r[s++]=20971520,l.bits=1,0;for(k=1;k<U&&ye[k]===0;k++);for(B<k&&(B=k),H=1,O=1;O<=yR;O++)if(H<<=1,H-=ye[O],H<0)return-1;if(H>0&&(e===0||U!==1))return-1;for(pt[1]=0,O=1;O<yR;O++)pt[O+1]=pt[O]+ye[O];for(N=0;N<n;N++)t[i+N]!==0&&(c[pt[t[i+N]]++]=N);if(e===0?(me=Mt=c,D=20):e===1?(me=FG,Mt=GG,D=257):(me=HG,Mt=WG,D=0),ue=0,N=0,O=k,y=s,J=B,K=0,E=-1,ee=1<<B,S=ee-1,e===1&&ee>852||e===2&&ee>592)return 1;for(;;){mt=O-K,c[N]+1<D?(nt=0,jt=c[N]):c[N]>=D?(nt=Mt[c[N]-D],jt=me[c[N]-D]):(nt=96,jt=0),h=1<<O-K,f=1<<J,k=f;do f-=h,r[y+(ue>>K)+f]=mt<<24|nt<<16|jt|0;while(f!==0);for(h=1<<O-1;ue&h;)h>>=1;if(h!==0?(ue&=h-1,ue+=h):ue=0,N++,--ye[O]==0){if(O===U)break;O=t[i+c[N]]}if(O>B&&(ue&S)!==E){for(K===0&&(K=B),y+=k,J=O-K,H=1<<J;J+K<U&&(H-=ye[J+K],!(H<=0));)J++,H<<=1;if(ee+=1<<J,e===1&&ee>852||e===2&&ee>592)return 1;E=ue&S,r[E]=B<<24|J<<16|y-s|0}}return ue!==0&&(r[y+ue]=O-K<<24|64<<16|0),l.bits=B,0};let{Z_FINISH:T3,Z_BLOCK:zG,Z_TREES:RR,Z_OK:Xh,Z_STREAM_END:KG,Z_NEED_DICT:YG,Z_STREAM_ERROR:ks,Z_DATA_ERROR:y3,Z_MEM_ERROR:R3,Z_BUF_ERROR:qG,Z_DEFLATED:C3}=mR,CR=16180,bR=16190,yl=16191,XI=16192,JI=16194,AR=16199,wR=16200,ZI=16206,fn=16209,b3=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function XG(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}let Jh=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<CR||t.mode>16211?1:0},A3=e=>{if(Jh(e))return ks;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=CR,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Xh},w3=e=>{if(Jh(e))return ks;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,A3(e)},I3=(e,t)=>{let i;if(Jh(e))return ks;let n=e.state;return t<0?(i=0,t=-t):(i=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?ks:(n.window!==null&&n.wbits!==t&&(n.window=null),n.wrap=i,n.wbits=t,w3(e))},O3=(e,t)=>{if(!e)return ks;let i=new XG;e.state=i,i.strm=e,i.window=null,i.mode=CR;let n=I3(e,t);return n!==Xh&&(e.state=null),n},QI,$I,N3=!0,JG=e=>{if(N3){QI=new Int32Array(512),$I=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(v0(1,e.lens,0,288,QI,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;v0(2,e.lens,0,32,$I,0,e.work,{bits:5}),N3=!1}e.lencode=QI,e.lenbits=9,e.distcode=$I,e.distbits=5},D3=(e,t,i,n)=>{let r,s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(t.subarray(i-s.wsize,i),0),s.wnext=0,s.whave=s.wsize):(r=s.wsize-s.wnext,r>n&&(r=n),s.window.set(t.subarray(i-n,i-n+r),s.wnext),(n-=r)?(s.window.set(t.subarray(i-n,i),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0};var ZG=(e,t)=>{let i,n,r,s,c,l,d,h,f,E,S,y,D,O,N,k,U,B,J,K,H,ee,ue=0,me=new Uint8Array(4),ye,pt,mt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Jh(e)||!e.output||!e.input&&e.avail_in!==0)return ks;i=e.state,i.mode===yl&&(i.mode=XI),c=e.next_out,r=e.output,d=e.avail_out,s=e.next_in,n=e.input,l=e.avail_in,h=i.hold,f=i.bits,E=l,S=d,ee=Xh;e:for(;;)switch(i.mode){case CR:if(i.wrap===0){i.mode=XI;break}for(;f<16;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}if(2&i.wrap&&h===35615){i.wbits===0&&(i.wbits=15),i.check=0,me[0]=255&h,me[1]=h>>>8&255,i.check=Er(i.check,me,2,0),h=0,f=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",i.mode=fn;break}if((15&h)!==C3){e.msg="unknown compression method",i.mode=fn;break}if(h>>>=4,f-=4,H=8+(15&h),i.wbits===0&&(i.wbits=H),H>15||H>i.wbits){e.msg="invalid window size",i.mode=fn;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&h?16189:yl,h=0,f=0;break;case 16181:for(;f<16;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}if(i.flags=h,(255&or(i))!==C3){e.msg="unknown compression method",i.mode=fn;break}if(57344&or(i)){e.msg="unknown header flags set",i.mode=fn;break}i.head&&(i.head.text=h>>8&1),512&or(i)&&4&i.wrap&&(me[0]=255&h,me[1]=h>>>8&255,i.check=Er(i.check,me,2,0)),h=0,f=0,i.mode=16182;case 16182:for(;f<32;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}i.head&&(i.head.time=h),512&or(i)&&4&i.wrap&&(me[0]=255&h,me[1]=h>>>8&255,me[2]=h>>>16&255,me[3]=h>>>24&255,i.check=Er(i.check,me,4,0)),h=0,f=0,i.mode=16183;case 16183:for(;f<16;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}i.head&&(i.head.xflags=255&h,i.head.os=h>>8),512&or(i)&&4&i.wrap&&(me[0]=255&h,me[1]=h>>>8&255,i.check=Er(i.check,me,2,0)),h=0,f=0,i.mode=16184;case 16184:if(1024&or(i)){for(;f<16;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}i.length=h,i.head&&(i.head.extra_len=h),512&or(i)&&4&i.wrap&&(me[0]=255&h,me[1]=h>>>8&255,i.check=Er(i.check,me,2,0)),h=0,f=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&or(i)&&(y=i.length,y>l&&(y=l),y&&(i.head&&(H=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(n.subarray(s,s+y),H)),512&or(i)&&4&i.wrap&&(i.check=Er(i.check,n,y,s)),l-=y,s+=y,i.length-=y),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&or(i)){if(l===0)break e;y=0;do H=n[s+y++],i.head&&H&&i.length<65536&&(i.head.name+=String.fromCharCode(H));while(H&&y<l);if(512&or(i)&&4&i.wrap&&(i.check=Er(i.check,n,y,s)),l-=y,s+=y,H)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&or(i)){if(l===0)break e;y=0;do H=n[s+y++],i.head&&H&&i.length<65536&&(i.head.comment+=String.fromCharCode(H));while(H&&y<l);if(512&or(i)&&4&i.wrap&&(i.check=Er(i.check,n,y,s)),l-=y,s+=y,H)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&or(i)){for(;f<16;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}if(4&i.wrap&&h!==(65535&i.check)){e.msg="header crc mismatch",i.mode=fn;break}h=0,f=0}i.head&&(i.head.hcrc=or(i)>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=yl;break;case 16189:for(;f<32;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}e.adler=i.check=b3(h),h=0,f=0,i.mode=bR;case bR:if(i.havedict===0)return e.next_out=c,e.avail_out=d,e.next_in=s,e.avail_in=l,i.hold=h,i.bits=f,YG;e.adler=i.check=1,i.mode=yl;case yl:if(t===zG||t===RR)break e;case XI:if(i.last){h>>>=7&f,f-=7&f,i.mode=ZI;break}for(;f<3;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}switch(i.last=1&h,h>>>=1,f-=1,3&h){case 0:i.mode=16193;break;case 1:if(JG(i),i.mode=AR,t===RR){h>>>=2,f-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=fn}h>>>=2,f-=2;break;case 16193:for(h>>>=7&f,f-=7&f;f<32;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",i.mode=fn;break}if(i.length=65535&h,h=0,f=0,i.mode=JI,t===RR)break e;case JI:i.mode=16195;case 16195:if(y=i.length,y){if(y>l&&(y=l),y>d&&(y=d),y===0)break e;r.set(n.subarray(s,s+y),c),l-=y,s+=y,d-=y,c+=y,i.length-=y;break}i.mode=yl;break;case 16196:for(;f<14;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}if(i.nlen=257+(31&h),h>>>=5,f-=5,i.ndist=1+(31&h),h>>>=5,f-=5,i.ncode=4+(15&h),h>>>=4,f-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=fn;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;f<3;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}i.lens[mt[i.have++]]=7&h,h>>>=3,f-=3}for(;i.have<19;)i.lens[mt[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,ye={bits:i.lenbits},ee=v0(0,i.lens,0,19,i.lencode,0,i.work,ye),i.lenbits=ye.bits,ee){e.msg="invalid code lengths set",i.mode=fn;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;ue=i.lencode[h&(1<<i.lenbits)-1],N=ue>>>24,k=ue>>>16&255,U=65535&ue,!(N<=f);){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}if(U<16)h>>>=N,f-=N,i.lens[i.have++]=U;else{if(U===16){for(pt=N+2;f<pt;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}if(h>>>=N,f-=N,i.have===0){e.msg="invalid bit length repeat",i.mode=fn;break}H=i.lens[i.have-1],y=3+(3&h),h>>>=2,f-=2}else if(U===17){for(pt=N+3;f<pt;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}h>>>=N,f-=N,H=0,y=3+(7&h),h>>>=3,f-=3}else{for(pt=N+7;f<pt;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}h>>>=N,f-=N,H=0,y=11+(127&h),h>>>=7,f-=7}if(i.have+y>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=fn;break}for(;y--;)i.lens[i.have++]=H}}if(i.mode===fn)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=fn;break}if(i.lenbits=9,ye={bits:i.lenbits},ee=v0(1,i.lens,0,i.nlen,i.lencode,0,i.work,ye),i.lenbits=ye.bits,ee){e.msg="invalid literal/lengths set",i.mode=fn;break}if(i.distbits=6,i.distcode=i.distdyn,ye={bits:i.distbits},ee=v0(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,ye),i.distbits=ye.bits,ee){e.msg="invalid distances set",i.mode=fn;break}if(i.mode=AR,t===RR)break e;case AR:i.mode=wR;case wR:if(l>=6&&d>=258){e.next_out=c,e.avail_out=d,e.next_in=s,e.avail_in=l,i.hold=h,i.bits=f,BG(e,S),c=e.next_out,r=e.output,d=e.avail_out,s=e.next_in,n=e.input,l=e.avail_in,h=i.hold,f=i.bits,i.mode===yl&&(i.back=-1);break}for(i.back=0;ue=i.lencode[h&(1<<i.lenbits)-1],N=ue>>>24,k=ue>>>16&255,U=65535&ue,!(N<=f);){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}if(k&&!(240&k)){for(B=N,J=k,K=U;ue=i.lencode[K+((h&(1<<B+J)-1)>>B)],N=ue>>>24,k=ue>>>16&255,U=65535&ue,!(B+N<=f);){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}h>>>=B,f-=B,i.back+=B}if(h>>>=N,f-=N,i.back+=N,i.length=U,k===0){i.mode=16205;break}if(32&k){i.back=-1,i.mode=yl;break}if(64&k){e.msg="invalid literal/length code",i.mode=fn;break}i.extra=15&k,i.mode=16201;case 16201:if(i.extra){for(pt=i.extra;f<pt;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}i.length+=h&(1<<i.extra)-1,h>>>=i.extra,f-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;ue=i.distcode[h&(1<<i.distbits)-1],N=ue>>>24,k=ue>>>16&255,U=65535&ue,!(N<=f);){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}if(!(240&k)){for(B=N,J=k,K=U;ue=i.distcode[K+((h&(1<<B+J)-1)>>B)],N=ue>>>24,k=ue>>>16&255,U=65535&ue,!(B+N<=f);){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}h>>>=B,f-=B,i.back+=B}if(h>>>=N,f-=N,i.back+=N,64&k){e.msg="invalid distance code",i.mode=fn;break}i.offset=U,i.extra=15&k,i.mode=16203;case 16203:if(i.extra){for(pt=i.extra;f<pt;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}i.offset+=h&(1<<i.extra)-1,h>>>=i.extra,f-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=fn;break}i.mode=16204;case 16204:if(d===0)break e;if(y=S-d,i.offset>y){if(y=i.offset-y,y>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=fn;break}y>i.wnext?(y-=i.wnext,D=i.wsize-y):D=i.wnext-y,y>i.length&&(y=i.length),O=i.window}else O=r,D=c-i.offset,y=i.length;y>d&&(y=d),d-=y,i.length-=y;do r[c++]=O[D++];while(--y);i.length===0&&(i.mode=wR);break;case 16205:if(d===0)break e;r[c++]=i.length,d--,i.mode=wR;break;case ZI:if(i.wrap){for(;f<32;){if(l===0)break e;l--,h|=n[s++]<<f,f+=8}if(S-=d,e.total_out+=S,i.total+=S,4&i.wrap&&S&&(e.adler=i.check=or(i)?Er(i.check,r,S,c-S):h0(i.check,r,S,c-S)),S=d,4&i.wrap&&(or(i)?h:b3(h))!==i.check){e.msg="incorrect data check",i.mode=fn;break}h=0,f=0}i.mode=16207;case 16207:if(i.wrap&&or(i)){for(;f<32;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}if(4&i.wrap&&h!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=fn;break}h=0,f=0}i.mode=16208;case 16208:ee=KG;break e;case fn:ee=y3;break e;case 16210:return R3;default:return ks}return e.next_out=c,e.avail_out=d,e.next_in=s,e.avail_in=l,i.hold=h,i.bits=f,(i.wsize||S!==e.avail_out&&i.mode<fn&&(i.mode<ZI||t!==T3))&&D3(e,e.output,e.next_out,S-e.avail_out),E-=e.avail_in,S-=e.avail_out,e.total_in+=E,e.total_out+=S,i.total+=S,4&i.wrap&&S&&(e.adler=i.check=or(i)?Er(i.check,r,S,e.next_out-S):h0(i.check,r,S,e.next_out-S)),e.data_type=i.bits+(i.last?64:0)+(i.mode===yl?128:0)+(i.mode===AR||i.mode===JI?256:0),(E===0&&S===0||t===T3)&&ee===Xh&&(ee=qG),ee},Rl={inflateReset:w3,inflateReset2:I3,inflateResetKeep:A3,inflateInit:e=>O3(e,15),inflateInit2:O3,inflate:ZG,inflateEnd:e=>{if(Jh(e))return ks;let t=e.state;return t.window&&(t.window=null),e.state=null,Xh},inflateGetHeader:(e,t)=>{if(Jh(e))return ks;let i=e.state;return 2&i.wrap?(i.head=t,t.done=!1,Xh):ks},inflateSetDictionary:(e,t)=>{let i=t.length,n,r,s;return Jh(e)?ks:(n=e.state,n.wrap!==0&&n.mode!==bR?ks:n.mode===bR&&(r=1,r=h0(r,t,i,0),r!==n.check)?y3:(s=D3(e,t,i,i),s?(n.mode=16210,R3):(n.havedict=1,Xh)))},inflateInfo:"pako inflate (from Nodeca project)"},QG=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};let L3=Object.prototype.toString,{Z_NO_FLUSH:$G,Z_FINISH:eH,Z_OK:T0,Z_STREAM_END:e2,Z_NEED_DICT:t2,Z_STREAM_ERROR:tH,Z_DATA_ERROR:P3,Z_MEM_ERROR:iH}=mR;function IR(e){this.options=gR.assign({chunkSize:65536,windowBits:15,to:""},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new S3,this.strm.avail_out=0;let i=Rl.inflateInit2(this.strm,t.windowBits);if(i!==T0)throw new Error(zh[i]);if(this.header=new QG,Rl.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=S0.string2buf(t.dictionary):L3.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=Rl.inflateSetDictionary(this.strm,t.dictionary),i!==T0)))throw new Error(zh[i])}function nH(e,t){let i=new IR(t);if(i.push(e),i.err)throw i.msg||zh[i.err];return i.result}IR.prototype.push=function(e,t){let i=this.strm,n=this.options.chunkSize,r=this.options.dictionary,s,c,l;if(this.ended)return!1;for(c=t===~~t?t:t===!0?eH:$G,L3.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),s=Rl.inflate(i,c),s===t2&&r&&(s=Rl.inflateSetDictionary(i,r),s===T0?s=Rl.inflate(i,c):s===P3&&(s=t2));i.avail_in>0&&s===e2&&i.state.wrap>0&&e[i.next_in]!==0;)Rl.inflateReset(i),s=Rl.inflate(i,c);switch(s){case tH:case P3:case t2:case iH:return this.onEnd(s),this.ended=!0,!1}if(l=i.avail_out,i.next_out&&(i.avail_out===0||s===e2))if(this.options.to==="string"){let d=S0.utf8border(i.output,i.next_out),h=i.next_out-d,f=S0.buf2string(i.output,d);i.next_out=h,i.avail_out=n-h,h&&i.output.set(i.output.subarray(d,d+h),0),this.onData(f)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(s!==T0||l!==0){if(s===e2)return s=Rl.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},IR.prototype.onData=function(e){this.chunks.push(e)},IR.prototype.onEnd=function(e){e===T0&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=gR.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var rH={inflate:nH};let{deflate:aH}=jG,{inflate:sH}=rH;var oH=aH,cH=sH,x3=(function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e})(x3||{});class lH{constructor(){L(this,"_sequence",0),L(this,"_startTime",Date.now()),L(this,"isUseOneByte",!0)}get startTime(){let t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){let i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){let l=new Uint8Array(4);l.set([1,0,0,0]);let d={id:0,length:4,data:l.buffer},h={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[d]};i.commonPacketHeader.extension=1,i.extension=h,i.payload=this.compress(t),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;j("SHOW_DATASTREAM2_LOG")&&C.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));let n=new ArrayBuffer(i.commonPacketHeader.length),r=new Uint8Array(n),s=new DataView(n),c=0;if(s.setUint16(c,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),c+=2,s.setUint32(c,i.commonPacketHeader.sequence,!0),c+=4,s.setUint16(c,i.commonStreamHeader,!0),c+=2,i.extension){let l=this.serializeExtension(i.extension);r.set(new Uint8Array(l),c),c+=l.byteLength}if(r.set(new Uint8Array(i.payload),c),c+=i.payload.byteLength,c!==i.commonPacketHeader.length)throw Error("serialize error!");return n}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);let i=new DataView(t),n=0,r=i.getUint16(n,!0);n+=2;let s={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:i.getUint16(n+2,!0)<<16|i.getUint16(n,!0)},c,l;if(n+=4,j("SHOW_DATASTREAM2_LOG")&&C.debug("receive data header: ".concat(JSON.stringify(s))),i.getUint16(n,!0),n+=2,s.extension){l=this.deserializeExtension(t.slice(n)),n+=2+l.length,c=t.slice(n);let d=!1;if(l.datas.length>0){let h=l.datas.find(f=>f.id===0);h&&(d=(1&new DataView(h.data).getUint32(0,!0))==1)}c=d?this.decompress(c):c}else c=t.slice(8);return c}serializeExtension(t){let{profile:i,length:n,datas:r}=t,s=new ArrayBuffer(n+2),c=new Uint8Array(s),l=new DataView(s),d=0;if(l.setUint8(d++,i),l.setUint8(d++,n),r.forEach(h=>{i?(l.setUint8(d++,h.id),l.setUint8(d++,h.length),c.set(new Uint8Array(h.data),d),d+=h.data.byteLength):(l.setUint8(d++,h.id|h.length<<4),c.set(new Uint8Array(h.data),d),d+=h.data.byteLength)}),d!==n+2)throw Error("serialize extension error, is ".concat(d,"!==").concat(n+2));return s}deserializeExtension(t){let i=new DataView(t),n=0,r=i.getUint8(n);n++;let s=i.getUint8(n);n++;let c=r===x3.TWO_BYTE,l=[],d=new DataView(t,2),h=0;for(;h<s;){let f=0,E=0,S=new ArrayBuffer(0);c?(f=d.getUint8(h),h++,E=d.getUint8(h),h++):(f=15&d.getUint8(h),E=d.getUint8(h)>>4,h++),E>0&&(S=d.buffer.slice(h+2,h+2+E),h+=S.byteLength),l.push({id:f,length:E,data:S})}if(h!==s)throw Error("parse error");return{profile:r,length:s,datas:l}}decompress(t){return cH(new Uint8Array(t))}compress(t){return oH(new Uint8Array(t))}}let dH={name:"DataStream",create:(e,t)=>{let i=t?new EF(e):new gF(e);return i.useDataStream(new lH),i}};class uH extends vi{constructor(t,i,n){super(),L(this,"ws",void 0),L(this,"requestId",1),L(this,"heartBeatTimer",void 0),L(this,"joinInfo",void 0),L(this,"clientId",void 0),L(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),L(this,"onClose",r=>{this.emit("close"),this.dispose()}),L(this,"onMessage",r=>{let s=JSON.parse(r.data);if(!s||s.command!=="serverResponse"||!s.requestId)return s&&s.command==="serverStatus"&&s.serverStatus&&s.serverStatus.command?(this.emit("status",s.serverStatus),void this.emit(s.serverStatus.command,s.serverStatus)):void 0;this.emit("req_".concat(s.requestId),s)}),this.joinInfo=t,this.clientId=i,this.ws=new Yg("cross-channel-".concat(this.clientId),n),this.ws.on(ut.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(ut.CONNECTED,this.onOpen),this.ws.on(ut.ON_MESSAGE,this.onMessage),this.ws.on(ut.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){let i=this.requestId++;return t.requestId=i,t.seq=i,this.ws.sendMessage(t),i}waitStatus(t){return new Ie((i,n)=>{let r=window.setTimeout(()=>{n(new te(M.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,s=>{window.clearTimeout(r),s.state&&s.state!==0?n(new te(M.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(r),n(new te(M.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new te(M.WS_DISCONNECT);let i=()=>new Ie((c,l)=>{this.ws.once(ut.CLOSED,()=>l(new te(M.WS_ABORT))),this.ws.once(ut.CONNECTED,c)});this.ws.state!=="connected"&&await i();let n=this.sendMessage(t),r=new Ie((c,l)=>{let d=()=>{l(new te(M.WS_ABORT))};this.ws.once(ut.RECONNECTING,d),this.ws.once(ut.CLOSED,d),this.once("req_".concat(n),c),Sn(3e3).then(()=>{this.removeAllListeners("req_".concat(n)),this.ws.off(ut.RECONNECTING,d),this.ws.off(ut.CLOSED,d),l(new te(M.TIMEOUT,"cross channel ws request timeout"))})}),s=await r;if(!s||s.code!==200)throw new te(M.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(t){this.ws.removeAllListeners(ut.REQUEST_NEW_URLS),this.ws.on(ut.REQUEST_NEW_URLS,i=>{i(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){let i=this.requestId++;return t.requestId=i,this.ws.sendMessage(t),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class hH extends vi{set state(t){t!==this._state&&(t!==Gr.RELAY_STATE_FAILURE&&(this.errorCode=Rm.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,i,n,r,s){super(),L(this,"joinInfo",void 0),L(this,"sid",void 0),L(this,"clientId",void 0),L(this,"cancelToken",br.CancelToken.source()),L(this,"workerToken",void 0),L(this,"requestId",0),L(this,"signal",void 0),L(this,"prevChannelMediaConfig",void 0),L(this,"httpRetryConfig",void 0),L(this,"_resolution",void 0),L(this,"_state",Gr.RELAY_STATE_IDLE),L(this,"errorCode",Rm.RELAY_OK),L(this,"onStatus",c=>{C.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(c))),c&&c.command&&(c.command==="onAudioPacketReceived"&&this.emit("event",El.PACKET_RECEIVED_AUDIO_FROM_SRC),c.command==="onVideoPacketReceived"&&this.emit("event",El.PACKET_RECEIVED_VIDEO_FROM_SRC),c.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Rm.SRC_TOKEN_EXPIRED,this.state=Gr.RELAY_STATE_FAILURE),c.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Rm.DEST_TOKEN_EXPIRED,this.state=Gr.RELAY_STATE_FAILURE))}),L(this,"onReconnect",async()=>{C.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",El.NETWORK_DISCONNECTED),this.state=Gr.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(c=>{this.state!==Gr.RELAY_STATE_IDLE&&(C.error("auto restart channel media relay failed",c.toString()),this.errorCode=Rm.SERVER_CONNECTION_LOST,this.state=Gr.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=i,this.sid=Dh(),this.signal=new uH(this.joinInfo,this.clientId,n),this.httpRetryConfig=r,this._resolution=s}async startChannelMediaRelay(t){if(this.state!==Gr.RELAY_STATE_IDLE)throw new te(M.INVALID_OPERATION);this.state=Gr.RELAY_STATE_CONNECTING,await this.connect(),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new te(M.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new te(M.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new te(M.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Gr.RELAY_STATE_RUNNING)throw new te(M.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Gr.RELAY_STATE_RUNNING)throw new te(M.INVALID_OPERATION);let i=this.genMessage(_r.SetVideoProfile);await this.signal.request(i),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),C.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Gr.RELAY_STATE_IDLE,this.dispose()}dispose(){C.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=br.CancelToken.source(),this.state=Gr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let t=await R7(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",El.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){let i=this.genMessage(_r.StopPacketTransfer);await this.signal.request(i),await this.signal.waitStatus("Normal Quit"),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let n=this.genMessage(_r.SetSdkProfile,t);await this.signal.request(n),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let r=this.genMessage(_r.SetSourceChannel,t);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",El.PACKET_JOINED_SRC_CHANNEL),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let s=this.genMessage(_r.SetSourceUserId,t);await this.signal.request(s),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let c=this.genMessage(_r.SetDestChannel,t);await this.signal.request(c),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",El.PACKET_JOINED_DEST_CHANNEL),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let l=this.genMessage(_r.StartPacketTransfer,t);await this.signal.request(l),this.emit("event",El.PACKET_SENT_TO_DEST_CHANNEL),this.state=Gr.RELAY_STATE_RUNNING,C.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){let i=this.genMessage(_r.UpdateDestChannel,t);await this.signal.request(i),this.emit("event",El.PACKET_UPDATE_DEST_CHANNEL),C.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let t=this.genMessage(_r.StopPacketTransfer);await this.signal.request(t),C.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,i){let n=[],r=[],s=[];this.requestId+=1;let c={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Ya,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};c.sdkVersion==="4.24.0"&&(c.sdkVersion="0.0.1");let l=null,d=null;switch(t){case _r.SetSdkProfile:return c.clientRequest={command:"SetSdkProfile",type:"multi_channel"},c;case _r.SetSourceChannel:if(d=i&&i.getSrcChannelMediaInfo(),!d)throw new te(M.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceChannel",uid:"0",channelName:d.channelName,token:d.token||this.joinInfo.appId},c;case _r.SetSourceUserId:if(d=i&&i.getSrcChannelMediaInfo(),!d)throw new te(M.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceUserId",uid:d.uid+""},c;case _r.SetDestChannel:if(l=i&&i.getDestChannelMediaInfo(),!l)throw new te(M.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(h=>{n.push(h.channelName),r.push(h.uid+""),s.push(h.token||this.joinInfo.appId)}),c.clientRequest={command:"SetDestChannel",channelName:n,uid:r,token:s},c;case _r.StartPacketTransfer:return c.clientRequest={command:"StartPacketTransfer"},c;case _r.Reconnect:return c.clientRequest={command:"Reconnect"},c;case _r.StopPacketTransfer:return c.clientRequest={command:"StopPacketTransfer"},c;case _r.UpdateDestChannel:if(l=i&&i.getDestChannelMediaInfo(),!l)throw new te(M.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(h=>{n.push(h.channelName),r.push(h.uid+""),s.push(h.token||this.joinInfo.appId)}),c.clientRequest={command:"UpdateDestChannel",channelName:n,uid:r,token:s},c;case _r.SetVideoProfile:c.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return c}}let pH={name:"ChannelMediaRelay",create:function(e){return new hH(e.joinInfo,e.clientId,e.websocketRetryConfig||zi,e.httpRetryConfig||zi,e.resolution)}};function k3(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function y0(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?k3(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):k3(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}class fH extends vi{constructor(t,i,n,r){super(),L(this,"spec",void 0),L(this,"token",void 0),L(this,"websocket",void 0),L(this,"pingpongTimer",void 0),L(this,"reconnectMode","retry"),L(this,"serviceMode",void 0),L(this,"reqId",0),L(this,"commandReqId",0),L(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),L(this,"handleWebSocketMessage",s=>{if(!s.data)return;let c=JSON.parse(s.data);c.requestId?this.emit("@".concat(c.requestId,"-").concat(c.sid),c):(He.workerEvent(this.spec.sid,{actionType:"status",serverCode:c.code,workerType:this.serviceMode===_l.TRANSCODE?1:2}),this.emit(Gd.PUBLISH_STREAM_STATUS,c))}),this.spec=i,this.token=t,this.serviceMode=r,this.websocket=new Yg("live-streaming",n),this.websocket.on(ut.CONNECTED,this.handleWebSocketOpen),this.websocket.on(ut.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(ut.REQUEST_NEW_URLS,(s,c)=>{On(this,Gd.REQUEST_NEW_ADDRESS).then(s).catch(c)}),this.websocket.on(ut.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,i,n,r){this.reqId+=1,t==="request"&&(this.commandReqId+=1);let s=this.commandReqId,c=this.reqId;if(!c||!this.websocket)throw new te(M.UNEXPECTED_ERROR);let l=y0({command:t,sdkVersion:Ya==="4.24.0"?"0.0.1":Ya,seq:c,requestId:c,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new te(M.WS_DISCONNECT);let d=()=>new Ie((S,y)=>{this.websocket.once(ut.CLOSED,()=>y(new te(M.WS_ABORT))),this.websocket.once(ut.CONNECTED,S)});this.websocket.state!=="connected"&&await d(),l.clientRequest&&(l.clientRequest.workerToken=this.token);let h=new Ie((S,y)=>{let D=()=>{y(new te(M.WS_ABORT))};this.websocket.once(ut.RECONNECTING,D),this.websocket.once(ut.CLOSED,D),this.once("@".concat(c,"-").concat(this.spec.sid),O=>{S(O)})});r&&He.workerEvent(this.spec.sid,y0(y0({},r),{},{requestId:s,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));let f=Date.now();this.websocket.sendMessage(l);let E=null;try{E=await h}catch(S){if(this.websocket.state==="closed")throw S;return await d(),await this.request(t,i,n)}return r&&He.workerEvent(this.spec.sid,y0(y0({},r),{},{requestId:s,actionType:"response",payload:JSON.stringify(E.serverResponse),serverCode:E.code,success:E.code===200,responseTime:Date.now()-f})),E.code!==200&&this.handleResponseError(E),E}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let t=Ya==="4.24.0"?"0.0.1":Ya;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Zi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void C.warning("live stream response already exists stream");case Zi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Zi.LIVE_STREAM_RESPONSE_BAD_STREAM:case Zi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new te(M.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Zi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new te(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Zi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new te(M.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Zi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let i=new te(M.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Gd.WARNING,i,t.serverResponse.url)}case Zi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let i=new te(M.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Gd.WARNING,i,t.serverResponse.url)}case Zi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new te(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Zi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new te(M.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Zi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let i=new te(M.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Gd.WARNING,i,t.serverResponse.url)}case Zi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new te(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Zi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new te(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Zi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Zi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new te(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Zi.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new te(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new te(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Zi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Zi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Zi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Zi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new te(M.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(py)},6e3)}}function M3(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function Hr(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?M3(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):M3(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}class mH extends vi{constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:zi,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:zi;super(),L(this,"onLiveStreamWarning",void 0),L(this,"onLiveStreamError",void 0),L(this,"spec",void 0),L(this,"retryTimeout",1e4),L(this,"connection",void 0),L(this,"httpRetryConfig",void 0),L(this,"wsRetryConfig",void 0),L(this,"streamingTasks",new Map),L(this,"isStartingStreamingTask",!1),L(this,"taskMutex",new Vn("live-streaming")),L(this,"cancelToken",br.CancelToken.source()),L(this,"transcodingConfig",void 0),L(this,"uapResponse",void 0),L(this,"lastTaskId",1),L(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=n,this.wsRetryConfig=i}async setTranscodingConfig(t){let i=Hr(Hr({},t7),t);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(C.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(c=>Hr(Hr(Hr({},e7),c),{},{zOrder:c.zOrder?c.zOrder+1:1}))),(function(c){Ai(c.width)||Jt(c.width,"config.width",0,1e4),Ai(c.height)||Jt(c.height,"config.height",0,1e4),Ai(c.videoBitrate)||Jt(c.videoBitrate,"config.videoBitrate",1,1e6),Ai(c.videoFrameRate)||Jt(c.videoFrameRate,"config.videoFrameRate"),Ai(c.lowLatency)||co(c.lowLatency,"config.lowLatency"),Ai(c.audioSampleRate)||tn(c.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Ai(c.audioBitrate)||Jt(c.audioBitrate,"config.audioBitrate",1,128),Ai(c.audioChannels)||tn(c.audioChannels,"config.audioChannels",[1,2,3,4,5]),Ai(c.videoGop)||Jt(c.videoGop,"config.videoGop"),Ai(c.videoCodecProfile)||tn(c.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Ai(c.userCount)||Jt(c.userCount,"config.userCount",0,17),Ai(c.backgroundColor)||Jt(c.backgroundColor,"config.backgroundColor",0,16777215),Ai(c.userConfigExtraInfo)||gn(c.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),c.transcodingUsers&&!Ai(c.transcodingUsers)&&(ml(c.transcodingUsers,"config.transcodingUsers"),c.transcodingUsers.forEach((l,d)=>{Uy(l.uid),Ai(l.x)||Jt(l.x,"transcodingUser[".concat(d,"].x"),0,1e4),Ai(l.y)||Jt(l.y,"transcodingUser[".concat(d,"].y"),0,1e4),Ai(l.width)||Jt(l.width,"transcodingUser[".concat(d,"].width"),0,1e4),Ai(l.height)||Jt(l.height,"transcodingUser[".concat(d,"].height"),0,1e4),Ai(l.zOrder)||Jt(l.zOrder-1,"transcodingUser[".concat(d,"].zOrder"),0,100),Ai(l.alpha)||Jt(l.alpha,"transcodingUser[".concat(d,"].alpha"),0,1,!1)})),Ai(c.watermark)||eI(c.watermark,"watermark"),Ai(c.backgroundImage)||eI(c.backgroundImage,"backgroundImage"),c.images&&!Ai(c.images)&&(ml(c.images,"config.images"),c.images.forEach((l,d)=>{eI(l,"images[".concat(d,"]"))}))})(i);let n=[];i.images&&n.push(...i.images.map(c=>Hr(Hr(Hr({},$w),c),{},{zOrder:255}))),i.backgroundImage&&(n.push(Hr(Hr(Hr({},$w),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(n.push(Hr(Hr(Hr({},$w),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=n,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(c=>Hr({},c)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);let r=(i.userConfigs||[]).map(c=>typeof c.uid=="number"?Ie.resolve(c.uid):cM(c.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Ie.all(r)).forEach((c,l)=>{i.userConfigs&&i.userConfigs[l]&&(i.userConfigs[l].uid=c)}),this.transcodingConfig=i,this.connection)try{var s;let c=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Cr(s=this.streamingTasks).call(s)).map(l=>l.taskId).join("#")});C.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(c.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(c){if(!c.data||!c.data.retry)throw c;c.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(l=>{C.warning("[".concat(this.spec.clientId,"] live streaming receive error"),c.toString(),"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,c).then(()=>{C.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(l.url," success"))}).catch(d=>{C.error("[".concat(this.spec.clientId,"] live streaming republish failed"),l.url,d.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,d)})})}}async startLiveStreamingTask(t,i,n){if(!this.transcodingConfig&&i===_l.TRANSCODE)throw new te(M.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let r={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};C.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(i));let s=await this.taskMutex.lock();if(!this.connection&&n)return void s();if(this.streamingTasks.get(t)&&!n)return s(),new te(M.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(l){throw s(),l}switch(i){case _l.TRANSCODE:r.transcodingConfig=Hr({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let c=this.lastTaskId++;try{let l=new Ie((h,f)=>{Sn(this.retryTimeout).then(()=>{if(n)return f(n);let E=this.statusError.get(t);return E?(this.statusError.delete(t),f(E)):void 0})}),d=await Ie.race([this.connection.request("request",{clientRequest:r},!0,{url:t,command:"PublishStream",workerType:i===_l.TRANSCODE?1:2,requestByUser:!n,tid:c.toString()}),l]);this.isStartingStreamingTask=!1,C.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(d.code)),this.streamingTasks.set(t,{clientRequest:r,mode:i,url:t,taskId:c}),s()}catch(l){if(s(),this.isStartingStreamingTask=!1,!l.data||!l.data.retry||n)throw l;return l.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,i,l)):await this.startLiveStreamingTask(t,i,l)}}stopLiveStreamingTask(t){return new Ie((i,n)=>{let r=this.streamingTasks.get(t);if(!r||!this.connection)return new te(M.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let s=r.mode;r.abortTask=()=>{C.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),i()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:t,command:"UnPublishStream",workerType:s===_l.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(c=>{C.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(c.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),i()}).catch(n)})}resetAllTask(){var t;let i=Array.from(Cr(t=this.streamingTasks).call(t));this.terminate();for(let n of i)this.startLiveStreamingTask(n.url,n.mode).catch(r=>{this.onLiveStreamError&&this.onLiveStreamError(n.url,r)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=br.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new te(M.UNEXPECTED_ERROR,"live streaming connection has already connected");let i=await On(this,tI.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=i,this.connection=new fH(i.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Gd.WARNING,(n,r)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(r,n)),this.connection.on(Gd.PUBLISH_STREAM_STATUS,n=>this.handlePublishStreamServer(n)),this.connection.on(Gd.REQUEST_NEW_ADDRESS,(n,r)=>{if(!this.connection)return r(new te(M.UNEXPECTED_ERROR,"can not get new live streaming address list"));On(this,tI.REQUEST_WORKER_MANAGER_LIST,t).then(s=>{this.uapResponse=s,n(s.addressList)}).catch(r)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(t){let i=t.serverStatus&&t.serverStatus.url||"empty_url",n=this.streamingTasks.get(i),r=t.reason;switch(t.code){case Zi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Zi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Zi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Zi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let c=new te(M.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(n)return C.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,c);if(!this.isStartingStreamingTask)return;this.statusError.set(i,c)}case Zi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let c=new te(M.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,c)}case Zi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Zi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();let c=Array.from(Cr(s=this.streamingTasks).call(s));for(let l of c)l.abortTask?l.abortTask():(C.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,new te(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{C.debug("[".concat(this.spec.clientId,"] republish live stream success"),l.url)}).catch(d=>{C.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,d)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}let _H={name:"LiveStreaming",create:function(e){return new mH(e.joinInfo,e.websocketRetryConfig||zi,e.httpRetryConfig||zi)}};function EH(e){let t=j3();return(function(i,n){let r=i.appId;r!==void 0&&(zt(n,10),Sc(n,r));let s=i.cid;s!==void 0&&(zt(n,16),zt(n,s));let c=i.cname;c!==void 0&&(zt(n,26),Sc(n,c));let l=i.deviceId;l!==void 0&&(zt(n,34),Sc(n,l));let d=i.elapse;d!==void 0&&(zt(n,40),ru(n,d));let h=i.fileSize;h!==void 0&&(zt(n,48),ru(n,Bm(h)));let f=i.height;f!==void 0&&(zt(n,56),ru(n,Bm(f)));let E=i.jpg;E!==void 0&&(zt(n,66),zt(n,E.length),(function(Hn,pe){let Ae=Fm(Hn,pe.length);Hn.bytes.set(pe,Ae)})(n,E));let S=i.networkType;S!==void 0&&(zt(n,72),ru(n,Bm(S)));let y=i.osType;y!==void 0&&(zt(n,80),ru(n,Bm(y)));let D=i.requestId;D!==void 0&&(zt(n,90),Sc(n,D));let O=i.sdkVersion;O!==void 0&&(zt(n,98),Sc(n,O));let N=i.sequence;N!==void 0&&(zt(n,104),ru(n,Bm(N)));let k=i.sid;k!==void 0&&(zt(n,114),Sc(n,k));let U=i.timestamp;U!==void 0&&(zt(n,120),ru(n,U));let B=i.uid;B!==void 0&&(zt(n,128),zt(n,B));let J=i.vid;J!==void 0&&(zt(n,136),zt(n,J));let K=i.width;K!==void 0&&(zt(n,144),ru(n,Bm(K)));let H=i.service;H!==void 0&&(zt(n,152),zt(n,H));let ee=i.callbackData;ee!==void 0&&(zt(n,162),Sc(n,ee));let ue=i.jpgEncryption;ue!==void 0&&(zt(n,168),zt(n,ue));let me=i.requestType;me!==void 0&&(zt(n,176),zt(n,me));let ye=i.scorePorn;ye!==void 0&&(zt(n,185),s2(n,ye));let pt=i.scoreSexy;pt!==void 0&&(zt(n,193),s2(n,pt));let mt=i.scoreNeutral;mt!==void 0&&(zt(n,201),s2(n,mt));let nt=i.scene;nt!==void 0&&(zt(n,208),zt(n,nt));let jt=i.ossFilePrefix;jt!==void 0&&(zt(n,218),Sc(n,jt));let Mt=i.serviceVendor;if(Mt!==void 0)for(let Hn of Mt){zt(n,226);let pe=j3();vH(Hn,pe),zt(n,pe.limit),CH(n,pe),RH(pe)}})(e,t),(function(i){let n=i.bytes,r=i.limit;return n.length===r?n:n.subarray(0,r)})(t)}function gH(e){return(function(i){let n={};e:for(;!B3(i);){let r=vc(i);switch(r>>>3){case 0:break e;case 1:n.code=vc(i);break;case 2:n.msg=F3(i,vc(i));break;case 3:{let s=TH(i);n.data=SH(i),i.limit=s;break}default:U3(i,7&r)}}return n})({bytes:t=e,offset:0,limit:t.length});var t}function SH(e){let t={};e:for(;!B3(e);){let i=vc(e);switch(i>>>3){case 0:break e;case 1:t.requestId=F3(e,vc(e));break;case 2:t.requestType=vc(e)>>>0;break;case 3:t.scorePorn=a2(e);break;case 4:t.scoreSexy=a2(e);break;case 5:t.scoreNeutral=a2(e);break;case 6:t.requestScene=vc(e)>>>0;break;case 7:t.scene=vc(e)>>>0;break;default:U3(e,7&i)}}return t}function vH(e,t){let i=e.service;i!==void 0&&(zt(t,8),zt(t,i));let n=e.vendor;n!==void 0&&(zt(t,16),zt(t,n));let r=e.token;r!==void 0&&(zt(t,26),Sc(t,r));let s=e.callbackUrl;s!==void 0&&(zt(t,34),Sc(t,s))}function TH(e){let t=vc(e),i=e.limit;return e.limit=e.offset+t,i}function U3(e,t){switch(t){case 0:for(;128&G3(e););break;case 2:n2(e,vc(e));break;case 5:n2(e,4);break;case 1:n2(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let yH=new Float32Array(1);new Uint8Array(yH.buffer);let i2=new Float64Array(1),Wr=new Uint8Array(i2.buffer);function Bm(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let V3=[];function j3(){let e=V3.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function RH(e){V3.push(e)}function n2(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function B3(e){return e.offset>=e.limit}function Fm(e,t){let i=e.bytes,n=e.offset,r=e.limit,s=n+t;if(s>i.length){let c=new Uint8Array(2*s);c.set(i),e.bytes=c}return e.offset=s,s>r&&(e.limit=s),n}function r2(e,t){let i=e.offset;if(i+t>e.limit)throw new Error("Read past limit");return e.offset+=t,i}function F3(e,t){let i=r2(e,t),n=String.fromCharCode,r=e.bytes,s="",c="";for(let l=0;l<t;l++){let d,h,f,E,S=r[l+i];128&S?(224&S)==192?l+1>=t?c+=s:(d=r[l+i+1],(192&d)!=128?c+=s:(E=(31&S)<<6|63&d,E<128?c+=s:(c+=n(E),l++))):(240&S)==224?l+2>=t?c+=s:(d=r[l+i+1],h=r[l+i+2],(49344&(d|h<<8))!=32896?c+=s:(E=(15&S)<<12|(63&d)<<6|63&h,E<2048||E>=55296&&E<=57343?c+=s:(c+=n(E),l+=2))):(248&S)==240?l+3>=t?c+=s:(d=r[l+i+1],h=r[l+i+2],f=r[l+i+3],(12632256&(d|h<<8|f<<16))!=8421504?c+=s:(E=(7&S)<<18|(63&d)<<12|(63&h)<<6|63&f,E<65536||E>1114111?c+=s:(E-=65536,c+=n(55296+(E>>10),56320+(1023&E)),l+=3))):c+=s:c+=n(S)}return c}function Sc(e,t){let i=t.length,n=0;for(let c=0;c<i;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<i&&(l=(l<<10)+t.charCodeAt(++c)-56613888),n+=l<128?1:l<2048?2:l<65536?3:4}zt(e,n);let r=Fm(e,n),s=e.bytes;for(let c=0;c<i;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<i&&(l=(l<<10)+t.charCodeAt(++c)-56613888),l<128?s[r++]=l:(l<2048?s[r++]=l>>6&31|192:(l<65536?s[r++]=l>>12&15|224:(s[r++]=l>>18&7|240,s[r++]=l>>12&63|128),s[r++]=l>>6&63|128),s[r++]=63&l|128)}}function CH(e,t){let i=Fm(e,t.limit),n=e.bytes,r=t.bytes;for(let s=0,c=t.limit;s<c;s++)n[s+i]=r[s]}function G3(e){return e.bytes[r2(e,1)]}function H3(e,t){let i=Fm(e,1);e.bytes[i]=t}function a2(e){let t=r2(e,8),i=e.bytes;return Wr[0]=i[t++],Wr[1]=i[t++],Wr[2]=i[t++],Wr[3]=i[t++],Wr[4]=i[t++],Wr[5]=i[t++],Wr[6]=i[t++],Wr[7]=i[t++],i2[0]}function s2(e,t){let i=Fm(e,8),n=e.bytes;i2[0]=t,n[i++]=Wr[0],n[i++]=Wr[1],n[i++]=Wr[2],n[i++]=Wr[3],n[i++]=Wr[4],n[i++]=Wr[5],n[i++]=Wr[6],n[i++]=Wr[7]}function vc(e){let t,i=0,n=0;do t=G3(e),i<32&&(n|=(127&t)<<i),i+=7;while(128&t);return n}function zt(e,t){for(t>>>=0;t>=128;)H3(e,127&t|128),t>>>=7;H3(e,t)}function ru(e,t){let i=t.low>>>0,n=(t.low>>>28|t.high<<4)>>>0,r=t.high>>>24,s=r===0?n===0?i<16384?i<128?1:2:i<1<<21?3:4:n<16384?n<128?5:6:n<1<<21?7:8:r<128?9:10,c=Fm(e,s),l=e.bytes;switch(s){case 10:l[c+9]=r>>>7&1;case 9:l[c+8]=s!==9?128|r:127&r;case 8:l[c+7]=s!==8?n>>>21|128:n>>>21&127;case 7:l[c+6]=s!==7?n>>>14|128:n>>>14&127;case 6:l[c+5]=s!==6?n>>>7|128:n>>>7&127;case 5:l[c+4]=s!==5?128|n:127&n;case 4:l[c+3]=s!==4?i>>>21|128:i>>>21&127;case 3:l[c+2]=s!==3?i>>>14|128:i>>>14&127;case 2:l[c+1]=s!==2?i>>>7|128:i>>>7&127;case 1:l[c]=s!==1?128|i:127&i}}function W3(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}let bH=new Map([["moderation",1],["supervise",2]]);class AH extends vi{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let i=this._connectionState;this._connectionState=t,this.emit(pn.CONNECTION_STATE_CHANGE,i,t)}get inspectType(){return this._inspectType}set inspectType(t){var i;this._inspectMode=xr(i=t.map(n=>bH.get(n)||0)).call(i,(n,r)=>n+r),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),L(this,"name","AgoraRTCVideoContentInspect"),L(this,"_connectionState",Os.CONNECTING),L(this,"_innerConnectionState",void 0),L(this,"sequence",0),L(this,"inspectStartTime",void 0),L(this,"workerManagerConnection",void 0),L(this,"workerConnection",void 0),L(this,"workerMessageLengthLimit",void 0),L(this,"inspectIntervalMinimum",void 0),L(this,"qualityRatio",void 0),L(this,"_connectInfo",void 0),L(this,"_cancelTokenSource",br.CancelToken.source()),L(this,"_retryConfig",void 0),L(this,"wmSequence",0),L(this,"inspectInterval",void 0),L(this,"inspectTimer",null),L(this,"ossFilePrefix",void 0),L(this,"extraInfo",void 0),L(this,"_inspectType",void 0),L(this,"_inspectMode",void 0),L(this,"_quality",1),L(this,"qualityTimer",null),L(this,"_inspectId",void 0),L(this,"_needWorkUrlOnly",!1),L(this,"inspectImage",()=>{if(this.connectionState!==Os.CONNECTED)throw new te(M.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Os.CONNECTED?this.requestToInspectImage():C.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=ei(5,"inspect-"),this.workerMessageLengthLimit=j("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=j("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=j("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Yg("worker-manager-"+this._inspectId,zi),this.on(pn.STATE_CHANGE,(i,n)=>{this._innerConnectionState=i,C.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Ns[i]," ").concat(n||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Yg("worker-"+this._inspectId,zi),this.handleWorkerEvents()}async init(t,i){this.emit(pn.STATE_CHANGE,Ns.CONNECT_AP),this._connectInfo=t;let n=this._cancelTokenSource.token;return this._retryConfig=i,new Ie((r,s)=>{this.on(pn.CONNECTION_STATE_CHANGE,(c,l)=>{l===Os.CONNECTED&&r()}),this.requestAP(t,n,i).then(c=>{this.connectWorkerManager(c)}).catch(c=>{s(c)})})}async requestAP(t,i,n){let r=j("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),s=await(function(l,d,h,f){let{appId:E,areaCode:S,cname:y,sid:D,token:O,uid:N}=d;Nm++;let k="image_moderation_api",U={service_name:k,json_body:JSON.stringify({appId:E,areaCode:S,cname:y,command:"allocateEdge",requestId:Nm,seq:Nm,sid:D,token:O,ts:Date.now(),uid:N+""})},B,J,K=l[0];return lo(async()=>{B=Date.now();let H=await mo(K,{data:U,cancelToken:h,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(J=Date.now()-B,H.code!==0){let ye=new te(M.UNEXPECTED_RESPONSE,"image inspect ap error, code"+H.code,{retry:!0,responseTime:J});throw C.error(ye.toString()),ye}let ee=JSON.parse(H.json_body);if(ee.code!==200){let ye=new te(M.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ee.code,", reason: ").concat(ee.reason),{code:ee.code,responseTime:J});throw C.error(ye.toString()),ye}if(!ee.servers||!Array.isArray(ee.servers)||ee.servers.length===0){let ye=new te(M.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ee.code,responseTime:J});throw C.error(ye.toString()),ye}let ue=j("VIDEO_INSPECT_WORKER_MANAGER_HOST"),me=j("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ee.servers.map(ye=>{let{address:pt,wss:mt}=ye;if(pt&&mt)return"wss://".concat(pt.replace(/\./g,"-"),".").concat(ue,":").concat(me||mt)}).filter(ye=>!!ye),workerToken:ee.workerToken,vid:ee.vid,responseTime:J}},(H,ee)=>(He.apworkerEvent(D,{success:!0,sc:200,serviceName:k,responseDetail:JSON.stringify(H.addressList),firstSuccess:ee===0,responseTime:J,serverIp:l[ee%l.length]}),!1),(H,ee)=>(He.apworkerEvent(D,{success:!1,sc:H.data&&H.data.code||200,serviceName:k,responseTime:J,serverIp:l[ee%l.length]}),!!(H.code!==M.OPERATION_ABORTED&&H.code!==M.UNEXPECTED_RESPONSE||H.data&&H.data.retry)&&(K=l[(ee+1)%l.length],!0)),f)})(r,t,i,n);this.emit(pn.STATE_CHANGE,Ns.AP_CONNECTED);let{addressList:c}=s;return this.wmSequence++,c}async connectWorkerManager(t){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(pn.STATE_CHANGE,Ns.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(ut.CONNECTED,async()=>{this.emit(pn.STATE_CHANGE,Ns.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(ut.CLOSED,()=>{this._innerConnectionState<Ns.GET_WORKER_MANAGER_RESPONSE&&C.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(ut.FAILED,()=>{this._innerConnectionState<Ns.GET_WORKER_MANAGER_RESPONSE&&C.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(ut.RECONNECTING,()=>{this._innerConnectionState<Ns.GET_WORKER_MANAGER_RESPONSE&&C.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(ut.ON_MESSAGE,async t=>{this.emit(pn.STATE_CHANGE,Ns.GET_WORKER_MANAGER_RESPONSE);let i=this.workerManagerConnection.url;this.workerManagerConnection.close();let n=JSON.parse(t.data);if(n.code!==200)throw C.error("[".concat(this._inspectId,"] Unexpected code ").concat(n.code," from worker manager")),new te(M.UNEXPECTED_RESPONSE,"response code of worker is unexpected",n);if(!(n.serverResponse&&n.serverResponse.portWss&&i))throw C.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(n))),new te(M.UNEXPECTED_RESPONSE,"response content of worker is unexpected",n);{let r=j("VIDEO_INSPECT_WORKER_PORT")||n.serverResponse.portWss,s=i.replace(/:\d+\/?$/,":".concat(r));this.emit(pn.STATE_CHANGE,Ns.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit(pn.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}}),this.workerManagerConnection.on(ut.WILL_RECONNECT,(t,i,n)=>{n(t)}),this.workerManagerConnection.on(ut.REQUEST_NEW_URLS,(t,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(i)})}handleWorkerEvents(){this.workerConnection.on(ut.CONNECTED,async()=>{this.emit(pn.STATE_CHANGE,Ns.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Os.CONNECTED}),this.workerConnection.on(ut.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let n=gH(new Uint8Array(t.data));if(j("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&C.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(n)),n.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(pn.INSPECT_RESULT,void 0,void 0);if(n.data&&n.data.scorePorn&&n.data.scoreSexy&&n.data.scoreNeutral){var i;let r={porn:n.data.scorePorn,sexy:n.data.scoreSexy,neutral:n.data.scoreNeutral},s=xr(i=Object.keys(r)).call(i,(l,d)=>r[l]>r[d]?l:d,"porn"),c=Object.keys(r).find(l=>l===s);this.emit(pn.INSPECT_RESULT,c)}else this.emit(pn.INSPECT_RESULT,void 0,new te(M.UNEXPECTED_RESPONSE,n.code+"","There is an unexpected data on message"))}else this.emit(pn.INSPECT_RESULT,void 0,new te(M.UNEXPECTED_RESPONSE,n.code+"",n.msg))}else C.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(pn.INSPECT_RESULT,void 0,new te(M.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(ut.CLOSED,()=>{this.connectionState=Os.CLOSED}),this.workerConnection.on(ut.FAILED,()=>{this.connectionState=Os.CLOSED}),this.workerConnection.on(ut.RECONNECTING,()=>{this.connectionState=this.connectionState===Os.CONNECTED?Os.RECONNECTING:Os.CONNECTING}),this.workerConnection.on(ut.WILL_RECONNECT,(t,i,n)=>{t==="recover"&&n(t),n("tryNext")}),this.workerConnection.on(ut.REQUEST_NEW_URLS,(t,i)=>{this.workerManagerConnection.close(),this.once(pn.REQUEST_NEW_WORKER_URL,n=>{t([n])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(n=>{this.connectWorkerManager(n,!0)}).catch(n=>{i(n)})})}async requestToInspectImage(){this.sequence++;let t=va(this,pn.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(pn.INSPECT_RESULT,void 0,new te(M.INVALID_OPERATION,"Only the track being played can be inspected"));let n=await this.generateRequestData(t,i);this.workerConnection.sendMessage(n,!0,!0)}else this.emit(pn.INSPECT_RESULT,void 0,new te(M.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,i){let{appId:n,cname:r,cid:s,vid:c,sid:l,uid:d}=i,h=Date.now(),f=await t.getCurrentFrameImage("image/jpeg",this.quality),E=await bP(f,n,r),S=this.sequence+"-"+s+"-"+d+"-"+h+"-"+ei(12,""),y={appId:n,cid:s,cname:r,deviceId:"",elapse:(D=Number(h-this.inspectStartTime),{low:D|=0,high:D>>31,unsigned:D>=0}),fileSize:E.byteLength,jpgEncryption:2,height:f.height,width:f.width,jpg:E,networkType:6,osType:7,requestId:S,sdkVersion:"4.24.0",sequence:this.sequence,sid:l,timestamp:QM(h),uid:d,vid:c,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var D;this.extraInfo===void 0&&delete y.callbackData,this.ossFilePrefix===void 0&&delete y.ossFilePrefix;let O=EH(y);if(O.byteLength<this.workerMessageLengthLimit){if(j("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let N=(function(k){for(var U=1;U<arguments.length;U++){var B=arguments[U]!=null?arguments[U]:{};U%2?W3(Object(B),!0).forEach(function(J){L(k,J,B[J])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(B)):W3(Object(B)).forEach(function(J){Object.defineProperty(k,J,Object.getOwnPropertyDescriptor(B,J))})}return k})({},y);delete N.jpg,C.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(N))}return O}{let N=this.quality*this.qualityRatio;return this.quality=N,await this.generateRequestData(t,{appId:n,cname:r,cid:s,vid:c,sid:l,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=br.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Os.CLOSED,this.emit(pn.STATE_CHANGE,Ns.CLOSED)}}let wH={name:"ContentInspect",create:function(e){let{config:t}=e;return(function(i){if(!i)throw new te(M.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new te(M.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{let n=[...new Set(i.inspectType)];n.forEach(r=>{var s;if(!Ce(s=["supervise","moderation"]).call(s,r))throw new te(M.INVALID_PARAMS,"".concat(r," is not a valid inspect type."))}),i.inspectType=n}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new te(M.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")})(t),new AH(t)}};var z3=R(Dr.Object.getOwnPropertySymbols),IH=Ft,OH=xc.indexOf,NH=kc,o2=qe([].indexOf),K3=!!o2&&1/o2([1],1,-0)<0;IH({target:"Array",proto:!0,forced:K3||!NH("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return K3?o2(this,e,t)||0:OH(this,e,t)}});var DH=Xr("Array","indexOf"),LH=ce,PH=DH,c2=Array.prototype,xH=function(e){var t=e.indexOf;return e===c2||LH(c2,e)&&t===c2.indexOf?PH:t},Y3=R(xH);function kH(e,t){if(e==null)return{};var i,n,r=(function(c,l){if(c==null)return{};var d={};for(var h in c)if({}.hasOwnProperty.call(c,h)){if(Y3(l).call(l,h)!==-1)continue;d[h]=c[h]}return d})(e,t);if(z3){var s=z3(e);for(n=0;n<s.length;n++)i=s[n],Y3(t).call(t,i)===-1&&{}.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}let q3=class{get localCapabilities(){return Ei(this._localCapabilities)}get rtpCapabilities(){return Ei(this._rtpCapabilities)}get candidates(){return Ei(this._candidates)}get iceParameters(){return Ei(this._iceParameters)}get dtlsParameters(){return Ei(this._dtlsParameters)}constructor(e){L(this,"sessionDesc",void 0),L(this,"_localCapabilities",void 0),L(this,"_rtpCapabilities",void 0),L(this,"_candidates",void 0),L(this,"_iceParameters",void 0),L(this,"_dtlsParameters",void 0),L(this,"setup",void 0),L(this,"currentMidIndex",void 0),L(this,"cname","o/i14u9pJrxRKAsu"),L(this,"firefoxSsrcMidMap",new Map),e=Ei(e);let{remoteIceParameters:t,remoteDtlsParameters:i,candidates:n,remoteRTPCapabilities:r,localCapabilities:s,direction:c,setup:l,videoCodec:d,audioCodec:h}=e,f;this.setup=l,f=c===mr.RECEIVE_ONLY?Br(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Br(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=r,this._candidates=n,this._iceParameters=t,this._dtlsParameters=i,this._localCapabilities=s;let E=c===mr.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,S=c===mr.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,y=c===mr.RECEIVE_ONLY?r.send.videoCodecs:Zg(ke.VIDEO,E,S,d),D=c===mr.RECEIVE_ONLY?r.send.audioCodecs:Zg(ke.AUDIO,E,S,h);for(let O of f.mediaDescriptions)O.attributes.iceUfrag=t.iceUfrag,O.attributes.icePwd=t.icePwd,O.attributes.fingerprints=i.fingerprints,O.attributes.candidates=n,O.attributes.setup=this.setup,O.media.mediaType==="application"&&(O.attributes.sctpPort="5000"),O.media.mediaType==="video"&&(O.media.fmts=y.map(N=>N.payloadType.toString(10)),O.attributes.payloads=y,O.attributes.extmaps=E.videoExtensions),O.media.mediaType==="audio"&&(O.media.fmts=D.map(N=>N.payloadType.toString(10)),O.attributes.payloads=D,O.attributes.extmaps=E.audioExtensions,Om(O));this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}toString(){return Bd(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,i,n,r){i=i.replace(/ /g,"-");let{ssrcs:s,ssrcGroups:c}=Jg(t,this.cname,j("SYNC_GROUP")?i:void 0),l=this.findPreloadMediaDesc(s);if(l){if(bi()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,l.attributes.mid),r&&(r.twcc||r.remb)){let d=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(l,r),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{let d=this.findAvailableMediaIndex(e,s,n),h;return d===-1?(h=this.createOrRecycleSendMedia(e,s,c,"sendonly",n,r),this.updateBundleMids()):(h=Ei(this.sessionDesc.mediaDescriptions[d]),h.attributes.direction="sendonly",h.attributes.ssrcs=s,h.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(h,r)),bi()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,h.attributes.mid),{needExchangeSDP:!0,mid:h.attributes.mid}}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,i){let n=[];return e.forEach(r=>{let s=r._mediaStreamTrack.kind,c=this.findAvailableRecvMediaIndex(s),l,d=!1;c===-1?(d=!0,l=this.createOrRecycleRecvMedia(r,[],"recvonly",t,i),this.updateBundleMids()):(l=Ei(this.sessionDesc.mediaDescriptions[c]),l.attributes.direction="recvonly"),n.push({mid:l.attributes.mid,needCreateTransceiver:d})}),n}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:t,protocol:i,address:n,port:r,type:s,relatedAddress:c,relatedPort:l,priority:d}=new RTCIceCandidate(e),h={foundation:t??"",componentId:"1",transport:i??"",priority:d?d+"":"",connectionAddress:n??"",port:r?r+"":"",type:s?s+"":"",relAddr:c??"",relPort:l?l+"":"",extension:{}};this.candidates.some(f=>f.priority===h.priority&&f.connectionAddress===h.connectionAddress&&f.port===h.port)||(this._candidates.push(h),this.sessionDesc.mediaDescriptions.forEach(f=>{f.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,i,n,r){let s=e._mediaStreamTrack.kind,c=this.rtpCapabilities.recv,l=Zg(s,c,this.localCapabilities.send,s===ke.AUDIO?r:n),d=s===ke.VIDEO?c.videoExtensions:c.audioExtensions,h="".concat(++this.currentMidIndex),f={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(h)}};f=this.mungRecvMediaDsec(f,e);let E=this.findFirstClosedMedia(s);if(E){let S=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[S]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>Ce(e).call(e,i.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>Ce(e).call(e,i.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,i){return this.sessionDesc.mediaDescriptions.findIndex(n=>{let r=n.media.mediaType===e&&n.media.port!=="0"&&(n.attributes.direction==="sendonly"||n.attributes.direction==="sendrecv")&&n.attributes.ssrcs.length===0;if(bi()){if(r){let s=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(s||n.attributes.mid!=="0"&&n.attributes.mid!=="1")||!(!s||s!==n.attributes.mid)}return!1}return r&&n.attributes.mid===i})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{let i=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&i})}predictReceivingMids(e){let t=[];for(let i=0;i<e;i++)t.push((this.currentMidIndex+i+1).toString(10));return t}restartICE(e){e=Ei(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,i,n,r,s){let c=this.rtpCapabilities.send,l=e===ke.VIDEO?c.videoCodecs:c.audioCodecs,d=e===ke.VIDEO?c.videoExtensions:c.audioExtensions;bi()&&(r="".concat(++this.currentMidIndex));let h={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:r}};h=this.mungSendMediaDesc(h,s);let f=this.findFirstClosedMedia(e);if(f){let E=this.sessionDesc.mediaDescriptions.indexOf(f);this.sessionDesc.mediaDescriptions[E]=h}else this.sessionDesc.mediaDescriptions.push(h);return h}mungRecvMediaDsec(e,t,i){let n=Ei(e);return oI(n),Im(n,t),cI(n,t),Gk(n),zy(n,i,this.localCapabilities.send),n}mungSendMediaDesc(e,t){let i=Ei(e);return zy(i,t,this.localCapabilities.recv),Om(i),i}updateRecvMedia(e,t){let i=this.sessionDesc.mediaDescriptions.findIndex(n=>n.attributes.mid===e);if(i!==-1){let n=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],t);this.sessionDesc.mediaDescriptions[i]=n}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var i;return((i=t.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>bi()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}},MH=["sdp"];var ci;function X3(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function au(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?X3(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):X3(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}let J3=(ci=class Hm extends Ck{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,i;return(t=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,i,n){super(t,i),L(this,"direction",void 0),L(this,"name",void 0),L(this,"store",void 0),L(this,"spec",void 0),L(this,"peerConnection",void 0),L(this,"initialOffer",void 0),L(this,"transport",void 0),L(this,"statsFilter",void 0),L(this,"localCandidateCount",0),L(this,"_isInRestartIce",!1),L(this,"mutex",void 0),L(this,"onLocalCandidate",void 0),L(this,"remoteSDP",void 0),L(this,"pendingCandidates",[]),L(this,"localCapabilities",void 0),L(this,"isReady",!1),L(this,"restartCnt",0),L(this,"curTurnServerIndex",0),this.store=i,this.spec=t,this.mutex=new Vn("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(Hm.resolvePCConfiguration(t,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=n??mr.SEND_ONLY,this.name=this.direction===mr.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=_w(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,bi()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{let i=await Wk();if(this.localCapabilities=Ky(i),t){let{sdp:n}=t,r=kH(t,MH),s=(function(){let f={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},E=Xg(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ds(E,f,"videoExtensions",S,y,D),Ds(E,f,"videoCodecs",S,y,D),Ds(E,f,"audioExtensions",S,y,D),Ds(E,f,"audioCodecs",S,y,D),j("RAISE_H264_BASELINE_PRIORITY")){let O=D.videoCodecs.findIndex(N=>N.rtpMap&&N.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&N.fmtp&&N.fmtp.parameters["profile-level-id"]==="42001f");if(O!==-1){let N=D.videoCodecs.findIndex(k=>k.rtpMap&&k.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(N<O){C.debug("raising H264 baseline profile priority");let k=D.videoCodecs[O];D.videoCodecs.splice(O,1),D.videoCodecs.splice(N,0,k)}N!==-1&&j("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(k=>!(k.rtpMap&&k.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&k.fmtp&&k.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:S,recv:y,sendrecv:D}})({},{},n);this.remoteSDP=new q3({remoteIceParameters:r.iceParameters,remoteDtlsParameters:r.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let c=await this.peerConnection.createAnswer();if(!c.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let l=Kd(c.sdp);await this.peerConnection.setLocalDescription(c);let d=await zk({},{},c.sdp);this.localCapabilities=Ky(d);let h=this.peerConnection.getTransceivers()[0];return h!=null&&h.receiver&&h.receiver.transport&&this.tryBindTransportEvents(h.receiver.transport),au(au({},l),{},{sdp:c.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let r=Kd(n.sdp);return this.initialOffer=n,au(au({},r),{},{sdp:n.sdp})}}catch(i){throw new de(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:i,iceParameters:n,dtlsParameters:r}=t,s=await zk({},{},i);this.remoteSDP=new q3({remoteIceParameters:n,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let c=this.peerConnection.getTransceivers()[0];c!=null&&c.sender&&c.sender.transport&&this.tryBindTransportEvents(c.sender.transport)}catch(i){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new de(M.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(t,i,n){var r=this;return Ka(function*(){let s=yield Dt(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let c=[],l=r.remoteSDP.receive(t,i,n);t.forEach((N,k)=>{if(l[k].needCreateTransceiver){let U=r.peerConnection.addTransceiver(N._mediaStreamTrack,{direction:"sendonly"});c.push(U),N._updateRtpTransceiver(U)}else{let U=r.peerConnection.getTransceivers().find(B=>B.mid===l[k].mid);if(!U)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(l[k].mid));c.push(U),N._updateRtpTransceiver(U)}}),bi()&&j("SIMULCAST")===!0&&(yield Dt(r.applySimulcastForFirefox(c,t)));let d=l.map(N=>N.mid),h=yield Dt(r.peerConnection.createOffer()),f=r.mungSendOfferSDP(h.sdp,t,d),E=Br(f),S=d.map(N=>{let k=E.mediaDescriptions.find(U=>U.attributes.mid===N);if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return jk(k,j("USE_PUB_RTX"))}),y=c.map((N,k)=>{let U=d[k];return{localSSRC:S[k],id:U}});yield Dt(r.peerConnection.setLocalDescription({type:"offer",sdp:f}));try{yield y}catch(N){let k=r.remoteSDP.toString();throw yield Dt(r.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Dt(r.peerConnection.setRemoteDescription({type:"answer",sdp:k})),yield Dt(r.stopSending(d,!0)),N}yield Dt(r.applySimulcastEncodings(c,t)),yield Dt(r.applySendEncodings(c,t));let D=r.remoteSDP.toString();return r.logSDPExchange(f,"offer","local","send")?.(D),yield Dt(r.setRemoteDescription({type:"answer",sdp:D})),c.map((N,k)=>{let U=d[k];return{localSSRC:S[k],id:U}})}catch(c){throw c instanceof de?c:new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{s()}})()}async stopSending(t,i){let n=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let r=this.peerConnection.getTransceivers().filter(d=>t.indexOf(d.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length (".concat(r.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));r.map(d=>{var h;d.direction="inactive",(h=d.stop)===null||h===void 0||h.call(d)});let s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);let l=this.remoteSDP.toString();c?.(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{n&&n()}}async receive(t,i,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:s,needExchangeSDP:c}=this.remoteSDP.send(t,i,n,r);if(c){let d=this.remoteSDP.toString(),h=this.logSDPExchange(d,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:d});let f=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(f.sdp,s,t);h?.(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),C.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else C.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));let l=this.peerConnection.getTransceivers().find(d=>d.mid===s);if(!l||l.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,mid:l.mid,transceiver:l}}catch(s){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(t,i,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:s,needExchangeSDP:c}=this.remoteSDP.send(t,i,n,r);if(c){let l=this.remoteSDP.toString(),d=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});let h=await this.peerConnection.createAnswer(),f=this.mungReceiveAnswerSDP(h.sdp,s,t);d?.(f||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:f}),C.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else C.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(s){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let i=this.remoteSDP.toString(),n=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});let r=await this.peerConnection.createAnswer();n?.(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(i){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===Lh.Auto&&(this.store.p2pTransport=Lh.SdRtn,Lt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Hm.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Lt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Hm.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;let i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:n}=Kd(i.sdp);return this.store.descriptionStart(),this.direction===mr.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),n}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===mr.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:n}=Kd(i.sdp);return await this.peerConnection.setLocalDescription(i),n}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[i],[t]);this.remoteSDP.updateRecvMedia(t,i);let s=this.remoteSDP.toString(),c=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),c?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new de(M.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(t,i){let n=this.peerConnection.getTransceivers().filter(r=>r.mid===t);n.length===1&&(this.isVP8Simulcast(i)?bi()||await this.applySimulcastEncodings(n,[i]):await this.applySendEncodings(n,[i]))}setStatsRemoteVideoIsReady(t,i){this.statsFilter.setVideoIsReady2(t,i)}async replaceTrack(t,i){let n=this.peerConnection.getTransceivers().find(r=>r.mid===i);n&&await n.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let i=t[0].transport.iceTransport,{local:n,remote:r}=i.getSelectedCandidatePair();return{local:au(au({},cc),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:au(au({},cc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,i;Ce(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var i;t.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r={iceServers:[]};var s;return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(xg(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...Hm.turnServerConfigToIceServers(t.turnServer.servers,i,n)),j("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...Hm.turnServerConfigToIceServers(t.turnServer.serversFromGateway,i,n)),Ce(s=[Lh.Relay,Lh.SdRtn]).call(s,i)&&(r.iceTransportPolicy="relay"),j("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(r.iceTransportPolicy="relay")}))),j("ENABLE_ENCODED_TRANSFORM")&&Lt().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),C.debug("P2PConnection p2pTransport is ".concat(i)),r}static turnServerConfigToIceServers(t,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=[],s=t.filter(l=>l.tcpport);C.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(n));let c=s.length>n?s[n]:s[0];switch(i){case Lh.SdRtn:let l=t.filter(h=>{var f;return Ce(f=h.username).call(f,"glb:")&&h.turnServerURL==h.turnServerURL}),d=l.length>n?l[n]:l[0];d&&(r.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(Wd(d.turnServerURL),":").concat(d.tcpport,"?transport=udp")}),r.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(Wd(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}));break;case Lh.Relay:c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Wd(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;default:c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Wd(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"stun:".concat(c.turnServerURL,":").concat(c.tcpport)}))}return r}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var n;t!=null&&t.state&&((n=this.onDTLSTransportStateChange)===null||n===void 0||n.call(this,t.state))},t.onerror=n=>{var r;(r=this.onDTLSTransportError)===null||r===void 0||r.call(this,"error"in n?n.error:n)};let i=t.iceTransport;i&&(i.onstatechange=()=>{let n=t?.iceTransport.state;var r;n&&((r=this.onICETransportStateChange)===null||r===void 0||r.call(this,n))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){let{local:n,remote:r}=i.getSelectedCandidatePair()||{};if(n&&r){let s=n.address+":"+n.port,c=r.address+":"+r.port;C.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Bh(s)),", remote ").concat(JSON.stringify(Bh(c))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,i){var n;if(i||(i=this.peerConnection.getSenders().find(f=>f.track===t._mediaStreamTrack)),!i)return C.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return C.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Lt().supportSetRtpSenderParameters)return C.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let r={},s={};switch(t._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(t._encoderConfig){var c;let{bitrateMax:f,frameRate:E,scaleResolutionDownBy:S}=t._encoderConfig;f&&(s.maxBitrate=1e3*f),Ce(c=t._hints).call(c,Zt.LOW_STREAM)&&(E&&(s.maxFramerate=sa(E)),S&&S>=1&&(s.scaleResolutionDownBy=S))}if(j("DSCP_TYPE")&&fl()){var l;let f=j("DSCP_TYPE");Ce(l=["very-low","low","medium","high"]).call(l,f)&&(s.networkPriority=f)}let d=i.getParameters(),h=(n=d.encodings)===null||n===void 0?void 0:n[0];bi()&&!h&&(r.encodings=[s]),h&&Object.assign(h,s),Object.assign(d,r),C.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(d.encodings))),await i.setParameters(d)}async applySendEncodings(t,i){try{if(!Lt().supportSetRtpSenderParameters||t.length!==i.length)return;for(let n=0;n<t.length;n++){let r=t[n],s=i[n];s instanceof oi&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,r.sender)}}catch{C.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,i,n){let r=Br(t);return i.forEach((s,c)=>{let l=n[c],d=r.mediaDescriptions.find(h=>h.attributes.mid===l);d&&(Im(d,s),Hk(d,s,this.store.codec))}),Bd(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,i,n)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,t,i,n)},this.statsFilter.onSelectedLocalCandidateChanged=(t,i)=>{var n;(n=this.onSelectedLocalCandidateChanged)===null||n===void 0||n.call(this,t,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,i)=>{var n;(n=this.onSelectedRemoteCandidateChanged)===null||n===void 0||n.call(this,t,i)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,i){if(t.length===i.length)for(let d=0;d<t.length;d++){var n,r,s,c,l;let h=t[d],f=i[d];if(f instanceof oi&&!Ce(n=f._hints).call(n,Zt.LOW_STREAM)&&(r=f._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((s=f._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=f._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=f._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){let E={},S={high:1e3*(f._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];let y=h.sender.getParameters();await h.sender.setParameters(Object.assign(y,E))}}}async applySimulcastEncodings(t,i){if(!bi()&&t.length===i.length)for(let n=0;n<t.length;n++){let r=i[n];if(r instanceof oi&&this.isVP8Simulcast(r)){let s=t[n],c={},l={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];let d=s.sender.getParameters();await s.sender.setParameters(Object.assign(d,c))}}}isVP8Simulcast(t){var i,n,r,s,c;return!!(t instanceof oi&&j("SIMULCAST")&&this.store.codec==="vp8"&&!Ce(i=t._hints).call(i,Zt.LOW_STREAM)&&(n=t._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((r=t._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((c=t._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(t,i,n,r){if(j("SDP_LOGGING"))return C.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(i," SDP during P2PConnection.").concat(r,`
`),t),i==="offer"?s=>{this.logSDPExchange(s,"answer",n==="local"?"remote":"local",r)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(c=>{c.direction="inactive"});let n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(t);let s=this.remoteSDP.toString();r?.(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async c=>{c.direction="sendonly"});let n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(t);let s=this.remoteSDP.toString();r?.(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(t,i){var n;if(i=i??((n=this.currentRemoteDescription)===null||n===void 0?void 0:n.sdp)){var r;return((r=Br(i).mediaDescriptions.find(c=>c.attributes.mid===t))===null||r===void 0?void 0:r.attributes.ssrcs)?.[0].ssrcId}}async setRemoteDescription(t){var i;await this.peerConnection.setRemoteDescription(t),Ce(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,i,n){let r=Br(t),s=r.mediaDescriptions.find(c=>c.attributes.mid===i);return s&&n===ke.AUDIO&&s.media.mediaType==="audio"&&Om(s),Bd(r)}},Fe(ci.prototype,"establish",[Ms],Object.getOwnPropertyDescriptor(ci.prototype,"establish"),ci.prototype),Fe(ci.prototype,"connect",[Ms],Object.getOwnPropertyDescriptor(ci.prototype,"connect"),ci.prototype),Fe(ci.prototype,"receive",[Ms],Object.getOwnPropertyDescriptor(ci.prototype,"receive"),ci.prototype),Fe(ci.prototype,"mockReceive",[Ms],Object.getOwnPropertyDescriptor(ci.prototype,"mockReceive"),ci.prototype),Fe(ci.prototype,"stopReceiving",[Ms],Object.getOwnPropertyDescriptor(ci.prototype,"stopReceiving"),ci.prototype),Fe(ci.prototype,"restartICE",[Ms],Object.getOwnPropertyDescriptor(ci.prototype,"restartICE"),ci.prototype),Fe(ci.prototype,"close",[Ms],Object.getOwnPropertyDescriptor(ci.prototype,"close"),ci.prototype),Fe(ci.prototype,"updateEncoderConfig",[Ms],Object.getOwnPropertyDescriptor(ci.prototype,"updateEncoderConfig"),ci.prototype),Fe(ci.prototype,"updateSendParameters",[Ms],Object.getOwnPropertyDescriptor(ci.prototype,"updateSendParameters"),ci.prototype),Fe(ci.prototype,"replaceTrack",[Ms],Object.getOwnPropertyDescriptor(ci.prototype,"replaceTrack"),ci.prototype),Fe(ci.prototype,"muteLocal",[Ms],Object.getOwnPropertyDescriptor(ci.prototype,"muteLocal"),ci.prototype),Fe(ci.prototype,"unmuteLocal",[Ms],Object.getOwnPropertyDescriptor(ci.prototype,"unmuteLocal"),ci.prototype),ci);function Ms(e,t,i){let n=e[t];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let r=this.mutex,s=await r.lock("From P2PConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await n.apply(this,l)}finally{s()}},i}let go=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({});var Z3,Q3,$3,e4,t4,i4,n4,r4,a4,s4,o4,gi;function c4(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function OR(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?c4(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):c4(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}let UH=(Z3=So(go.SEND_ONLY),Q3=So(go.SEND_ONLY),$3=So(),e4=So(go.RECEIVE_ONLY),t4=So(go.RECEIVE_ONLY),i4=So(go.RECEIVE_ONLY),n4=So(go.RECEIVE_ONLY),r4=So(go.RECEIVE_ONLY),a4=So(go.RECEIVE_ONLY),s4=So(),o4=So(go.RECEIVE_ONLY),gi=class extends vi{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(Ke.StateChange,t,this._state)}constructor(e,t){super(),L(this,"isPlanB",!1),L(this,"store",void 0),L(this,"statsUploader",void 0),L(this,"sendConnection",void 0),L(this,"recvConnection",void 0),L(this,"localTrackMap",new Map),L(this,"remoteUserMap",new Map),L(this,"localDataChannels",[]),L(this,"pendingLocalTracks",[]),L(this,"pendingRemoteTracks",[]),L(this,"statsCollector",void 0),L(this,"dtlsFailedCount",0),L(this,"sendMutex",void 0),L(this,"recvMutex",void 0),L(this,"_state",Ht.Disconnected),L(this,"_restartStates",["disconnected","failed"]),L(this,"reconnectInterval",void 0),L(this,"uploadUnplinkStarted",!1),L(this,"uploadDownlinkStarted",!1),L(this,"uplinkStateUploadInterval",void 0),L(this,"downlinkStatsUploadInterval",void 0),L(this,"handleMuteLocalTrack",async(i,n,r)=>{let s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Ht.Connected)return void r(new de(M.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let d=this.filterTobeMutedTracks(i);if(d.length===0)return void n();let h=d.find(y=>y[0]==="videoLowTrack");h&&h[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(d.map(y=>{let[,{id:D}]=y;return D}));let f=!1;var c,l;i.trackMediaType==="video"?f=!((c=this.localTrackMap.get(ge.LocalAudioTrack))===null||c===void 0||!c.track._muted):f=((l=this.localTrackMap.get(ge.LocalVideoTrack))===null||l===void 0?void 0:l.id)===void 0;let E=this.createMuteMessage(d);await $t(this,Ke.RequestMuteLocal,E);let S=i.trackMediaType==="video"?Hd.MUTE_LOCAL_VIDEO:Hd.MUTE_LOCAL_AUDIO;await $t(this,Ke.RequestP2PMuteLocal,{action:S,message:E,isMuteAll:f}),n()}catch(d){r(d)}finally{s()}}),L(this,"handleUnmuteLocalTrack",async(i,n,r)=>{let s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Ht.Connected)return void r(new de(M.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let c=this.filterTobeUnmutedTracks(i);if(c.length===0)return void n();await this.sendConnection.unmuteLocal(c.map(h=>{let[,{id:f}]=h;return f}));let l=this.createUnmuteMessage(c),d=i.trackMediaType==="video"?Hd.UNMUTE_LOCAL_VIDEO:Hd.UNMUTE_LOCAL_AUDIO;await $t(this,Ke.RequestP2PMuteLocal,{action:d,message:l}),n()}catch(c){r(c)}finally{s()}}),L(this,"handleUpdateVideoEncoder",async(i,n,r,s)=>{let c;typeof s=="boolean"&&s||(c=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{let d=this.localTrackMap.get(ge.LocalVideoTrack);if(!this.sendConnection||!d||d.track!==i||this.state!==Ht.Connected)return void n();let{id:h,track:f}=d;h&&(await this.sendConnection.updateSendParameters(h,f),await this.sendConnection.updateEncoderConfig(h,f),this.emit(Ke.UpdateVideoEncoder,f)),n()}catch(d){r(d)}finally{var l;(l=c)===null||l===void 0||l()}}),L(this,"handleUpdateVideoSendParameters",async(i,n,r)=>{let s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let c=this.localTrackMap.get(ge.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==i||this.state!==Ht.Connected)return void n();let{id:l,track:d}=c;l&&await this.sendConnection.updateSendParameters(l,d),n()}catch(c){r(c)}finally{s()}}),L(this,"handleReplaceTrack",async(i,n,r,s)=>{let c;C.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var l;let h=Array.from(this.localTrackMap.entries()).find(f=>{let[,{track:E}]=f;return i===E});if(!this.sendConnection||!h||h[1].id===void 0||this.state!==Ht.Connected)return void n();if(await((l=this.sendConnection)===null||l===void 0?void 0:l.replaceTrack(i,h[1].id)),h[0]===ge.LocalVideoTrack&&Lt().supportDualStreamEncoding){let f=this.localTrackMap.get(ge.LocalVideoLowTrack);if(f){let E=i._mediaStreamTrack.clone();f.track._originMediaStreamTrack.stop(),f.track._mediaStreamTrack=E,f.track._originMediaStreamTrack=E,await new Ie((S,y)=>{this.handleReplaceTrack(f.track,S,y,!0)})}}n()}catch(h){r(h)}finally{var d;(d=c)===null||d===void 0||d()}}),L(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),L(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),L(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),L(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new AM(e),this.bindStatsUploaderEvents(),this.sendMutex=new Vn("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Vn("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},j("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new de(M.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new de(M.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let i;try{if(t){this.recvConnection&&(C.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new J3(e,this.store,mr.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let n=await this.recvConnection.establish(t);return{iceParameters:n.iceParameters,dtlsParameters:n.dtlsParameters,sdp:n.sdp}}{this.state=Ht.New,this.sendConnection&&(C.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new J3(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let n=await this.sendConnection.establish();return{iceParameters:n.iceParameters,dtlsParameters:n.dtlsParameters,sdp:n.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new de(M.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ht.Connected}async addRemoteCandidate(e,t){if(t===mr.RECEIVE_ONLY){if(!this.sendConnection)throw new de(M.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new de(M.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,i){var n=this;return Ka(function*(){let r=yield Dt(n.sendMutex.lock("From P2PChannel.publish"));try{if(!n.sendConnection||n.state!==Ht.Connected){n.throwIfTrackTypeNotMatch(e);let h=e.filter(f=>n.pendingLocalTracks.indexOf(f)===-1);return void(n.pendingLocalTracks=n.pendingLocalTracks.concat(h))}n.store.pubId=n.store.pubId+1,Gn.markPublishStart(n.store.clientId,n.store.pubId);let s=n.filterTobePublishedTracks(e,t,i);if(s.length===0)return void(yield Dt(n.tryToUnmuteAudio(e)));s.forEach(h=>{let{track:f,type:E}=h,S=Date.now();n.store.publish(f.getTrackId(),E===ge.LocalAudioTrack?"audio":"video",S)}),n.bindLocalTrackEvents(s);let c=yield Dt(n.sendConnection.send(s.map(h=>{let{track:f}=h;return f}),n.store.codec,n.store.audioCodec)),l=(yield Dt(c.next())).value,d=n.createGatewayPublishMessage(s,l);try{yield d}catch(h){throw c.throw(h),h?.code===M.WS_ABORT&&s.forEach(f=>{let{track:E}=f;n.pendingLocalTracks.indexOf(E)===-1&&n.pendingLocalTracks.push(E)}),n.unbindLocalTrackEvents(s),h}yield Dt(c.next()),s.forEach(h=>{let{type:f}=h;n.statsCollector.addLocalStats(f)}),n.statsUploader.startUploadOutboundStats(),n.assignLocalTracks(s,l),s.forEach(h=>{let{track:f,type:E}=h,S=Date.now();n.store.publish(f.getTrackId(),E===ge.LocalAudioTrack?"audio":"video",void 0,S)}),n.startUploadUplinkState()}finally{r()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Ht.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(r=>!Ce(e).call(e,r)));let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let i=t.find(r=>r[0]==="videoLowTrack");i&&i[1].track.close();let n=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(r=>{let[,{id:s}]=r;return s})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[s,{track:c}]=r;return{type:s,track:c}})),t.forEach(r=>{let[s]=r;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Ht.Connected)return i&&i[1].track.close(),n;e.forEach(r=>{let s=this.pendingLocalTracks.indexOf(r);s!==-1&&this.pendingLocalTracks.splice(s,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let t=[],i=[];Array.from(this.localTrackMap.entries()).forEach(n=>{let[r,{track:s,ssrcs:c}]=n,l={stream_type:I7(s,r),ssrcs:c};s._muted||!s._enabled?t.push(l):i.push(l)}),t.length>0&&t.forEach(n=>{$t(this,Ke.RequestMuteLocal,[n])}),i.length>0&&i.forEach(n=>{$t(this,Ke.RequestUnmuteLocal,[n])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Ka(function*(){throw new de(M.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(C.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await On(this,Ke.RequestRePublish,this.pendingLocalTracks),this.emit(Ke.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new de(M.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,i,n){var r;if(!this.recvConnection)throw new de(M.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((r=this.remoteUserMap.get(e))!==null&&r!==void 0&&r.has(t))return;let{track:s,mid:c,transceiver:l}=await this.recvConnection.receive(t,[{ssrcId:i}],String(e.uid),n);t===ke.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(s):(e._audioTrack=new vm(s,e.uid,e._uintid,this.store),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),l&&e._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(s):(e._videoTrack=new Sm(s,e.uid,e._uintid,this.store),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),l&&e._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._videoTrack));let d=this.remoteUserMap.get(e);d?d.set(t,c):this.remoteUserMap.set(e,new Map([[t,c]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let h=this.pendingRemoteTracks.findIndex(f=>{let{user:E,kind:S}=f;return E.uid===e.uid&&t===S});h!==-1&&(this.pendingRemoteTracks.splice(h,1),this.emit(Ke.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,i,n){if(!this.recvConnection)throw new de(M.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:i}],String(e.uid),n)}async unsubscribe(e,t,i){let n=this.pendingRemoteTracks.filter(s=>{let{user:c,kind:l}=s;return t!==void 0?c.uid===e.uid&&t===l:c.uid===e.uid});if(n.forEach(s=>{let c=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(c,1)}),this.recvConnection||i||n.forEach(s=>{let{kind:c}=s;var l;if(c===ke.AUDIO)(l=e._audioTrack)===null||l===void 0||l._destroy(),e._audioTrack=void 0;else if(c===ke.VIDEO){var d;(d=e._videoTrack)===null||d===void 0||d._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;let r=this.filterTobeUnSubscribedTracks(e,t);r.length!==0&&(await this.recvConnection.stopReceiving(r.map(s=>{let[,{id:c}]=s;return c})),this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),r.forEach(s=>{let[c,{kind:l}]=s;var d,h;if(l===ke.VIDEO&&c._videoSSRC&&((d=this.recvConnection)===null||d===void 0||d.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===ke.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),i||((h=c._videoTrack)===null||h===void 0||h._destroy(),c._videoTrack=void 0);else if(l===ke.AUDIO){var f;this.unbindRemoteTrackEvents(c._audioTrack),!i&&((f=c._audioTrack)===null||f===void 0||f._destroy(),c._audioTrack=void 0)}}),r.forEach(s=>{let[,{kind:c}]=s;$t(this,Ke.RequestP2PMuteRemote,c)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,i]=t;[ke.VIDEO,ke.AUDIO].forEach(n=>{i.has(n)?$t(this,Ke.RequestP2PUnmuteRemote,n):$t(this,Ke.RequestP2PMuteRemote,n)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new de(M.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new de(M.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new de(M.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new de(M.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;let i=this.remoteUserMap.get(e);if(!i)return void C.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(t))return void C.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let n=t===ke.VIDEO?e._videoSSRC:e._audioSSRC;n!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(n,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;let i=this.remoteUserMap.get(e);if(!i)return void C.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(t)||C.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(ge.LocalAudioTrack);if(t?.track instanceof Ji){let i=t.track;return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return r!==ge.LocalAudioTrack}).filter(n=>{let[r]=n;return!(e&&r===ge.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[n]=i;return!(e&&n===ge.LocalVideoLowTrack)}).map(i=>{let[,{track:n}]=i;return n})}reportPublishEvent(e,t,i,n,r){if(e){let c=this.localTrackMap.get(ge.LocalAudioTrack),l=n?this.localTrackMap.get(ge.LocalVideoLowTrack):this.localTrackMap.get(ge.LocalVideoTrack);He.publish(this.store.sessionId,{eventElapse:Gn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c?.track.getTrackLabel(),videoName:l?.track.getTrackLabel(),screenshare:l?.track._hints.indexOf(Zt.SCREEN_TRACK)!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var s;i||(i=[]);let c=i.find(d=>d instanceof Oi),l=n?(s=this.localTrackMap.get(ge.LocalVideoTrack))===null||s===void 0?void 0:s.track:i.find(d=>d instanceof oi);He.publish(this.store.sessionId,{eventElapse:Gn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c?.getTrackLabel(),videoName:l?.getTrackLabel(),screenshare:l?._hints.indexOf(Zt.SCREEN_TRACK)!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(e,t,i,n){let r=n===ke.VIDEO?i._videoSSRC:i._audioSSRC;r&&He.subscribe(this.store.sessionId,{succ:e,ec:t,video:n===ke.VIDEO,audio:n===ke.AUDIO,peerid:i.uid,subscribeRequestid:n===ke.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:Gn.measureFromSubscribeStart(this.store.clientId,r)})}reset(){C.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Vn("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Vn("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(ge.LocalAudioTrack);if(e?.track instanceof Ji){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(i=>{t.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Ht.Disconnected}getStats(e){var t,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(ge.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(ge.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof oi||t&&t.track instanceof Oi?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}getRemoteMedia(e){var t;let i=Array.from(Fr(t=this.remoteUserMap).call(t)).find(n=>n.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[n]=i;return{uid:n.uid,level:n.audioTrack?100*n.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(ge.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=lt(e).call(e,(i,n)=>i.level-n.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(C.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Ht.Reconnecting,j("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var i;t._videoTrack&&t._videoTrack._player&&((i=t._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[i,{track:n}]=e;switch(i){case ge.LocalVideoTrack:Ce(t=n._hints).call(t,Zt.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case ge.LocalAudioTrack:n instanceof Ji?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);case ge.LocalVideoLowTrack:}}),this.emit(Ke.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;Array.from(Fr(i).call(i)).forEach(n=>{this.setPendingRemoteMedia(t,n)}),this.emit(Ke.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),C.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(let i of this.pendingRemoteTracks){let{user:n,kind:r}=i;if((e instanceof Jd?e.uid:e)===n.uid&&t===r)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let i,n;if(e===mr.SEND_ONLY){if(!this.sendConnection)throw new de(M.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),n=this.sendConnection}else{if(!this.recvConnection)throw new de(M.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),n=this.recvConnection}try{if(t){let r=await n.restartICE(t);return n.isInRestartIce=!1,r}{let r=await n.restartICE();if(r){let s=await On(this,Ke.RequestP2PRestartICE,{direction:mr.RECEIVE_ONLY,iceParameter:r});await n.restartICE(s),n.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),t=this.localTrackMap.get(ge.LocalVideoTrack),i=this.localTrackMap.get(ge.LocalAudioTrack),n=e.videoSend.find(y=>{var D;return y.ssrc===(t==null||(D=t.ssrcs)===null||D===void 0?void 0:D[0].ssrcId)}),r=e.audioSend.find(y=>{var D;return y.ssrc===(i==null||(D=i.ssrcs)===null||D===void 0?void 0:D[0].ssrcId)});if(!n||!r)return 1;let s=va(this,Ke.NeedSignalRTT),c=n?n.rttMs:void 0,l=r?r.rttMs:void 0,d=c&&l?(c+l)/2:c||l,h=(d&&s?(d+s)/2:d||s)||0,f=100*e.sendPacketLossRate*.7/50+.3*h/1500,E=f<.17?1:f<.36?2:f<.59?3:f<.1?4:5,S=t?.track;if(S&&S._encoderConfig&&S._hints.indexOf(Zt.SCREEN_TRACK)===-1){let y=S._encoderConfig.bitrateMax,D=e.bitrate.actualEncoded;if(y&&D){let O=(1e3*y-D)/(1e3*y);return _k[O<.15?0:O<.3?1:O<.45?2:O<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[n]=i,r=n._audioSSRC,s=n._videoSSRC,c=e.audioRecv.find(D=>D.ssrc===r),l=e.videoRecv.find(D=>D.ssrc===s);if(!c&&!l)return void(t+=1);let d=va(this,Ke.NeedSignalRTT),h=e.rtt,f=(h&&d?(h+d)/2:h||d)||0,E=c?c.jitterMs:void 0,S=e.recvPacketLossRate,y=.7*S*100/50+.3*f/1500;E&&(y=.6*S*100/50+.2*f/1500+.2*E/400),t+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Ie((t,i)=>{this.handleMuteLocalTrack(e,t,i)})}filterTobePublishedTracks(e,t,i){let n=[],r=Lt(),s=this.getAllTracks();e=sm(e=e.filter(d=>s.indexOf(d)===-1));let c=!1,l=!1;for(let d of e){if(d instanceof oi&&(this.localTrackMap.has(ge.LocalVideoTrack)||c?new de(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(n.push({track:d,type:ge.LocalVideoTrack}),c=!0),t)){let h=this.getLowVideoTrack(d,i);n.push({track:h,type:ge.LocalVideoLowTrack})}if(d instanceof Oi){let h=this.localTrackMap.get(ge.LocalAudioTrack);if(h){if(!(h.track instanceof Ji))throw new de(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new de(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0)}else if(l){let f=n.find(E=>{let{type:S}=E;return S===ge.LocalAudioTrack});if(!(f.track instanceof Ji))throw new de(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new de(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(d)}else{if(!r.webAudioMediaStreamDest||d instanceof Ji||d._bypassWebAudio)n.push({track:d,type:ge.LocalAudioTrack});else{let f=new Ji;f.addAudioTrack(d),n.push({track:f,type:ge.LocalAudioTrack})}l=!0}}}return n}filterTobeUnpublishedTracks(e){let t=[],i=this.getAllTracks();e=sm(e=e.filter(n=>i.indexOf(n)!==-1));for(let n of e){if(n instanceof Oi){let r=this.localTrackMap.get(ge.LocalAudioTrack);if(!r)continue;r.track instanceof Ji?(r.track.removeAudioTrack(n),this.unbindLocalAudioTrackEvents(n),r.track.trackList.length===0&&(t.push([ge.LocalAudioTrack,r]),r.track.close())):t.push([ge.LocalAudioTrack,r])}if(n instanceof oi){let r=this.localTrackMap.get(ge.LocalVideoTrack);if(!r)continue;t.push([ge.LocalVideoTrack,r]);let s=this.localTrackMap.get(ge.LocalVideoLowTrack);s&&t.push([ge.LocalVideoLowTrack,s])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:i,type:n}=t;switch(n){case ge.LocalVideoTrack:i.addListener(je.GET_STATS,this.handleGetLocalVideoStats),i.addListener(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(je.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(je.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(je.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ge.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case ge.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Ji?e.trackList.forEach(i=>{i.addListener(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(je.GET_STATS,this.handleGetLocalAudioStats),i.addListener(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(je.GET_STATS,this.handleGetLocalAudioStats),e.addListener(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(je.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[i,{track:n}]=t;return{track:n,type:i}})),e.forEach(t=>{let{track:i,type:n}=t;switch(n){case ge.LocalVideoTrack:i.off(je.GET_STATS,this.handleGetLocalVideoStats),i.off(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(je.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(je.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(je.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ge.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case ge.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ji?e.trackList.forEach(t=>{t.off(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(je.GET_STATS,this.handleGetLocalAudioStats),t.off(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(je.GET_STATS,this.handleGetLocalAudioStats),e.off(je.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(je.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(je.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(je.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(je.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Sm&&t.addListener(je.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),t instanceof vm&&t.addListener(je.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(je.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;i.has(ke.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),i.has(ke.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((i,n)=>{var r;let s,{track:c,type:l}=i;switch(l){case ge.LocalAudioTrack:s=Wt.Audio;break;case ge.LocalVideoTrack:s=Ce(r=c._hints).call(r,Zt.SCREEN_TRACK)?Wt.Screen:Wt.High;break;case ge.LocalVideoLowTrack:s=Wt.Low}return{kind:l===ge.LocalAudioTrack?ke.AUDIO:ke.VIDEO,stream_type:s,mid:t[n].id,ssrcs:t[n].localSSRC,isMuted:c.muted||!c.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var i;let n,[r,{track:s,ssrcs:c,id:l}]=t;switch(r){case ge.LocalVideoTrack:n=Ce(i=s._hints).call(i,Zt.SCREEN_TRACK)?Wt.Screen:Wt.High;break;case ge.LocalAudioTrack:n=Wt.Audio;break;case ge.LocalVideoLowTrack:n=Wt.Low}return{stream_type:n,ssrcs:c,mid:l}})}assignLocalTracks(e,t){e.forEach((i,n)=>{let{track:r,type:s}=i;this.localTrackMap.set(s,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[i]=t;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var i;C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Ke.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),Ce(i=this._restartStates).call(i,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Sn(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),He.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:_i.TRACER}).onSuccess(),this.emit(Ke.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var i;let n=Array.from(Fr(i=this.remoteUserMap).call(i)).find(s=>s._audioSSRC===t);var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),(r=n.audioTrack)===null||r===void 0||r.emit(Xa.FIRST_FRAME_DECODED),He.firstRemoteFrame(this.store.sessionId,nn.FIRST_AUDIO_DECODE,fi.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:Gn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var i;let n=Array.from(Fr(i=this.remoteUserMap).call(i)).find(r=>r._audioSSRC===t);n&&He.firstRemoteFrame(this.store.sessionId,nn.FIRST_AUDIO_RECEIVED,fi.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:Gn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,i,n)=>{this.reportVideoFirstFrameDecoded(t,i,n)},e.onFirstVideoReceived=t=>{var i;let n=Array.from(Fr(i=this.remoteUserMap).call(i)).find(r=>r._videoSSRC===t);n&&He.firstRemoteFrame(this.store.sessionId,nn.FIRST_VIDEO_RECEIVED,fi.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:Gn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,i)=>{let n=t.candidateType==="relay",r=i.candidateType==="relay";i.candidateType!=="unknown"&&n===r||this.emit(Ke.ConnectionTypeChange,n),C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(zd(i))," -> ").concat(JSON.stringify(zd(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,i)=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(zd(i))," -> ").concat(JSON.stringify(zd(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Ke.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){let t=e===mr.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,C.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===mr.SEND_ONLY?this.restartICE(e):On(this,Ke.RequestP2PRestartICE,{direction:mr.SEND_ONLY}))}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let i=this.localTrackMap.get(ge.LocalAudioTrack);if(e instanceof Oi&&i?.track instanceof Ji)return i.track.isActive||t.push([ge.LocalAudioTrack,i]),t;let n=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return e===s});if(n&&(t.push(n),n[0]===ge.LocalVideoTrack)){let r=this.localTrackMap.get(ge.LocalVideoLowTrack);r&&t.push([ge.LocalVideoLowTrack,r])}return t}filterTobeUnmutedTracks(e){let t=[],i=this.localTrackMap.get(ge.LocalAudioTrack);if(e instanceof Oi&&i?.track instanceof Ji)return i.track.isActive&&t.push([ge.LocalAudioTrack,i]),t;let n=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return e===s});if(n)if(n[0]===ge.LocalVideoTrack){t.push(n);let r=this.localTrackMap.get(ge.LocalVideoLowTrack);r&&t.push([ge.LocalVideoLowTrack,r])}else t.push(n);return t}createMuteMessage(e){return e.map(t=>{var i;let n,[r,{track:s,ssrcs:c,id:l}]=t;switch(r){case ge.LocalAudioTrack:n=Wt.Audio;break;case ge.LocalVideoTrack:n=Ce(i=s._hints).call(i,Zt.SCREEN_TRACK)?Wt.Screen:Wt.High;break;case ge.LocalVideoLowTrack:n=Wt.Low}return{stream_type:n,ssrcs:c,mid:l}})}createUnmuteMessage(e){return e.map(t=>{var i;let n,[r,{track:s,ssrcs:c,id:l}]=t;switch(r){case ge.LocalAudioTrack:n=Wt.Audio;break;case ge.LocalVideoTrack:n=Ce(i=s._hints).call(i,Zt.SCREEN_TRACK)?Wt.Screen:Wt.High;break;case ge.LocalVideoLowTrack:n=Wt.Low}return{stream_type:n,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(e,t){let i=[],n=this.remoteUserMap.get(e);if(!n)return i;if(t){let r=n.get(t);if(!r)return i;i.push([e,{kind:t,id:r}])}else Array.from(n.entries()).forEach(r=>{let[s,c]=r;i.push([e,{kind:s,id:c}])});return i}createUnsubscribeMessage(e){let t=[];return e.forEach(i=>{let[n,{kind:r,id:s}]=i;switch(r){case ke.VIDEO:return void(n._videoSSRC&&t.push({stream_type:ke.VIDEO,ssrcId:n._videoSSRC}));case ke.AUDIO:return void(n._audioSSRC&&t.push({stream_type:ke.AUDIO,ssrcId:n._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[i,{kind:n}]=t,r=this.remoteUserMap.get(i);r&&(r.delete(n),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(ge.LocalVideoTrack),i=this.localTrackMap.get(ge.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Ie((n,r)=>{this.handleUpdateVideoEncoder(t.track,n,r,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Ie((n,r)=>{this.handleUpdateVideoEncoder(i.track,n,r,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Oi){let i=this.filterTobeUnmutedTracks(e[t]);if(i.length===0)continue;let n=this.createUnmuteMessage(i);return void await $t(this,Ke.RequestUnmuteLocal,n)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Ke.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Ke.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Sn(dw(this.dtlsFailedCount,zi)),this.emit(Ke.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(ge.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof oi)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof oi).length>1)throw new de(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Oi).length>1&&(e.some(t=>t instanceof Oi&&t._bypassWebAudio)||!Lt().webAudioMediaStreamDest))throw new de(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof oi&&this.pendingLocalTracks.some(i=>i instanceof oi))throw new de(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Oi&&this.pendingLocalTracks.some(i=>i instanceof Oi)&&(!Lt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Oi&&i._bypassWebAudio)))throw new de(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let i=!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Lt().supportDualStreamEncoding,n=OR(OR({},{width:160,height:120,framerate:15,bitrate:50}),t),r;r=i?e._mediaStreamTrack.clone():AI(e,n);let s=ei(8,"track-low-"),c=new oi(r,OR(OR({},i&&{scaleResolutionDownBy:sI(n,e)}),{},{frameRate:n.framerate,bitrateMax:n.bitrate,bitrateMin:n.bitrate}),void 0,void 0,s);return c.on(Ph.TRANSCEIVER_UPDATED,l=>{e._updateRtpTransceiver(l,pm.LOW_STREAM)}),c._hints.push(Zt.LOW_STREAM),e.addListener(je.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,i,n){var r;let s=Array.from(Fr(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===e);if(s){n||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());let c=this.store.keyMetrics,l=c.subscribe.find(d=>d.userId===s.uid&&d.type==="video");He.firstRemoteVideoDecode(this.store.sessionId,nn.FIRST_VIDEO_DECODE,fi.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:i,subscribeElapse:Gn.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:l?.subscribeEnd||0,subscriberStart:l?.subscribeStart||0,videoAddNotify:l?.streamAdded||0,state:n?1:0})}}async remoteMediaSsrcChanged(e,t,i){if(!this.recvConnection)return!1;let n=this.remoteUserMap.get(e);if(!n)return!1;let r=n.get(t);if(!r)return!1;let s=await this.recvConnection.getRemoteSSRC(r);return s!==void 0&&s!==i}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new de(M.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new de(M.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new de(M.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new de(M.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new de(M.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new de(M.NOT_SUPPORTED)}async preConnect(e){throw new de(M.NOT_SUPPORTED)}getEstablishParams(){throw new de(M.NOT_SUPPORTED)}async reSubscribe(e){throw new de(M.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new de(M.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:i}]=e;t===ge.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,pm.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},Fe(gi.prototype,"p2pConnect",[Z3],Object.getOwnPropertyDescriptor(gi.prototype,"p2pConnect"),gi.prototype),Fe(gi.prototype,"unpublish",[Q3],Object.getOwnPropertyDescriptor(gi.prototype,"unpublish"),gi.prototype),Fe(gi.prototype,"unpublishLowStream",[$3],Object.getOwnPropertyDescriptor(gi.prototype,"unpublishLowStream"),gi.prototype),Fe(gi.prototype,"subscribe",[e4],Object.getOwnPropertyDescriptor(gi.prototype,"subscribe"),gi.prototype),Fe(gi.prototype,"mockSubscribe",[t4],Object.getOwnPropertyDescriptor(gi.prototype,"mockSubscribe"),gi.prototype),Fe(gi.prototype,"unsubscribe",[i4],Object.getOwnPropertyDescriptor(gi.prototype,"unsubscribe"),gi.prototype),Fe(gi.prototype,"muteRemote",[n4],Object.getOwnPropertyDescriptor(gi.prototype,"muteRemote"),gi.prototype),Fe(gi.prototype,"unmuteRemote",[r4],Object.getOwnPropertyDescriptor(gi.prototype,"unmuteRemote"),gi.prototype),Fe(gi.prototype,"hasRemoteMediaWithLock",[a4],Object.getOwnPropertyDescriptor(gi.prototype,"hasRemoteMediaWithLock"),gi.prototype),Fe(gi.prototype,"disconnectForReconnect",[s4],Object.getOwnPropertyDescriptor(gi.prototype,"disconnectForReconnect"),gi.prototype),Fe(gi.prototype,"remoteMediaSsrcChanged",[o4],Object.getOwnPropertyDescriptor(gi.prototype,"remoteMediaSsrcChanged"),gi.prototype),gi);function So(e){return function(t,i,n){let r=t[i];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];switch(e){case go.SEND_ONLY:{let d=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await r.apply(this,c)}finally{d()}}case go.RECEIVE_ONLY:{let d=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await r.apply(this,c)}finally{d()}}default:{let d=await this.sendMutex.lock("From P2PChannel2.".concat(i)),h=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await r.apply(this,c)}finally{d(),h()}}}},n}}class Zh extends vi{constructor(t,i){super(),L(this,"signal",void 0),L(this,"token",void 0),L(this,"tokenTimeout",void 0),L(this,"tokenInterval",void 0),L(this,"_sequence",0),L(this,"userMap",new Map),L(this,"encoder",new TextEncoder),this.signal=t,this.token=i;let n=()=>{this.signal.connectionState===si.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(n,1e3):this.tokenInterval=window.setTimeout(n,3*j("P2P_TOKEN_INTERVAL"))};n()}async send(t,i,n,r,s){var c;if(this.userMap.size===0)return;let l=Array.from(Cr(c=this.userMap).call(c))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),r=r??ei(6,""),s=s??this._sequence++;let d={_id:r,_type:t,_seq:s,_message:i,token:"".concat(this.token,"_").concat(l)};j("SHOW_P2P_LOG")&&C.debug("send message",d,"noNeedResponse : ".concat(n)),this.splitMessage(JSON.stringify(d)).forEach(f=>{this.signal.request(et.DATA_STREAM,{payload:jd(this.encoder.encode(f))})});let h=new Ie((f,E)=>{let S=window.setTimeout(()=>{this.off("res-@".concat(r,"_ack"),y),this.off("res-@".concat(r),O),this.off(bm.ABORT,D),C.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(r)),this.userMap.size===0?E(new de(M.INVALID_REMOTE_USER)):E(new de(M.TIMEOUT))},j("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),y=()=>{S&&window.clearTimeout(S),this.off(bm.ABORT,D),n&&f()},D=()=>{S&&window.clearTimeout(S),this.off("res-@".concat(r,"_ack"),y),this.off("res-@".concat(r),O),E(new de(M.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(r)))};this.once(bm.ABORT,D),this.once("res-@".concat(r,"_ack"),y);let O=(k,U)=>{N=!0,S&&window.clearTimeout(S),this.off("res-@".concat(r,"_ack"),y),this.off(bm.ABORT,D),k==="success"?f(U):E(new de(M.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(r)))},N=!1;n||(this.once("res-@".concat(r),O),Sn(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{N||C.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(r,", ").concat(d))}))});try{return await h}catch(f){if(f.code===M.TIMEOUT)return await this.send(t,i,n,r,s);throw f}}onMessage(t){var i;let{_uid:n}=t,r,s=this.userMap.get(n);if(s)r=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Ui.CHECK)return;let{token:h}=t;r=new Map,s={uid:n,isStart:!0,token:h,splitMessageMap:r,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(n,s),this.signal.emit(Rt.ON_USER_ONLINE,{uid:n}),this.handleUserOnline()}if("id"in t&&"total"in t){var c;let{id:h,total:f}=t,E=(c=r.get(h))!==null&&c!==void 0?c:[];if(E.push(t),r.has(h)||r.set(h,E),E.length!==f)return;{let S=lt(E).call(E,(y,D)=>y.index-D.index).map(y=>y.payload).join("");r.delete(h),(t=JSON.parse(S))._uid=n}}let{_type:l,token:d}=t;if(Ce(i=[Ui.ACK,Ui.CHECK]).call(i,l))return l===Ui.CHECK&&this.handleCheckToken(s,d),void this.receiveMessage(t);d==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(t):C.debug('Receive unexpected message", '.concat(d,", cur_token: ").concat(s.token,"_").concat(this.token),t)}check(){let t={_id:ei(6,""),token:this.token,_type:Ui.CHECK};j("SHOW_P2P_LOG")&&C.debug("send message",t),this.signal.request(et.DATA_STREAM,{payload:jd(this.encoder.encode(JSON.stringify(t)))})}ack(t){let i={_id:t,_type:Ui.ACK,token:this.token};j("SHOW_P2P_LOG")&&C.debug("send message",i),this.signal.request(et.DATA_STREAM,{payload:jd(this.encoder.encode(JSON.stringify(i)))})}response(t,i,n){this.send(Ui.RESPONSE,JSON.stringify({success:!n,message:i}),!0,t)}handleReceivedMessage(t){let i=()=>{this.userMap.forEach(h=>{let{receivedMessagesMap:f,nextExpectedSequenceNumber:E}=h;for(;f.has(E);){let S=f.get(E);f.delete(E),this.receiveMessage(S),h.nextExpectedSequenceNumber++}})};if(!t)return void i();let{_uid:n,_seq:r}=t,s=this.userMap.get(n),{receivedMessagesMap:c,isStart:l,nextExpectedSequenceNumber:d}=s;if(r<d)return this.ack(t._id),void C.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(t._message));c.set(r,t),l&&r===d&&(this.receiveMessage(t),c.delete(d),s.nextExpectedSequenceNumber++,i())}receiveMessage(t){let{_id:i,_type:n,_message:r,_uid:s}=t;if(j("SHOW_P2P_LOG")&&C.debug("receive message",t),i){let c;switch(t._type!==Ui.ACK&&(r&&(c=JSON.parse(r)),this.ack(t._id)),t._type){case Ui.CANDIDATE:case Ui.CONTROL:this.signal.emit(n,c,s);break;case Ui.PUBLISH:case Ui.UNPUBLISH:case Ui.RESTART_ICE:case Ui.CALL:c.uid=s,On(this.signal,n,c).then(l=>{this.response(t._id,l)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Ui.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case Ui.RESPONSE:{let{success:l,message:d}=c;this.emit("res-@".concat(i),l?"success":"failed",d);break}}}}splitMessage(t){if(t.length<Zh.MAX_MESSAGE_SIZE)return[t];let i=[],{remoteToken:n}=JSON.parse(t),r=ei(6,""),s=0,c=800,l=Math.ceil(t.length/c);for(;t.length>0;){s++;let d={id:r,index:s,total:l,payload:t.slice(0,c),token:"".concat(this.token,"_").concat(n)};JSON.stringify(d).length>Zh.MAX_MESSAGE_SIZE?c-=50:(i.push(d),t=t.slice(c))}return i.map(d=>JSON.stringify(d))}handleCheckToken(t,i){return t.token!==i?(C.debug("token changed, from ".concat(t.token," to ").concat(i)),this.reset(t.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{C.debug("token timeout, ".concat(i)),this.reset(t.uid)},j("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let t=await On(this.signal,Ui.CALL,void 0),i=await this.send(Ui.CALL,t);this.signal.emit(at.P2P_CONNECTION,i,!0)}async reset(t,i){let n=this.userMap.get(t);n&&(this.emit(bm.ABORT),this.signal.emit(Rt.ON_USER_OFFLINE,{uid:n.uid,reason:i7.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(C.debug("change local token from ".concat(i," to ").concat(i)),this.token=ei(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(bm.ABORT)}}L(Zh,"MAX_SIZE",1),L(Zh,"MAX_MESSAGE_SIZE",1024);class VH extends vi{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===si.CONNECTED?this.emit(at.WS_CONNECTED):t===si.RECONNECTING?this.emit(at.WS_RECONNECTING,this._websocketReconnectReason):t===si.CLOSED&&this.emit(at.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,i){super(),L(this,"_disconnectedReason",void 0),L(this,"_websocketReconnectReason",void 0),L(this,"_connectionState",si.CLOSED),L(this,"reconnectToken",void 0),L(this,"p2pToken",void 0),L(this,"websocket",void 0),L(this,"openConnectionTime",void 0),L(this,"clientId",void 0),L(this,"lastMsgTime",Date.now()),L(this,"uploadCache",[]),L(this,"uploadCacheInterval",void 0),L(this,"rttRolling",new VL(5)),L(this,"pingpongTimer",void 0),L(this,"pingpongTimeoutCount",0),L(this,"joinResponse",void 0),L(this,"multiIpOption",void 0),L(this,"initError",void 0),L(this,"spec",void 0),L(this,"store",void 0),L(this,"_external_signal",void 0),L(this,"onWebsocketMessage",n=>{if(n.data instanceof ArrayBuffer)return void this.emit(at.ON_BINARY_DATA,n.data);let r=JSON.parse(n.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){let s="res-@".concat(r._id);this.emit(s,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){switch(r._type){case Rt.ON_DATA_STREAM:return void this.handleDataStream(r._message);case Rt.MUTE_AUDIO:case Rt.MUTE_VIDEO:case Rt.ON_P2P_LOST:case Rt.ON_USER_ONLINE:return;case Rt.ON_USER_OFFLINE:let{uid:s}=r._message;return C.debug("[".concat(this.clientId,"] user-offline uid: ").concat(s)),void this._external_signal.reset(s)}if(this.emit(r._type,r._message),r._type===Rt.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===Rt.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(Gt.UID_BANNED);break;case 15:this.close(Gt.IP_BANNED);break;case 16:this.close(Gt.CHANNEL_BANNED)}if(r._type===Rt.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case Xe.ERR_LICENSE_MISSING:this.close(Gt.LICENSE_MISSING);break;case Xe.ERR_LICENSE_EXPIRED:this.close(Gt.LICENSE_EXPIRED);break;case Xe.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Gt.LICENSE_MINUTES_EXCEEDED);break;case Xe.ERR_LICENSE_PERIOD_INVALID:this.close(Gt.LICENSE_PERIOD_INVALID);break;case Xe.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Gt.LICENSE_MULTIPLE_SDK_SERVICE);break;case Xe.ERR_LICENSE_ILLEGAL:this.close(Gt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=i,this.websocket=new rI("gateway-".concat(this.clientId),this.spec.retryConfig,!0,j("JOIN_GATEWAY_USE_DUAL_DOMAIN"),j("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===si.CONNECTED&&this.reconnect("retry",In.OFFLINE)}),this.p2pToken=ei(6,""),this._external_signal=new Zh(this,this.p2pToken)}async request(t,i,n,r){let s=ei(6,""),c={_id:s,_type:t,_message:i},l=this.websocket.connectionID,d=()=>new Ie((D,O)=>{if(this.connectionState===si.CONNECTED)return D();let N=()=>{this.off(at.WS_CLOSED,k),D()},k=()=>{this.off(at.WS_CONNECTED,N),O(new de(M.WS_ABORT))};this.once(at.WS_CONNECTED,N),this.once(at.WS_CLOSED,k)});if(this.connectionState!==si.CONNECTING&&this.connectionState!==si.RECONNECTING||t===et.JOIN||t===et.REJOIN||await d(),this.websocket.sendMessage(c,!0),r)return;let h=new Ie((D,O)=>{let N=!1,k=(B,J)=>{N=!0,D({isSuccess:B==="success",message:J||{}}),this.off(at.WS_CLOSED,U),this.off(at.WS_RECONNECTING,U),this.emit(at.REQUEST_SUCCESS,t,i)};this.once("res-@".concat(s),k);let U=()=>{O(new de(M.WS_ABORT,"type: ".concat(t))),this.off(at.WS_CLOSED,U),this.off(at.WS_RECONNECTING,U),this.off("res-@".concat(s),k)};this.once(at.WS_CLOSED,U),this.once(at.WS_RECONNECTING,U),Sn(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||N||(C.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(at.REQUEST_TIMEOUT,t,i))})}),f=null;try{f=await h}catch(D){if(this.connectionState===si.CLOSED||t===et.LEAVE)throw new de(M.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?D.throw():t===et.JOIN||t===et.REJOIN?null:(await d(),await this.request(t,i))}if(f.isSuccess)return f.message;let E=Number(f.message.error_code||f.message.code),S=Kg(E),y=new de(M.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(f.message.error_str),{code:E,data:f.message,desc:S.desc});return S.action==="success"?f.message:(C.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(S.desc,", action: ").concat(S.action)),E===Xe.ERR_TOO_MANY_BROADCASTERS?((t===et.JOIN||t===et.REJOIN)&&(this.initError=y,this.close()),y.throw()):S.action==="failed"?y.throw():S.action==="quit"?(this.initError=y,this.close(),y.throw()):(E===Xe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,C.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",In.MULTI_IP)):this.reconnect(S.action,In.SERVER_ERROR),t===et.JOIN||t===et.REJOIN?null:await this.request(t,i)))}waitMessage(t,i){return new Ie(n=>{let r=s=>{(!i||i(s))&&(this.off(t,r),n(s))};this.on(t,r)})}uploadWRTCStats(t){if(!this.store.sessionId)return void C.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Wg.WRTC_STATS,i)}upload(t,i){let n={_type:t,_message:i};try{this.websocket.sendMessage(n)}catch{let r=j("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>r&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==si.CONNECTED)return;let s=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(s._type,s._message)},j("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,i){let n={_type:t,_message:i};this.websocket.sendMessage(n)}async sendExtensionMessage(t,i,n){return await this._external_signal.send(t,i,n)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ie((i,n)=>{this.once(at.WS_CONNECTED,()=>i(this.joinResponse)),this.once(at.WS_CLOSED,()=>n(this.initError||new de(M.WS_ABORT))),this.connectionState=si.CONNECTING,this.websocket.init(t).catch(n)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Gt.LEAVE,this.connectionState=si.CLOSED,C.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=ei(6,""),this._external_signal.clear(),this._external_signal=new Zh(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(at.ABORT_P2P_EXECUTION);let t=await On(this,at.REQUEST_JOIN_INFO),i=await this.request(et.JOIN,t);if(!i)return this.emit(at.REPORT_JOIN_GATEWAY,M.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(at.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=si.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,i)}async downgradeCodec(t){return!1}handleDataStream(t){try{var i;let n=Nh(t.payload),r=new TextDecoder().decode(n),s=JSON.parse(r);"total"in s&&"id"in s||Ce(i=Object.values(Ui)).call(i,s._type)?(s._uid=t.uid,this._external_signal.onMessage(s)):this.emit(Rt.ON_DATA_STREAM,t)}catch{this.emit(Rt.ON_DATA_STREAM,t)}}handleNotification(t){C.debug("[".concat(this.clientId,"] receive notification: "),t);let i=Kg(t.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Gt.UID_BANNED),void this.close()):void this.reconnect(i.action,In.SERVER_ERROR);C.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=j("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=t&&(C.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>j("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",In.TIMEOUT):this.request(et.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let n=Date.now()-i;this.rttRolling.add(n),j("REPORT_STATS")&&this.send(et.PING_BACK,{pingpongElapse:n})}).catch(n=>{})}handleWebsocketEvents(){this.websocket.on(ut.RECONNECT_CREATE_CONNECTION,t=>{this.emit(at.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(ut.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ut.CLOSED,()=>{this.connectionState=si.CLOSED}),this.websocket.on(ut.FAILED,()=>{this._disconnectedReason=Gt.NETWORK_ERROR,this.connectionState=si.CLOSED}),this.websocket.on(ut.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===si.CONNECTED?this.connectionState=si.RECONNECTING:this.connectionState=si.CONNECTING}),this.websocket.on(ut.WILL_RECONNECT,(t,i,n)=>{t!=="retry"?(C.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):C.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),n(t)}),this.websocket.on(ut.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(at.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof de&&t.code===M.UNEXPECTED_RESPONSE&&t.data.code===Xe.ERR_NO_AUTHORIZED)return C.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",In.SERVER_ERROR);C.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",In.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(ut.REQUEST_NEW_URLS,(t,i)=>{On(this,at.REQUEST_RECOVER,this.multiIpOption).then(t).catch(i)}),this.websocket.on(ut.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Rt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}let jH={name:"P2PChannel",create:function(e){let{store:t,statsCollector:i}=e;return new UH(t,i)},createSubmodule:function(e){let{store:t,spec:i}=e;return new VH(i,t)}};function l4(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function d4(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?l4(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l4(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}class BH{constructor(t){L(this,"sessionDesc",void 0),L(this,"localCapabilities",void 0),L(this,"rtpCapabilities",void 0),L(this,"candidates",void 0),L(this,"_originCandidates",void 0),L(this,"iceParameters",void 0),L(this,"dtlsParameters",void 0),L(this,"setup",void 0),L(this,"currentMidIndex",void 0),L(this,"cname",void 0),t=Ei(t);let{iceParameters:i,dtlsParameters:n,candidates:r,rtpCapabilities:s,setup:c,localCapabilities:l,sdkCodec:d,cname:h}=t,f=Br(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=s,this.candidates=r,this._originCandidates=Ei(r),this.iceParameters=i,this.dtlsParameters=n,this.setup=c,this.localCapabilities=l,this.cname=h;for(let E=0;E<f.mediaDescriptions.length;E++){let S=f.mediaDescriptions[E];if(S.attributes.iceUfrag=i.iceUfrag,S.attributes.icePwd=i.icePwd,S.attributes.fingerprints=n.fingerprints,S.attributes.candidates=r,S.attributes.setup=c,S.media.mediaType==="video"){S.media.fmts=s.videoCodecs.map(O=>O.payloadType.toString(10));let y=s.videoCodecs.filter(O=>{var N,k;return(N=O.rtpMap)===null||N===void 0?void 0:Ce(k=N.encodingName.toLowerCase()).call(k,d)}),D=s.videoCodecs.filter(O=>!Ce(y).call(y,O));S.attributes.payloads=[...y,...D],S.attributes.extmaps=s.videoExtensions}S.media.mediaType==="audio"&&(S.media.fmts=s.audioCodecs.map(y=>y.payloadType.toString(10)),S.attributes.payloads=s.audioCodecs,S.attributes.extmaps=s.audioExtensions),f.mediaDescriptions[E]=this.mungMediaDesc(S)}this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}toString(){return Bd(this.sessionDesc)}send(t,i,n){let{ssrcs:r,ssrcGroups:s}=Jg(i,this.cname),c=this.sessionDesc.mediaDescriptions.find(h=>t===ke.VIDEO?h.media.mediaType==="video":h.media.mediaType==="audio"),l=r[0].attributes.label,d=r[0].attributes.mslabel;return c.attributes.ssrcs=c.attributes.ssrcs.concat(r),c.attributes.ssrcGroups=c.attributes.ssrcGroups.concat(s),{id:l,mslabel:d}}batchSend(t){return t.map(i=>{let{kind:n,ssrcMsg:r}=i;return this.send(n,r,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(i=>{let n=[],r=[],s=[];i.attributes.ssrcs.forEach(c=>{Ce(t).call(t,c.attributes.label||"")?s.push(c):n.push(c)}),i.attributes.ssrcGroups.forEach(c=>{var l;Ce(l=s.map(d=>d.ssrcId)).call(l,c.ssrcIds[0])||r.push(c)}),i.attributes.ssrcs=n,i.attributes.ssrcGroups=r})}mute(t){let i=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===t);if(!i)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(t){let i=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===t);if(!i)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(t,i,n){t.forEach((r,s)=>{let c=r._mediaStreamTrack,l=this.sessionDesc.mediaDescriptions.findIndex(h=>h.attributes.mid===c.kind),d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],r);this.sessionDesc.mediaDescriptions[l]=d})}stopReceiving(t){}updateCandidates(t){let i=this._originCandidates.filter(r=>r.transport==="udp"),n=[];if(i.forEach(r=>{n.push(d4(d4({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),i.length!==0){switch(t){case Fn.TCP_RELAY:this.candidates=n;break;case Fn.UDP_TCP_RELAY:case Fn.RELAY:this.candidates=[...i,...n];break;default:this.candidates=i}for(let r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}}restartICE(t){t=Ei(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=t.iceUfrag,i.attributes.icePwd=t.icePwd})}predictReceivingMids(t){let i=[];for(let n=0;n<t;n++)i.push((this.currentMidIndex+n+1).toString(10));return i}mungRecvMediaDsec(t,i){let n=Ei(t);return Im(n,i),cI(n,i),n}updateRecvMedia(t,i){let n=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===t);if(n!==-1){let r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],i);this.sessionDesc.mediaDescriptions[n]=r}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,i,n){let r=this.sessionDesc.mediaDescriptions.find(c=>t===ke.VIDEO?c.attributes.mid==="video":c.attributes.mid==="audio");if(r){let c=r.attributes.ssrcs.find(l=>l.attributes.label===i);var s;c&&(c.attributes.label=n,(s=c.attributes.msid)===null||s===void 0||s.replace(i,n))}}mungMediaDesc(t){let i=Ei(t);return oI(i),(function(n){let r=n.attributes.extmaps.find(s=>Wy(s.extensionName));r&&n.attributes.extmaps.splice(n.attributes.extmaps.indexOf(r),1),n.attributes.payloads.forEach(s=>{let c=s.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&s.rtcpFeedbacks.splice(c,1)})})(i),i}getSSRC(t){for(let i of this.sessionDesc.mediaDescriptions)for(let n of i.attributes.ssrcs)if(n.attributes.label===t)return[n]}}var ti;function u4(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function NR(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?u4(Object(i),!0).forEach(function(n){L(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u4(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}let FH=(ti=class I0 extends bk{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var i;return Ce(i=Object.keys(jg)).call(i,t)}))]}constructor(t,i){super(t,i),L(this,"store",void 0),L(this,"peerConnection",void 0),L(this,"remoteSDP",void 0),L(this,"initialOffer",void 0),L(this,"statsFilter",void 0),L(this,"useRTX",!1),L(this,"localCapabilities",void 0),L(this,"localCandidateCount",0),L(this,"allCandidatesReceived",!1),L(this,"establishPromise",void 0),L(this,"mutex",void 0),this.store=i,this.mutex=new Vn("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(I0.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=_w(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,bi()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let i=Kd(t.sdp),n=Xg(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:j("FILTER_VIDEO_FEC"),filterAudioFec:j("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=n,this.initialOffer=t,NR(NR({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n},offerSDP:t.sdp})}catch(t){throw new de(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new BH(NR(NR({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));let i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(t,i){throw new de(M.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,i){var n=this;return Ka(function*(){let r=yield Dt(n.mutex.lock());try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let s=t.map(S=>n.peerConnection.addTrack(S._mediaStreamTrack)),c=yield Dt(n.peerConnection.createOffer()),l=Br(c.sdp),d=t.map(S=>{let y=S._mediaStreamTrack,D=l.mediaDescriptions.find(O=>O.attributes.mid===y.kind);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return(function(O,N,k){let U=O.attributes.ssrcs.filter(J=>J.attributes.label===N),B=O.attributes.ssrcGroups;if(U.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(B&&U.length>1){let J=B.find(K=>K.ssrcIds.indexOf(U[0].ssrcId)!==-1);return J?[{ssrcId:J.ssrcIds[0],rtx:k?J.ssrcIds[1]:void 0}]:[{ssrcId:U[0].ssrcId}]}return[{ssrcId:U[0].ssrcId}]})(D,y.id,n.useRTX)}),h;try{h=yield d}catch(S){throw s.forEach(y=>{wn()&&y.replaceTrack(null),n.peerConnection.removeTrack(y)}),S}let f=n.mungSendOfferSDP(c.sdp,t);n.remoteSDP.receive(t,i,h);let E=n.remoteSDP.toString();return yield Dt(n.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Dt(n.applySendEncodings(s,t)),yield Dt(n.peerConnection.setRemoteDescription({type:"answer",sdp:E})),t.map((S,y)=>{let D=S._mediaStreamTrack.id;return{localSSRC:d[y],id:D}})}catch(s){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{r()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let i=this.peerConnection.getSenders().filter(s=>{var c;return t.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(s=>{wn()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)});let n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(t);let r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(i){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(t,i,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{id:s,mslabel:c}=this.remoteSDP.send(t,i,r),l=new Ie((f,E)=>{let S=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(s)))},1e4),y=D=>{let O=wt();if((O.name==="Safari"&&Number(O.version)===11||Jn())&&D.track.id!==s&&D.streams[0].id===c){var N;let k=D.streams[0].getTracks()[0];return(N=this.remoteSDP)===null||N===void 0||N.updateTrackLabel(t,s,D.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(S),void f(k)}if(D.track.id===s)return this.peerConnection.removeEventListener("track",y),clearTimeout(S),void f(D.track)};this.peerConnection.addEventListener("track",y)}),d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});let h=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(h),{track:await l,id:s}}catch(s){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n)}catch(i){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getSenders().filter(n=>{var r;return t.indexOf(((r=n.track)===null||r===void 0?void 0:r.id)||"")!==-1});if(i.length!==t.length)throw new Error("sender' length doesn't match mids' length.");i.map(n=>{if(wn()&&n.track)n.track.enabled=!1;else{let r=n.getParameters();r.encodings.forEach(s=>s.active=!1),n.setParameters(r)}})}catch(i){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getSenders().filter(s=>{var c;return t.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async s=>{if(wn()&&s.track)s.track.enabled=!0;else{let c=s.getParameters();c.encodings.forEach(l=>l.active=!0),await s.setParameters(c)}});let n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n);let r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(i){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(t){var i=this;return Ka(function*(){let n=yield Dt(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let r=Lt().supportPCSetConfiguration;if(t===Fn.RELAY&&!r)return;if(r){let h=i.peerConnection.getConfiguration(),f=t===Fn.RELAY?"relay":"all";h.iceTransportPolicy!==f&&(C.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(h.iceTransportPolicy,"] to [").concat(f,"]")),h.iceTransportPolicy=f,i.peerConnection.setConfiguration(h))}t!==Fn.RELAY&&i.remoteSDP.updateCandidates(t);let s=yield Dt(i.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let c=Kd(s.sdp),{remoteIceParameters:l}=yield c.iceParameters;i.remoteSDP.restartICE(l);let d=i.remoteSDP.toString();yield Dt(i.peerConnection.setLocalDescription(s)),yield Dt(i.peerConnection.setRemoteDescription({type:"answer",sdp:d}))}catch(r){C.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),r)}finally{n()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);let s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new de(M.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(t,i){let n=this.peerConnection.getSenders().filter(r=>{var s;return((s=r.track)===null||s===void 0?void 0:s.id)===t});n.length===1&&await this.applySendEncodings(n,[i])}setStatsRemoteVideoIsReady(t,i){this.statsFilter.setVideoIsReady2(t,i)}async replaceTrack(t,i){let n=this.peerConnection.getSenders().find(r=>{var s;return((s=r.track)===null||s===void 0?void 0:s.id)===i});n&&await n.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,i){throw new de(M.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new de(M.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},j("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let i={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(xg(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...I0.turnServerConfigToIceServers(t.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...I0.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(n=>{n.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(t){let i=[];return t.forEach(n=>{n.security?n.tcpport&&i.push({username:n.username,credential:n.password,credentialType:"password",urls:"turns:".concat(n.turnServerURL,":").concat(n.tcpport,"?transport=tcp")}):(n.udpport&&i.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.udpport,"?transport=udp")}),n.tcpport&&i.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(t,i){var n;if(i||(i=this.peerConnection.getSenders().find(h=>{var f;return((f=h.track)===null||f===void 0?void 0:f.id)===t._mediaStreamTrack.id})),!i)return C.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Lt().supportSetRtpSenderParameters)return C.warn("Browser not support set rtp-sender parameters");let r={},s={};if(t instanceof oi)switch(t._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(j("DSCP_TYPE")&&fl()){var c;let h=j("DSCP_TYPE");Ce(c=["very-low","low","medium","high"]).call(c,h)&&(s.networkPriority=h)}let l=i.getParameters(),d=(n=l.encodings)===null||n===void 0?void 0:n[0];d&&Object.assign(d,s),Object.assign(l,r),C.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await i.setParameters(l)}async applySendEncodings(t,i){try{if(!Lt().supportSetRtpSenderParameters||t.length!==i.length)return;for(let n=0;n<t.length;n++){let r=t[n],s=i[n];r&&s&&await this.updateRtpSenderEncodings(s,r)}}catch{C.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,i){let n=Br(t);return i.forEach((r,s)=>{let c=r._mediaStreamTrack,l=n.mediaDescriptions.find(d=>d.attributes.mid===c.kind);l&&Im(l,r)}),Bd(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,i,n)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,t,i,n)},this.statsFilter.onSelectedLocalCandidateChanged=(t,i)=>{var n;(n=this.onSelectedLocalCandidateChanged)===null||n===void 0||n.call(this,t,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,i)=>{var n;(n=this.onSelectedRemoteCandidateChanged)===null||n===void 0||n.call(this,t,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let i=this.remoteSDP.batchSend(t).map((s,c)=>{let{id:l,mslabel:d}=s,{kind:h}=t[c];return new Ie((f,E)=>{let S=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(l)))},1e4),y=D=>{let O=wt();if(O.name==="Safari"&&Number(O.version)===11&&D.track.id!==l&&D.streams[0].id===d){var N;let k=D.streams[0].getTracks()[0];return(N=this.remoteSDP)===null||N===void 0||N.updateTrackLabel(h,l,D.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(S),void f({track:k,id:l})}if(D.track.id===l)return this.peerConnection.removeEventListener("track",y),clearTimeout(S),void f({track:D.track,id:l})};this.peerConnection.addEventListener("track",y)})}),n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await Ie.all(i)}catch(i){throw new de(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(t){return this.remoteSDP?this.remoteSDP.getSSRC(t)?.[0].ssrcId:void 0}setConfiguration(t){if(Lt().supportPCSetConfiguration){let i=I0.resolvePCConfiguration(t);this.peerConnection.setConfiguration(i)}}},Fe(ti.prototype,"connect",[ts],Object.getOwnPropertyDescriptor(ti.prototype,"connect"),ti.prototype),Fe(ti.prototype,"stopSending",[ts],Object.getOwnPropertyDescriptor(ti.prototype,"stopSending"),ti.prototype),Fe(ti.prototype,"receive",[ts],Object.getOwnPropertyDescriptor(ti.prototype,"receive"),ti.prototype),Fe(ti.prototype,"stopReceiving",[ts],Object.getOwnPropertyDescriptor(ti.prototype,"stopReceiving"),ti.prototype),Fe(ti.prototype,"muteRemote",[ts],Object.getOwnPropertyDescriptor(ti.prototype,"muteRemote"),ti.prototype),Fe(ti.prototype,"unmuteRemote",[ts],Object.getOwnPropertyDescriptor(ti.prototype,"unmuteRemote"),ti.prototype),Fe(ti.prototype,"muteLocal",[ts],Object.getOwnPropertyDescriptor(ti.prototype,"muteLocal"),ti.prototype),Fe(ti.prototype,"unmuteLocal",[ts],Object.getOwnPropertyDescriptor(ti.prototype,"unmuteLocal"),ti.prototype),Fe(ti.prototype,"close",[ts],Object.getOwnPropertyDescriptor(ti.prototype,"close"),ti.prototype),Fe(ti.prototype,"updateEncoderConfig",[ts],Object.getOwnPropertyDescriptor(ti.prototype,"updateEncoderConfig"),ti.prototype),Fe(ti.prototype,"updateSendParameters",[ts],Object.getOwnPropertyDescriptor(ti.prototype,"updateSendParameters"),ti.prototype),Fe(ti.prototype,"replaceTrack",[ts],Object.getOwnPropertyDescriptor(ti.prototype,"replaceTrack"),ti.prototype),Fe(ti.prototype,"getRemoteSSRC",[ts],Object.getOwnPropertyDescriptor(ti.prototype,"getRemoteSSRC"),ti.prototype),ti);function ts(e,t,i){let n=e[t];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let r=this.mutex,s=await r.lock("Locking from P2PConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await n.apply(this,l)}finally{s()}},i}let GH={name:"PlanBConnection",create:function(e){let{store:t,spec:i}=e;return new FH(i,t)}},HH={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Lt().supportWebRTCEncodedTransform)return void C.warning("browser not support audio encoded transform");if(wy.has(e)||!e.track)return;let i={track:e.track};if(pl()){if(!e.createEncodedStreams)return void C.warning("browser not support createEncodedStreams() API");let r=null;try{r=e.createEncodedStreams()}catch(c){return void C.error("create audio-encoded-streams error",c&&c.message)}let s=new TransformStream({transform(c,l){i.controller||(i.controller=l),e.track&&e.track.id!==i.track.id&&(C.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",n),i.track=e.track,i.track.addEventListener("ended",n));let d=t.metadata&&t.metadata();d?(function(h,f){let{chunk:E,controller:S}=f,y=Fd.METADATA;E.data=(function(D,O,N){let k=N.byteLength,U=k+Fw+ck,B=jw+Bw+U,J=new ArrayBuffer(D.byteLength+B),K=new DataView(J);K.setUint8(0,ok),K.setUint16(1,U),K.setUint8(3,O),K.setUint16(4,k);for(let ee=0;ee<k;ee++)K.setUint8(6+ee,N[ee]);let H=new Uint8Array(K.buffer);return H.set(new Uint8Array(D),B),H.buffer})(E.data,y,h),S.enqueue(E)})(d,{chunk:c,controller:l}):l.enqueue(c)}});r.readable.pipeThrough(s).pipeTo(r.writable)}else if(wn()){if(typeof RTCRtpScriptTransform>"u")return void C.warning("browser not support RTCRtpScriptTransform");let r=Ay(),s=new MessageChannel;await new Ie(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});let c=new RTCRtpScriptTransform(r,{name:"audio-metadata-tx",port:s.port2},[s.port2]);e.transform=c,await new Ie(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var d;if(l.data.transformed&&e.track&&((d=e.track)===null||d===void 0?void 0:d.id)!==i.track.id)C.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",n),i.track=e.track,i.track.addEventListener("ended",n);else if(l.data.getMetadata){let h=t.metadata&&t.metadata();h&&s.port1.postMessage({metadata:h})}},i.worker=r}function n(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",n)}let r=wy.get(e);if(r){wy.delete(e);try{var s,c;(s=r.controller)===null||s===void 0||s.terminate(),(c=r.worker)===null||c===void 0||c.terminate()}catch(l){C.warning(l&&l.message)}}}wy.set(e,i),e.track.addEventListener("ended",n)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Lt().supportWebRTCEncodedTransform)return void C.warning("browser not support audio encoded transform");if(Py.has(e))return;let i={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(pl()&&!Jn()){if(!e.createEncodedStreams)return void C.warning("browser not support createEncodedStreams() API");JA(kt.CHROME,87,116)||(t.enableTopn=!1);let r=null;try{r=e.createEncodedStreams()}catch(c){return void C.error("create audio-encoded-streams error",c&&c.message)}let s=new TransformStream({transform(c,l){i.controller||(i.controller=l),e.track&&e.track.id!==i.track.id&&(C.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",n),i.track=e.track,i.track.addEventListener("ended",n)),t.enableTopn?(function(d,h,f){var E;let S=Gw(new DataView(h.data));if(!S)return f.enqueue(h);let y=d.track.id;RF.set(y,d.track);let D=(E=S.tlv.find(J=>J.tag===Fd.AUDIO_LEVEL))===null||E===void 0?void 0:E.value,O=0;typeof D=="number"&&(O=127-D);let N=Math.round(Math.pow(10,O/60)-1),{selected:k,speaker:U}=(function(J,K){let H=Tm.get(J);if(H||(H=(function(ee){let ue=new dk;return Tm.set(ee,ue),ho||(ho=new TF(j("TOPN_SILENCE_THRESHOLD")||500),ho.on("ActiveSpeakerChanged",me=>{me!=null&&(Ny=me)})),ho.addSpeakers([ue]),ue})(J)),Tm.size<=uk)return{selected:!0,speaker:H};if(!ho)throw new Error("no active speaker detector");return ho.levelChanged(H.id,K),Uh=ho.loudest.map(ee=>ee.id),Ny&&!Ce(Uh).call(Uh,Ny)&&Uh.length>=uk&&Uh.pop(),{selected:Ce(Uh).call(Uh,H.id)||H.id===Ny,speaker:H}})(d,N),B=(function(J,K,H){let ee=po.get(J)||new yF(J,K);return ee.score=H,po.set(J,ee),(function(ue){if(Dy.set(ue,!0),!Ly)return void(Ly=Date.now());let me=Date.now();me-Ly>1e3&&(Dy.get(ue)?Dy.set(ue,!1):(hk(ue),Dy.delete(ue)),Ly=me)})(J),ee})(y,d.track,U.energyScore);B.addSample(k),B.active&&(h.data=S.frame.buffer,f.enqueue(h))})(e,c,l):t.enableMetadata||t.enablePts?(function(d,h,f,E){let S=new DataView(d.data),y=S.getUint8(0),D;if(128&y&&y!==71){let k=(function(U){if(U.byteLength<=0)return[];let B=[],J=0;for(;J<U.byteLength;){let H=(128&U.getUint8(J))>>7,ee=127&U.getUint8(J);if(!(H&&J+4<=U.byteLength)){J++;break}{let ue=U.getUint32(J,!1),me=(16776192&ue)>>10,ye=1023&ue;B.push({pt:ee,ts_offset:me,length:ye,data:new Uint8Array}),J+=4}}let K=U.byteLength-J;for(let H of B){if(H.length>K)return console.warn("Broken red payload"),[];H.length>0&&(H.data=new Uint8Array(U.buffer,U.byteOffset+J,H.length),J+=H.length,K-=H.length)}if(K>0){let H={pt:B.length>0?B[B.length-1].pt:0,ts_offset:0,length:K,data:new Uint8Array(U.buffer,U.byteOffset+J,K)};B.push(H)}return B})(S);if(k.length>0){let U=(function(B){let J=0;for(let ee=0;ee<B.length;ee++)J+=ee<B.length-1?4:1,J+=B[ee].length;let K=new Uint8Array(J),H=0;for(let ee=0;ee<B.length;ee++)if(ee<B.length-1){let ue=(2147483648|(127&B[ee].pt)<<24|(262143&B[ee].ts_offset)<<10|1023&B[ee].length)>>>0;K[H++]=ue>>24&255,K[H++]=ue>>16&255,K[H++]=ue>>8&255,K[H++]=255&ue}else K[H++]=127&B[ee].pt;for(let ee of B)K.set(ee.data,H),H+=ee.length;return K})(k.map(B=>{let J=new Uint8Array(B.length);J.set(B.data);let K=Gw(new DataView(J.buffer));return K!=null&&K.frame&&(B.data=K?.frame),D=K,B}));d.data=U.buffer}}else D=Gw(S),D&&(d.data=D.frame.buffer);if(h.enqueue(d),!D)return;let O=D.tlv.find(k=>k.tag===Fd.METADATA);O&&f&&O.value instanceof Uint8Array&&f(O.value);let N=D.tlv.find(k=>k.tag===Fd.AUDIO_64_BIT_PTS);N&&E&&N.value instanceof Uint8Array&&N.value.length==8&&E(new DataView(N.value.buffer).getBigUint64(0,!0))})(c,l,t.onMetadata,t.onPts):l.enqueue(c)}});r.readable.pipeThrough(s).pipeTo(r.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void C.warning("browser not support RTCRtpScriptTransform");let r=Ay(),s=new MessageChannel;await new Ie(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});let c=new RTCRtpScriptTransform(r,{name:"audio-metadata-rx",port:s.port2},[s.port2]);e.transform=c,await new Ie(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var d;l.data.transformed&&e.track&&((d=e.track)===null||d===void 0?void 0:d.id)!==i.track.id?(C.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",n),i.track=e.track,i.track.addEventListener("ended",n)):l.data.metadata&&i.onMetadata?i.onMetadata(l.data.metadata):l.data.pts&&i.onPts&&i.onPts(l.data.pts)},i.worker=r}function n(){e.track.removeEventListener("ended",n),(function(r){let s=Py.get(r);if(s){(function(d){let h=Tm.get(d);h&&(Tm.delete(d),ho&&(ho.removeSpeakers([h]),Tm.size===0&&(ho.destroy(),ho=null)))})(r),hk(r.track.id),Py.delete(r);try{var c,l;(c=s.controller)===null||c===void 0||c.terminate(),(l=s.worker)===null||l===void 0||l.terminate()}catch(d){C.warning(d&&d.message)}}})(e)}Py.set(e,i),e.track.addEventListener("ended",n)},interceptLocalVideoFrame:async function(e,t){if(!Lt().supportWebRTCEncodedTransform)return void C.warning("browser not support video encoded transform");if(xy.has(e)||!e.track)return;let i={track:e.track};if(pl()){if(!e.createEncodedStreams)return void C.warning("browser not support createEncodedStreams() API");let r=null;try{r=e.createEncodedStreams()}catch(l){return void C.error("create video-encoded-streams error",l&&l.message)}let s=[];t.on("sei-to-send",l=>{s.push(l)});let c=new TransformStream({transform(l,d){i.controller||(i.controller=d),e.track&&e.track.id!==i.track.id&&(C.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",n),i.track=e.track,i.track.addEventListener("ended",n));let h=mk(new Uint8Array(l.data)),f=s.shift();if(f){let E=(function(S,y,D){switch(D){case Kw:return(function(O,N){let k=fk(N),U=k.length,B=Math.floor(U/255),J=U%255,K=new Uint8Array(6+B+1+U+O.byteLength);K[0]=0,K[1]=0,K[2]=0,K[3]=1,K[4]=6,K[5]=101;let H=0;for(;H<B;)K[6+H]=255,H++;return K[6+H]=J,H++,K.set(k,6+H),K.set(new Uint8Array(O),6+H+U),K.buffer})(S,y);case Yw:return(function(O,N){let k=fk(N),U=k.length,B=Math.floor(U/255),J=U%255,K=new Uint8Array(7+B+1+U+1+O.byteLength);K[0]=0,K[1]=0,K[2]=0,K[3]=1,K[4]=78,K[5]=1,K[6]=101;let H=0;for(;H<B;)K[7+H]=255,H++;return K[7+H]=J,H++,K.set(k,7+H),H+=U,K[7+H]=128,H++,K.set(new Uint8Array(O),7+H),K.buffer})(S,y);default:return null}})(l.data,f,h);E&&(l.data=E)}d.enqueue(l)}});r.readable.pipeThrough(c).pipeTo(r.writable)}else{if(!wn())return;{if(typeof RTCRtpScriptTransform>"u")return void C.warning("browser not support RTCRtpScriptTransform");let r=Ay(),s=new MessageChannel;await new Ie(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});let c=new RTCRtpScriptTransform(r,{name:"sei-tx",port:s.port2},[s.port2]);e.transform=c,await new Ie(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),t.on("sei-to-send",l=>{s.port1.postMessage({sei:l})}),s.port1.onmessage=l=>{var d;l.data.transformed&&e.track&&((d=e.track)===null||d===void 0?void 0:d.id)!==i.track.id&&(C.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",n),i.track=e.track,i.track.addEventListener("ended",n))},i.worker=r}}function n(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",n)}let r=xy.get(e);if(r){xy.delete(e);try{var s,c;(s=r.controller)===null||s===void 0||s.terminate(),(c=r.worker)===null||c===void 0||c.terminate()}catch(l){C.warning(l&&l.message)}}}xy.set(e,i),e.track.addEventListener("ended",n)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Lt().supportWebRTCEncodedTransform)return void C.warning("browser not support video encoded transform");if(!e.track)return;if(Hg.has(e)){let r=Hg.get(e);return void(r&&(r.onSei=t.onSei))}let i={track:e.track,onSei:t.onSei};if(pl()){if(!e.createEncodedStreams)return void C.warning("browser not support createEncodedStreams() API");let r=null;try{r=e.createEncodedStreams()}catch(c){return void C.error("create video-encoded-streams error",c&&c.message)}let s=new TransformStream({transform(c,l){i.controller||(i.controller=l),e.track&&e.track.id!==i.track.id&&(C.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",n),i.track=e.track,i.track.addEventListener("ended",n));let d=(function(h,f){switch(f){case Kw:return(function(E){let S=new DataView(E.data),y=0;for(;y+4<E.data.byteLength;){if(S.getUint8(y+0)===0&&S.getUint8(y+1)===0&&S.getUint8(y+2)===0&&S.getUint8(y+3)===1&&S.getUint8(y+4)===6){let D=y+6,O=0,N=0;for(;(N=S.getUint8(D++))===255;)O+=255;O+=N;let k=pk(E.data,D,O);return new Uint8Array(k)}y++}return null})(h);case Yw:return(function(E){let S=new DataView(E.data),y=0;for(;y+5<E.data.byteLength;){if(S.getUint8(y+0)===0&&S.getUint8(y+1)===0&&S.getUint8(y+2)===0&&S.getUint8(y+3)===1&&S.getUint8(y+4)===78&&S.getUint8(y+5)===1&&S.getUint8(y+6)===101){let D=y+7,O=0,N=0;for(;(N=S.getUint8(D++))===255;)O+=255;O+=N;let k=pk(E.data,D,O);return new Uint8Array(k)}y++}return null})(h);default:return null}})(c,mk(new Uint8Array(c.data)));d&&i.onSei&&i.onSei(d),l.enqueue(c)}});r.readable.pipeThrough(s).pipeTo(r.writable)}else if(wn()){if(typeof RTCRtpScriptTransform>"u")return void C.warning("browser not support RTCRtpScriptTransform");let r=Ay(),s=new MessageChannel;await new Ie(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});let c=new RTCRtpScriptTransform(r,{name:"sei-rx",port:s.port2},[s.port2]);e.transform=c,await new Ie(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var d;l.data.transformed&&e.track&&((d=e.track)===null||d===void 0?void 0:d.id)!==i.track.id?(C.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",n),i.track=e.track,i.track.addEventListener("ended",n)):l.data.sei&&i.onSei&&i.onSei(l.data.sei)},i.worker=r}function n(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",n)}(function(r){let s=Hg.get(r);if(s){Hg.delete(r);try{var c,l;(c=s.controller)===null||c===void 0||c.terminate(),(l=s.worker)===null||l===void 0||l.terminate()}catch(d){C.warning(d&&d.message)}}})(e)}Hg.set(e,i),e.track.addEventListener("ended",n)}},WH={name:"InterceptFrame",create:()=>HH};Ew(),Kt("PROCESS_ID","process-".concat(ei(8,""),"-").concat(ei(4,""),"-").concat(ei(4,""),"-").concat(ei(4,""),"-").concat(ei(12,""))),(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void C.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),i=Date.now();C.debug("Loading global parameters from cache",t),Object.keys(t).forEach(n=>{if(Object.prototype.hasOwnProperty.call(pi,n)){let{value:r,expires:s}=t[n];if(s&&s<=i)return;uo[n]=r,pi[n]=r}})}catch(t){C.error("Error loading mutableParamsCache: ".concat(e),t.message)}})(),Array.isArray(uo.AREAS)&&uo.AREAS.length>0&&hI(uo.AREAS,!0);let h4=(e,t,i)=>{C.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Kt(e,t,i)};Xd(pH,!1),Xd(_H,!1),Xd(X7,!1),Xd(wH,!1),Xd(dH,!1),Xd(jH,!1),Xd(GH,!1),Xd(WH,!1);let Ki=(function(e){let t=new vi,i=e,n={getListeners:t.getListeners.bind(t),on:(r,s)=>((function(c,l){c===hc.SECURITY_POLICY_VIOLATION&&KU(l,!0)})(r,s),t.on.bind(t)(r,s)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return zU(zU({},i),n)})({__TRACK_LIST__:hm,VERSION:Ya,BUILD:vw,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:h4,getParameter:j,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection,i=await(async function(n){let r;return Lt().supportUnifiedPlan?(n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"}),r=(await n.createOffer()).sdp):r=(await n.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,r})(t);if(!i)return e;t.close(),t=null,e=(function(n){let r={video:[],audio:[]};return n.match(/ VP8/i)&&r.video.push("VP8"),n.match(/ VP9/i)&&r.video.push("VP9"),n.match(/ AV1/i)&&r.video.push("AV1"),n.match(/ H264/i)&&r.video.push("H264"),n.match(/ H265/i)&&r.video.push("H265"),n.match(/ opus/i)&&r.audio.push("OPUS"),n.match(/ PCMU/i)&&r.audio.push("PCMU"),n.match(/ PCMA/i)&&r.audio.push("PCMA"),n.match(/ G722/i)&&r.audio.push("G722"),r})(i)}catch(t){throw new te(M.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=He.reportApiInvoke(null,{name:Li.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:_i.TRACER}),t=!1;try{let s=window.RTCPeerConnection,c=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,l=window.WebSocket;t=!!(s&&c&&l),t&&iw()&&pL(75)&&new s().close()}catch(s){return C.error("check system requirement failed: ",s),!1}let i=!1,n=wt();n.name===kt.CHROME&&Number(n.version)>=58&&(oo.engine.name!=="WebKit"||(function(){let s=wt();if(ly()){if(s.os===on.MAC_OS)return!0;if(s.os===on.IOS){let c=oo.os.version&&oo.os.version.split(".");if(c&&Number(c[0])===14&&c[1]&&Number(c[1])>=3||c&&Number(c[0])>14)return!0}}return!1})())&&(i=!0),(n.name===kt.FIREFOX&&Number(n.version)>=56||n.name===kt.OPERA&&Number(n.version)>=45||n.name===kt.SAFARI&&Number(n.version)>=11||n.name==="WebKit"&&(Jn()||Cs())&&n.osVersion&&Number(n.osVersion.split(".")[0])>=11||SL()||wt().name===kt.QQ)&&(i=!0),C.debug("checkSystemRequirements, api:",t,"browser",i);let r=t&&i;return e.onSuccess(r),r},getDevices:function(e){return Aa.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Aa.getRecordingDevices(e)},getCameras:function(e){return Aa.getCamerasDevices(e)},getElectronScreenSources:pP,getPlaybackDevices:function(e){return Aa.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},i=ei(5,"client-"),n=He.reportApiInvoke(null,{id:i,name:Li.CREATE_CLIENT,options:[t],tag:_i.TRACER});try{(function(r){tn(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),tn(r.mode,"config.mode",["rtc","live","p2p"]),r.audioCodec!==void 0&&tn(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&gn(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&wL(r.turnServer),r.httpRetryConfig!==void 0&&AL(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&AL(r.websocketRetryConfig)})(t)}catch(r){throw n.onError(r),r}return(_L(16,0)||$A(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",C.debug("browser not support vp9, force use vp8")),Kt("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),n.onSuccess(),new J7(Ps(Ps({forceWaitGatewayResponse:!0},t),{},{role:Ce(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),i)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=j("CAMERA_CAPTURE_CONFIG"),i=ei(8,"track-cam-"),n=He.reportApiInvoke(null,{id:i,tag:_i.TRACER,name:Li.CREATE_CAM_VIDEO_TRACK,options:[ai({},e),t]});t&&(e.encoderConfig=t);let r=Cy(e),s=null;C.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{s=(await ba({video:r},i)).getVideoTracks()[0]||null}catch(l){throw n.onError(l),l}if(!s){let l=new de(M.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(l),l.throw(C)}if(e.optimizationMode&&Vw(i,s,e,ws(e.encoderConfig)),j("USE_STANDARD_BITRATE_DEFAULT")){let l=ws(e.encoderConfig);e.encoderConfig=l,delete l.bitrateMax,delete l.bitrateMin}let c=new by(s,e,r,e.scalabiltyMode?vy(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return n.onSuccess(c.getTrackId()),C.info("create camera video success, trackId:",i),c},createCustomVideoTrack:function(e){let t=ei(8,"track-cus-"),i=He.reportApiInvoke(null,{id:t,tag:_i.TRACER,name:Li.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});j("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);let n=new oi(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?vy(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[Zt.CUSTOM_TRACK]);return i.onSuccess(n.getTrackId()),C.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",i=typeof t=="object"?(function(S){return RP(S)})(t):void 0;i&&(t="auto");let n=ei(8,"track-scr-v-"),r=He.reportApiInvoke(null,{id:n,tag:_i.TRACER,name:Li.CREATE_SCREEN_VIDEO_TRACK,options:[ai({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let s=(function(S){let y={};S.screenSourceType&&(y.mediaSource=S.screenSourceType),S.extensionId&&pl()&&(y.extensionId=S.extensionId);let{displaySurface:D,selfBrowserSurface:O,surfaceSwitching:N,systemAudio:k,preferCurrentTab:U}=S;(nm(107)||ZA(107)||ew(93))&&(D&&(tn(D,"displaySurface",["browser","window","monitor"]),y.displaySurface=D),O?(tn(O,"selfBrowserSurface",["exclude","include"]),y.selfBrowserSurface=O):y.selfBrowserSurface="include",N&&(tn(N,"surfaceSwitching",["exclude","include"]),y.surfaceSwitching=N)),(nm(105)||ZA(105)||ew(91))&&k&&(tn(k,"systemAudio",["exclude","include"]),y.systemAudio=k),(nm(94)||ZA(94)||ew(80))&&U&&(y.preferCurrentTab=!0),S.electronScreenSourceId&&(y.sourceId=S.electronScreenSourceId);let B=S.encoderConfig?Aw(S.encoderConfig):null;return y.mandatory={chromeMediaSource:"desktop",maxWidth:B?B.width:void 0,maxHeight:B?B.height:void 0},B&&(B.frameRate&&(typeof B.frameRate=="number"?(y.mandatory.maxFrameRate=B.frameRate,y.mandatory.minFrameRate=B.frameRate):(y.mandatory.maxFrameRate=B.frameRate.max||B.frameRate.ideal||B.frameRate.exact||void 0,y.mandatory.minFrameRate=B.frameRate.min||B.frameRate.ideal||B.frameRate.exact||void 0),y.frameRate=B.frameRate),B.width&&(y.width=B.width),B.height&&(y.height=B.height)),y})(e),c=null,l=null,d=Lt();if(!d.supportShareAudio&&t==="enable"){let S=new de(M.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r.onError(S),S.throw(C)}C.info("start create screen video track with config",e,"withAudio",t,"trackId",n);let h=d.supportShareAudio&&t!=="disable";try{let S=await ba({screen:s,screenAudio:h?i||!0:void 0},n);c=S.getVideoTracks()[0]||null,l=S.getAudioTracks()[0]||null}catch(S){throw r.onError(S),S}if(!c){let S=new de(M.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(S),S.throw(C)}if(!l&&t==="enable"){c&&c.stop();let S=new de(M.SHARE_AUDIO_NOT_ALLOWED);return r.onError(S),S.throw(C)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(Vw(n,c,e,e.encoderConfig&&Aw(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let f=new oi(c,e.encoderConfig?Aw(e.encoderConfig):{},e.scalabiltyMode?vy(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n,[Zt.SCREEN_TRACK]);if(!l)return r.onSuccess(f.getTrackId()),C.info("create screen video track success","video:",f.getTrackId()),f;let E=new Oi(l,void 0,ei(8,"track-scr-a-"),!1);return r.onSuccess([f.getTrackId(),E.getTrackId()]),C.info("create screen video track success","video:",f.getTrackId(),"audio:",E.getTrackId()),[f,E]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=j("CAMERA_CAPTURE_CONFIG"),n=ei(8,"track-mic-"),r=ei(8,"track-cam-"),s=He.reportApiInvoke(null,{id:"".concat(n,"-").concat(r),tag:_i.TRACER,name:Li.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,i]});i&&(t.encoderConfig=i);let c=Cy(t),l=CP(e),d=null,h=null;C.info("start create camera video track(".concat(r,") and microphone audio track(").concat(n,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{let S=await ba({audio:l,video:c},"".concat(n,"-").concat(r));d=S.getAudioTracks()[0],h=S.getVideoTracks()[0]}catch(S){throw s.onError(S),S}if(!d||!h){let S=new de(M.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(S),S.throw(C)}if(t.optimizationMode&&Vw(r,h,t,ws(t.encoderConfig)),j("USE_STANDARD_BITRATE_DEFAULT")){let S=ws(t.encoderConfig);t.encoderConfig=S,delete S.bitrateMax,delete S.bitrateMin}let f=new Gg(d,e,l,n),E=new by(h,t,c,t.scalabiltyMode?vy(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r);return s.onSuccess([f.getTrackId(),E.getTrackId()]),C.info("create camera video track(".concat(r,") and microphone audio track(").concat(n,") success")),[f,E]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=ei(8,"track-mic-"),i=He.reportApiInvoke(null,{id:t,tag:_i.TRACER,name:Li.CREATE_MIC_AUDIO_TRACK,options:[e]}),n=CP(e),r=null;C.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{r=(await ba({audio:n},t)).getAudioTracks()[0]||null}catch(c){throw i.onError(c),c}if(!r){let c=new de(M.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(c),c.throw(C)}let s=new Gg(r,e,n,t);return i.onSuccess(s.getTrackId()),C.info("create microphone audio track success, trackId:",t),s},createCustomAudioTrack:function(e){let t=ei(8,"track-cus-"),i=He.reportApiInvoke(null,{id:t,tag:_i.TRACER,name:Li.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new Oi(e.mediaStreamTrack,e.encoderConfig?Ty(e.encoderConfig):{},t,!1);return C.info("create custom audio track success with config",e,"trackId",n.getTrackId()),i.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(e){var t;let{cacheOnlineFile:i,encoderConfig:n}=e,{source:r}=e,s={source:r instanceof AudioBuffer?"AudioBuffer":r instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":r,cacheOnlineFile:i,encoderConfig:n},c=ei(8,"track-buf-"),l=He.reportApiInvoke(null,{id:c,tag:_i.TRACER,name:Li.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(j("DISABLE_WEBAUDIO"))throw new de(M.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");C.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",c);let d=r;if(!(r instanceof AudioBuffer))try{r=await(async function(E,S){let y=null;if(typeof E=="string"){let O=dx.get(E);if(O)return C.debug("use cached audio resource: ",E),O;try{y=(await lo(()=>br.get(E,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(N){throw new de(M.FETCH_AUDIO_FILE_FAILED,N.toString())}}else y=await new Ie((O,N)=>{let k=new FileReader;k.onload=U=>{U.target?O(U.target.result):N(new de(M.READ_LOCAL_AUDIO_FILE_ERROR))},k.onerror=()=>{N(new de(M.READ_LOCAL_AUDIO_FILE_ERROR))},k.readAsArrayBuffer(E)});let D=await(function(O){let N=Em();return new Ie((k,U)=>{N.decodeAudioData(O,B=>{k(B)},B=>{U(new de(M.DECODE_AUDIO_FILE_FAILED,B.toString()))})})})(y);return typeof E=="string"&&S&&dx.set(E,D),D})(r,i)}catch(E){return l.onError(E),E.throw(C)}let h=new _F(r),f=new mF(d,h,n?Ty(n):{},c);return C.info("create buffer source audio track success, trackId:",c),l.onSuccess(f.getTrackId()),f},setAppType:function(e){if(C.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw C.debug("Invalid appType"),new te(M.INVALID_PARAMS,"invalid app type",e);Kt("APP_TYPE",Math.floor(e))},setLogLevel:function(e){C.setLogLevel(e)},enableLogUpload:function(){j("USE_NEW_LOG")?Kt("UPLOAD_LOG",!0):C.enableLogUpload()},disableLogUpload:function(){j("USE_NEW_LOG")?Kt("UPLOAD_LOG",!1):C.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new pM},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,i=He.reportApiInvoke(null,{tag:_i.TRACER,name:Li.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Oi||e instanceof vm)){let d=new te(M.INVALID_TRACK,"the parameter is not a audio track");return i.onError(d),d.throw()}t&&t<1e3&&(t=1e3);let n=e instanceof Oi?e.getTrackLabel():"remote_track",r=e.getVolumeLevel(),s=r,c=r,l=Date.now();return new Ie(d=>{let h=setInterval(()=>{let f=e.getVolumeLevel();s=f>s?f:s,c=f<c?f:c;let E=s-c>1e-4,S=Date.now()-l;if(E||S>t){clearInterval(h);let y=E,D={duration:S,deviceLabel:n,maxVolumeLevel:s,result:y};C.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(D))),i.onSuccess(D),d(y)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,i=He.reportApiInvoke(null,{tag:_i.TRACER,name:Li.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof oi||e instanceof Sm)){let E=new te(M.INVALID_TRACK,"the parameter is not a video track");return i.onError(E),E.throw()}t&&t<1e3&&(t=1e3);let n=e instanceof oi?e.getTrackLabel():"remote_track",r=e.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(wn()||ly())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([r]),s.play();let c=document.createElement("canvas");c.width=160,c.height=120;let l=0,d=0;try{let E=Date.now();l=await(function(S,y,D,O){let N,k=0,U=null;return new Ie((B,J)=>{function K(){k>O&&N&&(N(),B(k));let H=D.getContext("2d");if(!H){let me=new te(M.UNEXPECTED_ERROR,"can not get canvas 2d context.");return C.error(me.toString()),void J(me)}H.drawImage(S,0,0,160,120);let ee=H.getImageData(0,0,D.width,D.height),ue=Math.floor(ee.data.length/3);if(U){for(let me=0;me<ue;me+=3)if(ee.data[me]!==U[me])return k+=1,void(U=ee.data);U=ee.data}else U=ee.data}setTimeout(()=>{N&&(N(),B(k))},y),N=Dw(()=>{K()},30)})})(s,t,c,4),d=Date.now()-E}catch(E){throw i.onError(E),E}k7===kt.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;let h=l>4,f={duration:d,changedPicNum:l,deviceLabel:n,result:h};return C.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(f))),i.onSuccess(f),h},setArea:hI,audioElementPlayCenter:Ar,resumeAudioContext:function(){Ar.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){Q7.processExternalMediaAEC(e)},registerExtensions:function(e){let t=j("PLUGIN_INFO")||[];e.forEach(i=>{"name"in i&&!Ce(t).call(t,i.name)&&t.push(i.name);let n=i;n.__registered__=!0,n.logger.hookLog=C.extLog,n.reporter.hookApiInvoke=He.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach(r=>{n.parameters[r]=j(r)})}),h4("PLUGIN_INFO",t)},ChannelMediaRelayError:Rm,ChannelMediaRelayEvent:El,ChannelMediaRelayState:Gr,RemoteStreamFallbackType:cF,RemoteStreamType:oF,ConnectionDisconnectedReason:Gt,AudienceLatencyLevelType:VB,AREAS:Ut,preload:async function(e,t,i,n){return UM(e,t,i,n)}});return Object.defineProperties(Ki,{onAudioAutoplayFailed:{get:()=>wa.onAudioAutoplayFailed,set:e=>{wa.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>wa.onAutoplayFailed,set:e=>{wa.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Ki._onSecurityPolicyViolation,set(e){Ki._onSecurityPolicyViolation=e,KU(e)}},__CLIENT_LIST__:{get:()=>j("SHOW_GLOBAL_CLIENT_LIST")?Vh:[]}}),Aa.on(xh.CAMERA_DEVICE_CHANGED,e=>{C.info("camera device changed",JSON.stringify(e)),Ki.onCameraChanged&&Ki.onCameraChanged(e),Ki.safeEmit(hc.CAMERA_CHANGED,e)}),Aa.on(xh.RECORDING_DEVICE_CHANGED,e=>{C.info("microphone device changed",JSON.stringify(e)),Ki.onMicrophoneChanged&&Ki.onMicrophoneChanged(e),Ki.safeEmit(hc.MICROPHONE_CHANGED,e)}),Aa.on(xh.PLAYOUT_DEVICE_CHANGED,e=>{C.debug("playout device changed",JSON.stringify(e)),Ki.onPlaybackDeviceChanged&&Ki.onPlaybackDeviceChanged(e),Ki.safeEmit(hc.PLAYBACK_DEVICE_CHANGED,e)}),Ar.onAutoplayFailed=()=>{C.info("detect audio element autoplay failed"),wa.onAudioAutoplayFailed&&wa.onAudioAutoplayFailed()},Yt.on("autoplay-failed",()=>{C.info("detect webaudio autoplay failed"),wa.onAudioAutoplayFailed&&wa.onAudioAutoplayFailed(),Ki.safeEmit(hc.AUTOPLAY_FAILED)}),Yt.on(Tn.STATE_CHANGE,(e,t)=>{C.info("audio context state changed: ".concat(t," => ").concat(e)),Ki.onAudioContextStateChanged&&Ki.onAudioContextStateChanged(e,t),Ki.safeEmit(hc.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Bi.on(am.NETWORK_STATE_CHANGE,(e,t)=>{C.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=Ki),Ki})}),KV={};Hq(KV,{AgoraRTCProvider:()=>$q,AgoraRTCReactError:()=>oa,AgoraRTCScreenShareProvider:()=>tX,LocalAudioTrack:()=>JV,LocalUser:()=>RX,LocalVideoTrack:()=>$V,RemoteAudioTrack:()=>t9,RemoteUser:()=>CX,RemoteVideoTrack:()=>i9,TrackBoundary:()=>vX,VERSION:()=>wX,default:()=>n9,useAutoPlayAudioTrack:()=>J2,useAutoPlayVideoTrack:()=>X2,useClientEvent:()=>Zq,useConnectionState:()=>nX,useCurrentUID:()=>rX,useIsConnected:()=>Ym,useJoin:()=>aX,useLocalCameraTrack:()=>pX,useLocalMicrophoneTrack:()=>uX,useLocalScreenTrack:()=>gX,useNetworkQuality:()=>sX,usePublish:()=>cX,useRTCClient:()=>Co,useRTCScreenShareClient:()=>iX,useRemoteAudioTracks:()=>fX,useRemoteUserTrack:()=>P2,useRemoteUsers:()=>_X,useRemoteVideoTracks:()=>mX,useTrackEvent:()=>Qq,useVolumeLevel:()=>lX});var zq=rp(ap());function Yr(p,_,g){return p.on(_,g),()=>p.off(_,g)}function Kq(p){try{return p()}catch(_){console.error(_)}}function sp(p){return()=>p.forEach(Kq)}function Yq(p,_){let g=setInterval(p,_);return()=>clearInterval(g)}function $R(p,_){let g=setTimeout(p,_);return()=>clearTimeout(g)}function Y2(){let p,_,g;function v(){if(_){let V=_;_=void 0,V()}}async function R(){if(g){let V=g;g=void 0;try{await V()}catch(q){console.error(q)}}}async function w(V){p=!0,await R();try{g=await V()}catch(q){console.error(q)}p=!1,v()}async function x(){p=!0,await R(),p=!1,v()}function W(V){p?_=()=>w(V):w(V)}function P(){p?_=x:x()}return{run:W,dispose:P}}var eC=typeof document<"u"?ie.useLayoutEffect:ie.useEffect;function qq(p){return p!=null&&typeof p.then=="function"}function cu(){let p=ie.useRef(!1);return ie.useEffect(()=>(p.current=!1,()=>{p.current=!0}),[]),p}function Xq(){let p=cu();function _(g,v){return new Promise(async(R,w)=>{try{let x=await g;p.current||R(x)}catch(x){p.current?v&&v(x):w(x)}})}return ie.useCallback(_,[p])}function YV(p){let _=Xq(),[g,v]=ie.useState();return eC(()=>{qq(p)?_(p).then(v):v(p)},[p,_]),g}function op(p,_){let g=ie.useRef();ie.useEffect(()=>{let{run:v,dispose:R}=g.current||=Y2();return v(p),R},_)}function Jq(p,_){let g=p.split("."),v=_.split("."),R=Math.max(g.length,v.length);for(let w=0;w<R;w++){let x=parseInt(g[w]||"0"),W=parseInt(v[w]||"0");if(x>W)return 1;if(x<W)return-1}return 0}function Zq(p,_,g){let v=ie.useRef(g);eC(()=>{v.current=g},[g]),ie.useEffect(()=>{if(p)return Yr(p,_,(...R)=>{v.current&&v.current(...R)})},[_,p])}function Qq(p,_,g){let v=ie.useRef(g);eC(()=>{v.current=g},[g]),ie.useEffect(()=>{if(p)return Yr(p,_,(...R)=>{v.current&&v.current(...R)})},[_,p])}var qV=ie.createContext(null);function $q({client:p,children:_}){return A.jsx(qV.Provider,{value:p,children:_})}function eX(p){let _=ie.useContext(qV);return p||_}function Co(p){let _=eX(p);if(!_)throw new Error("Agora RTC client not found. Should be wrapped in <AgoraRTCProvider value={client} />");return _}var XV=ie.createContext(null);function tX({client:p,children:_}){return A.jsx(XV.Provider,{value:p,children:_})}function iX(p){let _=ie.useContext(XV);return p||_}function nX(p){let _=Co(p),[g,v]=ie.useState(_?_.connectionState:"DISCONNECTED");return ie.useEffect(()=>{if(_){v(_.connectionState);let R;return sp([Yr(_,"connection-state-change",w=>{R?.(),w==="CONNECTED"?R=$R(()=>v(w),0):v(w)}),()=>R?.()])}else v("DISCONNECTED")},[_]),g}function Ym(p){let _=Co(p),[g,v]=ie.useState(_?_.connectionState==="CONNECTED":!1);return ie.useEffect(()=>{if(_){v(_.connectionState==="CONNECTED");let R;return sp([Yr(_,"connection-state-change",w=>{R?.(),R=$R(()=>v(w==="CONNECTED"),0)}),()=>R?.()])}else v(!1)},[_]),g}function rX(p){let _=Co(p),[g,v]=ie.useState(_?.uid);return ie.useEffect(()=>{if(_)return Yr(_,"connection-state-change",R=>{if(R==="CONNECTED")return $R(()=>v(_.uid),0);R==="DISCONNECTED"&&v(void 0)})},[_]),g}var oa=class extends Error{rtcMethod;rtcError;name="AgoraRTCReactException";constructor(p,_){typeof _=="string"?super(_):super(_.message),this.rtcMethod=p,this.rtcError=_}log(p){console[p](this)}};function aX(p,_=!0,g){let v=Co(g),R=Ym(g),w=ie.useRef(),[x,W]=ie.useState(!1),[P,V]=ie.useState(0),[q,z]=ie.useState(null),ce=cu();return op(async()=>{if(ce.current||(z(null),V(0),W(!1)),_&&v){try{ce.current||W(!0);let{appid:ae,channel:ne,token:se,uid:Q}=typeof p=="function"?await p():p,oe=await v.join(ae,ne,se,Q);ce.current||V(oe)}catch(ae){console.error(ae),ce.current||z(new oa("IAgoraRTCClient.join",ae))}ce.current||W(!1);let Z=w.current||=Y2();return sp([()=>{Z.dispose()},()=>{Z.run(()=>v.unpublish(v.localTracks))},()=>{for(let ae of v.localTracks)ae.isPlaying&&ae.stop(),ae.close();Z.run(()=>v.leave())}])}},[_,g]),{data:P,isLoading:x,isConnected:R,error:q}}var U4=()=>({uplinkNetworkQuality:0,downlinkNetworkQuality:0,delay:0});function sX(p){let _=Co(p),[g,v]=ie.useState(U4);return ie.useEffect(()=>{if(_)return Yr(_,"network-quality",R=>v({uplinkNetworkQuality:R.uplinkNetworkQuality,downlinkNetworkQuality:R.downlinkNetworkQuality,delay:_.getRTCStats().RTT??0}));v(U4())},[_]),g}var oX=rp(ap());function cX(p,_=!0,g){let v=Co(g),R=Ym(g),w=ie.useRef([]),[x,W]=ie.useState(!1),[P,V]=ie.useState(null),q=cu();return op(async()=>{if(q.current||(W(!1),V(null)),!v||!R||!_)return;let z=p.filter(Boolean),ce=ne=>{let se=Jq(oX.default.VERSION,"4.18.2")>=0;return se||new oa("usePublish","please check your agora-rtc-sdk-ng version in package.json, it's recommend upgrade to >= 4.18.2").log("warn"),se?v.mode!=="live"||v.role!=="audience":!0},Z=ne=>w.current.some(se=>se&&se.getTrackId()===ne.getTrackId()),ae=ne=>ce()&&ne.enabled&&_&&!Z(ne);for(let ne=0;ne<z.length;ne++){let se=z[ne];if(se&&ae(se)){await v.unpublish(w.current.filter(Q=>Q?.trackMediaType===se.trackMediaType));try{q.current||W(!0),await v.publish(se)}catch(Q){console.error(Q),q.current||V(new oa("IAgoraRTCClient.publish",Q))}q.current||W(!1)}}w.current=z},[R,_,v,p]),{isLoading:x,error:P}}function lX(p){let[_,g]=ie.useState(0);return ie.useEffect(()=>{if(p)return Yq(()=>{g(p.getVolumeLevel())},1e3)},[p]),_}var dX=rp(ap());function uX(p=!0,_={ANS:!0,AEC:!0}){let[g,v]=ie.useState(null),[R,w]=ie.useState(!1),[x,W]=ie.useState(null),P=cu();return op(async()=>{if(P.current||(w(!1),W(null)),p&&!g){try{P.current||w(!0);let V=await dX.default.createMicrophoneAudioTrack(_);P.current||v(V)}catch(V){console.error(V),P.current||W(new oa("IAgoraRTC.createMicrophoneAudioTrack",V))}P.current||w(!1)}},[p]),{localMicrophoneTrack:g,isLoading:R,error:x}}var hX=rp(ap());function pX(p=!0,_){let[g,v]=ie.useState(null),[R,w]=ie.useState(!1),[x,W]=ie.useState(null),P=cu();return op(async()=>{if(P.current||(w(!1),W(null)),p&&!g){try{P.current||w(!0);let V=await hX.default.createCameraVideoTrack(_);P.current||v(V)}catch(V){console.error(V),P.current||W(new oa("IAgoraRTC.createCameraVideoTrack",V))}P.current||w(!1)}},[p]),{localCameraTrack:g,isLoading:R,error:x}}function fX(p,_){let g=Co(_),[v,R]=ie.useState([]),w=Ym(),x=ie.useRef([]),[W,P]=ie.useState(!1),[V,q]=ie.useState(null),z=cu();return op(async()=>{if(z.current||q(null),!Array.isArray(p)||!w)return;let ce=async ne=>{if(!ne.audioTrack&&p.some(({uid:se})=>ne.uid===se)){try{z.current||P(!0),await g.subscribe(ne,"audio")}catch(se){console.error(se),z.current||q(new oa("IAgoraRTCClient.subscribe",se))}ne.audioTrack&&!x.current.some(se=>se.getUserId()===ne.uid)&&x.current.push(ne.audioTrack),x.current=x.current.map(se=>ne.audioTrack&&se.getUserId()===ne.uid&&se.getTrackId()!==ne.audioTrack.getTrackId()?ne.audioTrack:se),z.current||(R([...x.current]),P(!1))}},Z=async ne=>{if(p.some(({uid:se})=>ne.uid===se)){z.current||(x.current=x.current.filter(se=>se.getUserId()!==ne.uid),R([...x.current]));try{z.current||P(!0),await g.unsubscribe(ne,"audio")}catch(se){console.error(se),z.current||q(new oa("IAgoraRTCClient.unsubscribe",se))}z.current||P(!1)}};p.map(ne=>{!ne.audioTrack&&ne.hasAudio&&ce(ne)});let ae=[];for(let ne=0;ne<x.current.length;ne++){let se=x.current[ne];if(!p.some(Q=>Q.uid===se.getUserId())){let Q=g.remoteUsers.find(oe=>oe.uid===se.getUserId());Q&&ae.push({user:Q,mediaType:"audio"}),x.current.splice(ne,1),ne--}}if(ae.length>0){try{z.current||P(!0),await g.massUnsubscribe(ae)}catch(ne){console.error(ne),z.current||q(new oa("IAgoraRTCClient.massUnsubscribe",ne))}z.current||(R(x.current.slice()),P(!1))}return sp([Yr(g,"user-published",(ne,se)=>{p.find(Q=>Q.uid===ne.uid)&&se==="audio"&&ce(ne)}),Yr(g,"user-unpublished",(ne,se)=>{p.find(Q=>Q.uid===ne.uid)&&se==="audio"&&Z(ne)})])},[w,g,p]),{audioTracks:v,isLoading:W,error:V}}function mX(p,_){let g=Co(_),[v,R]=ie.useState([]),w=Ym(),x=ie.useRef([]),[W,P]=ie.useState(!1),[V,q]=ie.useState(null),z=cu();return op(async()=>{if(z.current||q(null),!Array.isArray(p)||!w)return;let ce=async ne=>{if(!ne.videoTrack&&p.some(({uid:se})=>ne.uid===se)){try{z.current||P(!0),await g.subscribe(ne,"video")}catch(se){console.error(se),z.current||q(new oa("IAgoraRTCClient.subscribe",se))}ne.videoTrack&&!x.current.some(se=>se.getUserId()===ne.uid)&&x.current.push(ne.videoTrack),x.current=x.current.map(se=>ne.videoTrack&&se.getUserId()===ne.uid&&se.getTrackId()!==ne.videoTrack.getTrackId()?ne.videoTrack:se),z.current||(R([...x.current]),P(!1))}},Z=async ne=>{if(p.some(({uid:se})=>ne.uid===se)){z.current||(x.current=x.current.filter(se=>se.getUserId()!==ne.uid),R([...x.current]));try{z.current||P(!0),await g.unsubscribe(ne,"video")}catch(se){console.error(se),z.current||q(new oa("IAgoraRTCClient.unsubscribe",se))}z.current||P(!1)}};p.map(ne=>{!ne.videoTrack&&ne.hasVideo&&ce(ne)});let ae=[];for(let ne=0;ne<x.current.length;ne++){let se=x.current[ne];if(!p.some(Q=>Q.uid===se.getUserId())){let Q=g.remoteUsers.find(oe=>oe.uid===se.getUserId());Q&&ae.push({user:Q,mediaType:"video"}),x.current.splice(ne,1),ne--}}if(ae.length>0){try{z.current||P(!0),await g.massUnsubscribe(ae)}catch(ne){console.error(ne),z.current||q(new oa("IAgoraRTCClient.massUnsubscribe",ne))}z.current||(R(x.current.slice()),P(!1))}return sp([Yr(g,"user-published",(ne,se)=>{p.find(Q=>Q.uid===ne.uid)&&se==="video"&&ce(ne)}),Yr(g,"user-unpublished",(ne,se)=>{p.find(Q=>Q.uid===ne.uid)&&se==="video"&&Z(ne)})])},[w,g,p]),{videoTracks:v,isLoading:W,error:V}}function P2(p,_,g){let v=Co(g),R=_==="audio"?"audioTrack":"videoTrack",[w,x]=ie.useState(p&&p[R]),W=Ym(),P=ie.useRef(),[V,q]=ie.useState(!1),[z,ce]=ie.useState(null);return ie.useEffect(()=>{if(!p||!W)return;let Z=!1;Z||ce(null);let ae=_==="audio"?"hasAudio":"hasVideo",ne=p.uid,se=async(fe,Ue)=>{if(fe[R]&&v.remoteUsers.some(({uid:Ne})=>fe.uid===Ne))try{Z||q(!0),await v.unsubscribe(fe,Ue)}catch(Ne){Z||ce(new oa("IAgoraRTCClient.unsubscribe",Ne)),console.error(Ne)}Z||(x(void 0),q(!1))},Q=async(fe,Ue)=>{try{!fe[R]&&v.remoteUsers.some(({uid:Ne})=>fe.uid===Ne)&&(Z||q(!0),await v.subscribe(fe,Ue)),Z||x(fe[R])}catch(Ne){Z||ce(new oa("IAgoraRTCClient.subscribe",Ne)),console.error(Ne)}Z||q(!1)},oe=P.current||=Y2();return!p[R]&&p[ae]?oe.run(()=>Q(p,_)):x(p[R]),sp([()=>{Z=!0,oe.dispose()},Yr(v,"user-published",(fe,Ue)=>{fe.uid===ne&&Ue===_&&oe.run(()=>Q(fe,_))}),Yr(v,"user-unpublished",(fe,Ue)=>{fe.uid===ne&&Ue===_&&oe.run(()=>se(fe,_))})])},[W,v,p,_,R]),{track:w,isLoading:V,error:z}}function _X(p){let _=Co(p),[g,v]=ie.useState(_?_.remoteUsers:[]);return ie.useEffect(()=>{if(_){let R=()=>v(_.remoteUsers.slice());return sp([Yr(_,"user-joined",R),Yr(_,"user-left",R),Yr(_,"user-published",R),Yr(_,"user-unpublished",R)])}},[_]),g}var EX=rp(ap());function gX(p=!0,_,g){let[v,R]=ie.useState(null),[w,x]=ie.useState(!1),[W,P]=ie.useState(null),V=cu();return op(async()=>{if(V.current||(x(!1),P(null)),p&&!v){try{V.current||x(!0);let q=await EX.default.createScreenVideoTrack(_,g);V.current||R(q)}catch(q){console.error(q),V.current||P(new oa("IAgoraRTC.createScreenVideoTrack",q))}V.current||x(!1)}},[p]),{screenTrack:v,isLoading:w,error:W}}function SX(){let p=new Map,_=1500;return{onMount:g=>{let v=p.get(g);v&&(v(),p.delete(g))},onUnmount:g=>{let v=p.get(g);v&&v(),p.set(g,$R(()=>{g.isPlaying&&g.stop(),p.delete(g)},_))},dispose:()=>{for(let[g,v]of p)g.isPlaying&&g.stop(),v&&v();p.clear()}}}var q2=ie.createContext(void 0);function vX({children:p}){let[_]=ie.useState(SX);return ie.useEffect(()=>_.dispose,[_]),A.jsx(q2.Provider,{value:_,children:p})}function X2(p,_,g,v){let R=ie.useContext(q2);ie.useEffect(()=>{if(p)return v&&_?p.play(v,g||void 0):p.stop(),R?(R.onMount(p),()=>R.onUnmount(p)):()=>{p.isPlaying&&p.stop()}},[p,v,_,R,g])}function J2(p,_){let g=ie.useContext(q2);eC(()=>{if(p)return _?p.play():p.stop(),g?(g.onMount(p),()=>g.onUnmount(p)):()=>{p.isPlaying&&p.stop()}},[p,_,g])}function JV({track:p,play:_=!1,volume:g,disabled:v,muted:R,children:w}){let x=YV(p);return J2(x,_),ie.useEffect(()=>{x&&g!=null&&x.setVolume(g)},[x,g]),ie.useEffect(()=>{x&&v!=null&&x.setEnabled(!v).catch(console.warn)},[v,x]),ie.useEffect(()=>{x&&R!=null&&x.setMuted(R).catch(console.warn)},[R,x]),w?A.jsx(A.Fragment,{children:w}):null}var ZV={position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"#000"},QV={width:"100%",height:"100%"},Z2={position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",zIndex:2},tC=(p,_)=>ie.useMemo(()=>({...p,..._}),[p,_]);function $V({track:p,play:_,disabled:g,muted:v,style:R,videoPlayerConfig:w,...x}){let W=tC(QV,R),[P,V]=ie.useState(null),q=YV(p);return X2(q,_,w,P),ie.useEffect(()=>{q&&g!=null&&q.setEnabled(!g).catch(console.warn)},[g,q]),ie.useEffect(()=>{q&&v!=null&&q.setMuted(v).catch(console.warn)},[v,q]),A.jsx("div",{...x,ref:V,style:W})}var TX={width:"100%",height:"100%",background:"#1a1e21 center/cover no-repeat",filter:"blur(16px) brightness(0.4)"},yX={position:"absolute",top:"50%",left:"50%",maxWidth:"50%",maxHeight:"50%",aspectRatio:"1",transform:"translate(-50%, -50%)",borderRadius:"50%",overflow:"hidden",objectFit:"cover"};function e9({cover:p}){return A.jsx("div",{style:Z2,children:typeof p=="string"?A.jsxs(A.Fragment,{children:[A.jsx("div",{style:{...TX,backgroundImage:`url(${p})`}}),A.jsx("img",{src:p,style:yX})]}):p()})}function RX({micOn:p,cameraOn:_,audioTrack:g,videoTrack:v,playAudio:R,playVideo:w,volume:x,cover:W,children:P,style:V,...q}){let z=tC(ZV,V);return w=w??!!_,R=R??!!p,A.jsxs("div",{...q,style:z,children:[A.jsx($V,{disabled:!_,play:w,track:v}),A.jsx(JV,{disabled:!p,play:R,track:g,volume:x}),W&&!_&&A.jsx(e9,{cover:W}),A.jsx("div",{style:Z2,children:P})]})}function t9({track:p,play:_=!1,playbackDeviceId:g,volume:v,children:R}){return J2(p,_),ie.useEffect(()=>{p&&g!=null&&p.setPlaybackDevice(g).catch(console.warn)},[p,g]),ie.useEffect(()=>{p&&v!=null&&p.setVolume(v)},[p,v]),R?A.jsx(A.Fragment,{children:R}):null}function i9({track:p,play:_,style:g,videoPlayerConfig:v,...R}){let w=tC(QV,g),[x,W]=ie.useState(null);return X2(p,_,v,x),A.jsx("div",{...R,ref:W,style:w})}function CX({user:p,playVideo:_,playAudio:g,playbackDeviceId:v,volume:R,cover:w,style:x,children:W,videoPlayerConfig:P,...V}){let q=tC(ZV,x),{track:z}=P2(p,"video"),{track:ce}=P2(p,"audio");return _=_??p?.hasVideo,g=g??p?.hasAudio,A.jsxs("div",{...V,style:q,children:[A.jsx(i9,{play:_,track:z,videoPlayerConfig:P}),A.jsx(t9,{play:g,playbackDeviceId:v,track:ce,volume:R}),w&&!_&&A.jsx(e9,{cover:w}),A.jsx("div",{style:Z2,children:W})]})}var bX=rp(ap()),AX=class{appType=1001;constructor(){bX.default.setAppType(this.appType)}};new AX;var wX="2.5.0";Wq(KV,rp(ap()));var n9=zq.default;const IX={WARNING:2};n9.setLogLevel(IX.WARNING);tW.createRoot(document.getElementById("root")).render(A.jsx(ie.StrictMode,{children:A.jsx(Mq,{})}));
