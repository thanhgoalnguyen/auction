(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))S(b);new MutationObserver(b=>{for(const I of b)if(I.type==="childList")for(const x of I.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&S(x)}).observe(document,{childList:!0,subtree:!0});function T(b){const I={};return b.integrity&&(I.integrity=b.integrity),b.referrerPolicy&&(I.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?I.credentials="include":b.crossOrigin==="anonymous"?I.credentials="omit":I.credentials="same-origin",I}function S(b){if(b.ep)return;b.ep=!0;const I=T(b);fetch(b.href,I)}})();function b7(m){return m&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m}var JI={exports:{}},mS={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZV;function A7(){if(ZV)return mS;ZV=1;var m=Symbol.for("react.transitional.element"),g=Symbol.for("react.fragment");function T(S,b,I){var x=null;if(I!==void 0&&(x=""+I),b.key!==void 0&&(x=""+b.key),"key"in b){I={};for(var z in b)z!=="key"&&(I[z]=b[z])}else I=b;return b=I.ref,{$$typeof:m,type:S,key:x,ref:b!==void 0?b:null,props:I}}return mS.Fragment=g,mS.jsx=T,mS.jsxs=T,mS}var QV;function w7(){return QV||(QV=1,JI.exports=A7()),JI.exports}var J=w7(),ZI={exports:{}},$t={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $V;function I7(){if($V)return $t;$V=1;var m=Symbol.for("react.transitional.element"),g=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),I=Symbol.for("react.consumer"),x=Symbol.for("react.context"),z=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),V=Symbol.for("react.memo"),q=Symbol.for("react.lazy"),X=Symbol.iterator;function se(ie){return ie===null||typeof ie!="object"?null:(ie=X&&ie[X]||ie["@@iterator"],typeof ie=="function"?ie:null)}var re={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ue=Object.assign,ae={};function oe(ie,je,$e){this.props=ie,this.context=je,this.refs=ae,this.updater=$e||re}oe.prototype.isReactComponent={},oe.prototype.setState=function(ie,je){if(typeof ie!="object"&&typeof ie!="function"&&ie!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ie,je,"setState")},oe.prototype.forceUpdate=function(ie){this.updater.enqueueForceUpdate(this,ie,"forceUpdate")};function Ae(){}Ae.prototype=oe.prototype;function be(ie,je,$e){this.props=ie,this.context=je,this.refs=ae,this.updater=$e||re}var Oe=be.prototype=new Ae;Oe.constructor=be,ue(Oe,oe.prototype),Oe.isPureReactComponent=!0;var Xe=Array.isArray,Ue={H:null,A:null,T:null,S:null,V:null},gt=Object.prototype.hasOwnProperty;function it(ie,je,$e,et,ft,_i){return $e=_i.ref,{$$typeof:m,type:ie,key:je,ref:$e!==void 0?$e:null,props:_i}}function Ge(ie,je){return it(ie.type,je,void 0,void 0,void 0,ie.props)}function kt(ie){return typeof ie=="object"&&ie!==null&&ie.$$typeof===m}function rt(ie){var je={"=":"=0",":":"=2"};return"$"+ie.replace(/[=:]/g,function($e){return je[$e]})}var Ze=/\/+/g;function Qe(ie,je){return typeof ie=="object"&&ie!==null&&ie.key!=null?rt(""+ie.key):je.toString(36)}function Di(){}function ii(ie){switch(ie.status){case"fulfilled":return ie.value;case"rejected":throw ie.reason;default:switch(typeof ie.status=="string"?ie.then(Di,Di):(ie.status="pending",ie.then(function(je){ie.status==="pending"&&(ie.status="fulfilled",ie.value=je)},function(je){ie.status==="pending"&&(ie.status="rejected",ie.reason=je)})),ie.status){case"fulfilled":return ie.value;case"rejected":throw ie.reason}}throw ie}function Pi(ie,je,$e,et,ft){var _i=typeof ie;(_i==="undefined"||_i==="boolean")&&(ie=null);var Ut=!1;if(ie===null)Ut=!0;else switch(_i){case"bigint":case"string":case"number":Ut=!0;break;case"object":switch(ie.$$typeof){case m:case g:Ut=!0;break;case q:return Ut=ie._init,Pi(Ut(ie._payload),je,$e,et,ft)}}if(Ut)return ft=ft(ie),Ut=et===""?"."+Qe(ie,0):et,Xe(ft)?($e="",Ut!=null&&($e=Ut.replace(Ze,"$&/")+"/"),Pi(ft,je,$e,"",function(Aa){return Aa})):ft!=null&&(kt(ft)&&(ft=Ge(ft,$e+(ft.key==null||ie&&ie.key===ft.key?"":(""+ft.key).replace(Ze,"$&/")+"/")+Ut)),je.push(ft)),1;Ut=0;var fn=et===""?".":et+":";if(Xe(ie))for(var Qi=0;Qi<ie.length;Qi++)et=ie[Qi],_i=fn+Qe(et,Qi),Ut+=Pi(et,je,$e,_i,ft);else if(Qi=se(ie),typeof Qi=="function")for(ie=Qi.call(ie),Qi=0;!(et=ie.next()).done;)et=et.value,_i=fn+Qe(et,Qi++),Ut+=Pi(et,je,$e,_i,ft);else if(_i==="object"){if(typeof ie.then=="function")return Pi(ii(ie),je,$e,et,ft);throw je=String(ie),Error("Objects are not valid as a React child (found: "+(je==="[object Object]"?"object with keys {"+Object.keys(ie).join(", ")+"}":je)+"). If you meant to render a collection of children, use an array instead.")}return Ut}function Ne(ie,je,$e){if(ie==null)return ie;var et=[],ft=0;return Pi(ie,et,"","",function(_i){return je.call($e,_i,ft++)}),et}function We(ie){if(ie._status===-1){var je=ie._result;je=je(),je.then(function($e){(ie._status===0||ie._status===-1)&&(ie._status=1,ie._result=$e)},function($e){(ie._status===0||ie._status===-1)&&(ie._status=2,ie._result=$e)}),ie._status===-1&&(ie._status=0,ie._result=je)}if(ie._status===1)return ie._result.default;throw ie._result}var He=typeof reportError=="function"?reportError:function(ie){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var je=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof ie=="object"&&ie!==null&&typeof ie.message=="string"?String(ie.message):String(ie),error:ie});if(!window.dispatchEvent(je))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",ie);return}console.error(ie)};function St(){}return $t.Children={map:Ne,forEach:function(ie,je,$e){Ne(ie,function(){je.apply(this,arguments)},$e)},count:function(ie){var je=0;return Ne(ie,function(){je++}),je},toArray:function(ie){return Ne(ie,function(je){return je})||[]},only:function(ie){if(!kt(ie))throw Error("React.Children.only expected to receive a single React element child.");return ie}},$t.Component=oe,$t.Fragment=T,$t.Profiler=b,$t.PureComponent=be,$t.StrictMode=S,$t.Suspense=P,$t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ue,$t.__COMPILER_RUNTIME={__proto__:null,c:function(ie){return Ue.H.useMemoCache(ie)}},$t.cache=function(ie){return function(){return ie.apply(null,arguments)}},$t.cloneElement=function(ie,je,$e){if(ie==null)throw Error("The argument must be a React element, but you passed "+ie+".");var et=ue({},ie.props),ft=ie.key,_i=void 0;if(je!=null)for(Ut in je.ref!==void 0&&(_i=void 0),je.key!==void 0&&(ft=""+je.key),je)!gt.call(je,Ut)||Ut==="key"||Ut==="__self"||Ut==="__source"||Ut==="ref"&&je.ref===void 0||(et[Ut]=je[Ut]);var Ut=arguments.length-2;if(Ut===1)et.children=$e;else if(1<Ut){for(var fn=Array(Ut),Qi=0;Qi<Ut;Qi++)fn[Qi]=arguments[Qi+2];et.children=fn}return it(ie.type,ft,void 0,void 0,_i,et)},$t.createContext=function(ie){return ie={$$typeof:x,_currentValue:ie,_currentValue2:ie,_threadCount:0,Provider:null,Consumer:null},ie.Provider=ie,ie.Consumer={$$typeof:I,_context:ie},ie},$t.createElement=function(ie,je,$e){var et,ft={},_i=null;if(je!=null)for(et in je.key!==void 0&&(_i=""+je.key),je)gt.call(je,et)&&et!=="key"&&et!=="__self"&&et!=="__source"&&(ft[et]=je[et]);var Ut=arguments.length-2;if(Ut===1)ft.children=$e;else if(1<Ut){for(var fn=Array(Ut),Qi=0;Qi<Ut;Qi++)fn[Qi]=arguments[Qi+2];ft.children=fn}if(ie&&ie.defaultProps)for(et in Ut=ie.defaultProps,Ut)ft[et]===void 0&&(ft[et]=Ut[et]);return it(ie,_i,void 0,void 0,null,ft)},$t.createRef=function(){return{current:null}},$t.forwardRef=function(ie){return{$$typeof:z,render:ie}},$t.isValidElement=kt,$t.lazy=function(ie){return{$$typeof:q,_payload:{_status:-1,_result:ie},_init:We}},$t.memo=function(ie,je){return{$$typeof:V,type:ie,compare:je===void 0?null:je}},$t.startTransition=function(ie){var je=Ue.T,$e={};Ue.T=$e;try{var et=ie(),ft=Ue.S;ft!==null&&ft($e,et),typeof et=="object"&&et!==null&&typeof et.then=="function"&&et.then(St,He)}catch(_i){He(_i)}finally{Ue.T=je}},$t.unstable_useCacheRefresh=function(){return Ue.H.useCacheRefresh()},$t.use=function(ie){return Ue.H.use(ie)},$t.useActionState=function(ie,je,$e){return Ue.H.useActionState(ie,je,$e)},$t.useCallback=function(ie,je){return Ue.H.useCallback(ie,je)},$t.useContext=function(ie){return Ue.H.useContext(ie)},$t.useDebugValue=function(){},$t.useDeferredValue=function(ie,je){return Ue.H.useDeferredValue(ie,je)},$t.useEffect=function(ie,je,$e){var et=Ue.H;if(typeof $e=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return et.useEffect(ie,je)},$t.useId=function(){return Ue.H.useId()},$t.useImperativeHandle=function(ie,je,$e){return Ue.H.useImperativeHandle(ie,je,$e)},$t.useInsertionEffect=function(ie,je){return Ue.H.useInsertionEffect(ie,je)},$t.useLayoutEffect=function(ie,je){return Ue.H.useLayoutEffect(ie,je)},$t.useMemo=function(ie,je){return Ue.H.useMemo(ie,je)},$t.useOptimistic=function(ie,je){return Ue.H.useOptimistic(ie,je)},$t.useReducer=function(ie,je,$e){return Ue.H.useReducer(ie,je,$e)},$t.useRef=function(ie){return Ue.H.useRef(ie)},$t.useState=function(ie){return Ue.H.useState(ie)},$t.useSyncExternalStore=function(ie,je,$e){return Ue.H.useSyncExternalStore(ie,je,$e)},$t.useTransition=function(){return Ue.H.useTransition()},$t.version="19.1.1",$t}var e3;function gO(){return e3||(e3=1,ZI.exports=I7()),ZI.exports}var te=gO();const rn=b7(te);var QI={exports:{}},_S={},$I={exports:{}},eO={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var t3;function O7(){return t3||(t3=1,(function(m){function g(Ne,We){var He=Ne.length;Ne.push(We);e:for(;0<He;){var St=He-1>>>1,ie=Ne[St];if(0<b(ie,We))Ne[St]=We,Ne[He]=ie,He=St;else break e}}function T(Ne){return Ne.length===0?null:Ne[0]}function S(Ne){if(Ne.length===0)return null;var We=Ne[0],He=Ne.pop();if(He!==We){Ne[0]=He;e:for(var St=0,ie=Ne.length,je=ie>>>1;St<je;){var $e=2*(St+1)-1,et=Ne[$e],ft=$e+1,_i=Ne[ft];if(0>b(et,He))ft<ie&&0>b(_i,et)?(Ne[St]=_i,Ne[ft]=He,St=ft):(Ne[St]=et,Ne[$e]=He,St=$e);else if(ft<ie&&0>b(_i,He))Ne[St]=_i,Ne[ft]=He,St=ft;else break e}}return We}function b(Ne,We){var He=Ne.sortIndex-We.sortIndex;return He!==0?He:Ne.id-We.id}if(m.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var I=performance;m.unstable_now=function(){return I.now()}}else{var x=Date,z=x.now();m.unstable_now=function(){return x.now()-z}}var P=[],V=[],q=1,X=null,se=3,re=!1,ue=!1,ae=!1,oe=!1,Ae=typeof setTimeout=="function"?setTimeout:null,be=typeof clearTimeout=="function"?clearTimeout:null,Oe=typeof setImmediate<"u"?setImmediate:null;function Xe(Ne){for(var We=T(V);We!==null;){if(We.callback===null)S(V);else if(We.startTime<=Ne)S(V),We.sortIndex=We.expirationTime,g(P,We);else break;We=T(V)}}function Ue(Ne){if(ae=!1,Xe(Ne),!ue)if(T(P)!==null)ue=!0,gt||(gt=!0,Qe());else{var We=T(V);We!==null&&Pi(Ue,We.startTime-Ne)}}var gt=!1,it=-1,Ge=5,kt=-1;function rt(){return oe?!0:!(m.unstable_now()-kt<Ge)}function Ze(){if(oe=!1,gt){var Ne=m.unstable_now();kt=Ne;var We=!0;try{e:{ue=!1,ae&&(ae=!1,be(it),it=-1),re=!0;var He=se;try{t:{for(Xe(Ne),X=T(P);X!==null&&!(X.expirationTime>Ne&&rt());){var St=X.callback;if(typeof St=="function"){X.callback=null,se=X.priorityLevel;var ie=St(X.expirationTime<=Ne);if(Ne=m.unstable_now(),typeof ie=="function"){X.callback=ie,Xe(Ne),We=!0;break t}X===T(P)&&S(P),Xe(Ne)}else S(P);X=T(P)}if(X!==null)We=!0;else{var je=T(V);je!==null&&Pi(Ue,je.startTime-Ne),We=!1}}break e}finally{X=null,se=He,re=!1}We=void 0}}finally{We?Qe():gt=!1}}}var Qe;if(typeof Oe=="function")Qe=function(){Oe(Ze)};else if(typeof MessageChannel<"u"){var Di=new MessageChannel,ii=Di.port2;Di.port1.onmessage=Ze,Qe=function(){ii.postMessage(null)}}else Qe=function(){Ae(Ze,0)};function Pi(Ne,We){it=Ae(function(){Ne(m.unstable_now())},We)}m.unstable_IdlePriority=5,m.unstable_ImmediatePriority=1,m.unstable_LowPriority=4,m.unstable_NormalPriority=3,m.unstable_Profiling=null,m.unstable_UserBlockingPriority=2,m.unstable_cancelCallback=function(Ne){Ne.callback=null},m.unstable_forceFrameRate=function(Ne){0>Ne||125<Ne?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ge=0<Ne?Math.floor(1e3/Ne):5},m.unstable_getCurrentPriorityLevel=function(){return se},m.unstable_next=function(Ne){switch(se){case 1:case 2:case 3:var We=3;break;default:We=se}var He=se;se=We;try{return Ne()}finally{se=He}},m.unstable_requestPaint=function(){oe=!0},m.unstable_runWithPriority=function(Ne,We){switch(Ne){case 1:case 2:case 3:case 4:case 5:break;default:Ne=3}var He=se;se=Ne;try{return We()}finally{se=He}},m.unstable_scheduleCallback=function(Ne,We,He){var St=m.unstable_now();switch(typeof He=="object"&&He!==null?(He=He.delay,He=typeof He=="number"&&0<He?St+He:St):He=St,Ne){case 1:var ie=-1;break;case 2:ie=250;break;case 5:ie=1073741823;break;case 4:ie=1e4;break;default:ie=5e3}return ie=He+ie,Ne={id:q++,callback:We,priorityLevel:Ne,startTime:He,expirationTime:ie,sortIndex:-1},He>St?(Ne.sortIndex=He,g(V,Ne),T(P)===null&&Ne===T(V)&&(ae?(be(it),it=-1):ae=!0,Pi(Ue,He-St))):(Ne.sortIndex=ie,g(P,Ne),ue||re||(ue=!0,gt||(gt=!0,Qe()))),Ne},m.unstable_shouldYield=rt,m.unstable_wrapCallback=function(Ne){var We=se;return function(){var He=se;se=We;try{return Ne.apply(this,arguments)}finally{se=He}}}})(eO)),eO}var i3;function N7(){return i3||(i3=1,$I.exports=O7()),$I.exports}var tO={exports:{}},jn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r3;function D7(){if(r3)return jn;r3=1;var m=gO();function g(P){var V="https://react.dev/errors/"+P;if(1<arguments.length){V+="?args[]="+encodeURIComponent(arguments[1]);for(var q=2;q<arguments.length;q++)V+="&args[]="+encodeURIComponent(arguments[q])}return"Minified React error #"+P+"; visit "+V+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function T(){}var S={d:{f:T,r:function(){throw Error(g(522))},D:T,C:T,L:T,m:T,X:T,S:T,M:T},p:0,findDOMNode:null},b=Symbol.for("react.portal");function I(P,V,q){var X=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:b,key:X==null?null:""+X,children:P,containerInfo:V,implementation:q}}var x=m.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function z(P,V){if(P==="font")return"";if(typeof V=="string")return V==="use-credentials"?V:""}return jn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,jn.createPortal=function(P,V){var q=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!V||V.nodeType!==1&&V.nodeType!==9&&V.nodeType!==11)throw Error(g(299));return I(P,V,null,q)},jn.flushSync=function(P){var V=x.T,q=S.p;try{if(x.T=null,S.p=2,P)return P()}finally{x.T=V,S.p=q,S.d.f()}},jn.preconnect=function(P,V){typeof P=="string"&&(V?(V=V.crossOrigin,V=typeof V=="string"?V==="use-credentials"?V:"":void 0):V=null,S.d.C(P,V))},jn.prefetchDNS=function(P){typeof P=="string"&&S.d.D(P)},jn.preinit=function(P,V){if(typeof P=="string"&&V&&typeof V.as=="string"){var q=V.as,X=z(q,V.crossOrigin),se=typeof V.integrity=="string"?V.integrity:void 0,re=typeof V.fetchPriority=="string"?V.fetchPriority:void 0;q==="style"?S.d.S(P,typeof V.precedence=="string"?V.precedence:void 0,{crossOrigin:X,integrity:se,fetchPriority:re}):q==="script"&&S.d.X(P,{crossOrigin:X,integrity:se,fetchPriority:re,nonce:typeof V.nonce=="string"?V.nonce:void 0})}},jn.preinitModule=function(P,V){if(typeof P=="string")if(typeof V=="object"&&V!==null){if(V.as==null||V.as==="script"){var q=z(V.as,V.crossOrigin);S.d.M(P,{crossOrigin:q,integrity:typeof V.integrity=="string"?V.integrity:void 0,nonce:typeof V.nonce=="string"?V.nonce:void 0})}}else V==null&&S.d.M(P)},jn.preload=function(P,V){if(typeof P=="string"&&typeof V=="object"&&V!==null&&typeof V.as=="string"){var q=V.as,X=z(q,V.crossOrigin);S.d.L(P,q,{crossOrigin:X,integrity:typeof V.integrity=="string"?V.integrity:void 0,nonce:typeof V.nonce=="string"?V.nonce:void 0,type:typeof V.type=="string"?V.type:void 0,fetchPriority:typeof V.fetchPriority=="string"?V.fetchPriority:void 0,referrerPolicy:typeof V.referrerPolicy=="string"?V.referrerPolicy:void 0,imageSrcSet:typeof V.imageSrcSet=="string"?V.imageSrcSet:void 0,imageSizes:typeof V.imageSizes=="string"?V.imageSizes:void 0,media:typeof V.media=="string"?V.media:void 0})}},jn.preloadModule=function(P,V){if(typeof P=="string")if(V){var q=z(V.as,V.crossOrigin);S.d.m(P,{as:typeof V.as=="string"&&V.as!=="script"?V.as:void 0,crossOrigin:q,integrity:typeof V.integrity=="string"?V.integrity:void 0})}else S.d.m(P)},jn.requestFormReset=function(P){S.d.r(P)},jn.unstable_batchedUpdates=function(P,V){return P(V)},jn.useFormState=function(P,V,q){return x.H.useFormState(P,V,q)},jn.useFormStatus=function(){return x.H.useHostTransitionStatus()},jn.version="19.1.1",jn}var n3;function P7(){if(n3)return tO.exports;n3=1;function m(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(m)}catch(g){console.error(g)}}return m(),tO.exports=D7(),tO.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var a3;function L7(){if(a3)return _S;a3=1;var m=N7(),g=gO(),T=P7();function S(a){var o="https://react.dev/errors/"+a;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+a+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function b(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function I(a){var o=a,u=a;if(a.alternate)for(;o.return;)o=o.return;else{a=o;do o=a,(o.flags&4098)!==0&&(u=o.return),a=o.return;while(a)}return o.tag===3?u:null}function x(a){if(a.tag===13){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function z(a){if(I(a)!==a)throw Error(S(188))}function P(a){var o=a.alternate;if(!o){if(o=I(a),o===null)throw Error(S(188));return o!==a?null:a}for(var u=a,f=o;;){var v=u.return;if(v===null)break;var C=v.alternate;if(C===null){if(f=v.return,f!==null){u=f;continue}break}if(v.child===C.child){for(C=v.child;C;){if(C===u)return z(v),a;if(C===f)return z(v),o;C=C.sibling}throw Error(S(188))}if(u.return!==f.return)u=v,f=C;else{for(var j=!1,W=v.child;W;){if(W===u){j=!0,u=v,f=C;break}if(W===f){j=!0,f=v,u=C;break}W=W.sibling}if(!j){for(W=C.child;W;){if(W===u){j=!0,u=C,f=v;break}if(W===f){j=!0,f=C,u=v;break}W=W.sibling}if(!j)throw Error(S(189))}}if(u.alternate!==f)throw Error(S(190))}if(u.tag!==3)throw Error(S(188));return u.stateNode.current===u?a:o}function V(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a;for(a=a.child;a!==null;){if(o=V(a),o!==null)return o;a=a.sibling}return null}var q=Object.assign,X=Symbol.for("react.element"),se=Symbol.for("react.transitional.element"),re=Symbol.for("react.portal"),ue=Symbol.for("react.fragment"),ae=Symbol.for("react.strict_mode"),oe=Symbol.for("react.profiler"),Ae=Symbol.for("react.provider"),be=Symbol.for("react.consumer"),Oe=Symbol.for("react.context"),Xe=Symbol.for("react.forward_ref"),Ue=Symbol.for("react.suspense"),gt=Symbol.for("react.suspense_list"),it=Symbol.for("react.memo"),Ge=Symbol.for("react.lazy"),kt=Symbol.for("react.activity"),rt=Symbol.for("react.memo_cache_sentinel"),Ze=Symbol.iterator;function Qe(a){return a===null||typeof a!="object"?null:(a=Ze&&a[Ze]||a["@@iterator"],typeof a=="function"?a:null)}var Di=Symbol.for("react.client.reference");function ii(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===Di?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case ue:return"Fragment";case oe:return"Profiler";case ae:return"StrictMode";case Ue:return"Suspense";case gt:return"SuspenseList";case kt:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case re:return"Portal";case Oe:return(a.displayName||"Context")+".Provider";case be:return(a._context.displayName||"Context")+".Consumer";case Xe:var o=a.render;return a=a.displayName,a||(a=o.displayName||o.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case it:return o=a.displayName||null,o!==null?o:ii(a.type)||"Memo";case Ge:o=a._payload,a=a._init;try{return ii(a(o))}catch{}}return null}var Pi=Array.isArray,Ne=g.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,We=T.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,He={pending:!1,data:null,method:null,action:null},St=[],ie=-1;function je(a){return{current:a}}function $e(a){0>ie||(a.current=St[ie],St[ie]=null,ie--)}function et(a,o){ie++,St[ie]=a.current,a.current=o}var ft=je(null),_i=je(null),Ut=je(null),fn=je(null);function Qi(a,o){switch(et(Ut,o),et(_i,a),et(ft,null),o.nodeType){case 9:case 11:a=(a=o.documentElement)&&(a=a.namespaceURI)?Pv(a):0;break;default:if(a=o.tagName,o=o.namespaceURI)o=Pv(o),a=Lv(o,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}$e(ft),et(ft,a)}function Aa(){$e(ft),$e(_i),$e(Ut)}function Rl(a){a.memoizedState!==null&&et(fn,a);var o=ft.current,u=Lv(o,a.type);o!==u&&(et(_i,a),et(ft,u))}function $h(a){_i.current===a&&($e(ft),$e(_i)),fn.current===a&&($e(fn),ah._currentValue=He)}var Bm=Object.prototype.hasOwnProperty,Ls=m.unstable_scheduleCallback,jm=m.unstable_cancelCallback,Hy=m.unstable_shouldYield,go=m.unstable_requestPaint,$a=m.unstable_now,Yr=m.unstable_getCurrentPriorityLevel,bn=m.unstable_ImmediatePriority,ep=m.unstable_UserBlockingPriority,yl=m.unstable_NormalPriority,Wy=m.unstable_LowPriority,Fm=m.unstable_IdlePriority,qr=m.log,AS=m.unstable_setDisableYieldValue,Cl=null,dr=null;function ks(a){if(typeof qr=="function"&&AS(a),dr&&typeof dr.setStrictMode=="function")try{dr.setStrictMode(Cl,a)}catch{}}var mn=Math.clz32?Math.clz32:OS,wS=Math.log,IS=Math.LN2;function OS(a){return a>>>=0,a===0?32:31-(wS(a)/IS|0)|0}var eu=256,es=4194304;function So(a){var o=a&42;if(o!==0)return o;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function tp(a,o,u){var f=a.pendingLanes;if(f===0)return 0;var v=0,C=a.suspendedLanes,j=a.pingedLanes;a=a.warmLanes;var W=f&134217727;return W!==0?(f=W&~C,f!==0?v=So(f):(j&=W,j!==0?v=So(j):u||(u=W&~a,u!==0&&(v=So(u))))):(W=f&~C,W!==0?v=So(W):j!==0?v=So(j):u||(u=f&~a,u!==0&&(v=So(u)))),v===0?0:o!==0&&o!==v&&(o&C)===0&&(C=v&-v,u=o&-o,C>=u||C===32&&(u&4194048)!==0)?o:v}function tu(a,o){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&o)===0}function bl(a,o){switch(a){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Gm(){var a=eu;return eu<<=1,(eu&4194048)===0&&(eu=256),a}function NS(){var a=es;return es<<=1,(es&62914560)===0&&(es=4194304),a}function Hm(a){for(var o=[],u=0;31>u;u++)o.push(a);return o}function iu(a,o){a.pendingLanes|=o,o!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function zy(a,o,u,f,v,C){var j=a.pendingLanes;a.pendingLanes=u,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=u,a.entangledLanes&=u,a.errorRecoveryDisabledLanes&=u,a.shellSuspendCounter=0;var W=a.entanglements,ee=a.expirationTimes,_e=a.hiddenUpdates;for(u=j&~u;0<u;){var De=31-mn(u),Ve=1<<De;W[De]=0,ee[De]=-1;var Re=_e[De];if(Re!==null)for(_e[De]=null,De=0;De<Re.length;De++){var Ce=Re[De];Ce!==null&&(Ce.lane&=-536870913)}u&=~Ve}f!==0&&Al(a,f,0),C!==0&&v===0&&a.tag!==0&&(a.suspendedLanes|=C&~(j&~o))}function Al(a,o,u){a.pendingLanes|=o,a.suspendedLanes&=~o;var f=31-mn(o);a.entangledLanes|=o,a.entanglements[f]=a.entanglements[f]|1073741824|u&4194090}function DS(a,o){var u=a.entangledLanes|=o;for(a=a.entanglements;u;){var f=31-mn(u),v=1<<f;v&o|a[f]&o&&(a[f]|=o),u&=~v}}function To(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Wm(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function PS(){var a=We.p;return a!==0?a:(a=window.event,a===void 0?32:Zv(a.type))}function Ky(a,o){var u=We.p;try{return We.p=a,o()}finally{We.p=u}}var ur=Math.random().toString(36).slice(2),nn="__reactFiber$"+ur,An="__reactProps$"+ur,Ms="__reactContainer$"+ur,ip="__reactEvents$"+ur,LS="__reactListeners$"+ur,kS="__reactHandles$"+ur,MS="__reactResources$"+ur,wl="__reactMarker$"+ur;function rp(a){delete a[nn],delete a[An],delete a[ip],delete a[LS],delete a[kS]}function Il(a){var o=a[nn];if(o)return o;for(var u=a.parentNode;u;){if(o=u[Ms]||u[nn]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(a=Uv(a);a!==null;){if(u=a[nn])return u;a=Uv(a)}return o}a=u,u=a.parentNode}return null}function Ol(a){if(a=a[nn]||a[Ms]){var o=a.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return a}return null}function ru(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a.stateNode;throw Error(S(33))}function Tc(a){var o=a[MS];return o||(o=a[MS]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function wr(a){a[wl]=!0}var np=new Set,zm={};function ra(a,o){Nl(a,o),Nl(a+"Capture",o)}function Nl(a,o){for(zm[a]=o,a=0;a<o.length;a++)np.add(o[a])}var Yy=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),wa={},xS={};function qy(a){return Bm.call(xS,a)?!0:Bm.call(wa,a)?!1:Yy.test(a)?xS[a]=!0:(wa[a]=!0,!1)}function tr(a,o,u){if(qy(o))if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":a.removeAttribute(o);return;case"boolean":var f=o.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){a.removeAttribute(o);return}}a.setAttribute(o,""+u)}}function ap(a,o,u){if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(o);return}a.setAttribute(o,""+u)}}function xs(a,o,u,f){if(f===null)a.removeAttribute(u);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(u);return}a.setAttributeNS(o,u,""+f)}}var Km,US;function vo(a){if(Km===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);Km=o&&o[1]||"",US=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Km+a+US}var Ym=!1;function sp(a,o){if(!a||Ym)return"";Ym=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(o){var Ve=function(){throw Error()};if(Object.defineProperty(Ve.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ve,[])}catch(Ce){var Re=Ce}Reflect.construct(a,[],Ve)}else{try{Ve.call()}catch(Ce){Re=Ce}a.call(Ve.prototype)}}else{try{throw Error()}catch(Ce){Re=Ce}(Ve=a())&&typeof Ve.catch=="function"&&Ve.catch(function(){})}}catch(Ce){if(Ce&&Re&&typeof Ce.stack=="string")return[Ce.stack,Re.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var C=f.DetermineComponentFrameRoot(),j=C[0],W=C[1];if(j&&W){var ee=j.split(`
`),_e=W.split(`
`);for(v=f=0;f<ee.length&&!ee[f].includes("DetermineComponentFrameRoot");)f++;for(;v<_e.length&&!_e[v].includes("DetermineComponentFrameRoot");)v++;if(f===ee.length||v===_e.length)for(f=ee.length-1,v=_e.length-1;1<=f&&0<=v&&ee[f]!==_e[v];)v--;for(;1<=f&&0<=v;f--,v--)if(ee[f]!==_e[v]){if(f!==1||v!==1)do if(f--,v--,0>v||ee[f]!==_e[v]){var De=`
`+ee[f].replace(" at new "," at ");return a.displayName&&De.includes("<anonymous>")&&(De=De.replace("<anonymous>",a.displayName)),De}while(1<=f&&0<=v);break}}}finally{Ym=!1,Error.prepareStackTrace=u}return(u=a?a.displayName||a.name:"")?vo(u):""}function Xy(a){switch(a.tag){case 26:case 27:case 5:return vo(a.type);case 16:return vo("Lazy");case 13:return vo("Suspense");case 19:return vo("SuspenseList");case 0:case 15:return sp(a.type,!1);case 11:return sp(a.type.render,!1);case 1:return sp(a.type,!0);case 31:return vo("Activity");default:return""}}function VS(a){try{var o="";do o+=Xy(a),a=a.return;while(a);return o}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function na(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function vc(a){var o=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function qm(a){var o=vc(a)?"checked":"value",u=Object.getOwnPropertyDescriptor(a.constructor.prototype,o),f=""+a[o];if(!a.hasOwnProperty(o)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var v=u.get,C=u.set;return Object.defineProperty(a,o,{configurable:!0,get:function(){return v.call(this)},set:function(j){f=""+j,C.call(this,j)}}),Object.defineProperty(a,o,{enumerable:u.enumerable}),{getValue:function(){return f},setValue:function(j){f=""+j},stopTracking:function(){a._valueTracker=null,delete a[o]}}}}function op(a){a._valueTracker||(a._valueTracker=qm(a))}function Li(a){if(!a)return!1;var o=a._valueTracker;if(!o)return!0;var u=o.getValue(),f="";return a&&(f=vc(a)?a.checked?"true":"false":a.value),a=f,a!==u?(o.setValue(a),!0):!1}function cp(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var BS=/[\n"\\]/g;function Gn(a){return a.replace(BS,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Xm(a,o,u,f,v,C,j,W){a.name="",j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"?a.type=j:a.removeAttribute("type"),o!=null?j==="number"?(o===0&&a.value===""||a.value!=o)&&(a.value=""+na(o)):a.value!==""+na(o)&&(a.value=""+na(o)):j!=="submit"&&j!=="reset"||a.removeAttribute("value"),o!=null?Jm(a,j,na(o)):u!=null?Jm(a,j,na(u)):f!=null&&a.removeAttribute("value"),v==null&&C!=null&&(a.defaultChecked=!!C),v!=null&&(a.checked=v&&typeof v!="function"&&typeof v!="symbol"),W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?a.name=""+na(W):a.removeAttribute("name")}function jS(a,o,u,f,v,C,j,W){if(C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"&&(a.type=C),o!=null||u!=null){if(!(C!=="submit"&&C!=="reset"||o!=null))return;u=u!=null?""+na(u):"",o=o!=null?""+na(o):u,W||o===a.value||(a.value=o),a.defaultValue=o}f=f??v,f=typeof f!="function"&&typeof f!="symbol"&&!!f,a.checked=W?a.checked:!!f,a.defaultChecked=!!f,j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"&&(a.name=j)}function Jm(a,o,u){o==="number"&&cp(a.ownerDocument)===a||a.defaultValue===""+u||(a.defaultValue=""+u)}function Dl(a,o,u,f){if(a=a.options,o){o={};for(var v=0;v<u.length;v++)o["$"+u[v]]=!0;for(u=0;u<a.length;u++)v=o.hasOwnProperty("$"+a[u].value),a[u].selected!==v&&(a[u].selected=v),v&&f&&(a[u].defaultSelected=!0)}else{for(u=""+na(u),o=null,v=0;v<a.length;v++){if(a[v].value===u){a[v].selected=!0,f&&(a[v].defaultSelected=!0);return}o!==null||a[v].disabled||(o=a[v])}o!==null&&(o.selected=!0)}}function FS(a,o,u){if(o!=null&&(o=""+na(o),o!==a.value&&(a.value=o),u==null)){a.defaultValue!==o&&(a.defaultValue=o);return}a.defaultValue=u!=null?""+na(u):""}function GS(a,o,u,f){if(o==null){if(f!=null){if(u!=null)throw Error(S(92));if(Pi(f)){if(1<f.length)throw Error(S(93));f=f[0]}u=f}u==null&&(u=""),o=u}u=na(o),a.defaultValue=u,f=a.textContent,f===u&&f!==""&&f!==null&&(a.value=f)}function Ro(a,o){if(o){var u=a.firstChild;if(u&&u===a.lastChild&&u.nodeType===3){u.nodeValue=o;return}}a.textContent=o}var HS=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function lp(a,o,u){var f=o.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?f?a.setProperty(o,""):o==="float"?a.cssFloat="":a[o]="":f?a.setProperty(o,u):typeof u!="number"||u===0||HS.has(o)?o==="float"?a.cssFloat=u:a[o]=(""+u).trim():a[o]=u+"px"}function WS(a,o,u){if(o!=null&&typeof o!="object")throw Error(S(62));if(a=a.style,u!=null){for(var f in u)!u.hasOwnProperty(f)||o!=null&&o.hasOwnProperty(f)||(f.indexOf("--")===0?a.setProperty(f,""):f==="float"?a.cssFloat="":a[f]="");for(var v in o)f=o[v],o.hasOwnProperty(v)&&u[v]!==f&&lp(a,v,f)}else for(var C in o)o.hasOwnProperty(C)&&lp(a,C,o[C])}function nu(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Jy=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),zS=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function dp(a){return zS.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var Zm=null;function Qm(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Pl=null,Ll=null;function KS(a){var o=Ol(a);if(o&&(a=o.stateNode)){var u=a[An]||null;e:switch(a=o.stateNode,o.type){case"input":if(Xm(a,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),o=u.name,u.type==="radio"&&o!=null){for(u=a;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+Gn(""+o)+'"][type="radio"]'),o=0;o<u.length;o++){var f=u[o];if(f!==a&&f.form===a.form){var v=f[An]||null;if(!v)throw Error(S(90));Xm(f,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(o=0;o<u.length;o++)f=u[o],f.form===a.form&&Li(f)}break e;case"textarea":FS(a,u.value,u.defaultValue);break e;case"select":o=u.value,o!=null&&Dl(a,!!u.multiple,o,!1)}}}var $m=!1;function YS(a,o,u){if($m)return a(o,u);$m=!0;try{var f=a(o);return f}finally{if($m=!1,(Pl!==null||Ll!==null)&&(Xc(),Pl&&(o=Pl,a=Ll,Ll=Pl=null,KS(o),a)))for(o=0;o<a.length;o++)KS(a[o])}}function kl(a,o){var u=a.stateNode;if(u===null)return null;var f=u[An]||null;if(f===null)return null;u=f[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(a=a.type,f=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!f;break e;default:a=!1}if(a)return null;if(u&&typeof u!="function")throw Error(S(231,o,typeof u));return u}var Us=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),e_=!1;if(Us)try{var au={};Object.defineProperty(au,"passive",{get:function(){e_=!0}}),window.addEventListener("test",au,au),window.removeEventListener("test",au,au)}catch{e_=!1}var aa=null,t_=null,up=null;function qS(){if(up)return up;var a,o=t_,u=o.length,f,v="value"in aa?aa.value:aa.textContent,C=v.length;for(a=0;a<u&&o[a]===v[a];a++);var j=u-a;for(f=1;f<=j&&o[u-f]===v[C-f];f++);return up=v.slice(a,1<f?1-f:void 0)}function hp(a){var o=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&o===13&&(a=13)):a=o,a===10&&(a=13),32<=a||a===13?a:0}function su(){return!0}function XS(){return!1}function wn(a){function o(u,f,v,C,j){this._reactName=u,this._targetInst=v,this.type=f,this.nativeEvent=C,this.target=j,this.currentTarget=null;for(var W in a)a.hasOwnProperty(W)&&(u=a[W],this[W]=u?u(C):C[W]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?su:XS,this.isPropagationStopped=XS,this}return q(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=su)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=su)},persist:function(){},isPersistent:su}),o}var Rc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ia=wn(Rc),an=q({},Rc,{view:0,detail:0}),JS=wn(an),i_,r_,ou,Br=q({},an,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:o_,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==ou&&(ou&&a.type==="mousemove"?(i_=a.screenX-ou.screenX,r_=a.screenY-ou.screenY):r_=i_=0,ou=a),i_)},movementY:function(a){return"movementY"in a?a.movementY:r_}}),ZS=wn(Br),Zy=q({},Br,{dataTransfer:0}),Qy=wn(Zy),pp=q({},an,{relatedTarget:0}),fp=wn(pp),$y=q({},Rc,{animationName:0,elapsedTime:0,pseudoElement:0}),n_=wn($y),eC=q({},Rc,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),a_=wn(eC),s_=q({},Rc,{data:0}),mp=wn(s_),tC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},iC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},yc={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function cu(a){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(a):(a=yc[a])?!!o[a]:!1}function o_(){return cu}var rC=q({},an,{key:function(a){if(a.key){var o=tC[a.key]||a.key;if(o!=="Unidentified")return o}return a.type==="keypress"?(a=hp(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?iC[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:o_,charCode:function(a){return a.type==="keypress"?hp(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?hp(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),nC=wn(rC),aC=q({},Br,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),QS=wn(aC),Ml=q({},an,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:o_}),sC=wn(Ml),xl=q({},Rc,{propertyName:0,elapsedTime:0,pseudoElement:0}),$S=wn(xl),oC=q({},Br,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),Vt=wn(oC),cC=q({},Rc,{newState:0,oldState:0}),lC=wn(cC),dC=[9,13,27,32],c_=Us&&"CompositionEvent"in window,Cc=null;Us&&"documentMode"in document&&(Cc=document.documentMode);var uC=Us&&"TextEvent"in window&&!Cc,eT=Us&&(!c_||Cc&&8<Cc&&11>=Cc),tT=" ",_p=!1;function iT(a,o){switch(a){case"keyup":return dC.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function rT(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var bc=!1;function hC(a,o){switch(a){case"compositionend":return rT(o);case"keypress":return o.which!==32?null:(_p=!0,tT);case"textInput":return a=o.data,a===tT&&_p?null:a;default:return null}}function yo(a,o){if(bc)return a==="compositionend"||!c_&&iT(a,o)?(a=qS(),up=t_=aa=null,bc=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return eT&&o.locale!=="ko"?null:o.data;default:return null}}var pC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function nT(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o==="input"?!!pC[a.type]:o==="textarea"}function aT(a,o,u,f){Pl?Ll?Ll.push(f):Ll=[f]:Pl=f,o=Qu(o,"onChange"),0<o.length&&(u=new Ia("onChange","change",null,u,f),a.push({event:u,listeners:o}))}var Ul=null,Ac=null;function fC(a){ff(a,0)}function Ep(a){var o=ru(a);if(Li(o))return a}function sT(a,o){if(a==="change")return o}var Hn=!1;if(Us){var l_;if(Us){var d_="oninput"in document;if(!d_){var oT=document.createElement("div");oT.setAttribute("oninput","return;"),d_=typeof oT.oninput=="function"}l_=d_}else l_=!1;Hn=l_&&(!document.documentMode||9<document.documentMode)}function cT(){Ul&&(Ul.detachEvent("onpropertychange",u_),Ac=Ul=null)}function u_(a){if(a.propertyName==="value"&&Ep(Ac)){var o=[];aT(o,Ac,a,Qm(a)),YS(fC,o)}}function mC(a,o,u){a==="focusin"?(cT(),Ul=o,Ac=u,Ul.attachEvent("onpropertychange",u_)):a==="focusout"&&cT()}function _C(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Ep(Ac)}function lT(a,o){if(a==="click")return Ep(o)}function h_(a,o){if(a==="input"||a==="change")return Ep(o)}function EC(a,o){return a===o&&(a!==0||1/a===1/o)||a!==a&&o!==o}var Wn=typeof Object.is=="function"?Object.is:EC;function Co(a,o){if(Wn(a,o))return!0;if(typeof a!="object"||a===null||typeof o!="object"||o===null)return!1;var u=Object.keys(a),f=Object.keys(o);if(u.length!==f.length)return!1;for(f=0;f<u.length;f++){var v=u[f];if(!Bm.call(o,v)||!Wn(a[v],o[v]))return!1}return!0}function dT(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function uT(a,o){var u=dT(a);a=0;for(var f;u;){if(u.nodeType===3){if(f=a+u.textContent.length,a<=o&&f>=o)return{node:u,offset:o-a};a=f}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=dT(u)}}function hT(a,o){return a&&o?a===o?!0:a&&a.nodeType===3?!1:o&&o.nodeType===3?hT(a,o.parentNode):"contains"in a?a.contains(o):a.compareDocumentPosition?!!(a.compareDocumentPosition(o)&16):!1:!1}function Vs(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var o=cp(a.document);o instanceof a.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)a=o.contentWindow;else break;o=cp(a.document)}return o}function p_(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o&&(o==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||o==="textarea"||a.contentEditable==="true")}var gC=Us&&"documentMode"in document&&11>=document.documentMode,Ir=null,f_=null,lu=null,m_=!1;function pT(a,o,u){var f=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;m_||Ir==null||Ir!==cp(f)||(f=Ir,"selectionStart"in f&&p_(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),lu&&Co(lu,f)||(lu=f,f=Qu(f_,"onSelect"),0<f.length&&(o=new Ia("onSelect","select",null,o,u),a.push({event:o,listeners:f}),o.target=Ir)))}function bo(a,o){var u={};return u[a.toLowerCase()]=o.toLowerCase(),u["Webkit"+a]="webkit"+o,u["Moz"+a]="moz"+o,u}var Vl={animationend:bo("Animation","AnimationEnd"),animationiteration:bo("Animation","AnimationIteration"),animationstart:bo("Animation","AnimationStart"),transitionrun:bo("Transition","TransitionRun"),transitionstart:bo("Transition","TransitionStart"),transitioncancel:bo("Transition","TransitionCancel"),transitionend:bo("Transition","TransitionEnd")},__={},fT={};Us&&(fT=document.createElement("div").style,"AnimationEvent"in window||(delete Vl.animationend.animation,delete Vl.animationiteration.animation,delete Vl.animationstart.animation),"TransitionEvent"in window||delete Vl.transitionend.transition);function Ao(a){if(__[a])return __[a];if(!Vl[a])return a;var o=Vl[a],u;for(u in o)if(o.hasOwnProperty(u)&&u in fT)return __[a]=o[u];return a}var mT=Ao("animationend"),_T=Ao("animationiteration"),gp=Ao("animationstart"),E_=Ao("transitionrun"),SC=Ao("transitionstart"),ve=Ao("transitioncancel"),ET=Ao("transitionend"),gT=new Map,g_="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");g_.push("scrollEnd");function Oa(a,o){gT.set(a,o),ra(o,[a])}var S_=new WeakMap;function zn(a,o){if(typeof a=="object"&&a!==null){var u=S_.get(a);return u!==void 0?u:(o={value:a,source:o,stack:VS(o)},S_.set(a,o),o)}return{value:a,source:o,stack:VS(o)}}var sa=[],Bl=0,T_=0;function wc(){for(var a=Bl,o=T_=Bl=0;o<a;){var u=sa[o];sa[o++]=null;var f=sa[o];sa[o++]=null;var v=sa[o];sa[o++]=null;var C=sa[o];if(sa[o++]=null,f!==null&&v!==null){var j=f.pending;j===null?v.next=v:(v.next=j.next,j.next=v),f.pending=v}C!==0&&du(u,v,C)}}function wo(a,o,u,f){sa[Bl++]=a,sa[Bl++]=o,sa[Bl++]=u,sa[Bl++]=f,T_|=f,a.lanes|=f,a=a.alternate,a!==null&&(a.lanes|=f)}function v_(a,o,u,f){return wo(a,o,u,f),Fl(a)}function jl(a,o){return wo(a,null,null,o),Fl(a)}function du(a,o,u){a.lanes|=u;var f=a.alternate;f!==null&&(f.lanes|=u);for(var v=!1,C=a.return;C!==null;)C.childLanes|=u,f=C.alternate,f!==null&&(f.childLanes|=u),C.tag===22&&(a=C.stateNode,a===null||a._visibility&1||(v=!0)),a=C,C=C.return;return a.tag===3?(C=a.stateNode,v&&o!==null&&(v=31-mn(u),a=C.hiddenUpdates,f=a[v],f===null?a[v]=[o]:f.push(o),o.lane=u|536870912),C):null}function Fl(a){if(50<Xu)throw Xu=0,gE=null,Error(S(185));for(var o=a.return;o!==null;)a=o,o=a.return;return a.tag===3?a.stateNode:null}var Bs={};function TC(a,o,u,f){this.tag=a,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Kn(a,o,u,f){return new TC(a,o,u,f)}function R_(a){return a=a.prototype,!(!a||!a.isReactComponent)}function js(a,o){var u=a.alternate;return u===null?(u=Kn(a.tag,o,a.key,a.mode),u.elementType=a.elementType,u.type=a.type,u.stateNode=a.stateNode,u.alternate=a,a.alternate=u):(u.pendingProps=o,u.type=a.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=a.flags&65011712,u.childLanes=a.childLanes,u.lanes=a.lanes,u.child=a.child,u.memoizedProps=a.memoizedProps,u.memoizedState=a.memoizedState,u.updateQueue=a.updateQueue,o=a.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=a.sibling,u.index=a.index,u.ref=a.ref,u.refCleanup=a.refCleanup,u}function Sp(a,o){a.flags&=65011714;var u=a.alternate;return u===null?(a.childLanes=0,a.lanes=o,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=u.childLanes,a.lanes=u.lanes,a.child=u.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=u.memoizedProps,a.memoizedState=u.memoizedState,a.updateQueue=u.updateQueue,a.type=u.type,o=u.dependencies,a.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),a}function Tp(a,o,u,f,v,C){var j=0;if(f=a,typeof a=="function")R_(a)&&(j=1);else if(typeof a=="string")j=qE(a,u,ft.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case kt:return a=Kn(31,u,o,v),a.elementType=kt,a.lanes=C,a;case ue:return Io(u.children,v,C,o);case ae:j=8,v|=24;break;case oe:return a=Kn(12,u,o,v|2),a.elementType=oe,a.lanes=C,a;case Ue:return a=Kn(13,u,o,v),a.elementType=Ue,a.lanes=C,a;case gt:return a=Kn(19,u,o,v),a.elementType=gt,a.lanes=C,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case Ae:case Oe:j=10;break e;case be:j=9;break e;case Xe:j=11;break e;case it:j=14;break e;case Ge:j=16,f=null;break e}j=29,u=Error(S(130,a===null?"null":typeof a,"")),f=null}return o=Kn(j,u,o,v),o.elementType=a,o.type=f,o.lanes=C,o}function Io(a,o,u,f){return a=Kn(7,a,f,o),a.lanes=u,a}function In(a,o,u){return a=Kn(6,a,null,o),a.lanes=u,a}function y_(a,o,u){return o=Kn(4,a.children!==null?a.children:[],a.key,o),o.lanes=u,o.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},o}var ts=[],Gl=0,vp=null,Rp=0,Yn=[],oa=0,Ic=null,Fs=1,Na="";function Oc(a,o){ts[Gl++]=Rp,ts[Gl++]=vp,vp=a,Rp=o}function C_(a,o,u){Yn[oa++]=Fs,Yn[oa++]=Na,Yn[oa++]=Ic,Ic=a;var f=Fs;a=Na;var v=32-mn(f)-1;f&=~(1<<v),u+=1;var C=32-mn(o)+v;if(30<C){var j=v-v%5;C=(f&(1<<j)-1).toString(32),f>>=j,v-=j,Fs=1<<32-mn(o)+v|u<<v|f,Na=C+a}else Fs=1<<C|u<<v|f,Na=a}function yp(a){a.return!==null&&(Oc(a,1),C_(a,1,0))}function b_(a){for(;a===vp;)vp=ts[--Gl],ts[Gl]=null,Rp=ts[--Gl],ts[Gl]=null;for(;a===Ic;)Ic=Yn[--oa],Yn[oa]=null,Na=Yn[--oa],Yn[oa]=null,Fs=Yn[--oa],Yn[oa]=null}var sn=null,Yi=null,Si=!1,Nc=null,is=!1,A_=Error(S(519));function Dc(a){var o=Error(S(418,""));throw hu(zn(o,a)),A_}function w_(a){var o=a.stateNode,u=a.type,f=a.memoizedProps;switch(o[nn]=a,o[An]=f,u){case"dialog":Xt("cancel",o),Xt("close",o);break;case"iframe":case"object":case"embed":Xt("load",o);break;case"video":case"audio":for(u=0;u<_d.length;u++)Xt(_d[u],o);break;case"source":Xt("error",o);break;case"img":case"image":case"link":Xt("error",o),Xt("load",o);break;case"details":Xt("toggle",o);break;case"input":Xt("invalid",o),jS(o,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0),op(o);break;case"select":Xt("invalid",o);break;case"textarea":Xt("invalid",o),GS(o,f.value,f.defaultValue,f.children),op(o)}u=f.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||o.textContent===""+u||f.suppressHydrationWarning===!0||gf(o.textContent,u)?(f.popover!=null&&(Xt("beforetoggle",o),Xt("toggle",o)),f.onScroll!=null&&Xt("scroll",o),f.onScrollEnd!=null&&Xt("scrollend",o),f.onClick!=null&&(o.onclick=$u),o=!0):o=!1,o||Dc(a)}function Cp(a){for(sn=a.return;sn;)switch(sn.tag){case 5:case 13:is=!1;return;case 27:case 3:is=!0;return;default:sn=sn.return}}function uu(a){if(a!==sn)return!1;if(!Si)return Cp(a),Si=!0,!1;var o=a.tag,u;if((u=o!==3&&o!==27)&&((u=o===5)&&(u=a.type,u=!(u!=="form"&&u!=="button")||FE(a.type,a.memoizedProps)),u=!u),u&&Yi&&Dc(a),Cp(a),o===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(S(317));e:{for(a=a.nextSibling,o=0;a;){if(a.nodeType===8)if(u=a.data,u==="/$"){if(o===0){Yi=Ba(a.nextSibling);break e}o--}else u!=="$"&&u!=="$!"&&u!=="$?"||o++;a=a.nextSibling}Yi=null}}else o===27?(o=Yi,Ko(a.type)?(a=WE,WE=null,Yi=a):Yi=o):Yi=sn?Ba(a.stateNode.nextSibling):null;return!0}function Pc(){Yi=sn=null,Si=!1}function ST(){var a=Nc;return a!==null&&(Pr===null?Pr=a:Pr.push.apply(Pr,a),Nc=null),a}function hu(a){Nc===null?Nc=[a]:Nc.push(a)}var I_=je(null),Lc=null,Gs=null;function Oo(a,o,u){et(I_,o._currentValue),o._currentValue=u}function Hs(a){a._currentValue=I_.current,$e(I_)}function O_(a,o,u){for(;a!==null;){var f=a.alternate;if((a.childLanes&o)!==o?(a.childLanes|=o,f!==null&&(f.childLanes|=o)):f!==null&&(f.childLanes&o)!==o&&(f.childLanes|=o),a===u)break;a=a.return}}function N_(a,o,u,f){var v=a.child;for(v!==null&&(v.return=a);v!==null;){var C=v.dependencies;if(C!==null){var j=v.child;C=C.firstContext;e:for(;C!==null;){var W=C;C=v;for(var ee=0;ee<o.length;ee++)if(W.context===o[ee]){C.lanes|=u,W=C.alternate,W!==null&&(W.lanes|=u),O_(C.return,u,a),f||(j=null);break e}C=W.next}}else if(v.tag===18){if(j=v.return,j===null)throw Error(S(341));j.lanes|=u,C=j.alternate,C!==null&&(C.lanes|=u),O_(j,u,a),j=null}else j=v.child;if(j!==null)j.return=v;else for(j=v;j!==null;){if(j===a){j=null;break}if(v=j.sibling,v!==null){v.return=j.return,j=v;break}j=j.return}v=j}}function pu(a,o,u,f){a=null;for(var v=o,C=!1;v!==null;){if(!C){if((v.flags&524288)!==0)C=!0;else if((v.flags&262144)!==0)break}if(v.tag===10){var j=v.alternate;if(j===null)throw Error(S(387));if(j=j.memoizedProps,j!==null){var W=v.type;Wn(v.pendingProps.value,j.value)||(a!==null?a.push(W):a=[W])}}else if(v===fn.current){if(j=v.alternate,j===null)throw Error(S(387));j.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(a!==null?a.push(ah):a=[ah])}v=v.return}a!==null&&N_(o,a,u,f),o.flags|=262144}function bp(a){for(a=a.firstContext;a!==null;){if(!Wn(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function rs(a){Lc=a,Gs=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Or(a){return TT(Lc,a)}function Hl(a,o){return Lc===null&&rs(a),TT(a,o)}function TT(a,o){var u=o._currentValue;if(o={context:o,memoizedValue:u,next:null},Gs===null){if(a===null)throw Error(S(308));Gs=o,a.dependencies={lanes:0,firstContext:o},a.flags|=524288}else Gs=Gs.next=o;return u}var vC=typeof AbortController<"u"?AbortController:function(){var a=[],o=this.signal={aborted:!1,addEventListener:function(u,f){a.push(f)}};this.abort=function(){o.aborted=!0,a.forEach(function(u){return u()})}},RC=m.unstable_scheduleCallback,vT=m.unstable_NormalPriority,Sr={$$typeof:Oe,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function fu(){return{controller:new vC,data:new Map,refCount:0}}function mu(a){a.refCount--,a.refCount===0&&RC(vT,function(){a.controller.abort()})}var _u=null,kc=0,Wl=0,zl=null;function yC(a,o){if(_u===null){var u=_u=[];kc=0,Wl=md(),zl={status:"pending",value:void 0,then:function(f){u.push(f)}}}return kc++,o.then(RT,RT),o}function RT(){if(--kc===0&&_u!==null){zl!==null&&(zl.status="fulfilled");var a=_u;_u=null,Wl=0,zl=null;for(var o=0;o<a.length;o++)(0,a[o])()}}function CC(a,o){var u=[],f={status:"pending",value:null,reason:null,then:function(v){u.push(v)}};return a.then(function(){f.status="fulfilled",f.value=o;for(var v=0;v<u.length;v++)(0,u[v])(o)},function(v){for(f.status="rejected",f.reason=v,v=0;v<u.length;v++)(0,u[v])(void 0)}),f}var yT=Ne.S;Ne.S=function(a,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&yC(a,o),yT!==null&&yT(a,o)};var No=je(null);function D_(){var a=No.current;return a!==null?a:Hi.pooledCache}function Ap(a,o){o===null?et(No,No.current):et(No,o.pool)}function CT(){var a=D_();return a===null?null:{parent:Sr._currentValue,pool:a}}var Mc=Error(S(460)),bT=Error(S(474)),wp=Error(S(542)),Kl={then:function(){}};function AT(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Ip(){}function wT(a,o,u){switch(u=a[u],u===void 0?a.push(o):u!==o&&(o.then(Ip,Ip),o=u),o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,OT(a),a;default:if(typeof o.status=="string")o.then(Ip,Ip);else{if(a=Hi,a!==null&&100<a.shellSuspendCounter)throw Error(S(482));a=o,a.status="pending",a.then(function(f){if(o.status==="pending"){var v=o;v.status="fulfilled",v.value=f}},function(f){if(o.status==="pending"){var v=o;v.status="rejected",v.reason=f}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,OT(a),a}throw Eu=o,Mc}}var Eu=null;function IT(){if(Eu===null)throw Error(S(459));var a=Eu;return Eu=null,a}function OT(a){if(a===Mc||a===wp)throw Error(S(483))}var Da=!1;function Op(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function P_(a,o){a=a.updateQueue,o.updateQueue===a&&(o.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Do(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Ws(a,o,u){var f=a.updateQueue;if(f===null)return null;if(f=f.shared,(Ti&2)!==0){var v=f.pending;return v===null?o.next=o:(o.next=v.next,v.next=o),f.pending=o,o=Fl(a),du(a,null,u),o}return wo(a,f,o,u),Fl(a)}function gu(a,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194048)!==0)){var f=o.lanes;f&=a.pendingLanes,u|=f,o.lanes=u,DS(a,u)}}function L_(a,o){var u=a.updateQueue,f=a.alternate;if(f!==null&&(f=f.updateQueue,u===f)){var v=null,C=null;if(u=u.firstBaseUpdate,u!==null){do{var j={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};C===null?v=C=j:C=C.next=j,u=u.next}while(u!==null);C===null?v=C=o:C=C.next=o}else v=C=o;u={baseState:f.baseState,firstBaseUpdate:v,lastBaseUpdate:C,shared:f.shared,callbacks:f.callbacks},a.updateQueue=u;return}a=u.lastBaseUpdate,a===null?u.firstBaseUpdate=o:a.next=o,u.lastBaseUpdate=o}var k_=!1;function xc(){if(k_){var a=zl;if(a!==null)throw a}}function Uc(a,o,u,f){k_=!1;var v=a.updateQueue;Da=!1;var C=v.firstBaseUpdate,j=v.lastBaseUpdate,W=v.shared.pending;if(W!==null){v.shared.pending=null;var ee=W,_e=ee.next;ee.next=null,j===null?C=_e:j.next=_e,j=ee;var De=a.alternate;De!==null&&(De=De.updateQueue,W=De.lastBaseUpdate,W!==j&&(W===null?De.firstBaseUpdate=_e:W.next=_e,De.lastBaseUpdate=ee))}if(C!==null){var Ve=v.baseState;j=0,De=_e=ee=null,W=C;do{var Re=W.lane&-536870913,Ce=Re!==W.lane;if(Ce?(li&Re)===Re:(f&Re)===Re){Re!==0&&Re===Wl&&(k_=!0),De!==null&&(De=De.next={lane:0,tag:W.tag,payload:W.payload,callback:null,next:null});e:{var Dt=a,Rt=W;Re=o;var Mi=u;switch(Rt.tag){case 1:if(Dt=Rt.payload,typeof Dt=="function"){Ve=Dt.call(Mi,Ve,Re);break e}Ve=Dt;break e;case 3:Dt.flags=Dt.flags&-65537|128;case 0:if(Dt=Rt.payload,Re=typeof Dt=="function"?Dt.call(Mi,Ve,Re):Dt,Re==null)break e;Ve=q({},Ve,Re);break e;case 2:Da=!0}}Re=W.callback,Re!==null&&(a.flags|=64,Ce&&(a.flags|=8192),Ce=v.callbacks,Ce===null?v.callbacks=[Re]:Ce.push(Re))}else Ce={lane:Re,tag:W.tag,payload:W.payload,callback:W.callback,next:null},De===null?(_e=De=Ce,ee=Ve):De=De.next=Ce,j|=Re;if(W=W.next,W===null){if(W=v.shared.pending,W===null)break;Ce=W,W=Ce.next,Ce.next=null,v.lastBaseUpdate=Ce,v.shared.pending=null}}while(!0);De===null&&(ee=Ve),v.baseState=ee,v.firstBaseUpdate=_e,v.lastBaseUpdate=De,C===null&&(v.shared.lanes=0),xa|=j,a.lanes=j,a.memoizedState=Ve}}function M_(a,o){if(typeof a!="function")throw Error(S(191,a));a.call(o)}function Np(a,o){var u=a.callbacks;if(u!==null)for(a.callbacks=null,a=0;a<u.length;a++)M_(u[a],o)}var Vc=je(null),Su=je(0);function Tu(a,o){a=ds,et(Su,a),et(Vc,o),ds=a|o.baseLanes}function Bc(){et(Su,ds),et(Vc,Vc.current)}function x_(){ds=Su.current,$e(Vc),$e(Su)}var Po=0,zt=null,ki=null,Tr=null,vu=!1,Yl=!1,jc=!1,Dp=0,Ru=0,ql=null,bC=0;function ar(){throw Error(S(321))}function Lo(a,o){if(o===null)return!1;for(var u=0;u<o.length&&u<a.length;u++)if(!Wn(a[u],o[u]))return!1;return!0}function U_(a,o,u,f,v,C){return Po=C,zt=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Ne.H=a===null||a.memoizedState===null?Fc:Mo,jc=!1,C=u(f,v),jc=!1,Yl&&(C=DT(o,u,f,v)),NT(a),C}function NT(a){Ne.H=qn;var o=ki!==null&&ki.next!==null;if(Po=0,Tr=ki=zt=null,vu=!1,Ru=0,ql=null,o)throw Error(S(300));a===null||jr||(a=a.dependencies,a!==null&&bp(a)&&(jr=!0))}function DT(a,o,u,f){zt=a;var v=0;do{if(Yl&&(ql=null),Ru=0,Yl=!1,25<=v)throw Error(S(301));if(v+=1,Tr=ki=null,a.updateQueue!=null){var C=a.updateQueue;C.lastEffect=null,C.events=null,C.stores=null,C.memoCache!=null&&(C.memoCache.index=0)}Ne.H=JT,C=o(u,f)}while(Yl);return C}function PT(){var a=Ne.H,o=a.useState()[0];return o=typeof o.then=="function"?yu(o):o,a=a.useState()[0],(ki!==null?ki.memoizedState:null)!==a&&(zt.flags|=1024),o}function V_(){var a=Dp!==0;return Dp=0,a}function Pp(a,o,u){o.updateQueue=a.updateQueue,o.flags&=-2053,a.lanes&=~u}function B_(a){if(vu){for(a=a.memoizedState;a!==null;){var o=a.queue;o!==null&&(o.pending=null),a=a.next}vu=!1}Po=0,Tr=ki=zt=null,Yl=!1,Ru=Dp=0,ql=null}function On(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Tr===null?zt.memoizedState=Tr=a:Tr=Tr.next=a,Tr}function vr(){if(ki===null){var a=zt.alternate;a=a!==null?a.memoizedState:null}else a=ki.next;var o=Tr===null?zt.memoizedState:Tr.next;if(o!==null)Tr=o,ki=a;else{if(a===null)throw zt.alternate===null?Error(S(467)):Error(S(310));ki=a,a={memoizedState:ki.memoizedState,baseState:ki.baseState,baseQueue:ki.baseQueue,queue:ki.queue,next:null},Tr===null?zt.memoizedState=Tr=a:Tr=Tr.next=a}return Tr}function Xl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function yu(a){var o=Ru;return Ru+=1,ql===null&&(ql=[]),a=wT(ql,a,o),o=zt,(Tr===null?o.memoizedState:Tr.next)===null&&(o=o.alternate,Ne.H=o===null||o.memoizedState===null?Fc:Mo),a}function Lp(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return yu(a);if(a.$$typeof===Oe)return Or(a)}throw Error(S(438,String(a)))}function j_(a){var o=null,u=zt.updateQueue;if(u!==null&&(o=u.memoCache),o==null){var f=zt.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(o={data:f.data.map(function(v){return v.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),u===null&&(u=Xl(),zt.updateQueue=u),u.memoCache=o,u=o.data[o.index],u===void 0)for(u=o.data[o.index]=Array(a),f=0;f<a;f++)u[f]=rt;return o.index++,u}function zs(a,o){return typeof o=="function"?o(a):o}function kp(a){var o=vr();return F_(o,ki,a)}function F_(a,o,u){var f=a.queue;if(f===null)throw Error(S(311));f.lastRenderedReducer=u;var v=a.baseQueue,C=f.pending;if(C!==null){if(v!==null){var j=v.next;v.next=C.next,C.next=j}o.baseQueue=v=C,f.pending=null}if(C=a.baseState,v===null)a.memoizedState=C;else{o=v.next;var W=j=null,ee=null,_e=o,De=!1;do{var Ve=_e.lane&-536870913;if(Ve!==_e.lane?(li&Ve)===Ve:(Po&Ve)===Ve){var Re=_e.revertLane;if(Re===0)ee!==null&&(ee=ee.next={lane:0,revertLane:0,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null}),Ve===Wl&&(De=!0);else if((Po&Re)===Re){_e=_e.next,Re===Wl&&(De=!0);continue}else Ve={lane:0,revertLane:_e.revertLane,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null},ee===null?(W=ee=Ve,j=C):ee=ee.next=Ve,zt.lanes|=Re,xa|=Re;Ve=_e.action,jc&&u(C,Ve),C=_e.hasEagerState?_e.eagerState:u(C,Ve)}else Re={lane:Ve,revertLane:_e.revertLane,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null},ee===null?(W=ee=Re,j=C):ee=ee.next=Re,zt.lanes|=Ve,xa|=Ve;_e=_e.next}while(_e!==null&&_e!==o);if(ee===null?j=C:ee.next=W,!Wn(C,a.memoizedState)&&(jr=!0,De&&(u=zl,u!==null)))throw u;a.memoizedState=C,a.baseState=j,a.baseQueue=ee,f.lastRenderedState=C}return v===null&&(f.lanes=0),[a.memoizedState,f.dispatch]}function Cu(a){var o=vr(),u=o.queue;if(u===null)throw Error(S(311));u.lastRenderedReducer=a;var f=u.dispatch,v=u.pending,C=o.memoizedState;if(v!==null){u.pending=null;var j=v=v.next;do C=a(C,j.action),j=j.next;while(j!==v);Wn(C,o.memoizedState)||(jr=!0),o.memoizedState=C,o.baseQueue===null&&(o.baseState=C),u.lastRenderedState=C}return[C,f]}function LT(a,o,u){var f=zt,v=vr(),C=Si;if(C){if(u===void 0)throw Error(S(407));u=u()}else u=o();var j=!Wn((ki||v).memoizedState,u);j&&(v.memoizedState=u,jr=!0),v=v.queue;var W=H_.bind(null,f,v,a);if(Ql(2048,8,W,[a]),v.getSnapshot!==o||j||Tr!==null&&Tr.memoizedState.tag&1){if(f.flags|=2048,Zl(9,Mp(),kT.bind(null,f,v,u,o),null),Hi===null)throw Error(S(349));C||(Po&124)!==0||G_(f,o,u)}return u}function G_(a,o,u){a.flags|=16384,a={getSnapshot:o,value:u},o=zt.updateQueue,o===null?(o=Xl(),zt.updateQueue=o,o.stores=[a]):(u=o.stores,u===null?o.stores=[a]:u.push(a))}function kT(a,o,u,f){o.value=u,o.getSnapshot=f,MT(o)&&xT(a)}function H_(a,o,u){return u(function(){MT(o)&&xT(a)})}function MT(a){var o=a.getSnapshot;a=a.value;try{var u=o();return!Wn(a,u)}catch{return!0}}function xT(a){var o=jl(a,2);o!==null&&Pn(o,a,2)}function W_(a){var o=On();if(typeof a=="function"){var u=a;if(a=u(),jc){ks(!0);try{u()}finally{ks(!1)}}}return o.memoizedState=o.baseState=a,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:zs,lastRenderedState:a},o}function UT(a,o,u,f){return a.baseState=u,F_(a,ki,typeof f=="function"?f:zs)}function AC(a,o,u,f,v){if(Du(a))throw Error(S(485));if(a=o.action,a!==null){var C={payload:v,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(j){C.listeners.push(j)}};Ne.T!==null?u(!0):C.isTransition=!1,f(C),u=o.pending,u===null?(C.next=o.pending=C,VT(o,C)):(C.next=u.next,o.pending=u.next=C)}}function VT(a,o){var u=o.action,f=o.payload,v=a.state;if(o.isTransition){var C=Ne.T,j={};Ne.T=j;try{var W=u(v,f),ee=Ne.S;ee!==null&&ee(j,W),z_(a,o,W)}catch(_e){K_(a,o,_e)}finally{Ne.T=C}}else try{C=u(v,f),z_(a,o,C)}catch(_e){K_(a,o,_e)}}function z_(a,o,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(f){BT(a,o,f)},function(f){return K_(a,o,f)}):BT(a,o,u)}function BT(a,o,u){o.status="fulfilled",o.value=u,Y_(o),a.state=u,o=a.pending,o!==null&&(u=o.next,u===o?a.pending=null:(u=u.next,o.next=u,VT(a,u)))}function K_(a,o,u){var f=a.pending;if(a.pending=null,f!==null){f=f.next;do o.status="rejected",o.reason=u,Y_(o),o=o.next;while(o!==f)}a.action=null}function Y_(a){a=a.listeners;for(var o=0;o<a.length;o++)(0,a[o])()}function jT(a,o){return o}function bu(a,o){if(Si){var u=Hi.formState;if(u!==null){e:{var f=zt;if(Si){if(Yi){t:{for(var v=Yi,C=is;v.nodeType!==8;){if(!C){v=null;break t}if(v=Ba(v.nextSibling),v===null){v=null;break t}}C=v.data,v=C==="F!"||C==="F"?v:null}if(v){Yi=Ba(v.nextSibling),f=v.data==="F!";break e}}Dc(f)}f=!1}f&&(o=u[0])}}return u=On(),u.memoizedState=u.baseState=o,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:jT,lastRenderedState:o},u.queue=f,u=jp.bind(null,zt,f),f.dispatch=u,f=W_(!1),C=eE.bind(null,zt,!1,f.queue),f=On(),v={state:o,dispatch:null,action:a,pending:null},f.queue=v,u=AC.bind(null,zt,v,C,u),v.dispatch=u,f.memoizedState=a,[o,u,!1]}function q_(a){var o=vr();return Jl(o,ki,a)}function Jl(a,o,u){if(o=F_(a,o,jT)[0],a=kp(zs)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var f=yu(o)}catch(j){throw j===Mc?wp:j}else f=o;o=vr();var v=o.queue,C=v.dispatch;return u!==o.memoizedState&&(zt.flags|=2048,Zl(9,Mp(),wC.bind(null,v,u),null)),[f,C,a]}function wC(a,o){a.action=o}function FT(a){var o=vr(),u=ki;if(u!==null)return Jl(o,u,a);vr(),o=o.memoizedState,u=vr();var f=u.queue.dispatch;return u.memoizedState=a,[o,f,!1]}function Zl(a,o,u,f){return a={tag:a,create:u,deps:f,inst:o,next:null},o=zt.updateQueue,o===null&&(o=Xl(),zt.updateQueue=o),u=o.lastEffect,u===null?o.lastEffect=a.next=a:(f=u.next,u.next=a,a.next=f,o.lastEffect=a),a}function Mp(){return{destroy:void 0,resource:void 0}}function Au(){return vr().memoizedState}function xp(a,o,u,f){var v=On();f=f===void 0?null:f,zt.flags|=a,v.memoizedState=Zl(1|o,Mp(),u,f)}function Ql(a,o,u,f){var v=vr();f=f===void 0?null:f;var C=v.memoizedState.inst;ki!==null&&f!==null&&Lo(f,ki.memoizedState.deps)?v.memoizedState=Zl(o,C,u,f):(zt.flags|=a,v.memoizedState=Zl(1|o,C,u,f))}function Up(a,o){xp(8390656,8,a,o)}function Vp(a,o){Ql(2048,8,a,o)}function GT(a,o){return Ql(4,2,a,o)}function HT(a,o){return Ql(4,4,a,o)}function WT(a,o){if(typeof o=="function"){a=a();var u=o(a);return function(){typeof u=="function"?u():o(null)}}if(o!=null)return a=a(),o.current=a,function(){o.current=null}}function zT(a,o,u){u=u!=null?u.concat([a]):null,Ql(4,4,WT.bind(null,o,a),u)}function X_(){}function wu(a,o){var u=vr();o=o===void 0?null:o;var f=u.memoizedState;return o!==null&&Lo(o,f[1])?f[0]:(u.memoizedState=[a,o],a)}function KT(a,o){var u=vr();o=o===void 0?null:o;var f=u.memoizedState;if(o!==null&&Lo(o,f[1]))return f[0];if(f=a(),jc){ks(!0);try{a()}finally{ks(!1)}}return u.memoizedState=[f,o],f}function ko(a,o,u){return u===void 0||(Po&1073741824)!==0?a.memoizedState=o:(a.memoizedState=u,a=af(),zt.lanes|=a,xa|=a,u)}function Bp(a,o,u,f){return Wn(u,o)?u:Vc.current!==null?(a=ko(a,u,f),Wn(a,o)||(jr=!0),a):(Po&42)===0?(jr=!0,a.memoizedState=u):(a=af(),zt.lanes|=a,xa|=a,o)}function Iu(a,o,u,f,v){var C=We.p;We.p=C!==0&&8>C?C:8;var j=Ne.T,W={};Ne.T=W,eE(a,!1,o,u);try{var ee=v(),_e=Ne.S;if(_e!==null&&_e(W,ee),ee!==null&&typeof ee=="object"&&typeof ee.then=="function"){var De=CC(ee,f);Nu(a,o,De,Jn(a))}else Nu(a,o,f,Jn(a))}catch(Ve){Nu(a,o,{then:function(){},status:"rejected",reason:Ve},Jn())}finally{We.p=C,Ne.T=j}}function Ou(){}function $l(a,o,u,f){if(a.tag!==5)throw Error(S(476));var v=YT(a).queue;Iu(a,v,o,He,u===null?Ou:function(){return J_(a),u(f)})}function YT(a){var o=a.memoizedState;if(o!==null)return o;o={memoizedState:He,baseState:He,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:zs,lastRenderedState:He},next:null};var u={};return o.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:zs,lastRenderedState:u},next:null},a.memoizedState=o,a=a.alternate,a!==null&&(a.memoizedState=o),o}function J_(a){var o=YT(a).next.queue;Nu(a,o,{},Jn())}function Z_(){return Or(ah)}function Q_(){return vr().memoizedState}function qT(){return vr().memoizedState}function IC(a){for(var o=a.return;o!==null;){switch(o.tag){case 24:case 3:var u=Jn();a=Do(u);var f=Ws(o,a,u);f!==null&&(Pn(f,o,u),gu(f,o,u)),o={cache:fu()},a.payload=o;return}o=o.return}}function $_(a,o,u){var f=Jn();u={lane:f,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},Du(a)?Fp(o,u):(u=v_(a,o,u,f),u!==null&&(Pn(u,a,f),XT(u,o,f)))}function jp(a,o,u){var f=Jn();Nu(a,o,u,f)}function Nu(a,o,u,f){var v={lane:f,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(Du(a))Fp(o,v);else{var C=a.alternate;if(a.lanes===0&&(C===null||C.lanes===0)&&(C=o.lastRenderedReducer,C!==null))try{var j=o.lastRenderedState,W=C(j,u);if(v.hasEagerState=!0,v.eagerState=W,Wn(W,j))return wo(a,o,v,0),Hi===null&&wc(),!1}catch{}finally{}if(u=v_(a,o,v,f),u!==null)return Pn(u,a,f),XT(u,o,f),!0}return!1}function eE(a,o,u,f){if(f={lane:2,revertLane:md(),action:f,hasEagerState:!1,eagerState:null,next:null},Du(a)){if(o)throw Error(S(479))}else o=v_(a,u,f,2),o!==null&&Pn(o,a,2)}function Du(a){var o=a.alternate;return a===zt||o!==null&&o===zt}function Fp(a,o){Yl=vu=!0;var u=a.pending;u===null?o.next=o:(o.next=u.next,u.next=o),a.pending=o}function XT(a,o,u){if((u&4194048)!==0){var f=o.lanes;f&=a.pendingLanes,u|=f,o.lanes=u,DS(a,u)}}var qn={readContext:Or,use:Lp,useCallback:ar,useContext:ar,useEffect:ar,useImperativeHandle:ar,useLayoutEffect:ar,useInsertionEffect:ar,useMemo:ar,useReducer:ar,useRef:ar,useState:ar,useDebugValue:ar,useDeferredValue:ar,useTransition:ar,useSyncExternalStore:ar,useId:ar,useHostTransitionStatus:ar,useFormState:ar,useActionState:ar,useOptimistic:ar,useMemoCache:ar,useCacheRefresh:ar},Fc={readContext:Or,use:Lp,useCallback:function(a,o){return On().memoizedState=[a,o===void 0?null:o],a},useContext:Or,useEffect:Up,useImperativeHandle:function(a,o,u){u=u!=null?u.concat([a]):null,xp(4194308,4,WT.bind(null,o,a),u)},useLayoutEffect:function(a,o){return xp(4194308,4,a,o)},useInsertionEffect:function(a,o){xp(4,2,a,o)},useMemo:function(a,o){var u=On();o=o===void 0?null:o;var f=a();if(jc){ks(!0);try{a()}finally{ks(!1)}}return u.memoizedState=[f,o],f},useReducer:function(a,o,u){var f=On();if(u!==void 0){var v=u(o);if(jc){ks(!0);try{u(o)}finally{ks(!1)}}}else v=o;return f.memoizedState=f.baseState=v,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:v},f.queue=a,a=a.dispatch=$_.bind(null,zt,a),[f.memoizedState,a]},useRef:function(a){var o=On();return a={current:a},o.memoizedState=a},useState:function(a){a=W_(a);var o=a.queue,u=jp.bind(null,zt,o);return o.dispatch=u,[a.memoizedState,u]},useDebugValue:X_,useDeferredValue:function(a,o){var u=On();return ko(u,a,o)},useTransition:function(){var a=W_(!1);return a=Iu.bind(null,zt,a.queue,!0,!1),On().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,o,u){var f=zt,v=On();if(Si){if(u===void 0)throw Error(S(407));u=u()}else{if(u=o(),Hi===null)throw Error(S(349));(li&124)!==0||G_(f,o,u)}v.memoizedState=u;var C={value:u,getSnapshot:o};return v.queue=C,Up(H_.bind(null,f,C,a),[a]),f.flags|=2048,Zl(9,Mp(),kT.bind(null,f,C,u,o),null),u},useId:function(){var a=On(),o=Hi.identifierPrefix;if(Si){var u=Na,f=Fs;u=(f&~(1<<32-mn(f)-1)).toString(32)+u,o=""+o+"R"+u,u=Dp++,0<u&&(o+="H"+u.toString(32)),o+=""}else u=bC++,o=""+o+"r"+u.toString(32)+"";return a.memoizedState=o},useHostTransitionStatus:Z_,useFormState:bu,useActionState:bu,useOptimistic:function(a){var o=On();o.memoizedState=o.baseState=a;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=u,o=eE.bind(null,zt,!0,u),u.dispatch=o,[a,o]},useMemoCache:j_,useCacheRefresh:function(){return On().memoizedState=IC.bind(null,zt)}},Mo={readContext:Or,use:Lp,useCallback:wu,useContext:Or,useEffect:Vp,useImperativeHandle:zT,useInsertionEffect:GT,useLayoutEffect:HT,useMemo:KT,useReducer:kp,useRef:Au,useState:function(){return kp(zs)},useDebugValue:X_,useDeferredValue:function(a,o){var u=vr();return Bp(u,ki.memoizedState,a,o)},useTransition:function(){var a=kp(zs)[0],o=vr().memoizedState;return[typeof a=="boolean"?a:yu(a),o]},useSyncExternalStore:LT,useId:Q_,useHostTransitionStatus:Z_,useFormState:q_,useActionState:q_,useOptimistic:function(a,o){var u=vr();return UT(u,ki,a,o)},useMemoCache:j_,useCacheRefresh:qT},JT={readContext:Or,use:Lp,useCallback:wu,useContext:Or,useEffect:Vp,useImperativeHandle:zT,useInsertionEffect:GT,useLayoutEffect:HT,useMemo:KT,useReducer:Cu,useRef:Au,useState:function(){return Cu(zs)},useDebugValue:X_,useDeferredValue:function(a,o){var u=vr();return ki===null?ko(u,a,o):Bp(u,ki.memoizedState,a,o)},useTransition:function(){var a=Cu(zs)[0],o=vr().memoizedState;return[typeof a=="boolean"?a:yu(a),o]},useSyncExternalStore:LT,useId:Q_,useHostTransitionStatus:Z_,useFormState:FT,useActionState:FT,useOptimistic:function(a,o){var u=vr();return ki!==null?UT(u,ki,a,o):(u.baseState=a,[a,u.queue.dispatch])},useMemoCache:j_,useCacheRefresh:qT},Gc=null,Pa=0;function ed(a){var o=Pa;return Pa+=1,Gc===null&&(Gc=[]),wT(Gc,a,o)}function Pu(a,o){o=o.props.ref,a.ref=o!==void 0?o:null}function Lu(a,o){throw o.$$typeof===X?Error(S(525)):(a=Object.prototype.toString.call(o),Error(S(31,a==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":a)))}function ZT(a){var o=a._init;return o(a._payload)}function tE(a){function o(pe,le){if(a){var Ee=pe.deletions;Ee===null?(pe.deletions=[le],pe.flags|=16):Ee.push(le)}}function u(pe,le){if(!a)return null;for(;le!==null;)o(pe,le),le=le.sibling;return null}function f(pe){for(var le=new Map;pe!==null;)pe.key!==null?le.set(pe.key,pe):le.set(pe.index,pe),pe=pe.sibling;return le}function v(pe,le){return pe=js(pe,le),pe.index=0,pe.sibling=null,pe}function C(pe,le,Ee){return pe.index=Ee,a?(Ee=pe.alternate,Ee!==null?(Ee=Ee.index,Ee<le?(pe.flags|=67108866,le):Ee):(pe.flags|=67108866,le)):(pe.flags|=1048576,le)}function j(pe){return a&&pe.alternate===null&&(pe.flags|=67108866),pe}function W(pe,le,Ee,Me){return le===null||le.tag!==6?(le=In(Ee,pe.mode,Me),le.return=pe,le):(le=v(le,Ee),le.return=pe,le)}function ee(pe,le,Ee,Me){var ct=Ee.type;return ct===ue?De(pe,le,Ee.props.children,Me,Ee.key):le!==null&&(le.elementType===ct||typeof ct=="object"&&ct!==null&&ct.$$typeof===Ge&&ZT(ct)===le.type)?(le=v(le,Ee.props),Pu(le,Ee),le.return=pe,le):(le=Tp(Ee.type,Ee.key,Ee.props,null,pe.mode,Me),Pu(le,Ee),le.return=pe,le)}function _e(pe,le,Ee,Me){return le===null||le.tag!==4||le.stateNode.containerInfo!==Ee.containerInfo||le.stateNode.implementation!==Ee.implementation?(le=y_(Ee,pe.mode,Me),le.return=pe,le):(le=v(le,Ee.children||[]),le.return=pe,le)}function De(pe,le,Ee,Me,ct){return le===null||le.tag!==7?(le=Io(Ee,pe.mode,Me,ct),le.return=pe,le):(le=v(le,Ee),le.return=pe,le)}function Ve(pe,le,Ee){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return le=In(""+le,pe.mode,Ee),le.return=pe,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case se:return Ee=Tp(le.type,le.key,le.props,null,pe.mode,Ee),Pu(Ee,le),Ee.return=pe,Ee;case re:return le=y_(le,pe.mode,Ee),le.return=pe,le;case Ge:var Me=le._init;return le=Me(le._payload),Ve(pe,le,Ee)}if(Pi(le)||Qe(le))return le=Io(le,pe.mode,Ee,null),le.return=pe,le;if(typeof le.then=="function")return Ve(pe,ed(le),Ee);if(le.$$typeof===Oe)return Ve(pe,Hl(pe,le),Ee);Lu(pe,le)}return null}function Re(pe,le,Ee,Me){var ct=le!==null?le.key:null;if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number"||typeof Ee=="bigint")return ct!==null?null:W(pe,le,""+Ee,Me);if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case se:return Ee.key===ct?ee(pe,le,Ee,Me):null;case re:return Ee.key===ct?_e(pe,le,Ee,Me):null;case Ge:return ct=Ee._init,Ee=ct(Ee._payload),Re(pe,le,Ee,Me)}if(Pi(Ee)||Qe(Ee))return ct!==null?null:De(pe,le,Ee,Me,null);if(typeof Ee.then=="function")return Re(pe,le,ed(Ee),Me);if(Ee.$$typeof===Oe)return Re(pe,le,Hl(pe,Ee),Me);Lu(pe,Ee)}return null}function Ce(pe,le,Ee,Me,ct){if(typeof Me=="string"&&Me!==""||typeof Me=="number"||typeof Me=="bigint")return pe=pe.get(Ee)||null,W(le,pe,""+Me,ct);if(typeof Me=="object"&&Me!==null){switch(Me.$$typeof){case se:return pe=pe.get(Me.key===null?Ee:Me.key)||null,ee(le,pe,Me,ct);case re:return pe=pe.get(Me.key===null?Ee:Me.key)||null,_e(le,pe,Me,ct);case Ge:var ti=Me._init;return Me=ti(Me._payload),Ce(pe,le,Ee,Me,ct)}if(Pi(Me)||Qe(Me))return pe=pe.get(Ee)||null,De(le,pe,Me,ct,null);if(typeof Me.then=="function")return Ce(pe,le,Ee,ed(Me),ct);if(Me.$$typeof===Oe)return Ce(pe,le,Ee,Hl(le,Me),ct);Lu(le,Me)}return null}function Dt(pe,le,Ee,Me){for(var ct=null,ti=null,mt=le,wt=le=0,Hr=null;mt!==null&&wt<Ee.length;wt++){mt.index>wt?(Hr=mt,mt=null):Hr=mt.sibling;var hi=Re(pe,mt,Ee[wt],Me);if(hi===null){mt===null&&(mt=Hr);break}a&&mt&&hi.alternate===null&&o(pe,mt),le=C(hi,le,wt),ti===null?ct=hi:ti.sibling=hi,ti=hi,mt=Hr}if(wt===Ee.length)return u(pe,mt),Si&&Oc(pe,wt),ct;if(mt===null){for(;wt<Ee.length;wt++)mt=Ve(pe,Ee[wt],Me),mt!==null&&(le=C(mt,le,wt),ti===null?ct=mt:ti.sibling=mt,ti=mt);return Si&&Oc(pe,wt),ct}for(mt=f(mt);wt<Ee.length;wt++)Hr=Ce(mt,pe,wt,Ee[wt],Me),Hr!==null&&(a&&Hr.alternate!==null&&mt.delete(Hr.key===null?wt:Hr.key),le=C(Hr,le,wt),ti===null?ct=Hr:ti.sibling=Hr,ti=Hr);return a&&mt.forEach(function(Xs){return o(pe,Xs)}),Si&&Oc(pe,wt),ct}function Rt(pe,le,Ee,Me){if(Ee==null)throw Error(S(151));for(var ct=null,ti=null,mt=le,wt=le=0,Hr=null,hi=Ee.next();mt!==null&&!hi.done;wt++,hi=Ee.next()){mt.index>wt?(Hr=mt,mt=null):Hr=mt.sibling;var Xs=Re(pe,mt,hi.value,Me);if(Xs===null){mt===null&&(mt=Hr);break}a&&mt&&Xs.alternate===null&&o(pe,mt),le=C(Xs,le,wt),ti===null?ct=Xs:ti.sibling=Xs,ti=Xs,mt=Hr}if(hi.done)return u(pe,mt),Si&&Oc(pe,wt),ct;if(mt===null){for(;!hi.done;wt++,hi=Ee.next())hi=Ve(pe,hi.value,Me),hi!==null&&(le=C(hi,le,wt),ti===null?ct=hi:ti.sibling=hi,ti=hi);return Si&&Oc(pe,wt),ct}for(mt=f(mt);!hi.done;wt++,hi=Ee.next())hi=Ce(mt,pe,wt,hi.value,Me),hi!==null&&(a&&hi.alternate!==null&&mt.delete(hi.key===null?wt:hi.key),le=C(hi,le,wt),ti===null?ct=hi:ti.sibling=hi,ti=hi);return a&&mt.forEach(function(ub){return o(pe,ub)}),Si&&Oc(pe,wt),ct}function Mi(pe,le,Ee,Me){if(typeof Ee=="object"&&Ee!==null&&Ee.type===ue&&Ee.key===null&&(Ee=Ee.props.children),typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case se:e:{for(var ct=Ee.key;le!==null;){if(le.key===ct){if(ct=Ee.type,ct===ue){if(le.tag===7){u(pe,le.sibling),Me=v(le,Ee.props.children),Me.return=pe,pe=Me;break e}}else if(le.elementType===ct||typeof ct=="object"&&ct!==null&&ct.$$typeof===Ge&&ZT(ct)===le.type){u(pe,le.sibling),Me=v(le,Ee.props),Pu(Me,Ee),Me.return=pe,pe=Me;break e}u(pe,le);break}else o(pe,le);le=le.sibling}Ee.type===ue?(Me=Io(Ee.props.children,pe.mode,Me,Ee.key),Me.return=pe,pe=Me):(Me=Tp(Ee.type,Ee.key,Ee.props,null,pe.mode,Me),Pu(Me,Ee),Me.return=pe,pe=Me)}return j(pe);case re:e:{for(ct=Ee.key;le!==null;){if(le.key===ct)if(le.tag===4&&le.stateNode.containerInfo===Ee.containerInfo&&le.stateNode.implementation===Ee.implementation){u(pe,le.sibling),Me=v(le,Ee.children||[]),Me.return=pe,pe=Me;break e}else{u(pe,le);break}else o(pe,le);le=le.sibling}Me=y_(Ee,pe.mode,Me),Me.return=pe,pe=Me}return j(pe);case Ge:return ct=Ee._init,Ee=ct(Ee._payload),Mi(pe,le,Ee,Me)}if(Pi(Ee))return Dt(pe,le,Ee,Me);if(Qe(Ee)){if(ct=Qe(Ee),typeof ct!="function")throw Error(S(150));return Ee=ct.call(Ee),Rt(pe,le,Ee,Me)}if(typeof Ee.then=="function")return Mi(pe,le,ed(Ee),Me);if(Ee.$$typeof===Oe)return Mi(pe,le,Hl(pe,Ee),Me);Lu(pe,Ee)}return typeof Ee=="string"&&Ee!==""||typeof Ee=="number"||typeof Ee=="bigint"?(Ee=""+Ee,le!==null&&le.tag===6?(u(pe,le.sibling),Me=v(le,Ee),Me.return=pe,pe=Me):(u(pe,le),Me=In(Ee,pe.mode,Me),Me.return=pe,pe=Me),j(pe)):u(pe,le)}return function(pe,le,Ee,Me){try{Pa=0;var ct=Mi(pe,le,Ee,Me);return Gc=null,ct}catch(mt){if(mt===Mc||mt===wp)throw mt;var ti=Kn(29,mt,null,pe.mode);return ti.lanes=Me,ti.return=pe,ti}finally{}}}var Hc=tE(!0),QT=tE(!1),Nr=je(null),ns=null;function xo(a){var o=a.alternate;et(Dr,Dr.current&1),et(Nr,a),ns===null&&(o===null||Vc.current!==null||o.memoizedState!==null)&&(ns=a)}function $T(a){if(a.tag===22){if(et(Dr,Dr.current),et(Nr,a),ns===null){var o=a.alternate;o!==null&&o.memoizedState!==null&&(ns=a)}}else Uo()}function Uo(){et(Dr,Dr.current),et(Nr,Nr.current)}function as(a){$e(Nr),ns===a&&(ns=null),$e(Dr)}var Dr=je(0);function td(a){for(var o=a;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||Tf(u)))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}function Gp(a,o,u,f){o=a.memoizedState,u=u(f,o),u=u==null?o:q({},o,u),a.memoizedState=u,a.lanes===0&&(a.updateQueue.baseState=u)}var iE={enqueueSetState:function(a,o,u){a=a._reactInternals;var f=Jn(),v=Do(f);v.payload=o,u!=null&&(v.callback=u),o=Ws(a,v,f),o!==null&&(Pn(o,a,f),gu(o,a,f))},enqueueReplaceState:function(a,o,u){a=a._reactInternals;var f=Jn(),v=Do(f);v.tag=1,v.payload=o,u!=null&&(v.callback=u),o=Ws(a,v,f),o!==null&&(Pn(o,a,f),gu(o,a,f))},enqueueForceUpdate:function(a,o){a=a._reactInternals;var u=Jn(),f=Do(u);f.tag=2,o!=null&&(f.callback=o),o=Ws(a,f,u),o!==null&&(Pn(o,a,u),gu(o,a,u))}};function rE(a,o,u,f,v,C,j){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(f,C,j):o.prototype&&o.prototype.isPureReactComponent?!Co(u,f)||!Co(v,C):!0}function ev(a,o,u,f){a=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,f),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,f),o.state!==a&&iE.enqueueReplaceState(o,o.state,null)}function Wc(a,o){var u=o;if("ref"in o){u={};for(var f in o)f!=="ref"&&(u[f]=o[f])}if(a=a.defaultProps){u===o&&(u=q({},u));for(var v in a)u[v]===void 0&&(u[v]=a[v])}return u}var Hp=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function tv(a){Hp(a)}function iv(a){console.error(a)}function rv(a){Hp(a)}function Wp(a,o){try{var u=a.onUncaughtError;u(o.value,{componentStack:o.stack})}catch(f){setTimeout(function(){throw f})}}function nE(a,o,u){try{var f=a.onCaughtError;f(u.value,{componentStack:u.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function La(a,o,u){return u=Do(u),u.tag=3,u.payload={element:null},u.callback=function(){Wp(a,o)},u}function nv(a){return a=Do(a),a.tag=3,a}function av(a,o,u,f){var v=u.type.getDerivedStateFromError;if(typeof v=="function"){var C=f.value;a.payload=function(){return v(C)},a.callback=function(){nE(o,u,f)}}var j=u.stateNode;j!==null&&typeof j.componentDidCatch=="function"&&(a.callback=function(){nE(o,u,f),typeof v!="function"&&(Ys===null?Ys=new Set([this]):Ys.add(this));var W=f.stack;this.componentDidCatch(f.value,{componentStack:W!==null?W:""})})}function OC(a,o,u,f,v){if(u.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(o=u.alternate,o!==null&&pu(o,u,v,!0),u=Nr.current,u!==null){switch(u.tag){case 13:return ns===null?Qc():u.alternate===null&&ir===0&&(ir=3),u.flags&=-257,u.flags|=65536,u.lanes=v,f===Kl?u.flags|=16384:(o=u.updateQueue,o===null?u.updateQueue=new Set([f]):o.add(f),pd(a,f,v)),!1;case 22:return u.flags|=65536,f===Kl?u.flags|=16384:(o=u.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([f])},u.updateQueue=o):(u=o.retryQueue,u===null?o.retryQueue=new Set([f]):u.add(f)),pd(a,f,v)),!1}throw Error(S(435,u.tag))}return pd(a,f,v),Qc(),!1}if(Si)return o=Nr.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=v,f!==A_&&(a=Error(S(422),{cause:f}),hu(zn(a,u)))):(f!==A_&&(o=Error(S(423),{cause:f}),hu(zn(o,u))),a=a.current.alternate,a.flags|=65536,v&=-v,a.lanes|=v,f=zn(f,u),v=La(a.stateNode,f,v),L_(a,v),ir!==4&&(ir=2)),!1;var C=Error(S(520),{cause:f});if(C=zn(C,u),cd===null?cd=[C]:cd.push(C),ir!==4&&(ir=2),o===null)return!0;f=zn(f,u),u=o;do{switch(u.tag){case 3:return u.flags|=65536,a=v&-v,u.lanes|=a,a=La(u.stateNode,f,a),L_(u,a),!1;case 1:if(o=u.type,C=u.stateNode,(u.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(Ys===null||!Ys.has(C))))return u.flags|=65536,v&=-v,u.lanes|=v,v=nv(v),av(v,a,u,f),L_(u,v),!1}u=u.return}while(u!==null);return!1}var sv=Error(S(461)),jr=!1;function Xr(a,o,u,f){o.child=a===null?QT(o,null,u,f):Hc(o,a.child,u,f)}function zp(a,o,u,f,v){u=u.render;var C=o.ref;if("ref"in f){var j={};for(var W in f)W!=="ref"&&(j[W]=f[W])}else j=f;return rs(o),f=U_(a,o,u,j,C,v),W=V_(),a!==null&&!jr?(Pp(a,o,v),ss(a,o,v)):(Si&&W&&yp(o),o.flags|=1,Xr(a,o,f,v),o.child)}function ov(a,o,u,f,v){if(a===null){var C=u.type;return typeof C=="function"&&!R_(C)&&C.defaultProps===void 0&&u.compare===null?(o.tag=15,o.type=C,cv(a,o,C,f,v)):(a=Tp(u.type,null,f,o,o.mode,v),a.ref=o.ref,a.return=o,o.child=a)}if(C=a.child,!Yp(a,v)){var j=C.memoizedProps;if(u=u.compare,u=u!==null?u:Co,u(j,f)&&a.ref===o.ref)return ss(a,o,v)}return o.flags|=1,a=js(C,f),a.ref=o.ref,a.return=o,o.child=a}function cv(a,o,u,f,v){if(a!==null){var C=a.memoizedProps;if(Co(C,f)&&a.ref===o.ref)if(jr=!1,o.pendingProps=f=C,Yp(a,v))(a.flags&131072)!==0&&(jr=!0);else return o.lanes=a.lanes,ss(a,o,v)}return aE(a,o,u,f,v)}function lv(a,o,u){var f=o.pendingProps,v=f.children,C=a!==null?a.memoizedState:null;if(f.mode==="hidden"){if((o.flags&128)!==0){if(f=C!==null?C.baseLanes|u:u,a!==null){for(v=o.child=a.child,C=0;v!==null;)C=C|v.lanes|v.childLanes,v=v.sibling;o.childLanes=C&~f}else o.childLanes=0,o.child=null;return dv(a,o,f,u)}if((u&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},a!==null&&Ap(o,C!==null?C.cachePool:null),C!==null?Tu(o,C):Bc(),$T(o);else return o.lanes=o.childLanes=536870912,dv(a,o,C!==null?C.baseLanes|u:u,u)}else C!==null?(Ap(o,C.cachePool),Tu(o,C),Uo(),o.memoizedState=null):(a!==null&&Ap(o,null),Bc(),Uo());return Xr(a,o,v,u),o.child}function dv(a,o,u,f){var v=D_();return v=v===null?null:{parent:Sr._currentValue,pool:v},o.memoizedState={baseLanes:u,cachePool:v},a!==null&&Ap(o,null),Bc(),$T(o),a!==null&&pu(a,o,f,!0),null}function Kp(a,o){var u=o.ref;if(u===null)a!==null&&a.ref!==null&&(o.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(S(284));(a===null||a.ref!==u)&&(o.flags|=4194816)}}function aE(a,o,u,f,v){return rs(o),u=U_(a,o,u,f,void 0,v),f=V_(),a!==null&&!jr?(Pp(a,o,v),ss(a,o,v)):(Si&&f&&yp(o),o.flags|=1,Xr(a,o,u,v),o.child)}function sE(a,o,u,f,v,C){return rs(o),o.updateQueue=null,u=DT(o,f,u,v),NT(a),f=V_(),a!==null&&!jr?(Pp(a,o,C),ss(a,o,C)):(Si&&f&&yp(o),o.flags|=1,Xr(a,o,u,C),o.child)}function oE(a,o,u,f,v){if(rs(o),o.stateNode===null){var C=Bs,j=u.contextType;typeof j=="object"&&j!==null&&(C=Or(j)),C=new u(f,C),o.memoizedState=C.state!==null&&C.state!==void 0?C.state:null,C.updater=iE,o.stateNode=C,C._reactInternals=o,C=o.stateNode,C.props=f,C.state=o.memoizedState,C.refs={},Op(o),j=u.contextType,C.context=typeof j=="object"&&j!==null?Or(j):Bs,C.state=o.memoizedState,j=u.getDerivedStateFromProps,typeof j=="function"&&(Gp(o,u,j,f),C.state=o.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof C.getSnapshotBeforeUpdate=="function"||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(j=C.state,typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount(),j!==C.state&&iE.enqueueReplaceState(C,C.state,null),Uc(o,f,C,v),xc(),C.state=o.memoizedState),typeof C.componentDidMount=="function"&&(o.flags|=4194308),f=!0}else if(a===null){C=o.stateNode;var W=o.memoizedProps,ee=Wc(u,W);C.props=ee;var _e=C.context,De=u.contextType;j=Bs,typeof De=="object"&&De!==null&&(j=Or(De));var Ve=u.getDerivedStateFromProps;De=typeof Ve=="function"||typeof C.getSnapshotBeforeUpdate=="function",W=o.pendingProps!==W,De||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(W||_e!==j)&&ev(o,C,f,j),Da=!1;var Re=o.memoizedState;C.state=Re,Uc(o,f,C,v),xc(),_e=o.memoizedState,W||Re!==_e||Da?(typeof Ve=="function"&&(Gp(o,u,Ve,f),_e=o.memoizedState),(ee=Da||rE(o,u,ee,f,Re,_e,j))?(De||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(o.flags|=4194308)):(typeof C.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=f,o.memoizedState=_e),C.props=f,C.state=_e,C.context=j,f=ee):(typeof C.componentDidMount=="function"&&(o.flags|=4194308),f=!1)}else{C=o.stateNode,P_(a,o),j=o.memoizedProps,De=Wc(u,j),C.props=De,Ve=o.pendingProps,Re=C.context,_e=u.contextType,ee=Bs,typeof _e=="object"&&_e!==null&&(ee=Or(_e)),W=u.getDerivedStateFromProps,(_e=typeof W=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(j!==Ve||Re!==ee)&&ev(o,C,f,ee),Da=!1,Re=o.memoizedState,C.state=Re,Uc(o,f,C,v),xc();var Ce=o.memoizedState;j!==Ve||Re!==Ce||Da||a!==null&&a.dependencies!==null&&bp(a.dependencies)?(typeof W=="function"&&(Gp(o,u,W,f),Ce=o.memoizedState),(De=Da||rE(o,u,De,f,Re,Ce,ee)||a!==null&&a.dependencies!==null&&bp(a.dependencies))?(_e||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(f,Ce,ee),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(f,Ce,ee)),typeof C.componentDidUpdate=="function"&&(o.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof C.componentDidUpdate!="function"||j===a.memoizedProps&&Re===a.memoizedState||(o.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||j===a.memoizedProps&&Re===a.memoizedState||(o.flags|=1024),o.memoizedProps=f,o.memoizedState=Ce),C.props=f,C.state=Ce,C.context=ee,f=De):(typeof C.componentDidUpdate!="function"||j===a.memoizedProps&&Re===a.memoizedState||(o.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||j===a.memoizedProps&&Re===a.memoizedState||(o.flags|=1024),f=!1)}return C=f,Kp(a,o),f=(o.flags&128)!==0,C||f?(C=o.stateNode,u=f&&typeof u.getDerivedStateFromError!="function"?null:C.render(),o.flags|=1,a!==null&&f?(o.child=Hc(o,a.child,null,v),o.child=Hc(o,null,u,v)):Xr(a,o,u,v),o.memoizedState=C.state,a=o.child):a=ss(a,o,v),a}function uv(a,o,u,f){return Pc(),o.flags|=256,Xr(a,o,u,f),o.child}var cE={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function id(a){return{baseLanes:a,cachePool:CT()}}function ku(a,o,u){return a=a!==null?a.childLanes&~u:0,o&&(a|=la),a}function lE(a,o,u){var f=o.pendingProps,v=!1,C=(o.flags&128)!==0,j;if((j=C)||(j=a!==null&&a.memoizedState===null?!1:(Dr.current&2)!==0),j&&(v=!0,o.flags&=-129),j=(o.flags&32)!==0,o.flags&=-33,a===null){if(Si){if(v?xo(o):Uo(),Si){var W=Yi,ee;if(ee=W){e:{for(ee=W,W=is;ee.nodeType!==8;){if(!W){W=null;break e}if(ee=Ba(ee.nextSibling),ee===null){W=null;break e}}W=ee}W!==null?(o.memoizedState={dehydrated:W,treeContext:Ic!==null?{id:Fs,overflow:Na}:null,retryLane:536870912,hydrationErrors:null},ee=Kn(18,null,null,0),ee.stateNode=W,ee.return=o,o.child=ee,sn=o,Yi=null,ee=!0):ee=!1}ee||Dc(o)}if(W=o.memoizedState,W!==null&&(W=W.dehydrated,W!==null))return Tf(W)?o.lanes=32:o.lanes=536870912,null;as(o)}return W=f.children,f=f.fallback,v?(Uo(),v=o.mode,W=Mu({mode:"hidden",children:W},v),f=Io(f,v,u,null),W.return=o,f.return=o,W.sibling=f,o.child=W,v=o.child,v.memoizedState=id(u),v.childLanes=ku(a,j,u),o.memoizedState=cE,f):(xo(o),rd(o,W))}if(ee=a.memoizedState,ee!==null&&(W=ee.dehydrated,W!==null)){if(C)o.flags&256?(xo(o),o.flags&=-257,o=dE(a,o,u)):o.memoizedState!==null?(Uo(),o.child=a.child,o.flags|=128,o=null):(Uo(),v=f.fallback,W=o.mode,f=Mu({mode:"visible",children:f.children},W),v=Io(v,W,u,null),v.flags|=2,f.return=o,v.return=o,f.sibling=v,o.child=f,Hc(o,a.child,null,u),f=o.child,f.memoizedState=id(u),f.childLanes=ku(a,j,u),o.memoizedState=cE,o=v);else if(xo(o),Tf(W)){if(j=W.nextSibling&&W.nextSibling.dataset,j)var _e=j.dgst;j=_e,f=Error(S(419)),f.stack="",f.digest=j,hu({value:f,source:null,stack:null}),o=dE(a,o,u)}else if(jr||pu(a,o,u,!1),j=(u&a.childLanes)!==0,jr||j){if(j=Hi,j!==null&&(f=u&-u,f=(f&42)!==0?1:To(f),f=(f&(j.suspendedLanes|u))!==0?0:f,f!==0&&f!==ee.retryLane))throw ee.retryLane=f,jl(a,f),Pn(j,a,f),sv;W.data==="$?"||Qc(),o=dE(a,o,u)}else W.data==="$?"?(o.flags|=192,o.child=a.child,o=null):(a=ee.treeContext,Yi=Ba(W.nextSibling),sn=o,Si=!0,Nc=null,is=!1,a!==null&&(Yn[oa++]=Fs,Yn[oa++]=Na,Yn[oa++]=Ic,Fs=a.id,Na=a.overflow,Ic=o),o=rd(o,f.children),o.flags|=4096);return o}return v?(Uo(),v=f.fallback,W=o.mode,ee=a.child,_e=ee.sibling,f=js(ee,{mode:"hidden",children:f.children}),f.subtreeFlags=ee.subtreeFlags&65011712,_e!==null?v=js(_e,v):(v=Io(v,W,u,null),v.flags|=2),v.return=o,f.return=o,f.sibling=v,o.child=f,f=v,v=o.child,W=a.child.memoizedState,W===null?W=id(u):(ee=W.cachePool,ee!==null?(_e=Sr._currentValue,ee=ee.parent!==_e?{parent:_e,pool:_e}:ee):ee=CT(),W={baseLanes:W.baseLanes|u,cachePool:ee}),v.memoizedState=W,v.childLanes=ku(a,j,u),o.memoizedState=cE,f):(xo(o),u=a.child,a=u.sibling,u=js(u,{mode:"visible",children:f.children}),u.return=o,u.sibling=null,a!==null&&(j=o.deletions,j===null?(o.deletions=[a],o.flags|=16):j.push(a)),o.child=u,o.memoizedState=null,u)}function rd(a,o){return o=Mu({mode:"visible",children:o},a.mode),o.return=a,a.child=o}function Mu(a,o){return a=Kn(22,a,null,o),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function dE(a,o,u){return Hc(o,a.child,null,u),a=rd(o,o.pendingProps.children),a.flags|=2,o.memoizedState=null,a}function uE(a,o,u){a.lanes|=o;var f=a.alternate;f!==null&&(f.lanes|=o),O_(a.return,o,u)}function nd(a,o,u,f,v){var C=a.memoizedState;C===null?a.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:f,tail:u,tailMode:v}:(C.isBackwards=o,C.rendering=null,C.renderingStartTime=0,C.last=f,C.tail=u,C.tailMode=v)}function hv(a,o,u){var f=o.pendingProps,v=f.revealOrder,C=f.tail;if(Xr(a,o,f.children,u),f=Dr.current,(f&2)!==0)f=f&1|2,o.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=o.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&uE(a,u,o);else if(a.tag===19)uE(a,u,o);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break e;for(;a.sibling===null;){if(a.return===null||a.return===o)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}f&=1}switch(et(Dr,f),v){case"forwards":for(u=o.child,v=null;u!==null;)a=u.alternate,a!==null&&td(a)===null&&(v=u),u=u.sibling;u=v,u===null?(v=o.child,o.child=null):(v=u.sibling,u.sibling=null),nd(o,!1,v,u,C);break;case"backwards":for(u=null,v=o.child,o.child=null;v!==null;){if(a=v.alternate,a!==null&&td(a)===null){o.child=v;break}a=v.sibling,v.sibling=u,u=v,v=a}nd(o,!0,u,null,C);break;case"together":nd(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function ss(a,o,u){if(a!==null&&(o.dependencies=a.dependencies),xa|=o.lanes,(u&o.childLanes)===0)if(a!==null){if(pu(a,o,u,!1),(u&o.childLanes)===0)return null}else return null;if(a!==null&&o.child!==a.child)throw Error(S(153));if(o.child!==null){for(a=o.child,u=js(a,a.pendingProps),o.child=u,u.return=o;a.sibling!==null;)a=a.sibling,u=u.sibling=js(a,a.pendingProps),u.return=o;u.sibling=null}return o.child}function Yp(a,o){return(a.lanes&o)!==0?!0:(a=a.dependencies,!!(a!==null&&bp(a)))}function NC(a,o,u){switch(o.tag){case 3:Qi(o,o.stateNode.containerInfo),Oo(o,Sr,a.memoizedState.cache),Pc();break;case 27:case 5:Rl(o);break;case 4:Qi(o,o.stateNode.containerInfo);break;case 10:Oo(o,o.type,o.memoizedProps.value);break;case 13:var f=o.memoizedState;if(f!==null)return f.dehydrated!==null?(xo(o),o.flags|=128,null):(u&o.child.childLanes)!==0?lE(a,o,u):(xo(o),a=ss(a,o,u),a!==null?a.sibling:null);xo(o);break;case 19:var v=(a.flags&128)!==0;if(f=(u&o.childLanes)!==0,f||(pu(a,o,u,!1),f=(u&o.childLanes)!==0),v){if(f)return hv(a,o,u);o.flags|=128}if(v=o.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),et(Dr,Dr.current),f)break;return null;case 22:case 23:return o.lanes=0,lv(a,o,u);case 24:Oo(o,Sr,a.memoizedState.cache)}return ss(a,o,u)}function xu(a,o,u){if(a!==null)if(a.memoizedProps!==o.pendingProps)jr=!0;else{if(!Yp(a,u)&&(o.flags&128)===0)return jr=!1,NC(a,o,u);jr=(a.flags&131072)!==0}else jr=!1,Si&&(o.flags&1048576)!==0&&C_(o,Rp,o.index);switch(o.lanes=0,o.tag){case 16:e:{a=o.pendingProps;var f=o.elementType,v=f._init;if(f=v(f._payload),o.type=f,typeof f=="function")R_(f)?(a=Wc(f,a),o.tag=1,o=oE(null,o,f,a,u)):(o.tag=0,o=aE(null,o,f,a,u));else{if(f!=null){if(v=f.$$typeof,v===Xe){o.tag=11,o=zp(null,o,f,a,u);break e}else if(v===it){o.tag=14,o=ov(null,o,f,a,u);break e}}throw o=ii(f)||f,Error(S(306,o,""))}}return o;case 0:return aE(a,o,o.type,o.pendingProps,u);case 1:return f=o.type,v=Wc(f,o.pendingProps),oE(a,o,f,v,u);case 3:e:{if(Qi(o,o.stateNode.containerInfo),a===null)throw Error(S(387));f=o.pendingProps;var C=o.memoizedState;v=C.element,P_(a,o),Uc(o,f,null,u);var j=o.memoizedState;if(f=j.cache,Oo(o,Sr,f),f!==C.cache&&N_(o,[Sr],u,!0),xc(),f=j.element,C.isDehydrated)if(C={element:f,isDehydrated:!1,cache:j.cache},o.updateQueue.baseState=C,o.memoizedState=C,o.flags&256){o=uv(a,o,f,u);break e}else if(f!==v){v=zn(Error(S(424)),o),hu(v),o=uv(a,o,f,u);break e}else{switch(a=o.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(Yi=Ba(a.firstChild),sn=o,Si=!0,Nc=null,is=!0,u=QT(o,null,f,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(Pc(),f===v){o=ss(a,o,u);break e}Xr(a,o,f,u)}o=o.child}return o;case 26:return Kp(a,o),a===null?(u=Gv(o.type,null,o.pendingProps,null))?o.memoizedState=u:Si||(u=o.type,a=o.pendingProps,f=Sf(Ut.current).createElement(u),f[nn]=o,f[An]=a,Gr(f,u,a),wr(f),o.stateNode=f):o.memoizedState=Gv(o.type,a.memoizedProps,o.pendingProps,a.memoizedState),null;case 27:return Rl(o),a===null&&Si&&(f=o.stateNode=Vv(o.type,o.pendingProps,Ut.current),sn=o,is=!0,v=Yi,Ko(o.type)?(WE=v,Yi=Ba(f.firstChild)):Yi=v),Xr(a,o,o.pendingProps.children,u),Kp(a,o),a===null&&(o.flags|=4194304),o.child;case 5:return a===null&&Si&&((v=f=Yi)&&(f=qC(f,o.type,o.pendingProps,is),f!==null?(o.stateNode=f,sn=o,Yi=Ba(f.firstChild),is=!1,v=!0):v=!1),v||Dc(o)),Rl(o),v=o.type,C=o.pendingProps,j=a!==null?a.memoizedProps:null,f=C.children,FE(v,C)?f=null:j!==null&&FE(v,j)&&(o.flags|=32),o.memoizedState!==null&&(v=U_(a,o,PT,null,null,u),ah._currentValue=v),Kp(a,o),Xr(a,o,f,u),o.child;case 6:return a===null&&Si&&((a=u=Yi)&&(u=XC(u,o.pendingProps,is),u!==null?(o.stateNode=u,sn=o,Yi=null,a=!0):a=!1),a||Dc(o)),null;case 13:return lE(a,o,u);case 4:return Qi(o,o.stateNode.containerInfo),f=o.pendingProps,a===null?o.child=Hc(o,null,f,u):Xr(a,o,f,u),o.child;case 11:return zp(a,o,o.type,o.pendingProps,u);case 7:return Xr(a,o,o.pendingProps,u),o.child;case 8:return Xr(a,o,o.pendingProps.children,u),o.child;case 12:return Xr(a,o,o.pendingProps.children,u),o.child;case 10:return f=o.pendingProps,Oo(o,o.type,f.value),Xr(a,o,f.children,u),o.child;case 9:return v=o.type._context,f=o.pendingProps.children,rs(o),v=Or(v),f=f(v),o.flags|=1,Xr(a,o,f,u),o.child;case 14:return ov(a,o,o.type,o.pendingProps,u);case 15:return cv(a,o,o.type,o.pendingProps,u);case 19:return hv(a,o,u);case 31:return f=o.pendingProps,u=o.mode,f={mode:f.mode,children:f.children},a===null?(u=Mu(f,u),u.ref=o.ref,o.child=u,u.return=o,o=u):(u=js(a.child,f),u.ref=o.ref,o.child=u,u.return=o,o=u),o;case 22:return lv(a,o,u);case 24:return rs(o),f=Or(Sr),a===null?(v=D_(),v===null&&(v=Hi,C=fu(),v.pooledCache=C,C.refCount++,C!==null&&(v.pooledCacheLanes|=u),v=C),o.memoizedState={parent:f,cache:v},Op(o),Oo(o,Sr,v)):((a.lanes&u)!==0&&(P_(a,o),Uc(o,null,null,u),xc()),v=a.memoizedState,C=o.memoizedState,v.parent!==f?(v={parent:f,cache:f},o.memoizedState=v,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=v),Oo(o,Sr,f)):(f=C.cache,Oo(o,Sr,f),f!==v.cache&&N_(o,[Sr],u,!0))),Xr(a,o,o.pendingProps.children,u),o.child;case 29:throw o.pendingProps}throw Error(S(156,o.tag))}function os(a){a.flags|=4}function pv(a,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!zv(o)){if(o=Nr.current,o!==null&&((li&4194048)===li?ns!==null:(li&62914560)!==li&&(li&536870912)===0||o!==ns))throw Eu=Kl,bT;a.flags|=8192}}function qp(a,o){o!==null&&(a.flags|=4),a.flags&16384&&(o=a.tag!==22?NS():536870912,a.lanes|=o,qc|=o)}function Uu(a,o){if(!Si)switch(a.tailMode){case"hidden":o=a.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?a.tail=null:u.sibling=null;break;case"collapsed":u=a.tail;for(var f=null;u!==null;)u.alternate!==null&&(f=u),u=u.sibling;f===null?o||a.tail===null?a.tail=null:a.tail.sibling=null:f.sibling=null}}function Gi(a){var o=a.alternate!==null&&a.alternate.child===a.child,u=0,f=0;if(o)for(var v=a.child;v!==null;)u|=v.lanes|v.childLanes,f|=v.subtreeFlags&65011712,f|=v.flags&65011712,v.return=a,v=v.sibling;else for(v=a.child;v!==null;)u|=v.lanes|v.childLanes,f|=v.subtreeFlags,f|=v.flags,v.return=a,v=v.sibling;return a.subtreeFlags|=f,a.childLanes=u,o}function DC(a,o,u){var f=o.pendingProps;switch(b_(o),o.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Gi(o),null;case 1:return Gi(o),null;case 3:return u=o.stateNode,f=null,a!==null&&(f=a.memoizedState.cache),o.memoizedState.cache!==f&&(o.flags|=2048),Hs(Sr),Aa(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(a===null||a.child===null)&&(uu(o)?os(o):a===null||a.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,ST())),Gi(o),null;case 26:return u=o.memoizedState,a===null?(os(o),u!==null?(Gi(o),pv(o,u)):(Gi(o),o.flags&=-16777217)):u?u!==a.memoizedState?(os(o),Gi(o),pv(o,u)):(Gi(o),o.flags&=-16777217):(a.memoizedProps!==f&&os(o),Gi(o),o.flags&=-16777217),null;case 27:$h(o),u=Ut.current;var v=o.type;if(a!==null&&o.stateNode!=null)a.memoizedProps!==f&&os(o);else{if(!f){if(o.stateNode===null)throw Error(S(166));return Gi(o),null}a=ft.current,uu(o)?w_(o):(a=Vv(v,f,u),o.stateNode=a,os(o))}return Gi(o),null;case 5:if($h(o),u=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==f&&os(o);else{if(!f){if(o.stateNode===null)throw Error(S(166));return Gi(o),null}if(a=ft.current,uu(o))w_(o);else{switch(v=Sf(Ut.current),a){case 1:a=v.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:a=v.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":a=v.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":a=v.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":a=v.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof f.is=="string"?v.createElement("select",{is:f.is}):v.createElement("select"),f.multiple?a.multiple=!0:f.size&&(a.size=f.size);break;default:a=typeof f.is=="string"?v.createElement(u,{is:f.is}):v.createElement(u)}}a[nn]=o,a[An]=f;e:for(v=o.child;v!==null;){if(v.tag===5||v.tag===6)a.appendChild(v.stateNode);else if(v.tag!==4&&v.tag!==27&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===o)break e;for(;v.sibling===null;){if(v.return===null||v.return===o)break e;v=v.return}v.sibling.return=v.return,v=v.sibling}o.stateNode=a;e:switch(Gr(a,u,f),u){case"button":case"input":case"select":case"textarea":a=!!f.autoFocus;break e;case"img":a=!0;break e;default:a=!1}a&&os(o)}}return Gi(o),o.flags&=-16777217,null;case 6:if(a&&o.stateNode!=null)a.memoizedProps!==f&&os(o);else{if(typeof f!="string"&&o.stateNode===null)throw Error(S(166));if(a=Ut.current,uu(o)){if(a=o.stateNode,u=o.memoizedProps,f=null,v=sn,v!==null)switch(v.tag){case 27:case 5:f=v.memoizedProps}a[nn]=o,a=!!(a.nodeValue===u||f!==null&&f.suppressHydrationWarning===!0||gf(a.nodeValue,u)),a||Dc(o)}else a=Sf(a).createTextNode(f),a[nn]=o,o.stateNode=a}return Gi(o),null;case 13:if(f=o.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(v=uu(o),f!==null&&f.dehydrated!==null){if(a===null){if(!v)throw Error(S(318));if(v=o.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(S(317));v[nn]=o}else Pc(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Gi(o),v=!1}else v=ST(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=v),v=!0;if(!v)return o.flags&256?(as(o),o):(as(o),null)}if(as(o),(o.flags&128)!==0)return o.lanes=u,o;if(u=f!==null,a=a!==null&&a.memoizedState!==null,u){f=o.child,v=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(v=f.alternate.memoizedState.cachePool.pool);var C=null;f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(C=f.memoizedState.cachePool.pool),C!==v&&(f.flags|=2048)}return u!==a&&u&&(o.child.flags|=8192),qp(o,o.updateQueue),Gi(o),null;case 4:return Aa(),a===null&&_f(o.stateNode.containerInfo),Gi(o),null;case 10:return Hs(o.type),Gi(o),null;case 19:if($e(Dr),v=o.memoizedState,v===null)return Gi(o),null;if(f=(o.flags&128)!==0,C=v.rendering,C===null)if(f)Uu(v,!1);else{if(ir!==0||a!==null&&(a.flags&128)!==0)for(a=o.child;a!==null;){if(C=td(a),C!==null){for(o.flags|=128,Uu(v,!1),a=C.updateQueue,o.updateQueue=a,qp(o,a),o.subtreeFlags=0,a=u,u=o.child;u!==null;)Sp(u,a),u=u.sibling;return et(Dr,Dr.current&1|2),o.child}a=a.sibling}v.tail!==null&&$a()>ld&&(o.flags|=128,f=!0,Uu(v,!1),o.lanes=4194304)}else{if(!f)if(a=td(C),a!==null){if(o.flags|=128,f=!0,a=a.updateQueue,o.updateQueue=a,qp(o,a),Uu(v,!0),v.tail===null&&v.tailMode==="hidden"&&!C.alternate&&!Si)return Gi(o),null}else 2*$a()-v.renderingStartTime>ld&&u!==536870912&&(o.flags|=128,f=!0,Uu(v,!1),o.lanes=4194304);v.isBackwards?(C.sibling=o.child,o.child=C):(a=v.last,a!==null?a.sibling=C:o.child=C,v.last=C)}return v.tail!==null?(o=v.tail,v.rendering=o,v.tail=o.sibling,v.renderingStartTime=$a(),o.sibling=null,a=Dr.current,et(Dr,f?a&1|2:a&1),o):(Gi(o),null);case 22:case 23:return as(o),x_(),f=o.memoizedState!==null,a!==null?a.memoizedState!==null!==f&&(o.flags|=8192):f&&(o.flags|=8192),f?(u&536870912)!==0&&(o.flags&128)===0&&(Gi(o),o.subtreeFlags&6&&(o.flags|=8192)):Gi(o),u=o.updateQueue,u!==null&&qp(o,u.retryQueue),u=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),f=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),f!==u&&(o.flags|=2048),a!==null&&$e(No),null;case 24:return u=null,a!==null&&(u=a.memoizedState.cache),o.memoizedState.cache!==u&&(o.flags|=2048),Hs(Sr),Gi(o),null;case 25:return null;case 30:return null}throw Error(S(156,o.tag))}function PC(a,o){switch(b_(o),o.tag){case 1:return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 3:return Hs(Sr),Aa(),a=o.flags,(a&65536)!==0&&(a&128)===0?(o.flags=a&-65537|128,o):null;case 26:case 27:case 5:return $h(o),null;case 13:if(as(o),a=o.memoizedState,a!==null&&a.dehydrated!==null){if(o.alternate===null)throw Error(S(340));Pc()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 19:return $e(Dr),null;case 4:return Aa(),null;case 10:return Hs(o.type),null;case 22:case 23:return as(o),x_(),a!==null&&$e(No),a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 24:return Hs(Sr),null;case 25:return null;default:return null}}function fv(a,o){switch(b_(o),o.tag){case 3:Hs(Sr),Aa();break;case 26:case 27:case 5:$h(o);break;case 4:Aa();break;case 13:as(o);break;case 19:$e(Dr);break;case 10:Hs(o.type);break;case 22:case 23:as(o),x_(),a!==null&&$e(No);break;case 24:Hs(Sr)}}function ad(a,o){try{var u=o.updateQueue,f=u!==null?u.lastEffect:null;if(f!==null){var v=f.next;u=v;do{if((u.tag&a)===a){f=void 0;var C=u.create,j=u.inst;f=C(),j.destroy=f}u=u.next}while(u!==v)}}catch(W){Vi(o,o.return,W)}}function Vo(a,o,u){try{var f=o.updateQueue,v=f!==null?f.lastEffect:null;if(v!==null){var C=v.next;f=C;do{if((f.tag&a)===a){var j=f.inst,W=j.destroy;if(W!==void 0){j.destroy=void 0,v=o;var ee=u,_e=W;try{_e()}catch(De){Vi(v,ee,De)}}}f=f.next}while(f!==C)}}catch(De){Vi(o,o.return,De)}}function mv(a){var o=a.updateQueue;if(o!==null){var u=a.stateNode;try{Np(o,u)}catch(f){Vi(a,a.return,f)}}}function Xp(a,o,u){u.props=Wc(a.type,a.memoizedProps),u.state=a.memoizedState;try{u.componentWillUnmount()}catch(f){Vi(a,o,f)}}function Vu(a,o){try{var u=a.ref;if(u!==null){switch(a.tag){case 26:case 27:case 5:var f=a.stateNode;break;case 30:f=a.stateNode;break;default:f=a.stateNode}typeof u=="function"?a.refCleanup=u(f):u.current=f}}catch(v){Vi(a,o,v)}}function ca(a,o){var u=a.ref,f=a.refCleanup;if(u!==null)if(typeof f=="function")try{f()}catch(v){Vi(a,o,v)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(v){Vi(a,o,v)}else u.current=null}function _v(a){var o=a.type,u=a.memoizedProps,f=a.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":u.autoFocus&&f.focus();break e;case"img":u.src?f.src=u.src:u.srcSet&&(f.srcset=u.srcSet)}}catch(v){Vi(a,a.return,v)}}function Jp(a,o,u){try{var f=a.stateNode;HC(f,a.type,u,o),f[An]=o}catch(v){Vi(a,a.return,v)}}function Ev(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Ko(a.type)||a.tag===4}function hE(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||Ev(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Ko(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Zp(a,o,u){var f=a.tag;if(f===5||f===6)a=a.stateNode,o?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(a,o):(o=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,o.appendChild(a),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=$u));else if(f!==4&&(f===27&&Ko(a.type)&&(u=a.stateNode,o=null),a=a.child,a!==null))for(Zp(a,o,u),a=a.sibling;a!==null;)Zp(a,o,u),a=a.sibling}function Qp(a,o,u){var f=a.tag;if(f===5||f===6)a=a.stateNode,o?u.insertBefore(a,o):u.appendChild(a);else if(f!==4&&(f===27&&Ko(a.type)&&(u=a.stateNode),a=a.child,a!==null))for(Qp(a,o,u),a=a.sibling;a!==null;)Qp(a,o,u),a=a.sibling}function gv(a){var o=a.stateNode,u=a.memoizedProps;try{for(var f=a.type,v=o.attributes;v.length;)o.removeAttributeNode(v[0]);Gr(o,f,u),o[nn]=a,o[An]=u}catch(C){Vi(a,a.return,C)}}var cs=!1,sr=!1,Bu=!1,Sv=typeof WeakSet=="function"?WeakSet:Set,Fr=null;function ju(a,o){if(a=a.containerInfo,jE=wf,a=Vs(a),p_(a)){if("selectionStart"in a)var u={start:a.selectionStart,end:a.selectionEnd};else e:{u=(u=a.ownerDocument)&&u.defaultView||window;var f=u.getSelection&&u.getSelection();if(f&&f.rangeCount!==0){u=f.anchorNode;var v=f.anchorOffset,C=f.focusNode;f=f.focusOffset;try{u.nodeType,C.nodeType}catch{u=null;break e}var j=0,W=-1,ee=-1,_e=0,De=0,Ve=a,Re=null;t:for(;;){for(var Ce;Ve!==u||v!==0&&Ve.nodeType!==3||(W=j+v),Ve!==C||f!==0&&Ve.nodeType!==3||(ee=j+f),Ve.nodeType===3&&(j+=Ve.nodeValue.length),(Ce=Ve.firstChild)!==null;)Re=Ve,Ve=Ce;for(;;){if(Ve===a)break t;if(Re===u&&++_e===v&&(W=j),Re===C&&++De===f&&(ee=j),(Ce=Ve.nextSibling)!==null)break;Ve=Re,Re=Ve.parentNode}Ve=Ce}u=W===-1||ee===-1?null:{start:W,end:ee}}else u=null}u=u||{start:0,end:0}}else u=null;for(Td={focusedElem:a,selectionRange:u},wf=!1,Fr=o;Fr!==null;)if(o=Fr,a=o.child,(o.subtreeFlags&1024)!==0&&a!==null)a.return=o,Fr=a;else for(;Fr!==null;){switch(o=Fr,C=o.alternate,a=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&C!==null){a=void 0,u=o,v=C.memoizedProps,C=C.memoizedState,f=u.stateNode;try{var Dt=Wc(u.type,v,u.elementType===u.type);a=f.getSnapshotBeforeUpdate(Dt,C),f.__reactInternalSnapshotBeforeUpdate=a}catch(Rt){Vi(u,u.return,Rt)}}break;case 3:if((a&1024)!==0){if(a=o.stateNode.containerInfo,u=a.nodeType,u===9)HE(a);else if(u===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":HE(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(S(163))}if(a=o.sibling,a!==null){a.return=o.return,Fr=a;break}Fr=o.return}}function pE(a,o,u){var f=u.flags;switch(u.tag){case 0:case 11:case 15:En(a,u),f&4&&ad(5,u);break;case 1:if(En(a,u),f&4)if(a=u.stateNode,o===null)try{a.componentDidMount()}catch(j){Vi(u,u.return,j)}else{var v=Wc(u.type,o.memoizedProps);o=o.memoizedState;try{a.componentDidUpdate(v,o,a.__reactInternalSnapshotBeforeUpdate)}catch(j){Vi(u,u.return,j)}}f&64&&mv(u),f&512&&Vu(u,u.return);break;case 3:if(En(a,u),f&64&&(a=u.updateQueue,a!==null)){if(o=null,u.child!==null)switch(u.child.tag){case 27:case 5:o=u.child.stateNode;break;case 1:o=u.child.stateNode}try{Np(a,o)}catch(j){Vi(u,u.return,j)}}break;case 27:o===null&&f&4&&gv(u);case 26:case 5:En(a,u),o===null&&f&4&&_v(u),f&512&&Vu(u,u.return);break;case 12:En(a,u);break;case 13:En(a,u),f&4&&Tv(a,u),f&64&&(a=u.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(u=VC.bind(null,u),JC(a,u))));break;case 22:if(f=u.memoizedState!==null||cs,!f){o=o!==null&&o.memoizedState!==null||sr,v=cs;var C=sr;cs=f,(sr=o)&&!C?Dn(a,u,(u.subtreeFlags&8772)!==0):En(a,u),cs=v,sr=C}break;case 30:break;default:En(a,u)}}function sd(a){var o=a.alternate;o!==null&&(a.alternate=null,sd(o)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(o=a.stateNode,o!==null&&rp(o)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var wi=null,_n=!1;function ka(a,o,u){for(u=u.child;u!==null;)Fu(a,o,u),u=u.sibling}function Fu(a,o,u){if(dr&&typeof dr.onCommitFiberUnmount=="function")try{dr.onCommitFiberUnmount(Cl,u)}catch{}switch(u.tag){case 26:sr||ca(u,o),ka(a,o,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:sr||ca(u,o);var f=wi,v=_n;Ko(u.type)&&(wi=u.stateNode,_n=!1),ka(a,o,u),eh(u.stateNode),wi=f,_n=v;break;case 5:sr||ca(u,o);case 6:if(f=wi,v=_n,wi=null,ka(a,o,u),wi=f,_n=v,wi!==null)if(_n)try{(wi.nodeType===9?wi.body:wi.nodeName==="HTML"?wi.ownerDocument.body:wi).removeChild(u.stateNode)}catch(C){Vi(u,o,C)}else try{wi.removeChild(u.stateNode)}catch(C){Vi(u,o,C)}break;case 18:wi!==null&&(_n?(a=wi,xv(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,u.stateNode),dh(a)):xv(wi,u.stateNode));break;case 4:f=wi,v=_n,wi=u.stateNode.containerInfo,_n=!0,ka(a,o,u),wi=f,_n=v;break;case 0:case 11:case 14:case 15:sr||Vo(2,u,o),sr||Vo(4,u,o),ka(a,o,u);break;case 1:sr||(ca(u,o),f=u.stateNode,typeof f.componentWillUnmount=="function"&&Xp(u,o,f)),ka(a,o,u);break;case 21:ka(a,o,u);break;case 22:sr=(f=sr)||u.memoizedState!==null,ka(a,o,u),sr=f;break;default:ka(a,o,u)}}function Tv(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{dh(a)}catch(u){Vi(o,o.return,u)}}function LC(a){switch(a.tag){case 13:case 19:var o=a.stateNode;return o===null&&(o=a.stateNode=new Sv),o;case 22:return a=a.stateNode,o=a._retryCache,o===null&&(o=a._retryCache=new Sv),o;default:throw Error(S(435,a.tag))}}function fE(a,o){var u=LC(a);o.forEach(function(f){var v=BC.bind(null,a,f);u.has(f)||(u.add(f),f.then(v,v))})}function Nn(a,o){var u=o.deletions;if(u!==null)for(var f=0;f<u.length;f++){var v=u[f],C=a,j=o,W=j;e:for(;W!==null;){switch(W.tag){case 27:if(Ko(W.type)){wi=W.stateNode,_n=!1;break e}break;case 5:wi=W.stateNode,_n=!1;break e;case 3:case 4:wi=W.stateNode.containerInfo,_n=!0;break e}W=W.return}if(wi===null)throw Error(S(160));Fu(C,j,v),wi=null,_n=!1,C=v.alternate,C!==null&&(C.return=null),v.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)vv(o,a),o=o.sibling}var Ma=null;function vv(a,o){var u=a.alternate,f=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Nn(o,a),Xn(a),f&4&&(Vo(3,a,a.return),ad(3,a),Vo(5,a,a.return));break;case 1:Nn(o,a),Xn(a),f&512&&(sr||u===null||ca(u,u.return)),f&64&&cs&&(a=a.updateQueue,a!==null&&(f=a.callbacks,f!==null&&(u=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=u===null?f:u.concat(f))));break;case 26:var v=Ma;if(Nn(o,a),Xn(a),f&512&&(sr||u===null||ca(u,u.return)),f&4){var C=u!==null?u.memoizedState:null;if(f=a.memoizedState,u===null)if(f===null)if(a.stateNode===null){e:{f=a.type,u=a.memoizedProps,v=v.ownerDocument||v;t:switch(f){case"title":C=v.getElementsByTagName("title")[0],(!C||C[wl]||C[nn]||C.namespaceURI==="http://www.w3.org/2000/svg"||C.hasAttribute("itemprop"))&&(C=v.createElement(f),v.head.insertBefore(C,v.querySelector("head > title"))),Gr(C,f,u),C[nn]=a,wr(C),f=C;break e;case"link":var j=YE("link","href",v).get(f+(u.href||""));if(j){for(var W=0;W<j.length;W++)if(C=j[W],C.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&C.getAttribute("rel")===(u.rel==null?null:u.rel)&&C.getAttribute("title")===(u.title==null?null:u.title)&&C.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){j.splice(W,1);break t}}C=v.createElement(f),Gr(C,f,u),v.head.appendChild(C);break;case"meta":if(j=YE("meta","content",v).get(f+(u.content||""))){for(W=0;W<j.length;W++)if(C=j[W],C.getAttribute("content")===(u.content==null?null:""+u.content)&&C.getAttribute("name")===(u.name==null?null:u.name)&&C.getAttribute("property")===(u.property==null?null:u.property)&&C.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&C.getAttribute("charset")===(u.charSet==null?null:u.charSet)){j.splice(W,1);break t}}C=v.createElement(f),Gr(C,f,u),v.head.appendChild(C);break;default:throw Error(S(468,f))}C[nn]=a,wr(C),f=C}a.stateNode=f}else Wv(v,a.type,a.stateNode);else a.stateNode=yf(v,f,a.memoizedProps);else C!==f?(C===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):C.count--,f===null?Wv(v,a.type,a.stateNode):yf(v,f,a.memoizedProps)):f===null&&a.stateNode!==null&&Jp(a,a.memoizedProps,u.memoizedProps)}break;case 27:Nn(o,a),Xn(a),f&512&&(sr||u===null||ca(u,u.return)),u!==null&&f&4&&Jp(a,a.memoizedProps,u.memoizedProps);break;case 5:if(Nn(o,a),Xn(a),f&512&&(sr||u===null||ca(u,u.return)),a.flags&32){v=a.stateNode;try{Ro(v,"")}catch(Ce){Vi(a,a.return,Ce)}}f&4&&a.stateNode!=null&&(v=a.memoizedProps,Jp(a,v,u!==null?u.memoizedProps:v)),f&1024&&(Bu=!0);break;case 6:if(Nn(o,a),Xn(a),f&4){if(a.stateNode===null)throw Error(S(162));f=a.memoizedProps,u=a.stateNode;try{u.nodeValue=f}catch(Ce){Vi(a,a.return,Ce)}}break;case 3:if(bf=null,v=Ma,Ma=vf(o.containerInfo),Nn(o,a),Ma=v,Xn(a),f&4&&u!==null&&u.memoizedState.isDehydrated)try{dh(o.containerInfo)}catch(Ce){Vi(a,a.return,Ce)}Bu&&(Bu=!1,$p(a));break;case 4:f=Ma,Ma=vf(a.stateNode.containerInfo),Nn(o,a),Xn(a),Ma=f;break;case 12:Nn(o,a),Xn(a);break;case 13:Nn(o,a),Xn(a),a.child.flags&8192&&a.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(Ku=$a()),f&4&&(f=a.updateQueue,f!==null&&(a.updateQueue=null,fE(a,f)));break;case 22:v=a.memoizedState!==null;var ee=u!==null&&u.memoizedState!==null,_e=cs,De=sr;if(cs=_e||v,sr=De||ee,Nn(o,a),sr=De,cs=_e,Xn(a),f&8192)e:for(o=a.stateNode,o._visibility=v?o._visibility&-2:o._visibility|1,v&&(u===null||ee||cs||sr||zc(a)),u=null,o=a;;){if(o.tag===5||o.tag===26){if(u===null){ee=u=o;try{if(C=ee.stateNode,v)j=C.style,typeof j.setProperty=="function"?j.setProperty("display","none","important"):j.display="none";else{W=ee.stateNode;var Ve=ee.memoizedProps.style,Re=Ve!=null&&Ve.hasOwnProperty("display")?Ve.display:null;W.style.display=Re==null||typeof Re=="boolean"?"":(""+Re).trim()}}catch(Ce){Vi(ee,ee.return,Ce)}}}else if(o.tag===6){if(u===null){ee=o;try{ee.stateNode.nodeValue=v?"":ee.memoizedProps}catch(Ce){Vi(ee,ee.return,Ce)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===a)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break e;for(;o.sibling===null;){if(o.return===null||o.return===a)break e;u===o&&(u=null),o=o.return}u===o&&(u=null),o.sibling.return=o.return,o=o.sibling}f&4&&(f=a.updateQueue,f!==null&&(u=f.retryQueue,u!==null&&(f.retryQueue=null,fE(a,u))));break;case 19:Nn(o,a),Xn(a),f&4&&(f=a.updateQueue,f!==null&&(a.updateQueue=null,fE(a,f)));break;case 30:break;case 21:break;default:Nn(o,a),Xn(a)}}function Xn(a){var o=a.flags;if(o&2){try{for(var u,f=a.return;f!==null;){if(Ev(f)){u=f;break}f=f.return}if(u==null)throw Error(S(160));switch(u.tag){case 27:var v=u.stateNode,C=hE(a);Qp(a,C,v);break;case 5:var j=u.stateNode;u.flags&32&&(Ro(j,""),u.flags&=-33);var W=hE(a);Qp(a,W,j);break;case 3:case 4:var ee=u.stateNode.containerInfo,_e=hE(a);Zp(a,_e,ee);break;default:throw Error(S(161))}}catch(De){Vi(a,a.return,De)}a.flags&=-3}o&4096&&(a.flags&=-4097)}function $p(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var o=a;$p(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),a=a.sibling}}function En(a,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)pE(a,o.alternate,o),o=o.sibling}function zc(a){for(a=a.child;a!==null;){var o=a;switch(o.tag){case 0:case 11:case 14:case 15:Vo(4,o,o.return),zc(o);break;case 1:ca(o,o.return);var u=o.stateNode;typeof u.componentWillUnmount=="function"&&Xp(o,o.return,u),zc(o);break;case 27:eh(o.stateNode);case 26:case 5:ca(o,o.return),zc(o);break;case 22:o.memoizedState===null&&zc(o);break;case 30:zc(o);break;default:zc(o)}a=a.sibling}}function Dn(a,o,u){for(u=u&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var f=o.alternate,v=a,C=o,j=C.flags;switch(C.tag){case 0:case 11:case 15:Dn(v,C,u),ad(4,C);break;case 1:if(Dn(v,C,u),f=C,v=f.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(_e){Vi(f,f.return,_e)}if(f=C,v=f.updateQueue,v!==null){var W=f.stateNode;try{var ee=v.shared.hiddenCallbacks;if(ee!==null)for(v.shared.hiddenCallbacks=null,v=0;v<ee.length;v++)M_(ee[v],W)}catch(_e){Vi(f,f.return,_e)}}u&&j&64&&mv(C),Vu(C,C.return);break;case 27:gv(C);case 26:case 5:Dn(v,C,u),u&&f===null&&j&4&&_v(C),Vu(C,C.return);break;case 12:Dn(v,C,u);break;case 13:Dn(v,C,u),u&&j&4&&Tv(v,C);break;case 22:C.memoizedState===null&&Dn(v,C,u),Vu(C,C.return);break;case 30:break;default:Dn(v,C,u)}o=o.sibling}}function ef(a,o){var u=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),a=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(a=o.memoizedState.cachePool.pool),a!==u&&(a!=null&&a.refCount++,u!=null&&mu(u))}function gn(a,o){a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&mu(a))}function ls(a,o,u,f){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)Rv(a,o,u,f),o=o.sibling}function Rv(a,o,u,f){var v=o.flags;switch(o.tag){case 0:case 11:case 15:ls(a,o,u,f),v&2048&&ad(9,o);break;case 1:ls(a,o,u,f);break;case 3:ls(a,o,u,f),v&2048&&(a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&mu(a)));break;case 12:if(v&2048){ls(a,o,u,f),a=o.stateNode;try{var C=o.memoizedProps,j=C.id,W=C.onPostCommit;typeof W=="function"&&W(j,o.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(ee){Vi(o,o.return,ee)}}else ls(a,o,u,f);break;case 13:ls(a,o,u,f);break;case 23:break;case 22:C=o.stateNode,j=o.alternate,o.memoizedState!==null?C._visibility&2?ls(a,o,u,f):Gu(a,o):C._visibility&2?ls(a,o,u,f):(C._visibility|=2,Kc(a,o,u,f,(o.subtreeFlags&10256)!==0)),v&2048&&ef(j,o);break;case 24:ls(a,o,u,f),v&2048&&gn(o.alternate,o);break;default:ls(a,o,u,f)}}function Kc(a,o,u,f,v){for(v=v&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var C=a,j=o,W=u,ee=f,_e=j.flags;switch(j.tag){case 0:case 11:case 15:Kc(C,j,W,ee,v),ad(8,j);break;case 23:break;case 22:var De=j.stateNode;j.memoizedState!==null?De._visibility&2?Kc(C,j,W,ee,v):Gu(C,j):(De._visibility|=2,Kc(C,j,W,ee,v)),v&&_e&2048&&ef(j.alternate,j);break;case 24:Kc(C,j,W,ee,v),v&&_e&2048&&gn(j.alternate,j);break;default:Kc(C,j,W,ee,v)}o=o.sibling}}function Gu(a,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var u=a,f=o,v=f.flags;switch(f.tag){case 22:Gu(u,f),v&2048&&ef(f.alternate,f);break;case 24:Gu(u,f),v&2048&&gn(f.alternate,f);break;default:Gu(u,f)}o=o.sibling}}var od=8192;function Yc(a){if(a.subtreeFlags&od)for(a=a.child;a!==null;)yv(a),a=a.sibling}function yv(a){switch(a.tag){case 26:Yc(a),a.flags&od&&a.memoizedState!==null&&sb(Ma,a.memoizedState,a.memoizedProps);break;case 5:Yc(a);break;case 3:case 4:var o=Ma;Ma=vf(a.stateNode.containerInfo),Yc(a),Ma=o;break;case 22:a.memoizedState===null&&(o=a.alternate,o!==null&&o.memoizedState!==null?(o=od,od=16777216,Yc(a),od=o):Yc(a));break;default:Yc(a)}}function mE(a){var o=a.alternate;if(o!==null&&(a=o.child,a!==null)){o.child=null;do o=a.sibling,a.sibling=null,a=o;while(a!==null)}}function Hu(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var f=o[u];Fr=f,rf(f,a)}mE(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Cv(a),a=a.sibling}function Cv(a){switch(a.tag){case 0:case 11:case 15:Hu(a),a.flags&2048&&Vo(9,a,a.return);break;case 3:Hu(a);break;case 12:Hu(a);break;case 22:var o=a.stateNode;a.memoizedState!==null&&o._visibility&2&&(a.return===null||a.return.tag!==13)?(o._visibility&=-3,tf(a)):Hu(a);break;default:Hu(a)}}function tf(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var f=o[u];Fr=f,rf(f,a)}mE(a)}for(a=a.child;a!==null;){switch(o=a,o.tag){case 0:case 11:case 15:Vo(8,o,o.return),tf(o);break;case 22:u=o.stateNode,u._visibility&2&&(u._visibility&=-3,tf(o));break;default:tf(o)}a=a.sibling}}function rf(a,o){for(;Fr!==null;){var u=Fr;switch(u.tag){case 0:case 11:case 15:Vo(8,u,o);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var f=u.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:mu(u.memoizedState.cache)}if(f=u.child,f!==null)f.return=u,Fr=f;else e:for(u=a;Fr!==null;){f=Fr;var v=f.sibling,C=f.return;if(sd(f),f===u){Fr=null;break e}if(v!==null){v.return=C,Fr=v;break e}Fr=C}}}var _E={getCacheForType:function(a){var o=Or(Sr),u=o.data.get(a);return u===void 0&&(u=a(),o.data.set(a,u)),u}},kC=typeof WeakMap=="function"?WeakMap:Map,Ti=0,Hi=null,ei=null,li=0,vi=0,Jr=null,Ks=!1,Bo=!1,Wu=!1,ds=0,ir=0,xa=0,jo=0,EE=0,la=0,qc=0,cd=null,Pr=null,zu=!1,Ku=0,ld=1/0,Yu=null,Ys=null,Zr=0,Fo=null,Ua=null,dd=0,nf=0,qu=null,bv=null,Xu=0,gE=null;function Jn(){if((Ti&2)!==0&&li!==0)return li&-li;if(Ne.T!==null){var a=Wl;return a!==0?a:md()}return PS()}function af(){la===0&&(la=(li&536870912)===0||Si?Gm():536870912);var a=Nr.current;return a!==null&&(a.flags|=32),la}function Pn(a,o,u){(a===Hi&&(vi===2||vi===9)||a.cancelPendingCommit!==null)&&(Jc(a,0),us(a,li,la,!1)),iu(a,u),((Ti&2)===0||a!==Hi)&&(a===Hi&&((Ti&2)===0&&(jo|=u),ir===4&&us(a,li,la,!1)),da(a))}function SE(a,o,u){if((Ti&6)!==0)throw Error(S(327));var f=!u&&(o&124)===0&&(o&a.expiredLanes)===0||tu(a,o),v=f?xC(a,o):vE(a,o,!0),C=f;do{if(v===0){Bo&&!f&&us(a,o,0,!1);break}else{if(u=a.current.alternate,C&&!sf(u)){v=vE(a,o,!1),C=!1;continue}if(v===2){if(C=o,a.errorRecoveryDisabledLanes&C)var j=0;else j=a.pendingLanes&-536870913,j=j!==0?j:j&536870912?536870912:0;if(j!==0){o=j;e:{var W=a;v=cd;var ee=W.current.memoizedState.isDehydrated;if(ee&&(Jc(W,j).flags|=256),j=vE(W,j,!1),j!==2){if(Wu&&!ee){W.errorRecoveryDisabledLanes|=C,jo|=C,v=4;break e}C=Pr,Pr=v,C!==null&&(Pr===null?Pr=C:Pr.push.apply(Pr,C))}v=j}if(C=!1,v!==2)continue}}if(v===1){Jc(a,0),us(a,o,0,!0);break}e:{switch(f=a,C=v,C){case 0:case 1:throw Error(S(345));case 4:if((o&4194048)!==o)break;case 6:us(f,o,la,!Ks);break e;case 2:Pr=null;break;case 3:case 5:break;default:throw Error(S(329))}if((o&62914560)===o&&(v=Ku+300-$a(),10<v)){if(us(f,o,la,!Ks),tp(f,0,!0)!==0)break e;f.timeoutHandle=kv(TE.bind(null,f,u,Pr,Yu,zu,o,la,jo,qc,Ks,C,2,-0,0),v);break e}TE(f,u,Pr,Yu,zu,o,la,jo,qc,Ks,C,0,-0,0)}}break}while(!0);da(a)}function TE(a,o,u,f,v,C,j,W,ee,_e,De,Ve,Re,Ce){if(a.timeoutHandle=-1,Ve=o.subtreeFlags,(Ve&8192||(Ve&16785408)===16785408)&&(ih={stylesheets:null,count:0,unsuspend:ab},yv(o),Ve=Kv(),Ve!==null)){a.cancelPendingCommit=Ve(wv.bind(null,a,o,C,u,f,v,j,W,ee,De,1,Re,Ce)),us(a,C,j,!_e);return}wv(a,o,C,u,f,v,j,W,ee)}function sf(a){for(var o=a;;){var u=o.tag;if((u===0||u===11||u===15)&&o.flags&16384&&(u=o.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var f=0;f<u.length;f++){var v=u[f],C=v.getSnapshot;v=v.value;try{if(!Wn(C(),v))return!1}catch{return!1}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function us(a,o,u,f){o&=~EE,o&=~jo,a.suspendedLanes|=o,a.pingedLanes&=~o,f&&(a.warmLanes|=o),f=a.expirationTimes;for(var v=o;0<v;){var C=31-mn(v),j=1<<C;f[C]=-1,v&=~j}u!==0&&Al(a,u,o)}function Xc(){return(Ti&6)===0?(Ju(0),!1):!0}function ud(){if(ei!==null){if(vi===0)var a=ei.return;else a=ei,Gs=Lc=null,B_(a),Gc=null,Pa=0,a=ei;for(;a!==null;)fv(a.alternate,a),a=a.return;ei=null}}function Jc(a,o){var u=a.timeoutHandle;u!==-1&&(a.timeoutHandle=-1,zC(u)),u=a.cancelPendingCommit,u!==null&&(a.cancelPendingCommit=null,u()),ud(),Hi=a,ei=u=js(a.current,null),li=o,vi=0,Jr=null,Ks=!1,Bo=tu(a,o),Wu=!1,qc=la=EE=jo=xa=ir=0,Pr=cd=null,zu=!1,(o&8)!==0&&(o|=o&32);var f=a.entangledLanes;if(f!==0)for(a=a.entanglements,f&=o;0<f;){var v=31-mn(f),C=1<<v;o|=a[v],f&=~C}return ds=o,wc(),u}function Zc(a,o){zt=null,Ne.H=qn,o===Mc||o===wp?(o=IT(),vi=3):o===bT?(o=IT(),vi=4):vi=o===sv?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,Jr=o,ei===null&&(ir=1,Wp(a,zn(o,a.current)))}function Go(){var a=Ne.H;return Ne.H=qn,a===null?qn:a}function Av(){var a=Ne.A;return Ne.A=_E,a}function Qc(){ir=4,Ks||(li&4194048)!==li&&Nr.current!==null||(Bo=!0),(xa&134217727)===0&&(jo&134217727)===0||Hi===null||us(Hi,li,la,!1)}function vE(a,o,u){var f=Ti;Ti|=2;var v=Go(),C=Av();(Hi!==a||li!==o)&&(Yu=null,Jc(a,o)),o=!1;var j=ir;e:do try{if(vi!==0&&ei!==null){var W=ei,ee=Jr;switch(vi){case 8:ud(),j=6;break e;case 3:case 2:case 9:case 6:Nr.current===null&&(o=!0);var _e=vi;if(vi=0,Jr=null,$c(a,W,ee,_e),u&&Bo){j=0;break e}break;default:_e=vi,vi=0,Jr=null,$c(a,W,ee,_e)}}MC(),j=ir;break}catch(De){Zc(a,De)}while(!0);return o&&a.shellSuspendCounter++,Gs=Lc=null,Ti=f,Ne.H=v,Ne.A=C,ei===null&&(Hi=null,li=0,wc()),j}function MC(){for(;ei!==null;)RE(ei)}function xC(a,o){var u=Ti;Ti|=2;var f=Go(),v=Av();Hi!==a||li!==o?(Yu=null,ld=$a()+500,Jc(a,o)):Bo=tu(a,o);e:do try{if(vi!==0&&ei!==null){o=ei;var C=Jr;t:switch(vi){case 1:vi=0,Jr=null,$c(a,o,C,1);break;case 2:case 9:if(AT(C)){vi=0,Jr=null,of(o);break}o=function(){vi!==2&&vi!==9||Hi!==a||(vi=7),da(a)},C.then(o,o);break e;case 3:vi=7;break e;case 4:vi=5;break e;case 7:AT(C)?(vi=0,Jr=null,of(o)):(vi=0,Jr=null,$c(a,o,C,7));break;case 5:var j=null;switch(ei.tag){case 26:j=ei.memoizedState;case 5:case 27:var W=ei;if(!j||zv(j)){vi=0,Jr=null;var ee=W.sibling;if(ee!==null)ei=ee;else{var _e=W.return;_e!==null?(ei=_e,cf(_e)):ei=null}break t}}vi=0,Jr=null,$c(a,o,C,5);break;case 6:vi=0,Jr=null,$c(a,o,C,6);break;case 8:ud(),ir=6;break e;default:throw Error(S(462))}}UC();break}catch(De){Zc(a,De)}while(!0);return Gs=Lc=null,Ne.H=f,Ne.A=v,Ti=u,ei!==null?0:(Hi=null,li=0,wc(),ir)}function UC(){for(;ei!==null&&!Hy();)RE(ei)}function RE(a){var o=xu(a.alternate,a,ds);a.memoizedProps=a.pendingProps,o===null?cf(a):ei=o}function of(a){var o=a,u=o.alternate;switch(o.tag){case 15:case 0:o=sE(u,o,o.pendingProps,o.type,void 0,li);break;case 11:o=sE(u,o,o.pendingProps,o.type.render,o.ref,li);break;case 5:B_(o);default:fv(u,o),o=ei=Sp(o,ds),o=xu(u,o,ds)}a.memoizedProps=a.pendingProps,o===null?cf(a):ei=o}function $c(a,o,u,f){Gs=Lc=null,B_(o),Gc=null,Pa=0;var v=o.return;try{if(OC(a,v,o,u,li)){ir=1,Wp(a,zn(u,a.current)),ei=null;return}}catch(C){if(v!==null)throw ei=v,C;ir=1,Wp(a,zn(u,a.current)),ei=null;return}o.flags&32768?(Si||f===1?a=!0:Bo||(li&536870912)!==0?a=!1:(Ks=a=!0,(f===2||f===9||f===3||f===6)&&(f=Nr.current,f!==null&&f.tag===13&&(f.flags|=16384))),yE(o,a)):cf(o)}function cf(a){var o=a;do{if((o.flags&32768)!==0){yE(o,Ks);return}a=o.return;var u=DC(o.alternate,o,ds);if(u!==null){ei=u;return}if(o=o.sibling,o!==null){ei=o;return}ei=o=a}while(o!==null);ir===0&&(ir=5)}function yE(a,o){do{var u=PC(a.alternate,a);if(u!==null){u.flags&=32767,ei=u;return}if(u=a.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!o&&(a=a.sibling,a!==null)){ei=a;return}ei=a=u}while(a!==null);ir=6,ei=null}function wv(a,o,u,f,v,C,j,W,ee){a.cancelPendingCommit=null;do lf();while(Zr!==0);if((Ti&6)!==0)throw Error(S(327));if(o!==null){if(o===a.current)throw Error(S(177));if(C=o.lanes|o.childLanes,C|=T_,zy(a,u,C,j,W,ee),a===Hi&&(ei=Hi=null,li=0),Ua=o,Fo=a,dd=u,nf=C,qu=v,bv=f,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,jC(yl,function(){return df(),null})):(a.callbackNode=null,a.callbackPriority=0),f=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||f){f=Ne.T,Ne.T=null,v=We.p,We.p=2,j=Ti,Ti|=4;try{ju(a,o,u)}finally{Ti=j,We.p=v,Ne.T=f}}Zr=1,hd(),Va(),CE()}}function hd(){if(Zr===1){Zr=0;var a=Fo,o=Ua,u=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||u){u=Ne.T,Ne.T=null;var f=We.p;We.p=2;var v=Ti;Ti|=4;try{vv(o,a);var C=Td,j=Vs(a.containerInfo),W=C.focusedElem,ee=C.selectionRange;if(j!==W&&W&&W.ownerDocument&&hT(W.ownerDocument.documentElement,W)){if(ee!==null&&p_(W)){var _e=ee.start,De=ee.end;if(De===void 0&&(De=_e),"selectionStart"in W)W.selectionStart=_e,W.selectionEnd=Math.min(De,W.value.length);else{var Ve=W.ownerDocument||document,Re=Ve&&Ve.defaultView||window;if(Re.getSelection){var Ce=Re.getSelection(),Dt=W.textContent.length,Rt=Math.min(ee.start,Dt),Mi=ee.end===void 0?Rt:Math.min(ee.end,Dt);!Ce.extend&&Rt>Mi&&(j=Mi,Mi=Rt,Rt=j);var pe=uT(W,Rt),le=uT(W,Mi);if(pe&&le&&(Ce.rangeCount!==1||Ce.anchorNode!==pe.node||Ce.anchorOffset!==pe.offset||Ce.focusNode!==le.node||Ce.focusOffset!==le.offset)){var Ee=Ve.createRange();Ee.setStart(pe.node,pe.offset),Ce.removeAllRanges(),Rt>Mi?(Ce.addRange(Ee),Ce.extend(le.node,le.offset)):(Ee.setEnd(le.node,le.offset),Ce.addRange(Ee))}}}}for(Ve=[],Ce=W;Ce=Ce.parentNode;)Ce.nodeType===1&&Ve.push({element:Ce,left:Ce.scrollLeft,top:Ce.scrollTop});for(typeof W.focus=="function"&&W.focus(),W=0;W<Ve.length;W++){var Me=Ve[W];Me.element.scrollLeft=Me.left,Me.element.scrollTop=Me.top}}wf=!!jE,Td=jE=null}finally{Ti=v,We.p=f,Ne.T=u}}a.current=o,Zr=2}}function Va(){if(Zr===2){Zr=0;var a=Fo,o=Ua,u=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||u){u=Ne.T,Ne.T=null;var f=We.p;We.p=2;var v=Ti;Ti|=4;try{pE(a,o.alternate,o)}finally{Ti=v,We.p=f,Ne.T=u}}Zr=3}}function CE(){if(Zr===4||Zr===3){Zr=0,go();var a=Fo,o=Ua,u=dd,f=bv;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?Zr=5:(Zr=0,Ua=Fo=null,Iv(a,a.pendingLanes));var v=a.pendingLanes;if(v===0&&(Ys=null),Wm(u),o=o.stateNode,dr&&typeof dr.onCommitFiberRoot=="function")try{dr.onCommitFiberRoot(Cl,o,void 0,(o.current.flags&128)===128)}catch{}if(f!==null){o=Ne.T,v=We.p,We.p=2,Ne.T=null;try{for(var C=a.onRecoverableError,j=0;j<f.length;j++){var W=f[j];C(W.value,{componentStack:W.stack})}}finally{Ne.T=o,We.p=v}}(dd&3)!==0&&lf(),da(a),v=a.pendingLanes,(u&4194090)!==0&&(v&42)!==0?a===gE?Xu++:(Xu=0,gE=a):Xu=0,Ju(0)}}function Iv(a,o){(a.pooledCacheLanes&=o)===0&&(o=a.pooledCache,o!=null&&(a.pooledCache=null,mu(o)))}function lf(a){return hd(),Va(),CE(),df()}function df(){if(Zr!==5)return!1;var a=Fo,o=nf;nf=0;var u=Wm(dd),f=Ne.T,v=We.p;try{We.p=32>u?32:u,Ne.T=null,u=qu,qu=null;var C=Fo,j=dd;if(Zr=0,Ua=Fo=null,dd=0,(Ti&6)!==0)throw Error(S(331));var W=Ti;if(Ti|=4,Cv(C.current),Rv(C,C.current,j,u),Ti=W,Ju(0,!1),dr&&typeof dr.onPostCommitFiberRoot=="function")try{dr.onPostCommitFiberRoot(Cl,C)}catch{}return!0}finally{We.p=v,Ne.T=f,Iv(a,o)}}function bE(a,o,u){o=zn(u,o),o=La(a.stateNode,o,2),a=Ws(a,o,2),a!==null&&(iu(a,2),da(a))}function Vi(a,o,u){if(a.tag===3)bE(a,a,u);else for(;o!==null;){if(o.tag===3){bE(o,a,u);break}else if(o.tag===1){var f=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Ys===null||!Ys.has(f))){a=zn(u,a),u=nv(2),f=Ws(o,u,2),f!==null&&(av(u,f,o,a),iu(f,2),da(f));break}}o=o.return}}function pd(a,o,u){var f=a.pingCache;if(f===null){f=a.pingCache=new kC;var v=new Set;f.set(o,v)}else v=f.get(o),v===void 0&&(v=new Set,f.set(o,v));v.has(u)||(Wu=!0,v.add(u),a=Ho.bind(null,a,o,u),o.then(a,a))}function Ho(a,o,u){var f=a.pingCache;f!==null&&f.delete(o),a.pingedLanes|=a.suspendedLanes&u,a.warmLanes&=~u,Hi===a&&(li&u)===u&&(ir===4||ir===3&&(li&62914560)===li&&300>$a()-Ku?(Ti&2)===0&&Jc(a,0):EE|=u,qc===li&&(qc=0)),da(a)}function fd(a,o){o===0&&(o=NS()),a=jl(a,o),a!==null&&(iu(a,o),da(a))}function VC(a){var o=a.memoizedState,u=0;o!==null&&(u=o.retryLane),fd(a,u)}function BC(a,o){var u=0;switch(a.tag){case 13:var f=a.stateNode,v=a.memoizedState;v!==null&&(u=v.retryLane);break;case 19:f=a.stateNode;break;case 22:f=a.stateNode._retryCache;break;default:throw Error(S(314))}f!==null&&f.delete(o),fd(a,u)}function jC(a,o){return Ls(a,o)}var uf=null,Wo=null,AE=!1,hf=!1,wE=!1,zo=0;function da(a){a!==Wo&&a.next===null&&(Wo===null?uf=Wo=a:Wo=Wo.next=a),hf=!0,AE||(AE=!0,Nv())}function Ju(a,o){if(!wE&&hf){wE=!0;do for(var u=!1,f=uf;f!==null;){if(a!==0){var v=f.pendingLanes;if(v===0)var C=0;else{var j=f.suspendedLanes,W=f.pingedLanes;C=(1<<31-mn(42|a)+1)-1,C&=v&~(j&~W),C=C&201326741?C&201326741|1:C?C|2:0}C!==0&&(u=!0,OE(f,C))}else C=li,C=tp(f,f===Hi?C:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(C&3)===0||tu(f,C)||(u=!0,OE(f,C));f=f.next}while(u);wE=!1}}function FC(){Ov()}function Ov(){hf=AE=!1;var a=0;zo!==0&&(WC()&&(a=zo),zo=0);for(var o=$a(),u=null,f=uf;f!==null;){var v=f.next,C=IE(f,o);C===0?(f.next=null,u===null?uf=v:u.next=v,v===null&&(Wo=u)):(u=f,(a!==0||(C&3)!==0)&&(hf=!0)),f=v}Ju(a)}function IE(a,o){for(var u=a.suspendedLanes,f=a.pingedLanes,v=a.expirationTimes,C=a.pendingLanes&-62914561;0<C;){var j=31-mn(C),W=1<<j,ee=v[j];ee===-1?((W&u)===0||(W&f)!==0)&&(v[j]=bl(W,o)):ee<=o&&(a.expiredLanes|=W),C&=~W}if(o=Hi,u=li,u=tp(a,a===o?u:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),f=a.callbackNode,u===0||a===o&&(vi===2||vi===9)||a.cancelPendingCommit!==null)return f!==null&&f!==null&&jm(f),a.callbackNode=null,a.callbackPriority=0;if((u&3)===0||tu(a,u)){if(o=u&-u,o===a.callbackPriority)return o;switch(f!==null&&jm(f),Wm(u)){case 2:case 8:u=ep;break;case 32:u=yl;break;case 268435456:u=Fm;break;default:u=yl}return f=pf.bind(null,a),u=Ls(u,f),a.callbackPriority=o,a.callbackNode=u,o}return f!==null&&f!==null&&jm(f),a.callbackPriority=2,a.callbackNode=null,2}function pf(a,o){if(Zr!==0&&Zr!==5)return a.callbackNode=null,a.callbackPriority=0,null;var u=a.callbackNode;if(lf()&&a.callbackNode!==u)return null;var f=li;return f=tp(a,a===Hi?f:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),f===0?null:(SE(a,f,o),IE(a,$a()),a.callbackNode!=null&&a.callbackNode===u?pf.bind(null,a):null)}function OE(a,o){if(lf())return null;SE(a,o,!0)}function Nv(){KC(function(){(Ti&6)!==0?Ls(bn,FC):Ov()})}function md(){return zo===0&&(zo=Gm()),zo}function NE(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:dp(""+a)}function Dv(a,o){var u=o.ownerDocument.createElement("input");return u.name=o.name,u.value=o.value,a.id&&u.setAttribute("form",a.id),o.parentNode.insertBefore(u,o),a=new FormData(a),u.parentNode.removeChild(u),a}function DE(a,o,u,f,v){if(o==="submit"&&u&&u.stateNode===v){var C=NE((v[An]||null).action),j=f.submitter;j&&(o=(o=j[An]||null)?NE(o.formAction):j.getAttribute("formAction"),o!==null&&(C=o,j=null));var W=new Ia("action","action",null,f,v);a.push({event:W,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(zo!==0){var ee=j?Dv(v,j):new FormData(v);$l(u,{pending:!0,data:ee,method:v.method,action:C},null,ee)}}else typeof C=="function"&&(W.preventDefault(),ee=j?Dv(v,j):new FormData(v),$l(u,{pending:!0,data:ee,method:v.method,action:C},C,ee))},currentTarget:v}]})}}for(var PE=0;PE<g_.length;PE++){var LE=g_[PE],Zu=LE.toLowerCase(),kE=LE[0].toUpperCase()+LE.slice(1);Oa(Zu,"on"+kE)}Oa(mT,"onAnimationEnd"),Oa(_T,"onAnimationIteration"),Oa(gp,"onAnimationStart"),Oa("dblclick","onDoubleClick"),Oa("focusin","onFocus"),Oa("focusout","onBlur"),Oa(E_,"onTransitionRun"),Oa(SC,"onTransitionStart"),Oa(ve,"onTransitionCancel"),Oa(ET,"onTransitionEnd"),Nl("onMouseEnter",["mouseout","mouseover"]),Nl("onMouseLeave",["mouseout","mouseover"]),Nl("onPointerEnter",["pointerout","pointerover"]),Nl("onPointerLeave",["pointerout","pointerover"]),ra("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ra("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ra("onBeforeInput",["compositionend","keypress","textInput","paste"]),ra("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ra("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ra("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var _d="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ME=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(_d));function ff(a,o){o=(o&4)!==0;for(var u=0;u<a.length;u++){var f=a[u],v=f.event;f=f.listeners;e:{var C=void 0;if(o)for(var j=f.length-1;0<=j;j--){var W=f[j],ee=W.instance,_e=W.currentTarget;if(W=W.listener,ee!==C&&v.isPropagationStopped())break e;C=W,v.currentTarget=_e;try{C(v)}catch(De){Hp(De)}v.currentTarget=null,C=ee}else for(j=0;j<f.length;j++){if(W=f[j],ee=W.instance,_e=W.currentTarget,W=W.listener,ee!==C&&v.isPropagationStopped())break e;C=W,v.currentTarget=_e;try{C(v)}catch(De){Hp(De)}v.currentTarget=null,C=ee}}}}function Xt(a,o){var u=o[ip];u===void 0&&(u=o[ip]=new Set);var f=a+"__bubble";u.has(f)||(UE(o,a,2,!1),u.add(f))}function xE(a,o,u){var f=0;o&&(f|=4),UE(u,a,f,o)}var mf="_reactListening"+Math.random().toString(36).slice(2);function _f(a){if(!a[mf]){a[mf]=!0,np.forEach(function(u){u!=="selectionchange"&&(ME.has(u)||xE(u,!1,a),xE(u,!0,a))});var o=a.nodeType===9?a:a.ownerDocument;o===null||o[mf]||(o[mf]=!0,xE("selectionchange",!1,o))}}function UE(a,o,u,f){switch(Zv(o)){case 2:var v=cb;break;case 8:v=lb;break;default:v=If}u=v.bind(null,o,u,a),v=void 0,!e_||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(v=!0),f?v!==void 0?a.addEventListener(o,u,{capture:!0,passive:v}):a.addEventListener(o,u,!0):v!==void 0?a.addEventListener(o,u,{passive:v}):a.addEventListener(o,u,!1)}function Ef(a,o,u,f,v){var C=f;if((o&1)===0&&(o&2)===0&&f!==null)e:for(;;){if(f===null)return;var j=f.tag;if(j===3||j===4){var W=f.stateNode.containerInfo;if(W===v)break;if(j===4)for(j=f.return;j!==null;){var ee=j.tag;if((ee===3||ee===4)&&j.stateNode.containerInfo===v)return;j=j.return}for(;W!==null;){if(j=Il(W),j===null)return;if(ee=j.tag,ee===5||ee===6||ee===26||ee===27){f=C=j;continue e}W=W.parentNode}}f=f.return}YS(function(){var _e=C,De=Qm(u),Ve=[];e:{var Re=gT.get(a);if(Re!==void 0){var Ce=Ia,Dt=a;switch(a){case"keypress":if(hp(u)===0)break e;case"keydown":case"keyup":Ce=nC;break;case"focusin":Dt="focus",Ce=fp;break;case"focusout":Dt="blur",Ce=fp;break;case"beforeblur":case"afterblur":Ce=fp;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ce=ZS;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ce=Qy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ce=sC;break;case mT:case _T:case gp:Ce=n_;break;case ET:Ce=$S;break;case"scroll":case"scrollend":Ce=JS;break;case"wheel":Ce=Vt;break;case"copy":case"cut":case"paste":Ce=a_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ce=QS;break;case"toggle":case"beforetoggle":Ce=lC}var Rt=(o&4)!==0,Mi=!Rt&&(a==="scroll"||a==="scrollend"),pe=Rt?Re!==null?Re+"Capture":null:Re;Rt=[];for(var le=_e,Ee;le!==null;){var Me=le;if(Ee=Me.stateNode,Me=Me.tag,Me!==5&&Me!==26&&Me!==27||Ee===null||pe===null||(Me=kl(le,pe),Me!=null&&Rt.push(Ed(le,Me,Ee))),Mi)break;le=le.return}0<Rt.length&&(Re=new Ce(Re,Dt,null,u,De),Ve.push({event:Re,listeners:Rt}))}}if((o&7)===0){e:{if(Re=a==="mouseover"||a==="pointerover",Ce=a==="mouseout"||a==="pointerout",Re&&u!==Zm&&(Dt=u.relatedTarget||u.fromElement)&&(Il(Dt)||Dt[Ms]))break e;if((Ce||Re)&&(Re=De.window===De?De:(Re=De.ownerDocument)?Re.defaultView||Re.parentWindow:window,Ce?(Dt=u.relatedTarget||u.toElement,Ce=_e,Dt=Dt?Il(Dt):null,Dt!==null&&(Mi=I(Dt),Rt=Dt.tag,Dt!==Mi||Rt!==5&&Rt!==27&&Rt!==6)&&(Dt=null)):(Ce=null,Dt=_e),Ce!==Dt)){if(Rt=ZS,Me="onMouseLeave",pe="onMouseEnter",le="mouse",(a==="pointerout"||a==="pointerover")&&(Rt=QS,Me="onPointerLeave",pe="onPointerEnter",le="pointer"),Mi=Ce==null?Re:ru(Ce),Ee=Dt==null?Re:ru(Dt),Re=new Rt(Me,le+"leave",Ce,u,De),Re.target=Mi,Re.relatedTarget=Ee,Me=null,Il(De)===_e&&(Rt=new Rt(pe,le+"enter",Dt,u,De),Rt.target=Ee,Rt.relatedTarget=Mi,Me=Rt),Mi=Me,Ce&&Dt)t:{for(Rt=Ce,pe=Dt,le=0,Ee=Rt;Ee;Ee=gd(Ee))le++;for(Ee=0,Me=pe;Me;Me=gd(Me))Ee++;for(;0<le-Ee;)Rt=gd(Rt),le--;for(;0<Ee-le;)pe=gd(pe),Ee--;for(;le--;){if(Rt===pe||pe!==null&&Rt===pe.alternate)break t;Rt=gd(Rt),pe=gd(pe)}Rt=null}else Rt=null;Ce!==null&&VE(Ve,Re,Ce,Rt,!1),Dt!==null&&Mi!==null&&VE(Ve,Mi,Dt,Rt,!0)}}e:{if(Re=_e?ru(_e):window,Ce=Re.nodeName&&Re.nodeName.toLowerCase(),Ce==="select"||Ce==="input"&&Re.type==="file")var ct=sT;else if(nT(Re))if(Hn)ct=h_;else{ct=_C;var ti=mC}else Ce=Re.nodeName,!Ce||Ce.toLowerCase()!=="input"||Re.type!=="checkbox"&&Re.type!=="radio"?_e&&nu(_e.elementType)&&(ct=sT):ct=lT;if(ct&&(ct=ct(a,_e))){aT(Ve,ct,u,De);break e}ti&&ti(a,Re,_e),a==="focusout"&&_e&&Re.type==="number"&&_e.memoizedProps.value!=null&&Jm(Re,"number",Re.value)}switch(ti=_e?ru(_e):window,a){case"focusin":(nT(ti)||ti.contentEditable==="true")&&(Ir=ti,f_=_e,lu=null);break;case"focusout":lu=f_=Ir=null;break;case"mousedown":m_=!0;break;case"contextmenu":case"mouseup":case"dragend":m_=!1,pT(Ve,u,De);break;case"selectionchange":if(gC)break;case"keydown":case"keyup":pT(Ve,u,De)}var mt;if(c_)e:{switch(a){case"compositionstart":var wt="onCompositionStart";break e;case"compositionend":wt="onCompositionEnd";break e;case"compositionupdate":wt="onCompositionUpdate";break e}wt=void 0}else bc?iT(a,u)&&(wt="onCompositionEnd"):a==="keydown"&&u.keyCode===229&&(wt="onCompositionStart");wt&&(eT&&u.locale!=="ko"&&(bc||wt!=="onCompositionStart"?wt==="onCompositionEnd"&&bc&&(mt=qS()):(aa=De,t_="value"in aa?aa.value:aa.textContent,bc=!0)),ti=Qu(_e,wt),0<ti.length&&(wt=new mp(wt,a,null,u,De),Ve.push({event:wt,listeners:ti}),mt?wt.data=mt:(mt=rT(u),mt!==null&&(wt.data=mt)))),(mt=uC?hC(a,u):yo(a,u))&&(wt=Qu(_e,"onBeforeInput"),0<wt.length&&(ti=new mp("onBeforeInput","beforeinput",null,u,De),Ve.push({event:ti,listeners:wt}),ti.data=mt)),DE(Ve,a,_e,u,De)}ff(Ve,o)})}function Ed(a,o,u){return{instance:a,listener:o,currentTarget:u}}function Qu(a,o){for(var u=o+"Capture",f=[];a!==null;){var v=a,C=v.stateNode;if(v=v.tag,v!==5&&v!==26&&v!==27||C===null||(v=kl(a,u),v!=null&&f.unshift(Ed(a,v,C)),v=kl(a,o),v!=null&&f.push(Ed(a,v,C))),a.tag===3)return f;a=a.return}return[]}function gd(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function VE(a,o,u,f,v){for(var C=o._reactName,j=[];u!==null&&u!==f;){var W=u,ee=W.alternate,_e=W.stateNode;if(W=W.tag,ee!==null&&ee===f)break;W!==5&&W!==26&&W!==27||_e===null||(ee=_e,v?(_e=kl(u,C),_e!=null&&j.unshift(Ed(u,_e,ee))):v||(_e=kl(u,C),_e!=null&&j.push(Ed(u,_e,ee)))),u=u.return}j.length!==0&&a.push({event:o,listeners:j})}var GC=/\r\n?/g,Sd=/\u0000|\uFFFD/g;function el(a){return(typeof a=="string"?a:""+a).replace(GC,`
`).replace(Sd,"")}function gf(a,o){return o=el(o),el(a)===o}function $u(){}function Ii(a,o,u,f,v,C){switch(u){case"children":typeof f=="string"?o==="body"||o==="textarea"&&f===""||Ro(a,f):(typeof f=="number"||typeof f=="bigint")&&o!=="body"&&Ro(a,""+f);break;case"className":ap(a,"class",f);break;case"tabIndex":ap(a,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":ap(a,u,f);break;case"style":WS(a,f,C);break;case"data":if(o!=="object"){ap(a,"data",f);break}case"src":case"href":if(f===""&&(o!=="a"||u!=="href")){a.removeAttribute(u);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){a.removeAttribute(u);break}f=dp(""+f),a.setAttribute(u,f);break;case"action":case"formAction":if(typeof f=="function"){a.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof C=="function"&&(u==="formAction"?(o!=="input"&&Ii(a,o,"name",v.name,v,null),Ii(a,o,"formEncType",v.formEncType,v,null),Ii(a,o,"formMethod",v.formMethod,v,null),Ii(a,o,"formTarget",v.formTarget,v,null)):(Ii(a,o,"encType",v.encType,v,null),Ii(a,o,"method",v.method,v,null),Ii(a,o,"target",v.target,v,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){a.removeAttribute(u);break}f=dp(""+f),a.setAttribute(u,f);break;case"onClick":f!=null&&(a.onclick=$u);break;case"onScroll":f!=null&&Xt("scroll",a);break;case"onScrollEnd":f!=null&&Xt("scrollend",a);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(S(61));if(u=f.__html,u!=null){if(v.children!=null)throw Error(S(60));a.innerHTML=u}}break;case"multiple":a.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":a.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){a.removeAttribute("xlink:href");break}u=dp(""+f),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(u,""+f):a.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(u,""):a.removeAttribute(u);break;case"capture":case"download":f===!0?a.setAttribute(u,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(u,f):a.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?a.setAttribute(u,f):a.removeAttribute(u);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?a.removeAttribute(u):a.setAttribute(u,f);break;case"popover":Xt("beforetoggle",a),Xt("toggle",a),tr(a,"popover",f);break;case"xlinkActuate":xs(a,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":xs(a,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":xs(a,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":xs(a,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":xs(a,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":xs(a,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":xs(a,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":xs(a,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":xs(a,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":tr(a,"is",f);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=Jy.get(u)||u,tr(a,u,f))}}function BE(a,o,u,f,v,C){switch(u){case"style":WS(a,f,C);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(S(61));if(u=f.__html,u!=null){if(v.children!=null)throw Error(S(60));a.innerHTML=u}}break;case"children":typeof f=="string"?Ro(a,f):(typeof f=="number"||typeof f=="bigint")&&Ro(a,""+f);break;case"onScroll":f!=null&&Xt("scroll",a);break;case"onScrollEnd":f!=null&&Xt("scrollend",a);break;case"onClick":f!=null&&(a.onclick=$u);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!zm.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(v=u.endsWith("Capture"),o=u.slice(2,v?u.length-7:void 0),C=a[An]||null,C=C!=null?C[u]:null,typeof C=="function"&&a.removeEventListener(o,C,v),typeof f=="function")){typeof C!="function"&&C!==null&&(u in a?a[u]=null:a.hasAttribute(u)&&a.removeAttribute(u)),a.addEventListener(o,f,v);break e}u in a?a[u]=f:f===!0?a.setAttribute(u,""):tr(a,u,f)}}}function Gr(a,o,u){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Xt("error",a),Xt("load",a);var f=!1,v=!1,C;for(C in u)if(u.hasOwnProperty(C)){var j=u[C];if(j!=null)switch(C){case"src":f=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(S(137,o));default:Ii(a,o,C,j,u,null)}}v&&Ii(a,o,"srcSet",u.srcSet,u,null),f&&Ii(a,o,"src",u.src,u,null);return;case"input":Xt("invalid",a);var W=C=j=v=null,ee=null,_e=null;for(f in u)if(u.hasOwnProperty(f)){var De=u[f];if(De!=null)switch(f){case"name":v=De;break;case"type":j=De;break;case"checked":ee=De;break;case"defaultChecked":_e=De;break;case"value":C=De;break;case"defaultValue":W=De;break;case"children":case"dangerouslySetInnerHTML":if(De!=null)throw Error(S(137,o));break;default:Ii(a,o,f,De,u,null)}}jS(a,C,W,ee,_e,j,v,!1),op(a);return;case"select":Xt("invalid",a),f=j=C=null;for(v in u)if(u.hasOwnProperty(v)&&(W=u[v],W!=null))switch(v){case"value":C=W;break;case"defaultValue":j=W;break;case"multiple":f=W;default:Ii(a,o,v,W,u,null)}o=C,u=j,a.multiple=!!f,o!=null?Dl(a,!!f,o,!1):u!=null&&Dl(a,!!f,u,!0);return;case"textarea":Xt("invalid",a),C=v=f=null;for(j in u)if(u.hasOwnProperty(j)&&(W=u[j],W!=null))switch(j){case"value":f=W;break;case"defaultValue":v=W;break;case"children":C=W;break;case"dangerouslySetInnerHTML":if(W!=null)throw Error(S(91));break;default:Ii(a,o,j,W,u,null)}GS(a,f,v,C),op(a);return;case"option":for(ee in u)if(u.hasOwnProperty(ee)&&(f=u[ee],f!=null))switch(ee){case"selected":a.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:Ii(a,o,ee,f,u,null)}return;case"dialog":Xt("beforetoggle",a),Xt("toggle",a),Xt("cancel",a),Xt("close",a);break;case"iframe":case"object":Xt("load",a);break;case"video":case"audio":for(f=0;f<_d.length;f++)Xt(_d[f],a);break;case"image":Xt("error",a),Xt("load",a);break;case"details":Xt("toggle",a);break;case"embed":case"source":case"link":Xt("error",a),Xt("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(_e in u)if(u.hasOwnProperty(_e)&&(f=u[_e],f!=null))switch(_e){case"children":case"dangerouslySetInnerHTML":throw Error(S(137,o));default:Ii(a,o,_e,f,u,null)}return;default:if(nu(o)){for(De in u)u.hasOwnProperty(De)&&(f=u[De],f!==void 0&&BE(a,o,De,f,u,void 0));return}}for(W in u)u.hasOwnProperty(W)&&(f=u[W],f!=null&&Ii(a,o,W,f,u,null))}function HC(a,o,u,f){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,C=null,j=null,W=null,ee=null,_e=null,De=null;for(Ce in u){var Ve=u[Ce];if(u.hasOwnProperty(Ce)&&Ve!=null)switch(Ce){case"checked":break;case"value":break;case"defaultValue":ee=Ve;default:f.hasOwnProperty(Ce)||Ii(a,o,Ce,null,f,Ve)}}for(var Re in f){var Ce=f[Re];if(Ve=u[Re],f.hasOwnProperty(Re)&&(Ce!=null||Ve!=null))switch(Re){case"type":C=Ce;break;case"name":v=Ce;break;case"checked":_e=Ce;break;case"defaultChecked":De=Ce;break;case"value":j=Ce;break;case"defaultValue":W=Ce;break;case"children":case"dangerouslySetInnerHTML":if(Ce!=null)throw Error(S(137,o));break;default:Ce!==Ve&&Ii(a,o,Re,Ce,f,Ve)}}Xm(a,j,W,ee,_e,De,C,v);return;case"select":Ce=j=W=Re=null;for(C in u)if(ee=u[C],u.hasOwnProperty(C)&&ee!=null)switch(C){case"value":break;case"multiple":Ce=ee;default:f.hasOwnProperty(C)||Ii(a,o,C,null,f,ee)}for(v in f)if(C=f[v],ee=u[v],f.hasOwnProperty(v)&&(C!=null||ee!=null))switch(v){case"value":Re=C;break;case"defaultValue":W=C;break;case"multiple":j=C;default:C!==ee&&Ii(a,o,v,C,f,ee)}o=W,u=j,f=Ce,Re!=null?Dl(a,!!u,Re,!1):!!f!=!!u&&(o!=null?Dl(a,!!u,o,!0):Dl(a,!!u,u?[]:"",!1));return;case"textarea":Ce=Re=null;for(W in u)if(v=u[W],u.hasOwnProperty(W)&&v!=null&&!f.hasOwnProperty(W))switch(W){case"value":break;case"children":break;default:Ii(a,o,W,null,f,v)}for(j in f)if(v=f[j],C=u[j],f.hasOwnProperty(j)&&(v!=null||C!=null))switch(j){case"value":Re=v;break;case"defaultValue":Ce=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(S(91));break;default:v!==C&&Ii(a,o,j,v,f,C)}FS(a,Re,Ce);return;case"option":for(var Dt in u)if(Re=u[Dt],u.hasOwnProperty(Dt)&&Re!=null&&!f.hasOwnProperty(Dt))switch(Dt){case"selected":a.selected=!1;break;default:Ii(a,o,Dt,null,f,Re)}for(ee in f)if(Re=f[ee],Ce=u[ee],f.hasOwnProperty(ee)&&Re!==Ce&&(Re!=null||Ce!=null))switch(ee){case"selected":a.selected=Re&&typeof Re!="function"&&typeof Re!="symbol";break;default:Ii(a,o,ee,Re,f,Ce)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Rt in u)Re=u[Rt],u.hasOwnProperty(Rt)&&Re!=null&&!f.hasOwnProperty(Rt)&&Ii(a,o,Rt,null,f,Re);for(_e in f)if(Re=f[_e],Ce=u[_e],f.hasOwnProperty(_e)&&Re!==Ce&&(Re!=null||Ce!=null))switch(_e){case"children":case"dangerouslySetInnerHTML":if(Re!=null)throw Error(S(137,o));break;default:Ii(a,o,_e,Re,f,Ce)}return;default:if(nu(o)){for(var Mi in u)Re=u[Mi],u.hasOwnProperty(Mi)&&Re!==void 0&&!f.hasOwnProperty(Mi)&&BE(a,o,Mi,void 0,f,Re);for(De in f)Re=f[De],Ce=u[De],!f.hasOwnProperty(De)||Re===Ce||Re===void 0&&Ce===void 0||BE(a,o,De,Re,f,Ce);return}}for(var pe in u)Re=u[pe],u.hasOwnProperty(pe)&&Re!=null&&!f.hasOwnProperty(pe)&&Ii(a,o,pe,null,f,Re);for(Ve in f)Re=f[Ve],Ce=u[Ve],!f.hasOwnProperty(Ve)||Re===Ce||Re==null&&Ce==null||Ii(a,o,Ve,Re,f,Ce)}var jE=null,Td=null;function Sf(a){return a.nodeType===9?a:a.ownerDocument}function Pv(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Lv(a,o){if(a===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&o==="foreignObject"?0:a}function FE(a,o){return a==="textarea"||a==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var GE=null;function WC(){var a=window.event;return a&&a.type==="popstate"?a===GE?!1:(GE=a,!0):(GE=null,!1)}var kv=typeof setTimeout=="function"?setTimeout:void 0,zC=typeof clearTimeout=="function"?clearTimeout:void 0,Mv=typeof Promise=="function"?Promise:void 0,KC=typeof queueMicrotask=="function"?queueMicrotask:typeof Mv<"u"?function(a){return Mv.resolve(null).then(a).catch(YC)}:kv;function YC(a){setTimeout(function(){throw a})}function Ko(a){return a==="head"}function xv(a,o){var u=o,f=0,v=0;do{var C=u.nextSibling;if(a.removeChild(u),C&&C.nodeType===8)if(u=C.data,u==="/$"){if(0<f&&8>f){u=f;var j=a.ownerDocument;if(u&1&&eh(j.documentElement),u&2&&eh(j.body),u&4)for(u=j.head,eh(u),j=u.firstChild;j;){var W=j.nextSibling,ee=j.nodeName;j[wl]||ee==="SCRIPT"||ee==="STYLE"||ee==="LINK"&&j.rel.toLowerCase()==="stylesheet"||u.removeChild(j),j=W}}if(v===0){a.removeChild(C),dh(o);return}v--}else u==="$"||u==="$?"||u==="$!"?v++:f=u.charCodeAt(0)-48;else f=0;u=C}while(u);dh(o)}function HE(a){var o=a.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var u=o;switch(o=o.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":HE(u),rp(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}a.removeChild(u)}}function qC(a,o,u,f){for(;a.nodeType===1;){var v=u;if(a.nodeName.toLowerCase()!==o.toLowerCase()){if(!f&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(f){if(!a[wl])switch(o){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(C=a.getAttribute("rel"),C==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(C!==v.rel||a.getAttribute("href")!==(v.href==null||v.href===""?null:v.href)||a.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||a.getAttribute("title")!==(v.title==null?null:v.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(C=a.getAttribute("src"),(C!==(v.src==null?null:v.src)||a.getAttribute("type")!==(v.type==null?null:v.type)||a.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&C&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(o==="input"&&a.type==="hidden"){var C=v.name==null?null:""+v.name;if(v.type==="hidden"&&a.getAttribute("name")===C)return a}else return a;if(a=Ba(a.nextSibling),a===null)break}return null}function XC(a,o,u){if(o==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!u||(a=Ba(a.nextSibling),a===null))return null;return a}function Tf(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function JC(a,o){var u=a.ownerDocument;if(a.data!=="$?"||u.readyState==="complete")o();else{var f=function(){o(),u.removeEventListener("DOMContentLoaded",f)};u.addEventListener("DOMContentLoaded",f),a._reactRetry=f}}function Ba(a){for(;a!=null;a=a.nextSibling){var o=a.nodeType;if(o===1||o===3)break;if(o===8){if(o=a.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return a}var WE=null;function Uv(a){a=a.previousSibling;for(var o=0;a;){if(a.nodeType===8){var u=a.data;if(u==="$"||u==="$!"||u==="$?"){if(o===0)return a;o--}else u==="/$"&&o++}a=a.previousSibling}return null}function Vv(a,o,u){switch(o=Sf(u),a){case"html":if(a=o.documentElement,!a)throw Error(S(452));return a;case"head":if(a=o.head,!a)throw Error(S(453));return a;case"body":if(a=o.body,!a)throw Error(S(454));return a;default:throw Error(S(451))}}function eh(a){for(var o=a.attributes;o.length;)a.removeAttributeNode(o[0]);rp(a)}var ua=new Map,Bv=new Set;function vf(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var qs=We.d;We.d={f:ZC,r:QC,D:$C,C:eb,L:tb,m:Fv,X:rb,S:ib,M:nb};function ZC(){var a=qs.f(),o=Xc();return a||o}function QC(a){var o=Ol(a);o!==null&&o.tag===5&&o.type==="form"?J_(o):qs.r(a)}var vd=typeof document>"u"?null:document;function jv(a,o,u){var f=vd;if(f&&typeof o=="string"&&o){var v=Gn(o);v='link[rel="'+a+'"][href="'+v+'"]',typeof u=="string"&&(v+='[crossorigin="'+u+'"]'),Bv.has(v)||(Bv.add(v),a={rel:a,crossOrigin:u,href:o},f.querySelector(v)===null&&(o=f.createElement("link"),Gr(o,"link",a),wr(o),f.head.appendChild(o)))}}function $C(a){qs.D(a),jv("dns-prefetch",a,null)}function eb(a,o){qs.C(a,o),jv("preconnect",a,o)}function tb(a,o,u){qs.L(a,o,u);var f=vd;if(f&&a&&o){var v='link[rel="preload"][as="'+Gn(o)+'"]';o==="image"&&u&&u.imageSrcSet?(v+='[imagesrcset="'+Gn(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(v+='[imagesizes="'+Gn(u.imageSizes)+'"]')):v+='[href="'+Gn(a)+'"]';var C=v;switch(o){case"style":C=Rd(a);break;case"script":C=Cd(a)}ua.has(C)||(a=q({rel:"preload",href:o==="image"&&u&&u.imageSrcSet?void 0:a,as:o},u),ua.set(C,a),f.querySelector(v)!==null||o==="style"&&f.querySelector(yd(C))||o==="script"&&f.querySelector(th(C))||(o=f.createElement("link"),Gr(o,"link",a),wr(o),f.head.appendChild(o)))}}function Fv(a,o){qs.m(a,o);var u=vd;if(u&&a){var f=o&&typeof o.as=="string"?o.as:"script",v='link[rel="modulepreload"][as="'+Gn(f)+'"][href="'+Gn(a)+'"]',C=v;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":C=Cd(a)}if(!ua.has(C)&&(a=q({rel:"modulepreload",href:a},o),ua.set(C,a),u.querySelector(v)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(th(C)))return}f=u.createElement("link"),Gr(f,"link",a),wr(f),u.head.appendChild(f)}}}function ib(a,o,u){qs.S(a,o,u);var f=vd;if(f&&a){var v=Tc(f).hoistableStyles,C=Rd(a);o=o||"default";var j=v.get(C);if(!j){var W={loading:0,preload:null};if(j=f.querySelector(yd(C)))W.loading=5;else{a=q({rel:"stylesheet",href:a,"data-precedence":o},u),(u=ua.get(C))&&zE(a,u);var ee=j=f.createElement("link");wr(ee),Gr(ee,"link",a),ee._p=new Promise(function(_e,De){ee.onload=_e,ee.onerror=De}),ee.addEventListener("load",function(){W.loading|=1}),ee.addEventListener("error",function(){W.loading|=2}),W.loading|=4,Cf(j,o,f)}j={type:"stylesheet",instance:j,count:1,state:W},v.set(C,j)}}}function rb(a,o){qs.X(a,o);var u=vd;if(u&&a){var f=Tc(u).hoistableScripts,v=Cd(a),C=f.get(v);C||(C=u.querySelector(th(v)),C||(a=q({src:a,async:!0},o),(o=ua.get(v))&&KE(a,o),C=u.createElement("script"),wr(C),Gr(C,"link",a),u.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},f.set(v,C))}}function nb(a,o){qs.M(a,o);var u=vd;if(u&&a){var f=Tc(u).hoistableScripts,v=Cd(a),C=f.get(v);C||(C=u.querySelector(th(v)),C||(a=q({src:a,async:!0,type:"module"},o),(o=ua.get(v))&&KE(a,o),C=u.createElement("script"),wr(C),Gr(C,"link",a),u.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},f.set(v,C))}}function Gv(a,o,u,f){var v=(v=Ut.current)?vf(v):null;if(!v)throw Error(S(446));switch(a){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(o=Rd(u.href),u=Tc(v).hoistableStyles,f=u.get(o),f||(f={type:"style",instance:null,count:0,state:null},u.set(o,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){a=Rd(u.href);var C=Tc(v).hoistableStyles,j=C.get(a);if(j||(v=v.ownerDocument||v,j={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},C.set(a,j),(C=v.querySelector(yd(a)))&&!C._p&&(j.instance=C,j.state.loading=5),ua.has(a)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},ua.set(a,u),C||Hv(v,a,u,j.state))),o&&f===null)throw Error(S(528,""));return j}if(o&&f!==null)throw Error(S(529,""));return null;case"script":return o=u.async,u=u.src,typeof u=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=Cd(u),u=Tc(v).hoistableScripts,f=u.get(o),f||(f={type:"script",instance:null,count:0,state:null},u.set(o,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(S(444,a))}}function Rd(a){return'href="'+Gn(a)+'"'}function yd(a){return'link[rel="stylesheet"]['+a+"]"}function Rf(a){return q({},a,{"data-precedence":a.precedence,precedence:null})}function Hv(a,o,u,f){a.querySelector('link[rel="preload"][as="style"]['+o+"]")?f.loading=1:(o=a.createElement("link"),f.preload=o,o.addEventListener("load",function(){return f.loading|=1}),o.addEventListener("error",function(){return f.loading|=2}),Gr(o,"link",u),wr(o),a.head.appendChild(o))}function Cd(a){return'[src="'+Gn(a)+'"]'}function th(a){return"script[async]"+a}function yf(a,o,u){if(o.count++,o.instance===null)switch(o.type){case"style":var f=a.querySelector('style[data-href~="'+Gn(u.href)+'"]');if(f)return o.instance=f,wr(f),f;var v=q({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return f=(a.ownerDocument||a).createElement("style"),wr(f),Gr(f,"style",v),Cf(f,u.precedence,a),o.instance=f;case"stylesheet":v=Rd(u.href);var C=a.querySelector(yd(v));if(C)return o.state.loading|=4,o.instance=C,wr(C),C;f=Rf(u),(v=ua.get(v))&&zE(f,v),C=(a.ownerDocument||a).createElement("link"),wr(C);var j=C;return j._p=new Promise(function(W,ee){j.onload=W,j.onerror=ee}),Gr(C,"link",f),o.state.loading|=4,Cf(C,u.precedence,a),o.instance=C;case"script":return C=Cd(u.src),(v=a.querySelector(th(C)))?(o.instance=v,wr(v),v):(f=u,(v=ua.get(C))&&(f=q({},u),KE(f,v)),a=a.ownerDocument||a,v=a.createElement("script"),wr(v),Gr(v,"link",f),a.head.appendChild(v),o.instance=v);case"void":return null;default:throw Error(S(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(f=o.instance,o.state.loading|=4,Cf(f,u.precedence,a));return o.instance}function Cf(a,o,u){for(var f=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=f.length?f[f.length-1]:null,C=v,j=0;j<f.length;j++){var W=f[j];if(W.dataset.precedence===o)C=W;else if(C!==v)break}C?C.parentNode.insertBefore(a,C.nextSibling):(o=u.nodeType===9?u.head:u,o.insertBefore(a,o.firstChild))}function zE(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.title==null&&(a.title=o.title)}function KE(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.integrity==null&&(a.integrity=o.integrity)}var bf=null;function YE(a,o,u){if(bf===null){var f=new Map,v=bf=new Map;v.set(u,f)}else v=bf,f=v.get(u),f||(f=new Map,v.set(u,f));if(f.has(a))return f;for(f.set(a,null),u=u.getElementsByTagName(a),v=0;v<u.length;v++){var C=u[v];if(!(C[wl]||C[nn]||a==="link"&&C.getAttribute("rel")==="stylesheet")&&C.namespaceURI!=="http://www.w3.org/2000/svg"){var j=C.getAttribute(o)||"";j=a+j;var W=f.get(j);W?W.push(C):f.set(j,[C])}}return f}function Wv(a,o,u){a=a.ownerDocument||a,a.head.insertBefore(u,o==="title"?a.querySelector("head > title"):null)}function qE(a,o,u){if(u===1||o.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return a=o.disabled,typeof o.precedence=="string"&&a==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function zv(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var ih=null;function ab(){}function sb(a,o,u){if(ih===null)throw Error(S(475));var f=ih;if(o.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var v=Rd(u.href),C=a.querySelector(yd(v));if(C){a=C._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(f.count++,f=Af.bind(f),a.then(f,f)),o.state.loading|=4,o.instance=C,wr(C);return}C=a.ownerDocument||a,u=Rf(u),(v=ua.get(v))&&zE(u,v),C=C.createElement("link"),wr(C);var j=C;j._p=new Promise(function(W,ee){j.onload=W,j.onerror=ee}),Gr(C,"link",u),o.instance=C}f.stylesheets===null&&(f.stylesheets=new Map),f.stylesheets.set(o,a),(a=o.state.preload)&&(o.state.loading&3)===0&&(f.count++,o=Af.bind(f),a.addEventListener("load",o),a.addEventListener("error",o))}}function Kv(){if(ih===null)throw Error(S(475));var a=ih;return a.stylesheets&&a.count===0&&nh(a,a.stylesheets),0<a.count?function(o){var u=setTimeout(function(){if(a.stylesheets&&nh(a,a.stylesheets),a.unsuspend){var f=a.unsuspend;a.unsuspend=null,f()}},6e4);return a.unsuspend=o,function(){a.unsuspend=null,clearTimeout(u)}}:null}function Af(){if(this.count--,this.count===0){if(this.stylesheets)nh(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var rh=null;function nh(a,o){a.stylesheets=null,a.unsuspend!==null&&(a.count++,rh=new Map,o.forEach(ob,a),rh=null,Af.call(a))}function ob(a,o){if(!(o.state.loading&4)){var u=rh.get(a);if(u)var f=u.get(null);else{u=new Map,rh.set(a,u);for(var v=a.querySelectorAll("link[data-precedence],style[data-precedence]"),C=0;C<v.length;C++){var j=v[C];(j.nodeName==="LINK"||j.getAttribute("media")!=="not all")&&(u.set(j.dataset.precedence,j),f=j)}f&&u.set(null,f)}v=o.instance,j=v.getAttribute("data-precedence"),C=u.get(j)||f,C===f&&u.set(null,v),u.set(j,v),this.count++,f=Af.bind(this),v.addEventListener("load",f),v.addEventListener("error",f),C?C.parentNode.insertBefore(v,C.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(v,a.firstChild)),o.state.loading|=4}}var ah={$$typeof:Oe,Provider:null,Consumer:null,_currentValue:He,_currentValue2:He,_threadCount:0};function Yv(a,o,u,f,v,C,j,W){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Hm(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Hm(0),this.hiddenUpdates=Hm(null),this.identifierPrefix=f,this.onUncaughtError=v,this.onCaughtError=C,this.onRecoverableError=j,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=W,this.incompleteTransitions=new Map}function qv(a,o,u,f,v,C,j,W,ee,_e,De,Ve){return a=new Yv(a,o,u,j,W,ee,_e,Ve),o=1,C===!0&&(o|=24),C=Kn(3,null,null,o),a.current=C,C.stateNode=a,o=fu(),o.refCount++,a.pooledCache=o,o.refCount++,C.memoizedState={element:f,isDehydrated:u,cache:o},Op(C),a}function XE(a){return a?(a=Bs,a):Bs}function JE(a,o,u,f,v,C){v=XE(v),f.context===null?f.context=v:f.pendingContext=v,f=Do(o),f.payload={element:u},C=C===void 0?null:C,C!==null&&(f.callback=C),u=Ws(a,f,o),u!==null&&(Pn(u,a,o),gu(u,a,o))}function Xv(a,o){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var u=a.retryLane;a.retryLane=u!==0&&u<o?u:o}}function ZE(a,o){Xv(a,o),(a=a.alternate)&&Xv(a,o)}function Jv(a){if(a.tag===13){var o=jl(a,67108864);o!==null&&Pn(o,a,67108864),ZE(a,67108864)}}var wf=!0;function cb(a,o,u,f){var v=Ne.T;Ne.T=null;var C=We.p;try{We.p=2,If(a,o,u,f)}finally{We.p=C,Ne.T=v}}function lb(a,o,u,f){var v=Ne.T;Ne.T=null;var C=We.p;try{We.p=8,If(a,o,u,f)}finally{We.p=C,Ne.T=v}}function If(a,o,u,f){if(wf){var v=sh(f);if(v===null)Ef(a,o,f,oh,u),$E(a,f);else if(Qv(v,a,o,u,f))f.stopPropagation();else if($E(a,f),o&4&&-1<Sn.indexOf(a)){for(;v!==null;){var C=Ol(v);if(C!==null)switch(C.tag){case 3:if(C=C.stateNode,C.current.memoizedState.isDehydrated){var j=So(C.pendingLanes);if(j!==0){var W=C;for(W.pendingLanes|=2,W.entangledLanes|=2;j;){var ee=1<<31-mn(j);W.entanglements[1]|=ee,j&=~ee}da(C),(Ti&6)===0&&(ld=$a()+500,Ju(0))}}break;case 13:W=jl(C,2),W!==null&&Pn(W,C,2),Xc(),ZE(C,2)}if(C=sh(f),C===null&&Ef(a,o,f,oh,u),C===v)break;v=C}v!==null&&f.stopPropagation()}else Ef(a,o,f,null,u)}}function sh(a){return a=Qm(a),we(a)}var oh=null;function we(a){if(oh=null,a=Il(a),a!==null){var o=I(a);if(o===null)a=null;else{var u=o.tag;if(u===13){if(a=x(o),a!==null)return a;a=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;a=null}else o!==a&&(a=null)}}return oh=a,null}function Zv(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Yr()){case bn:return 2;case ep:return 8;case yl:case Wy:return 32;case Fm:return 268435456;default:return 32}default:return 32}}var QE=!1,Yo=null,qo=null,Xo=null,tl=new Map,ch=new Map,Jo=[],Sn="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function $E(a,o){switch(a){case"focusin":case"focusout":Yo=null;break;case"dragenter":case"dragleave":qo=null;break;case"mouseover":case"mouseout":Xo=null;break;case"pointerover":case"pointerout":tl.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":ch.delete(o.pointerId)}}function lh(a,o,u,f,v,C){return a===null||a.nativeEvent!==C?(a={blockedOn:o,domEventName:u,eventSystemFlags:f,nativeEvent:C,targetContainers:[v]},o!==null&&(o=Ol(o),o!==null&&Jv(o)),a):(a.eventSystemFlags|=f,o=a.targetContainers,v!==null&&o.indexOf(v)===-1&&o.push(v),a)}function Qv(a,o,u,f,v){switch(o){case"focusin":return Yo=lh(Yo,a,o,u,f,v),!0;case"dragenter":return qo=lh(qo,a,o,u,f,v),!0;case"mouseover":return Xo=lh(Xo,a,o,u,f,v),!0;case"pointerover":var C=v.pointerId;return tl.set(C,lh(tl.get(C)||null,a,o,u,f,v)),!0;case"gotpointercapture":return C=v.pointerId,ch.set(C,lh(ch.get(C)||null,a,o,u,f,v)),!0}return!1}function $v(a){var o=Il(a.target);if(o!==null){var u=I(o);if(u!==null){if(o=u.tag,o===13){if(o=x(u),o!==null){a.blockedOn=o,Ky(a.priority,function(){if(u.tag===13){var f=Jn();f=To(f);var v=jl(u,f);v!==null&&Pn(v,u,f),ZE(u,f)}});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){a.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}a.blockedOn=null}function bd(a){if(a.blockedOn!==null)return!1;for(var o=a.targetContainers;0<o.length;){var u=sh(a.nativeEvent);if(u===null){u=a.nativeEvent;var f=new u.constructor(u.type,u);Zm=f,u.target.dispatchEvent(f),Zm=null}else return o=Ol(u),o!==null&&Jv(o),a.blockedOn=u,!1;o.shift()}return!0}function eg(a,o,u){bd(a)&&u.delete(o)}function e0(){QE=!1,Yo!==null&&bd(Yo)&&(Yo=null),qo!==null&&bd(qo)&&(qo=null),Xo!==null&&bd(Xo)&&(Xo=null),tl.forEach(eg),ch.forEach(eg)}function Of(a,o){a.blockedOn===o&&(a.blockedOn=null,QE||(QE=!0,m.unstable_scheduleCallback(m.unstable_NormalPriority,e0)))}var Nf=null;function tg(a){Nf!==a&&(Nf=a,m.unstable_scheduleCallback(m.unstable_NormalPriority,function(){Nf===a&&(Nf=null);for(var o=0;o<a.length;o+=3){var u=a[o],f=a[o+1],v=a[o+2];if(typeof f!="function"){if(we(f||u)===null)continue;break}var C=Ol(u);C!==null&&(a.splice(o,3),o-=3,$l(C,{pending:!0,data:v,method:u.method,action:f},f,v))}}))}function dh(a){function o(ee){return Of(ee,a)}Yo!==null&&Of(Yo,a),qo!==null&&Of(qo,a),Xo!==null&&Of(Xo,a),tl.forEach(o),ch.forEach(o);for(var u=0;u<Jo.length;u++){var f=Jo[u];f.blockedOn===a&&(f.blockedOn=null)}for(;0<Jo.length&&(u=Jo[0],u.blockedOn===null);)$v(u),u.blockedOn===null&&Jo.shift();if(u=(a.ownerDocument||a).$$reactFormReplay,u!=null)for(f=0;f<u.length;f+=3){var v=u[f],C=u[f+1],j=v[An]||null;if(typeof C=="function")j||tg(u);else if(j){var W=null;if(C&&C.hasAttribute("formAction")){if(v=C,j=C[An]||null)W=j.formAction;else if(we(v)!==null)continue}else W=j.action;typeof W=="function"?u[f+1]=W:(u.splice(f,3),f-=3),tg(u)}}}function ig(a){this._internalRoot=a}uh.prototype.render=ig.prototype.render=function(a){var o=this._internalRoot;if(o===null)throw Error(S(409));var u=o.current,f=Jn();JE(u,f,a,o,null,null)},uh.prototype.unmount=ig.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var o=a.containerInfo;JE(a.current,2,null,a,null,null),Xc(),o[Ms]=null}};function uh(a){this._internalRoot=a}uh.prototype.unstable_scheduleHydration=function(a){if(a){var o=PS();a={blockedOn:null,target:a,priority:o};for(var u=0;u<Jo.length&&o!==0&&o<Jo[u].priority;u++);Jo.splice(u,0,a),u===0&&$v(a)}};var t0=g.version;if(t0!=="19.1.1")throw Error(S(527,t0,"19.1.1"));We.findDOMNode=function(a){var o=a._reactInternals;if(o===void 0)throw typeof a.render=="function"?Error(S(188)):(a=Object.keys(a).join(","),Error(S(268,a)));return a=P(o),a=a!==null?V(a):null,a=a===null?null:a.stateNode,a};var db={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:Ne,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var hh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!hh.isDisabled&&hh.supportsFiber)try{Cl=hh.inject(db),dr=hh}catch{}}return _S.createRoot=function(a,o){if(!b(a))throw Error(S(299));var u=!1,f="",v=tv,C=iv,j=rv,W=null;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onUncaughtError!==void 0&&(v=o.onUncaughtError),o.onCaughtError!==void 0&&(C=o.onCaughtError),o.onRecoverableError!==void 0&&(j=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(W=o.unstable_transitionCallbacks)),o=qv(a,1,!1,null,null,u,f,v,C,j,W,null),a[Ms]=o.current,_f(a),new ig(o)},_S.hydrateRoot=function(a,o,u){if(!b(a))throw Error(S(299));var f=!1,v="",C=tv,j=iv,W=rv,ee=null,_e=null;return u!=null&&(u.unstable_strictMode===!0&&(f=!0),u.identifierPrefix!==void 0&&(v=u.identifierPrefix),u.onUncaughtError!==void 0&&(C=u.onUncaughtError),u.onCaughtError!==void 0&&(j=u.onCaughtError),u.onRecoverableError!==void 0&&(W=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(ee=u.unstable_transitionCallbacks),u.formState!==void 0&&(_e=u.formState)),o=qv(a,1,!0,o,u??null,f,v,C,j,W,ee,_e),o.context=XE(null),u=o.current,f=Jn(),f=To(f),v=Do(f),v.callback=null,Ws(u,v,f),u=f,o.current.lanes=u,iu(o,u),da(o),a[Ms]=o.current,_f(a),new uh(o)},_S.version="19.1.1",_S}var s3;function k7(){if(s3)return QI.exports;s3=1;function m(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(m)}catch(g){console.error(g)}}return m(),QI.exports=L7(),QI.exports}var M7=k7();/**
 * react-router v7.9.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var o3="popstate";function x7(m={}){function g(S,b){let{pathname:I,search:x,hash:z}=S.location;return uO("",{pathname:I,search:x,hash:z},b.state&&b.state.usr||null,b.state&&b.state.key||"default")}function T(S,b){return typeof b=="string"?b:vS(b)}return V7(g,T,null,m)}function gr(m,g){if(m===!1||m===null||typeof m>"u")throw new Error(g)}function mc(m,g){if(!m){typeof console<"u"&&console.warn(g);try{throw new Error(g)}catch{}}}function U7(){return Math.random().toString(36).substring(2,10)}function c3(m,g){return{usr:m.state,key:m.key,idx:g}}function uO(m,g,T=null,S){return{pathname:typeof m=="string"?m:m.pathname,search:"",hash:"",...typeof g=="string"?xm(g):g,state:T,key:g&&g.key||S||U7()}}function vS({pathname:m="/",search:g="",hash:T=""}){return g&&g!=="?"&&(m+=g.charAt(0)==="?"?g:"?"+g),T&&T!=="#"&&(m+=T.charAt(0)==="#"?T:"#"+T),m}function xm(m){let g={};if(m){let T=m.indexOf("#");T>=0&&(g.hash=m.substring(T),m=m.substring(0,T));let S=m.indexOf("?");S>=0&&(g.search=m.substring(S),m=m.substring(0,S)),m&&(g.pathname=m)}return g}function V7(m,g,T,S={}){let{window:b=document.defaultView,v5Compat:I=!1}=S,x=b.history,z="POP",P=null,V=q();V==null&&(V=0,x.replaceState({...x.state,idx:V},""));function q(){return(x.state||{idx:null}).idx}function X(){z="POP";let oe=q(),Ae=oe==null?null:oe-V;V=oe,P&&P({action:z,location:ae.location,delta:Ae})}function se(oe,Ae){z="PUSH";let be=uO(ae.location,oe,Ae);V=q()+1;let Oe=c3(be,V),Xe=ae.createHref(be);try{x.pushState(Oe,"",Xe)}catch(Ue){if(Ue instanceof DOMException&&Ue.name==="DataCloneError")throw Ue;b.location.assign(Xe)}I&&P&&P({action:z,location:ae.location,delta:1})}function re(oe,Ae){z="REPLACE";let be=uO(ae.location,oe,Ae);V=q();let Oe=c3(be,V),Xe=ae.createHref(be);x.replaceState(Oe,"",Xe),I&&P&&P({action:z,location:ae.location,delta:0})}function ue(oe){return B7(oe)}let ae={get action(){return z},get location(){return m(b,x)},listen(oe){if(P)throw new Error("A history only accepts one active listener");return b.addEventListener(o3,X),P=oe,()=>{b.removeEventListener(o3,X),P=null}},createHref(oe){return g(b,oe)},createURL:ue,encodeLocation(oe){let Ae=ue(oe);return{pathname:Ae.pathname,search:Ae.search,hash:Ae.hash}},push:se,replace:re,go(oe){return x.go(oe)}};return ae}function B7(m,g=!1){let T="http://localhost";typeof window<"u"&&(T=window.location.origin!=="null"?window.location.origin:window.location.href),gr(T,"No window.location.(origin|href) available to create URL");let S=typeof m=="string"?m:vS(m);return S=S.replace(/ $/,"%20"),!g&&S.startsWith("//")&&(S=T+S),new URL(S,T)}function I3(m,g,T="/"){return j7(m,g,T,!1)}function j7(m,g,T,S){let b=typeof g=="string"?xm(g):g,I=vl(b.pathname||"/",T);if(I==null)return null;let x=O3(m);F7(x);let z=null;for(let P=0;z==null&&P<x.length;++P){let V=Q7(I);z=J7(x[P],V,S)}return z}function O3(m,g=[],T=[],S="",b=!1){let I=(x,z,P=b,V)=>{let q={relativePath:V===void 0?x.path||"":V,caseSensitive:x.caseSensitive===!0,childrenIndex:z,route:x};if(q.relativePath.startsWith("/")){if(!q.relativePath.startsWith(S)&&P)return;gr(q.relativePath.startsWith(S),`Absolute route path "${q.relativePath}" nested under path "${S}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),q.relativePath=q.relativePath.slice(S.length)}let X=Tl([S,q.relativePath]),se=T.concat(q);x.children&&x.children.length>0&&(gr(x.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${X}".`),O3(x.children,g,se,X,P)),!(x.path==null&&!x.index)&&g.push({path:X,score:q7(X,x.index),routesMeta:se})};return m.forEach((x,z)=>{if(x.path===""||!x.path?.includes("?"))I(x,z);else for(let P of N3(x.path))I(x,z,!0,P)}),g}function N3(m){let g=m.split("/");if(g.length===0)return[];let[T,...S]=g,b=T.endsWith("?"),I=T.replace(/\?$/,"");if(S.length===0)return b?[I,""]:[I];let x=N3(S.join("/")),z=[];return z.push(...x.map(P=>P===""?I:[I,P].join("/"))),b&&z.push(...x),z.map(P=>m.startsWith("/")&&P===""?"/":P)}function F7(m){m.sort((g,T)=>g.score!==T.score?T.score-g.score:X7(g.routesMeta.map(S=>S.childrenIndex),T.routesMeta.map(S=>S.childrenIndex)))}var G7=/^:[\w-]+$/,H7=3,W7=2,z7=1,K7=10,Y7=-2,l3=m=>m==="*";function q7(m,g){let T=m.split("/"),S=T.length;return T.some(l3)&&(S+=Y7),g&&(S+=W7),T.filter(b=>!l3(b)).reduce((b,I)=>b+(G7.test(I)?H7:I===""?z7:K7),S)}function X7(m,g){return m.length===g.length&&m.slice(0,-1).every((S,b)=>S===g[b])?m[m.length-1]-g[g.length-1]:0}function J7(m,g,T=!1){let{routesMeta:S}=m,b={},I="/",x=[];for(let z=0;z<S.length;++z){let P=S[z],V=z===S.length-1,q=I==="/"?g:g.slice(I.length)||"/",X=Py({path:P.relativePath,caseSensitive:P.caseSensitive,end:V},q),se=P.route;if(!X&&V&&T&&!S[S.length-1].route.index&&(X=Py({path:P.relativePath,caseSensitive:P.caseSensitive,end:!1},q)),!X)return null;Object.assign(b,X.params),x.push({params:b,pathname:Tl([I,X.pathname]),pathnameBase:iW(Tl([I,X.pathnameBase])),route:se}),X.pathnameBase!=="/"&&(I=Tl([I,X.pathnameBase]))}return x}function Py(m,g){typeof m=="string"&&(m={path:m,caseSensitive:!1,end:!0});let[T,S]=Z7(m.path,m.caseSensitive,m.end),b=g.match(T);if(!b)return null;let I=b[0],x=I.replace(/(.)\/+$/,"$1"),z=b.slice(1);return{params:S.reduce((V,{paramName:q,isOptional:X},se)=>{if(q==="*"){let ue=z[se]||"";x=I.slice(0,I.length-ue.length).replace(/(.)\/+$/,"$1")}const re=z[se];return X&&!re?V[q]=void 0:V[q]=(re||"").replace(/%2F/g,"/"),V},{}),pathname:I,pathnameBase:x,pattern:m}}function Z7(m,g=!1,T=!0){mc(m==="*"||!m.endsWith("*")||m.endsWith("/*"),`Route path "${m}" will be treated as if it were "${m.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${m.replace(/\*$/,"/*")}".`);let S=[],b="^"+m.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(x,z,P)=>(S.push({paramName:z,isOptional:P!=null}),P?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return m.endsWith("*")?(S.push({paramName:"*"}),b+=m==="*"||m==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):T?b+="\\/*$":m!==""&&m!=="/"&&(b+="(?:(?=\\/|$))"),[new RegExp(b,g?void 0:"i"),S]}function Q7(m){try{return m.split("/").map(g=>decodeURIComponent(g).replace(/\//g,"%2F")).join("/")}catch(g){return mc(!1,`The URL path "${m}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${g}).`),m}}function vl(m,g){if(g==="/")return m;if(!m.toLowerCase().startsWith(g.toLowerCase()))return null;let T=g.endsWith("/")?g.length-1:g.length,S=m.charAt(T);return S&&S!=="/"?null:m.slice(T)||"/"}function $7(m,g="/"){let{pathname:T,search:S="",hash:b=""}=typeof m=="string"?xm(m):m;return{pathname:T?T.startsWith("/")?T:eW(T,g):g,search:rW(S),hash:nW(b)}}function eW(m,g){let T=g.replace(/\/+$/,"").split("/");return m.split("/").forEach(b=>{b===".."?T.length>1&&T.pop():b!=="."&&T.push(b)}),T.length>1?T.join("/"):"/"}function iO(m,g,T,S){return`Cannot include a '${m}' character in a manually specified \`to.${g}\` field [${JSON.stringify(S)}].  Please separate it out to the \`to.${T}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function tW(m){return m.filter((g,T)=>T===0||g.route.path&&g.route.path.length>0)}function D3(m){let g=tW(m);return g.map((T,S)=>S===g.length-1?T.pathname:T.pathnameBase)}function P3(m,g,T,S=!1){let b;typeof m=="string"?b=xm(m):(b={...m},gr(!b.pathname||!b.pathname.includes("?"),iO("?","pathname","search",b)),gr(!b.pathname||!b.pathname.includes("#"),iO("#","pathname","hash",b)),gr(!b.search||!b.search.includes("#"),iO("#","search","hash",b)));let I=m===""||b.pathname==="",x=I?"/":b.pathname,z;if(x==null)z=T;else{let X=g.length-1;if(!S&&x.startsWith("..")){let se=x.split("/");for(;se[0]==="..";)se.shift(),X-=1;b.pathname=se.join("/")}z=X>=0?g[X]:"/"}let P=$7(b,z),V=x&&x!=="/"&&x.endsWith("/"),q=(I||x===".")&&T.endsWith("/");return!P.pathname.endsWith("/")&&(V||q)&&(P.pathname+="/"),P}var Tl=m=>m.join("/").replace(/\/\/+/g,"/"),iW=m=>m.replace(/\/+$/,"").replace(/^\/*/,"/"),rW=m=>!m||m==="?"?"":m.startsWith("?")?m:"?"+m,nW=m=>!m||m==="#"?"":m.startsWith("#")?m:"#"+m;function aW(m){return m!=null&&typeof m.status=="number"&&typeof m.statusText=="string"&&typeof m.internal=="boolean"&&"data"in m}var L3=["POST","PUT","PATCH","DELETE"];new Set(L3);var sW=["GET",...L3];new Set(sW);var Um=te.createContext(null);Um.displayName="DataRouter";var Vy=te.createContext(null);Vy.displayName="DataRouterState";te.createContext(!1);var k3=te.createContext({isTransitioning:!1});k3.displayName="ViewTransition";var oW=te.createContext(new Map);oW.displayName="Fetchers";var cW=te.createContext(null);cW.displayName="Await";var _c=te.createContext(null);_c.displayName="Navigation";var RS=te.createContext(null);RS.displayName="Location";var Ec=te.createContext({outlet:null,matches:[],isDataRoute:!1});Ec.displayName="Route";var SO=te.createContext(null);SO.displayName="RouteError";function lW(m,{relative:g}={}){gr(yS(),"useHref() may be used only in the context of a <Router> component.");let{basename:T,navigator:S}=te.useContext(_c),{hash:b,pathname:I,search:x}=bS(m,{relative:g}),z=I;return T!=="/"&&(z=I==="/"?T:Tl([T,I])),S.createHref({pathname:z,search:x,hash:b})}function yS(){return te.useContext(RS)!=null}function gc(){return gr(yS(),"useLocation() may be used only in the context of a <Router> component."),te.useContext(RS).location}var M3="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function x3(m){te.useContext(_c).static||te.useLayoutEffect(m)}function CS(){let{isDataRoute:m}=te.useContext(Ec);return m?CW():dW()}function dW(){gr(yS(),"useNavigate() may be used only in the context of a <Router> component.");let m=te.useContext(Um),{basename:g,navigator:T}=te.useContext(_c),{matches:S}=te.useContext(Ec),{pathname:b}=gc(),I=JSON.stringify(D3(S)),x=te.useRef(!1);return x3(()=>{x.current=!0}),te.useCallback((P,V={})=>{if(mc(x.current,M3),!x.current)return;if(typeof P=="number"){T.go(P);return}let q=P3(P,JSON.parse(I),b,V.relative==="path");m==null&&g!=="/"&&(q.pathname=q.pathname==="/"?g:Tl([g,q.pathname])),(V.replace?T.replace:T.push)(q,V.state,V)},[g,T,I,b,m])}var U3=te.createContext(null);function uW(){return te.useContext(U3)}function hW(m){let g=te.useContext(Ec).outlet;return te.useMemo(()=>g&&te.createElement(U3.Provider,{value:m},g),[g,m])}function bS(m,{relative:g}={}){let{matches:T}=te.useContext(Ec),{pathname:S}=gc(),b=JSON.stringify(D3(T));return te.useMemo(()=>P3(m,JSON.parse(b),S,g==="path"),[m,b,S,g])}function pW(m,g){return V3(m,g)}function V3(m,g,T,S,b){gr(yS(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:I}=te.useContext(_c),{matches:x}=te.useContext(Ec),z=x[x.length-1],P=z?z.params:{},V=z?z.pathname:"/",q=z?z.pathnameBase:"/",X=z&&z.route;{let be=X&&X.path||"";B3(V,!X||be.endsWith("*")||be.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${V}" (under <Route path="${be}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${be}"> to <Route path="${be==="/"?"*":`${be}/*`}">.`)}let se=gc(),re;if(g){let be=typeof g=="string"?xm(g):g;gr(q==="/"||be.pathname?.startsWith(q),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${q}" but pathname "${be.pathname}" was given in the \`location\` prop.`),re=be}else re=se;let ue=re.pathname||"/",ae=ue;if(q!=="/"){let be=q.replace(/^\//,"").split("/");ae="/"+ue.replace(/^\//,"").split("/").slice(be.length).join("/")}let oe=I3(m,{pathname:ae});mc(X||oe!=null,`No routes matched location "${re.pathname}${re.search}${re.hash}" `),mc(oe==null||oe[oe.length-1].route.element!==void 0||oe[oe.length-1].route.Component!==void 0||oe[oe.length-1].route.lazy!==void 0,`Matched leaf route at location "${re.pathname}${re.search}${re.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let Ae=gW(oe&&oe.map(be=>Object.assign({},be,{params:Object.assign({},P,be.params),pathname:Tl([q,I.encodeLocation?I.encodeLocation(be.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:be.pathname]),pathnameBase:be.pathnameBase==="/"?q:Tl([q,I.encodeLocation?I.encodeLocation(be.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:be.pathnameBase])})),x,T,S,b);return g&&Ae?te.createElement(RS.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...re},navigationType:"POP"}},Ae):Ae}function fW(){let m=yW(),g=aW(m)?`${m.status} ${m.statusText}`:m instanceof Error?m.message:JSON.stringify(m),T=m instanceof Error?m.stack:null,S="rgba(200,200,200, 0.5)",b={padding:"0.5rem",backgroundColor:S},I={padding:"2px 4px",backgroundColor:S},x=null;return console.error("Error handled by React Router default ErrorBoundary:",m),x=te.createElement(te.Fragment,null,te.createElement("p",null," Hey developer "),te.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",te.createElement("code",{style:I},"ErrorBoundary")," or"," ",te.createElement("code",{style:I},"errorElement")," prop on your route.")),te.createElement(te.Fragment,null,te.createElement("h2",null,"Unexpected Application Error!"),te.createElement("h3",{style:{fontStyle:"italic"}},g),T?te.createElement("pre",{style:b},T):null,x)}var mW=te.createElement(fW,null),_W=class extends te.Component{constructor(m){super(m),this.state={location:m.location,revalidation:m.revalidation,error:m.error}}static getDerivedStateFromError(m){return{error:m}}static getDerivedStateFromProps(m,g){return g.location!==m.location||g.revalidation!=="idle"&&m.revalidation==="idle"?{error:m.error,location:m.location,revalidation:m.revalidation}:{error:m.error!==void 0?m.error:g.error,location:g.location,revalidation:m.revalidation||g.revalidation}}componentDidCatch(m,g){this.props.unstable_onError?this.props.unstable_onError(m,g):console.error("React Router caught the following error during render",m)}render(){return this.state.error!==void 0?te.createElement(Ec.Provider,{value:this.props.routeContext},te.createElement(SO.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function EW({routeContext:m,match:g,children:T}){let S=te.useContext(Um);return S&&S.static&&S.staticContext&&(g.route.errorElement||g.route.ErrorBoundary)&&(S.staticContext._deepestRenderedBoundaryId=g.route.id),te.createElement(Ec.Provider,{value:m},T)}function gW(m,g=[],T=null,S=null,b=null){if(m==null){if(!T)return null;if(T.errors)m=T.matches;else if(g.length===0&&!T.initialized&&T.matches.length>0)m=T.matches;else return null}let I=m,x=T?.errors;if(x!=null){let V=I.findIndex(q=>q.route.id&&x?.[q.route.id]!==void 0);gr(V>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(x).join(",")}`),I=I.slice(0,Math.min(I.length,V+1))}let z=!1,P=-1;if(T)for(let V=0;V<I.length;V++){let q=I[V];if((q.route.HydrateFallback||q.route.hydrateFallbackElement)&&(P=V),q.route.id){let{loaderData:X,errors:se}=T,re=q.route.loader&&!X.hasOwnProperty(q.route.id)&&(!se||se[q.route.id]===void 0);if(q.route.lazy||re){z=!0,P>=0?I=I.slice(0,P+1):I=[I[0]];break}}}return I.reduceRight((V,q,X)=>{let se,re=!1,ue=null,ae=null;T&&(se=x&&q.route.id?x[q.route.id]:void 0,ue=q.route.errorElement||mW,z&&(P<0&&X===0?(B3("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),re=!0,ae=null):P===X&&(re=!0,ae=q.route.hydrateFallbackElement||null)));let oe=g.concat(I.slice(0,X+1)),Ae=()=>{let be;return se?be=ue:re?be=ae:q.route.Component?be=te.createElement(q.route.Component,null):q.route.element?be=q.route.element:be=V,te.createElement(EW,{match:q,routeContext:{outlet:V,matches:oe,isDataRoute:T!=null},children:be})};return T&&(q.route.ErrorBoundary||q.route.errorElement||X===0)?te.createElement(_W,{location:T.location,revalidation:T.revalidation,component:ue,error:se,children:Ae(),routeContext:{outlet:null,matches:oe,isDataRoute:!0},unstable_onError:S}):Ae()},null)}function TO(m){return`${m} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function SW(m){let g=te.useContext(Um);return gr(g,TO(m)),g}function TW(m){let g=te.useContext(Vy);return gr(g,TO(m)),g}function vW(m){let g=te.useContext(Ec);return gr(g,TO(m)),g}function vO(m){let g=vW(m),T=g.matches[g.matches.length-1];return gr(T.route.id,`${m} can only be used on routes that contain a unique "id"`),T.route.id}function RW(){return vO("useRouteId")}function yW(){let m=te.useContext(SO),g=TW("useRouteError"),T=vO("useRouteError");return m!==void 0?m:g.errors?.[T]}function CW(){let{router:m}=SW("useNavigate"),g=vO("useNavigate"),T=te.useRef(!1);return x3(()=>{T.current=!0}),te.useCallback(async(b,I={})=>{mc(T.current,M3),T.current&&(typeof b=="number"?m.navigate(b):await m.navigate(b,{fromRouteId:g,...I}))},[m,g])}var d3={};function B3(m,g,T){!g&&!d3[m]&&(d3[m]=!0,mc(!1,T))}te.memo(bW);function bW({routes:m,future:g,state:T,unstable_onError:S}){return V3(m,void 0,T,S,g)}function AW(m){return hW(m.context)}function Ps(m){gr(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function wW({basename:m="/",children:g=null,location:T,navigationType:S="POP",navigator:b,static:I=!1}){gr(!yS(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let x=m.replace(/^\/*/,"/"),z=te.useMemo(()=>({basename:x,navigator:b,static:I,future:{}}),[x,b,I]);typeof T=="string"&&(T=xm(T));let{pathname:P="/",search:V="",hash:q="",state:X=null,key:se="default"}=T,re=te.useMemo(()=>{let ue=vl(P,x);return ue==null?null:{location:{pathname:ue,search:V,hash:q,state:X,key:se},navigationType:S}},[x,P,V,q,X,se,S]);return mc(re!=null,`<Router basename="${x}"> is not able to match the URL "${P}${V}${q}" because it does not start with the basename, so the <Router> won't render anything.`),re==null?null:te.createElement(_c.Provider,{value:z},te.createElement(RS.Provider,{children:g,value:re}))}function IW({children:m,location:g}){return pW(hO(m),g)}function hO(m,g=[]){let T=[];return te.Children.forEach(m,(S,b)=>{if(!te.isValidElement(S))return;let I=[...g,b];if(S.type===te.Fragment){T.push.apply(T,hO(S.props.children,I));return}gr(S.type===Ps,`[${typeof S.type=="string"?S.type:S.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),gr(!S.props.index||!S.props.children,"An index route cannot have child routes.");let x={id:S.props.id||I.join("-"),caseSensitive:S.props.caseSensitive,element:S.props.element,Component:S.props.Component,index:S.props.index,path:S.props.path,middleware:S.props.middleware,loader:S.props.loader,action:S.props.action,hydrateFallbackElement:S.props.hydrateFallbackElement,HydrateFallback:S.props.HydrateFallback,errorElement:S.props.errorElement,ErrorBoundary:S.props.ErrorBoundary,hasErrorBoundary:S.props.hasErrorBoundary===!0||S.props.ErrorBoundary!=null||S.props.errorElement!=null,shouldRevalidate:S.props.shouldRevalidate,handle:S.props.handle,lazy:S.props.lazy};S.props.children&&(x.children=hO(S.props.children,I)),T.push(x)}),T}var Iy="get",Oy="application/x-www-form-urlencoded";function By(m){return m!=null&&typeof m.tagName=="string"}function OW(m){return By(m)&&m.tagName.toLowerCase()==="button"}function NW(m){return By(m)&&m.tagName.toLowerCase()==="form"}function DW(m){return By(m)&&m.tagName.toLowerCase()==="input"}function PW(m){return!!(m.metaKey||m.altKey||m.ctrlKey||m.shiftKey)}function LW(m,g){return m.button===0&&(!g||g==="_self")&&!PW(m)}var by=null;function kW(){if(by===null)try{new FormData(document.createElement("form"),0),by=!1}catch{by=!0}return by}var MW=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function rO(m){return m!=null&&!MW.has(m)?(mc(!1,`"${m}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Oy}"`),null):m}function xW(m,g){let T,S,b,I,x;if(NW(m)){let z=m.getAttribute("action");S=z?vl(z,g):null,T=m.getAttribute("method")||Iy,b=rO(m.getAttribute("enctype"))||Oy,I=new FormData(m)}else if(OW(m)||DW(m)&&(m.type==="submit"||m.type==="image")){let z=m.form;if(z==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let P=m.getAttribute("formaction")||z.getAttribute("action");if(S=P?vl(P,g):null,T=m.getAttribute("formmethod")||z.getAttribute("method")||Iy,b=rO(m.getAttribute("formenctype"))||rO(z.getAttribute("enctype"))||Oy,I=new FormData(z,m),!kW()){let{name:V,type:q,value:X}=m;if(q==="image"){let se=V?`${V}.`:"";I.append(`${se}x`,"0"),I.append(`${se}y`,"0")}else V&&I.append(V,X)}}else{if(By(m))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');T=Iy,S=null,b=Oy,x=m}return I&&b==="text/plain"&&(x=I,I=void 0),{action:S,method:T.toLowerCase(),encType:b,formData:I,body:x}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function RO(m,g){if(m===!1||m===null||typeof m>"u")throw new Error(g)}function UW(m,g,T){let S=typeof m=="string"?new URL(m,typeof window>"u"?"server://singlefetch/":window.location.origin):m;return S.pathname==="/"?S.pathname=`_root.${T}`:g&&vl(S.pathname,g)==="/"?S.pathname=`${g.replace(/\/$/,"")}/_root.${T}`:S.pathname=`${S.pathname.replace(/\/$/,"")}.${T}`,S}async function VW(m,g){if(m.id in g)return g[m.id];try{let T=await import(m.module);return g[m.id]=T,T}catch(T){return console.error(`Error loading route module \`${m.module}\`, reloading page...`),console.error(T),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function BW(m){return m==null?!1:m.href==null?m.rel==="preload"&&typeof m.imageSrcSet=="string"&&typeof m.imageSizes=="string":typeof m.rel=="string"&&typeof m.href=="string"}async function jW(m,g,T){let S=await Promise.all(m.map(async b=>{let I=g.routes[b.route.id];if(I){let x=await VW(I,T);return x.links?x.links():[]}return[]}));return WW(S.flat(1).filter(BW).filter(b=>b.rel==="stylesheet"||b.rel==="preload").map(b=>b.rel==="stylesheet"?{...b,rel:"prefetch",as:"style"}:{...b,rel:"prefetch"}))}function u3(m,g,T,S,b,I){let x=(P,V)=>T[V]?P.route.id!==T[V].route.id:!0,z=(P,V)=>T[V].pathname!==P.pathname||T[V].route.path?.endsWith("*")&&T[V].params["*"]!==P.params["*"];return I==="assets"?g.filter((P,V)=>x(P,V)||z(P,V)):I==="data"?g.filter((P,V)=>{let q=S.routes[P.route.id];if(!q||!q.hasLoader)return!1;if(x(P,V)||z(P,V))return!0;if(P.route.shouldRevalidate){let X=P.route.shouldRevalidate({currentUrl:new URL(b.pathname+b.search+b.hash,window.origin),currentParams:T[0]?.params||{},nextUrl:new URL(m,window.origin),nextParams:P.params,defaultShouldRevalidate:!0});if(typeof X=="boolean")return X}return!0}):[]}function FW(m,g,{includeHydrateFallback:T}={}){return GW(m.map(S=>{let b=g.routes[S.route.id];if(!b)return[];let I=[b.module];return b.clientActionModule&&(I=I.concat(b.clientActionModule)),b.clientLoaderModule&&(I=I.concat(b.clientLoaderModule)),T&&b.hydrateFallbackModule&&(I=I.concat(b.hydrateFallbackModule)),b.imports&&(I=I.concat(b.imports)),I}).flat(1))}function GW(m){return[...new Set(m)]}function HW(m){let g={},T=Object.keys(m).sort();for(let S of T)g[S]=m[S];return g}function WW(m,g){let T=new Set;return new Set(g),m.reduce((S,b)=>{let I=JSON.stringify(HW(b));return T.has(I)||(T.add(I),S.push({key:I,link:b})),S},[])}function j3(){let m=te.useContext(Um);return RO(m,"You must render this element inside a <DataRouterContext.Provider> element"),m}function zW(){let m=te.useContext(Vy);return RO(m,"You must render this element inside a <DataRouterStateContext.Provider> element"),m}var yO=te.createContext(void 0);yO.displayName="FrameworkContext";function F3(){let m=te.useContext(yO);return RO(m,"You must render this element inside a <HydratedRouter> element"),m}function KW(m,g){let T=te.useContext(yO),[S,b]=te.useState(!1),[I,x]=te.useState(!1),{onFocus:z,onBlur:P,onMouseEnter:V,onMouseLeave:q,onTouchStart:X}=g,se=te.useRef(null);te.useEffect(()=>{if(m==="render"&&x(!0),m==="viewport"){let ae=Ae=>{Ae.forEach(be=>{x(be.isIntersecting)})},oe=new IntersectionObserver(ae,{threshold:.5});return se.current&&oe.observe(se.current),()=>{oe.disconnect()}}},[m]),te.useEffect(()=>{if(S){let ae=setTimeout(()=>{x(!0)},100);return()=>{clearTimeout(ae)}}},[S]);let re=()=>{b(!0)},ue=()=>{b(!1),x(!1)};return T?m!=="intent"?[I,se,{}]:[I,se,{onFocus:ES(z,re),onBlur:ES(P,ue),onMouseEnter:ES(V,re),onMouseLeave:ES(q,ue),onTouchStart:ES(X,re)}]:[!1,se,{}]}function ES(m,g){return T=>{m&&m(T),T.defaultPrevented||g(T)}}function YW({page:m,...g}){let{router:T}=j3(),S=te.useMemo(()=>I3(T.routes,m,T.basename),[T.routes,m,T.basename]);return S?te.createElement(XW,{page:m,matches:S,...g}):null}function qW(m){let{manifest:g,routeModules:T}=F3(),[S,b]=te.useState([]);return te.useEffect(()=>{let I=!1;return jW(m,g,T).then(x=>{I||b(x)}),()=>{I=!0}},[m,g,T]),S}function XW({page:m,matches:g,...T}){let S=gc(),{manifest:b,routeModules:I}=F3(),{basename:x}=j3(),{loaderData:z,matches:P}=zW(),V=te.useMemo(()=>u3(m,g,P,b,S,"data"),[m,g,P,b,S]),q=te.useMemo(()=>u3(m,g,P,b,S,"assets"),[m,g,P,b,S]),X=te.useMemo(()=>{if(m===S.pathname+S.search+S.hash)return[];let ue=new Set,ae=!1;if(g.forEach(Ae=>{let be=b.routes[Ae.route.id];!be||!be.hasLoader||(!V.some(Oe=>Oe.route.id===Ae.route.id)&&Ae.route.id in z&&I[Ae.route.id]?.shouldRevalidate||be.hasClientLoader?ae=!0:ue.add(Ae.route.id))}),ue.size===0)return[];let oe=UW(m,x,"data");return ae&&ue.size>0&&oe.searchParams.set("_routes",g.filter(Ae=>ue.has(Ae.route.id)).map(Ae=>Ae.route.id).join(",")),[oe.pathname+oe.search]},[x,z,S,b,V,g,m,I]),se=te.useMemo(()=>FW(q,b),[q,b]),re=qW(q);return te.createElement(te.Fragment,null,X.map(ue=>te.createElement("link",{key:ue,rel:"prefetch",as:"fetch",href:ue,...T})),se.map(ue=>te.createElement("link",{key:ue,rel:"modulepreload",href:ue,...T})),re.map(({key:ue,link:ae})=>te.createElement("link",{key:ue,nonce:T.nonce,...ae})))}function JW(...m){return g=>{m.forEach(T=>{typeof T=="function"?T(g):T!=null&&(T.current=g)})}}var G3=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{G3&&(window.__reactRouterVersion="7.9.3")}catch{}function ZW({basename:m,children:g,window:T}){let S=te.useRef();S.current==null&&(S.current=x7({window:T,v5Compat:!0}));let b=S.current,[I,x]=te.useState({action:b.action,location:b.location}),z=te.useCallback(P=>{te.startTransition(()=>x(P))},[x]);return te.useLayoutEffect(()=>b.listen(z),[b,z]),te.createElement(wW,{basename:m,children:g,location:I.location,navigationType:I.action,navigator:b})}var H3=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,pn=te.forwardRef(function({onClick:g,discover:T="render",prefetch:S="none",relative:b,reloadDocument:I,replace:x,state:z,target:P,to:V,preventScrollReset:q,viewTransition:X,...se},re){let{basename:ue}=te.useContext(_c),ae=typeof V=="string"&&H3.test(V),oe,Ae=!1;if(typeof V=="string"&&ae&&(oe=V,G3))try{let kt=new URL(window.location.href),rt=V.startsWith("//")?new URL(kt.protocol+V):new URL(V),Ze=vl(rt.pathname,ue);rt.origin===kt.origin&&Ze!=null?V=Ze+rt.search+rt.hash:Ae=!0}catch{mc(!1,`<Link to="${V}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let be=lW(V,{relative:b}),[Oe,Xe,Ue]=KW(S,se),gt=tz(V,{replace:x,state:z,target:P,preventScrollReset:q,relative:b,viewTransition:X});function it(kt){g&&g(kt),kt.defaultPrevented||gt(kt)}let Ge=te.createElement("a",{...se,...Ue,href:oe||be,onClick:Ae||I?g:it,ref:JW(re,Xe),target:P,"data-discover":!ae&&T==="render"?"true":void 0});return Oe&&!ae?te.createElement(te.Fragment,null,Ge,te.createElement(YW,{page:be})):Ge});pn.displayName="Link";var QW=te.forwardRef(function({"aria-current":g="page",caseSensitive:T=!1,className:S="",end:b=!1,style:I,to:x,viewTransition:z,children:P,...V},q){let X=bS(x,{relative:V.relative}),se=gc(),re=te.useContext(Vy),{navigator:ue,basename:ae}=te.useContext(_c),oe=re!=null&&sz(X)&&z===!0,Ae=ue.encodeLocation?ue.encodeLocation(X).pathname:X.pathname,be=se.pathname,Oe=re&&re.navigation&&re.navigation.location?re.navigation.location.pathname:null;T||(be=be.toLowerCase(),Oe=Oe?Oe.toLowerCase():null,Ae=Ae.toLowerCase()),Oe&&ae&&(Oe=vl(Oe,ae)||Oe);const Xe=Ae!=="/"&&Ae.endsWith("/")?Ae.length-1:Ae.length;let Ue=be===Ae||!b&&be.startsWith(Ae)&&be.charAt(Xe)==="/",gt=Oe!=null&&(Oe===Ae||!b&&Oe.startsWith(Ae)&&Oe.charAt(Ae.length)==="/"),it={isActive:Ue,isPending:gt,isTransitioning:oe},Ge=Ue?g:void 0,kt;typeof S=="function"?kt=S(it):kt=[S,Ue?"active":null,gt?"pending":null,oe?"transitioning":null].filter(Boolean).join(" ");let rt=typeof I=="function"?I(it):I;return te.createElement(pn,{...V,"aria-current":Ge,className:kt,ref:q,style:rt,to:x,viewTransition:z},typeof P=="function"?P(it):P)});QW.displayName="NavLink";var $W=te.forwardRef(({discover:m="render",fetcherKey:g,navigate:T,reloadDocument:S,replace:b,state:I,method:x=Iy,action:z,onSubmit:P,relative:V,preventScrollReset:q,viewTransition:X,...se},re)=>{let ue=nz(),ae=az(z,{relative:V}),oe=x.toLowerCase()==="get"?"get":"post",Ae=typeof z=="string"&&H3.test(z),be=Oe=>{if(P&&P(Oe),Oe.defaultPrevented)return;Oe.preventDefault();let Xe=Oe.nativeEvent.submitter,Ue=Xe?.getAttribute("formmethod")||x;ue(Xe||Oe.currentTarget,{fetcherKey:g,method:Ue,navigate:T,replace:b,state:I,relative:V,preventScrollReset:q,viewTransition:X})};return te.createElement("form",{ref:re,method:oe,action:ae,onSubmit:S?P:be,...se,"data-discover":!Ae&&m==="render"?"true":void 0})});$W.displayName="Form";function ez(m){return`${m} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function W3(m){let g=te.useContext(Um);return gr(g,ez(m)),g}function tz(m,{target:g,replace:T,state:S,preventScrollReset:b,relative:I,viewTransition:x}={}){let z=CS(),P=gc(),V=bS(m,{relative:I});return te.useCallback(q=>{if(LW(q,g)){q.preventDefault();let X=T!==void 0?T:vS(P)===vS(V);z(m,{replace:X,state:S,preventScrollReset:b,relative:I,viewTransition:x})}},[P,z,V,T,S,g,m,b,I,x])}var iz=0,rz=()=>`__${String(++iz)}__`;function nz(){let{router:m}=W3("useSubmit"),{basename:g}=te.useContext(_c),T=RW();return te.useCallback(async(S,b={})=>{let{action:I,method:x,encType:z,formData:P,body:V}=xW(S,g);if(b.navigate===!1){let q=b.fetcherKey||rz();await m.fetch(q,T,b.action||I,{preventScrollReset:b.preventScrollReset,formData:P,body:V,formMethod:b.method||x,formEncType:b.encType||z,flushSync:b.flushSync})}else await m.navigate(b.action||I,{preventScrollReset:b.preventScrollReset,formData:P,body:V,formMethod:b.method||x,formEncType:b.encType||z,replace:b.replace,state:b.state,fromRouteId:T,flushSync:b.flushSync,viewTransition:b.viewTransition})},[m,g,T])}function az(m,{relative:g}={}){let{basename:T}=te.useContext(_c),S=te.useContext(Ec);gr(S,"useFormAction must be used inside a RouteContext");let[b]=S.matches.slice(-1),I={...bS(m||".",{relative:g})},x=gc();if(m==null){I.search=x.search;let z=new URLSearchParams(I.search),P=z.getAll("index");if(P.some(q=>q==="")){z.delete("index"),P.filter(X=>X).forEach(X=>z.append("index",X));let q=z.toString();I.search=q?`?${q}`:""}}return(!m||m===".")&&b.route.index&&(I.search=I.search?I.search.replace(/^\?/,"?index&"):"?index"),T!=="/"&&(I.pathname=I.pathname==="/"?T:Tl([T,I.pathname])),vS(I)}function sz(m,{relative:g}={}){let T=te.useContext(k3);gr(T!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:S}=W3("useViewTransitionState"),b=bS(m,{relative:g});if(!T.isTransitioning)return!1;let I=vl(T.currentLocation.pathname,S)||T.currentLocation.pathname,x=vl(T.nextLocation.pathname,S)||T.nextLocation.pathname;return Py(b.pathname,x)!=null||Py(b.pathname,I)!=null}const ba={TOP_NO_LOGIN:"/",TOP_LOGIN:"/auth",LIKE_LIST:"/like-list",SEARCH_TOP:"/search-top",USER_REGISTRATION:"/user-registration",LOGIN:"/login",REGISTRATION_EMAIL_SENT:"/registration-email-sent",CATEGORY_LIST:"/category-list",SEARCH_RESULT:"/search-result",MY_PAGE:"/my-page"},oz=[ba?.USER_REGISTRATION,ba?.LOGIN,ba?.REGISTRATION_EMAIL_SENT],z3="/assets/logo-Ro6IXcIN.svg",cz="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M15.0011%2015.6711L9.02113%209.69111C8.53113%2010.1011%207.9711%2010.4111%207.3711%2010.6211C6.7711%2010.8411%206.14111%2010.9511%205.50111%2010.9611C4.03111%2010.9911%202.62111%2010.4211%201.59111%209.37112C0.551105%208.35112%20-0.0288912%206.94112%200.0011088%205.48112C-0.0288912%202.48112%202.39112%200.0311088%205.39112%200.00110878C5.42112%200.00110878%205.45112%200.00110878%205.48112%200.00110878C6.94112%20-0.0288912%208.35111%200.55112%209.38111%201.59112C10.4311%202.61112%2011.0111%204.02112%2010.9811%205.48112C10.9811%206.14112%2010.8611%206.80112%2010.6211%207.42112C10.4111%208.00112%2010.0911%208.53111%209.69111%209.00111L15.7011%2015.0111L15.0111%2015.6811L15.0011%2015.6711ZM5.50111%2010.0011C7.97111%2010.0311%2010.0011%208.05111%2010.0211%205.58111C10.0211%205.55111%2010.0211%205.51112%2010.0211%205.48112C10.0511%203.01112%208.07111%200.981115%205.60111%200.961115C5.57111%200.961115%205.53111%200.961115%205.50111%200.961115C4.29111%200.931115%203.12113%201.40112%202.27113%202.26112C1.40113%203.10112%200.931121%204.27112%200.951121%205.48112C0.921121%206.69112%201.40113%207.86112%202.27113%208.70112C3.12113%209.56112%204.29111%2010.0311%205.50111%2010.0011Z'%20fill='%23EFEFEF'/%3e%3c/svg%3e";function lz(){const g=gc()?.pathname!==ba?.SEARCH_TOP;return J.jsxs("div",{className:"relative flex justify-center items-center w-full max-w-[768px] pt-[22px] pb-[17px] [&_img]:w-full [&_img]:h-full",children:[J.jsx(pn,{to:"/",className:"w-full max-w-[103px] aspect-[103/16]",children:J.jsx("img",{src:z3,alt:"logo",className:"w-full h-full"})}),g&&J.jsx(pn,{to:"/search-top",className:"absolute top-[23px] right-[17px] w-4 h-4",children:J.jsx("img",{src:cz,alt:"search",className:"w-full h-full"})})]})}const dz="data:image/svg+xml,%3csvg%20width='35'%20height='30'%20viewBox='0%200%2035%2030'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M31.5801%2017.22H34.4199H34.4399L32.6602%2015.4399L17.96%200.73999L17.2202%200L16.48%200.73999L1.78027%2015.4399L0.740234%2016.48L0%2017.21L6.88037%2017.22V29.38H27.5703V17.22H31.6001H31.5801ZM25.46%2027.24V27.3H8.93994V16L17.2002%207.75L25.46%2016V27.24Z'%20fill='white'/%3e%3cpath%20d='M19.5684%2020.1201H14.8281V24.4102H19.5684V20.1201Z'%20fill='white'/%3e%3cpath%20d='M19.5684%2014.79H14.8281V19.08H19.5684V14.79Z'%20fill='white'/%3e%3c/svg%3e",uz="data:image/svg+xml,%3csvg%20width='29'%20height='24'%20viewBox='0%200%2029%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M27.1802%205.20007H21.1499L20.21%200.98999C20.08%200.40999%2019.5702%200%2018.9702%200H9.49023C8.90023%200%208.38%200.40999%208.25%200.98999L7.31006%205.20007H1.27002C0.57002%205.20007%200%205.77009%200%206.47009V22.7201C0%2023.4201%200.57002%2023.99%201.27002%2023.99H27.1899C27.8899%2023.99%2028.46%2023.4201%2028.46%2022.7201V6.47009C28.46%205.77009%2027.8899%205.20007%2027.1899%205.20007H27.1802ZM7.22998%2014.6901C7.22998%2010.8201%2010.36%207.69006%2014.23%207.69006C18.1%207.69006%2021.23%2010.8301%2021.23%2014.6901C21.23%2018.5501%2018.1%2021.6901%2014.23%2021.6901C10.36%2021.6901%207.22998%2018.5601%207.22998%2014.6901ZM10.3203%205.2301L10.6201%203.46008H17.8403L18.1001%204.98999L18.1401%205.2301H10.3301H10.3203ZM23.6401%2020.78C22.9801%2020.78%2022.4399%2020.2401%2022.4399%2019.5801C22.4399%2018.9201%2022.9801%2018.38%2023.6401%2018.38C24.3001%2018.38%2024.8403%2018.9201%2024.8403%2019.5801C24.8403%2020.2401%2024.3001%2020.78%2023.6401%2020.78Z'%20fill='white'/%3e%3cpath%20d='M14.2295%2019.2496C16.7495%2019.2496%2018.7896%2017.2097%2018.7896%2014.6897C18.7896%2013.9597%2018.6198%2013.2797%2018.3198%2012.6697V12.6497L15.2197%2014.0897C14.8897%2014.2497%2014.5397%2013.8997%2014.6997%2013.5697L16.0996%2010.5697V10.5497H16.1099C15.5399%2010.2797%2014.8997%2010.1396%2014.2397%2010.1396C11.7197%2010.1396%209.67969%2012.1797%209.67969%2014.6997C9.67969%2017.2197%2011.7197%2019.2596%2014.2397%2019.2596L14.2295%2019.2496Z'%20fill='white'/%3e%3c/svg%3e",hz="data:image/svg+xml,%3csvg%20width='17'%20height='32'%20viewBox='0%200%2017%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8.03027%2011.42C10.9103%2011.42%2013.2402%209.08996%2013.2402%206.20996C13.2402%203.32996%2010.9103%201%208.03027%201C5.15027%201%202.82031%203.32996%202.82031%206.20996C2.82031%209.08996%205.15027%2011.42%208.03027%2011.42Z'%20stroke='white'%20stroke-width='2'%20stroke-miterlimit='10'/%3e%3cpath%20d='M11.6299%2015.2695H4.42969C2.53969%2015.2695%201%2016.1995%201%2018.6995C1%2021.1995%202.06%2024.6194%202.75%2026.9294C3.44%2029.2394%204.28969%2030.3595%206.17969%2030.3595H9.87988C11.7699%2030.3595%2012.6601%2029.3394%2013.3101%2026.9294C13.9701%2024.5094%2015.0601%2020.9195%2015.0601%2018.6995C15.0601%2016.4795%2013.5099%2015.2695%2011.6299%2015.2695Z'%20stroke='white'%20stroke-width='2'%20stroke-miterlimit='10'/%3e%3c/svg%3e";function pz({isSubFooter:m=!1}){const g=gc(),T=!oz?.includes(g.pathname)&&!m,S=[{label:"",img:dz,link:"/",class:"max-w-[34px] aspect-[34/29]"},{label:"",img:uz,link:"/",class:"max-w-[28px] aspect-[28/24]"},{label:"",img:hz,link:"/",class:"max-w-[15px] aspect-[15/30]"}];return T?J.jsx("div",{className:"flex justify-between items-end w-full max-w-[768px] h-[72px] pb-[23px] px-11",children:S.map(b=>J.jsxs(pn,{to:b.link,className:"flex flex-col items-center gap-[5px]",children:[J.jsx("img",{src:b.img,alt:b.label,className:`w-full ${b.class}`}),J.jsx("p",{className:"text-[8px] leading-[10px] text-white",children:b.label})]},b.label))}):J.jsx("div",{className:"flex items-end w-full max-w-[768px] h-[117px] pb-[14px] pl-[18px]",children:J.jsx("p",{className:"text-[8px] leading-[10px] text-white",children:"@Creative & Planning by New Company.2026"})})}function fz(){const m=gc(),g=te.useRef(null);return te.useLayoutEffect(()=>{g.current.scrollTo(0,0)},[m.pathname]),J.jsxs("div",{className:"main-layout flex flex-col items-center w-full h-full bg-dark-100",children:[J.jsx("header",{className:"flex justify-center w-full h-max bg-dark-100",children:J.jsx(lz,{})}),J.jsx("div",{ref:g,className:"relative body-container no-scrollbar flex justify-content grow w-full overflow-auto",children:J.jsx(AW,{context:g})}),J.jsx("footer",{className:"flex justify-center w-full h-max bg-dark-300",children:J.jsx(pz,{})})]})}function Sc({isTopPage:m=!1,isAuth:g=!1,title:T=""}){const S=()=>m?g?J.jsx("p",{children:"Welcome Back"}):J.jsxs(J.Fragment,{children:[J.jsx(pn,{to:"/",className:"text-inherit no-underline",children:""}),J.jsx(pn,{to:"/",className:"text-inherit no-underline",children:""})]}):J.jsx("p",{children:T});return(m||T)&&J.jsx("div",{className:"page-header flex justify-center gap-[22px] w-full pt-[11px] pb-[15px] text-[11px] leading-[13px] text-white bg-dark-300",children:S()})}function h3(m){return m!==null&&typeof m=="object"&&"constructor"in m&&m.constructor===Object}function CO(m={},g={}){const T=["__proto__","constructor","prototype"];Object.keys(g).filter(S=>T.indexOf(S)<0).forEach(S=>{typeof m[S]>"u"?m[S]=g[S]:h3(g[S])&&h3(m[S])&&Object.keys(g[S]).length>0&&CO(m[S],g[S])})}const K3={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector(){return null},querySelectorAll(){return[]},getElementById(){return null},createEvent(){return{initEvent(){}}},createElement(){return{children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName(){return[]}}},createElementNS(){return{}},importNode(){return null},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function Yh(){const m=typeof document<"u"?document:{};return CO(m,K3),m}const mz={document:K3,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle(){return{getPropertyValue(){return""}}},Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia(){return{}},requestAnimationFrame(m){return typeof setTimeout>"u"?(m(),null):setTimeout(m,0)},cancelAnimationFrame(m){typeof setTimeout>"u"||clearTimeout(m)}};function ia(){const m=typeof window<"u"?window:{};return CO(m,mz),m}function _z(m=""){return m.trim().split(" ").filter(g=>!!g.trim())}function Ez(m){const g=m;Object.keys(g).forEach(T=>{try{g[T]=null}catch{}try{delete g[T]}catch{}})}function Y3(m,g=0){return setTimeout(m,g)}function Ly(){return Date.now()}function gz(m){const g=ia();let T;return g.getComputedStyle&&(T=g.getComputedStyle(m,null)),!T&&m.currentStyle&&(T=m.currentStyle),T||(T=m.style),T}function Sz(m,g="x"){const T=ia();let S,b,I;const x=gz(m);return T.WebKitCSSMatrix?(b=x.transform||x.webkitTransform,b.split(",").length>6&&(b=b.split(", ").map(z=>z.replace(",",".")).join(", ")),I=new T.WebKitCSSMatrix(b==="none"?"":b)):(I=x.MozTransform||x.OTransform||x.MsTransform||x.msTransform||x.transform||x.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),S=I.toString().split(",")),g==="x"&&(T.WebKitCSSMatrix?b=I.m41:S.length===16?b=parseFloat(S[12]):b=parseFloat(S[4])),g==="y"&&(T.WebKitCSSMatrix?b=I.m42:S.length===16?b=parseFloat(S[13]):b=parseFloat(S[5])),b||0}function Ay(m){return typeof m=="object"&&m!==null&&m.constructor&&Object.prototype.toString.call(m).slice(8,-1)==="Object"}function Tz(m){return typeof window<"u"&&typeof window.HTMLElement<"u"?m instanceof HTMLElement:m&&(m.nodeType===1||m.nodeType===11)}function Qa(...m){const g=Object(m[0]),T=["__proto__","constructor","prototype"];for(let S=1;S<m.length;S+=1){const b=m[S];if(b!=null&&!Tz(b)){const I=Object.keys(Object(b)).filter(x=>T.indexOf(x)<0);for(let x=0,z=I.length;x<z;x+=1){const P=I[x],V=Object.getOwnPropertyDescriptor(b,P);V!==void 0&&V.enumerable&&(Ay(g[P])&&Ay(b[P])?b[P].__swiper__?g[P]=b[P]:Qa(g[P],b[P]):!Ay(g[P])&&Ay(b[P])?(g[P]={},b[P].__swiper__?g[P]=b[P]:Qa(g[P],b[P])):g[P]=b[P])}}}return g}function wy(m,g,T){m.style.setProperty(g,T)}function q3({swiper:m,targetPosition:g,side:T}){const S=ia(),b=-m.translate;let I=null,x;const z=m.params.speed;m.wrapperEl.style.scrollSnapType="none",S.cancelAnimationFrame(m.cssModeFrameID);const P=g>b?"next":"prev",V=(X,se)=>P==="next"&&X>=se||P==="prev"&&X<=se,q=()=>{x=new Date().getTime(),I===null&&(I=x);const X=Math.max(Math.min((x-I)/z,1),0),se=.5-Math.cos(X*Math.PI)/2;let re=b+se*(g-b);if(V(re,g)&&(re=g),m.wrapperEl.scrollTo({[T]:re}),V(re,g)){m.wrapperEl.style.overflow="hidden",m.wrapperEl.style.scrollSnapType="",setTimeout(()=>{m.wrapperEl.style.overflow="",m.wrapperEl.scrollTo({[T]:re})}),S.cancelAnimationFrame(m.cssModeFrameID);return}m.cssModeFrameID=S.requestAnimationFrame(q)};q()}function Sl(m,g=""){const T=ia(),S=[...m.children];return T.HTMLSlotElement&&m instanceof HTMLSlotElement&&S.push(...m.assignedElements()),g?S.filter(b=>b.matches(g)):S}function vz(m,g){const T=[g];for(;T.length>0;){const S=T.shift();if(m===S)return!0;T.push(...S.children,...S.shadowRoot?S.shadowRoot.children:[],...S.assignedElements?S.assignedElements():[])}}function Rz(m,g){const T=ia();let S=g.contains(m);return!S&&T.HTMLSlotElement&&g instanceof HTMLSlotElement&&(S=[...g.assignedElements()].includes(m),S||(S=vz(m,g))),S}function ky(m){try{console.warn(m);return}catch{}}function pO(m,g=[]){const T=document.createElement(m);return T.classList.add(...Array.isArray(g)?g:_z(g)),T}function yz(m,g){const T=[];for(;m.previousElementSibling;){const S=m.previousElementSibling;g?S.matches(g)&&T.push(S):T.push(S),m=S}return T}function Cz(m,g){const T=[];for(;m.nextElementSibling;){const S=m.nextElementSibling;g?S.matches(g)&&T.push(S):T.push(S),m=S}return T}function Qd(m,g){return ia().getComputedStyle(m,null).getPropertyValue(g)}function p3(m){let g=m,T;if(g){for(T=0;(g=g.previousSibling)!==null;)g.nodeType===1&&(T+=1);return T}}function bz(m,g){const T=[];let S=m.parentElement;for(;S;)T.push(S),S=S.parentElement;return T}function f3(m,g,T){const S=ia();return m[g==="width"?"offsetWidth":"offsetHeight"]+parseFloat(S.getComputedStyle(m,null).getPropertyValue(g==="width"?"margin-right":"margin-top"))+parseFloat(S.getComputedStyle(m,null).getPropertyValue(g==="width"?"margin-left":"margin-bottom"))}function m3(m,g=""){typeof trustedTypes<"u"?m.innerHTML=trustedTypes.createPolicy("html",{createHTML:T=>T}).createHTML(g):m.innerHTML=g}let nO;function Az(){const m=ia(),g=Yh();return{smoothScroll:g.documentElement&&g.documentElement.style&&"scrollBehavior"in g.documentElement.style,touch:!!("ontouchstart"in m||m.DocumentTouch&&g instanceof m.DocumentTouch)}}function X3(){return nO||(nO=Az()),nO}let aO;function wz({userAgent:m}={}){const g=X3(),T=ia(),S=T.navigator.platform,b=m||T.navigator.userAgent,I={ios:!1,android:!1},x=T.screen.width,z=T.screen.height,P=b.match(/(Android);?[\s\/]+([\d.]+)?/);let V=b.match(/(iPad)(?!\1).*OS\s([\d_]+)/);const q=b.match(/(iPod)(.*OS\s([\d_]+))?/),X=!V&&b.match(/(iPhone\sOS|iOS)\s([\d_]+)/),se=S==="Win32";let re=S==="MacIntel";const ue=["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"];return!V&&re&&g.touch&&ue.indexOf(`${x}x${z}`)>=0&&(V=b.match(/(Version)\/([\d.]+)/),V||(V=[0,1,"13_0_0"]),re=!1),P&&!se&&(I.os="android",I.android=!0),(V||X||q)&&(I.os="ios",I.ios=!0),I}function J3(m={}){return aO||(aO=wz(m)),aO}let sO;function Iz(){const m=ia(),g=J3();let T=!1;function S(){const z=m.navigator.userAgent.toLowerCase();return z.indexOf("safari")>=0&&z.indexOf("chrome")<0&&z.indexOf("android")<0}if(S()){const z=String(m.navigator.userAgent);if(z.includes("Version/")){const[P,V]=z.split("Version/")[1].split(" ")[0].split(".").map(q=>Number(q));T=P<16||P===16&&V<2}}const b=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(m.navigator.userAgent),I=S(),x=I||b&&g.ios;return{isSafari:T||I,needPerspectiveFix:T,need3dFix:x,isWebView:b}}function Z3(){return sO||(sO=Iz()),sO}function Oz({swiper:m,on:g,emit:T}){const S=ia();let b=null,I=null;const x=()=>{!m||m.destroyed||!m.initialized||(T("beforeResize"),T("resize"))},z=()=>{!m||m.destroyed||!m.initialized||(b=new ResizeObserver(q=>{I=S.requestAnimationFrame(()=>{const{width:X,height:se}=m;let re=X,ue=se;q.forEach(({contentBoxSize:ae,contentRect:oe,target:Ae})=>{Ae&&Ae!==m.el||(re=oe?oe.width:(ae[0]||ae).inlineSize,ue=oe?oe.height:(ae[0]||ae).blockSize)}),(re!==X||ue!==se)&&x()})}),b.observe(m.el))},P=()=>{I&&S.cancelAnimationFrame(I),b&&b.unobserve&&m.el&&(b.unobserve(m.el),b=null)},V=()=>{!m||m.destroyed||!m.initialized||T("orientationchange")};g("init",()=>{if(m.params.resizeObserver&&typeof S.ResizeObserver<"u"){z();return}S.addEventListener("resize",x),S.addEventListener("orientationchange",V)}),g("destroy",()=>{P(),S.removeEventListener("resize",x),S.removeEventListener("orientationchange",V)})}function Nz({swiper:m,extendParams:g,on:T,emit:S}){const b=[],I=ia(),x=(V,q={})=>{const X=I.MutationObserver||I.WebkitMutationObserver,se=new X(re=>{if(m.__preventObserver__)return;if(re.length===1){S("observerUpdate",re[0]);return}const ue=function(){S("observerUpdate",re[0])};I.requestAnimationFrame?I.requestAnimationFrame(ue):I.setTimeout(ue,0)});se.observe(V,{attributes:typeof q.attributes>"u"?!0:q.attributes,childList:m.isElement||(typeof q.childList>"u"?!0:q).childList,characterData:typeof q.characterData>"u"?!0:q.characterData}),b.push(se)},z=()=>{if(m.params.observer){if(m.params.observeParents){const V=bz(m.hostEl);for(let q=0;q<V.length;q+=1)x(V[q])}x(m.hostEl,{childList:m.params.observeSlideChildren}),x(m.wrapperEl,{attributes:!1})}},P=()=>{b.forEach(V=>{V.disconnect()}),b.splice(0,b.length)};g({observer:!1,observeParents:!1,observeSlideChildren:!1}),T("init",z),T("destroy",P)}var Dz={on(m,g,T){const S=this;if(!S.eventsListeners||S.destroyed||typeof g!="function")return S;const b=T?"unshift":"push";return m.split(" ").forEach(I=>{S.eventsListeners[I]||(S.eventsListeners[I]=[]),S.eventsListeners[I][b](g)}),S},once(m,g,T){const S=this;if(!S.eventsListeners||S.destroyed||typeof g!="function")return S;function b(...I){S.off(m,b),b.__emitterProxy&&delete b.__emitterProxy,g.apply(S,I)}return b.__emitterProxy=g,S.on(m,b,T)},onAny(m,g){const T=this;if(!T.eventsListeners||T.destroyed||typeof m!="function")return T;const S=g?"unshift":"push";return T.eventsAnyListeners.indexOf(m)<0&&T.eventsAnyListeners[S](m),T},offAny(m){const g=this;if(!g.eventsListeners||g.destroyed||!g.eventsAnyListeners)return g;const T=g.eventsAnyListeners.indexOf(m);return T>=0&&g.eventsAnyListeners.splice(T,1),g},off(m,g){const T=this;return!T.eventsListeners||T.destroyed||!T.eventsListeners||m.split(" ").forEach(S=>{typeof g>"u"?T.eventsListeners[S]=[]:T.eventsListeners[S]&&T.eventsListeners[S].forEach((b,I)=>{(b===g||b.__emitterProxy&&b.__emitterProxy===g)&&T.eventsListeners[S].splice(I,1)})}),T},emit(...m){const g=this;if(!g.eventsListeners||g.destroyed||!g.eventsListeners)return g;let T,S,b;return typeof m[0]=="string"||Array.isArray(m[0])?(T=m[0],S=m.slice(1,m.length),b=g):(T=m[0].events,S=m[0].data,b=m[0].context||g),S.unshift(b),(Array.isArray(T)?T:T.split(" ")).forEach(x=>{g.eventsAnyListeners&&g.eventsAnyListeners.length&&g.eventsAnyListeners.forEach(z=>{z.apply(b,[x,...S])}),g.eventsListeners&&g.eventsListeners[x]&&g.eventsListeners[x].forEach(z=>{z.apply(b,S)})}),g}};function Pz(){const m=this;let g,T;const S=m.el;typeof m.params.width<"u"&&m.params.width!==null?g=m.params.width:g=S.clientWidth,typeof m.params.height<"u"&&m.params.height!==null?T=m.params.height:T=S.clientHeight,!(g===0&&m.isHorizontal()||T===0&&m.isVertical())&&(g=g-parseInt(Qd(S,"padding-left")||0,10)-parseInt(Qd(S,"padding-right")||0,10),T=T-parseInt(Qd(S,"padding-top")||0,10)-parseInt(Qd(S,"padding-bottom")||0,10),Number.isNaN(g)&&(g=0),Number.isNaN(T)&&(T=0),Object.assign(m,{width:g,height:T,size:m.isHorizontal()?g:T}))}function Lz(){const m=this;function g(rt,Ze){return parseFloat(rt.getPropertyValue(m.getDirectionLabel(Ze))||0)}const T=m.params,{wrapperEl:S,slidesEl:b,rtlTranslate:I,wrongRTL:x}=m,z=m.virtual&&T.virtual.enabled,P=z?m.virtual.slides.length:m.slides.length,V=Sl(b,`.${m.params.slideClass}, swiper-slide`),q=z?m.virtual.slides.length:V.length;let X=[];const se=[],re=[];let ue=T.slidesOffsetBefore;typeof ue=="function"&&(ue=T.slidesOffsetBefore.call(m));let ae=T.slidesOffsetAfter;typeof ae=="function"&&(ae=T.slidesOffsetAfter.call(m));const oe=m.snapGrid.length,Ae=m.slidesGrid.length,be=m.size-ue-ae;let Oe=T.spaceBetween,Xe=-ue,Ue=0,gt=0;if(typeof be>"u")return;typeof Oe=="string"&&Oe.indexOf("%")>=0?Oe=parseFloat(Oe.replace("%",""))/100*be:typeof Oe=="string"&&(Oe=parseFloat(Oe)),m.virtualSize=-Oe-ue-ae,V.forEach(rt=>{I?rt.style.marginLeft="":rt.style.marginRight="",rt.style.marginBottom="",rt.style.marginTop=""}),T.centeredSlides&&T.cssMode&&(wy(S,"--swiper-centered-offset-before",""),wy(S,"--swiper-centered-offset-after",""));const it=T.grid&&T.grid.rows>1&&m.grid;it?m.grid.initSlides(V):m.grid&&m.grid.unsetSlides();let Ge;const kt=T.slidesPerView==="auto"&&T.breakpoints&&Object.keys(T.breakpoints).filter(rt=>typeof T.breakpoints[rt].slidesPerView<"u").length>0;for(let rt=0;rt<q;rt+=1){Ge=0;const Ze=V[rt];if(!(Ze&&(it&&m.grid.updateSlide(rt,Ze,V),Qd(Ze,"display")==="none"))){if(z&&T.slidesPerView==="auto")T.virtual.slidesPerViewAutoSlideSize&&(Ge=T.virtual.slidesPerViewAutoSlideSize),Ge&&Ze&&(T.roundLengths&&(Ge=Math.floor(Ge)),Ze.style[m.getDirectionLabel("width")]=`${Ge}px`);else if(T.slidesPerView==="auto"){kt&&(Ze.style[m.getDirectionLabel("width")]="");const Qe=getComputedStyle(Ze),Di=Ze.style.transform,ii=Ze.style.webkitTransform;if(Di&&(Ze.style.transform="none"),ii&&(Ze.style.webkitTransform="none"),T.roundLengths)Ge=m.isHorizontal()?f3(Ze,"width"):f3(Ze,"height");else{const Pi=g(Qe,"width"),Ne=g(Qe,"padding-left"),We=g(Qe,"padding-right"),He=g(Qe,"margin-left"),St=g(Qe,"margin-right"),ie=Qe.getPropertyValue("box-sizing");if(ie&&ie==="border-box")Ge=Pi+He+St;else{const{clientWidth:je,offsetWidth:$e}=Ze;Ge=Pi+Ne+We+He+St+($e-je)}}Di&&(Ze.style.transform=Di),ii&&(Ze.style.webkitTransform=ii),T.roundLengths&&(Ge=Math.floor(Ge))}else Ge=(be-(T.slidesPerView-1)*Oe)/T.slidesPerView,T.roundLengths&&(Ge=Math.floor(Ge)),Ze&&(Ze.style[m.getDirectionLabel("width")]=`${Ge}px`);Ze&&(Ze.swiperSlideSize=Ge),re.push(Ge),T.centeredSlides?(Xe=Xe+Ge/2+Ue/2+Oe,Ue===0&&rt!==0&&(Xe=Xe-be/2-Oe),rt===0&&(Xe=Xe-be/2-Oe),Math.abs(Xe)<1/1e3&&(Xe=0),T.roundLengths&&(Xe=Math.floor(Xe)),gt%T.slidesPerGroup===0&&X.push(Xe),se.push(Xe)):(T.roundLengths&&(Xe=Math.floor(Xe)),(gt-Math.min(m.params.slidesPerGroupSkip,gt))%m.params.slidesPerGroup===0&&X.push(Xe),se.push(Xe),Xe=Xe+Ge+Oe),m.virtualSize+=Ge+Oe,Ue=Ge,gt+=1}}if(m.virtualSize=Math.max(m.virtualSize,be)+ae,I&&x&&(T.effect==="slide"||T.effect==="coverflow")&&(S.style.width=`${m.virtualSize+Oe}px`),T.setWrapperSize&&(S.style[m.getDirectionLabel("width")]=`${m.virtualSize+Oe}px`),it&&m.grid.updateWrapperSize(Ge,X),!T.centeredSlides){const rt=[];for(let Ze=0;Ze<X.length;Ze+=1){let Qe=X[Ze];T.roundLengths&&(Qe=Math.floor(Qe)),X[Ze]<=m.virtualSize-be&&rt.push(Qe)}X=rt,Math.floor(m.virtualSize-be)-Math.floor(X[X.length-1])>1&&X.push(m.virtualSize-be)}if(z&&T.loop){const rt=re[0]+Oe;if(T.slidesPerGroup>1){const Ze=Math.ceil((m.virtual.slidesBefore+m.virtual.slidesAfter)/T.slidesPerGroup),Qe=rt*T.slidesPerGroup;for(let Di=0;Di<Ze;Di+=1)X.push(X[X.length-1]+Qe)}for(let Ze=0;Ze<m.virtual.slidesBefore+m.virtual.slidesAfter;Ze+=1)T.slidesPerGroup===1&&X.push(X[X.length-1]+rt),se.push(se[se.length-1]+rt),m.virtualSize+=rt}if(X.length===0&&(X=[0]),Oe!==0){const rt=m.isHorizontal()&&I?"marginLeft":m.getDirectionLabel("marginRight");V.filter((Ze,Qe)=>!T.cssMode||T.loop?!0:Qe!==V.length-1).forEach(Ze=>{Ze.style[rt]=`${Oe}px`})}if(T.centeredSlides&&T.centeredSlidesBounds){let rt=0;re.forEach(Qe=>{rt+=Qe+(Oe||0)}),rt-=Oe;const Ze=rt>be?rt-be:0;X=X.map(Qe=>Qe<=0?-ue:Qe>Ze?Ze+ae:Qe)}if(T.centerInsufficientSlides){let rt=0;re.forEach(Qe=>{rt+=Qe+(Oe||0)}),rt-=Oe;const Ze=(ue||0)+(ae||0);if(rt+Ze<be){const Qe=(be-rt-Ze)/2;X.forEach((Di,ii)=>{X[ii]=Di-Qe}),se.forEach((Di,ii)=>{se[ii]=Di+Qe})}}if(Object.assign(m,{slides:V,snapGrid:X,slidesGrid:se,slidesSizesGrid:re}),T.centeredSlides&&T.cssMode&&!T.centeredSlidesBounds){wy(S,"--swiper-centered-offset-before",`${-X[0]}px`),wy(S,"--swiper-centered-offset-after",`${m.size/2-re[re.length-1]/2}px`);const rt=-m.snapGrid[0],Ze=-m.slidesGrid[0];m.snapGrid=m.snapGrid.map(Qe=>Qe+rt),m.slidesGrid=m.slidesGrid.map(Qe=>Qe+Ze)}if(q!==P&&m.emit("slidesLengthChange"),X.length!==oe&&(m.params.watchOverflow&&m.checkOverflow(),m.emit("snapGridLengthChange")),se.length!==Ae&&m.emit("slidesGridLengthChange"),T.watchSlidesProgress&&m.updateSlidesOffset(),m.emit("slidesUpdated"),!z&&!T.cssMode&&(T.effect==="slide"||T.effect==="fade")){const rt=`${T.containerModifierClass}backface-hidden`,Ze=m.el.classList.contains(rt);q<=T.maxBackfaceHiddenSlides?Ze||m.el.classList.add(rt):Ze&&m.el.classList.remove(rt)}}function kz(m){const g=this,T=[],S=g.virtual&&g.params.virtual.enabled;let b=0,I;typeof m=="number"?g.setTransition(m):m===!0&&g.setTransition(g.params.speed);const x=z=>S?g.slides[g.getSlideIndexByData(z)]:g.slides[z];if(g.params.slidesPerView!=="auto"&&g.params.slidesPerView>1)if(g.params.centeredSlides)(g.visibleSlides||[]).forEach(z=>{T.push(z)});else for(I=0;I<Math.ceil(g.params.slidesPerView);I+=1){const z=g.activeIndex+I;if(z>g.slides.length&&!S)break;T.push(x(z))}else T.push(x(g.activeIndex));for(I=0;I<T.length;I+=1)if(typeof T[I]<"u"){const z=T[I].offsetHeight;b=z>b?z:b}(b||b===0)&&(g.wrapperEl.style.height=`${b}px`)}function Mz(){const m=this,g=m.slides,T=m.isElement?m.isHorizontal()?m.wrapperEl.offsetLeft:m.wrapperEl.offsetTop:0;for(let S=0;S<g.length;S+=1)g[S].swiperSlideOffset=(m.isHorizontal()?g[S].offsetLeft:g[S].offsetTop)-T-m.cssOverflowAdjustment()}const _3=(m,g,T)=>{g&&!m.classList.contains(T)?m.classList.add(T):!g&&m.classList.contains(T)&&m.classList.remove(T)};function xz(m=this&&this.translate||0){const g=this,T=g.params,{slides:S,rtlTranslate:b,snapGrid:I}=g;if(S.length===0)return;typeof S[0].swiperSlideOffset>"u"&&g.updateSlidesOffset();let x=-m;b&&(x=m),g.visibleSlidesIndexes=[],g.visibleSlides=[];let z=T.spaceBetween;typeof z=="string"&&z.indexOf("%")>=0?z=parseFloat(z.replace("%",""))/100*g.size:typeof z=="string"&&(z=parseFloat(z));for(let P=0;P<S.length;P+=1){const V=S[P];let q=V.swiperSlideOffset;T.cssMode&&T.centeredSlides&&(q-=S[0].swiperSlideOffset);const X=(x+(T.centeredSlides?g.minTranslate():0)-q)/(V.swiperSlideSize+z),se=(x-I[0]+(T.centeredSlides?g.minTranslate():0)-q)/(V.swiperSlideSize+z),re=-(x-q),ue=re+g.slidesSizesGrid[P],ae=re>=0&&re<=g.size-g.slidesSizesGrid[P],oe=re>=0&&re<g.size-1||ue>1&&ue<=g.size||re<=0&&ue>=g.size;oe&&(g.visibleSlides.push(V),g.visibleSlidesIndexes.push(P)),_3(V,oe,T.slideVisibleClass),_3(V,ae,T.slideFullyVisibleClass),V.progress=b?-X:X,V.originalProgress=b?-se:se}}function Uz(m){const g=this;if(typeof m>"u"){const q=g.rtlTranslate?-1:1;m=g&&g.translate&&g.translate*q||0}const T=g.params,S=g.maxTranslate()-g.minTranslate();let{progress:b,isBeginning:I,isEnd:x,progressLoop:z}=g;const P=I,V=x;if(S===0)b=0,I=!0,x=!0;else{b=(m-g.minTranslate())/S;const q=Math.abs(m-g.minTranslate())<1,X=Math.abs(m-g.maxTranslate())<1;I=q||b<=0,x=X||b>=1,q&&(b=0),X&&(b=1)}if(T.loop){const q=g.getSlideIndexByData(0),X=g.getSlideIndexByData(g.slides.length-1),se=g.slidesGrid[q],re=g.slidesGrid[X],ue=g.slidesGrid[g.slidesGrid.length-1],ae=Math.abs(m);ae>=se?z=(ae-se)/ue:z=(ae+ue-re)/ue,z>1&&(z-=1)}Object.assign(g,{progress:b,progressLoop:z,isBeginning:I,isEnd:x}),(T.watchSlidesProgress||T.centeredSlides&&T.autoHeight)&&g.updateSlidesProgress(m),I&&!P&&g.emit("reachBeginning toEdge"),x&&!V&&g.emit("reachEnd toEdge"),(P&&!I||V&&!x)&&g.emit("fromEdge"),g.emit("progress",b)}const oO=(m,g,T)=>{g&&!m.classList.contains(T)?m.classList.add(T):!g&&m.classList.contains(T)&&m.classList.remove(T)};function Vz(){const m=this,{slides:g,params:T,slidesEl:S,activeIndex:b}=m,I=m.virtual&&T.virtual.enabled,x=m.grid&&T.grid&&T.grid.rows>1,z=X=>Sl(S,`.${T.slideClass}${X}, swiper-slide${X}`)[0];let P,V,q;if(I)if(T.loop){let X=b-m.virtual.slidesBefore;X<0&&(X=m.virtual.slides.length+X),X>=m.virtual.slides.length&&(X-=m.virtual.slides.length),P=z(`[data-swiper-slide-index="${X}"]`)}else P=z(`[data-swiper-slide-index="${b}"]`);else x?(P=g.find(X=>X.column===b),q=g.find(X=>X.column===b+1),V=g.find(X=>X.column===b-1)):P=g[b];P&&(x||(q=Cz(P,`.${T.slideClass}, swiper-slide`)[0],T.loop&&!q&&(q=g[0]),V=yz(P,`.${T.slideClass}, swiper-slide`)[0],T.loop&&!V===0&&(V=g[g.length-1]))),g.forEach(X=>{oO(X,X===P,T.slideActiveClass),oO(X,X===q,T.slideNextClass),oO(X,X===V,T.slidePrevClass)}),m.emitSlidesClasses()}const Ny=(m,g)=>{if(!m||m.destroyed||!m.params)return;const T=()=>m.isElement?"swiper-slide":`.${m.params.slideClass}`,S=g.closest(T());if(S){let b=S.querySelector(`.${m.params.lazyPreloaderClass}`);!b&&m.isElement&&(S.shadowRoot?b=S.shadowRoot.querySelector(`.${m.params.lazyPreloaderClass}`):requestAnimationFrame(()=>{S.shadowRoot&&(b=S.shadowRoot.querySelector(`.${m.params.lazyPreloaderClass}`),b&&b.remove())})),b&&b.remove()}},cO=(m,g)=>{if(!m.slides[g])return;const T=m.slides[g].querySelector('[loading="lazy"]');T&&T.removeAttribute("loading")},fO=m=>{if(!m||m.destroyed||!m.params)return;let g=m.params.lazyPreloadPrevNext;const T=m.slides.length;if(!T||!g||g<0)return;g=Math.min(g,T);const S=m.params.slidesPerView==="auto"?m.slidesPerViewDynamic():Math.ceil(m.params.slidesPerView),b=m.activeIndex;if(m.params.grid&&m.params.grid.rows>1){const x=b,z=[x-g];z.push(...Array.from({length:g}).map((P,V)=>x+S+V)),m.slides.forEach((P,V)=>{z.includes(P.column)&&cO(m,V)});return}const I=b+S-1;if(m.params.rewind||m.params.loop)for(let x=b-g;x<=I+g;x+=1){const z=(x%T+T)%T;(z<b||z>I)&&cO(m,z)}else for(let x=Math.max(b-g,0);x<=Math.min(I+g,T-1);x+=1)x!==b&&(x>I||x<b)&&cO(m,x)};function Bz(m){const{slidesGrid:g,params:T}=m,S=m.rtlTranslate?m.translate:-m.translate;let b;for(let I=0;I<g.length;I+=1)typeof g[I+1]<"u"?S>=g[I]&&S<g[I+1]-(g[I+1]-g[I])/2?b=I:S>=g[I]&&S<g[I+1]&&(b=I+1):S>=g[I]&&(b=I);return T.normalizeSlideIndex&&(b<0||typeof b>"u")&&(b=0),b}function jz(m){const g=this,T=g.rtlTranslate?g.translate:-g.translate,{snapGrid:S,params:b,activeIndex:I,realIndex:x,snapIndex:z}=g;let P=m,V;const q=re=>{let ue=re-g.virtual.slidesBefore;return ue<0&&(ue=g.virtual.slides.length+ue),ue>=g.virtual.slides.length&&(ue-=g.virtual.slides.length),ue};if(typeof P>"u"&&(P=Bz(g)),S.indexOf(T)>=0)V=S.indexOf(T);else{const re=Math.min(b.slidesPerGroupSkip,P);V=re+Math.floor((P-re)/b.slidesPerGroup)}if(V>=S.length&&(V=S.length-1),P===I&&!g.params.loop){V!==z&&(g.snapIndex=V,g.emit("snapIndexChange"));return}if(P===I&&g.params.loop&&g.virtual&&g.params.virtual.enabled){g.realIndex=q(P);return}const X=g.grid&&b.grid&&b.grid.rows>1;let se;if(g.virtual&&b.virtual.enabled&&b.loop)se=q(P);else if(X){const re=g.slides.find(ae=>ae.column===P);let ue=parseInt(re.getAttribute("data-swiper-slide-index"),10);Number.isNaN(ue)&&(ue=Math.max(g.slides.indexOf(re),0)),se=Math.floor(ue/b.grid.rows)}else if(g.slides[P]){const re=g.slides[P].getAttribute("data-swiper-slide-index");re?se=parseInt(re,10):se=P}else se=P;Object.assign(g,{previousSnapIndex:z,snapIndex:V,previousRealIndex:x,realIndex:se,previousIndex:I,activeIndex:P}),g.initialized&&fO(g),g.emit("activeIndexChange"),g.emit("snapIndexChange"),(g.initialized||g.params.runCallbacksOnInit)&&(x!==se&&g.emit("realIndexChange"),g.emit("slideChange"))}function Fz(m,g){const T=this,S=T.params;let b=m.closest(`.${S.slideClass}, swiper-slide`);!b&&T.isElement&&g&&g.length>1&&g.includes(m)&&[...g.slice(g.indexOf(m)+1,g.length)].forEach(z=>{!b&&z.matches&&z.matches(`.${S.slideClass}, swiper-slide`)&&(b=z)});let I=!1,x;if(b){for(let z=0;z<T.slides.length;z+=1)if(T.slides[z]===b){I=!0,x=z;break}}if(b&&I)T.clickedSlide=b,T.virtual&&T.params.virtual.enabled?T.clickedIndex=parseInt(b.getAttribute("data-swiper-slide-index"),10):T.clickedIndex=x;else{T.clickedSlide=void 0,T.clickedIndex=void 0;return}S.slideToClickedSlide&&T.clickedIndex!==void 0&&T.clickedIndex!==T.activeIndex&&T.slideToClickedSlide()}var Gz={updateSize:Pz,updateSlides:Lz,updateAutoHeight:kz,updateSlidesOffset:Mz,updateSlidesProgress:xz,updateProgress:Uz,updateSlidesClasses:Vz,updateActiveIndex:jz,updateClickedSlide:Fz};function Hz(m=this.isHorizontal()?"x":"y"){const g=this,{params:T,rtlTranslate:S,translate:b,wrapperEl:I}=g;if(T.virtualTranslate)return S?-b:b;if(T.cssMode)return b;let x=Sz(I,m);return x+=g.cssOverflowAdjustment(),S&&(x=-x),x||0}function Wz(m,g){const T=this,{rtlTranslate:S,params:b,wrapperEl:I,progress:x}=T;let z=0,P=0;const V=0;T.isHorizontal()?z=S?-m:m:P=m,b.roundLengths&&(z=Math.floor(z),P=Math.floor(P)),T.previousTranslate=T.translate,T.translate=T.isHorizontal()?z:P,b.cssMode?I[T.isHorizontal()?"scrollLeft":"scrollTop"]=T.isHorizontal()?-z:-P:b.virtualTranslate||(T.isHorizontal()?z-=T.cssOverflowAdjustment():P-=T.cssOverflowAdjustment(),I.style.transform=`translate3d(${z}px, ${P}px, ${V}px)`);let q;const X=T.maxTranslate()-T.minTranslate();X===0?q=0:q=(m-T.minTranslate())/X,q!==x&&T.updateProgress(m),T.emit("setTranslate",T.translate,g)}function zz(){return-this.snapGrid[0]}function Kz(){return-this.snapGrid[this.snapGrid.length-1]}function Yz(m=0,g=this.params.speed,T=!0,S=!0,b){const I=this,{params:x,wrapperEl:z}=I;if(I.animating&&x.preventInteractionOnTransition)return!1;const P=I.minTranslate(),V=I.maxTranslate();let q;if(S&&m>P?q=P:S&&m<V?q=V:q=m,I.updateProgress(q),x.cssMode){const X=I.isHorizontal();if(g===0)z[X?"scrollLeft":"scrollTop"]=-q;else{if(!I.support.smoothScroll)return q3({swiper:I,targetPosition:-q,side:X?"left":"top"}),!0;z.scrollTo({[X?"left":"top"]:-q,behavior:"smooth"})}return!0}return g===0?(I.setTransition(0),I.setTranslate(q),T&&(I.emit("beforeTransitionStart",g,b),I.emit("transitionEnd"))):(I.setTransition(g),I.setTranslate(q),T&&(I.emit("beforeTransitionStart",g,b),I.emit("transitionStart")),I.animating||(I.animating=!0,I.onTranslateToWrapperTransitionEnd||(I.onTranslateToWrapperTransitionEnd=function(se){!I||I.destroyed||se.target===this&&(I.wrapperEl.removeEventListener("transitionend",I.onTranslateToWrapperTransitionEnd),I.onTranslateToWrapperTransitionEnd=null,delete I.onTranslateToWrapperTransitionEnd,I.animating=!1,T&&I.emit("transitionEnd"))}),I.wrapperEl.addEventListener("transitionend",I.onTranslateToWrapperTransitionEnd))),!0}var qz={getTranslate:Hz,setTranslate:Wz,minTranslate:zz,maxTranslate:Kz,translateTo:Yz};function Xz(m,g){const T=this;T.params.cssMode||(T.wrapperEl.style.transitionDuration=`${m}ms`,T.wrapperEl.style.transitionDelay=m===0?"0ms":""),T.emit("setTransition",m,g)}function Q3({swiper:m,runCallbacks:g,direction:T,step:S}){const{activeIndex:b,previousIndex:I}=m;let x=T;x||(b>I?x="next":b<I?x="prev":x="reset"),m.emit(`transition${S}`),g&&x==="reset"?m.emit(`slideResetTransition${S}`):g&&b!==I&&(m.emit(`slideChangeTransition${S}`),x==="next"?m.emit(`slideNextTransition${S}`):m.emit(`slidePrevTransition${S}`))}function Jz(m=!0,g){const T=this,{params:S}=T;S.cssMode||(S.autoHeight&&T.updateAutoHeight(),Q3({swiper:T,runCallbacks:m,direction:g,step:"Start"}))}function Zz(m=!0,g){const T=this,{params:S}=T;T.animating=!1,!S.cssMode&&(T.setTransition(0),Q3({swiper:T,runCallbacks:m,direction:g,step:"End"}))}var Qz={setTransition:Xz,transitionStart:Jz,transitionEnd:Zz};function $z(m=0,g,T=!0,S,b){typeof m=="string"&&(m=parseInt(m,10));const I=this;let x=m;x<0&&(x=0);const{params:z,snapGrid:P,slidesGrid:V,previousIndex:q,activeIndex:X,rtlTranslate:se,wrapperEl:re,enabled:ue}=I;if(!ue&&!S&&!b||I.destroyed||I.animating&&z.preventInteractionOnTransition)return!1;typeof g>"u"&&(g=I.params.speed);const ae=Math.min(I.params.slidesPerGroupSkip,x);let oe=ae+Math.floor((x-ae)/I.params.slidesPerGroup);oe>=P.length&&(oe=P.length-1);const Ae=-P[oe];if(z.normalizeSlideIndex)for(let it=0;it<V.length;it+=1){const Ge=-Math.floor(Ae*100),kt=Math.floor(V[it]*100),rt=Math.floor(V[it+1]*100);typeof V[it+1]<"u"?Ge>=kt&&Ge<rt-(rt-kt)/2?x=it:Ge>=kt&&Ge<rt&&(x=it+1):Ge>=kt&&(x=it)}if(I.initialized&&x!==X&&(!I.allowSlideNext&&(se?Ae>I.translate&&Ae>I.minTranslate():Ae<I.translate&&Ae<I.minTranslate())||!I.allowSlidePrev&&Ae>I.translate&&Ae>I.maxTranslate()&&(X||0)!==x))return!1;x!==(q||0)&&T&&I.emit("beforeSlideChangeStart"),I.updateProgress(Ae);let be;x>X?be="next":x<X?be="prev":be="reset";const Oe=I.virtual&&I.params.virtual.enabled;if(!(Oe&&b)&&(se&&-Ae===I.translate||!se&&Ae===I.translate))return I.updateActiveIndex(x),z.autoHeight&&I.updateAutoHeight(),I.updateSlidesClasses(),z.effect!=="slide"&&I.setTranslate(Ae),be!=="reset"&&(I.transitionStart(T,be),I.transitionEnd(T,be)),!1;if(z.cssMode){const it=I.isHorizontal(),Ge=se?Ae:-Ae;if(g===0)Oe&&(I.wrapperEl.style.scrollSnapType="none",I._immediateVirtual=!0),Oe&&!I._cssModeVirtualInitialSet&&I.params.initialSlide>0?(I._cssModeVirtualInitialSet=!0,requestAnimationFrame(()=>{re[it?"scrollLeft":"scrollTop"]=Ge})):re[it?"scrollLeft":"scrollTop"]=Ge,Oe&&requestAnimationFrame(()=>{I.wrapperEl.style.scrollSnapType="",I._immediateVirtual=!1});else{if(!I.support.smoothScroll)return q3({swiper:I,targetPosition:Ge,side:it?"left":"top"}),!0;re.scrollTo({[it?"left":"top"]:Ge,behavior:"smooth"})}return!0}const gt=Z3().isSafari;return Oe&&!b&&gt&&I.isElement&&I.virtual.update(!1,!1,x),I.setTransition(g),I.setTranslate(Ae),I.updateActiveIndex(x),I.updateSlidesClasses(),I.emit("beforeTransitionStart",g,S),I.transitionStart(T,be),g===0?I.transitionEnd(T,be):I.animating||(I.animating=!0,I.onSlideToWrapperTransitionEnd||(I.onSlideToWrapperTransitionEnd=function(Ge){!I||I.destroyed||Ge.target===this&&(I.wrapperEl.removeEventListener("transitionend",I.onSlideToWrapperTransitionEnd),I.onSlideToWrapperTransitionEnd=null,delete I.onSlideToWrapperTransitionEnd,I.transitionEnd(T,be))}),I.wrapperEl.addEventListener("transitionend",I.onSlideToWrapperTransitionEnd)),!0}function eK(m=0,g,T=!0,S){typeof m=="string"&&(m=parseInt(m,10));const b=this;if(b.destroyed)return;typeof g>"u"&&(g=b.params.speed);const I=b.grid&&b.params.grid&&b.params.grid.rows>1;let x=m;if(b.params.loop)if(b.virtual&&b.params.virtual.enabled)x=x+b.virtual.slidesBefore;else{let z;if(I){const ae=x*b.params.grid.rows;z=b.slides.find(oe=>oe.getAttribute("data-swiper-slide-index")*1===ae).column}else z=b.getSlideIndexByData(x);const P=I?Math.ceil(b.slides.length/b.params.grid.rows):b.slides.length,{centeredSlides:V,slidesOffsetBefore:q,slidesOffsetAfter:X}=b.params,se=V||!!q||!!X;let re=b.params.slidesPerView;re==="auto"?re=b.slidesPerViewDynamic():(re=Math.ceil(parseFloat(b.params.slidesPerView,10)),se&&re%2===0&&(re=re+1));let ue=P-z<re;if(se&&(ue=ue||z<Math.ceil(re/2)),S&&se&&b.params.slidesPerView!=="auto"&&!I&&(ue=!1),ue){const ae=se?z<b.activeIndex?"prev":"next":z-b.activeIndex-1<b.params.slidesPerView?"next":"prev";b.loopFix({direction:ae,slideTo:!0,activeSlideIndex:ae==="next"?z+1:z-P+1,slideRealIndex:ae==="next"?b.realIndex:void 0})}if(I){const ae=x*b.params.grid.rows;x=b.slides.find(oe=>oe.getAttribute("data-swiper-slide-index")*1===ae).column}else x=b.getSlideIndexByData(x)}return requestAnimationFrame(()=>{b.slideTo(x,g,T,S)}),b}function tK(m,g=!0,T){const S=this,{enabled:b,params:I,animating:x}=S;if(!b||S.destroyed)return S;typeof m>"u"&&(m=S.params.speed);let z=I.slidesPerGroup;I.slidesPerView==="auto"&&I.slidesPerGroup===1&&I.slidesPerGroupAuto&&(z=Math.max(S.slidesPerViewDynamic("current",!0),1));const P=S.activeIndex<I.slidesPerGroupSkip?1:z,V=S.virtual&&I.virtual.enabled;if(I.loop){if(x&&!V&&I.loopPreventsSliding)return!1;if(S.loopFix({direction:"next"}),S._clientLeft=S.wrapperEl.clientLeft,S.activeIndex===S.slides.length-1&&I.cssMode)return requestAnimationFrame(()=>{S.slideTo(S.activeIndex+P,m,g,T)}),!0}return I.rewind&&S.isEnd?S.slideTo(0,m,g,T):S.slideTo(S.activeIndex+P,m,g,T)}function iK(m,g=!0,T){const S=this,{params:b,snapGrid:I,slidesGrid:x,rtlTranslate:z,enabled:P,animating:V}=S;if(!P||S.destroyed)return S;typeof m>"u"&&(m=S.params.speed);const q=S.virtual&&b.virtual.enabled;if(b.loop){if(V&&!q&&b.loopPreventsSliding)return!1;S.loopFix({direction:"prev"}),S._clientLeft=S.wrapperEl.clientLeft}const X=z?S.translate:-S.translate;function se(be){return be<0?-Math.floor(Math.abs(be)):Math.floor(be)}const re=se(X),ue=I.map(be=>se(be)),ae=b.freeMode&&b.freeMode.enabled;let oe=I[ue.indexOf(re)-1];if(typeof oe>"u"&&(b.cssMode||ae)){let be;I.forEach((Oe,Xe)=>{re>=Oe&&(be=Xe)}),typeof be<"u"&&(oe=ae?I[be]:I[be>0?be-1:be])}let Ae=0;if(typeof oe<"u"&&(Ae=x.indexOf(oe),Ae<0&&(Ae=S.activeIndex-1),b.slidesPerView==="auto"&&b.slidesPerGroup===1&&b.slidesPerGroupAuto&&(Ae=Ae-S.slidesPerViewDynamic("previous",!0)+1,Ae=Math.max(Ae,0))),b.rewind&&S.isBeginning){const be=S.params.virtual&&S.params.virtual.enabled&&S.virtual?S.virtual.slides.length-1:S.slides.length-1;return S.slideTo(be,m,g,T)}else if(b.loop&&S.activeIndex===0&&b.cssMode)return requestAnimationFrame(()=>{S.slideTo(Ae,m,g,T)}),!0;return S.slideTo(Ae,m,g,T)}function rK(m,g=!0,T){const S=this;if(!S.destroyed)return typeof m>"u"&&(m=S.params.speed),S.slideTo(S.activeIndex,m,g,T)}function nK(m,g=!0,T,S=.5){const b=this;if(b.destroyed)return;typeof m>"u"&&(m=b.params.speed);let I=b.activeIndex;const x=Math.min(b.params.slidesPerGroupSkip,I),z=x+Math.floor((I-x)/b.params.slidesPerGroup),P=b.rtlTranslate?b.translate:-b.translate;if(P>=b.snapGrid[z]){const V=b.snapGrid[z],q=b.snapGrid[z+1];P-V>(q-V)*S&&(I+=b.params.slidesPerGroup)}else{const V=b.snapGrid[z-1],q=b.snapGrid[z];P-V<=(q-V)*S&&(I-=b.params.slidesPerGroup)}return I=Math.max(I,0),I=Math.min(I,b.slidesGrid.length-1),b.slideTo(I,m,g,T)}function aK(){const m=this;if(m.destroyed)return;const{params:g,slidesEl:T}=m,S=g.slidesPerView==="auto"?m.slidesPerViewDynamic():g.slidesPerView;let b=m.getSlideIndexWhenGrid(m.clickedIndex),I;const x=m.isElement?"swiper-slide":`.${g.slideClass}`,z=m.grid&&m.params.grid&&m.params.grid.rows>1;if(g.loop){if(m.animating)return;I=parseInt(m.clickedSlide.getAttribute("data-swiper-slide-index"),10),g.centeredSlides?m.slideToLoop(I):b>(z?(m.slides.length-S)/2-(m.params.grid.rows-1):m.slides.length-S)?(m.loopFix(),b=m.getSlideIndex(Sl(T,`${x}[data-swiper-slide-index="${I}"]`)[0]),Y3(()=>{m.slideTo(b)})):m.slideTo(b)}else m.slideTo(b)}var sK={slideTo:$z,slideToLoop:eK,slideNext:tK,slidePrev:iK,slideReset:rK,slideToClosest:nK,slideToClickedSlide:aK};function oK(m,g){const T=this,{params:S,slidesEl:b}=T;if(!S.loop||T.virtual&&T.params.virtual.enabled)return;const I=()=>{Sl(b,`.${S.slideClass}, swiper-slide`).forEach((ue,ae)=>{ue.setAttribute("data-swiper-slide-index",ae)})},x=()=>{const re=Sl(b,`.${S.slideBlankClass}`);re.forEach(ue=>{ue.remove()}),re.length>0&&(T.recalcSlides(),T.updateSlides())},z=T.grid&&S.grid&&S.grid.rows>1;S.loopAddBlankSlides&&(S.slidesPerGroup>1||z)&&x();const P=S.slidesPerGroup*(z?S.grid.rows:1),V=T.slides.length%P!==0,q=z&&T.slides.length%S.grid.rows!==0,X=re=>{for(let ue=0;ue<re;ue+=1){const ae=T.isElement?pO("swiper-slide",[S.slideBlankClass]):pO("div",[S.slideClass,S.slideBlankClass]);T.slidesEl.append(ae)}};if(V){if(S.loopAddBlankSlides){const re=P-T.slides.length%P;X(re),T.recalcSlides(),T.updateSlides()}else ky("Swiper Loop Warning: The number of slides is not even to slidesPerGroup, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");I()}else if(q){if(S.loopAddBlankSlides){const re=S.grid.rows-T.slides.length%S.grid.rows;X(re),T.recalcSlides(),T.updateSlides()}else ky("Swiper Loop Warning: The number of slides is not even to grid.rows, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");I()}else I();const se=S.centeredSlides||!!S.slidesOffsetBefore||!!S.slidesOffsetAfter;T.loopFix({slideRealIndex:m,direction:se?void 0:"next",initial:g})}function cK({slideRealIndex:m,slideTo:g=!0,direction:T,setTranslate:S,activeSlideIndex:b,initial:I,byController:x,byMousewheel:z}={}){const P=this;if(!P.params.loop)return;P.emit("beforeLoopFix");const{slides:V,allowSlidePrev:q,allowSlideNext:X,slidesEl:se,params:re}=P,{centeredSlides:ue,slidesOffsetBefore:ae,slidesOffsetAfter:oe,initialSlide:Ae}=re,be=ue||!!ae||!!oe;if(P.allowSlidePrev=!0,P.allowSlideNext=!0,P.virtual&&re.virtual.enabled){g&&(!be&&P.snapIndex===0?P.slideTo(P.virtual.slides.length,0,!1,!0):be&&P.snapIndex<re.slidesPerView?P.slideTo(P.virtual.slides.length+P.snapIndex,0,!1,!0):P.snapIndex===P.snapGrid.length-1&&P.slideTo(P.virtual.slidesBefore,0,!1,!0)),P.allowSlidePrev=q,P.allowSlideNext=X,P.emit("loopFix");return}let Oe=re.slidesPerView;Oe==="auto"?Oe=P.slidesPerViewDynamic():(Oe=Math.ceil(parseFloat(re.slidesPerView,10)),be&&Oe%2===0&&(Oe=Oe+1));const Xe=re.slidesPerGroupAuto?Oe:re.slidesPerGroup;let Ue=be?Math.max(Xe,Math.ceil(Oe/2)):Xe;Ue%Xe!==0&&(Ue+=Xe-Ue%Xe),Ue+=re.loopAdditionalSlides,P.loopedSlides=Ue;const gt=P.grid&&re.grid&&re.grid.rows>1;V.length<Oe+Ue||P.params.effect==="cards"&&V.length<Oe+Ue*2?ky("Swiper Loop Warning: The number of slides is not enough for loop mode, it will be disabled or not function properly. You need to add more slides (or make duplicates) or lower the values of slidesPerView and slidesPerGroup parameters"):gt&&re.grid.fill==="row"&&ky("Swiper Loop Warning: Loop mode is not compatible with grid.fill = `row`");const it=[],Ge=[],kt=gt?Math.ceil(V.length/re.grid.rows):V.length,rt=I&&kt-Ae<Oe&&!be;let Ze=rt?Ae:P.activeIndex;typeof b>"u"?b=P.getSlideIndex(V.find(He=>He.classList.contains(re.slideActiveClass))):Ze=b;const Qe=T==="next"||!T,Di=T==="prev"||!T;let ii=0,Pi=0;const We=(gt?V[b].column:b)+(be&&typeof S>"u"?-Oe/2+.5:0);if(We<Ue){ii=Math.max(Ue-We,Xe);for(let He=0;He<Ue-We;He+=1){const St=He-Math.floor(He/kt)*kt;if(gt){const ie=kt-St-1;for(let je=V.length-1;je>=0;je-=1)V[je].column===ie&&it.push(je)}else it.push(kt-St-1)}}else if(We+Oe>kt-Ue){Pi=Math.max(We-(kt-Ue*2),Xe),rt&&(Pi=Math.max(Pi,Oe-kt+Ae+1));for(let He=0;He<Pi;He+=1){const St=He-Math.floor(He/kt)*kt;gt?V.forEach((ie,je)=>{ie.column===St&&Ge.push(je)}):Ge.push(St)}}if(P.__preventObserver__=!0,requestAnimationFrame(()=>{P.__preventObserver__=!1}),P.params.effect==="cards"&&V.length<Oe+Ue*2&&(Ge.includes(b)&&Ge.splice(Ge.indexOf(b),1),it.includes(b)&&it.splice(it.indexOf(b),1)),Di&&it.forEach(He=>{V[He].swiperLoopMoveDOM=!0,se.prepend(V[He]),V[He].swiperLoopMoveDOM=!1}),Qe&&Ge.forEach(He=>{V[He].swiperLoopMoveDOM=!0,se.append(V[He]),V[He].swiperLoopMoveDOM=!1}),P.recalcSlides(),re.slidesPerView==="auto"?P.updateSlides():gt&&(it.length>0&&Di||Ge.length>0&&Qe)&&P.slides.forEach((He,St)=>{P.grid.updateSlide(St,He,P.slides)}),re.watchSlidesProgress&&P.updateSlidesOffset(),g){if(it.length>0&&Di){if(typeof m>"u"){const He=P.slidesGrid[Ze],ie=P.slidesGrid[Ze+ii]-He;z?P.setTranslate(P.translate-ie):(P.slideTo(Ze+Math.ceil(ii),0,!1,!0),S&&(P.touchEventsData.startTranslate=P.touchEventsData.startTranslate-ie,P.touchEventsData.currentTranslate=P.touchEventsData.currentTranslate-ie))}else if(S){const He=gt?it.length/re.grid.rows:it.length;P.slideTo(P.activeIndex+He,0,!1,!0),P.touchEventsData.currentTranslate=P.translate}}else if(Ge.length>0&&Qe)if(typeof m>"u"){const He=P.slidesGrid[Ze],ie=P.slidesGrid[Ze-Pi]-He;z?P.setTranslate(P.translate-ie):(P.slideTo(Ze-Pi,0,!1,!0),S&&(P.touchEventsData.startTranslate=P.touchEventsData.startTranslate-ie,P.touchEventsData.currentTranslate=P.touchEventsData.currentTranslate-ie))}else{const He=gt?Ge.length/re.grid.rows:Ge.length;P.slideTo(P.activeIndex-He,0,!1,!0)}}if(P.allowSlidePrev=q,P.allowSlideNext=X,P.controller&&P.controller.control&&!x){const He={slideRealIndex:m,direction:T,setTranslate:S,activeSlideIndex:b,byController:!0};Array.isArray(P.controller.control)?P.controller.control.forEach(St=>{!St.destroyed&&St.params.loop&&St.loopFix({...He,slideTo:St.params.slidesPerView===re.slidesPerView?g:!1})}):P.controller.control instanceof P.constructor&&P.controller.control.params.loop&&P.controller.control.loopFix({...He,slideTo:P.controller.control.params.slidesPerView===re.slidesPerView?g:!1})}P.emit("loopFix")}function lK(){const m=this,{params:g,slidesEl:T}=m;if(!g.loop||!T||m.virtual&&m.params.virtual.enabled)return;m.recalcSlides();const S=[];m.slides.forEach(b=>{const I=typeof b.swiperSlideIndex>"u"?b.getAttribute("data-swiper-slide-index")*1:b.swiperSlideIndex;S[I]=b}),m.slides.forEach(b=>{b.removeAttribute("data-swiper-slide-index")}),S.forEach(b=>{T.append(b)}),m.recalcSlides(),m.slideTo(m.realIndex,0)}var dK={loopCreate:oK,loopFix:cK,loopDestroy:lK};function uK(m){const g=this;if(!g.params.simulateTouch||g.params.watchOverflow&&g.isLocked||g.params.cssMode)return;const T=g.params.touchEventsTarget==="container"?g.el:g.wrapperEl;g.isElement&&(g.__preventObserver__=!0),T.style.cursor="move",T.style.cursor=m?"grabbing":"grab",g.isElement&&requestAnimationFrame(()=>{g.__preventObserver__=!1})}function hK(){const m=this;m.params.watchOverflow&&m.isLocked||m.params.cssMode||(m.isElement&&(m.__preventObserver__=!0),m[m.params.touchEventsTarget==="container"?"el":"wrapperEl"].style.cursor="",m.isElement&&requestAnimationFrame(()=>{m.__preventObserver__=!1}))}var pK={setGrabCursor:uK,unsetGrabCursor:hK};function fK(m,g=this){function T(S){if(!S||S===Yh()||S===ia())return null;S.assignedSlot&&(S=S.assignedSlot);const b=S.closest(m);return!b&&!S.getRootNode?null:b||T(S.getRootNode().host)}return T(g)}function E3(m,g,T){const S=ia(),{params:b}=m,I=b.edgeSwipeDetection,x=b.edgeSwipeThreshold;return I&&(T<=x||T>=S.innerWidth-x)?I==="prevent"?(g.preventDefault(),!0):!1:!0}function mK(m){const g=this,T=Yh();let S=m;S.originalEvent&&(S=S.originalEvent);const b=g.touchEventsData;if(S.type==="pointerdown"){if(b.pointerId!==null&&b.pointerId!==S.pointerId)return;b.pointerId=S.pointerId}else S.type==="touchstart"&&S.targetTouches.length===1&&(b.touchId=S.targetTouches[0].identifier);if(S.type==="touchstart"){E3(g,S,S.targetTouches[0].pageX);return}const{params:I,touches:x,enabled:z}=g;if(!z||!I.simulateTouch&&S.pointerType==="mouse"||g.animating&&I.preventInteractionOnTransition)return;!g.animating&&I.cssMode&&I.loop&&g.loopFix();let P=S.target;if(I.touchEventsTarget==="wrapper"&&!Rz(P,g.wrapperEl)||"which"in S&&S.which===3||"button"in S&&S.button>0||b.isTouched&&b.isMoved)return;const V=!!I.noSwipingClass&&I.noSwipingClass!=="",q=S.composedPath?S.composedPath():S.path;V&&S.target&&S.target.shadowRoot&&q&&(P=q[0]);const X=I.noSwipingSelector?I.noSwipingSelector:`.${I.noSwipingClass}`,se=!!(S.target&&S.target.shadowRoot);if(I.noSwiping&&(se?fK(X,P):P.closest(X))){g.allowClick=!0;return}if(I.swipeHandler&&!P.closest(I.swipeHandler))return;x.currentX=S.pageX,x.currentY=S.pageY;const re=x.currentX,ue=x.currentY;if(!E3(g,S,re))return;Object.assign(b,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),x.startX=re,x.startY=ue,b.touchStartTime=Ly(),g.allowClick=!0,g.updateSize(),g.swipeDirection=void 0,I.threshold>0&&(b.allowThresholdMove=!1);let ae=!0;P.matches(b.focusableElements)&&(ae=!1,P.nodeName==="SELECT"&&(b.isTouched=!1)),T.activeElement&&T.activeElement.matches(b.focusableElements)&&T.activeElement!==P&&(S.pointerType==="mouse"||S.pointerType!=="mouse"&&!P.matches(b.focusableElements))&&T.activeElement.blur();const oe=ae&&g.allowTouchMove&&I.touchStartPreventDefault;(I.touchStartForcePreventDefault||oe)&&!P.isContentEditable&&S.preventDefault(),I.freeMode&&I.freeMode.enabled&&g.freeMode&&g.animating&&!I.cssMode&&g.freeMode.onTouchStart(),g.emit("touchStart",S)}function _K(m){const g=Yh(),T=this,S=T.touchEventsData,{params:b,touches:I,rtlTranslate:x,enabled:z}=T;if(!z||!b.simulateTouch&&m.pointerType==="mouse")return;let P=m;if(P.originalEvent&&(P=P.originalEvent),P.type==="pointermove"&&(S.touchId!==null||P.pointerId!==S.pointerId))return;let V;if(P.type==="touchmove"){if(V=[...P.changedTouches].find(Ue=>Ue.identifier===S.touchId),!V||V.identifier!==S.touchId)return}else V=P;if(!S.isTouched){S.startMoving&&S.isScrolling&&T.emit("touchMoveOpposite",P);return}const q=V.pageX,X=V.pageY;if(P.preventedByNestedSwiper){I.startX=q,I.startY=X;return}if(!T.allowTouchMove){P.target.matches(S.focusableElements)||(T.allowClick=!1),S.isTouched&&(Object.assign(I,{startX:q,startY:X,currentX:q,currentY:X}),S.touchStartTime=Ly());return}if(b.touchReleaseOnEdges&&!b.loop)if(T.isVertical()){if(X<I.startY&&T.translate<=T.maxTranslate()||X>I.startY&&T.translate>=T.minTranslate()){S.isTouched=!1,S.isMoved=!1;return}}else{if(x&&(q>I.startX&&-T.translate<=T.maxTranslate()||q<I.startX&&-T.translate>=T.minTranslate()))return;if(!x&&(q<I.startX&&T.translate<=T.maxTranslate()||q>I.startX&&T.translate>=T.minTranslate()))return}if(g.activeElement&&g.activeElement.matches(S.focusableElements)&&g.activeElement!==P.target&&P.pointerType!=="mouse"&&g.activeElement.blur(),g.activeElement&&P.target===g.activeElement&&P.target.matches(S.focusableElements)){S.isMoved=!0,T.allowClick=!1;return}S.allowTouchCallbacks&&T.emit("touchMove",P),I.previousX=I.currentX,I.previousY=I.currentY,I.currentX=q,I.currentY=X;const se=I.currentX-I.startX,re=I.currentY-I.startY;if(T.params.threshold&&Math.sqrt(se**2+re**2)<T.params.threshold)return;if(typeof S.isScrolling>"u"){let Ue;T.isHorizontal()&&I.currentY===I.startY||T.isVertical()&&I.currentX===I.startX?S.isScrolling=!1:se*se+re*re>=25&&(Ue=Math.atan2(Math.abs(re),Math.abs(se))*180/Math.PI,S.isScrolling=T.isHorizontal()?Ue>b.touchAngle:90-Ue>b.touchAngle)}if(S.isScrolling&&T.emit("touchMoveOpposite",P),typeof S.startMoving>"u"&&(I.currentX!==I.startX||I.currentY!==I.startY)&&(S.startMoving=!0),S.isScrolling||P.type==="touchmove"&&S.preventTouchMoveFromPointerMove){S.isTouched=!1;return}if(!S.startMoving)return;T.allowClick=!1,!b.cssMode&&P.cancelable&&P.preventDefault(),b.touchMoveStopPropagation&&!b.nested&&P.stopPropagation();let ue=T.isHorizontal()?se:re,ae=T.isHorizontal()?I.currentX-I.previousX:I.currentY-I.previousY;b.oneWayMovement&&(ue=Math.abs(ue)*(x?1:-1),ae=Math.abs(ae)*(x?1:-1)),I.diff=ue,ue*=b.touchRatio,x&&(ue=-ue,ae=-ae);const oe=T.touchesDirection;T.swipeDirection=ue>0?"prev":"next",T.touchesDirection=ae>0?"prev":"next";const Ae=T.params.loop&&!b.cssMode,be=T.touchesDirection==="next"&&T.allowSlideNext||T.touchesDirection==="prev"&&T.allowSlidePrev;if(!S.isMoved){if(Ae&&be&&T.loopFix({direction:T.swipeDirection}),S.startTranslate=T.getTranslate(),T.setTransition(0),T.animating){const Ue=new window.CustomEvent("transitionend",{bubbles:!0,cancelable:!0,detail:{bySwiperTouchMove:!0}});T.wrapperEl.dispatchEvent(Ue)}S.allowMomentumBounce=!1,b.grabCursor&&(T.allowSlideNext===!0||T.allowSlidePrev===!0)&&T.setGrabCursor(!0),T.emit("sliderFirstMove",P)}if(new Date().getTime(),b._loopSwapReset!==!1&&S.isMoved&&S.allowThresholdMove&&oe!==T.touchesDirection&&Ae&&be&&Math.abs(ue)>=1){Object.assign(I,{startX:q,startY:X,currentX:q,currentY:X,startTranslate:S.currentTranslate}),S.loopSwapReset=!0,S.startTranslate=S.currentTranslate;return}T.emit("sliderMove",P),S.isMoved=!0,S.currentTranslate=ue+S.startTranslate;let Oe=!0,Xe=b.resistanceRatio;if(b.touchReleaseOnEdges&&(Xe=0),ue>0?(Ae&&be&&S.allowThresholdMove&&S.currentTranslate>(b.centeredSlides?T.minTranslate()-T.slidesSizesGrid[T.activeIndex+1]-(b.slidesPerView!=="auto"&&T.slides.length-b.slidesPerView>=2?T.slidesSizesGrid[T.activeIndex+1]+T.params.spaceBetween:0)-T.params.spaceBetween:T.minTranslate())&&T.loopFix({direction:"prev",setTranslate:!0,activeSlideIndex:0}),S.currentTranslate>T.minTranslate()&&(Oe=!1,b.resistance&&(S.currentTranslate=T.minTranslate()-1+(-T.minTranslate()+S.startTranslate+ue)**Xe))):ue<0&&(Ae&&be&&S.allowThresholdMove&&S.currentTranslate<(b.centeredSlides?T.maxTranslate()+T.slidesSizesGrid[T.slidesSizesGrid.length-1]+T.params.spaceBetween+(b.slidesPerView!=="auto"&&T.slides.length-b.slidesPerView>=2?T.slidesSizesGrid[T.slidesSizesGrid.length-1]+T.params.spaceBetween:0):T.maxTranslate())&&T.loopFix({direction:"next",setTranslate:!0,activeSlideIndex:T.slides.length-(b.slidesPerView==="auto"?T.slidesPerViewDynamic():Math.ceil(parseFloat(b.slidesPerView,10)))}),S.currentTranslate<T.maxTranslate()&&(Oe=!1,b.resistance&&(S.currentTranslate=T.maxTranslate()+1-(T.maxTranslate()-S.startTranslate-ue)**Xe))),Oe&&(P.preventedByNestedSwiper=!0),!T.allowSlideNext&&T.swipeDirection==="next"&&S.currentTranslate<S.startTranslate&&(S.currentTranslate=S.startTranslate),!T.allowSlidePrev&&T.swipeDirection==="prev"&&S.currentTranslate>S.startTranslate&&(S.currentTranslate=S.startTranslate),!T.allowSlidePrev&&!T.allowSlideNext&&(S.currentTranslate=S.startTranslate),b.threshold>0)if(Math.abs(ue)>b.threshold||S.allowThresholdMove){if(!S.allowThresholdMove){S.allowThresholdMove=!0,I.startX=I.currentX,I.startY=I.currentY,S.currentTranslate=S.startTranslate,I.diff=T.isHorizontal()?I.currentX-I.startX:I.currentY-I.startY;return}}else{S.currentTranslate=S.startTranslate;return}!b.followFinger||b.cssMode||((b.freeMode&&b.freeMode.enabled&&T.freeMode||b.watchSlidesProgress)&&(T.updateActiveIndex(),T.updateSlidesClasses()),b.freeMode&&b.freeMode.enabled&&T.freeMode&&T.freeMode.onTouchMove(),T.updateProgress(S.currentTranslate),T.setTranslate(S.currentTranslate))}function EK(m){const g=this,T=g.touchEventsData;let S=m;S.originalEvent&&(S=S.originalEvent);let b;if(S.type==="touchend"||S.type==="touchcancel"){if(b=[...S.changedTouches].find(Ue=>Ue.identifier===T.touchId),!b||b.identifier!==T.touchId)return}else{if(T.touchId!==null||S.pointerId!==T.pointerId)return;b=S}if(["pointercancel","pointerout","pointerleave","contextmenu"].includes(S.type)&&!(["pointercancel","contextmenu"].includes(S.type)&&(g.browser.isSafari||g.browser.isWebView)))return;T.pointerId=null,T.touchId=null;const{params:x,touches:z,rtlTranslate:P,slidesGrid:V,enabled:q}=g;if(!q||!x.simulateTouch&&S.pointerType==="mouse")return;if(T.allowTouchCallbacks&&g.emit("touchEnd",S),T.allowTouchCallbacks=!1,!T.isTouched){T.isMoved&&x.grabCursor&&g.setGrabCursor(!1),T.isMoved=!1,T.startMoving=!1;return}x.grabCursor&&T.isMoved&&T.isTouched&&(g.allowSlideNext===!0||g.allowSlidePrev===!0)&&g.setGrabCursor(!1);const X=Ly(),se=X-T.touchStartTime;if(g.allowClick){const Ue=S.path||S.composedPath&&S.composedPath();g.updateClickedSlide(Ue&&Ue[0]||S.target,Ue),g.emit("tap click",S),se<300&&X-T.lastClickTime<300&&g.emit("doubleTap doubleClick",S)}if(T.lastClickTime=Ly(),Y3(()=>{g.destroyed||(g.allowClick=!0)}),!T.isTouched||!T.isMoved||!g.swipeDirection||z.diff===0&&!T.loopSwapReset||T.currentTranslate===T.startTranslate&&!T.loopSwapReset){T.isTouched=!1,T.isMoved=!1,T.startMoving=!1;return}T.isTouched=!1,T.isMoved=!1,T.startMoving=!1;let re;if(x.followFinger?re=P?g.translate:-g.translate:re=-T.currentTranslate,x.cssMode)return;if(x.freeMode&&x.freeMode.enabled){g.freeMode.onTouchEnd({currentPos:re});return}const ue=re>=-g.maxTranslate()&&!g.params.loop;let ae=0,oe=g.slidesSizesGrid[0];for(let Ue=0;Ue<V.length;Ue+=Ue<x.slidesPerGroupSkip?1:x.slidesPerGroup){const gt=Ue<x.slidesPerGroupSkip-1?1:x.slidesPerGroup;typeof V[Ue+gt]<"u"?(ue||re>=V[Ue]&&re<V[Ue+gt])&&(ae=Ue,oe=V[Ue+gt]-V[Ue]):(ue||re>=V[Ue])&&(ae=Ue,oe=V[V.length-1]-V[V.length-2])}let Ae=null,be=null;x.rewind&&(g.isBeginning?be=x.virtual&&x.virtual.enabled&&g.virtual?g.virtual.slides.length-1:g.slides.length-1:g.isEnd&&(Ae=0));const Oe=(re-V[ae])/oe,Xe=ae<x.slidesPerGroupSkip-1?1:x.slidesPerGroup;if(se>x.longSwipesMs){if(!x.longSwipes){g.slideTo(g.activeIndex);return}g.swipeDirection==="next"&&(Oe>=x.longSwipesRatio?g.slideTo(x.rewind&&g.isEnd?Ae:ae+Xe):g.slideTo(ae)),g.swipeDirection==="prev"&&(Oe>1-x.longSwipesRatio?g.slideTo(ae+Xe):be!==null&&Oe<0&&Math.abs(Oe)>x.longSwipesRatio?g.slideTo(be):g.slideTo(ae))}else{if(!x.shortSwipes){g.slideTo(g.activeIndex);return}g.navigation&&(S.target===g.navigation.nextEl||S.target===g.navigation.prevEl)?S.target===g.navigation.nextEl?g.slideTo(ae+Xe):g.slideTo(ae):(g.swipeDirection==="next"&&g.slideTo(Ae!==null?Ae:ae+Xe),g.swipeDirection==="prev"&&g.slideTo(be!==null?be:ae))}}function g3(){const m=this,{params:g,el:T}=m;if(T&&T.offsetWidth===0)return;g.breakpoints&&m.setBreakpoint();const{allowSlideNext:S,allowSlidePrev:b,snapGrid:I}=m,x=m.virtual&&m.params.virtual.enabled;m.allowSlideNext=!0,m.allowSlidePrev=!0,m.updateSize(),m.updateSlides(),m.updateSlidesClasses();const z=x&&g.loop;(g.slidesPerView==="auto"||g.slidesPerView>1)&&m.isEnd&&!m.isBeginning&&!m.params.centeredSlides&&!z?m.slideTo(m.slides.length-1,0,!1,!0):m.params.loop&&!x?m.slideToLoop(m.realIndex,0,!1,!0):m.slideTo(m.activeIndex,0,!1,!0),m.autoplay&&m.autoplay.running&&m.autoplay.paused&&(clearTimeout(m.autoplay.resizeTimeout),m.autoplay.resizeTimeout=setTimeout(()=>{m.autoplay&&m.autoplay.running&&m.autoplay.paused&&m.autoplay.resume()},500)),m.allowSlidePrev=b,m.allowSlideNext=S,m.params.watchOverflow&&I!==m.snapGrid&&m.checkOverflow()}function gK(m){const g=this;g.enabled&&(g.allowClick||(g.params.preventClicks&&m.preventDefault(),g.params.preventClicksPropagation&&g.animating&&(m.stopPropagation(),m.stopImmediatePropagation())))}function SK(){const m=this,{wrapperEl:g,rtlTranslate:T,enabled:S}=m;if(!S)return;m.previousTranslate=m.translate,m.isHorizontal()?m.translate=-g.scrollLeft:m.translate=-g.scrollTop,m.translate===0&&(m.translate=0),m.updateActiveIndex(),m.updateSlidesClasses();let b;const I=m.maxTranslate()-m.minTranslate();I===0?b=0:b=(m.translate-m.minTranslate())/I,b!==m.progress&&m.updateProgress(T?-m.translate:m.translate),m.emit("setTranslate",m.translate,!1)}function TK(m){const g=this;Ny(g,m.target),!(g.params.cssMode||g.params.slidesPerView!=="auto"&&!g.params.autoHeight)&&g.update()}function vK(){const m=this;m.documentTouchHandlerProceeded||(m.documentTouchHandlerProceeded=!0,m.params.touchReleaseOnEdges&&(m.el.style.touchAction="auto"))}const $3=(m,g)=>{const T=Yh(),{params:S,el:b,wrapperEl:I,device:x}=m,z=!!S.nested,P=g==="on"?"addEventListener":"removeEventListener",V=g;!b||typeof b=="string"||(T[P]("touchstart",m.onDocumentTouchStart,{passive:!1,capture:z}),b[P]("touchstart",m.onTouchStart,{passive:!1}),b[P]("pointerdown",m.onTouchStart,{passive:!1}),T[P]("touchmove",m.onTouchMove,{passive:!1,capture:z}),T[P]("pointermove",m.onTouchMove,{passive:!1,capture:z}),T[P]("touchend",m.onTouchEnd,{passive:!0}),T[P]("pointerup",m.onTouchEnd,{passive:!0}),T[P]("pointercancel",m.onTouchEnd,{passive:!0}),T[P]("touchcancel",m.onTouchEnd,{passive:!0}),T[P]("pointerout",m.onTouchEnd,{passive:!0}),T[P]("pointerleave",m.onTouchEnd,{passive:!0}),T[P]("contextmenu",m.onTouchEnd,{passive:!0}),(S.preventClicks||S.preventClicksPropagation)&&b[P]("click",m.onClick,!0),S.cssMode&&I[P]("scroll",m.onScroll),S.updateOnWindowResize?m[V](x.ios||x.android?"resize orientationchange observerUpdate":"resize observerUpdate",g3,!0):m[V]("observerUpdate",g3,!0),b[P]("load",m.onLoad,{capture:!0}))};function RK(){const m=this,{params:g}=m;m.onTouchStart=mK.bind(m),m.onTouchMove=_K.bind(m),m.onTouchEnd=EK.bind(m),m.onDocumentTouchStart=vK.bind(m),g.cssMode&&(m.onScroll=SK.bind(m)),m.onClick=gK.bind(m),m.onLoad=TK.bind(m),$3(m,"on")}function yK(){$3(this,"off")}var CK={attachEvents:RK,detachEvents:yK};const S3=(m,g)=>m.grid&&g.grid&&g.grid.rows>1;function bK(){const m=this,{realIndex:g,initialized:T,params:S,el:b}=m,I=S.breakpoints;if(!I||I&&Object.keys(I).length===0)return;const x=Yh(),z=S.breakpointsBase==="window"||!S.breakpointsBase?S.breakpointsBase:"container",P=["window","container"].includes(S.breakpointsBase)||!S.breakpointsBase?m.el:x.querySelector(S.breakpointsBase),V=m.getBreakpoint(I,z,P);if(!V||m.currentBreakpoint===V)return;const X=(V in I?I[V]:void 0)||m.originalParams,se=S3(m,S),re=S3(m,X),ue=m.params.grabCursor,ae=X.grabCursor,oe=S.enabled;se&&!re?(b.classList.remove(`${S.containerModifierClass}grid`,`${S.containerModifierClass}grid-column`),m.emitContainerClasses()):!se&&re&&(b.classList.add(`${S.containerModifierClass}grid`),(X.grid.fill&&X.grid.fill==="column"||!X.grid.fill&&S.grid.fill==="column")&&b.classList.add(`${S.containerModifierClass}grid-column`),m.emitContainerClasses()),ue&&!ae?m.unsetGrabCursor():!ue&&ae&&m.setGrabCursor(),["navigation","pagination","scrollbar"].forEach(gt=>{if(typeof X[gt]>"u")return;const it=S[gt]&&S[gt].enabled,Ge=X[gt]&&X[gt].enabled;it&&!Ge&&m[gt].disable(),!it&&Ge&&m[gt].enable()});const Ae=X.direction&&X.direction!==S.direction,be=S.loop&&(X.slidesPerView!==S.slidesPerView||Ae),Oe=S.loop;Ae&&T&&m.changeDirection(),Qa(m.params,X);const Xe=m.params.enabled,Ue=m.params.loop;Object.assign(m,{allowTouchMove:m.params.allowTouchMove,allowSlideNext:m.params.allowSlideNext,allowSlidePrev:m.params.allowSlidePrev}),oe&&!Xe?m.disable():!oe&&Xe&&m.enable(),m.currentBreakpoint=V,m.emit("_beforeBreakpoint",X),T&&(be?(m.loopDestroy(),m.loopCreate(g),m.updateSlides()):!Oe&&Ue?(m.loopCreate(g),m.updateSlides()):Oe&&!Ue&&m.loopDestroy()),m.emit("breakpoint",X)}function AK(m,g="window",T){if(!m||g==="container"&&!T)return;let S=!1;const b=ia(),I=g==="window"?b.innerHeight:T.clientHeight,x=Object.keys(m).map(z=>{if(typeof z=="string"&&z.indexOf("@")===0){const P=parseFloat(z.substr(1));return{value:I*P,point:z}}return{value:z,point:z}});x.sort((z,P)=>parseInt(z.value,10)-parseInt(P.value,10));for(let z=0;z<x.length;z+=1){const{point:P,value:V}=x[z];g==="window"?b.matchMedia(`(min-width: ${V}px)`).matches&&(S=P):V<=T.clientWidth&&(S=P)}return S||"max"}var wK={setBreakpoint:bK,getBreakpoint:AK};function IK(m,g){const T=[];return m.forEach(S=>{typeof S=="object"?Object.keys(S).forEach(b=>{S[b]&&T.push(g+b)}):typeof S=="string"&&T.push(g+S)}),T}function OK(){const m=this,{classNames:g,params:T,rtl:S,el:b,device:I}=m,x=IK(["initialized",T.direction,{"free-mode":m.params.freeMode&&T.freeMode.enabled},{autoheight:T.autoHeight},{rtl:S},{grid:T.grid&&T.grid.rows>1},{"grid-column":T.grid&&T.grid.rows>1&&T.grid.fill==="column"},{android:I.android},{ios:I.ios},{"css-mode":T.cssMode},{centered:T.cssMode&&T.centeredSlides},{"watch-progress":T.watchSlidesProgress}],T.containerModifierClass);g.push(...x),b.classList.add(...g),m.emitContainerClasses()}function NK(){const m=this,{el:g,classNames:T}=m;!g||typeof g=="string"||(g.classList.remove(...T),m.emitContainerClasses())}var DK={addClasses:OK,removeClasses:NK};function PK(){const m=this,{isLocked:g,params:T}=m,{slidesOffsetBefore:S}=T;if(S){const b=m.slides.length-1,I=m.slidesGrid[b]+m.slidesSizesGrid[b]+S*2;m.isLocked=m.size>I}else m.isLocked=m.snapGrid.length===1;T.allowSlideNext===!0&&(m.allowSlideNext=!m.isLocked),T.allowSlidePrev===!0&&(m.allowSlidePrev=!m.isLocked),g&&g!==m.isLocked&&(m.isEnd=!1),g!==m.isLocked&&m.emit(m.isLocked?"lock":"unlock")}var LK={checkOverflow:PK},mO={init:!0,direction:"horizontal",oneWayMovement:!1,swiperElementNodeName:"SWIPER-CONTAINER",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,eventsPrefix:"swiper",enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:5,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,loop:!1,loopAddBlankSlides:!0,loopAdditionalSlides:0,loopPreventsSliding:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,maxBackfaceHiddenSlides:10,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-blank",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideFullyVisibleClass:"swiper-slide-fully-visible",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",lazyPreloaderClass:"swiper-lazy-preloader",lazyPreloadPrevNext:0,runCallbacksOnInit:!0,_emitClasses:!1};function kK(m,g){return function(S={}){const b=Object.keys(S)[0],I=S[b];if(typeof I!="object"||I===null){Qa(g,S);return}if(m[b]===!0&&(m[b]={enabled:!0}),b==="navigation"&&m[b]&&m[b].enabled&&!m[b].prevEl&&!m[b].nextEl&&(m[b].auto=!0),["pagination","scrollbar"].indexOf(b)>=0&&m[b]&&m[b].enabled&&!m[b].el&&(m[b].auto=!0),!(b in m&&"enabled"in I)){Qa(g,S);return}typeof m[b]=="object"&&!("enabled"in m[b])&&(m[b].enabled=!0),m[b]||(m[b]={enabled:!1}),Qa(g,S)}}const lO={eventsEmitter:Dz,update:Gz,translate:qz,transition:Qz,slide:sK,loop:dK,grabCursor:pK,events:CK,breakpoints:wK,checkOverflow:LK,classes:DK},dO={};let bO=class gl{constructor(...g){let T,S;g.length===1&&g[0].constructor&&Object.prototype.toString.call(g[0]).slice(8,-1)==="Object"?S=g[0]:[T,S]=g,S||(S={}),S=Qa({},S),T&&!S.el&&(S.el=T);const b=Yh();if(S.el&&typeof S.el=="string"&&b.querySelectorAll(S.el).length>1){const P=[];return b.querySelectorAll(S.el).forEach(V=>{const q=Qa({},S,{el:V});P.push(new gl(q))}),P}const I=this;I.__swiper__=!0,I.support=X3(),I.device=J3({userAgent:S.userAgent}),I.browser=Z3(),I.eventsListeners={},I.eventsAnyListeners=[],I.modules=[...I.__modules__],S.modules&&Array.isArray(S.modules)&&I.modules.push(...S.modules);const x={};I.modules.forEach(P=>{P({params:S,swiper:I,extendParams:kK(S,x),on:I.on.bind(I),once:I.once.bind(I),off:I.off.bind(I),emit:I.emit.bind(I)})});const z=Qa({},mO,x);return I.params=Qa({},z,dO,S),I.originalParams=Qa({},I.params),I.passedParams=Qa({},S),I.params&&I.params.on&&Object.keys(I.params.on).forEach(P=>{I.on(P,I.params.on[P])}),I.params&&I.params.onAny&&I.onAny(I.params.onAny),Object.assign(I,{enabled:I.params.enabled,el:T,classNames:[],slides:[],slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal(){return I.params.direction==="horizontal"},isVertical(){return I.params.direction==="vertical"},activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,cssOverflowAdjustment(){return Math.trunc(this.translate/2**23)*2**23},allowSlideNext:I.params.allowSlideNext,allowSlidePrev:I.params.allowSlidePrev,touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:I.params.focusableElements,lastClickTime:0,clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,startMoving:void 0,pointerId:null,touchId:null},allowClick:!0,allowTouchMove:I.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),I.emit("_swiper"),I.params.init&&I.init(),I}getDirectionLabel(g){return this.isHorizontal()?g:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[g]}getSlideIndex(g){const{slidesEl:T,params:S}=this,b=Sl(T,`.${S.slideClass}, swiper-slide`),I=p3(b[0]);return p3(g)-I}getSlideIndexByData(g){return this.getSlideIndex(this.slides.find(T=>T.getAttribute("data-swiper-slide-index")*1===g))}getSlideIndexWhenGrid(g){return this.grid&&this.params.grid&&this.params.grid.rows>1&&(this.params.grid.fill==="column"?g=Math.floor(g/this.params.grid.rows):this.params.grid.fill==="row"&&(g=g%Math.ceil(this.slides.length/this.params.grid.rows))),g}recalcSlides(){const g=this,{slidesEl:T,params:S}=g;g.slides=Sl(T,`.${S.slideClass}, swiper-slide`)}enable(){const g=this;g.enabled||(g.enabled=!0,g.params.grabCursor&&g.setGrabCursor(),g.emit("enable"))}disable(){const g=this;g.enabled&&(g.enabled=!1,g.params.grabCursor&&g.unsetGrabCursor(),g.emit("disable"))}setProgress(g,T){const S=this;g=Math.min(Math.max(g,0),1);const b=S.minTranslate(),x=(S.maxTranslate()-b)*g+b;S.translateTo(x,typeof T>"u"?0:T),S.updateActiveIndex(),S.updateSlidesClasses()}emitContainerClasses(){const g=this;if(!g.params._emitClasses||!g.el)return;const T=g.el.className.split(" ").filter(S=>S.indexOf("swiper")===0||S.indexOf(g.params.containerModifierClass)===0);g.emit("_containerClasses",T.join(" "))}getSlideClasses(g){const T=this;return T.destroyed?"":g.className.split(" ").filter(S=>S.indexOf("swiper-slide")===0||S.indexOf(T.params.slideClass)===0).join(" ")}emitSlidesClasses(){const g=this;if(!g.params._emitClasses||!g.el)return;const T=[];g.slides.forEach(S=>{const b=g.getSlideClasses(S);T.push({slideEl:S,classNames:b}),g.emit("_slideClass",S,b)}),g.emit("_slideClasses",T)}slidesPerViewDynamic(g="current",T=!1){const S=this,{params:b,slides:I,slidesGrid:x,slidesSizesGrid:z,size:P,activeIndex:V}=S;let q=1;if(typeof b.slidesPerView=="number")return b.slidesPerView;if(b.centeredSlides){let X=I[V]?Math.ceil(I[V].swiperSlideSize):0,se;for(let re=V+1;re<I.length;re+=1)I[re]&&!se&&(X+=Math.ceil(I[re].swiperSlideSize),q+=1,X>P&&(se=!0));for(let re=V-1;re>=0;re-=1)I[re]&&!se&&(X+=I[re].swiperSlideSize,q+=1,X>P&&(se=!0))}else if(g==="current")for(let X=V+1;X<I.length;X+=1)(T?x[X]+z[X]-x[V]<P:x[X]-x[V]<P)&&(q+=1);else for(let X=V-1;X>=0;X-=1)x[V]-x[X]<P&&(q+=1);return q}update(){const g=this;if(!g||g.destroyed)return;const{snapGrid:T,params:S}=g;S.breakpoints&&g.setBreakpoint(),[...g.el.querySelectorAll('[loading="lazy"]')].forEach(x=>{x.complete&&Ny(g,x)}),g.updateSize(),g.updateSlides(),g.updateProgress(),g.updateSlidesClasses();function b(){const x=g.rtlTranslate?g.translate*-1:g.translate,z=Math.min(Math.max(x,g.maxTranslate()),g.minTranslate());g.setTranslate(z),g.updateActiveIndex(),g.updateSlidesClasses()}let I;if(S.freeMode&&S.freeMode.enabled&&!S.cssMode)b(),S.autoHeight&&g.updateAutoHeight();else{if((S.slidesPerView==="auto"||S.slidesPerView>1)&&g.isEnd&&!S.centeredSlides){const x=g.virtual&&S.virtual.enabled?g.virtual.slides:g.slides;I=g.slideTo(x.length-1,0,!1,!0)}else I=g.slideTo(g.activeIndex,0,!1,!0);I||b()}S.watchOverflow&&T!==g.snapGrid&&g.checkOverflow(),g.emit("update")}changeDirection(g,T=!0){const S=this,b=S.params.direction;return g||(g=b==="horizontal"?"vertical":"horizontal"),g===b||g!=="horizontal"&&g!=="vertical"||(S.el.classList.remove(`${S.params.containerModifierClass}${b}`),S.el.classList.add(`${S.params.containerModifierClass}${g}`),S.emitContainerClasses(),S.params.direction=g,S.slides.forEach(I=>{g==="vertical"?I.style.width="":I.style.height=""}),S.emit("changeDirection"),T&&S.update()),S}changeLanguageDirection(g){const T=this;T.rtl&&g==="rtl"||!T.rtl&&g==="ltr"||(T.rtl=g==="rtl",T.rtlTranslate=T.params.direction==="horizontal"&&T.rtl,T.rtl?(T.el.classList.add(`${T.params.containerModifierClass}rtl`),T.el.dir="rtl"):(T.el.classList.remove(`${T.params.containerModifierClass}rtl`),T.el.dir="ltr"),T.update())}mount(g){const T=this;if(T.mounted)return!0;let S=g||T.params.el;if(typeof S=="string"&&(S=document.querySelector(S)),!S)return!1;S.swiper=T,S.parentNode&&S.parentNode.host&&S.parentNode.host.nodeName===T.params.swiperElementNodeName.toUpperCase()&&(T.isElement=!0);const b=()=>`.${(T.params.wrapperClass||"").trim().split(" ").join(".")}`;let x=S&&S.shadowRoot&&S.shadowRoot.querySelector?S.shadowRoot.querySelector(b()):Sl(S,b())[0];return!x&&T.params.createElements&&(x=pO("div",T.params.wrapperClass),S.append(x),Sl(S,`.${T.params.slideClass}`).forEach(z=>{x.append(z)})),Object.assign(T,{el:S,wrapperEl:x,slidesEl:T.isElement&&!S.parentNode.host.slideSlots?S.parentNode.host:x,hostEl:T.isElement?S.parentNode.host:S,mounted:!0,rtl:S.dir.toLowerCase()==="rtl"||Qd(S,"direction")==="rtl",rtlTranslate:T.params.direction==="horizontal"&&(S.dir.toLowerCase()==="rtl"||Qd(S,"direction")==="rtl"),wrongRTL:Qd(x,"display")==="-webkit-box"}),!0}init(g){const T=this;if(T.initialized||T.mount(g)===!1)return T;T.emit("beforeInit"),T.params.breakpoints&&T.setBreakpoint(),T.addClasses(),T.updateSize(),T.updateSlides(),T.params.watchOverflow&&T.checkOverflow(),T.params.grabCursor&&T.enabled&&T.setGrabCursor(),T.params.loop&&T.virtual&&T.params.virtual.enabled?T.slideTo(T.params.initialSlide+T.virtual.slidesBefore,0,T.params.runCallbacksOnInit,!1,!0):T.slideTo(T.params.initialSlide,0,T.params.runCallbacksOnInit,!1,!0),T.params.loop&&T.loopCreate(void 0,!0),T.attachEvents();const b=[...T.el.querySelectorAll('[loading="lazy"]')];return T.isElement&&b.push(...T.hostEl.querySelectorAll('[loading="lazy"]')),b.forEach(I=>{I.complete?Ny(T,I):I.addEventListener("load",x=>{Ny(T,x.target)})}),fO(T),T.initialized=!0,fO(T),T.emit("init"),T.emit("afterInit"),T}destroy(g=!0,T=!0){const S=this,{params:b,el:I,wrapperEl:x,slides:z}=S;return typeof S.params>"u"||S.destroyed||(S.emit("beforeDestroy"),S.initialized=!1,S.detachEvents(),b.loop&&S.loopDestroy(),T&&(S.removeClasses(),I&&typeof I!="string"&&I.removeAttribute("style"),x&&x.removeAttribute("style"),z&&z.length&&z.forEach(P=>{P.classList.remove(b.slideVisibleClass,b.slideFullyVisibleClass,b.slideActiveClass,b.slideNextClass,b.slidePrevClass),P.removeAttribute("style"),P.removeAttribute("data-swiper-slide-index")})),S.emit("destroy"),Object.keys(S.eventsListeners).forEach(P=>{S.off(P)}),g!==!1&&(S.el&&typeof S.el!="string"&&(S.el.swiper=null),Ez(S)),S.destroyed=!0),null}static extendDefaults(g){Qa(dO,g)}static get extendedDefaults(){return dO}static get defaults(){return mO}static installModule(g){gl.prototype.__modules__||(gl.prototype.__modules__=[]);const T=gl.prototype.__modules__;typeof g=="function"&&T.indexOf(g)<0&&T.push(g)}static use(g){return Array.isArray(g)?(g.forEach(T=>gl.installModule(T)),gl):(gl.installModule(g),gl)}};Object.keys(lO).forEach(m=>{Object.keys(lO[m]).forEach(g=>{bO.prototype[g]=lO[m][g]})});bO.use([Oz,Nz]);const e5=["eventsPrefix","injectStyles","injectStylesUrls","modules","init","_direction","oneWayMovement","swiperElementNodeName","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","breakpointsBase","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_loop","loopAdditionalSlides","loopAddBlankSlides","loopPreventsSliding","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideActiveClass","slideVisibleClass","slideFullyVisibleClass","slideNextClass","slidePrevClass","slideBlankClass","wrapperClass","lazyPreloaderClass","lazyPreloadPrevNext","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom","control"];function Kh(m){return typeof m=="object"&&m!==null&&m.constructor&&Object.prototype.toString.call(m).slice(8,-1)==="Object"&&!m.__swiper__}function Mm(m,g){const T=["__proto__","constructor","prototype"];Object.keys(g).filter(S=>T.indexOf(S)<0).forEach(S=>{typeof m[S]>"u"?m[S]=g[S]:Kh(g[S])&&Kh(m[S])&&Object.keys(g[S]).length>0?g[S].__swiper__?m[S]=g[S]:Mm(m[S],g[S]):m[S]=g[S]})}function t5(m={}){return m.navigation&&typeof m.navigation.nextEl>"u"&&typeof m.navigation.prevEl>"u"}function i5(m={}){return m.pagination&&typeof m.pagination.el>"u"}function r5(m={}){return m.scrollbar&&typeof m.scrollbar.el>"u"}function n5(m=""){const g=m.split(" ").map(S=>S.trim()).filter(S=>!!S),T=[];return g.forEach(S=>{T.indexOf(S)<0&&T.push(S)}),T.join(" ")}function MK(m=""){return m?m.includes("swiper-wrapper")?m:`swiper-wrapper ${m}`:"swiper-wrapper"}function xK({swiper:m,slides:g,passedParams:T,changedParams:S,nextEl:b,prevEl:I,scrollbarEl:x,paginationEl:z}){const P=S.filter(Ge=>Ge!=="children"&&Ge!=="direction"&&Ge!=="wrapperClass"),{params:V,pagination:q,navigation:X,scrollbar:se,virtual:re,thumbs:ue}=m;let ae,oe,Ae,be,Oe,Xe,Ue,gt;S.includes("thumbs")&&T.thumbs&&T.thumbs.swiper&&!T.thumbs.swiper.destroyed&&V.thumbs&&(!V.thumbs.swiper||V.thumbs.swiper.destroyed)&&(ae=!0),S.includes("controller")&&T.controller&&T.controller.control&&V.controller&&!V.controller.control&&(oe=!0),S.includes("pagination")&&T.pagination&&(T.pagination.el||z)&&(V.pagination||V.pagination===!1)&&q&&!q.el&&(Ae=!0),S.includes("scrollbar")&&T.scrollbar&&(T.scrollbar.el||x)&&(V.scrollbar||V.scrollbar===!1)&&se&&!se.el&&(be=!0),S.includes("navigation")&&T.navigation&&(T.navigation.prevEl||I)&&(T.navigation.nextEl||b)&&(V.navigation||V.navigation===!1)&&X&&!X.prevEl&&!X.nextEl&&(Oe=!0);const it=Ge=>{m[Ge]&&(m[Ge].destroy(),Ge==="navigation"?(m.isElement&&(m[Ge].prevEl.remove(),m[Ge].nextEl.remove()),V[Ge].prevEl=void 0,V[Ge].nextEl=void 0,m[Ge].prevEl=void 0,m[Ge].nextEl=void 0):(m.isElement&&m[Ge].el.remove(),V[Ge].el=void 0,m[Ge].el=void 0))};S.includes("loop")&&m.isElement&&(V.loop&&!T.loop?Xe=!0:!V.loop&&T.loop?Ue=!0:gt=!0),P.forEach(Ge=>{if(Kh(V[Ge])&&Kh(T[Ge]))Object.assign(V[Ge],T[Ge]),(Ge==="navigation"||Ge==="pagination"||Ge==="scrollbar")&&"enabled"in T[Ge]&&!T[Ge].enabled&&it(Ge);else{const kt=T[Ge];(kt===!0||kt===!1)&&(Ge==="navigation"||Ge==="pagination"||Ge==="scrollbar")?kt===!1&&it(Ge):V[Ge]=T[Ge]}}),P.includes("controller")&&!oe&&m.controller&&m.controller.control&&V.controller&&V.controller.control&&(m.controller.control=V.controller.control),S.includes("children")&&g&&re&&V.virtual.enabled?(re.slides=g,re.update(!0)):S.includes("virtual")&&re&&V.virtual.enabled&&(g&&(re.slides=g),re.update(!0)),S.includes("children")&&g&&V.loop&&(gt=!0),ae&&ue.init()&&ue.update(!0),oe&&(m.controller.control=V.controller.control),Ae&&(m.isElement&&(!z||typeof z=="string")&&(z=document.createElement("div"),z.classList.add("swiper-pagination"),z.part.add("pagination"),m.el.appendChild(z)),z&&(V.pagination.el=z),q.init(),q.render(),q.update()),be&&(m.isElement&&(!x||typeof x=="string")&&(x=document.createElement("div"),x.classList.add("swiper-scrollbar"),x.part.add("scrollbar"),m.el.appendChild(x)),x&&(V.scrollbar.el=x),se.init(),se.updateSize(),se.setTranslate()),Oe&&(m.isElement&&((!b||typeof b=="string")&&(b=document.createElement("div"),b.classList.add("swiper-button-next"),m3(b,m.navigation.arrowSvg),b.part.add("button-next"),m.el.appendChild(b)),(!I||typeof I=="string")&&(I=document.createElement("div"),I.classList.add("swiper-button-prev"),m3(I,m.navigation.arrowSvg),I.part.add("button-prev"),m.el.appendChild(I))),b&&(V.navigation.nextEl=b),I&&(V.navigation.prevEl=I),X.init(),X.update()),S.includes("allowSlideNext")&&(m.allowSlideNext=T.allowSlideNext),S.includes("allowSlidePrev")&&(m.allowSlidePrev=T.allowSlidePrev),S.includes("direction")&&m.changeDirection(T.direction,!1),(Xe||gt)&&m.loopDestroy(),(Ue||gt)&&m.loopCreate(),m.update()}function UK(m={},g=!0){const T={on:{}},S={},b={};Mm(T,mO),T._emitClasses=!0,T.init=!1;const I={},x=e5.map(P=>P.replace(/_/,"")),z=Object.assign({},m);return Object.keys(z).forEach(P=>{typeof m[P]>"u"||(x.indexOf(P)>=0?Kh(m[P])?(T[P]={},b[P]={},Mm(T[P],m[P]),Mm(b[P],m[P])):(T[P]=m[P],b[P]=m[P]):P.search(/on[A-Z]/)===0&&typeof m[P]=="function"?g?S[`${P[2].toLowerCase()}${P.substr(3)}`]=m[P]:T.on[`${P[2].toLowerCase()}${P.substr(3)}`]=m[P]:I[P]=m[P])}),["navigation","pagination","scrollbar"].forEach(P=>{T[P]===!0&&(T[P]={}),T[P]===!1&&delete T[P]}),{params:T,passedParams:b,rest:I,events:S}}function VK({el:m,nextEl:g,prevEl:T,paginationEl:S,scrollbarEl:b,swiper:I},x){t5(x)&&g&&T&&(I.params.navigation.nextEl=g,I.originalParams.navigation.nextEl=g,I.params.navigation.prevEl=T,I.originalParams.navigation.prevEl=T),i5(x)&&S&&(I.params.pagination.el=S,I.originalParams.pagination.el=S),r5(x)&&b&&(I.params.scrollbar.el=b,I.originalParams.scrollbar.el=b),I.init(m)}function BK(m,g,T,S,b){const I=[];if(!g)return I;const x=P=>{I.indexOf(P)<0&&I.push(P)};if(T&&S){const P=S.map(b),V=T.map(b);P.join("")!==V.join("")&&x("children"),S.length!==T.length&&x("children")}return e5.filter(P=>P[0]==="_").map(P=>P.replace(/_/,"")).forEach(P=>{if(P in m&&P in g)if(Kh(m[P])&&Kh(g[P])){const V=Object.keys(m[P]),q=Object.keys(g[P]);V.length!==q.length?x(P):(V.forEach(X=>{m[P][X]!==g[P][X]&&x(P)}),q.forEach(X=>{m[P][X]!==g[P][X]&&x(P)}))}else m[P]!==g[P]&&x(P)}),I}const jK=m=>{!m||m.destroyed||!m.params.virtual||m.params.virtual&&!m.params.virtual.enabled||(m.updateSlides(),m.updateProgress(),m.updateSlidesClasses(),m.emit("_virtualUpdated"),m.parallax&&m.params.parallax&&m.params.parallax.enabled&&m.parallax.setTranslate())};function My(){return My=Object.assign?Object.assign.bind():function(m){for(var g=1;g<arguments.length;g++){var T=arguments[g];for(var S in T)Object.prototype.hasOwnProperty.call(T,S)&&(m[S]=T[S])}return m},My.apply(this,arguments)}function a5(m){return m.type&&m.type.displayName&&m.type.displayName.includes("SwiperSlide")}function s5(m){const g=[];return rn.Children.toArray(m).forEach(T=>{a5(T)?g.push(T):T.props&&T.props.children&&s5(T.props.children).forEach(S=>g.push(S))}),g}function FK(m){const g=[],T={"container-start":[],"container-end":[],"wrapper-start":[],"wrapper-end":[]};return rn.Children.toArray(m).forEach(S=>{if(a5(S))g.push(S);else if(S.props&&S.props.slot&&T[S.props.slot])T[S.props.slot].push(S);else if(S.props&&S.props.children){const b=s5(S.props.children);b.length>0?b.forEach(I=>g.push(I)):T["container-end"].push(S)}else T["container-end"].push(S)}),{slides:g,slots:T}}function GK(m,g,T){if(!T)return null;const S=q=>{let X=q;return q<0?X=g.length+q:X>=g.length&&(X=X-g.length),X},b=m.isHorizontal()?{[m.rtlTranslate?"right":"left"]:`${T.offset}px`}:{top:`${T.offset}px`},{from:I,to:x}=T,z=m.params.loop?-g.length:0,P=m.params.loop?g.length*2:g.length,V=[];for(let q=z;q<P;q+=1)q>=I&&q<=x&&V.push(g[S(q)]);return V.map((q,X)=>rn.cloneElement(q,{swiper:m,style:b,key:q.props.virtualIndex||q.key||`slide-${X}`}))}function SS(m,g){return typeof window>"u"?te.useEffect(m,g):te.useLayoutEffect(m,g)}const T3=te.createContext(null),HK=te.createContext(null),AO=te.forwardRef(({className:m,tag:g="div",wrapperTag:T="div",children:S,onSwiper:b,...I}={},x)=>{let z=!1;const[P,V]=te.useState("swiper"),[q,X]=te.useState(null),[se,re]=te.useState(!1),ue=te.useRef(!1),ae=te.useRef(null),oe=te.useRef(null),Ae=te.useRef(null),be=te.useRef(null),Oe=te.useRef(null),Xe=te.useRef(null),Ue=te.useRef(null),gt=te.useRef(null),{params:it,passedParams:Ge,rest:kt,events:rt}=UK(I),{slides:Ze,slots:Qe}=FK(S),Di=()=>{re(!se)};Object.assign(it.on,{_containerClasses(He,St){V(St)}});const ii=()=>{Object.assign(it.on,rt),z=!0;const He={...it};if(delete He.wrapperClass,oe.current=new bO(He),oe.current.virtual&&oe.current.params.virtual.enabled){oe.current.virtual.slides=Ze;const St={cache:!1,slides:Ze,renderExternal:X,renderExternalUpdate:!1};Mm(oe.current.params.virtual,St),Mm(oe.current.originalParams.virtual,St)}};ae.current||ii(),oe.current&&oe.current.on("_beforeBreakpoint",Di);const Pi=()=>{z||!rt||!oe.current||Object.keys(rt).forEach(He=>{oe.current.on(He,rt[He])})},Ne=()=>{!rt||!oe.current||Object.keys(rt).forEach(He=>{oe.current.off(He,rt[He])})};te.useEffect(()=>()=>{oe.current&&oe.current.off("_beforeBreakpoint",Di)}),te.useEffect(()=>{!ue.current&&oe.current&&(oe.current.emitSlidesClasses(),ue.current=!0)}),SS(()=>{if(x&&(x.current=ae.current),!!ae.current)return oe.current.destroyed&&ii(),VK({el:ae.current,nextEl:Oe.current,prevEl:Xe.current,paginationEl:Ue.current,scrollbarEl:gt.current,swiper:oe.current},it),b&&!oe.current.destroyed&&b(oe.current),()=>{oe.current&&!oe.current.destroyed&&oe.current.destroy(!0,!1)}},[]),SS(()=>{Pi();const He=BK(Ge,Ae.current,Ze,be.current,St=>St.key);return Ae.current=Ge,be.current=Ze,He.length&&oe.current&&!oe.current.destroyed&&xK({swiper:oe.current,slides:Ze,passedParams:Ge,changedParams:He,nextEl:Oe.current,prevEl:Xe.current,scrollbarEl:gt.current,paginationEl:Ue.current}),()=>{Ne()}}),SS(()=>{jK(oe.current)},[q]);function We(){return it.virtual?GK(oe.current,Ze,q):Ze.map((He,St)=>rn.cloneElement(He,{swiper:oe.current,swiperSlideIndex:St}))}return rn.createElement(g,My({ref:ae,className:n5(`${P}${m?` ${m}`:""}`)},kt),rn.createElement(HK.Provider,{value:oe.current},Qe["container-start"],rn.createElement(T,{className:MK(it.wrapperClass)},Qe["wrapper-start"],We(),Qe["wrapper-end"]),t5(it)&&rn.createElement(rn.Fragment,null,rn.createElement("div",{ref:Xe,className:"swiper-button-prev"}),rn.createElement("div",{ref:Oe,className:"swiper-button-next"})),r5(it)&&rn.createElement("div",{ref:gt,className:"swiper-scrollbar"}),i5(it)&&rn.createElement("div",{ref:Ue,className:"swiper-pagination"}),Qe["container-end"]))});AO.displayName="Swiper";const wO=te.forwardRef(({tag:m="div",children:g,className:T="",swiper:S,zoom:b,lazy:I,virtualIndex:x,swiperSlideIndex:z,...P}={},V)=>{const q=te.useRef(null),[X,se]=te.useState("swiper-slide"),[re,ue]=te.useState(!1);function ae(Oe,Xe,Ue){Xe===q.current&&se(Ue)}SS(()=>{if(typeof z<"u"&&(q.current.swiperSlideIndex=z),V&&(V.current=q.current),!(!q.current||!S)){if(S.destroyed){X!=="swiper-slide"&&se("swiper-slide");return}return S.on("_slideClass",ae),()=>{S&&S.off("_slideClass",ae)}}}),SS(()=>{S&&q.current&&!S.destroyed&&se(S.getSlideClasses(q.current))},[S]);const oe={isActive:X.indexOf("swiper-slide-active")>=0,isVisible:X.indexOf("swiper-slide-visible")>=0,isPrev:X.indexOf("swiper-slide-prev")>=0,isNext:X.indexOf("swiper-slide-next")>=0},Ae=()=>typeof g=="function"?g(oe):g,be=()=>{ue(!0)};return rn.createElement(m,My({ref:q,className:n5(`${X}${T?` ${T}`:""}`),"data-swiper-slide-index":x,onLoad:be},P),b&&rn.createElement(T3.Provider,{value:oe},rn.createElement("div",{className:"swiper-zoom-container","data-swiper-zoom":typeof b=="number"?b:void 0},Ae(),I&&!re&&rn.createElement("div",{className:"swiper-lazy-preloader"}))),!b&&rn.createElement(T3.Provider,{value:oe},Ae(),I&&!re&&rn.createElement("div",{className:"swiper-lazy-preloader"})))});wO.displayName="SwiperSlide";const v3="/assets/1-BFCyOoiD.png",R3="/assets/2-fFq1KYAn.png",WK="/assets/3-BKc4Os9d.png",zK="/assets/4-DSnohge-.png",KK="/assets/5-ClTK3tpc.png",_O="/assets/6-mjfRKAkB.png";function o5(){const m=[{img:v3,name:"",link:"/"},{img:R3,name:"",link:"/"},{img:WK,name:"",link:"/"},{img:zK,name:"",link:"/"},{img:KK,name:"",link:"/"},{img:_O,name:"",link:"/"},{img:v3,name:"",link:"/"},{img:R3,name:"",link:"/"}];return J.jsxs("div",{className:"popular-category flex flex-col gap-[9px] w-full px-[6px] mb-[33px]",children:[J.jsxs("div",{className:"flex justify-between items-end pl-[9px] pr-[13px]",children:[J.jsx("p",{className:"text-[11px] leading-[13px]",children:""}),J.jsx(pn,{to:"/",className:"text-[9px] leading-[11px]",children:" "})]}),J.jsx("div",{className:"w-full",children:J.jsx(AO,{spaceBetween:4,slidesPerView:5,children:m?.map((g,T)=>J.jsx(wO,{children:J.jsxs(pn,{to:g?.link,className:"flex flex-col items-center gap-[5px]",children:[J.jsx("img",{src:g?.img,alt:"category",className:"w-full aspect-square object-cover"}),J.jsx("p",{className:"text-[8px] leading-[10px] text-dark-200 text-center",children:g?.name})]})},T))})})]})}const y3="/assets/7-BrK51Gg9.png",C3="/assets/8-lEJiffLe.png",b3="/assets/9-DXAMUFJx.png";function c5(){const m=CS(),g=[{img:_O,money:"22,000",link:"/"},{img:y3,money:"16,000",link:"/"},{img:C3,money:"800",link:"/"},{img:b3,money:"1,400",link:"/"},{img:_O,money:"22,000",link:"/"},{img:y3,money:"16,000",link:"/"},{img:C3,money:"800",link:"/"},{img:b3,money:"1,400",link:"/"}],T=()=>{m("/")};return J.jsxs("div",{className:"recent-product flex flex-col gap-[11px] w-full px-[6px] mb-[38px]",children:[J.jsxs("div",{className:"flex justify-between items-center pl-[9px] pr-[13px]",children:[J.jsx("p",{className:"text-[11px] leading-[13px]",children:""}),J.jsx("button",{onClick:T,className:"text-[9px] leading-[11px]",children:""})]}),J.jsx("div",{className:"w-full",children:J.jsx(AO,{spaceBetween:4,slidesPerView:4,children:g?.map((S,b)=>J.jsx(wO,{children:J.jsxs(pn,{to:S?.link,className:"relative",children:[J.jsx("img",{src:S?.img,alt:"product",className:"relative z-0 w-full aspect-square"}),J.jsx("div",{className:"absolute bottom-[6px] right-0 flex justify-end min-w-[49px] px-2 bg-white bg-opacity-70",children:J.jsxs("p",{className:"text-[8px] leading-[10px]",children:["",S?.money]})})]})},b))})})]})}function l5({data:m,showShop:g}){return J.jsxs(pn,{to:m?.link,className:"flex flex-col gap-[2px]",children:[J.jsx("img",{src:m?.imgProduct,alt:"product",className:"w-full aspect-square"}),J.jsxs("div",{className:"grid grid-cols-[115fr_70fr] gap-1",children:[J.jsxs("div",{className:"flex flex-col gap-[3px]",children:[J.jsx("p",{className:"text-[7px] leading-[8px] line-clamp-1",children:m?.nameProduct}),J.jsxs("div",{className:"flex items-center gap-[23px] text-[6px] leading-[7px]",children:[J.jsx("p",{children:""}),J.jsxs("p",{className:"text-red-100",children:["",m?.money]})]})]}),g&&J.jsxs("div",{className:"flex justify-end items-end gap-[6px]",children:[J.jsx("p",{className:"text-[6px] leading-[7px] truncate",children:m?.nameShop}),J.jsx("img",{src:m?.imgShop,alt:"shop",className:"w-[25px] h-[25px]"})]})]})]})}const IO="/assets/10-Bu0QSj4Q.png",OO="/assets/11-CrZN0ZSK.png",d5="/assets/12-aZ79SwQE.png",u5="/assets/13-DtbFduuM.png",h5="/assets/14-Dz3LKLil.png",p5="/assets/15-Bs5k0Xxh.png",f5="/assets/16-Bi4EWHu3.png",m5="/assets/17-BQiAjjvv.png",_5="/assets/18-FR4-8j_K.png",E5="/assets/19-Ncg14wek.png",g5="/assets/20-BQGf3PzE.png",S5="/assets/21-BjrjJ5qa.png";function T5(){const m=[{imgProduct:IO,money:"1,200",nameProduct:"balenciaga ",imgShop:f5,nameShop:"simgffj",link:"/a"},{imgProduct:OO,money:"9,500",nameProduct:"Noir kei ninomiya ",imgShop:m5,nameShop:"ponta",link:"/a"},{imgProduct:d5,money:"6,000",nameProduct:"DRIES VAN NOTEN ",imgShop:_5,nameShop:"",link:"/a"},{imgProduct:u5,money:"2,000",nameProduct:"W&LT / Psychedelic Knit Vest",imgShop:E5,nameShop:"meangirls",link:"/a"},{imgProduct:h5,money:"9,200",nameProduct:" ",imgShop:g5,nameShop:"ReviResonia",link:"/a"},{imgProduct:p5,money:"38,000",nameProduct:"Archive Denim Half Coat",imgShop:S5,nameShop:"ichigo",link:"/a"}];return J.jsxs("div",{className:"recommend-product flex flex-col gap-[15px] w-full px-4",children:[J.jsx("p",{className:"text-[11px] leading-[13px]",children:""}),J.jsx("div",{className:"grid grid-cols-2 gap-x-[2px] gap-y-[11px] w-full",children:m?.map((g,T)=>J.jsx(l5,{data:g,showShop:!0},T))})]})}const Dy="data:image/svg+xml,%3csvg%20width='9'%20height='7'%20viewBox='0%200%209%207'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0.382812%200.318359L4.45279%205.2583L8.5228%200.318359'%20stroke='%23DCDCDC'%20stroke-miterlimit='10'/%3e%3c/svg%3e";function qh({showMore:m}){const g=[{label:"FutureVintage",link:"/"},{label:"",link:"/"},{label:"",link:"/"}];return J.jsxs("div",{className:"privacy-terms flex flex-col items-center w-full mt-auto",children:[J.jsxs("div",{className:"flex flex-col gap-6 w-full max-w-[768px] pb-[13px] px-4",children:[J.jsxs("div",{className:"flex flex-col gap-[23px]",children:[m&&J.jsxs(J.Fragment,{children:[J.jsxs("button",{className:"flex justify-between items-center pr-[34px] cursor-pointer",children:[J.jsx("p",{className:"text-[11px] leading-[13px]",children:"FutureVintage"}),J.jsx("img",{src:Dy,alt:"arrow",className:"w-2 h-[5px]"})]}),J.jsxs("button",{className:"flex justify-between items-center pr-[34px] cursor-pointer",children:[J.jsx("p",{className:"text-[11px] leading-[13px]",children:""}),J.jsx("img",{src:Dy,alt:"arrow",className:"w-2 h-[5px]"})]})]}),J.jsxs("div",{className:"group",children:[J.jsxs("label",{className:"flex justify-between items-center pb-4 pr-[34px] border-b border-dark-200 cursor-pointer",children:[J.jsx("p",{className:"text-[11px] leading-[13px]",children:""}),J.jsx("img",{src:Dy,alt:"arrow",className:"w-2 h-[5px] transition-transform duration-300 group-has-[input:checked]:[transform:rotateX(180deg)]"}),J.jsx("input",{type:"checkbox",className:"hidden"})]}),J.jsx("div",{className:"w-full max-h-0 overflow-hidden transition-[max-height] duration-300 group-has-[input:checked]:max-h-[170px]",children:J.jsx("div",{className:"flex flex-col gap-[29px] w-full pt-[21px] pb-[25px]",children:g?.map((T,S)=>J.jsx(pn,{to:T?.link,className:"text-[11px] leading-[13px]",children:T?.label},S))})})]})]}),J.jsx("p",{className:"text-[8px] leading-[10px]",children:"@Creative & Planning by New Company.2026"})]}),J.jsx("div",{className:"flex justify-center w-full h-[45px] pt-4 bg-dark-300",children:J.jsx("img",{src:z3,alt:"logo",className:"w-full max-w-[121px] aspect-[121/18]"})})]})}function YK(){return J.jsxs("div",{className:"top-no-login flex flex-col items-center w-full h-max min-h-full",children:[J.jsx(Sc,{isTopPage:!0}),J.jsxs("div",{className:"w-full max-w-[768px] pt-[18px] pb-[58px]",children:[J.jsx(o5,{}),J.jsx(c5,{}),J.jsx(T5,{})]}),J.jsx(qh,{})]})}function qK(){return J.jsxs("div",{className:"liked-product flex flex-col gap-[14px] px-[6px] mb-[17px]",children:[J.jsx("div",{className:"w-full pl-[9px] pr-[9px]",children:J.jsxs("div",{className:"flex justify-between items-end pb-[7px] pl-[18px] pr-[15px] border-b border-neutral-300",children:[J.jsx("p",{className:"text-[12px] leading-[15px]",children:""}),J.jsx(pn,{to:"/",className:"text-[9px] leading-[11px]",children:" "})]})}),J.jsx("div",{className:"flex justify-center items-center py-[72px] bg-dark-300",children:J.jsx("p",{className:"text-[12px] leading-[15px]",children:""})})]})}function XK(){return J.jsxs("div",{className:"top-login flex flex-col items-center w-full h-max min-h-full",children:[J.jsx(Sc,{isTopPage:!0,isAuth:!0}),J.jsxs("div",{className:"w-full max-w-[768px] pt-[18px] pb-[58px]",children:[J.jsx(qK,{}),J.jsx(o5,{}),J.jsx(c5,{}),J.jsx(T5,{})]}),J.jsx(qh,{})]})}const JK="data:image/svg+xml,%3csvg%20width='9'%20height='9'%20viewBox='0%200%209%209'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8.07001%200.25H0.25V8.06995H8.07001V0.25Z'%20stroke='%23DBDBDB'%20stroke-width='0.5'%20stroke-miterlimit='10'/%3e%3c/svg%3e",ZK="data:image/svg+xml,%3csvg%20width='11'%20height='11'%20viewBox='0%200%2011%2011'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M3.28%209.11714C3.28%209.11714%203.30001%209.09715%203.32001%209.07715L7.17001%205.22714L7.20999%205.18715C7.20999%205.18715%207.23%205.16714%207.25%205.14714L9.29001%203.10715L7.01001%200.827148L4.97%202.86714L4.92999%202.90715C4.92999%202.90715%204.91001%202.92714%204.89001%202.94714L1%206.83714L0%2010.1171L3.23001%209.13715L3.28%209.12715V9.11714ZM0.730011%209.38715L1.23001%207.74715L2.37%208.88715L0.730011%209.38715Z'%20fill='%23DBDBDB'/%3e%3cpath%20d='M9.94156%202.0575C10.1916%201.8075%2010.1916%201.3875%209.94156%201.1375L8.99155%200.1875C8.74155%20-0.0625%208.32156%20-0.0625%208.07156%200.1875L7.60156%200.657501L9.47156%202.5275L9.94156%202.0575Z'%20fill='%232B2B2B'/%3e%3c/svg%3e",QK="data:image/svg+xml,%3csvg%20width='11'%20height='14'%20viewBox='0%200%2011%2014'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0.742188%2012.6204C0.782188%2013.3504%201.41218%2013.9403%202.14218%2013.9403H8.08218C8.81218%2013.9403%209.44221%2013.3404%209.48221%2012.6204L9.96219%204.28027H0.242188L0.722198%2012.6204H0.742188Z'%20fill='%23A5A5A5'/%3e%3cpath%20d='M9.98001%202.19995C9.83001%202.13995%208.54001%201.66999%206.60001%201.48999C6.60001%201.48999%206.60001%201.46996%206.60001%201.45996C6.60001%200.649961%205.94998%200%205.13998%200C4.32998%200%203.67999%200.649961%203.67999%201.45996C3.67999%201.45996%203.67999%201.47999%203.67999%201.48999C1.73999%201.66999%200.449988%202.13995%200.299988%202.19995C0.0399878%202.30995%200%202.45993%200%202.67993V3.63989H10.27V2.67993C10.27%202.45993%2010.23%202.30995%209.97%202.19995H9.98001ZM5.13998%201.41992C4.91998%201.41992%204.71001%201.41993%204.51001%201.42993C4.53001%201.08993%204.79998%200.829956%205.13998%200.829956C5.47998%200.829956%205.74999%201.09993%205.76999%201.42993C5.55999%201.42993%205.35998%201.41992%205.13998%201.41992Z'%20fill='%23A5A5A5'/%3e%3c/svg%3e";function $K(){const[m,g]=te.useState(!1),T=[{img:IO,name:"balenciaga ",money:"1,200"},{img:OO,name:"Noir kei ninomiya ",money:"9,500"}],S=()=>{g(!m)};return J.jsxs("div",{className:"like-list flex flex-col items-center w-full h-max min-h-full",children:[J.jsx(Sc,{title:""}),J.jsxs("div",{className:"flex flex-col gap-[17px] w-full max-w-[768px] pt-7 pb-[58px] px-4",children:[J.jsxs("div",{className:"flex justify-between items-center pl-[13px] pr-1 text-[10px] leading-[12px]",children:[J.jsxs("label",{className:"flex items-center gap-[9px] cursor-pointer",children:[J.jsx("img",{src:JK,alt:"checkbox",className:"w-2 h-2"}),J.jsx("p",{children:""})]}),J.jsxs("button",{onClick:S,className:"flex items-center gap-3",children:[J.jsx("p",{children:m?"":""}),!m&&J.jsx("img",{src:ZK,alt:"edit",className:"w-[10px] h-[10px]"})]})]}),J.jsxs("div",{className:"flex flex-col gap-[10px]",children:[J.jsx("div",{className:"pb-[5px] pl-[13px] border-b border-neutral-300",children:J.jsx("p",{className:"text-[12px] leading-[15px]",children:""})}),J.jsx("div",{className:"flex flex-col gap-[10px]",children:T?.map((b,I)=>J.jsxs("div",{className:"grid grid-cols-[84fr_241fr] gap-[18px] items-center pb-[7px] pl-[6px] pr-[7px] border-b border-neutral-300",children:[J.jsx("img",{src:b?.img,alt:"product",className:"aspect-square"}),J.jsxs("div",{className:"flex flex-col gap-[17px]",children:[J.jsx("p",{className:"text-[13px] leading-[16px]",children:b?.name}),J.jsxs("div",{className:"flex justify-between items-center gap-1",children:[J.jsxs("div",{className:"flex items-center gap-[27px] text-[10px] leading-[12px]",children:[J.jsx("p",{children:""}),J.jsxs("p",{children:["",b?.money]})]}),J.jsx("button",{className:!m&&"invisible",children:J.jsx("img",{src:QK,alt:"trash",className:"w-[10px] h-[14px]"})})]})]})]},"index"))})]})]}),J.jsx(qh,{})]})}const eY="data:image/svg+xml,%3csvg%20width='11'%20height='11'%20viewBox='0%200%2011%2011'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9.20372%2010.4453L-0.00133512%201.24024L1.23906%20-0.000159318L10.4441%209.2049L9.20372%2010.4453ZM1.23906%2010.4453L-0.00133512%209.2049L9.20372%20-0.000159318L10.4441%201.24024L1.23906%2010.4453Z'%20fill='%23DBDBDB'/%3e%3c/svg%3e",xy="data:image/svg+xml,%3csvg%20width='7'%20height='9'%20viewBox='0%200%207%209'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0.320312%208.52576L5.26031%204.45569L0.320312%200.385742'%20stroke='%23DBDBDB'%20stroke-miterlimit='10'/%3e%3c/svg%3e",A3="data:image/svg+xml,%3csvg%20width='12'%20height='12'%20viewBox='0%200%2012%2012'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M11.1507%2011.6407L6.71067%207.20066C6.35067%207.50067%205.93068%207.74067%205.48068%207.89067C5.04068%208.05067%204.57068%208.14067%204.09068%208.14067C3.00068%208.16067%201.95068%207.74066%201.18068%206.96066C0.400676%206.20066%20-0.0193172%205.16066%200.000682771%204.07066C-0.0193172%201.84066%201.77068%200.0206679%204.00068%200.000667889C4.02068%200.000667889%204.05067%200.000667889%204.07067%200.000667889C5.16067%20-0.0193321%206.21068%200.410661%206.97068%201.18066C7.75068%201.94066%208.18069%202.98066%208.16069%204.07066C8.16069%204.56066%208.07068%205.05066%207.89068%205.51066C7.73068%205.94066%207.50068%206.34066%207.20068%206.68066L11.6607%2011.1407L11.1407%2011.6407H11.1507ZM4.09068%207.43066C5.93068%207.45066%207.43068%205.98067%207.45068%204.14067C7.45068%204.12067%207.45068%204.09066%207.45068%204.07066C7.47068%202.23066%206.00069%200.730659%204.16069%200.710659C4.14069%200.710659%204.11068%200.710659%204.09068%200.710659C3.19068%200.690659%202.32069%201.04066%201.69069%201.68066C1.05069%202.31066%200.690674%203.17066%200.710674%204.07066C0.690674%204.97066%201.04069%205.83066%201.69069%206.46066C2.32069%207.10066%203.19068%207.45066%204.09068%207.43066Z'%20fill='%23DBDBDB'/%3e%3c/svg%3e";function tY(){const[m,g]=te.useState(""),T=[{title:"",link:"/"},{title:"T",link:"/"},{title:"",link:"/"},{title:"",subTitle:"",link:"/"},{title:"",link:"/"},{title:"",link:"/"},{title:"",link:"/"},{title:"",link:"/"},{title:"",link:"/"}],S=()=>{g("")},b=I=>{g(I.target.value)};return J.jsxs("div",{className:"search-top flex flex-col items-center w-full h-max min-h-full",children:[J.jsx(Sc,{title:""}),J.jsxs("div",{className:"flex flex-col gap-[17px] w-full max-w-[768px] pt-[14px] pb-[58px] px-4",children:[J.jsxs("div",{className:"flex items-center gap-3",children:[J.jsx("button",{onClick:S,className:"w-[11px] h-[11px]",children:J.jsx("img",{src:eY,alt:"remove",className:"w-full h-full"})}),J.jsxs("div",{className:`flex items-center gap-[5px] grow h-8 px-[13px] border ${m?.length>0?"border-dark-200":"bg-neutral-800 border-neutral-800"}`,children:[J.jsx("img",{src:A3,alt:"search",className:"w-3 h-3"}),J.jsx("input",{className:"grow text-[12px] leading-[15px] text-neutral-600 bg-transparent outline-none placeholder:text-neutral-600",placeholder:"",value:m,onChange:b})]})]}),m?.length>0?J.jsx("div",{children:T?.map((I,x)=>J.jsxs(pn,{to:I?.link,className:`flex justify-between items-center gap-1 h-[46px] pl-[11px] pr-[13px] border-b border-neutral-300 ${x===0?"border-t":""}`,children:[J.jsxs("div",{className:"flex items-center gap-4",children:[J.jsx("img",{src:A3,alt:"search",className:"w-3 h-3"}),J.jsxs("div",{children:[J.jsx("p",{className:"text-[11px] leading-[13px] text-neutral-600",children:I?.title}),I?.subTitle&&J.jsx("p",{className:"text-[8px] leading-[10px] text-neutral-700",children:I?.subTitle})]})]}),J.jsx("img",{src:xy,alt:"arrow",className:"w-[5px] h-2"})]},x))}):J.jsx("div",{className:"pt-3 pb-[6px] pl-[11px] border-b border-neutral-300",children:J.jsx("p",{className:"text-[9px] leading-[11px] text-neutral-700",children:""})})]}),J.jsx(qh,{})]})}function TS({children:m,className:g,value:T,name:S,label:b,placeholder:I}){return J.jsxs("div",{className:`input-container flex flex-col gap-[6px] ${g}`,children:[J.jsxs("div",{className:"flex flex-col gap-1",children:[b&&J.jsx("p",{className:"ml-1 text-[11px] leading-[13px]",children:b}),J.jsx("input",{value:T,name:S,placeholder:I,className:"w-full h-[29px] px-[13px] text-[7px] leading-[8px] text-black bg-neutral-300 border border-black outline-none placeholder:text-black"})]}),m&&J.jsx("div",{className:"flex justify-between items-center pl-1 pr-[6px] text-[7px] leading-[8px]",children:m})]})}function Uy({children:m,className:g,kind:T="primary",...S}){const b=()=>{let I="";return T==="primary"?I="button-primary flex justify-center items-center w-full h-[37px] text-[11px] leading-[13px] text-white bg-red-300":T==="outline"&&(I="button-outline flex justify-center items-center w-full h-[37px] text-[11px] leading-[13px] text-red-200 bg-neutral-200 border border-red-200"),I+" "+g};return J.jsx("button",{className:b(),...S,children:m})}function iY(){const m=CS(),g=()=>{m("/")};return J.jsxs("div",{className:"user-registration flex flex-col items-center w-full h-max min-h-full",children:[J.jsx(Sc,{title:""}),J.jsxs("div",{className:"w-full max-w-[768px] pt-[27px] pb-[58px] px-[9px]",children:[J.jsx("p",{className:"text-[10px] leading-[12px] mb-[22px]",children:""}),J.jsx(TS,{className:"mb-[18px]",label:"",placeholder:"future.vintage@example.com",children:J.jsx("p",{children:""})}),J.jsx(TS,{className:"mb-[25px]",label:""}),J.jsx(TS,{className:"mb-[59px]",label:"",placeholder:"Future Vintage",children:J.jsxs(J.Fragment,{children:[J.jsx("p",{children:""}),J.jsx("p",{children:"0/20"})]})}),J.jsx(Uy,{onClick:g,children:""})]})]})}function rY(){const m=CS(),g=()=>{m("/")};return J.jsxs("div",{className:"login flex flex-col items-center w-full h-max min-h-full",children:[J.jsx(Sc,{title:""}),J.jsxs("div",{className:"flex flex-col w-full max-w-[768px] pt-[18px] pb-[58px] px-[9px]",children:[J.jsx("p",{className:"text-[10px] leading-[12px] mb-[29px] ml-auto mr-5",children:""}),J.jsx(TS,{className:"mb-[17px]",label:"",placeholder:"future.vintage@example.com"}),J.jsx(TS,{className:"mb-[43px]",label:""}),J.jsx(Uy,{onClick:g,className:"mb-1",children:""}),J.jsxs("p",{className:"mb-[6px] ml-1 text-[11px] leading-[13px]",children:[J.jsx(pn,{to:"/",className:"text-red-200",children:""}),"",J.jsx(pn,{to:"/",className:"text-red-200",children:""}),""]}),J.jsx("p",{className:"mb-[123px] ml-1 text-[11px] leading-[13px]",children:""}),J.jsx("p",{className:"mb-[26px] mx-auto text-[10px] leading-[12px] text-red-200",children:""}),J.jsx(Uy,{onClick:g,kind:"outline",children:""})]})]})}function nY(){const m=CS(),g=()=>{m("/")};return J.jsxs("div",{className:"registration-email-sent flex flex-col items-center w-full h-max min-h-full",children:[J.jsx(Sc,{title:""}),J.jsxs("div",{className:"flex flex-col gap-[187px] w-full max-w-[768px] pt-6 pb-[58px] px-[9px]",children:[J.jsxs("div",{className:"flex flex-col gap-[6px] text-[13px] leading-[16px]",children:[J.jsx("p",{children:""}),J.jsx("p",{children:""}),J.jsx("p",{children:""}),J.jsx("p",{children:""})]}),J.jsx(Uy,{onClick:g,children:""})]})]})}function aY(){const m=[{title:"",to:"/"},{title:"",to:"/"},{title:"",to:"/"},{title:"",to:"/"},{title:"ETC",to:"/"},{title:"",to:"/"},{title:"",to:"/"},{title:"",to:"/"},{title:"",to:"/"}],g=[{title:"",level:3,list:m},{title:"",level:3,list:m},{title:"",level:3,list:m}],T=[{title:"",level:2,list:g},{title:"",level:2,list:g},{title:"",level:2,list:g},{title:"",level:2,list:g},{title:"",level:2,list:g},{title:"",level:2,list:g},{title:"CDDVD",level:2,list:g},{title:"",level:2,list:g},{title:"",level:2,list:g},{title:"",level:2,list:g},{title:"",level:2,list:g},{title:"",level:2,list:g},{title:"",level:2,list:g},{title:"",level:2,list:g},{title:"",level:2,list:g},{title:"",level:2,list:g},{title:"",level:2,list:g},{title:"",level:2,list:g}],S="flex justify-between items-center h-[46px] pl-[2px] pr-[15px] border-b border-neutral-300 [&_img]:w-[5px] [&_img]:h-2",[b,I]=te.useState(""),[x,z]=te.useState(1),[P,V]=te.useState(T),q=uW(),X=se=>{z(se?.level),I(se?.title),V(se?.list),q?.current?.scrollTo(0,0)};return J.jsxs("div",{className:"category-list flex flex-col items-center w-full h-max min-h-full",children:[J.jsx(Sc,{title:b}),J.jsxs("div",{className:"flex flex-col w-full max-w-[768px] pb-[58px] px-3 text-[11px] leading-[13px]",children:[x>1&&J.jsx("div",{className:S,children:J.jsx("p",{children:""})}),P?.map((se,re)=>se?.to?J.jsxs(pn,{to:se.to,className:S,children:[J.jsx("p",{children:se.title}),J.jsx("img",{src:xy,alt:"arrow"})]},`${x}-${re}`):J.jsxs("button",{className:S,onClick:()=>X(se),children:[J.jsx("p",{children:se.title}),J.jsx("img",{src:xy,alt:"arrow"})]},`${x}-${re}`))]}),J.jsx(qh,{})]})}const v5="data:image/svg+xml,%3csvg%20width='11'%20height='11'%20viewBox='0%200%2011%2011'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M5.45502%2010.535C8.26062%2010.535%2010.535%208.26056%2010.535%205.45496C10.535%202.64935%208.26062%200.375%205.45502%200.375C2.64941%200.375%200.375%202.64935%200.375%205.45496C0.375%208.26056%202.64941%2010.535%205.45502%2010.535Z'%20stroke='%23E6E6E6'%20stroke-width='0.75'%20stroke-miterlimit='10'/%3e%3c/svg%3e",R5="data:image/svg+xml,%3csvg%20width='11'%20height='11'%20viewBox='0%200%2011%2011'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M5.45502%2010.535C8.26062%2010.535%2010.535%208.26068%2010.535%205.45508C10.535%202.64947%208.26062%200.375%205.45502%200.375C2.64941%200.375%200.375%202.64947%200.375%205.45508C0.375%208.26068%202.64941%2010.535%205.45502%2010.535Z'%20stroke='%23E6E6E6'%20stroke-width='0.75'%20stroke-miterlimit='10'/%3e%3cpath%20d='M5.4516%208.05542C6.88754%208.05542%208.05157%206.89138%208.05157%205.45544C8.05157%204.0195%206.88754%202.85547%205.4516%202.85547C4.01566%202.85547%202.85156%204.0195%202.85156%205.45544C2.85156%206.89138%204.01566%208.05542%205.4516%208.05542Z'%20fill='%23E6E6E6'/%3e%3c/svg%3e";function sY(){const[m,g]=te.useState(!1),[T,S]=te.useState(""),[b,I]=te.useState(1),x=[{label:"",value:1},{label:"",value:2},{label:"",value:3}],z=()=>{g(!m)},P=V=>{S(V?.label),I(V?.value),z()};return J.jsxs("div",{className:"relative",children:[J.jsxs("button",{onClick:z,className:"flex items-center gap-[19px]",id:"label-for-editor",children:[J.jsx("p",{className:"text-[12px] leading-[15px]",children:T}),J.jsx("img",{src:Dy,alt:"arrow",className:"w-2 h-[5px]"})]}),m&&J.jsx("div",{className:"absolute top-full left-0 z-[1] translate-y-[5px] translate-x-[-18px] flex flex-col justify-center gap-[9px] w-[129px] h-max p-2 bg-dark-300",children:x?.map(V=>J.jsxs("button",{className:"flex justify-between items-center",onClick:()=>P(V),children:[J.jsx("p",{className:"text-[10px] leading-[12px]",children:V?.label}),J.jsx("img",{src:b===V?.value?R5:v5,alt:"checkbox",className:"w-[10px] h-[10px]"})]},V?.value))}),m&&J.jsx("div",{onClick:z,className:"fixed top-[55px] bottom-[72px] left-0 w-full h-[calc(100%-127px)] bg-neutral-900 bg-opacity-40"})]})}const oY="data:image/svg+xml,%3csvg%20width='19'%20height='13'%20viewBox='0%200%2019%2013'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M5.67969%203V9.42188L8.14844%206.94531L8.75781%207.54687L5.25%2011.0469L1.75%207.54687L2.34375%206.94531L4.82031%209.42188V3H5.67969Z'%20fill='%23DBDBDB'/%3e%3cpath%20d='M11.9609%2011V4.57813L9.49219%207.05469L8.88281%206.45312L12.3906%202.95312L15.8906%206.45312L15.2969%207.05469L12.8203%204.57813V11H11.9609Z'%20fill='%23DBDBDB'/%3e%3c/svg%3e";function cY(){const[m,g]=te.useState(!1),[T,S]=te.useState(""),[b,I]=te.useState(1),x=[{label:"",value:1},{label:"",value:2},{label:"",value:3},{label:"",value:4},{label:"",value:5}],z=()=>{g(!m)},P=V=>{S(V?.label),I(V?.value),z()};return J.jsxs("div",{className:"relative",children:[J.jsxs("button",{onClick:z,className:"flex items-center gap-[6px]",children:[J.jsx("img",{src:oY,alt:"sort",className:"w-[18px] h-[13px]"}),J.jsx("p",{className:"text-[12px] leading-[15px]",children:T})]}),m&&J.jsx("div",{className:"absolute top-full right-0 z-[1] translate-y-[5px] translate-x-[11px] flex flex-col justify-center gap-[9px] w-[129px] h-max p-2 bg-dark-300",children:x?.map(V=>J.jsxs("button",{className:"flex justify-between items-center",onClick:()=>P(V),children:[J.jsx("p",{className:"text-[10px] leading-[12px]",children:V?.label}),J.jsx("img",{src:b===V?.value?R5:v5,alt:"checkbox",className:"w-[10px] h-[10px]"})]},V?.value))}),m&&J.jsx("div",{onClick:z,className:"fixed top-[55px] bottom-[72px] left-0 w-full h-[calc(100%-127px)] bg-neutral-900 bg-opacity-40"})]})}const lY="data:image/svg+xml,%3csvg%20width='12'%20height='10'%20viewBox='0%200%2012%2010'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0%201.40039H2.08002'%20stroke='%23D8D8D8'%20stroke-width='0.5'%20stroke-miterlimit='10'/%3e%3cpath%20d='M4.29688%201.40039H11.1968'%20stroke='%23D8D8D8'%20stroke-width='0.5'%20stroke-miterlimit='10'/%3e%3cpath%20d='M3.22815%202.54999C3.86328%202.54999%204.37811%202.03512%204.37811%201.39999C4.37811%200.764866%203.86328%200.25%203.22815%200.25C2.59302%200.25%202.07812%200.764866%202.07812%201.39999C2.07812%202.03512%202.59302%202.54999%203.22815%202.54999Z'%20stroke='%23D8D8D8'%20stroke-width='0.5'%20stroke-miterlimit='10'/%3e%3cpath%20d='M0%204.69043H6.90002'%20stroke='%23D8D8D8'%20stroke-width='0.5'%20stroke-miterlimit='10'/%3e%3cpath%20d='M9.13281%204.69043H11.2028'%20stroke='%23D8D8D8'%20stroke-width='0.5'%20stroke-miterlimit='10'/%3e%3cpath%20d='M8.04846%205.84006C8.68359%205.84006%209.19843%205.32516%209.19843%204.69003C9.19843%204.05491%208.68359%203.54004%208.04846%203.54004C7.41333%203.54004%206.89844%204.05491%206.89844%204.69003C6.89844%205.32516%207.41333%205.84006%208.04846%205.84006Z'%20stroke='%23D8D8D8'%20stroke-width='0.5'%20stroke-miterlimit='10'/%3e%3cpath%20d='M0%207.98047H4.15002'%20stroke='%23D8D8D8'%20stroke-width='0.5'%20stroke-miterlimit='10'/%3e%3cpath%20d='M6.36719%207.98047H11.1971'%20stroke='%23D8D8D8'%20stroke-width='0.5'%20stroke-miterlimit='10'/%3e%3cpath%20d='M5.29846%209.13007C5.93359%209.13007%206.44843%208.6152%206.44843%207.98007C6.44843%207.34494%205.93359%206.83008%205.29846%206.83008C4.66333%206.83008%204.14844%207.34494%204.14844%207.98007C4.14844%208.6152%204.66333%209.13007%205.29846%209.13007Z'%20stroke='%23D8D8D8'%20stroke-width='0.5'%20stroke-miterlimit='10'/%3e%3c/svg%3e";function dY(){const m=[{imgProduct:IO,money:"1,200",nameProduct:"balenciaga ",imgShop:f5,nameShop:"simgffj",link:"/a"},{imgProduct:OO,money:"9,500",nameProduct:"Noir kei ninomiya ",imgShop:m5,nameShop:"ponta",link:"/a"},{imgProduct:d5,money:"6,000",nameProduct:"DRIES VAN NOTEN ",imgShop:_5,nameShop:"",link:"/a"},{imgProduct:u5,money:"2,000",nameProduct:"W&LT / Psychedelic Knit Vest",imgShop:E5,nameShop:"meangirls",link:"/a"},{imgProduct:h5,money:"9,200",nameProduct:" ",imgShop:g5,nameShop:"ReviResonia",link:"/a"},{imgProduct:p5,money:"38,000",nameProduct:"Archive Denim Half Coat",imgShop:S5,nameShop:"ichigo",link:"/a"}];return J.jsxs("div",{className:"search-result flex flex-col items-center w-full h-max min-h-full",children:[J.jsx(Sc,{title:""}),J.jsxs("div",{className:"flex flex-col gap-5 w-full max-w-[768px] pt-6 pb-[58px] px-3 text-[11px] leading-[13px]",children:[J.jsxs("div",{className:"flex flex-col items-end gap-[11px] pb-[6px] px-[18px] border-b border-neutral-300",children:[J.jsx(cY,{}),J.jsxs("div",{className:"flex justify-between items-center w-full",children:[J.jsx(sY,{}),J.jsxs("button",{className:"flex items-center gap-2",children:[J.jsx("img",{src:lY,alt:"filter",className:"w-[11px] h-[9px]"}),J.jsx("p",{className:"text-[12px] leading-[15px]",children:"(1)"})]})]})]}),J.jsx("div",{className:"grid grid-cols-2 gap-x-[3px] gap-y-[9px] w-full px-[7px]",children:m?.map((g,T)=>J.jsx(l5,{data:g},T))})]}),J.jsx(qh,{})]})}const uY="/assets/avatar-mI32lpw9.svg",hY="data:image/svg+xml,%3csvg%20width='16'%20height='15'%20viewBox='0%200%2016%2015'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8.52495%200.4725L10.055%205.1925H15.0249C15.6949%205.1925%2015.965%206.0425%2015.425%206.4425L11.405%209.3625L12.935%2014.0825C13.145%2014.7125%2012.4149%2015.2425%2011.8749%2014.8525L7.8549%2011.9325L3.83488%2014.8525C3.29488%2015.2425%202.56495%2014.7125%202.77495%2014.0825L4.30497%209.3625L0.284955%206.4425C-0.255045%206.0525%200.0249795%205.1925%200.684979%205.1925H5.65495L7.18498%200.4725C7.39498%20-0.1575%208.28492%20-0.1575%208.49492%200.4725H8.52495Z'%20fill='%23FF1D25'/%3e%3c/svg%3e",pY="data:image/svg+xml,%3csvg%20width='15'%20height='17'%20viewBox='0%200%2015%2017'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M7.12%2016.46L14.25%2012.34V4.11L7.12%200L0%204.11V12.34'%20fill='%23D84800'/%3e%3cpath%20d='M4.72095%204.64977C5.10095%204.57977%205.95097%204.50977%206.74097%204.50977C7.72097%204.50977%208.25096%204.59977%208.73096%204.83977C9.21096%205.05977%209.59094%205.49976%209.59094%206.13976C9.59094%206.69976%209.25097%207.22976%208.49097%207.48976V7.50977C9.22097%207.69977%209.81091%208.23976%209.81091%209.09976C9.81091%209.70976%209.51093%2010.1798%209.08093%2010.4998C8.58093%2010.8598%207.7609%2011.0598%206.4209%2011.0598C5.6209%2011.0598%205.05094%2011.0098%204.71094%2010.9598V4.65976L4.72095%204.64977ZM6.22095%207.07976H6.76086C7.63086%207.07976%208.06091%206.77976%208.06091%206.31976C8.06091%205.82976%207.64092%205.60976%206.94092%205.60976C6.56092%205.60976%206.36096%205.62976%206.23096%205.65976V7.08977L6.22095%207.07976ZM6.22095%209.91975C6.38095%209.94975%206.58085%209.94977%206.87085%209.94977C7.58085%209.94977%208.21094%209.70975%208.21094%209.02975C8.21094%208.38975%207.59089%208.15976%206.79089%208.15976H6.22095V9.92976V9.91975Z'%20fill='%23F2F2F2'/%3e%3c/svg%3e";function fY(){const m=[{label:"",value:31,percent:80},{label:"4",value:6,percent:30},{label:"3",value:1,percent:5},{label:"2",value:0,percent:0},{label:"1",value:0,percent:0}];return J.jsxs("div",{className:"my-page flex flex-col items-center w-full h-max min-h-full",children:[J.jsx(Sc,{title:""}),J.jsxs("div",{className:"flex flex-col gap-7 w-full max-w-[768px] pt-[23px] pb-[58px] text-[11px] leading-[13px]",children:[J.jsxs("div",{className:"grid grid-cols-[80fr_196fr] gap-[38px] px-10",children:[J.jsxs("div",{className:"flex flex-col items-center gap-2",children:[J.jsx("img",{src:uY,alt:"avatar",className:"w-full max-w-[79px] aspect-square"}),J.jsx("p",{className:"text-[15px] leading-[18px] text-neutral-600",children:"Y.Sara1985"})]}),J.jsxs("div",{className:"flex items-center gap-[18px]",children:[J.jsxs("div",{className:"grow pt-[3px]",children:[J.jsxs("div",{className:"flex items-center w-full mb-2",children:[J.jsx("img",{src:hY,alt:"star",className:"w-4 h-[15px] mr-[5px]"}),J.jsx("p",{className:"text-[12px] leading-[15px] mr-[9px]",children:"4.2"}),J.jsx("p",{className:"text-[6px] leading-[7px] mr-[22px]",children:"/ 38"}),J.jsx("img",{src:pY,alt:"blonze",className:"w-[14px] h-4 mr-2"}),J.jsx("p",{className:"text-[12px] leading-[15px]",children:"Blonze"})]}),J.jsx("div",{className:"flex flex-col gap-1 mb-[10px]",children:m?.map((g,T)=>J.jsxs("div",{className:"flex items-center gap-1",children:[J.jsx("p",{className:"w-[14px] text-[7px] leading-[8px] text-neutral-600 text-left",children:g?.label}),J.jsx("div",{className:"w-[58px] h-[5px] border border-neutral-800",children:J.jsx("div",{style:{width:g?.percent+"%"},className:"h-full bg-red-400"})}),J.jsx("p",{className:"text-[5px] leading-[6px] text-neutral-600",children:g?.value})]},T))}),J.jsxs("div",{className:"flex justify-between items-center w-full pl-[2px] pr-1",children:[J.jsxs("div",{className:"flex items-center gap-[11px]",children:[J.jsx("p",{className:"text-[10px] leading-[12px] text-neutral-600",children:""}),J.jsx("p",{className:"text-[6px] leading-[7px] text-neutral-700",children:""})]}),J.jsxs("div",{className:"flex items-center gap-[11px]",children:[J.jsx("p",{className:"text-[10px] leading-[12px] text-neutral-600",children:"16"}),J.jsx("p",{className:"text-[6px] leading-[7px] text-neutral-700",children:""})]}),J.jsxs("div",{className:"flex items-center gap-[11px]",children:[J.jsx("p",{className:"text-[10px] leading-[12px] text-neutral-600",children:"4"}),J.jsx("p",{className:"text-[6px] leading-[7px] text-neutral-700",children:""})]})]})]}),J.jsx(pn,{to:"/",children:J.jsx("img",{src:xy,alt:"arrow",className:"w-[5px] h-[8px]"})})]})]}),J.jsx("div",{className:"w-full px-3"})]}),J.jsx(qh,{showMore:!0})]})}function mY(){return J.jsx(ZW,{children:J.jsx(IW,{children:J.jsxs(Ps,{element:J.jsx(fz,{}),children:[J.jsx(Ps,{path:ba?.TOP_NO_LOGIN,element:J.jsx(YK,{})}),J.jsx(Ps,{path:ba?.TOP_LOGIN,element:J.jsx(XK,{})}),J.jsx(Ps,{path:ba?.LIKE_LIST,element:J.jsx($K,{})}),J.jsx(Ps,{path:ba?.SEARCH_TOP,element:J.jsx(tY,{})}),J.jsx(Ps,{path:ba?.USER_REGISTRATION,element:J.jsx(iY,{})}),J.jsx(Ps,{path:ba?.LOGIN,element:J.jsx(rY,{})}),J.jsx(Ps,{path:ba?.REGISTRATION_EMAIL_SENT,element:J.jsx(nY,{})}),J.jsx(Ps,{path:ba?.CATEGORY_LIST,element:J.jsx(aY,{})}),J.jsx(Ps,{path:ba?.SEARCH_RESULT,element:J.jsx(dY,{})}),J.jsx(Ps,{path:ba?.MY_PAGE,element:J.jsx(fY,{})})]})})})}/**
 * @license agora-rtc-react
 * @version 2.5.0
 *
 * Copyright (c) Agora, Inc.
 *
 * This source code is licensed under the MIT license.
 */var _Y=Object.create,NO=Object.defineProperty,EY=Object.getOwnPropertyDescriptor,gY=Object.getOwnPropertyNames,SY=Object.getPrototypeOf,TY=Object.prototype.hasOwnProperty,vY=(m,g)=>()=>(g||m((g={exports:{}}).exports,g),g.exports),RY=(m,g)=>{for(var T in g)NO(m,T,{get:g[T],enumerable:!0})},y5=(m,g,T,S)=>{if(g&&typeof g=="object"||typeof g=="function")for(let b of gY(g))!TY.call(m,b)&&b!==T&&NO(m,b,{get:()=>g[b],enumerable:!(S=EY(g,b))||S.enumerable});return m},yY=(m,g,T)=>(y5(m,g,"default"),T),Xh=(m,g,T)=>(T=m!=null?_Y(SY(m)):{},y5(!m||!m.__esModule?NO(T,"default",{value:m,enumerable:!0}):T,m)),Jh=vY((m,g)=>{(function(T,S){typeof m=="object"&&typeof g<"u"?g.exports=S():typeof define=="function"&&define.amd?define(S):(T=typeof globalThis<"u"?globalThis:T||self).AgoraRTC=S()})(m,function(){function T(e,t){return t.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(r){if(r!=="default"&&!(r in e)){var n=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return i[r]}})}})}),Object.freeze(e)}var S=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function b(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var I=function(e){try{return!!e()}catch{return!0}},x=!I(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),z=x,P=Function.prototype,V=P.call,q=z&&P.bind.bind(V,V),X=z?q:function(e){return function(){return V.apply(e,arguments)}},se=X({}.isPrototypeOf),re=function(e){return e&&e.Math===Math&&e},ue=re(typeof globalThis=="object"&&globalThis)||re(typeof window=="object"&&window)||re(typeof self=="object"&&self)||re(typeof S=="object"&&S)||re(typeof S=="object"&&S)||(function(){return this})()||Function("return this")(),ae=x,oe=Function.prototype,Ae=oe.apply,be=oe.call,Oe=typeof Reflect=="object"&&Reflect.apply||(ae?be.bind(Ae):function(){return be.apply(Ae,arguments)}),Xe=X,Ue=Xe({}.toString),gt=Xe("".slice),it=function(e){return gt(Ue(e),8,-1)},Ge=it,kt=X,rt=function(e){if(Ge(e)==="Function")return kt(e)},Ze=typeof document=="object"&&document.all,Qe=Ze===void 0&&Ze!==void 0?function(e){return typeof e=="function"||e===Ze}:function(e){return typeof e=="function"},Di={},ii=!I(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Pi=x,Ne=Function.prototype.call,We=Pi?Ne.bind(Ne):function(){return Ne.apply(Ne,arguments)},He={},St={}.propertyIsEnumerable,ie=Object.getOwnPropertyDescriptor,je=ie&&!St.call({1:2},1);He.f=je?function(e){var t=ie(this,e);return!!t&&t.enumerable}:St;var $e,et,ft=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},_i=I,Ut=it,fn=Object,Qi=X("".split),Aa=_i(function(){return!fn("z").propertyIsEnumerable(0)})?function(e){return Ut(e)==="String"?Qi(e,""):fn(e)}:fn,Rl=function(e){return e==null},$h=Rl,Bm=TypeError,Ls=function(e){if($h(e))throw new Bm("Can't call method on "+e);return e},jm=Aa,Hy=Ls,go=function(e){return jm(Hy(e))},$a=Qe,Yr=function(e){return typeof e=="object"?e!==null:$a(e)},bn={},ep=bn,yl=ue,Wy=Qe,Fm=function(e){return Wy(e)?e:void 0},qr=function(e,t){return arguments.length<2?Fm(ep[e])||Fm(yl[e]):ep[e]&&ep[e][t]||yl[e]&&yl[e][t]},AS=ue.navigator,Cl=AS&&AS.userAgent,dr=Cl?String(Cl):"",ks=ue,mn=dr,wS=ks.process,IS=ks.Deno,OS=wS&&wS.versions||IS&&IS.version,eu=OS&&OS.v8;eu&&(et=($e=eu.split("."))[0]>0&&$e[0]<4?1:+($e[0]+$e[1])),!et&&mn&&(!($e=mn.match(/Edge\/(\d+)/))||$e[1]>=74)&&($e=mn.match(/Chrome\/(\d+)/))&&(et=+$e[1]);var es=et,So=es,tp=I,tu=ue.String,bl=!!Object.getOwnPropertySymbols&&!tp(function(){var e=Symbol("symbol detection");return!tu(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&So&&So<41}),Gm=bl&&!Symbol.sham&&typeof Symbol.iterator=="symbol",NS=qr,Hm=Qe,iu=se,zy=Object,Al=Gm?function(e){return typeof e=="symbol"}:function(e){var t=NS("Symbol");return Hm(t)&&iu(t.prototype,zy(e))},DS=String,To=function(e){try{return DS(e)}catch{return"Object"}},Wm=Qe,PS=To,Ky=TypeError,ur=function(e){if(Wm(e))return e;throw new Ky(PS(e)+" is not a function")},nn=ur,An=Rl,Ms=function(e,t){var i=e[t];return An(i)?void 0:nn(i)},ip=We,LS=Qe,kS=Yr,MS=TypeError,wl={exports:{}},rp=ue,Il=Object.defineProperty,Ol=ue,ru=function(e,t){try{Il(rp,e,{value:t,configurable:!0,writable:!0})}catch{rp[e]=t}return t},Tc="__core-js_shared__",wr=wl.exports=Ol[Tc]||ru(Tc,{});(wr.versions||(wr.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var np=wl.exports,zm=np,ra=function(e,t){return zm[e]||(zm[e]=t||{})},Nl=Ls,Yy=Object,wa=function(e){return Yy(Nl(e))},xS=wa,qy=X({}.hasOwnProperty),tr=Object.hasOwn||function(e,t){return qy(xS(e),t)},ap=X,xs=0,Km=Math.random(),US=ap(1 .toString),vo=function(e){return"Symbol("+(e===void 0?"":e)+")_"+US(++xs+Km,36)},Ym=ra,sp=tr,Xy=vo,VS=bl,na=Gm,vc=ue.Symbol,qm=Ym("wks"),op=na?vc.for||vc:vc&&vc.withoutSetter||Xy,Li=function(e){return sp(qm,e)||(qm[e]=VS&&sp(vc,e)?vc[e]:op("Symbol."+e)),qm[e]},cp=We,BS=Yr,Gn=Al,Xm=Ms,jS=function(e,t){var i,r;if(LS(i=e.toString)&&!kS(r=ip(i,e))||LS(i=e.valueOf)&&!kS(r=ip(i,e))||t!=="string")return r;throw new MS("Can't convert object to primitive value")},Jm=TypeError,Dl=Li("toPrimitive"),FS=function(e,t){if(!BS(e)||Gn(e))return e;var i,r=Xm(e,Dl);if(r){if(i=cp(r,e,t),!BS(i)||Gn(i))return i;throw new Jm("Can't convert object to primitive value")}return jS(e,t)},GS=Al,Ro=function(e){var t=FS(e,"string");return GS(t)?t:t+""},HS=Yr,lp=ue.document,WS=HS(lp)&&HS(lp.createElement),nu=function(e){return WS?lp.createElement(e):{}},Jy=nu,zS=!ii&&!I(function(){return Object.defineProperty(Jy("div"),"a",{get:function(){return 7}}).a!==7}),dp=ii,Zm=We,Qm=He,Pl=ft,Ll=go,KS=Ro,$m=tr,YS=zS,kl=Object.getOwnPropertyDescriptor;Di.f=dp?kl:function(e,t){if(e=Ll(e),t=KS(t),YS)try{return kl(e,t)}catch{}if($m(e,t))return Pl(!Zm(Qm.f,e,t),e[t])};var Us=I,e_=Qe,au=/#|\.prototype\./,aa=function(e,t){var i=up[t_(e)];return i===hp||i!==qS&&(e_(t)?Us(t):!!t)},t_=aa.normalize=function(e){return String(e).replace(au,".").toLowerCase()},up=aa.data={},qS=aa.NATIVE="N",hp=aa.POLYFILL="P",su=aa,XS=ur,wn=x,Rc=rt(rt.bind),Ia=function(e,t){return XS(e),t===void 0?e:wn?Rc(e,t):function(){return e.apply(t,arguments)}},an={},JS=ii&&I(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),i_=Yr,r_=String,ou=TypeError,Br=function(e){if(i_(e))return e;throw new ou(r_(e)+" is not an object")},ZS=ii,Zy=zS,Qy=JS,pp=Br,fp=Ro,$y=TypeError,n_=Object.defineProperty,eC=Object.getOwnPropertyDescriptor,a_="enumerable",s_="configurable",mp="writable";an.f=ZS?Qy?function(e,t,i){if(pp(e),t=fp(t),pp(i),typeof e=="function"&&t==="prototype"&&"value"in i&&mp in i&&!i[mp]){var r=eC(e,t);r&&r[mp]&&(e[t]=i.value,i={configurable:s_ in i?i[s_]:r[s_],enumerable:a_ in i?i[a_]:r[a_],writable:!1})}return n_(e,t,i)}:n_:function(e,t,i){if(pp(e),t=fp(t),pp(i),Zy)try{return n_(e,t,i)}catch{}if("get"in i||"set"in i)throw new $y("Accessors not supported");return"value"in i&&(e[t]=i.value),e};var tC=an,iC=ft,yc=ii?function(e,t,i){return tC.f(e,t,iC(1,i))}:function(e,t,i){return e[t]=i,e},cu=ue,o_=Oe,rC=rt,nC=Qe,aC=Di.f,QS=su,Ml=bn,sC=Ia,xl=yc,$S=tr,oC=function(e){var t=function(i,r,n){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,r)}return new e(i,r,n)}return o_(e,this,arguments)};return t.prototype=e.prototype,t},Vt=function(e,t){var i,r,n,s,c,l,d,h,p,_=e.target,E=e.global,R=e.stat,N=e.proto,w=E?cu:R?cu[_]:cu[_]&&cu[_].prototype,O=E?Ml:Ml[_]||xl(Ml,_,{})[_],L=O.prototype;for(s in t)r=!(i=QS(E?s:_+(R?".":"#")+s,e.forced))&&w&&$S(w,s),l=O[s],r&&(d=e.dontCallGetSet?(p=aC(w,s))&&p.value:w[s]),c=r&&d?d:t[s],(i||N||typeof l!=typeof c)&&(h=e.bind&&r?sC(c,cu):e.wrap&&r?oC(c):N&&nC(c)?rC(c):c,(e.sham||c&&c.sham||l&&l.sham)&&xl(h,"sham",!0),xl(O,s,h),N&&($S(Ml,n=_+"Prototype")||xl(Ml,n,{}),xl(Ml[n],s,c),e.real&&L&&(i||!L[s])&&xl(L,s,c)))},cC=Math.ceil,lC=Math.floor,dC=Math.trunc||function(e){var t=+e;return(t>0?lC:cC)(t)},c_=dC,Cc=function(e){var t=+e;return t!=t||t===0?0:c_(t)},uC=Cc,eT=Math.max,tT=Math.min,_p=function(e,t){var i=uC(e);return i<0?eT(i+t,0):tT(i,t)},iT=Cc,rT=Math.min,bc=function(e){var t=iT(e);return t>0?rT(t,9007199254740991):0},hC=bc,yo=function(e){return hC(e.length)},pC=go,nT=_p,aT=yo,Ul=function(e){return function(t,i,r){var n=pC(t),s=aT(n);if(s===0)return!e&&-1;var c,l=nT(r,s);if(e&&i!=i){for(;s>l;)if((c=n[l++])!=c)return!0}else for(;s>l;l++)if((e||l in n)&&n[l]===i)return e||l||0;return!e&&-1}},Ac={includes:Ul(!0),indexOf:Ul(!1)},fC=Ac.includes;Vt({target:"Array",proto:!0,forced:I(function(){return!Array(1).includes()})},{includes:function(e){return fC(this,e,arguments.length>1?arguments[1]:void 0)}});var Ep=ue,sT=bn,Hn=function(e,t){var i=sT[e+"Prototype"],r=i&&i[t];if(r)return r;var n=Ep[e],s=n&&n.prototype;return s&&s[t]},l_=Hn("Array","includes"),d_=Yr,oT=it,cT=Li("match"),u_=function(e){var t;return d_(e)&&((t=e[cT])!==void 0?!!t:oT(e)==="RegExp")},mC=u_,_C=TypeError,lT={};lT[Li("toStringTag")]="z";var h_=String(lT)==="[object z]",EC=h_,Wn=Qe,Co=it,dT=Li("toStringTag"),uT=Object,hT=Co((function(){return arguments})())==="Arguments",Vs=EC?Co:function(e){var t,i,r;return e===void 0?"Undefined":e===null?"Null":typeof(i=(function(n,s){try{return n[s]}catch{}})(t=uT(e),dT))=="string"?i:hT?Co(t):(r=Co(t))==="Object"&&Wn(t.callee)?"Arguments":r},p_=Vs,gC=String,Ir=function(e){if(p_(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return gC(e)},f_=Li("match"),lu=Vt,m_=function(e){if(mC(e))throw new _C("The method doesn't accept regular expressions");return e},pT=Ls,bo=Ir,Vl=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[f_]=!1,"/./"[e](t)}catch{}}return!1},__=X("".indexOf);lu({target:"String",proto:!0,forced:!Vl("includes")},{includes:function(e){return!!~__(bo(pT(this)),bo(m_(e)),arguments.length>1?arguments[1]:void 0)}});var fT=Hn("String","includes"),Ao=se,mT=l_,_T=fT,gp=Array.prototype,E_=String.prototype,SC=function(e){var t=e.includes;return e===gp||Ao(gp,e)&&t===gp.includes?mT:typeof e=="string"||e===E_||Ao(E_,e)&&t===E_.includes?_T:t},ve=b(SC),ET=ur,gT=wa,g_=Aa,Oa=yo,S_=TypeError,zn="Reduce of empty array with no initial value",sa=function(e){return function(t,i,r,n){var s=gT(t),c=g_(s),l=Oa(s);if(ET(i),l===0&&r<2)throw new S_(zn);var d=0,h=1;if(r<2)for(;;){if(d in c){n=c[d],d+=h;break}if(d+=h,l<=d)throw new S_(zn)}for(;l>d;d+=h)d in c&&(n=i(n,c[d],d,s));return n}},Bl={left:sa()},T_=I,wc=function(e,t){var i=[][e];return!!i&&T_(function(){i.call(null,t||function(){return 1},1)})},wo=ue,v_=dr,jl=it,du=function(e){return v_.slice(0,e.length)===e},Fl=du("Bun/")?"BUN":du("Cloudflare-Workers")?"CLOUDFLARE":du("Deno/")?"DENO":du("Node.js/")?"NODE":wo.Bun&&typeof Bun.version=="string"?"BUN":wo.Deno&&typeof Deno.version=="object"?"DENO":jl(wo.process)==="process"?"NODE":wo.window&&wo.document?"BROWSER":"REST",Bs=Fl==="NODE",TC=Bl.left;Vt({target:"Array",proto:!0,forced:!Bs&&es>79&&es<83||!wc("reduce")},{reduce:function(e){var t=arguments.length;return TC(this,e,t,t>1?arguments[1]:void 0)}});var Kn=Hn("Array","reduce"),R_=se,js=Kn,Sp=Array.prototype,Tp=function(e){var t=e.reduce;return e===Sp||R_(Sp,e)&&t===Sp.reduce?js:t},Io=Tp,In=b(Io),y_=it,ts=Array.isArray||function(e){return y_(e)==="Array"},Gl=Vt,vp=ts,Rp=X([].reverse),Yn=[1,2];Gl({target:"Array",proto:!0,forced:String(Yn)===String(Yn.reverse())},{reverse:function(){return vp(this)&&(this.length=this.length),Rp(this)}});var oa=Hn("Array","reverse"),Ic=se,Fs=oa,Na=Array.prototype,Oc=function(e){var t=e.reverse;return e===Na||Ic(Na,e)&&t===Na.reverse?Fs:t},C_=Oc,yp=b(C_),b_=vo,sn=ra("keys"),Yi=function(e){return sn[e]||(sn[e]=b_(e))},Si=!I(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),Nc=tr,is=Qe,A_=wa,Dc=Si,w_=Yi("IE_PROTO"),Cp=Object,uu=Cp.prototype,Pc=Dc?Cp.getPrototypeOf:function(e){var t=A_(e);if(Nc(t,w_))return t[w_];var i=t.constructor;return is(i)&&t instanceof i?i.prototype:t instanceof Cp?uu:null},ST=X,hu=ur,I_=Yr,Lc=function(e){return I_(e)||e===null},Gs=String,Oo=TypeError,Hs=function(e,t,i){try{return ST(hu(Object.getOwnPropertyDescriptor(e,t)[i]))}catch{}},O_=Yr,N_=Ls,pu=function(e){if(Lc(e))return e;throw new Oo("Can't set "+Gs(e)+" as a prototype")},bp=Object.setPrototypeOf||("__proto__"in{}?(function(){var e,t=!1,i={};try{(e=Hs(Object.prototype,"__proto__","set"))(i,[]),t=i instanceof Array}catch{}return function(r,n){return N_(r),pu(n),O_(r)&&(t?e(r,n):r.__proto__=n),r}})():void 0),rs={},Or={},Hl=tr,TT=go,vC=Ac.indexOf,RC=Or,vT=X([].push),Sr=function(e,t){var i,r=TT(e),n=0,s=[];for(i in r)!Hl(RC,i)&&Hl(r,i)&&vT(s,i);for(;t.length>n;)Hl(r,i=t[n++])&&(~vC(s,i)||vT(s,i));return s},fu=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],mu=Sr,_u=fu.concat("length","prototype");rs.f=Object.getOwnPropertyNames||function(e){return mu(e,_u)};var kc={};kc.f=Object.getOwnPropertySymbols;var Wl=qr,zl=rs,yC=kc,RT=Br,CC=X([].concat),yT=Wl("Reflect","ownKeys")||function(e){var t=zl.f(RT(e)),i=yC.f;return i?CC(t,i(e)):t},No=tr,D_=yT,Ap=Di,CT=an,Mc={},bT=Sr,wp=fu,Kl=Object.keys||function(e){return bT(e,wp)},AT=ii,Ip=JS,wT=an,Eu=Br,IT=go,OT=Kl;Mc.f=AT&&!Ip?Object.defineProperties:function(e,t){Eu(e);for(var i,r=IT(t),n=OT(t),s=n.length,c=0;s>c;)wT.f(e,i=n[c++],r[i]);return e};var Da,Op=qr("document","documentElement"),P_=Br,Do=Mc,Ws=fu,gu=Or,L_=Op,k_=nu,xc="prototype",Uc="script",M_=Yi("IE_PROTO"),Np=function(){},Vc=function(e){return"<"+Uc+">"+e+"</"+Uc+">"},Su=function(e){e.write(Vc("")),e.close();var t=e.parentWindow.Object;return e=null,t},Tu=function(){try{Da=new ActiveXObject("htmlfile")}catch{}var e,t,i;Tu=typeof document<"u"?document.domain&&Da?Su(Da):(t=k_("iframe"),i="java"+Uc+":",t.style.display="none",L_.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(Vc("document.F=Object")),e.close(),e.F):Su(Da);for(var r=Ws.length;r--;)delete Tu[xc][Ws[r]];return Tu()};gu[M_]=!0;var Bc=Object.create||function(e,t){var i;return e!==null?(Np[xc]=P_(e),i=new Np,Np[xc]=null,i[M_]=e):i=Tu(),t===void 0?i:Do.f(i,t)},x_=Yr,Po=yc,zt=Error,ki=X("".replace),Tr=String(new zt("zxcasd").stack),vu=/\n\s*at [^:]*:[^\n]*/,Yl=vu.test(Tr),jc=ft,Dp=!I(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",jc(1,7)),e.stack!==7)}),Ru=yc,ql=function(e,t){if(Yl&&typeof e=="string"&&!zt.prepareStackTrace)for(;t--;)e=ki(e,vu,"");return e},bC=Dp,ar=Error.captureStackTrace,Lo={},U_=Lo,NT=Li("iterator"),DT=Array.prototype,PT=function(e){return e!==void 0&&(U_.Array===e||DT[NT]===e)},V_=Vs,Pp=Ms,B_=Rl,On=Lo,vr=Li("iterator"),Xl=function(e){if(!B_(e))return Pp(e,vr)||Pp(e,"@@iterator")||On[V_(e)]},yu=We,Lp=ur,j_=Br,zs=To,kp=Xl,F_=TypeError,Cu=function(e,t){var i=arguments.length<2?kp(e):t;if(Lp(i))return j_(yu(i,e));throw new F_(zs(e)+" is not iterable")},LT=We,G_=Br,kT=Ms,H_=function(e,t,i){var r,n;G_(e);try{if(!(r=kT(e,"return"))){if(t==="throw")throw i;return i}r=LT(r,e)}catch(s){n=!0,r=s}if(t==="throw")throw i;if(n)throw r;return G_(r),i},MT=Ia,xT=We,W_=Br,UT=To,AC=PT,VT=yo,z_=se,BT=Cu,K_=Xl,Y_=H_,jT=TypeError,bu=function(e,t){this.stopped=e,this.result=t},q_=bu.prototype,Jl=function(e,t,i){var r,n,s,c,l,d,h,p=i&&i.that,_=!(!i||!i.AS_ENTRIES),E=!(!i||!i.IS_RECORD),R=!(!i||!i.IS_ITERATOR),N=!(!i||!i.INTERRUPTED),w=MT(t,p),O=function(M){return r&&Y_(r,"normal",M),new bu(!0,M)},L=function(M){return _?(W_(M),N?w(M[0],M[1],O):w(M[0],M[1])):N?w(M,O):w(M)};if(E)r=e.iterator;else if(R)r=e;else{if(!(n=K_(e)))throw new jT(UT(e)+" is not iterable");if(AC(n)){for(s=0,c=VT(e);c>s;s++)if((l=L(e[s]))&&z_(q_,l))return l;return new bu(!1)}r=BT(e,n)}for(d=E?e.next:r.next;!(h=xT(d,r)).done;){try{l=L(h.value)}catch(M){Y_(r,"throw",M)}if(typeof l=="object"&&l&&z_(q_,l))return l}return new bu(!1)},wC=Ir,FT=Vt,Zl=se,Mp=Pc,Au=bp,xp=function(e,t,i){for(var r=D_(t),n=CT.f,s=Ap.f,c=0;c<r.length;c++){var l=r[c];No(e,l)||i&&No(i,l)||n(e,l,s(t,l))}},Ql=Bc,Up=yc,Vp=ft,GT=function(e,t){x_(t)&&"cause"in t&&Po(e,"cause",t.cause)},HT=function(e,t,i,r){bC&&(ar?ar(e,t):Ru(e,"stack",ql(i,r)))},WT=Jl,zT=function(e,t){return e===void 0?arguments.length<2?"":t:wC(e)},X_=Li("toStringTag"),wu=Error,KT=[].push,ko=function(e,t){var i,r=Zl(Bp,this);Au?i=Au(new wu,r?Mp(this):Bp):(i=r?this:Ql(Bp),Up(i,X_,"Error")),t!==void 0&&Up(i,"message",zT(t)),HT(i,ko,i.stack,1),arguments.length>2&&GT(i,arguments[2]);var n=[];return WT(e,KT,{that:n}),Up(i,"errors",n),i};Au?Au(ko,wu):xp(ko,wu,{name:!0});var Bp=ko.prototype=Ql(wu.prototype,{constructor:Vp(1,ko),message:Vp(1,""),name:Vp(1,"AggregateError")});FT({global:!0},{AggregateError:ko});var Iu,Ou,$l,YT=Qe,J_=ue.WeakMap,Z_=YT(J_)&&/native code/.test(String(J_)),Q_=ue,qT=Yr,IC=yc,$_=tr,jp=np,Nu=Yi,eE=Or,Du="Object already initialized",Fp=Q_.TypeError,XT=Q_.WeakMap;if(Z_||jp.state){var qn=jp.state||(jp.state=new XT);qn.get=qn.get,qn.has=qn.has,qn.set=qn.set,Iu=function(e,t){if(qn.has(e))throw new Fp(Du);return t.facade=e,qn.set(e,t),t},Ou=function(e){return qn.get(e)||{}},$l=function(e){return qn.has(e)}}else{var Fc=Nu("state");eE[Fc]=!0,Iu=function(e,t){if($_(e,Fc))throw new Fp(Du);return t.facade=e,IC(e,Fc,t),t},Ou=function(e){return $_(e,Fc)?e[Fc]:{}},$l=function(e){return $_(e,Fc)}}var Mo,JT,Gc,Pa={set:Iu,get:Ou,has:$l,enforce:function(e){return $l(e)?Ou(e):Iu(e,{})},getterFor:function(e){return function(t){var i;if(!qT(t)||(i=Ou(t)).type!==e)throw new Fp("Incompatible receiver, "+e+" required");return i}}},ed=ii,Pu=tr,Lu=Function.prototype,ZT=ed&&Object.getOwnPropertyDescriptor,tE=Pu(Lu,"name"),Hc={PROPER:tE&&(function(){}).name==="something",CONFIGURABLE:tE&&(!ed||ed&&ZT(Lu,"name").configurable)},QT=yc,Nr=function(e,t,i,r){return r&&r.enumerable?e[t]=i:QT(e,t,i),e},ns=I,xo=Qe,$T=Yr,Uo=Bc,as=Pc,Dr=Nr,td=Li("iterator"),Gp=!1;[].keys&&("next"in(Gc=[].keys())?(JT=as(as(Gc)))!==Object.prototype&&(Mo=JT):Gp=!0);var iE=!$T(Mo)||ns(function(){var e={};return Mo[td].call(e)!==e});xo((Mo=iE?{}:Uo(Mo))[td])||Dr(Mo,td,function(){return this});var rE={IteratorPrototype:Mo,BUGGY_SAFARI_ITERATORS:Gp},ev=Vs,Wc=h_?{}.toString:function(){return"[object "+ev(this)+"]"},Hp=h_,tv=an.f,iv=yc,rv=tr,Wp=Wc,nE=Li("toStringTag"),La=function(e,t,i,r){var n=i?e:e&&e.prototype;n&&(rv(n,nE)||tv(n,nE,{configurable:!0,value:t}),r&&!Hp&&iv(n,"toString",Wp))},nv=rE.IteratorPrototype,av=Bc,OC=ft,sv=La,jr=Lo,Xr=function(){return this},zp=function(e,t,i,r){var n=t+" Iterator";return e.prototype=av(nv,{next:OC(+!r,i)}),sv(e,n,!1,!0),jr[n]=Xr,e},ov=Vt,cv=We,lv=Hc,dv=zp,Kp=Pc,aE=La,sE=Nr,oE=Lo,uv=rE,cE=lv.PROPER,id=uv.BUGGY_SAFARI_ITERATORS,ku=Li("iterator"),lE="keys",rd="values",Mu="entries",dE=function(){return this},uE=function(e,t,i,r,n,s,c){dv(i,t,r);var l,d,h,p=function(L){if(L===n&&w)return w;if(!id&&L&&L in R)return R[L];switch(L){case lE:case rd:case Mu:return function(){return new i(this,L)}}return function(){return new i(this)}},_=t+" Iterator",E=!1,R=e.prototype,N=R[ku]||R["@@iterator"]||n&&R[n],w=!id&&N||p(n),O=t==="Array"&&R.entries||N;if(O&&(l=Kp(O.call(new e)))!==Object.prototype&&l.next&&(aE(l,_,!0,!0),oE[_]=dE),cE&&n===rd&&N&&N.name!==rd&&(E=!0,w=function(){return cv(N,this)}),n)if(d={values:p(rd),keys:s?w:p(lE),entries:p(Mu)},c)for(h in d)(id||E||!(h in R))&&sE(R,h,d[h]);else ov({target:t,proto:!0,forced:id||E},d);return c&&R[ku]!==w&&sE(R,ku,w,{}),oE[t]=w,d},nd=function(e,t){return{value:e,done:t}},hv=go,ss=Lo,Yp=Pa;an.f;var NC=uE,xu=nd,os="Array Iterator",pv=Yp.set,qp=Yp.getterFor(os);NC(Array,"Array",function(e,t){pv(this,{type:os,target:hv(e),index:0,kind:t})},function(){var e=qp(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=null,xu(void 0,!0);switch(e.kind){case"keys":return xu(i,!1);case"values":return xu(t[i],!1)}return xu([i,t[i]],!1)},"values"),ss.Arguments=ss.Array;var Uu=an,Gi=function(e,t,i){return Uu.f(e,t,i)},DC=qr,PC=Gi,fv=ii,ad=Li("species"),Vo=se,mv=TypeError,Xp=function(e,t){if(Vo(t,e))return e;throw new mv("Incorrect invocation")},Vu=Qe,ca=np,_v=X(Function.toString);Vu(ca.inspectSource)||(ca.inspectSource=function(e){return _v(e)});var Jp=ca.inspectSource,Ev=X,hE=I,Zp=Qe,Qp=Vs,gv=Jp,cs=function(){},sr=qr("Reflect","construct"),Bu=/^\s*(?:class|function)\b/,Sv=Ev(Bu.exec),Fr=!Bu.test(cs),ju=function(e){if(!Zp(e))return!1;try{return sr(cs,[],e),!0}catch{return!1}},pE=function(e){if(!Zp(e))return!1;switch(Qp(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Fr||!!Sv(Bu,gv(e))}catch{return!0}};pE.sham=!0;var sd,wi,_n,ka,Fu=!sr||hE(function(){var e;return ju(ju.call)||!ju(Object)||!ju(function(){e=!0})||e})?pE:ju,Tv=Fu,LC=To,fE=TypeError,Nn=Br,Ma=function(e){if(Tv(e))return e;throw new fE(LC(e)+" is not a constructor")},vv=Rl,Xn=Li("species"),$p=function(e,t){var i,r=Nn(e).constructor;return r===void 0||vv(i=Nn(r)[Xn])?t:Ma(i)},En=X([].slice),zc=TypeError,Dn=function(e,t){if(e<t)throw new zc("Not enough arguments");return e},ef=/(?:ipad|iphone|ipod).*applewebkit/i.test(dr),gn=ue,ls=Oe,Rv=Ia,Kc=Qe,Gu=tr,od=I,Yc=Op,yv=En,mE=nu,Hu=Dn,Cv=ef,tf=Bs,rf=gn.setImmediate,_E=gn.clearImmediate,kC=gn.process,Ti=gn.Dispatch,Hi=gn.Function,ei=gn.MessageChannel,li=gn.String,vi=0,Jr={},Ks="onreadystatechange";od(function(){sd=gn.location});var Bo=function(e){if(Gu(Jr,e)){var t=Jr[e];delete Jr[e],t()}},Wu=function(e){return function(){Bo(e)}},ds=function(e){Bo(e.data)},ir=function(e){gn.postMessage(li(e),sd.protocol+"//"+sd.host)};rf&&_E||(rf=function(e){Hu(arguments.length,1);var t=Kc(e)?e:Hi(e),i=yv(arguments,1);return Jr[++vi]=function(){ls(t,void 0,i)},wi(vi),vi},_E=function(e){delete Jr[e]},tf?wi=function(e){kC.nextTick(Wu(e))}:Ti&&Ti.now?wi=function(e){Ti.now(Wu(e))}:ei&&!Cv?(ka=(_n=new ei).port2,_n.port1.onmessage=ds,wi=Rv(ka.postMessage,ka)):gn.addEventListener&&Kc(gn.postMessage)&&!gn.importScripts&&sd&&sd.protocol!=="file:"&&!od(ir)?(wi=ir,gn.addEventListener("message",ds,!1)):wi=Ks in mE("script")?function(e){Yc.appendChild(mE("script"))[Ks]=function(){Yc.removeChild(this),Bo(e)}}:function(e){setTimeout(Wu(e),0)});var xa={set:rf,clear:_E},jo=ue,EE=ii,la=Object.getOwnPropertyDescriptor,qc=function(e){if(!EE)return jo[e];var t=la(jo,e);return t&&t.value},cd=function(){this.head=null,this.tail=null};cd.prototype={add:function(e){var t={item:e,next:null},i=this.tail;i?i.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Pr,zu,Ku,ld,Yu,Ys=cd,Zr=/ipad|iphone|ipod/i.test(dr)&&typeof Pebble<"u",Fo=/web0s(?!.*chrome)/i.test(dr),Ua=ue,dd=qc,nf=Ia,qu=xa.set,bv=Ys,Xu=ef,gE=Zr,Jn=Fo,af=Bs,Pn=Ua.MutationObserver||Ua.WebKitMutationObserver,SE=Ua.document,TE=Ua.process,sf=Ua.Promise,us=dd("queueMicrotask");if(!us){var Xc=new bv,ud=function(){var e,t;for(af&&(e=TE.domain)&&e.exit();t=Xc.get();)try{t()}catch(i){throw Xc.head&&Pr(),i}e&&e.enter()};Xu||af||Jn||!Pn||!SE?!gE&&sf&&sf.resolve?((ld=sf.resolve(void 0)).constructor=sf,Yu=nf(ld.then,ld),Pr=function(){Yu(ud)}):af?Pr=function(){TE.nextTick(ud)}:(qu=nf(qu,Ua),Pr=function(){qu(ud)}):(zu=!0,Ku=SE.createTextNode(""),new Pn(ud).observe(Ku,{characterData:!0}),Pr=function(){Ku.data=zu=!zu}),us=function(e){Xc.head||Pr(),Xc.add(e)}}var Jc=us,Zc=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Go=ue.Promise,Av=ue,Qc=Go,vE=Qe,MC=su,xC=Jp,UC=Li,RE=Fl,of=es,$c=Qc&&Qc.prototype,cf=UC("species"),yE=vE(Av.PromiseRejectionEvent),wv=MC("Promise",function(){var e=xC(Qc),t=e!==String(Qc);if(!t&&of===66||!$c.catch||!$c.finally)return!0;if(!of||of<51||!/native code/.test(e)){var i=new Qc(function(n){n(1)}),r=function(n){n(function(){},function(){})};if((i.constructor={})[cf]=r,!(i.then(function(){})instanceof r))return!0}return!(t||RE!=="BROWSER"&&RE!=="DENO"||yE)}),hd={CONSTRUCTOR:wv,REJECTION_EVENT:yE},Va={},CE=ur,Iv=TypeError,lf=function(e){var t,i;this.promise=new e(function(r,n){if(t!==void 0||i!==void 0)throw new Iv("Bad Promise constructor");t=r,i=n}),this.resolve=CE(t),this.reject=CE(i)};Va.f=function(e){return new lf(e)};var df,bE,Vi=Vt,pd=Bs,Ho=ue,fd=We,VC=Nr,BC=La,jC=function(e){var t=DC(e);fv&&t&&!t[ad]&&PC(t,ad,{configurable:!0,get:function(){return this}})},uf=ur,Wo=Qe,AE=Yr,hf=Xp,wE=$p,zo=xa.set,da=Jc,Ju=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},FC=Zc,Ov=Ys,IE=Pa,pf=Go,OE=hd,Nv=Va,md="Promise",NE=OE.CONSTRUCTOR,Dv=OE.REJECTION_EVENT,DE=IE.getterFor(md),PE=IE.set,LE=pf&&pf.prototype,Zu=pf,kE=LE,_d=Ho.TypeError,ME=Ho.document,ff=Ho.process,Xt=Nv.f,xE=Xt,mf=!!(ME&&ME.createEvent&&Ho.dispatchEvent),_f="unhandledrejection",UE=function(e){var t;return!(!AE(e)||!Wo(t=e.then))&&t},Ef=function(e,t){var i,r,n,s=t.value,c=t.state===1,l=c?e.ok:e.fail,d=e.resolve,h=e.reject,p=e.domain;try{l?(c||(t.rejection===2&&GC(t),t.rejection=1),l===!0?i=s:(p&&p.enter(),i=l(s),p&&(p.exit(),n=!0)),i===e.promise?h(new _d("Promise-chain cycle")):(r=UE(i))?fd(r,i,d,h):d(i)):h(s)}catch(_){p&&!n&&p.exit(),h(_)}},Ed=function(e,t){e.notified||(e.notified=!0,da(function(){for(var i,r=e.reactions;i=r.get();)Ef(i,e);e.notified=!1,t&&!e.rejection&&gd(e)}))},Qu=function(e,t,i){var r,n;mf?((r=ME.createEvent("Event")).promise=t,r.reason=i,r.initEvent(e,!1,!0),Ho.dispatchEvent(r)):r={promise:t,reason:i},!Dv&&(n=Ho["on"+e])?n(r):e===_f&&Ju("Unhandled promise rejection",i)},gd=function(e){fd(zo,Ho,function(){var t,i=e.facade,r=e.value;if(VE(e)&&(t=FC(function(){pd?ff.emit("unhandledRejection",r,i):Qu(_f,i,r)}),e.rejection=pd||VE(e)?2:1,t.error))throw t.value})},VE=function(e){return e.rejection!==1&&!e.parent},GC=function(e){fd(zo,Ho,function(){var t=e.facade;pd?ff.emit("rejectionHandled",t):Qu("rejectionhandled",t,e.value)})},Sd=function(e,t,i){return function(r){e(t,r,i)}},el=function(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,Ed(e,!0))},gf=function(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw new _d("Promise can't be resolved itself");var r=UE(t);r?da(function(){var n={done:!1};try{fd(r,t,Sd(gf,n,e),Sd(el,n,e))}catch(s){el(n,s,e)}}):(e.value=t,e.state=1,Ed(e,!1))}catch(n){el({done:!1},n,e)}}};NE&&(kE=(Zu=function(e){hf(this,kE),uf(e),fd(df,this);var t=DE(this);try{e(Sd(gf,t),Sd(el,t))}catch(i){el(t,i)}}).prototype,(df=function(e){PE(this,{type:md,done:!1,notified:!1,parent:!1,reactions:new Ov,rejection:!1,state:0,value:null})}).prototype=VC(kE,"then",function(e,t){var i=DE(this),r=Xt(wE(this,Zu));return i.parent=!0,r.ok=!Wo(e)||e,r.fail=Wo(t)&&t,r.domain=pd?ff.domain:void 0,i.state===0?i.reactions.add(r):da(function(){Ef(r,i)}),r.promise}),bE=function(){var e=new df,t=DE(e);this.promise=e,this.resolve=Sd(gf,t),this.reject=Sd(el,t)},Nv.f=Xt=function(e){return e===Zu||e===void 0?new bE(e):xE(e)}),Vi({global:!0,wrap:!0,forced:NE},{Promise:Zu}),BC(Zu,md,!1,!0),jC(md);var $u=Li("iterator"),Ii=!1;try{var BE=0,Gr={next:function(){return{done:!!BE++}},return:function(){Ii=!0}};Gr[$u]=function(){return this},Array.from(Gr,function(){throw 2})}catch{}var HC=Go,jE=function(e,t){try{if(!t&&!Ii)return!1}catch{return!1}var i=!1;try{var r={};r[$u]=function(){return{next:function(){return{done:i=!0}}}},e(r)}catch{}return i},Td=hd.CONSTRUCTOR||!jE(function(e){HC.all(e).then(void 0,function(){})}),Sf=We,Pv=ur,Lv=Va,FE=Zc,GE=Jl;Vt({target:"Promise",stat:!0,forced:Td},{all:function(e){var t=this,i=Lv.f(t),r=i.resolve,n=i.reject,s=FE(function(){var c=Pv(t.resolve),l=[],d=0,h=1;GE(e,function(p){var _=d++,E=!1;h++,Sf(c,t,p).then(function(R){E||(E=!0,l[_]=R,--h||r(l))},n)}),--h||r(l)});return s.error&&n(s.value),i.promise}});var WC=Vt,kv=hd.CONSTRUCTOR;Go&&Go.prototype,WC({target:"Promise",proto:!0,forced:kv,real:!0},{catch:function(e){return this.then(void 0,e)}});var zC=We,Mv=ur,KC=Va,YC=Zc,Ko=Jl;Vt({target:"Promise",stat:!0,forced:Td},{race:function(e){var t=this,i=KC.f(t),r=i.reject,n=YC(function(){var s=Mv(t.resolve);Ko(e,function(c){zC(s,t,c).then(i.resolve,r)})});return n.error&&r(n.value),i.promise}});var xv=Va;Vt({target:"Promise",stat:!0,forced:hd.CONSTRUCTOR},{reject:function(e){var t=xv.f(this);return(0,t.reject)(e),t.promise}});var HE=Br,qC=Yr,XC=Va,Tf=function(e,t){if(HE(e),qC(t)&&t.constructor===e)return t;var i=XC.f(e);return(0,i.resolve)(t),i.promise},JC=Vt,Ba=Go,WE=hd.CONSTRUCTOR,Uv=Tf,Vv=qr("Promise"),eh=!WE;JC({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return Uv(eh&&this===Vv?Ba:this,e)}});var ua=We,Bv=ur,vf=Va,qs=Zc,ZC=Jl;Vt({target:"Promise",stat:!0,forced:Td},{allSettled:function(e){var t=this,i=vf.f(t),r=i.resolve,n=i.reject,s=qs(function(){var c=Bv(t.resolve),l=[],d=0,h=1;ZC(e,function(p){var _=d++,E=!1;h++,ua(c,t,p).then(function(R){E||(E=!0,l[_]={status:"fulfilled",value:R},--h||r(l))},function(R){E||(E=!0,l[_]={status:"rejected",reason:R},--h||r(l))})}),--h||r(l)});return s.error&&n(s.value),i.promise}});var QC=We,vd=ur,jv=qr,$C=Va,eb=Zc,tb=Jl,Fv="No one promise resolved";Vt({target:"Promise",stat:!0,forced:Td},{any:function(e){var t=this,i=jv("AggregateError"),r=$C.f(t),n=r.resolve,s=r.reject,c=eb(function(){var l=vd(t.resolve),d=[],h=0,p=1,_=!1;tb(e,function(E){var R=h++,N=!1;p++,QC(l,t,E).then(function(w){N||_||(_=!0,n(w))},function(w){N||_||(N=!0,d[R]=w,--p||s(new i(d,Fv)))})}),--p||s(new i(d,Fv))});return c.error&&s(c.value),r.promise}});var ib=Vt,rb=Oe,nb=En,Gv=Va,Rd=ur,yd=Zc,Rf=ue.Promise,Hv=!1;ib({target:"Promise",stat:!0,forced:!Rf||!Rf.try||yd(function(){Rf.try(function(e){Hv=e===8},8)}).error||!Hv},{try:function(e){var t=arguments.length>1?nb(arguments,1):[],i=Gv.f(this),r=yd(function(){return rb(Rd(e),void 0,t)});return(r.error?i.reject:i.resolve)(r.value),i.promise}});var Cd=Va;Vt({target:"Promise",stat:!0},{withResolvers:function(){var e=Cd.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var th=Vt,yf=Go,Cf=I,zE=qr,KE=Qe,bf=$p,YE=Tf,Wv=yf&&yf.prototype;th({target:"Promise",proto:!0,real:!0,forced:!!yf&&Cf(function(){Wv.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=bf(this,zE("Promise")),i=KE(e);return this.then(i?function(r){return YE(t,e()).then(function(){return r})}:e,i?function(r){return YE(t,e()).then(function(){throw r})}:e)}});var qE=X,zv=Cc,ih=Ir,ab=Ls,sb=qE("".charAt),Kv=qE("".charCodeAt),Af=qE("".slice),rh=function(e){return function(t,i){var r,n,s=ih(ab(t)),c=zv(i),l=s.length;return c<0||c>=l?e?"":void 0:(r=Kv(s,c))<55296||r>56319||c+1===l||(n=Kv(s,c+1))<56320||n>57343?e?sb(s,c):r:e?Af(s,c,c+2):n-56320+(r-55296<<10)+65536}},nh={codeAt:rh(!1),charAt:rh(!0)},ob=nh.charAt,ah=Ir,Yv=Pa,qv=uE,XE=nd,JE="String Iterator",Xv=Yv.set,ZE=Yv.getterFor(JE);qv(String,"String",function(e){Xv(this,{type:JE,string:ah(e),index:0})},function(){var e,t=ZE(this),i=t.string,r=t.index;return r>=i.length?XE(void 0,!0):(e=ob(i,r),t.index+=e.length,XE(e,!1))});var Jv=bn.Promise,wf={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},cb=ue,lb=La,If=Lo;for(var sh in wf)lb(cb[sh],sh),If[sh]=If.Array;var oh=Jv,we=b(oh),Zv=Hn("Array","values"),QE=Vs,Yo=tr,qo=se,Xo=Zv,tl=Array.prototype,ch={DOMTokenList:!0,NodeList:!0},Jo=function(e){var t=e.values;return e===tl||qo(tl,e)&&t===tl.values||Yo(ch,QE(e))?Xo:t},Sn=b(Jo),$E=To,lh=TypeError,Qv=En,$v=Math.floor,bd=function(e,t){var i=e.length;if(i<8)for(var r,n,s=1;s<i;){for(n=s,r=e[s];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==s++&&(e[n]=r)}else for(var c=$v(i/2),l=bd(Qv(e,0,c),t),d=bd(Qv(e,c),t),h=l.length,p=d.length,_=0,E=0;_<h||E<p;)e[_+E]=_<h&&E<p?t(l[_],d[E])<=0?l[_++]:d[E++]:_<h?l[_++]:d[E++];return e},eg=bd,e0=dr.match(/firefox\/(\d+)/i),Of=!!e0&&+e0[1],Nf=/MSIE|Trident/.test(dr),tg=dr.match(/AppleWebKit\/(\d+)\./),dh=!!tg&&+tg[1],ig=Vt,uh=X,t0=ur,db=wa,hh=yo,a=function(e,t){if(!delete e[t])throw new lh("Cannot delete property "+$E(t)+" of "+$E(e))},o=Ir,u=I,f=eg,v=wc,C=Of,j=Nf,W=es,ee=dh,_e=[],De=uh(_e.sort),Ve=uh(_e.push),Re=u(function(){_e.sort(void 0)}),Ce=u(function(){_e.sort(null)}),Dt=v("sort"),Rt=!u(function(){if(W)return W<70;if(!(C&&C>3)){if(j)return!0;if(ee)return ee<603;var e,t,i,r,n="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(r=0;r<47;r++)_e.push({k:t+r,v:i})}for(_e.sort(function(s,c){return c.v-s.v}),r=0;r<_e.length;r++)t=_e[r].k.charAt(0),n.charAt(n.length-1)!==t&&(n+=t);return n!=="DGBEFHACIJK"}});ig({target:"Array",proto:!0,forced:Re||!Ce||!Dt||!Rt},{sort:function(e){e!==void 0&&t0(e);var t=db(this);if(Rt)return e===void 0?De(t):De(t,e);var i,r,n=[],s=hh(t);for(r=0;r<s;r++)r in t&&Ve(n,t[r]);for(f(n,(function(c){return function(l,d){return d===void 0?-1:l===void 0?1:c!==void 0?+c(l,d)||0:o(l)>o(d)?1:-1}})(e)),i=hh(n),r=0;r<i;)t[r]=n[r++];for(;r<s;)a(t,r++);return t}});var Mi=Hn("Array","sort"),pe=se,le=Mi,Ee=Array.prototype,Me=function(e){var t=e.sort;return e===Ee||pe(Ee,e)&&t===Ee.sort?le:t},ct=b(Me),ti=Vt,mt=X,wt=_p,Hr=RangeError,hi=String.fromCharCode,Xs=String.fromCodePoint,ub=mt([].join);ti({target:"String",stat:!0,forced:!!Xs&&Xs.length!==1},{fromCodePoint:function(e){for(var t,i=[],r=arguments.length,n=0;r>n;){if(t=+arguments[n++],wt(t,1114111)!==t)throw new Hr(t+" is not a valid code point");i[n]=t<65536?hi(t):hi(55296+((t-=65536)>>10),t%1024+56320)}return ub(i,"")}});var V5=I,B5=Li("iterator"),i0=!V5(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,i=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach(function(n,s){t.delete("b"),r+=s+n}),i.delete("a",2),i.delete("b",void 0),!e.toJSON||!i.has("a",1)||i.has("a",2)||!i.has("a",void 0)||i.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[B5]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||r!=="a1c3"||new URL("https://x",void 0).host!=="x"}),j5=Nr,hb=Vt,xO=ue,pb=qc,F5=qr,r0=We,Js=X,rg=ii,UO=i0,VO=Nr,G5=Gi,H5=function(e,t,i){for(var r in t)i&&i.unsafe&&e[r]?e[r]=t[r]:j5(e,r,t[r],i);return e},W5=La,z5=zp,fb=Pa,BO=Xp,mb=Qe,K5=tr,Y5=Ia,q5=Vs,X5=Br,jO=Yr,Zn=Ir,J5=Bc,FO=ft,GO=Cu,Z5=Xl,n0=nd,Df=Dn,Q5=eg,$5=Li("iterator"),Pf="URLSearchParams",HO=Pf+"Iterator",WO=fb.set,hs=fb.getterFor(Pf),e4=fb.getterFor(HO),zO=pb("fetch"),a0=pb("Request"),ng=pb("Headers"),_b=a0&&a0.prototype,KO=ng&&ng.prototype,t4=xO.TypeError,i4=xO.encodeURIComponent,r4=String.fromCharCode,n4=F5("String","fromCodePoint"),a4=parseInt,s0=Js("".charAt),YO=Js([].join),Ad=Js([].push),qO=Js("".replace),s4=Js([].shift),XO=Js([].splice),JO=Js("".split),ZO=Js("".slice),o4=Js(/./.exec),c4=/\+/g,l4=/^[0-9a-f]+$/i,QO=function(e,t){var i=ZO(e,t,t+2);return o4(l4,i)?a4(i,16):NaN},d4=function(e){for(var t=0,i=128;i>0&&e&i;i>>=1)t++;return t},u4=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},$O=function(e){for(var t=(e=qO(e,c4," ")).length,i="",r=0;r<t;){var n=s0(e,r);if(n==="%"){if(s0(e,r+1)==="%"||r+3>t){i+="%",r++;continue}var s=QO(e,r+1);if(s!=s){i+=n,r++;continue}r+=2;var c=d4(s);if(c===0)n=r4(s);else{if(c===1||c>4){i+="",r++;continue}for(var l=[s],d=1;d<c&&!(++r+3>t||s0(e,r)!=="%");){var h=QO(e,r+1);if(h!=h){r+=3;break}if(h>191||h<128)break;Ad(l,h),r+=2,d++}if(l.length!==c){i+="";continue}var p=u4(l);p===null?i+="":n=n4(p)}}i+=n,r++}return i},h4=/[!'()~]|%20/g,p4={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},f4=function(e){return p4[e]},eN=function(e){return qO(i4(e),h4,f4)},Eb=z5(function(e,t){WO(this,{type:HO,target:hs(e).entries,index:0,kind:t})},Pf,function(){var e=e4(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=null,n0(void 0,!0);var r=t[i];switch(e.kind){case"keys":return n0(r.key,!1);case"values":return n0(r.value,!1)}return n0([r.key,r.value],!1)},!0),tN=function(e){this.entries=[],this.url=null,e!==void 0&&(jO(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?s0(e,0)==="?"?ZO(e,1):e:Zn(e)))};tN.prototype={type:Pf,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,i,r,n,s,c,l,d=this.entries,h=Z5(e);if(h)for(i=(t=GO(e,h)).next;!(r=r0(i,t)).done;){if(s=(n=GO(X5(r.value))).next,(c=r0(s,n)).done||(l=r0(s,n)).done||!r0(s,n).done)throw new t4("Expected sequence with length 2");Ad(d,{key:Zn(c.value),value:Zn(l.value)})}else for(var p in e)K5(e,p)&&Ad(d,{key:p,value:Zn(e[p])})},parseQuery:function(e){if(e)for(var t,i,r=this.entries,n=JO(e,"&"),s=0;s<n.length;)(t=n[s++]).length&&(i=JO(t,"="),Ad(r,{key:$O(s4(i)),value:$O(YO(i,"="))}))},serialize:function(){for(var e,t=this.entries,i=[],r=0;r<t.length;)e=t[r++],Ad(i,eN(e.key)+"="+eN(e.value));return YO(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var o0=function(){BO(this,Lf);var e=WO(this,new tN(arguments.length>0?arguments[0]:void 0));rg||(this.size=e.entries.length)},Lf=o0.prototype;if(H5(Lf,{append:function(e,t){var i=hs(this);Df(arguments.length,2),Ad(i.entries,{key:Zn(e),value:Zn(t)}),rg||this.length++,i.updateURL()},delete:function(e){for(var t=hs(this),i=Df(arguments.length,1),r=t.entries,n=Zn(e),s=i<2?void 0:arguments[1],c=s===void 0?s:Zn(s),l=0;l<r.length;){var d=r[l];if(d.key!==n||c!==void 0&&d.value!==c)l++;else if(XO(r,l,1),c!==void 0)break}rg||(this.size=r.length),t.updateURL()},get:function(e){var t=hs(this).entries;Df(arguments.length,1);for(var i=Zn(e),r=0;r<t.length;r++)if(t[r].key===i)return t[r].value;return null},getAll:function(e){var t=hs(this).entries;Df(arguments.length,1);for(var i=Zn(e),r=[],n=0;n<t.length;n++)t[n].key===i&&Ad(r,t[n].value);return r},has:function(e){for(var t=hs(this).entries,i=Df(arguments.length,1),r=Zn(e),n=i<2?void 0:arguments[1],s=n===void 0?n:Zn(n),c=0;c<t.length;){var l=t[c++];if(l.key===r&&(s===void 0||l.value===s))return!0}return!1},set:function(e,t){var i=hs(this);Df(arguments.length,1);for(var r,n=i.entries,s=!1,c=Zn(e),l=Zn(t),d=0;d<n.length;d++)(r=n[d]).key===c&&(s?XO(n,d--,1):(s=!0,r.value=l));s||Ad(n,{key:c,value:l}),rg||(this.size=n.length),i.updateURL()},sort:function(){var e=hs(this);Q5(e.entries,function(t,i){return t.key>i.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,i=hs(this).entries,r=Y5(e,arguments.length>1?arguments[1]:void 0),n=0;n<i.length;)r((t=i[n++]).value,t.key,this)},keys:function(){return new Eb(this,"keys")},values:function(){return new Eb(this,"values")},entries:function(){return new Eb(this,"entries")}},{enumerable:!0}),VO(Lf,$5,Lf.entries,{}),VO(Lf,"toString",function(){return hs(this).serialize()},{enumerable:!0}),rg&&G5(Lf,"size",{get:function(){return hs(this).entries.length},configurable:!0,enumerable:!0}),W5(o0,Pf),hb({global:!0,forced:!UO},{URLSearchParams:o0}),!UO&&mb(ng)){var m4=Js(KO.has),_4=Js(KO.set),iN=function(e){if(jO(e)){var t,i=e.body;if(q5(i)===Pf)return t=e.headers?new ng(e.headers):new ng,m4(t,"content-type")||_4(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),J5(e,{body:FO(0,Zn(i)),headers:FO(0,t)})}return e};if(mb(zO)&&hb({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return zO(e,arguments.length>1?iN(arguments[1]):{})}}),mb(a0)){var gb=function(e){return BO(this,_b),new a0(e,arguments.length>1?iN(arguments[1]):{})};_b.constructor=gb,gb.prototype=_b,hb({global:!0,dontCallGetSet:!0,forced:!0},{Request:gb})}}var ps,E4={URLSearchParams:o0,getState:hs},g4=bn.URLSearchParams,rN=ii,S4=X,T4=We,v4=I,Sb=Kl,R4=kc,y4=He,C4=wa,b4=Aa,kf=Object.assign,nN=Object.defineProperty,A4=S4([].concat),w4=!kf||v4(function(){if(rN&&kf({b:1},kf(nN({},"a",{enumerable:!0,get:function(){nN(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},i=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[i]=7,r.split("").forEach(function(n){t[n]=n}),kf({},e)[i]!==7||Sb(kf({},t)).join("")!==r})?function(e,t){for(var i=C4(e),r=arguments.length,n=1,s=R4.f,c=y4.f;r>n;)for(var l,d=b4(arguments[n++]),h=s?A4(Sb(d),s(d)):Sb(d),p=h.length,_=0;p>_;)l=h[_++],rN&&!T4(c,d,l)||(i[l]=d[l]);return i}:kf,I4=Br,O4=H_,N4=ii,D4=an,P4=ft,Tb=function(e,t,i){N4?D4.f(e,t,P4(0,i)):e[t]=i},L4=Ia,k4=We,M4=wa,x4=function(e,t,i,r){try{return r?t(I4(i)[0],i[1]):t(i)}catch(n){O4(e,"throw",n)}},U4=PT,V4=Fu,B4=yo,aN=Tb,j4=Cu,F4=Xl,sN=Array,ph=X,vb=2147483647,G4=/[^\0-\u007E]/,oN=/[.\u3002\uFF0E\uFF61]/g,cN="Overflow: input needs wider integers to process",lN=RangeError,H4=ph(oN.exec),Mf=Math.floor,Rb=String.fromCharCode,dN=ph("".charCodeAt),uN=ph([].join),wd=ph([].push),W4=ph("".replace),z4=ph("".split),K4=ph("".toLowerCase),hN=function(e){return e+22+75*(e<26)},Y4=function(e,t,i){var r=0;for(e=i?Mf(e/700):e>>1,e+=Mf(e/t);e>455;)e=Mf(e/35),r+=36;return Mf(r+36*e/(e+38))},q4=function(e){var t=[];e=(function(L){for(var M=[],B=0,Y=L.length;B<Y;){var H=dN(L,B++);if(H>=55296&&H<=56319&&B<Y){var G=dN(L,B++);(64512&G)==56320?wd(M,((1023&H)<<10)+(1023&G)+65536):(wd(M,H),B--)}else wd(M,H)}return M})(e);var i,r,n=e.length,s=128,c=0,l=72;for(i=0;i<e.length;i++)(r=e[i])<128&&wd(t,Rb(r));var d=t.length,h=d;for(d&&wd(t,"-");h<n;){var p=vb;for(i=0;i<e.length;i++)(r=e[i])>=s&&r<p&&(p=r);var _=h+1;if(p-s>Mf((vb-c)/_))throw new lN(cN);for(c+=(p-s)*_,s=p,i=0;i<e.length;i++){if((r=e[i])<s&&++c>vb)throw new lN(cN);if(r===s){for(var E=c,R=36;;){var N=R<=l?1:R>=l+26?26:R-l;if(E<N)break;var w=E-N,O=36-N;wd(t,Rb(hN(N+w%O))),E=Mf(w/O),R+=36}wd(t,Rb(hN(E))),l=Y4(c,_,h===d),c=0,h++}}c++,s++}return uN(t,"")},X4=Vt,yb=ii,J4=i0,Cb=ue,pN=Ia,fs=X,c0=Nr,ms=Gi,Z4=Xp,bb=tr,Ab=w4,xf=function(e){var t=M4(e),i=V4(this),r=arguments.length,n=r>1?arguments[1]:void 0,s=n!==void 0;s&&(n=L4(n,r>2?arguments[2]:void 0));var c,l,d,h,p,_,E=F4(t),R=0;if(!E||this===sN&&U4(E))for(c=B4(t),l=i?new this(c):sN(c);c>R;R++)_=s?n(t[R],R):t[R],aN(l,R,_);else for(l=i?new this:[],p=(h=j4(t,E)).next;!(d=k4(p,h)).done;R++)_=s?x4(h,n,[d.value,R],!0):d.value,aN(l,R,_);return l.length=R,l},Zs=En,Q4=nh.codeAt,$4=function(e){var t,i,r=[],n=z4(W4(K4(e),oN,"."),".");for(t=0;t<n.length;t++)i=n[t],wd(r,H4(G4,i)?"xn--"+q4(i):i);return uN(r,".")},il=Ir,eB=La,tB=Dn,fN=E4,mN=Pa,iB=mN.set,l0=mN.getterFor("URL"),rB=fN.URLSearchParams,nB=fN.getState,ag=Cb.URL,wb=Cb.TypeError,d0=Cb.parseInt,aB=Math.floor,_N=Math.pow,_s=fs("".charAt),Qs=fs(/./.exec),sg=fs([].join),sB=fs(1 .toString),oB=fs([].pop),Uf=fs([].push),Ib=fs("".replace),cB=fs([].shift),lB=fs("".split),og=fs("".slice),u0=fs("".toLowerCase),dB=fs([].unshift),Ob="Invalid scheme",cg="Invalid host",EN="Invalid port",gN=/[a-z]/i,uB=/[\d+-.a-z]/i,Nb=/\d/,hB=/^0x/i,pB=/^[0-7]+$/,fB=/^\d+$/,SN=/^[\da-f]+$/i,mB=/[\0\t\n\r #%/:<>?@[\\\]^|]/,_B=/[\0\t\n\r #/:<>?@[\\\]^|]/,EB=/^[\u0000-\u0020]+/,gB=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,SB=/[\t\n\r]/g,lg=function(e){var t,i,r,n;if(typeof e=="number"){for(t=[],i=0;i<4;i++)dB(t,e%256),e=aB(e/256);return sg(t,".")}if(typeof e=="object"){for(t="",r=(function(s){for(var c=null,l=1,d=null,h=0,p=0;p<8;p++)s[p]!==0?(h>l&&(c=d,l=h),d=null,h=0):(d===null&&(d=p),++h);return h>l?d:c})(e),i=0;i<8;i++)n&&e[i]===0||(n&&(n=!1),r===i?(t+=i?":":"::",n=!0):(t+=sB(e[i],16),i<7&&(t+=":")));return"["+t+"]"}return e},h0={},TN=Ab({},h0,{" ":1,'"':1,"<":1,">":1,"`":1}),vN=Ab({},TN,{"#":1,"?":1,"{":1,"}":1}),Db=Ab({},vN,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Id=function(e,t){var i=Q4(e,0);return i>32&&i<127&&!bb(t,e)?e:encodeURIComponent(e)},p0={ftp:21,file:null,http:80,https:443,ws:80,wss:443},dg=function(e,t){var i;return e.length===2&&Qs(gN,_s(e,0))&&((i=_s(e,1))===":"||!t&&i==="|")},RN=function(e){var t;return e.length>1&&dg(og(e,0,2))&&(e.length===2||(t=_s(e,2))==="/"||t==="\\"||t==="?"||t==="#")},TB=function(e){return e==="."||u0(e)==="%2e"},Pb={},yN={},Lb={},CN={},bN={},kb={},AN={},wN={},f0={},m0={},Mb={},xb={},Ub={},Vb={},IN={},Bb={},Vf={},Zo={},ON={},fh={},rl={},jb=function(e,t,i){var r,n,s,c=il(e);if(t){if(n=this.parse(c))throw new wb(n);this.searchParams=null}else{if(i!==void 0&&(r=new jb(i,!0)),n=this.parse(c,null,r))throw new wb(n);(s=nB(new rB)).bindURL(this),this.searchParams=s}};jb.prototype={type:"URL",parse:function(e,t,i){var r,n,s,c,l,d=this,h=t||Pb,p=0,_="",E=!1,R=!1,N=!1;for(e=il(e),t||(d.scheme="",d.username="",d.password="",d.host=null,d.port=null,d.path=[],d.query=null,d.fragment=null,d.cannotBeABaseURL=!1,e=Ib(e,EB,""),e=Ib(e,gB,"$1")),e=Ib(e,SB,""),r=xf(e);p<=r.length;){switch(n=r[p],h){case Pb:if(!n||!Qs(gN,n)){if(t)return Ob;h=Lb;continue}_+=u0(n),h=yN;break;case yN:if(n&&(Qs(uB,n)||n==="+"||n==="-"||n==="."))_+=u0(n);else{if(n!==":"){if(t)return Ob;_="",h=Lb,p=0;continue}if(t&&(d.isSpecial()!==bb(p0,_)||_==="file"&&(d.includesCredentials()||d.port!==null)||d.scheme==="file"&&!d.host))return;if(d.scheme=_,t)return void(d.isSpecial()&&p0[d.scheme]===d.port&&(d.port=null));_="",d.scheme==="file"?h=Vb:d.isSpecial()&&i&&i.scheme===d.scheme?h=CN:d.isSpecial()?h=wN:r[p+1]==="/"?(h=bN,p++):(d.cannotBeABaseURL=!0,Uf(d.path,""),h=ON)}break;case Lb:if(!i||i.cannotBeABaseURL&&n!=="#")return Ob;if(i.cannotBeABaseURL&&n==="#"){d.scheme=i.scheme,d.path=Zs(i.path),d.query=i.query,d.fragment="",d.cannotBeABaseURL=!0,h=rl;break}h=i.scheme==="file"?Vb:kb;continue;case CN:if(n!=="/"||r[p+1]!=="/"){h=kb;continue}h=f0,p++;break;case bN:if(n==="/"){h=m0;break}h=Zo;continue;case kb:if(d.scheme=i.scheme,n===ps)d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,d.path=Zs(i.path),d.query=i.query;else if(n==="/"||n==="\\"&&d.isSpecial())h=AN;else if(n==="?")d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,d.path=Zs(i.path),d.query="",h=fh;else{if(n!=="#"){d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,d.path=Zs(i.path),d.path.length--,h=Zo;continue}d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,d.path=Zs(i.path),d.query=i.query,d.fragment="",h=rl}break;case AN:if(!d.isSpecial()||n!=="/"&&n!=="\\"){if(n!=="/"){d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,h=Zo;continue}h=m0}else h=f0;break;case wN:if(h=f0,n!=="/"||_s(_,p+1)!=="/")continue;p++;break;case f0:if(n!=="/"&&n!=="\\"){h=m0;continue}break;case m0:if(n==="@"){E&&(_="%40"+_),E=!0,s=xf(_);for(var w=0;w<s.length;w++){var O=s[w];if(O!==":"||N){var L=Id(O,Db);N?d.password+=L:d.username+=L}else N=!0}_=""}else if(n===ps||n==="/"||n==="?"||n==="#"||n==="\\"&&d.isSpecial()){if(E&&_==="")return"Invalid authority";p-=xf(_).length+1,_="",h=Mb}else _+=n;break;case Mb:case xb:if(t&&d.scheme==="file"){h=Bb;continue}if(n!==":"||R){if(n===ps||n==="/"||n==="?"||n==="#"||n==="\\"&&d.isSpecial()){if(d.isSpecial()&&_==="")return cg;if(t&&_===""&&(d.includesCredentials()||d.port!==null))return;if(c=d.parseHost(_))return c;if(_="",h=Vf,t)return;continue}n==="["?R=!0:n==="]"&&(R=!1),_+=n}else{if(_==="")return cg;if(c=d.parseHost(_))return c;if(_="",h=Ub,t===xb)return}break;case Ub:if(!Qs(Nb,n)){if(n===ps||n==="/"||n==="?"||n==="#"||n==="\\"&&d.isSpecial()||t){if(_!==""){var M=d0(_,10);if(M>65535)return EN;d.port=d.isSpecial()&&M===p0[d.scheme]?null:M,_=""}if(t)return;h=Vf;continue}return EN}_+=n;break;case Vb:if(d.scheme="file",n==="/"||n==="\\")h=IN;else{if(!i||i.scheme!=="file"){h=Zo;continue}switch(n){case ps:d.host=i.host,d.path=Zs(i.path),d.query=i.query;break;case"?":d.host=i.host,d.path=Zs(i.path),d.query="",h=fh;break;case"#":d.host=i.host,d.path=Zs(i.path),d.query=i.query,d.fragment="",h=rl;break;default:RN(sg(Zs(r,p),""))||(d.host=i.host,d.path=Zs(i.path),d.shortenPath()),h=Zo;continue}}break;case IN:if(n==="/"||n==="\\"){h=Bb;break}i&&i.scheme==="file"&&!RN(sg(Zs(r,p),""))&&(dg(i.path[0],!0)?Uf(d.path,i.path[0]):d.host=i.host),h=Zo;continue;case Bb:if(n===ps||n==="/"||n==="\\"||n==="?"||n==="#"){if(!t&&dg(_))h=Zo;else if(_===""){if(d.host="",t)return;h=Vf}else{if(c=d.parseHost(_))return c;if(d.host==="localhost"&&(d.host=""),t)return;_="",h=Vf}continue}_+=n;break;case Vf:if(d.isSpecial()){if(h=Zo,n!=="/"&&n!=="\\")continue}else if(t||n!=="?")if(t||n!=="#"){if(n!==ps&&(h=Zo,n!=="/"))continue}else d.fragment="",h=rl;else d.query="",h=fh;break;case Zo:if(n===ps||n==="/"||n==="\\"&&d.isSpecial()||!t&&(n==="?"||n==="#")){if((l=u0(l=_))===".."||l==="%2e."||l===".%2e"||l==="%2e%2e"?(d.shortenPath(),n==="/"||n==="\\"&&d.isSpecial()||Uf(d.path,"")):TB(_)?n==="/"||n==="\\"&&d.isSpecial()||Uf(d.path,""):(d.scheme==="file"&&!d.path.length&&dg(_)&&(d.host&&(d.host=""),_=_s(_,0)+":"),Uf(d.path,_)),_="",d.scheme==="file"&&(n===ps||n==="?"||n==="#"))for(;d.path.length>1&&d.path[0]==="";)cB(d.path);n==="?"?(d.query="",h=fh):n==="#"&&(d.fragment="",h=rl)}else _+=Id(n,vN);break;case ON:n==="?"?(d.query="",h=fh):n==="#"?(d.fragment="",h=rl):n!==ps&&(d.path[0]+=Id(n,h0));break;case fh:t||n!=="#"?n!==ps&&(n==="'"&&d.isSpecial()?d.query+="%27":d.query+=n==="#"?"%23":Id(n,h0)):(d.fragment="",h=rl);break;case rl:n!==ps&&(d.fragment+=Id(n,TN))}p++}},parseHost:function(e){var t,i,r;if(_s(e,0)==="["){if(_s(e,e.length-1)!=="]"||(t=(function(n){var s,c,l,d,h,p,_,E=[0,0,0,0,0,0,0,0],R=0,N=null,w=0,O=function(){return _s(n,w)};if(O()===":"){if(_s(n,1)!==":")return;w+=2,N=++R}for(;O();){if(R===8)return;if(O()!==":"){for(s=c=0;c<4&&Qs(SN,O());)s=16*s+d0(O(),16),w++,c++;if(O()==="."){if(c===0||(w-=c,R>6))return;for(l=0;O();){if(d=null,l>0){if(!(O()==="."&&l<4))return;w++}if(!Qs(Nb,O()))return;for(;Qs(Nb,O());){if(h=d0(O(),10),d===null)d=h;else{if(d===0)return;d=10*d+h}if(d>255)return;w++}E[R]=256*E[R]+d,++l!=2&&l!==4||R++}if(l!==4)return;break}if(O()===":"){if(w++,!O())return}else if(O())return;E[R++]=s}else{if(N!==null)return;w++,N=++R}}if(N!==null)for(p=R-N,R=7;R!==0&&p>0;)_=E[R],E[R--]=E[N+p-1],E[N+--p]=_;else if(R!==8)return;return E})(og(e,1,-1)),!t))return cg;this.host=t}else if(this.isSpecial()){if(e=$4(e),Qs(mB,e)||(t=(function(n){var s,c,l,d,h,p,_,E=lB(n,".");if(E.length&&E[E.length-1]===""&&E.length--,(s=E.length)>4)return n;for(c=[],l=0;l<s;l++){if((d=E[l])==="")return n;if(h=10,d.length>1&&_s(d,0)==="0"&&(h=Qs(hB,d)?16:8,d=og(d,h===8?1:2)),d==="")p=0;else{if(!Qs(h===10?fB:h===8?pB:SN,d))return n;p=d0(d,h)}Uf(c,p)}for(l=0;l<s;l++)if(p=c[l],l===s-1){if(p>=_N(256,5-s))return null}else if(p>255)return null;for(_=oB(c),l=0;l<c.length;l++)_+=c[l]*_N(256,3-l);return _})(e),t===null))return cg;this.host=t}else{if(Qs(_B,e))return cg;for(t="",i=xf(e),r=0;r<i.length;r++)t+=Id(i[r],h0);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return bb(p0,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&dg(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,i=e.username,r=e.password,n=e.host,s=e.port,c=e.path,l=e.query,d=e.fragment,h=t+":";return n!==null?(h+="//",e.includesCredentials()&&(h+=i+(r?":"+r:"")+"@"),h+=lg(n),s!==null&&(h+=":"+s)):t==="file"&&(h+="//"),h+=e.cannotBeABaseURL?c[0]:c.length?"/"+sg(c,"/"):"",l!==null&&(h+="?"+l),d!==null&&(h+="#"+d),h},setHref:function(e){var t=this.parse(e);if(t)throw new wb(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new Bf(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+lg(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(il(e)+":",Pb)},getUsername:function(){return this.username},setUsername:function(e){var t=xf(il(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<t.length;i++)this.username+=Id(t[i],Db)}},getPassword:function(){return this.password},setPassword:function(e){var t=xf(il(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<t.length;i++)this.password+=Id(t[i],Db)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?lg(e):lg(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Mb)},getHostname:function(){var e=this.host;return e===null?"":lg(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,xb)},getPort:function(){var e=this.port;return e===null?"":il(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=il(e))===""?this.port=null:this.parse(e,Ub))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+sg(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Vf))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=il(e))===""?this.query=null:(_s(e,0)==="?"&&(e=og(e,1)),this.query="",this.parse(e,fh)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=il(e))!==""?(_s(e,0)==="#"&&(e=og(e,1)),this.fragment="",this.parse(e,rl)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Bf=function(e){var t=Z4(this,Qn),i=tB(arguments.length,1)>1?arguments[1]:void 0,r=iB(t,new jb(e,!1,i));yb||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},Qn=Bf.prototype,Es=function(e,t){return{get:function(){return l0(this)[e]()},set:t&&function(i){return l0(this)[t](i)},configurable:!0,enumerable:!0}};if(yb&&(ms(Qn,"href",Es("serialize","setHref")),ms(Qn,"origin",Es("getOrigin")),ms(Qn,"protocol",Es("getProtocol","setProtocol")),ms(Qn,"username",Es("getUsername","setUsername")),ms(Qn,"password",Es("getPassword","setPassword")),ms(Qn,"host",Es("getHost","setHost")),ms(Qn,"hostname",Es("getHostname","setHostname")),ms(Qn,"port",Es("getPort","setPort")),ms(Qn,"pathname",Es("getPathname","setPathname")),ms(Qn,"search",Es("getSearch","setSearch")),ms(Qn,"searchParams",Es("getSearchParams")),ms(Qn,"hash",Es("getHash","setHash"))),c0(Qn,"toJSON",function(){return l0(this).serialize()},{enumerable:!0}),c0(Qn,"toString",function(){return l0(this).serialize()},{enumerable:!0}),ag){var NN=ag.createObjectURL,DN=ag.revokeObjectURL;NN&&c0(Bf,"createObjectURL",pN(NN,ag)),DN&&c0(Bf,"revokeObjectURL",pN(DN,ag))}eB(Bf,"URL"),X4({global:!0,forced:!J4,sham:!yb},{URL:Bf});var vB=Vt,PN=I,RB=Dn,LN=Ir,yB=i0,Fb=qr("URL"),CB=yB&&PN(function(){Fb.canParse()}),bB=PN(function(){return Fb.canParse.length!==1});vB({target:"URL",stat:!0,forced:!CB||bB},{canParse:function(e){var t=RB(arguments.length,1),i=LN(e),r=t<2||arguments[1]===void 0?void 0:LN(arguments[1]);try{return!!new Fb(i,r)}catch{return!1}}});var AB=Vt,wB=Dn,kN=Ir,IB=i0,OB=qr("URL");AB({target:"URL",stat:!0,forced:!IB},{parse:function(e){var t=wB(arguments.length,1),i=kN(e),r=t<2||arguments[1]===void 0?void 0:kN(arguments[1]);try{return new OB(i,r)}catch{return null}}});var _0=b(bn.URL);let MN=!0,xN=!0;function E0(e,t,i){let r=e.match(t);return r&&r.length>=i&&parseInt(r[i],10)}function mh(e,t,i){if(!e.RTCPeerConnection)return;let r=e.RTCPeerConnection.prototype,n=r.addEventListener;r.addEventListener=function(c,l){if(c!==t)return n.apply(this,arguments);let d=h=>{let p=i(h);p&&(l.handleEvent?l.handleEvent(p):l(p))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(l,d),n.apply(this,[c,d])};let s=r.removeEventListener;r.removeEventListener=function(c,l){if(c!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(l))return s.apply(this,arguments);let d=this._eventMap[t].get(l);return this._eventMap[t].delete(l),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[c,d])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(c){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),c&&this.addEventListener(t,this["_on"+t]=c)},enumerable:!0,configurable:!0})}function NB(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(MN=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function DB(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(xN=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function UN(){if(typeof window=="object"){if(MN)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Gb(e,t){xN&&console.warn(e+" is deprecated, please use "+t+" instead.")}function VN(e){return Object.prototype.toString.call(e)==="[object Object]"}function BN(e){var t;return VN(e)?In(t=Object.keys(e)).call(t,function(i,r){let n=VN(e[r]),s=n?BN(e[r]):e[r],c=n&&!Object.keys(s).length;return s===void 0||c?i:Object.assign(i,{[r]:s})},{}):e}function Hb(e,t,i){t&&!i.has(t.id)&&(i.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?Hb(e,e.get(t[r]),i):r.endsWith("Ids")&&t[r].forEach(n=>{Hb(e,e.get(n),i)})}))}function jN(e,t,i){let r=i?"outbound-rtp":"inbound-rtp",n=new Map;if(t===null)return n;let s=[];return e.forEach(c=>{c.type==="track"&&c.trackIdentifier===t.id&&s.push(c)}),s.forEach(c=>{e.forEach(l=>{l.type===r&&l.trackId===c.id&&Hb(e,l,n)})}),n}let FN=UN;function GN(e,t){let i=e&&e.navigator;if(!i.mediaDevices)return;let r=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;let l={};return Object.keys(c).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;let h=typeof c[d]=="object"?c[d]:{ideal:c[d]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);let p=function(_,E){return _?_+E.charAt(0).toUpperCase()+E.slice(1):E==="deviceId"?"sourceId":E};if(h.ideal!==void 0){l.optional=l.optional||[];let _={};typeof h.ideal=="number"?(_[p("min",d)]=h.ideal,l.optional.push(_),_={},_[p("max",d)]=h.ideal,l.optional.push(_)):(_[p("",d)]=h.ideal,l.optional.push(_))}h.exact!==void 0&&typeof h.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[p("",d)]=h.exact):["min","max"].forEach(_=>{h[_]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[p(_,d)]=h[_])})}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},n=function(c,l){if(t.version>=61)return l(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){let d=function(h,p,_){p in h&&!(_ in h)&&(h[_]=h[p],delete h[p])};d((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),d(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=r(c.audio)}if(c&&typeof c.video=="object"){let d=c.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});let h=t.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||h)){let p;if(delete c.video.facingMode,d.exact==="environment"||d.ideal==="environment"?p=["back","rear"]:d.exact!=="user"&&d.ideal!=="user"||(p=["front"]),p)return i.mediaDevices.enumerateDevices().then(_=>{_=_.filter(R=>R.kind==="videoinput");let E=_.find(R=>p.some(N=>{var w;return ve(w=R.label.toLowerCase()).call(w,N)}));return!E&&_.length&&ve(p).call(p,"back")&&(E=_[_.length-1]),E&&(c.video.deviceId=d.exact?{exact:E.deviceId}:{ideal:E.deviceId}),c.video=r(c.video),FN("chrome: "+JSON.stringify(c)),l(c)})}c.video=r(c.video)}return FN("chrome: "+JSON.stringify(c)),l(c)},s=function(c){return t.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(c,l,d){n(c,h=>{i.webkitGetUserMedia(h,l,p=>{d&&d(s(p))})})}).bind(i),i.mediaDevices.getUserMedia){let c=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(l){return n(l,d=>c(d).then(h=>{if(d.audio&&!h.getAudioTracks().length||d.video&&!h.getVideoTracks().length)throw h.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return h},h=>we.reject(s(h))))}}}function HN(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function WN(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===r.track.id):{track:r.track};let s=new Event("track");s.track=r.track,s.receiver=n,s.transceiver={receiver:n},s.streams=[i.stream],this.dispatchEvent(s)}),i.stream.getTracks().forEach(r=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===r.id):{track:r};let s=new Event("track");s.track=r,s.receiver=n,s.transceiver={receiver:n},s.streams=[i.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else mh(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function zN(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(n,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=n.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:n}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(c,l){let d=n.apply(this,arguments);return d||(d=t(this,c),this._senders.push(d)),d};let s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(c){s.apply(this,arguments);let l=this._senders.indexOf(c);l!==-1&&this._senders.splice(l,1)}}let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(n){this._senders=this._senders||[],i.apply(this,[n]),n.getTracks().forEach(s=>{this._senders.push(t(this,s))})};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(n){this._senders=this._senders||[],r.apply(this,[n]),n.getTracks().forEach(s=>{let c=this._senders.find(l=>l.track===s);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let i=t.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function KN(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[i,r,n]=arguments;if(arguments.length>0&&typeof i=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof i!="function"))return t.apply(this,[]);let s=function(l){let d={};return l.result().forEach(h=>{let p={id:h.id,timestamp:h.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type};h.names().forEach(_=>{p[_]=h.stat(_)}),d[p.id]=p}),d},c=function(l){return new Map(Object.keys(l).map(d=>[d,l[d]]))};if(arguments.length>=2){let l=function(d){r(c(s(d)))};return t.apply(this,[l,i])}return new we((l,d)=>{t.apply(this,[function(h){l(c(s(h)))},d])}).then(r,n)}}function YN(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){let n=i.apply(this,[]);return n.forEach(s=>s._pc=this),n});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let n=r.apply(this,arguments);return n._pc=this,n}),e.RTCRtpSender.prototype.getStats=function(){let n=this;return this._pc.getStats().then(s=>jN(s,n.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){let r=i.apply(this,[]);return r.forEach(n=>n._pc=this),r}),mh(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){let r=this;return this._pc.getStats().then(n=>jN(n,r.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let i=arguments[0],r,n,s;return this.getSenders().forEach(c=>{c.track===i&&(r?s=!0:r=c)}),this.getReceivers().forEach(c=>(c.track===i&&(n?s=!0:n=c),c.track===i)),s||r&&n?we.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():n?n.getStats():we.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function qN(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,c){if(!c)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let l=t.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(l)===-1&&this._shimmedLocalStreams[c.id].push(l):this._shimmedLocalStreams[c.id]=[c,l],l};let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(d=>{if(this.getSenders().find(h=>h.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});let c=this.getSenders();i.apply(this,arguments);let l=this.getSenders().filter(d=>c.indexOf(d)===-1);this._shimmedLocalStreams[s.id]=[s].concat(l)};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],r.apply(this,arguments)};let n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(c=>{let l=this._shimmedLocalStreams[c].indexOf(s);l!==-1&&this._shimmedLocalStreams[c].splice(l,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),n.apply(this,arguments)}}function XN(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return qN(e);let i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let d=i.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(h=>this._reverseStreams[h.id])};let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(h=>{if(this.getSenders().find(p=>p.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){let h=new e.MediaStream(d.getTracks());this._streams[d.id]=h,this._reverseStreams[h.id]=d,d=h}r.apply(this,[d])};let n=e.RTCPeerConnection.prototype.removeStream;function s(d,h){let p=h.sdp;return Object.keys(d._reverseStreams||[]).forEach(_=>{let E=d._reverseStreams[_],R=d._streams[E.id];p=p.replace(new RegExp(R.id,"g"),E.id)}),new RTCSessionDescription({type:h.type,sdp:p})}e.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},e.RTCPeerConnection.prototype.addTrack=function(d,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(E=>E===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(E=>E.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let _=this._streams[h.id];if(_)_.addTrack(d),we.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let E=new e.MediaStream([d]);this._streams[h.id]=E,this._reverseStreams[E.id]=h,this.addStream(E)}return this.getSenders().find(E=>E.track===d)},["createOffer","createAnswer"].forEach(function(d){let h=e.RTCPeerConnection.prototype[d],p={[d](){let _=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[E=>{let R=s(this,E);_[0].apply(null,[R])},E=>{_[1]&&_[1].apply(null,E)},arguments[2]]):h.apply(this,arguments).then(E=>s(this,E))}};e.RTCPeerConnection.prototype[d]=p[d]});let c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(d,h){let p=h.sdp;return Object.keys(d._reverseStreams||[]).forEach(_=>{let E=d._reverseStreams[_],R=d._streams[E.id];p=p.replace(new RegExp(E.id,"g"),R.id)}),new RTCSessionDescription({type:h.type,sdp:p})})(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};let l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let d=l.get.apply(this);return d.type===""?d:s(this,d)}}),e.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(d._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let h;this._streams=this._streams||{},Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(_=>d.track===_)&&(h=this._streams[p])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Wb(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){let r=e.RTCPeerConnection.prototype[i],n={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=n[i]})}function JN(e,t){mh(e,"negotiationneeded",i=>{let r=i.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return i})}var ZN=Object.freeze({__proto__:null,fixNegotiationNeeded:JN,shimAddTrackRemoveTrack:XN,shimAddTrackRemoveTrackWithNative:qN,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then(r=>{let n=i.video&&i.video.width,s=i.video&&i.video.height,c=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:c||3}},n&&(i.video.mandatory.maxWidth=n),s&&(i.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:zN,shimGetStats:KN,shimGetUserMedia:GN,shimMediaStream:HN,shimOnTrack:WN,shimPeerConnection:Wb,shimSenderReceiverGetStats:YN});function QN(e,t){let i=e&&e.navigator,r=e&&e.MediaStreamTrack;if(i.getUserMedia=function(n,s,c){Gb("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(n).then(s,c)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){let n=function(c,l,d){l in c&&!(d in c)&&(c[d]=c[l],delete c[l])},s=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),n(c.audio,"autoGainControl","mozAutoGainControl"),n(c.audio,"noiseSuppression","mozNoiseSuppression")),s(c)},r&&r.prototype.getSettings){let c=r.prototype.getSettings;r.prototype.getSettings=function(){let l=c.apply(this,arguments);return n(l,"mozAutoGainControl","autoGainControl"),n(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){let c=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),n(l,"autoGainControl","mozAutoGainControl"),n(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function $N(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function zb(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){let s=e.RTCPeerConnection.prototype[n],c={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=c[n]});let i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[n,s,c]=arguments;return r.apply(this,[n||null]).then(l=>{if(t.version<53&&!s)try{l.forEach(d=>{d.type=i[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;l.forEach((h,p)=>{l.set(p,Object.assign({},h,{type:i[h.type]||h.type}))})}return l}).then(s,c)}}function eD(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let r=t.apply(this,[]);return r.forEach(n=>n._pc=this),r});let i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){let r=i.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):we.resolve(new Map)}}function tD(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let i=t.apply(this,[]);return i.forEach(r=>r._pc=this),i}),mh(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function iD(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){Gb("removeStream","removeTrack"),this.getSenders().forEach(i=>{var r;i.track&&ve(r=t.getTracks()).call(r,i.track)&&this.removeTrack(i)})})}function rD(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function nD(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];let r=i.length>0;r&&i.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let n=t.apply(this,arguments);if(r){let{sender:s}=n,c=s.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=i,s.sendEncodings=i,this.setParametersPromises.push(s.setParameters(c).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return n})}function aD(e){if(typeof e!="object"||!e.RTCRtpSender)return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let i=t.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function sD(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?we.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function oD(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?we.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var cD=Object.freeze({__proto__:null,shimAddTransceiver:nD,shimCreateAnswer:oD,shimCreateOffer:sD,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){let r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,we.reject(r)}return i.video===!0?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:aD,shimGetUserMedia:QN,shimOnTrack:$N,shimPeerConnection:zb,shimRTCDataChannel:rD,shimReceiverGetStats:tD,shimRemoveStream:iD,shimSenderGetStats:eD});function lD(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){var r;this._localStreams||(this._localStreams=[]),ve(r=this._localStreams).call(r,i)||this._localStreams.push(i),i.getAudioTracks().forEach(n=>t.call(this,n,i)),i.getVideoTracks().forEach(n=>t.call(this,n,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];return n&&n.forEach(c=>{var l;this._localStreams?ve(l=this._localStreams).call(l,c)||this._localStreams.push(c):this._localStreams=[c]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);let i=this._localStreams.indexOf(t);if(i===-1)return;this._localStreams.splice(i,1);let r=t.getTracks();this.getSenders().forEach(n=>{ve(r).call(r,n.track)&&this.removeTrack(n)})})}}function dD(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(n=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),ve(s=this._remoteStreams).call(s,n))return;this._remoteStreams.push(n);let c=new Event("addstream");c.stream=n,this.dispatchEvent(c)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(n=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(n)>=0)return;i._remoteStreams.push(n);let s=new Event("addstream");s.stream=n,i.dispatchEvent(s)})}),t.apply(i,arguments)}}}function uD(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,i=t.createOffer,r=t.createAnswer,n=t.setLocalDescription,s=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(d,h){let p=arguments.length>=2?arguments[2]:arguments[0],_=i.apply(this,[p]);return h?(_.then(d,h),we.resolve()):_},t.createAnswer=function(d,h){let p=arguments.length>=2?arguments[2]:arguments[0],_=r.apply(this,[p]);return h?(_.then(d,h),we.resolve()):_};let l=function(d,h,p){let _=n.apply(this,[d]);return p?(_.then(h,p),we.resolve()):_};t.setLocalDescription=l,l=function(d,h,p){let _=s.apply(this,[d]);return p?(_.then(h,p),we.resolve()):_},t.setRemoteDescription=l,l=function(d,h,p){let _=c.apply(this,[d]);return p?(_.then(h,p),we.resolve()):_},t.addIceCandidate=l}function hD(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let i=t.mediaDevices,r=i.getUserMedia.bind(i);t.mediaDevices.getUserMedia=n=>r(pD(n))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(i,r,n){t.mediaDevices.getUserMedia(i).then(r,n)}).bind(t))}function pD(e){return e&&e.video!==void 0?Object.assign({},e,{video:BN(e.video)}):e}function fD(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(i,r){if(i&&i.iceServers){let n=[];for(let s=0;s<i.iceServers.length;s++){let c=i.iceServers[s];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(Gb("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,n.push(c)):n.push(i.iceServers[s])}i.iceServers=n}return new t(i,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function mD(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function _D(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);let r=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);let n=this.getTransceivers().find(s=>s.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):i.offerToReceiveVideo!==!0||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function ED(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var gD=Object.freeze({__proto__:null,shimAudioContext:ED,shimCallbacksAPI:uD,shimConstraints:pD,shimCreateOfferLegacy:_D,shimGetUserMedia:hD,shimLocalStreamsAPI:lD,shimRTCIceServerUrls:fD,shimRemoteStreamsAPI:dD,shimTrackEventTransceiver:mD}),SD=`	
\v\f\r \u2028\u2029\uFEFF`,PB=Ls,LB=Ir,Kb=SD,TD=X("".replace),kB=RegExp("^["+Kb+"]+"),MB=RegExp("(^|[^"+Kb+"])["+Kb+"]+$"),xB=function(e){return function(t){var i=LB(PB(t));return i=TD(i,kB,""),i=TD(i,MB,"$1"),i}},UB={trim:xB()},VB=Hc.PROPER,BB=I,vD=SD,jB=UB.trim;Vt({target:"String",proto:!0,forced:(function(e){return BB(function(){return!!vD[e]()||""[e]()!==""||VB&&vD[e].name!==e})})("trim")},{trim:function(){return jB(this)}});var FB=Hn("String","trim"),GB=se,HB=FB,Yb=String.prototype,WB=function(e){var t=e.trim;return typeof e=="string"||e===Yb||GB(Yb,e)&&t===Yb.trim?HB:t},Qr=b(WB),RD={exports:{}};(function(e){let t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(i){return i.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(i){return i.split(`
m=`).map((r,n)=>(n>0?"m="+r:r).trim()+`\r
`)},t.getDescription=function(i){let r=t.splitSections(i);return r&&r[0]},t.getMediaSections=function(i){let r=t.splitSections(i);return r.shift(),r},t.matchPrefix=function(i,r){return t.splitLines(i).filter(n=>n.indexOf(r)===0)},t.parseCandidate=function(i){let r;r=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");let n={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":n.relatedAddress=r[s+1];break;case"rport":n.relatedPort=parseInt(r[s+1],10);break;case"tcptype":n.tcpType=r[s+1];break;case"ufrag":n.ufrag=r[s+1],n.usernameFragment=r[s+1];break;default:n[r[s]]===void 0&&(n[r[s]]=r[s+1])}return n},t.writeCandidate=function(i){let r=[];r.push(i.foundation);let n=i.component;n==="rtp"?r.push(1):n==="rtcp"?r.push(2):r.push(n),r.push(i.protocol.toUpperCase()),r.push(i.priority),r.push(i.address||i.ip),r.push(i.port);let s=i.type;return r.push("typ"),r.push(s),s!=="host"&&i.relatedAddress&&i.relatedPort&&(r.push("raddr"),r.push(i.relatedAddress),r.push("rport"),r.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(r.push("ufrag"),r.push(i.usernameFragment||i.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(i){return i.substring(14).split(" ")},t.parseRtpMap=function(i){let r=i.substring(9).split(" "),n={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),n.name=r[0],n.clockRate=parseInt(r[1],10),n.channels=r.length===3?parseInt(r[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(i){let r=i.payloadType;i.preferredPayloadType!==void 0&&(r=i.preferredPayloadType);let n=i.channels||i.numChannels||1;return"a=rtpmap:"+r+" "+i.name+"/"+i.clockRate+(n!==1?"/"+n:"")+`\r
`},t.parseExtmap=function(i){let r=i.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},t.parseFmtp=function(i){let r={},n,s=i.substring(i.indexOf(" ")+1).split(";");for(let c=0;c<s.length;c++)n=s[c].trim().split("="),r[n[0].trim()]=n[1];return r},t.writeFmtp=function(i){let r="",n=i.payloadType;if(i.preferredPayloadType!==void 0&&(n=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){let s=[];Object.keys(i.parameters).forEach(c=>{i.parameters[c]!==void 0?s.push(c+"="+i.parameters[c]):s.push(c)}),r+="a=fmtp:"+n+" "+s.join(";")+`\r
`}return r},t.parseRtcpFb=function(i){let r=i.substring(i.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(i){let r="",n=i.payloadType;return i.preferredPayloadType!==void 0&&(n=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+n+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(i){let r=i.indexOf(" "),n={ssrc:parseInt(i.substring(7,r),10)},s=i.indexOf(":",r);return s>-1?(n.attribute=i.substring(r+1,s),n.value=i.substring(s+1)):n.attribute=i.substring(r+1),n},t.parseSsrcGroup=function(i){let r=i.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(n=>parseInt(n,10))}},t.getMid=function(i){let r=t.matchPrefix(i,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(i){let r=i.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(i,r){return{role:"auto",fingerprints:t.matchPrefix(i+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(i,r){let n="a=setup:"+r+`\r
`;return i.fingerprints.forEach(s=>{n+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),n},t.parseCryptoLine=function(i){let r=i.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?t.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;let r=i.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},t.getCryptoParameters=function(i,r){return t.matchPrefix(i+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(i,r){let n=t.matchPrefix(i+r,"a=ice-ufrag:")[0],s=t.matchPrefix(i+r,"a=ice-pwd:")[0];return n&&s?{usernameFragment:n.substring(12),password:s.substring(10)}:null},t.writeIceParameters=function(i){let r="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(i){let r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(i)[0].split(" ");r.profile=n[2];for(let c=3;c<n.length;c++){let l=n[c],d=t.matchPrefix(i,"a=rtpmap:"+l+" ")[0];if(d){let h=t.parseRtpMap(d),p=t.matchPrefix(i,"a=fmtp:"+l+" ");switch(h.parameters=p.length?t.parseFmtp(p[0]):{},h.rtcpFeedback=t.matchPrefix(i,"a=rtcp-fb:"+l+" ").map(t.parseRtcpFb),r.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(h.name.toUpperCase())}}}t.matchPrefix(i,"a=extmap:").forEach(c=>{r.headerExtensions.push(t.parseExtmap(c))});let s=t.matchPrefix(i,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(c=>{s.forEach(l=>{c.rtcpFeedback.find(d=>d.type===l.type&&d.parameter===l.parameter)||c.rtcpFeedback.push(l)})}),r},t.writeRtpDescription=function(i,r){let n="";n+="m="+i+" ",n+=r.codecs.length>0?"9":"0",n+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=r.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(c=>{n+=t.writeRtpMap(c),n+=t.writeFmtp(c),n+=t.writeRtcpFb(c)});let s=0;return r.codecs.forEach(c=>{c.maxptime>s&&(s=c.maxptime)}),s>0&&(n+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(c=>{n+=t.writeExtmap(c)}),n},t.parseRtpEncodingParameters=function(i){let r=[],n=t.parseRtpParameters(i),s=n.fecMechanisms.indexOf("RED")!==-1,c=n.fecMechanisms.indexOf("ULPFEC")!==-1,l=t.matchPrefix(i,"a=ssrc:").map(E=>t.parseSsrcMedia(E)).filter(E=>E.attribute==="cname"),d=l.length>0&&l[0].ssrc,h,p=t.matchPrefix(i,"a=ssrc-group:FID").map(E=>E.substring(17).split(" ").map(R=>parseInt(R,10)));p.length>0&&p[0].length>1&&p[0][0]===d&&(h=p[0][1]),n.codecs.forEach(E=>{if(E.name.toUpperCase()==="RTX"&&E.parameters.apt){let R={ssrc:d,codecPayloadType:parseInt(E.parameters.apt,10)};d&&h&&(R.rtx={ssrc:h}),r.push(R),s&&(R=JSON.parse(JSON.stringify(R)),R.fec={ssrc:d,mechanism:c?"red+ulpfec":"red"},r.push(R))}}),r.length===0&&d&&r.push({ssrc:d});let _=t.matchPrefix(i,"b=");return _.length&&(_=_[0].indexOf("b=TIAS:")===0?parseInt(_[0].substring(7),10):_[0].indexOf("b=AS:")===0?1e3*parseInt(_[0].substring(5),10)*.95-16e3:void 0,r.forEach(E=>{E.maxBitrate=_})),r},t.parseRtcpParameters=function(i){let r={},n=t.matchPrefix(i,"a=ssrc:").map(l=>t.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);let s=t.matchPrefix(i,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;let c=t.matchPrefix(i,"a=rtcp-mux");return r.mux=c.length>0,r},t.writeRtcpParameters=function(i){let r="";return i.reducedSize&&(r+=`a=rtcp-rsize\r
`),i.mux&&(r+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(r+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),r},t.parseMsid=function(i){let r,n=t.matchPrefix(i,"a=msid:");if(n.length===1)return r=n[0].substring(7).split(" "),{stream:r[0],track:r[1]};let s=t.matchPrefix(i,"a=ssrc:").map(c=>t.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");return s.length>0?(r=s[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(i){let r=t.parseMLine(i),n=t.matchPrefix(i,"a=max-message-size:"),s;n.length>0&&(s=parseInt(n[0].substring(19),10)),isNaN(s)&&(s=65536);let c=t.matchPrefix(i,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};let l=t.matchPrefix(i,"a=sctpmap:");if(l.length>0){let d=l[0].substring(10).split(" ");return{port:parseInt(d[0],10),protocol:d[1],maxMessageSize:s}}},t.writeSctpDescription=function(i,r){let n=[];return n=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&n.push("a=max-message-size:"+r.maxMessageSize+`\r
`),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(i,r,n){let s,c=r!==void 0?r:2;return s=i||t.generateSessionId(),`v=0\r
o=`+(n||"thisisadapterortc")+" "+s+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(i,r){let n=t.splitLines(i);for(let s=0;s<n.length;s++)switch(n[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[s].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(i){return t.splitLines(i)[0].split(" ")[0].substring(2)},t.isRejected=function(i){return i.split(" ",2)[1]==="0"},t.parseMLine=function(i){let r=t.splitLines(i)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(i){let r=t.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;let r=t.splitLines(i);for(let n=0;n<r.length;n++)if(r[n].length<2||r[n].charAt(1)!=="=")return!1;return!0},e.exports=t})(RD);var yD=RD.exports,jf=b(yD),zB=T({__proto__:null,default:jf},[yD]);function g0(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){let r=new t(i),n=jf.parseCandidate(i.candidate),s=Object.assign(r,n);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(i)},e.RTCIceCandidate.prototype=t.prototype,mh(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function qb(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||mh(e,"icecandidate",t=>{if(t.candidate){let i=jf.parseCandidate(t.candidate.candidate);i.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return t})}function S0(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let i=function(l){if(!l||!l.sdp)return!1;let d=jf.splitSections(l.sdp);return d.shift(),d.some(h=>{let p=jf.parseMLine(h);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},r=function(l){let d=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(d===null||d.length<2)return-1;let h=parseInt(d[1],10);return h!=h?-1:h},n=function(l){let d=65536;return t.browser==="firefox"&&(d=t.version<57?l===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),d},s=function(l,d){let h=65536;t.browser==="firefox"&&t.version===57&&(h=65535);let p=jf.matchPrefix(l.sdp,"a=max-message-size:");return p.length>0?h=parseInt(p[0].substr(19),10):t.browser==="firefox"&&d!==-1&&(h=2147483637),h},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){let{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){let l=r(arguments[0]),d=n(l),h=s(arguments[0],l),p;p=d===0&&h===0?Number.POSITIVE_INFINITY:d===0||h===0?Math.max(d,h):Math.min(d,h);let _={};Object.defineProperty(_,"maxMessageSize",{get:()=>p}),this._sctp=_}return c.apply(this,arguments)}}function T0(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,n){let s=r.send;r.send=function(){let c=arguments[0],l=c.length||c.size||c.byteLength;if(r.readyState==="open"&&n.sctp&&l>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}let i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let r=i.apply(this,arguments);return t(r,this),r},mh(e,"datachannel",r=>(t(r.channel,r.target),r))}function Xb(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{let r=t[i];t[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=n=>{let s=n.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;let c=new Event("connectionstatechange",n);s.dispatchEvent(c)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Jb(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;let i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let n=r.sdp.split(`
`).filter(s=>Qr(s).call(s)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:n}):r.sdp=n}return i.apply(this,arguments)}}function v0(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?we.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),we.resolve())})}function R0(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return i.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?i.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(n=>i.apply(this,[n]))})}var KB=Object.freeze({__proto__:null,removeExtmapAllowMixed:Jb,shimAddIceCandidateNullOrEmpty:v0,shimConnectionState:Xb,shimMaxMessageSize:S0,shimParameterlessSetLocalDescription:R0,shimRTCIceCandidate:g0,shimRTCIceCandidateRelayProtocol:qb,shimSendThrowTypeError:T0});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},i=UN,r=(function(s){let c={browser:null,version:null};if(s===void 0||!s.navigator)return c.browser="Not a browser.",c;let{navigator:l}=s;if(l.mozGetUserMedia)c.browser="firefox",c.version=E0(l.userAgent,/Firefox\/(\d+)\./,1);else if(l.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)c.browser="chrome",c.version=E0(l.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!l.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=E0(l.userAgent,/AppleWebKit\/(\d+)\./,1),c.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return c})(e),n={browserDetails:r,commonShim:KB,extractVersion:E0,disableLog:NB,disableWarnings:DB,sdp:zB};switch(r.browser){case"chrome":if(!ZN||!Wb||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),n;if(r.version===null)return i("Chrome shim can not determine version, not shimming."),n;i("adapter.js shimming chrome."),n.browserShim=ZN,v0(e,r),R0(e),GN(e,r),HN(e),Wb(e,r),WN(e),XN(e,r),zN(e),KN(e),YN(e),JN(e,r),g0(e),qb(e),Xb(e),S0(e,r),T0(e),Jb(e,r);break;case"firefox":if(!cD||!zb||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),n;i("adapter.js shimming firefox."),n.browserShim=cD,v0(e,r),R0(e),QN(e,r),zb(e,r),$N(e),iD(e),eD(e),tD(e),rD(e),nD(e),aD(e),sD(e),oD(e),g0(e),Xb(e),S0(e,r),T0(e);break;case"safari":if(!gD||!t.shimSafari)return i("Safari shim is not included in this adapter release."),n;i("adapter.js shimming safari."),n.browserShim=gD,v0(e,r),R0(e),fD(e),_D(e),uD(e),lD(e),dD(e),mD(e),hD(e),ED(e),g0(e),qb(e),S0(e,r),T0(e),Jb(e,r);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var Zb=ue;Vt({global:!0,forced:Zb.globalThis!==Zb},{globalThis:Zb});var CD=b(ue),Qb={exports:{}};(function(e,t){(function(i,r){var n="function",s="undefined",c="object",l="string",d="major",h="model",p="name",_="type",E="vendor",R="version",N="architecture",w="console",O="mobile",L="tablet",M="smarttv",B="wearable",Y="embedded",H="Amazon",G="Apple",Q="ASUS",ce="BlackBerry",he="Browser",Se="Chrome",ht="Firefox",pt="Google",tt="Huawei",xt="LG",Lt="Microsoft",Vr="Motorola",de="Opera",ye="Samsung",ke="Sharp",fe="Sony",A="Xiaomi",F="Zebra",K="Facebook",Te="Chromium OS",lt="Mac OS",oi=" Browser",Ji=function(Ki){for(var Zi={},ci=0;ci<Ki.length;ci++)Zi[Ki[ci].toUpperCase()]=Ki[ci];return Zi},Ja=function(Ki,Zi){return typeof Ki===l&&Ds(Zi).indexOf(Ds(Ki))!==-1},Ds=function(Ki){return Ki.toLowerCase()},fS=function(Ki,Zi){if(typeof Ki===l)return Ki=Ki.replace(/^\s\s*/,""),typeof Zi===s?Ki:Ki.substring(0,500)},Hh=function(Ki,Zi){for(var ci,Bn,mo,Ui,El,At,_o=0;_o<Zi.length&&!El;){var Wh=Zi[_o],fc=Zi[_o+1];for(ci=Bn=0;ci<Wh.length&&!El&&Wh[ci];)if(El=Wh[ci++].exec(Ki))for(mo=0;mo<fc.length;mo++)At=El[++Bn],typeof(Ui=fc[mo])===c&&Ui.length>0?Ui.length===2?typeof Ui[1]==n?this[Ui[0]]=Ui[1].call(this,At):this[Ui[0]]=Ui[1]:Ui.length===3?typeof Ui[1]!==n||Ui[1].exec&&Ui[1].test?this[Ui[0]]=At?At.replace(Ui[1],Ui[2]):r:this[Ui[0]]=At?Ui[1].call(this,At,Ui[2]):r:Ui.length===4&&(this[Ui[0]]=At?Ui[3].call(this,At.replace(Ui[1],Ui[2])):r):this[Ui]=At||r;_o+=2}},Lm=function(Ki,Zi){for(var ci in Zi)if(typeof Zi[ci]===c&&Zi[ci].length>0){for(var Bn=0;Bn<Zi[ci].length;Bn++)if(Ja(Zi[ci][Bn],Ki))return ci==="?"?r:ci}else if(Ja(Zi[ci],Ki))return ci==="?"?r:ci;return Zi.hasOwnProperty("*")?Zi["*"]:Ki},Ry={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},yy={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[R,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[R,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,R],[/opios[\/ ]+([\w\.]+)/i],[R,[p,de+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[R,[p,de+" GX"]],[/\bopr\/([\w\.]+)/i],[R,[p,de]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[R,[p,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[R,[p,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[p,R],[/quark(?:pc)?\/([-\w\.]+)/i],[R,[p,"Quark"]],[/\bddg\/([\w\.]+)/i],[R,[p,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[R,[p,"UC"+he]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[R,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[R,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[R,[p,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[R,[p,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[R,[p,"Smart Lenovo "+he]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure "+he],R],[/\bfocus\/([\w\.]+)/i],[R,[p,ht+" Focus"]],[/\bopt\/([\w\.]+)/i],[R,[p,de+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[R,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[R,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[R,[p,de+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[R,[p,"MIUI"+oi]],[/fxios\/([\w\.-]+)/i],[R,[p,ht]],[/\bqihoobrowser\/?([\w\.]*)/i],[R,[p,"360"]],[/\b(qq)\/([\w\.]+)/i],[[p,/(.+)/,"$1Browser"],R],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1"+oi],R],[/samsungbrowser\/([\w\.]+)/i],[R,[p,ye+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[R,[p,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[p,"Sogou Mobile"],R],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[p,R],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[p],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[R,p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,K],R],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[p,R],[/\bgsa\/([\w\.]+) .*safari\//i],[R,[p,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[R,[p,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[R,[p,Se+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,Se+" WebView"],R],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[R,[p,"Android "+he]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,R],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[R,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[R,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[R,Lm,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[p,R],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],R],[/(wolvic|librewolf)\/([\w\.]+)/i],[p,R],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[R,[p,ht+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[p,[R,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[p,[R,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[N,"amd64"]],[/(ia32(?=;))/i],[[N,Ds]],[/((?:i[346]|x)86)[;\)]/i],[[N,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[N,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[N,"armhf"]],[/windows (ce|mobile); ppc;/i],[[N,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[N,/ower/,"",Ds]],[/(sun4\w)[;\)]/i],[[N,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[N,Ds]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[E,ye],[_,L]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[h,[E,ye],[_,O]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[h,[E,G],[_,O]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[E,G],[_,L]],[/(macintosh);/i],[h,[E,G]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[E,ke],[_,O]],[/(?:honor)([-\w ]+)[;\)]/i],[h,[E,"Honor"],[_,O]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[h,[E,tt],[_,L]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[E,tt],[_,O]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[h,/_/g," "],[E,A],[_,O]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[h,/_/g," "],[E,A],[_,L]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[E,"OPPO"],[_,O]],[/\b(opd2\d{3}a?) bui/i],[h,[E,"OPPO"],[_,L]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[E,"Vivo"],[_,O]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[h,[E,"Realme"],[_,O]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[E,Vr],[_,O]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[E,Vr],[_,L]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[E,xt],[_,L]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[E,xt],[_,O]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[h,[E,"Lenovo"],[_,L]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[h,/_/g," "],[E,"Nokia"],[_,O]],[/(pixel c)\b/i],[h,[E,pt],[_,L]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[E,pt],[_,O]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[E,fe],[_,O]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[E,fe],[_,L]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[E,"OnePlus"],[_,O]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[E,H],[_,L]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[E,H],[_,O]],[/(playbook);[-\w\),; ]+(rim)/i],[h,E,[_,L]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[E,ce],[_,O]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[E,Q],[_,L]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[E,Q],[_,O]],[/(nexus 9)/i],[h,[E,"HTC"],[_,L]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[E,[h,/_/g," "],[_,O]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[h,[E,"TCL"],[_,L]],[/(itel) ((\w+))/i],[[E,Ds],h,[_,Lm,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[E,"Acer"],[_,L]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[E,"Meizu"],[_,O]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[h,[E,"Ulefone"],[_,O]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[h,[E,"Energizer"],[_,O]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[h,[E,"Cat"],[_,O]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[h,[E,"Smartfren"],[_,O]],[/droid.+; (a(?:015|06[35]|142p?))/i],[h,[E,"Nothing"],[_,O]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[E,h,[_,O]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[E,h,[_,L]],[/(surface duo)/i],[h,[E,Lt],[_,L]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[E,"Fairphone"],[_,O]],[/(u304aa)/i],[h,[E,"AT&T"],[_,O]],[/\bsie-(\w*)/i],[h,[E,"Siemens"],[_,O]],[/\b(rct\w+) b/i],[h,[E,"RCA"],[_,L]],[/\b(venue[\d ]{2,7}) b/i],[h,[E,"Dell"],[_,L]],[/\b(q(?:mv|ta)\w+) b/i],[h,[E,"Verizon"],[_,L]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[E,"Barnes & Noble"],[_,L]],[/\b(tm\d{3}\w+) b/i],[h,[E,"NuVision"],[_,L]],[/\b(k88) b/i],[h,[E,"ZTE"],[_,L]],[/\b(nx\d{3}j) b/i],[h,[E,"ZTE"],[_,O]],[/\b(gen\d{3}) b.+49h/i],[h,[E,"Swiss"],[_,O]],[/\b(zur\d{3}) b/i],[h,[E,"Swiss"],[_,L]],[/\b((zeki)?tb.*\b) b/i],[h,[E,"Zeki"],[_,L]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[E,"Dragon Touch"],h,[_,L]],[/\b(ns-?\w{0,9}) b/i],[h,[E,"Insignia"],[_,L]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[E,"NextBook"],[_,L]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[E,"Voice"],h,[_,O]],[/\b(lvtel\-)?(v1[12]) b/i],[[E,"LvTel"],h,[_,O]],[/\b(ph-1) /i],[h,[E,"Essential"],[_,O]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[E,"Envizen"],[_,L]],[/\b(trio[-\w\. ]+) b/i],[h,[E,"MachSpeed"],[_,L]],[/\btu_(1491) b/i],[h,[E,"Rotor"],[_,L]],[/(shield[\w ]+) b/i],[h,[E,"Nvidia"],[_,L]],[/(sprint) (\w+)/i],[E,h,[_,O]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[E,Lt],[_,O]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[E,F],[_,L]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[E,F],[_,O]],[/smart-tv.+(samsung)/i],[E,[_,M]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[E,ye],[_,M]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[E,xt],[_,M]],[/(apple) ?tv/i],[E,[h,G+" TV"],[_,M]],[/crkey/i],[[h,Se+"cast"],[E,pt],[_,M]],[/droid.+aft(\w+)( bui|\))/i],[h,[E,H],[_,M]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[E,ke],[_,M]],[/(bravia[\w ]+)( bui|\))/i],[h,[E,fe],[_,M]],[/(mitv-\w{5}) bui/i],[h,[E,A],[_,M]],[/Hbbtv.*(technisat) (.*);/i],[E,h,[_,M]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[E,fS],[h,fS],[_,M]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[_,M]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[E,h,[_,w]],[/droid.+; (shield) bui/i],[h,[E,"Nvidia"],[_,w]],[/(playstation [345portablevi]+)/i],[h,[E,fe],[_,w]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[E,Lt],[_,w]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[h,[E,ye],[_,B]],[/((pebble))app/i],[E,h,[_,B]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[E,G],[_,B]],[/droid.+; (glass) \d/i],[h,[E,pt],[_,B]],[/droid.+; (wt63?0{2,3})\)/i],[h,[E,F],[_,B]],[/droid.+; (glass) \d/i],[h,[E,pt],[_,B]],[/(pico) (4|neo3(?: link|pro)?)/i],[E,h,[_,B]],[/; (quest( \d| pro)?)/i],[h,[E,K],[_,B]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[E,[_,Y]],[/(aeobc)\b/i],[h,[E,H],[_,Y]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[h,[_,O]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[_,L]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[_,L]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[_,O]],[/(android[-\w\. ]{0,9});.+buil/i],[h,[E,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[R,[p,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[p,R],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[R,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[p,R],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[R,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,R],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[p,[R,Lm,Ry]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[R,Lm,Ry],[p,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[R,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,lt],[R,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[R,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,R],[/\(bb(10);/i],[R,[p,ce]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[R,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[R,[p,ht+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[R,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[R,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[R,[p,Se+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,Te],R],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,R],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],R],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[p,R]]},Za=function(Ki,Zi){if(typeof Ki===c&&(Zi=Ki,Ki=r),!(this instanceof Za))return new Za(Ki,Zi).getResult();var ci=typeof i!==s&&i.navigator?i.navigator:r,Bn=Ki||(ci&&ci.userAgent?ci.userAgent:""),mo=ci&&ci.userAgentData?ci.userAgentData:r,Ui=Zi?(function(At,_o){var Wh={};for(var fc in At)_o[fc]&&_o[fc].length%2==0?Wh[fc]=_o[fc].concat(At[fc]):Wh[fc]=At[fc];return Wh})(yy,Zi):yy,El=ci&&ci.userAgent==Bn;return this.getBrowser=function(){var At={};return At[p]=r,At[R]=r,Hh.call(At,Bn,Ui.browser),At[d]=(function(_o){return typeof _o===l?_o.replace(/[^\d\.]/g,"").split(".")[0]:r})(At[R]),El&&ci&&ci.brave&&typeof ci.brave.isBrave==n&&(At[p]="Brave"),At},this.getCPU=function(){var At={};return At[N]=r,Hh.call(At,Bn,Ui.cpu),At},this.getDevice=function(){var At={};return At[E]=r,At[h]=r,At[_]=r,Hh.call(At,Bn,Ui.device),El&&!At[_]&&mo&&mo.mobile&&(At[_]=O),El&&At[h]=="Macintosh"&&ci&&typeof ci.standalone!==s&&ci.maxTouchPoints&&ci.maxTouchPoints>2&&(At[h]="iPad",At[_]=L),At},this.getEngine=function(){var At={};return At[p]=r,At[R]=r,Hh.call(At,Bn,Ui.engine),At},this.getOS=function(){var At={};return At[p]=r,At[R]=r,Hh.call(At,Bn,Ui.os),El&&!At[p]&&mo&&mo.platform&&mo.platform!="Unknown"&&(At[p]=mo.platform.replace(/chrome os/i,Te).replace(/macos/i,lt)),At},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Bn},this.setUA=function(At){return Bn=typeof At===l&&At.length>500?fS(At,500):At,this},this.setUA(Bn),this};Za.VERSION="0.7.40",Za.BROWSER=Ji([p,R,d]),Za.CPU=Ji([N]),Za.DEVICE=Ji([h,E,_,w,O,M,L,B,Y]),Za.ENGINE=Za.OS=Ji([p,R]),e.exports&&(t=e.exports=Za),t.UAParser=Za;var _l=typeof i!==s&&(i.jQuery||i.Zepto);if(_l&&!_l.ua){var Cy=new Za;_l.ua=Cy.getResult(),_l.ua.get=function(){return Cy.getUA()},_l.ua.set=function(Ki){Cy.setUA(Ki);var Zi=Cy.getResult();for(var ci in Zi)_l.ua[ci]=Zi[ci]}}})(typeof window=="object"?window:S)})(Qb,Qb.exports);var YB=b(Qb.exports),bD=xa.clear;Vt({global:!0,bind:!0,forced:ue.clearImmediate!==bD},{clearImmediate:bD});var AD=ue,qB=Oe,XB=Qe,JB=Fl,ZB=dr,QB=En,$B=Dn,ej=AD.Function,tj=/MSIE .\./.test(ZB)||JB==="BUN"&&(function(){var e=AD.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")})(),ij=Vt,wD=ue,ID=xa.set,rj=function(e,t){var i=1;return tj?function(r,n){var s=$B(arguments.length,1)>i,c=XB(r)?r:ej(r),l=s?QB(arguments,i):[],d=s?function(){qB(c,this,l)}:c;return e(d)}:e},OD=wD.setImmediate?rj(ID):ID;ij({global:!0,bind:!0,forced:wD.setImmediate!==OD},{setImmediate:OD});var ND=b(bn.setImmediate),nj=ue,aj=Jc,sj=ur,oj=Dn,cj=ii;Vt({global:!0,dontCallGetSet:!0,forced:I(function(){return cj&&Object.getOwnPropertyDescriptor(nj,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){oj(arguments.length,1),aj(sj(e))}});var DD=b(bn.queueMicrotask);function PD(e,t){return function(){return e.apply(t,arguments)}}let{toString:lj}=Object.prototype,{getPrototypeOf:$b}=Object,{iterator:y0,toStringTag:LD}=Symbol,C0=(eA=Object.create(null),e=>{let t=lj.call(e);return eA[t]||(eA[t]=t.slice(8,-1).toLowerCase())});var eA;let $s=e=>(e=e.toLowerCase(),t=>C0(t)===e),b0=e=>t=>typeof t===e,{isArray:Ff}=Array,ug=b0("undefined"),kD=$s("ArrayBuffer"),dj=b0("string"),ha=b0("function"),MD=b0("number"),A0=e=>e!==null&&typeof e=="object",w0=e=>{if(C0(e)!=="object")return!1;let t=$b(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||LD in e||y0 in e)},uj=$s("Date"),hj=$s("File"),pj=$s("Blob"),fj=$s("FileList"),mj=$s("URLSearchParams"),[_j,Ej,gj,Sj]=["ReadableStream","Request","Response","Headers"].map($s);function hg(e,t){let i,r,{allOwnKeys:n=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Ff(e))for(i=0,r=e.length;i<r;i++)t.call(null,e[i],i,e);else{let s=n?Object.getOwnPropertyNames(e):Object.keys(e),c=s.length,l;for(i=0;i<c;i++)l=s[i],t.call(null,e[l],l,e)}}function xD(e,t){t=t.toLowerCase();let i=Object.keys(e),r,n=i.length;for(;n-- >0;)if(r=i[n],t===r.toLowerCase())return r;return null}let _h=CD!==void 0?CD:typeof self<"u"?self:typeof window<"u"?window:global,UD=e=>!ug(e)&&e!==_h,Tj=(tA=typeof Uint8Array<"u"&&$b(Uint8Array),e=>tA&&e instanceof tA);var tA;let vj=$s("HTMLFormElement"),VD=(e=>{let{hasOwnProperty:t}=e;return(i,r)=>t.call(i,r)})(Object.prototype),Rj=$s("RegExp"),BD=(e,t)=>{let i=Object.getOwnPropertyDescriptors(e),r={};hg(i,(n,s)=>{let c;(c=t(n,s,e))!==!1&&(r[s]=c||n)}),Object.defineProperties(e,r)},yj=$s("AsyncFunction"),jD=(FD=typeof ND=="function",GD=ha(_h.postMessage),FD?ND:GD?(iA="axios@".concat(Math.random()),I0=[],_h.addEventListener("message",e=>{let{source:t,data:i}=e;t===_h&&i===iA&&I0.length&&I0.shift()()},!1),e=>{I0.push(e),_h.postMessage(iA,"*")}):e=>setTimeout(e));var FD,GD,iA,I0;let Cj=DD!==void 0?DD.bind(_h):typeof process<"u"&&process.nextTick||jD;var Ie={isArray:Ff,isArrayBuffer:kD,isBuffer:function(e){return e!==null&&!ug(e)&&e.constructor!==null&&!ug(e.constructor)&&ha(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||ha(e.append)&&((t=C0(e))==="formdata"||t==="object"&&ha(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&kD(e.buffer),t},isString:dj,isNumber:MD,isBoolean:e=>e===!0||e===!1,isObject:A0,isPlainObject:w0,isReadableStream:_j,isRequest:Ej,isResponse:gj,isHeaders:Sj,isUndefined:ug,isDate:uj,isFile:hj,isBlob:pj,isRegExp:Rj,isFunction:ha,isStream:e=>A0(e)&&ha(e.pipe),isURLSearchParams:mj,isTypedArray:Tj,isFileList:fj,forEach:hg,merge:function e(){let{caseless:t}=UD(this)&&this||{},i={},r=(n,s)=>{let c=t&&xD(i,s)||s;w0(i[c])&&w0(n)?i[c]=e(i[c],n):w0(n)?i[c]=e({},n):Ff(n)?i[c]=n.slice():i[c]=n};for(let n=0,s=arguments.length;n<s;n++)arguments[n]&&hg(arguments[n],r);return i},extend:function(e,t,i){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return hg(t,(n,s)=>{i&&ha(n)?e[s]=PD(n,i):e[s]=n},{allOwnKeys:r}),e},trim:e=>Qr(e)?Qr(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,i,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,t,i,r)=>{let n,s,c,l={};if(t=t||{},e==null)return t;do{for(n=Object.getOwnPropertyNames(e),s=n.length;s-- >0;)c=n[s],r&&!r(c,e,t)||l[c]||(t[c]=e[c],l[c]=!0);e=i!==!1&&$b(e)}while(e&&(!i||i(e,t))&&e!==Object.prototype);return t},kindOf:C0,kindOfTest:$s,endsWith:(e,t,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=t.length;let r=e.indexOf(t,i);return r!==-1&&r===i},toArray:e=>{if(!e)return null;if(Ff(e))return e;let t=e.length;if(!MD(t))return null;let i=new Array(t);for(;t-- >0;)i[t]=e[t];return i},forEachEntry:(e,t)=>{let i=(e&&e[y0]).call(e),r;for(;(r=i.next())&&!r.done;){let n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let i,r=[];for(;(i=e.exec(t))!==null;)r.push(i);return r},isHTMLForm:vj,hasOwnProperty:VD,hasOwnProp:VD,reduceDescriptors:BD,freezeMethods:e=>{BD(e,(t,i)=>{if(ha(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;let r=e[i];ha(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(e,t)=>{let i={},r=n=>{n.forEach(s=>{i[s]=!0})};return Ff(e)?r(e):r(String(e).split(t)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,i,r){return i.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:xD,global:_h,isContextDefined:UD,isSpecCompliantForm:function(e){return!!(e&&ha(e.append)&&e[LD]==="FormData"&&e[y0])},toJSONObject:e=>{let t=new Array(10),i=(r,n)=>{if(A0(r)){if(t.indexOf(r)>=0)return;if(!("toJSON"in r)){t[n]=r;let s=Ff(r)?[]:{};return hg(r,(c,l)=>{let d=i(c,n+1);!ug(d)&&(s[l]=d)}),t[n]=void 0,s}}return r};return i(e,0)},isAsyncFn:yj,isThenable:e=>e&&(A0(e)||ha(e))&&ha(e.then)&&ha(e.catch),setImmediate:jD,asap:Cj,isIterable:e=>e!=null&&ha(e[y0])};function Kt(e,t,i,r,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),i&&(this.config=i),r&&(this.request=r),n&&(this.response=n,this.status=n.status?n.status:null)}Ie.inherits(Kt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ie.toJSONObject(this.config),code:this.code,status:this.status}}});let HD=Kt.prototype,WD={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{WD[e]={value:e}}),Object.defineProperties(Kt,WD),Object.defineProperty(HD,"isAxiosError",{value:!0}),Kt.from=(e,t,i,r,n,s)=>{let c=Object.create(HD);return Ie.toFlatObject(e,c,function(l){return l!==Error.prototype},l=>l!=="isAxiosError"),Kt.call(c,e.message,t,i,r,n),c.cause=e,c.name=e.name,s&&Object.assign(c,s),c};function rA(e){return Ie.isPlainObject(e)||Ie.isArray(e)}function zD(e){return Ie.endsWith(e,"[]")?e.slice(0,-2):e}function KD(e,t,i){return e?e.concat(t).map(function(r,n){return r=zD(r),!i&&n?"["+r+"]":r}).join(i?".":""):t}let bj=Ie.toFlatObject(Ie,{},null,function(e){return/^is[A-Z]/.test(e)});function O0(e,t,i){if(!Ie.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;let r=(i=Ie.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(E,R){return!Ie.isUndefined(R[E])})).metaTokens,n=i.visitor||h,s=i.dots,c=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&Ie.isSpecCompliantForm(t);if(!Ie.isFunction(n))throw new TypeError("visitor must be a function");function d(E){if(E===null)return"";if(Ie.isDate(E))return E.toISOString();if(!l&&Ie.isBlob(E))throw new Kt("Blob is not supported. Use a Buffer instead.");return Ie.isArrayBuffer(E)||Ie.isTypedArray(E)?l&&typeof Blob=="function"?new Blob([E]):Buffer.from(E):E}function h(E,R,N){let w=E;if(E&&!N&&typeof E=="object"){if(Ie.endsWith(R,"{}"))R=r?R:R.slice(0,-2),E=JSON.stringify(E);else if(Ie.isArray(E)&&(function(O){return Ie.isArray(O)&&!O.some(rA)})(E)||(Ie.isFileList(E)||Ie.endsWith(R,"[]"))&&(w=Ie.toArray(E)))return R=zD(R),w.forEach(function(O,L){!Ie.isUndefined(O)&&O!==null&&t.append(c===!0?KD([R],L,s):c===null?R:R+"[]",d(O))}),!1}return!!rA(E)||(t.append(KD(N,R,s),d(E)),!1)}let p=[],_=Object.assign(bj,{defaultVisitor:h,convertValue:d,isVisitable:rA});if(!Ie.isObject(e))throw new TypeError("data must be an object");return(function E(R,N){if(!Ie.isUndefined(R)){if(p.indexOf(R)!==-1)throw Error("Circular reference detected in "+N.join("."));p.push(R),Ie.forEach(R,function(w,O){(!(Ie.isUndefined(w)||w===null)&&n.call(t,w,Ie.isString(O)?Qr(O).call(O):O,N,_))===!0&&E(w,N?N.concat(O):[O])}),p.pop()}})(e),t}function YD(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(i){return t[i]})}function nA(e,t){this._pairs=[],e&&O0(e,this,t)}let qD=nA.prototype;function Aj(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function XD(e,t,i){if(!t)return e;let r=i&&i.encode||Aj;Ie.isFunction(i)&&(i={serialize:i});let n=i&&i.serialize,s;if(s=n?n(t,i):Ie.isURLSearchParams(t)?t.toString():new nA(t,i).toString(r),s){let c=e.indexOf("#");c!==-1&&(e=e.slice(0,c)),e+=(e.indexOf("?")===-1?"?":"&")+s}return e}qD.append=function(e,t){this._pairs.push([e,t])},qD.toString=function(e){let t=e?function(i){return e.call(this,i,YD)}:YD;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};var JD=class{constructor(){this.handlers=[]}use(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ie.forEach(this.handlers,function(t){t!==null&&e(t)})}},ZD={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},QD={exports:{}},wj=Vt,Ij=ii,$D=an.f;wj({target:"Object",stat:!0,forced:Object.defineProperty!==$D,sham:!Ij},{defineProperty:$D});var e1=bn.Object,Oj=QD.exports=function(e,t,i){return e1.defineProperty(e,t,i)};e1.defineProperty.sham&&(Oj.sham=!0);var t1=b(QD.exports),Nj=TypeError,i1=ts,Dj=Fu,Pj=Yr,Lj=Li("species"),r1=Array,kj=function(e){var t;return i1(e)&&(t=e.constructor,(Dj(t)&&(t===r1||i1(t.prototype))||Pj(t)&&(t=t[Lj])===null)&&(t=void 0)),t===void 0?r1:t},n1=function(e,t){return new(kj(e))(t===0?0:t)},Mj=I,xj=es,Uj=Li("species"),a1=function(e){return xj>=51||!Mj(function(){var t=[];return(t.constructor={})[Uj]=function(){return{foo:1}},t[e](Boolean).foo!==1})},Vj=Vt,Bj=I,jj=ts,Fj=Yr,Gj=wa,Hj=yo,s1=function(e){if(e>9007199254740991)throw Nj("Maximum allowed index exceeded");return e},o1=Tb,Wj=n1,zj=a1,Kj=es,c1=Li("isConcatSpreadable"),Yj=Kj>=51||!Bj(function(){var e=[];return e[c1]=!1,e.concat()[0]!==e}),qj=function(e){if(!Fj(e))return!1;var t=e[c1];return t!==void 0?!!t:jj(e)};Vj({target:"Array",proto:!0,forced:!Yj||!zj("concat")},{concat:function(e){var t,i,r,n,s,c=Gj(this),l=Wj(c,0),d=0;for(t=-1,r=arguments.length;t<r;t++)if(qj(s=t===-1?c:arguments[t]))for(n=Hj(s),s1(d+n),i=0;i<n;i++,d++)i in s&&o1(l,d,s[i]);else s1(d+1),o1(l,d++,s);return l.length=d,l}});var l1={},Xj=it,Jj=go,d1=rs.f,Zj=En,u1=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];l1.f=function(e){return u1&&Xj(e)==="Window"?(function(t){try{return d1(t)}catch{return Zj(u1)}})(e):d1(Jj(e))};var Gf={},Qj=Li;Gf.f=Qj;var h1=bn,$j=tr,e6=Gf,t6=an.f,hr=function(e){var t=h1.Symbol||(h1.Symbol={});$j(t,e)||t6(t,e,{value:e6.f(e)})},i6=We,r6=qr,n6=Li,a6=Nr,p1=function(){var e=r6("Symbol"),t=e&&e.prototype,i=t&&t.valueOf,r=n6("toPrimitive");t&&!t[r]&&a6(t,r,function(n){return i6(i,this)},{})},s6=Ia,o6=Aa,c6=wa,l6=yo,d6=n1;X([].push);var u6=function(e){return function(t,i,r,n){for(var s,c,l=c6(t),d=o6(l),h=l6(d),p=s6(i,r),_=0,E=n||d6,R=void 0;h>_;_++)_ in d&&(c=p(s=d[_],_,l));return R}},f1={forEach:u6(0)},N0=Vt,pg=ue,aA=We,h6=X,Hf=ii,Wf=bl,p6=I,on=tr,f6=se,sA=Br,D0=go,oA=Ro,m6=Ir,cA=ft,zf=Bc,m1=Kl,_6=rs,_1=l1,E6=kc,E1=Di,g1=an,g6=Mc,S1=He,T1=Nr,S6=Gi,lA=ra,v1=Or,R1=vo,T6=Li,v6=Gf,R6=hr,y6=p1,C6=La,y1=Pa,P0=f1.forEach,pa=Yi("hidden"),L0="Symbol",fg="prototype",b6=y1.set,C1=y1.getterFor(L0),eo=Object[fg],Eh=pg.Symbol,k0=Eh&&Eh[fg],A6=pg.RangeError,w6=pg.TypeError,dA=pg.QObject,b1=E1.f,gh=g1.f,A1=_1.f,I6=S1.f,w1=h6([].push),nl=lA("symbols"),mg=lA("op-symbols"),O6=lA("wks"),uA=!dA||!dA[fg]||!dA[fg].findChild,I1=function(e,t,i){var r=b1(eo,t);r&&delete eo[t],gh(e,t,i),r&&e!==eo&&gh(eo,t,r)},hA=Hf&&p6(function(){return zf(gh({},"a",{get:function(){return gh(this,"a",{value:7}).a}})).a!==7})?I1:gh,pA=function(e,t){var i=nl[e]=zf(k0);return b6(i,{type:L0,tag:e,description:t}),Hf||(i.description=t),i},M0=function(e,t,i){e===eo&&M0(mg,t,i),sA(e);var r=oA(t);return sA(i),on(nl,r)?(i.enumerable?(on(e,pa)&&e[pa][r]&&(e[pa][r]=!1),i=zf(i,{enumerable:cA(0,!1)})):(on(e,pa)||gh(e,pa,cA(1,zf(null))),e[pa][r]=!0),hA(e,r,i)):gh(e,r,i)},fA=function(e,t){sA(e);var i=D0(t),r=m1(i).concat(P1(i));return P0(r,function(n){Hf&&!aA(O1,i,n)||M0(e,n,i[n])}),e},O1=function(e){var t=oA(e),i=aA(I6,this,t);return!(this===eo&&on(nl,t)&&!on(mg,t))&&(!(i||!on(this,t)||!on(nl,t)||on(this,pa)&&this[pa][t])||i)},N1=function(e,t){var i=D0(e),r=oA(t);if(i!==eo||!on(nl,r)||on(mg,r)){var n=b1(i,r);return!n||!on(nl,r)||on(i,pa)&&i[pa][r]||(n.enumerable=!0),n}},D1=function(e){var t=A1(D0(e)),i=[];return P0(t,function(r){on(nl,r)||on(v1,r)||w1(i,r)}),i},P1=function(e){var t=e===eo,i=A1(t?mg:D0(e)),r=[];return P0(i,function(n){!on(nl,n)||t&&!on(eo,n)||w1(r,nl[n])}),r};Wf||(Eh=function(){if(f6(k0,this))throw new w6("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?m6(arguments[0]):void 0,t=R1(e),i=function(r){var n=this===void 0?pg:this;n===eo&&aA(i,mg,r),on(n,pa)&&on(n[pa],t)&&(n[pa][t]=!1);var s=cA(1,r);try{hA(n,t,s)}catch(c){if(!(c instanceof A6))throw c;I1(n,t,s)}};return Hf&&uA&&hA(eo,t,{configurable:!0,set:i}),pA(t,e)},T1(k0=Eh[fg],"toString",function(){return C1(this).tag}),T1(Eh,"withoutSetter",function(e){return pA(R1(e),e)}),S1.f=O1,g1.f=M0,g6.f=fA,E1.f=N1,_6.f=_1.f=D1,E6.f=P1,v6.f=function(e){return pA(T6(e),e)},Hf&&S6(k0,"description",{configurable:!0,get:function(){return C1(this).description}})),N0({global:!0,wrap:!0,forced:!Wf,sham:!Wf},{Symbol:Eh}),P0(m1(O6),function(e){R6(e)}),N0({target:L0,stat:!0,forced:!Wf},{useSetter:function(){uA=!0},useSimple:function(){uA=!1}}),N0({target:"Object",stat:!0,forced:!Wf,sham:!Hf},{create:function(e,t){return t===void 0?zf(e):fA(zf(e),t)},defineProperty:M0,defineProperties:fA,getOwnPropertyDescriptor:N1}),N0({target:"Object",stat:!0,forced:!Wf},{getOwnPropertyNames:D1}),y6(),C6(Eh,L0),v1[pa]=!0;var L1=bl&&!!Symbol.for&&!!Symbol.keyFor,N6=Vt,D6=qr,P6=tr,L6=Ir,k1=ra,k6=L1,mA=k1("string-to-symbol-registry"),M6=k1("symbol-to-string-registry");N6({target:"Symbol",stat:!0,forced:!k6},{for:function(e){var t=L6(e);if(P6(mA,t))return mA[t];var i=D6("Symbol")(t);return mA[t]=i,M6[i]=t,i}});var x6=Vt,U6=tr,V6=Al,B6=To,j6=L1,M1=ra("symbol-to-string-registry");x6({target:"Symbol",stat:!0,forced:!j6},{keyFor:function(e){if(!V6(e))throw new TypeError(B6(e)+" is not a symbol");if(U6(M1,e))return M1[e]}});var x1=ts,F6=Qe,U1=it,G6=Ir,V1=X([].push),H6=Vt,B1=qr,j1=Oe,W6=We,_g=X,F1=I,G1=Qe,H1=Al,W1=En,z6=function(e){if(F6(e))return e;if(x1(e)){for(var t=e.length,i=[],r=0;r<t;r++){var n=e[r];typeof n=="string"?V1(i,n):typeof n!="number"&&U1(n)!=="Number"&&U1(n)!=="String"||V1(i,G6(n))}var s=i.length,c=!0;return function(l,d){if(c)return c=!1,d;if(x1(this))return d;for(var h=0;h<s;h++)if(i[h]===l)return d}}},K6=bl,Y6=String,Od=B1("JSON","stringify"),x0=_g(/./.exec),z1=_g("".charAt),q6=_g("".charCodeAt),X6=_g("".replace),J6=_g(1 .toString),Z6=/[\uD800-\uDFFF]/g,K1=/^[\uD800-\uDBFF]$/,Y1=/^[\uDC00-\uDFFF]$/,q1=!K6||F1(function(){var e=B1("Symbol")("stringify detection");return Od([e])!=="[null]"||Od({a:e})!=="{}"||Od(Object(e))!=="{}"}),X1=F1(function(){return Od("\uDF06\uD834")!=='"\\udf06\\ud834"'||Od("\uDEAD")!=='"\\udead"'}),Q6=function(e,t){var i=W1(arguments),r=z6(t);if(G1(r)||e!==void 0&&!H1(e))return i[1]=function(n,s){if(G1(r)&&(s=W6(r,this,Y6(n),s)),!H1(s))return s},j1(Od,null,i)},$6=function(e,t,i){var r=z1(i,t-1),n=z1(i,t+1);return x0(K1,e)&&!x0(Y1,n)||x0(Y1,e)&&!x0(K1,r)?"\\u"+J6(q6(e,0),16):e};Od&&H6({target:"JSON",stat:!0,forced:q1||X1},{stringify:function(e,t,i){var r=W1(arguments),n=j1(q1?Q6:Od,null,r);return X1&&typeof n=="string"?X6(n,Z6,$6):n}});var J1=kc,eF=wa;Vt({target:"Object",stat:!0,forced:!bl||I(function(){J1.f(1)})},{getOwnPropertySymbols:function(e){var t=J1.f;return t?t(eF(e)):[]}}),hr("asyncIterator"),hr("hasInstance"),hr("isConcatSpreadable"),hr("iterator"),hr("match"),hr("matchAll"),hr("replace"),hr("search"),hr("species"),hr("split");var tF=p1;hr("toPrimitive"),tF();var iF=qr,rF=La;hr("toStringTag"),rF(iF("Symbol"),"Symbol"),hr("unscopables"),La(ue.JSON,"JSON",!0);var nF=bn.Symbol,aF=Li,sF=an.f,Z1=aF("metadata"),Q1=Function.prototype;Q1[Z1]===void 0&&sF(Q1,Z1,{value:null}),hr("asyncDispose"),hr("dispose"),hr("metadata");var oF=nF,cF=X,_A=qr("Symbol"),lF=_A.keyFor,dF=cF(_A.prototype.valueOf),$1=_A.isRegisteredSymbol||function(e){try{return lF(dF(e))!==void 0}catch{return!1}};Vt({target:"Symbol",stat:!0},{isRegisteredSymbol:$1});for(var uF=ra,eP=qr,hF=X,pF=Al,fF=Li,U0=eP("Symbol"),tP=U0.isWellKnownSymbol,iP=eP("Object","getOwnPropertyNames"),mF=hF(U0.prototype.valueOf),rP=uF("wks"),EA=0,nP=iP(U0),_F=nP.length;EA<_F;EA++)try{var aP=nP[EA];pF(U0[aP])&&fF(aP)}catch{}var sP=function(e){if(tP&&tP(e))return!0;try{for(var t=mF(e),i=0,r=iP(rP),n=r.length;i<n;i++)if(rP[r[i]]==t)return!0}catch{}return!1};Vt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:sP}),hr("customMatcher"),hr("observable"),Vt({target:"Symbol",stat:!0},{isRegistered:$1}),Vt({target:"Symbol",stat:!0,forced:!0},{isWellKnown:sP}),hr("matcher"),hr("metadataKey"),hr("patternMatch"),hr("replaceAll");var Kf=b(oF),oP=b(Gf.f("iterator"));function Eg(e){return Eg=typeof Kf=="function"&&typeof oP=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Kf=="function"&&t.constructor===Kf&&t!==Kf.prototype?"symbol":typeof t},Eg(e)}var EF=b(Gf.f("toPrimitive"));function gF(e){var t=(function(i,r){if(Eg(i)!="object"||!i)return i;var n=i[EF];if(n!==void 0){var s=n.call(i,r);if(Eg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(i)})(e,"string");return Eg(t)=="symbol"?t:t+""}function D(e,t,i){return(t=gF(t))in e?t1(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var cP=b(g4),SF={isBrowser:!0,classes:{URLSearchParams:cP!==void 0?cP:nA,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};let gA=typeof window<"u"&&typeof document<"u",SA=typeof navigator=="object"&&navigator||void 0,TF=gA&&(!SA||["ReactNative","NativeScript","NS"].indexOf(SA.product)<0),vF=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",RF=gA&&window.location.href||"http://localhost";function lP(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function dP(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?lP(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):lP(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var Ln=dP(dP({},Object.freeze({__proto__:null,hasBrowserEnv:gA,hasStandardBrowserEnv:TF,hasStandardBrowserWebWorkerEnv:vF,navigator:SA,origin:RF})),SF),yF=Br,CF=We,bF=tr,AF=se,wF=function(){var e=yF(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},uP=RegExp.prototype,hP=function(e){var t=e.flags;return t!==void 0||"flags"in uP||bF(e,"flags")||!AF(uP,e)?t:CF(wF,e)},IF=nh.charAt,pP=We,OF=Br,NF=Qe,DF=it,PF=/./.exec,LF=TypeError,kF=Vt,fP=We,mP=rt,MF=zp,V0=nd,_P=Ls,EP=bc,gg=Ir,xF=Br,UF=Yr,VF=it,BF=u_,gP=hP,jF=Ms,FF=I,GF=$p,HF=function(e,t,i){return t+(i?IF(e,t).length:1)},WF=function(e,t){var i=e.exec;if(NF(i)){var r=pP(i,e,t);return r!==null&&OF(r),r}if(DF(e)==="RegExp")return pP(PF,e,t);throw new LF("RegExp#exec called on incompatible receiver")},SP=Pa,zF=Li("matchAll"),TP="RegExp String",vP=TP+" Iterator",KF=SP.set,YF=SP.getterFor(vP),qF=TypeError,TA=mP("".indexOf),B0=mP("".matchAll),vA=!!B0&&!FF(function(){B0("a",/./)}),XF=MF(function(e,t,i,r){KF(this,{type:vP,regexp:e,string:t,global:i,unicode:r,done:!1})},TP,function(){var e=YF(this);if(e.done)return V0(void 0,!0);var t=e.regexp,i=e.string,r=WF(t,i);return r===null?(e.done=!0,V0(void 0,!0)):e.global?(gg(r[0])===""&&(t.lastIndex=HF(i,EP(t.lastIndex),e.unicode)),V0(r,!1)):(e.done=!0,V0(r,!1))}),RP=function(e){var t,i,r,n=xF(this),s=gg(e),c=GF(n,RegExp),l=gg(gP(n));return t=new c(c===RegExp?n.source:n,l),i=!!~TA(l,"g"),r=!!~TA(l,"u"),t.lastIndex=EP(n.lastIndex),new XF(t,s,i,r)};kF({target:"String",proto:!0,forced:vA},{matchAll:function(e){var t,i,r,n,s=_P(this);if(UF(e)){if(BF(e)&&(t=gg(_P(gP(e))),!~TA(t,"g")))throw new qF("`.matchAll` does not allow non-global regexes");if(vA)return B0(s,e);if((r=jF(e,zF))===void 0&&VF(e)==="RegExp"&&(r=RP),r)return fP(r,e,s)}else if(vA)return B0(s,e);return i=gg(s),n=new RegExp(e,"g"),fP(RP,n,i)}});var JF=Hn("String","matchAll"),ZF=se,QF=JF,RA=String.prototype,$F=function(e){var t=e.matchAll;return typeof e=="string"||e===RA||ZF(RA,e)&&t===RA.matchAll?QF:t},e8=b($F);function yP(e){function t(i,r,n,s){let c=i[s++];if(c==="__proto__")return!0;let l=Number.isFinite(+c),d=s>=i.length;return c=!c&&Ie.isArray(n)?n.length:c,d?(Ie.hasOwnProp(n,c)?n[c]=[n[c],r]:n[c]=r,!l):(n[c]&&Ie.isObject(n[c])||(n[c]=[]),t(i,r,n[c],s)&&Ie.isArray(n[c])&&(n[c]=(function(h){let p={},_=Object.keys(h),E,R=_.length,N;for(E=0;E<R;E++)N=_[E],p[N]=h[N];return p})(n[c])),!l)}if(Ie.isFormData(e)&&Ie.isFunction(e.entries)){let i={};return Ie.forEachEntry(e,(r,n)=>{t((function(s){return e8(Ie).call(Ie,/\w+|\[(\w*)]/g,s).map(c=>c[0]==="[]"?"":c[1]||c[0])})(r),n,i,0)}),i}return null}let yA={transitional:ZD,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){let i=t.getContentType()||"",r=i.indexOf("application/json")>-1,n=Ie.isObject(e);if(n&&Ie.isHTMLForm(e)&&(e=new FormData(e)),Ie.isFormData(e))return r?JSON.stringify(yP(e)):e;if(Ie.isArrayBuffer(e)||Ie.isBuffer(e)||Ie.isStream(e)||Ie.isFile(e)||Ie.isBlob(e)||Ie.isReadableStream(e))return e;if(Ie.isArrayBufferView(e))return e.buffer;if(Ie.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(n){if(i.indexOf("application/x-www-form-urlencoded")>-1)return(function(c,l){return O0(c,new Ln.classes.URLSearchParams,Object.assign({visitor:function(d,h,p,_){return Ln.isNode&&Ie.isBuffer(d)?(this.append(h,d.toString("base64")),!1):_.defaultVisitor.apply(this,arguments)}},l))})(e,this.formSerializer).toString();if((s=Ie.isFileList(e))||i.indexOf("multipart/form-data")>-1){let c=this.env&&this.env.FormData;return O0(s?{"files[]":e}:e,c&&new c,this.formSerializer)}}return n||r?(t.setContentType("application/json",!1),(function(c,l,d){if(Ie.isString(c))try{return(l||JSON.parse)(c),Qr(Ie).call(Ie,c)}catch(h){if(h.name!=="SyntaxError")throw h}return(d||JSON.stringify)(c)})(e)):e}],transformResponse:[function(e){let t=this.transitional||yA.transitional,i=t&&t.forcedJSONParsing,r=this.responseType==="json";if(Ie.isResponse(e)||Ie.isReadableStream(e))return e;if(e&&Ie.isString(e)&&(i&&!this.responseType||r)){let n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(s){if(n)throw s.name==="SyntaxError"?Kt.from(s,Kt.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ln.classes.FormData,Blob:Ln.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ie.forEach(["delete","get","head","post","put","patch"],e=>{yA.headers[e]={}});var CA=yA;let t8=Ie.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),CP=Symbol("internals");function Sg(e){var t;return e&&Qr(t=String(e)).call(t).toLowerCase()}function j0(e){return e===!1||e==null?e:Ie.isArray(e)?e.map(j0):String(e)}function bA(e,t,i,r,n){return Ie.isFunction(r)?r.call(this,t,i):(n&&(t=i),Ie.isString(t)?Ie.isString(r)?t.indexOf(r)!==-1:Ie.isRegExp(r)?r.test(t):void 0:void 0)}class F0{constructor(t){t&&this.set(t)}set(t,i,r){let n=this;function s(d,h,p){let _=Sg(h);if(!_)throw new Error("header name must be a non-empty string");let E=Ie.findKey(n,_);(!E||n[E]===void 0||p===!0||p===void 0&&n[E]!==!1)&&(n[E||h]=j0(d))}let c=(d,h)=>Ie.forEach(d,(p,_)=>s(p,_,h));if(Ie.isPlainObject(t)||t instanceof this.constructor)c(t,i);else if(Ie.isString(t)&&(t=Qr(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Qr(l=t).call(l)))c((d=>{let h={},p,_,E;return d&&d.split(`
`).forEach(function(R){var N,w;E=R.indexOf(":"),p=Qr(N=R.substring(0,E)).call(N).toLowerCase(),_=Qr(w=R.substring(E+1)).call(w),!p||h[p]&&t8[p]||(p==="set-cookie"?h[p]?h[p].push(_):h[p]=[_]:h[p]=h[p]?h[p]+", "+_:_)}),h})(t),i);else if(Ie.isObject(t)&&Ie.isIterable(t)){let d,h,p={};for(let _ of t){if(!Ie.isArray(_))throw TypeError("Object iterator must return a key-value pair");p[h=_[0]]=(d=p[h])?Ie.isArray(d)?[...d,_[1]]:[d,_[1]]:_[1]}c(p,i)}else t!=null&&s(i,t,r);var l;return this}get(t,i){if(t=Sg(t)){let r=Ie.findKey(this,t);if(r){let n=this[r];if(!i)return n;if(i===!0)return(function(s){let c=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,d;for(;d=l.exec(s);)c[d[1]]=d[2];return c})(n);if(Ie.isFunction(i))return i.call(this,n,r);if(Ie.isRegExp(i))return i.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,i){if(t=Sg(t)){let r=Ie.findKey(this,t);return!(!r||this[r]===void 0||i&&!bA(0,this[r],r,i))}return!1}delete(t,i){let r=this,n=!1;function s(c){if(c=Sg(c)){let l=Ie.findKey(r,c);!l||i&&!bA(0,r[l],l,i)||(delete r[l],n=!0)}}return Ie.isArray(t)?t.forEach(s):s(t),n}clear(t){let i=Object.keys(this),r=i.length,n=!1;for(;r--;){let s=i[r];t&&!bA(0,this[s],s,t,!0)||(delete this[s],n=!0)}return n}normalize(t){let i=this,r={};return Ie.forEach(this,(n,s)=>{var c;let l=Ie.findKey(r,s);if(l)return i[l]=j0(n),void delete i[s];let d=t?(function(h){return Qr(h).call(h).toLowerCase().replace(/([a-z\d])(\w*)/g,(p,_,E)=>_.toUpperCase()+E)})(s):Qr(c=String(s)).call(c);d!==s&&delete i[s],i[d]=j0(n),r[d]=!0}),this}concat(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return this.constructor.concat(this,...i)}toJSON(t){let i=Object.create(null);return Ie.forEach(this,(r,n)=>{r!=null&&r!==!1&&(i[n]=t&&Ie.isArray(r)?r.join(", "):r)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[i,r]=t;return i+": "+r}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){let i=new this(t);for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];return n.forEach(c=>i.set(c)),i}static accessor(t){let i=(this[CP]=this[CP]={accessors:{}}).accessors,r=this.prototype;function n(s){let c=Sg(s);i[c]||((function(l,d){let h=Ie.toCamelCase(" "+d);["get","set","has"].forEach(p=>{Object.defineProperty(l,p+h,{value:function(_,E,R){return this[p].call(this,d,_,E,R)},configurable:!0})})})(r,s),i[c]=!0)}return Ie.isArray(t)?t.forEach(n):n(t),this}}F0.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Ie.reduceDescriptors(F0.prototype,(e,t)=>{let{value:i}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>i,set(n){this[r]=n}}}),Ie.freezeMethods(F0);var to=F0;function AA(e,t){let i=this||CA,r=t||i,n=to.from(r.headers),s=r.data;return Ie.forEach(e,function(c){s=c.call(i,s,n.normalize(),t?t.status:void 0)}),n.normalize(),s}function bP(e){return!(!e||!e.__CANCEL__)}function Yf(e,t,i){Kt.call(this,e??"canceled",Kt.ERR_CANCELED,t,i),this.name="CanceledError"}function AP(e,t,i){let r=i.config.validateStatus;i.status&&r&&!r(i.status)?t(new Kt("Request failed with status code "+i.status,[Kt.ERR_BAD_REQUEST,Kt.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}Ie.inherits(Yf,Kt,{__CANCEL__:!0});let G0=function(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,r=0,n=(function(s,c){s=s||10;let l=new Array(s),d=new Array(s),h,p=0,_=0;return c=c!==void 0?c:1e3,function(E){let R=Date.now(),N=d[_];h||(h=R),l[p]=E,d[p]=R;let w=_,O=0;for(;w!==p;)O+=l[w++],w%=s;if(p=(p+1)%s,p===_&&(_=(_+1)%s),R-h<c)return;let L=N&&R-N;return L?Math.round(1e3*O/L):void 0}})(50,250);return(function(s,c){let l,d,h=0,p=1e3/c,_=function(E){h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),l=null,d&&(clearTimeout(d),d=null),s.apply(null,E)};return[function(){let E=Date.now(),R=E-h;for(var N=arguments.length,w=new Array(N),O=0;O<N;O++)w[O]=arguments[O];R>=p?_(w,E):(l=w,d||(d=setTimeout(()=>{d=null,_(l)},p-R)))},()=>l&&_(l)]})(s=>{let c=s.loaded,l=s.lengthComputable?s.total:void 0,d=c-r,h=n(d);r=c,e({loaded:c,total:l,progress:l?c/l:void 0,bytes:d,rate:h||void 0,estimated:h&&l&&c<=l?(l-c)/h:void 0,event:s,lengthComputable:l!=null,[t?"download":"upload"]:!0})},i)},wP=(e,t)=>{let i=e!=null;return[r=>t[0]({lengthComputable:i,total:e,loaded:r}),t[1]]},IP=e=>function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return Ie.asap(()=>e(...i))};var i8=Ln.hasStandardBrowserEnv?((e,t)=>i=>(i=new _0(i,Ln.origin),e.protocol===i.protocol&&e.host===i.host&&(t||e.port===i.port)))(new _0(Ln.origin),Ln.navigator&&/(msie|trident)/i.test(Ln.navigator.userAgent)):()=>!0,r8=Ln.hasStandardBrowserEnv?{write(e,t,i,r,n,s){let c=[e+"="+encodeURIComponent(t)];Ie.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),Ie.isString(r)&&c.push("path="+r),Ie.isString(n)&&c.push("domain="+n),s===!0&&c.push("secure"),document.cookie=c.join("; ")},read(e){let t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function OP(e,t,i){let r=!(function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)})(t);return e&&(r||i==0)?(function(n,s){return s?n.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):n})(e,t):t}function NP(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}let DP=e=>e instanceof to?(function(t){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?NP(Object(r),!0).forEach(function(n){D(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):NP(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t})({},e):e;function Sh(e,t){t=t||{};let i={};function r(h,p,_,E){return Ie.isPlainObject(h)&&Ie.isPlainObject(p)?Ie.merge.call({caseless:E},h,p):Ie.isPlainObject(p)?Ie.merge({},p):Ie.isArray(p)?p.slice():p}function n(h,p,_,E){return Ie.isUndefined(p)?Ie.isUndefined(h)?void 0:r(void 0,h,0,E):r(h,p,0,E)}function s(h,p){if(!Ie.isUndefined(p))return r(void 0,p)}function c(h,p){return Ie.isUndefined(p)?Ie.isUndefined(h)?void 0:r(void 0,h):r(void 0,p)}function l(h,p,_){return _ in t?r(h,p):_ in e?r(void 0,h):void 0}let d={url:s,method:s,data:s,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l,headers:(h,p,_)=>n(DP(h),DP(p),0,!0)};return Ie.forEach(Object.keys(Object.assign({},e,t)),function(h){let p=d[h]||n,_=p(e[h],t[h],h);Ie.isUndefined(_)&&p!==l||(i[h]=_)}),i}var PP=e=>{let t=Sh({},e),i,{data:r,withXSRFToken:n,xsrfHeaderName:s,xsrfCookieName:c,headers:l,auth:d}=t;if(t.headers=l=to.from(l),t.url=XD(OP(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),d&&l.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),Ie.isFormData(r)){if(Ln.hasStandardBrowserEnv||Ln.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if((i=l.getContentType())!==!1){let[h,...p]=i?i.split(";").map(_=>Qr(_).call(_)).filter(Boolean):[];l.setContentType([h||"multipart/form-data",...p].join("; "))}}if(Ln.hasStandardBrowserEnv&&(n&&Ie.isFunction(n)&&(n=n(t)),n||n!==!1&&i8(t.url))){let h=s&&c&&r8.read(c);h&&l.set(s,h)}return t},n8=typeof XMLHttpRequest<"u"&&function(e){return new we(function(t,i){let r=PP(e),n=r.data,s=to.from(r.headers).normalize(),c,l,d,h,p,{responseType:_,onUploadProgress:E,onDownloadProgress:R}=r;function N(){h&&h(),p&&p(),r.cancelToken&&r.cancelToken.unsubscribe(c),r.signal&&r.signal.removeEventListener("abort",c)}let w=new XMLHttpRequest;function O(){if(!w)return;let M=to.from("getAllResponseHeaders"in w&&w.getAllResponseHeaders());AP(function(B){t(B),N()},function(B){i(B),N()},{data:_&&_!=="text"&&_!=="json"?w.response:w.responseText,status:w.status,statusText:w.statusText,headers:M,config:e,request:w}),w=null}w.open(r.method.toUpperCase(),r.url,!0),w.timeout=r.timeout,"onloadend"in w?w.onloadend=O:w.onreadystatechange=function(){w&&w.readyState===4&&(w.status!==0||w.responseURL&&w.responseURL.indexOf("file:")===0)&&setTimeout(O)},w.onabort=function(){w&&(i(new Kt("Request aborted",Kt.ECONNABORTED,e,w)),w=null)},w.onerror=function(){i(new Kt("Network Error",Kt.ERR_NETWORK,e,w)),w=null},w.ontimeout=function(){let M=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded",B=r.transitional||ZD;r.timeoutErrorMessage&&(M=r.timeoutErrorMessage),i(new Kt(M,B.clarifyTimeoutError?Kt.ETIMEDOUT:Kt.ECONNABORTED,e,w)),w=null},n===void 0&&s.setContentType(null),"setRequestHeader"in w&&Ie.forEach(s.toJSON(),function(M,B){w.setRequestHeader(B,M)}),Ie.isUndefined(r.withCredentials)||(w.withCredentials=!!r.withCredentials),_&&_!=="json"&&(w.responseType=r.responseType),R&&([d,p]=G0(R,!0),w.addEventListener("progress",d)),E&&w.upload&&([l,h]=G0(E),w.upload.addEventListener("progress",l),w.upload.addEventListener("loadend",h)),(r.cancelToken||r.signal)&&(c=M=>{w&&(i(!M||M.type?new Yf(null,e,w):M),w.abort(),w=null)},r.cancelToken&&r.cancelToken.subscribe(c),r.signal&&(r.signal.aborted?c():r.signal.addEventListener("abort",c)));let L=(function(M){let B=/^([-+\w]{1,25})(:?\/\/|:)/.exec(M);return B&&B[1]||""})(r.url);L&&Ln.protocols.indexOf(L)===-1?i(new Kt("Unsupported protocol "+L+":",Kt.ERR_BAD_REQUEST,e)):w.send(n||null)})},a8=(e,t)=>{let{length:i}=e=e?e.filter(Boolean):[];if(t||i){let r,n=new AbortController,s=function(h){if(!r){r=!0,l();let p=h instanceof Error?h:this.reason;n.abort(p instanceof Kt?p:new Yf(p instanceof Error?p.message:p))}},c=t&&setTimeout(()=>{c=null,s(new Kt("timeout ".concat(t," of ms exceeded"),Kt.ETIMEDOUT))},t),l=()=>{e&&(c&&clearTimeout(c),c=null,e.forEach(h=>{h.unsubscribe?h.unsubscribe(s):h.removeEventListener("abort",s)}),e=null)};e.forEach(h=>h.addEventListener("abort",s));let{signal:d}=n;return d.unsubscribe=()=>Ie.asap(l),d}},wA=b(oh),LP=Gf.f("asyncIterator"),s8=b(LP);function IA(e,t){this.v=e,this.k=t}function ja(e){return function(){return new Tg(e.apply(this,arguments))}}function Tg(e){var t,i;function r(s,c){try{var l=e[s](c),d=l.value,h=d instanceof IA;wA.resolve(h?d.v:d).then(function(p){if(h){var _=s==="return"?"return":"next";if(!d.k||p.done)return r(_,p);p=e[_](p).value}n(l.done?"return":"normal",p)},function(p){r("throw",p)})}catch(p){n("throw",p)}}function n(s,c){switch(s){case"return":t.resolve({value:c,done:!0});break;case"throw":t.reject(c);break;default:t.resolve({value:c,done:!1})}(t=t.next)?r(t.key,t.arg):i=null}this._invoke=function(s,c){return new wA(function(l,d){var h={key:s,arg:c,resolve:l,reject:d,next:null};i?i=i.next=h:(t=i=h,r(s,c))})},typeof e.return!="function"&&(this.return=void 0)}function It(e){return new IA(e,0)}function H0(e){var t={},i=!1;function r(n,s){return i=!0,s=new wA(function(c){c(e[n](s))}),{done:!1,value:new IA(s,1)}}return t[Kf!==void 0&&oP||"@@iterator"]=function(){return this},t.next=function(n){return i?(i=!1,n):r("next",n)},typeof e.throw=="function"&&(t.throw=function(n){if(i)throw i=!1,n;return r("throw",n)}),typeof e.return=="function"&&(t.return=function(n){return i?(i=!1,n):r("return",n)}),t}Tg.prototype[typeof Kf=="function"&&s8||"@@asyncIterator"]=function(){return this},Tg.prototype.next=function(e){return this._invoke("next",e)},Tg.prototype.throw=function(e){return this._invoke("throw",e)},Tg.prototype.return=function(e){return this._invoke("return",e)};var OA=b(LP);function NA(e){var t,i,r,n=2;for(typeof Symbol<"u"&&(i=OA,r=Symbol.iterator);n--;){if(i&&(t=e[i])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new W0(t.call(e));i="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function W0(e){function t(i){if(Object(i)!==i)return we.reject(new TypeError(i+" is not an object."));var r=i.done;return we.resolve(i.value).then(function(n){return{value:n,done:r}})}return W0=function(i){this.s=i,this.n=i.next},W0.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(i){var r=this.s.return;return r===void 0?we.resolve({value:i,done:!0}):t(r.apply(this.s,arguments))},throw:function(i){var r=this.s.return;return r===void 0?we.reject(i):t(r.apply(this.s,arguments))}},new W0(e)}let o8=function*(e,t){let i=e.byteLength;if(!t||i<t)return void(yield e);let r,n=0;for(;n<i;)r=n+t,yield e.slice(n,r),n=r},c8=(function(){var e=ja(function*(t,i){var r,n=!1,s=!1;try{for(var c,l=NA(l8(t));n=!(c=yield It(l.next())).done;n=!1){let d=c.value;yield*H0(NA(o8(d,i)))}}catch(d){s=!0,r=d}finally{try{n&&l.return!=null&&(yield It(l.return()))}finally{if(s)throw r}}});return function(t,i){return e.apply(this,arguments)}})(),l8=(function(){var e=ja(function*(t){if(t[OA])return void(yield*H0(NA(t)));let i=t.getReader();try{for(;;){let{done:r,value:n}=yield It(i.read());if(r)break;yield n}}finally{yield It(i.cancel())}});return function(t){return e.apply(this,arguments)}})(),kP=(e,t,i,r)=>{let n=c8(e,t),s,c=0,l=d=>{s||(s=!0,r&&r(d))};return new ReadableStream({async pull(d){try{let{done:h,value:p}=await n.next();if(h)return l(),void d.close();let _=p.byteLength;if(i){let E=c+=_;i(E)}d.enqueue(new Uint8Array(p))}catch(h){throw l(h),h}},cancel:d=>(l(d),n.return())},{highWaterMark:2})};function MP(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function xP(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?MP(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):MP(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let z0=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",UP=z0&&typeof ReadableStream=="function",d8=z0&&(typeof TextEncoder=="function"?(VP=new TextEncoder,e=>VP.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var VP;let BP=function(e){try{for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return!!e(...i)}catch{return!1}},u8=UP&&BP(()=>{let e=!1,t=new Request(Ln.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),DA=UP&&BP(()=>Ie.isReadableStream(new Response("").body)),K0={stream:DA&&(e=>e.body)};var jP;z0&&(jP=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!K0[e]&&(K0[e]=Ie.isFunction(jP[e])?t=>t[e]():(t,i)=>{throw new Kt("Response type '".concat(e,"' is not supported"),Kt.ERR_NOT_SUPPORT,i)})}));let h8=async(e,t)=>Ie.toFiniteNumber(e.getContentLength())??(async r=>r==null?0:Ie.isBlob(r)?r.size:Ie.isSpecCompliantForm(r)?(await new Request(Ln.origin,{method:"POST",body:r}).arrayBuffer()).byteLength:Ie.isArrayBufferView(r)||Ie.isArrayBuffer(r)?r.byteLength:(Ie.isURLSearchParams(r)&&(r+=""),Ie.isString(r)?(await d8(r)).byteLength:void 0))(t);var p8=z0&&(async e=>{let{url:t,method:i,data:r,signal:n,cancelToken:s,timeout:c,onDownloadProgress:l,onUploadProgress:d,responseType:h,headers:p,withCredentials:_="same-origin",fetchOptions:E}=PP(e);h=h?(h+"").toLowerCase():"text";let R,N=a8([n,s&&s.toAbortSignal()],c),w=N&&N.unsubscribe&&(()=>{N.unsubscribe()}),O;try{if(d&&u8&&i!=="get"&&i!=="head"&&(O=await h8(p,r))!==0){let H,G=new Request(t,{method:"POST",body:r,duplex:"half"});if(Ie.isFormData(r)&&(H=G.headers.get("content-type"))&&p.setContentType(H),G.body){let[Q,ce]=wP(O,G0(IP(d)));r=kP(G.body,65536,Q,ce)}}Ie.isString(_)||(_=_?"include":"omit");let L="credentials"in Request.prototype;R=new Request(t,xP(xP({},E),{},{signal:N,method:i.toUpperCase(),headers:p.normalize().toJSON(),body:r,duplex:"half",credentials:L?_:void 0}));let M=await fetch(R),B=DA&&(h==="stream"||h==="response");if(DA&&(l||B&&w)){let H={};["status","statusText","headers"].forEach(he=>{H[he]=M[he]});let G=Ie.toFiniteNumber(M.headers.get("content-length")),[Q,ce]=l&&wP(G,G0(IP(l),!0))||[];M=new Response(kP(M.body,65536,Q,()=>{ce&&ce(),w&&w()}),H)}h=h||"text";let Y=await K0[Ie.findKey(K0,h)||"text"](M,e);return!B&&w&&w(),await new we((H,G)=>{AP(H,G,{data:Y,headers:to.from(M.headers),status:M.status,statusText:M.statusText,config:e,request:R})})}catch(L){throw w&&w(),L&&L.name==="TypeError"&&/Load failed|fetch/i.test(L.message)?Object.assign(new Kt("Network Error",Kt.ERR_NETWORK,e,R),{cause:L.cause||L}):Kt.from(L,L&&L.code,e,R)}});let PA={http:null,xhr:n8,fetch:p8};Ie.forEach(PA,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});let FP=e=>"- ".concat(e),f8=e=>Ie.isFunction(e)||e===null||e===!1;var GP={getAdapter:e=>{e=Ie.isArray(e)?e:[e];let{length:t}=e,i,r,n={};for(let s=0;s<t;s++){let c;if(i=e[s],r=i,!f8(i)&&(r=PA[(c=String(i)).toLowerCase()],r===void 0))throw new Kt("Unknown adapter '".concat(c,"'"));if(r)break;n[c||"#"+s]=r}if(!r){let s=Object.entries(n).map(c=>{let[l,d]=c;return"adapter ".concat(l," ")+(d===!1?"is not supported by the environment":"is not available in the build")});throw new Kt("There is no suitable adapter to dispatch the request "+(t?s.length>1?`since :
`+s.map(FP).join(`
`):" "+FP(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:PA};function LA(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Yf(null,e)}function HP(e){return LA(e),e.headers=to.from(e.headers),e.data=AA.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),GP.getAdapter(e.adapter||CA.adapter)(e).then(function(t){return LA(e),t.data=AA.call(e,e.transformResponse,t),t.headers=to.from(t.headers),t},function(t){return bP(t)||(LA(e),t&&t.response&&(t.response.data=AA.call(e,e.transformResponse,t.response),t.response.headers=to.from(t.response.headers))),we.reject(t)})}let WP="1.9.0",Y0={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Y0[e]=function(i){return typeof i===e||"a"+(t<1?"n ":" ")+e}});let zP={};Y0.transitional=function(e,t,i){function r(n,s){return"[Axios v"+WP+"] Transitional option '"+n+"'"+s+(i?". "+i:"")}return(n,s,c)=>{if(e===!1)throw new Kt(r(s," has been removed"+(t?" in "+t:"")),Kt.ERR_DEPRECATED);return t&&!zP[s]&&(zP[s]=!0,console.warn(r(s," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,s,c)}},Y0.spelling=function(e){return(t,i)=>(console.warn("".concat(i," is likely a misspelling of ").concat(e)),!0)};var q0={assertOptions:function(e,t,i){if(typeof e!="object")throw new Kt("options must be an object",Kt.ERR_BAD_OPTION_VALUE);let r=Object.keys(e),n=r.length;for(;n-- >0;){let s=r[n],c=t[s];if(c){let l=e[s],d=l===void 0||c(l,s,e);if(d!==!0)throw new Kt("option "+s+" must be "+d,Kt.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new Kt("Unknown option "+s,Kt.ERR_BAD_OPTION)}},validators:Y0};let Qo=q0.validators,X0=class{constructor(e){this.defaults=e||{},this.interceptors={request:new JD,response:new JD}}async request(e,t){try{return await this._request(e,t)}catch(i){if(i instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;let n=r.stack?r.stack.replace(/^.+\n/,""):"";try{i.stack?n&&!String(i.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+n):i.stack=n}catch{}}throw i}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Sh(this.defaults,t);let{transitional:i,paramsSerializer:r,headers:n}=t;i!==void 0&&q0.assertOptions(i,{silentJSONParsing:Qo.transitional(Qo.boolean),forcedJSONParsing:Qo.transitional(Qo.boolean),clarifyTimeoutError:Qo.transitional(Qo.boolean)},!1),r!=null&&(Ie.isFunction(r)?t.paramsSerializer={serialize:r}:q0.assertOptions(r,{encode:Qo.function,serialize:Qo.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),q0.assertOptions(t,{baseUrl:Qo.spelling("baseURL"),withXsrfToken:Qo.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=n&&Ie.merge(n.common,n[t.method]);n&&Ie.forEach(["delete","get","head","post","put","patch","common"],R=>{delete n[R]}),t.headers=to.concat(s,n);let c=[],l=!0;this.interceptors.request.forEach(function(R){typeof R.runWhen=="function"&&R.runWhen(t)===!1||(l=l&&R.synchronous,c.unshift(R.fulfilled,R.rejected))});let d=[],h;this.interceptors.response.forEach(function(R){d.push(R.fulfilled,R.rejected)});let p,_=0;if(!l){let R=[HP.bind(this),void 0];for(R.unshift.apply(R,c),R.push.apply(R,d),p=R.length,h=we.resolve(t);_<p;)h=h.then(R[_++],R[_++]);return h}p=c.length;let E=t;for(_=0;_<p;){let R=c[_++],N=c[_++];try{E=R(E)}catch(w){N.call(this,w);break}}try{h=HP.call(this,E)}catch(R){return we.reject(R)}for(_=0,p=d.length;_<p;)h=h.then(d[_++],d[_++]);return h}getUri(e){return XD(OP((e=Sh(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Ie.forEach(["delete","get","head","options"],function(e){X0.prototype[e]=function(t,i){return this.request(Sh(i||{},{method:e,url:t,data:(i||{}).data}))}}),Ie.forEach(["post","put","patch"],function(e){function t(i){return function(r,n,s){return this.request(Sh(s||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}X0.prototype[e]=t(),X0.prototype[e+"Form"]=t(!0)});var J0=X0;class kA{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let i;this.promise=new we(function(n){i=n});let r=this;this.promise.then(n=>{if(!r._listeners)return;let s=r._listeners.length;for(;s-- >0;)r._listeners[s](n);r._listeners=null}),this.promise.then=n=>{let s,c=new we(l=>{r.subscribe(l),s=l}).then(n);return c.cancel=function(){r.unsubscribe(s)},c},t(function(n,s,c){r.reason||(r.reason=new Yf(n,s,c),i(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;let i=this._listeners.indexOf(t);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){let t=new AbortController,i=r=>{t.abort(r)};return this.subscribe(i),t.signal.unsubscribe=()=>this.unsubscribe(i),t.signal}static source(){let t;return{token:new kA(function(i){t=i}),cancel:t}}}var m8=kA;let MA={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(MA).forEach(e=>{let[t,i]=e;MA[i]=t});var _8=MA;let Wr=(function e(t){let i=new J0(t),r=PD(J0.prototype.request,i);return Ie.extend(r,J0.prototype,i,{allOwnKeys:!0}),Ie.extend(r,i,null,{allOwnKeys:!0}),r.create=function(n){return e(Sh(t,n))},r})(CA);Wr.Axios=J0,Wr.CanceledError=Yf,Wr.CancelToken=m8,Wr.isCancel=bP,Wr.VERSION=WP,Wr.toFormData=O0,Wr.AxiosError=Kt,Wr.Cancel=Wr.CanceledError,Wr.all=function(e){return we.all(e)},Wr.spread=function(e){return function(t){return e.apply(null,t)}},Wr.isAxiosError=function(e){return Ie.isObject(e)&&e.isAxiosError===!0},Wr.mergeConfig=Sh,Wr.AxiosHeaders=to,Wr.formToJSON=e=>yP(Ie.isHTMLForm(e)?new FormData(e):e),Wr.getAdapter=GP.getAdapter,Wr.HttpStatusCode=_8,Wr.default=Wr;var Tn=Wr;let E8=()=>{};function vg(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:E8};return e.promise=new we((t,i)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=r=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,i(r))}}),e}let Z0=new Map,Q0=new Map,$o=new Map,rr=(function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e})({}),Pt=(function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e})({}),KP=new YB,io=KP.getResult(),xA=null;function Ct(e){if(!xA){io=KP.getResult();let t=(function(l){if(l.engine.name==="Blink"&&l.browser.name!=="WeChat")return Pt.CHROME;switch(l.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Pt.CHROME;case"Safari":case"Mobile Safari":return Pt.SAFARI;case"Edge":return Pt.EDGE;case"Firefox":return Pt.FIREFOX;case"QQ":case"QQBrowser":return Pt.QQ;case"Opera":return Pt.OPERA;case"WeChat":return Pt.WECHAT;default:return l.browser.name||""}})(io),i=YP(io),r=(function(l){return l.os.name==="Windows"?l.os.version?l.os.name+" "+l.os.version:l.os.name:l.os.name||""})(io),n=io.os.version,s=YP(io,!1),c=io.device.type;if(!(t&&i&&r&&n))return{name:t,version:i,os:r,osVersion:n,browserVersion:s,deviceType:c};xA={name:t,version:i,os:r,osVersion:n,browserVersion:s,deviceType:c}}return xA}function YP(e){let t,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",i?t.split(".")[0]:t}function $0(){return Ct().os}function qP(){let e=Ct();return"".concat(e.os," ").concat(e.osVersion)}function eR(){let e=Ct();return!!(io.engine.name==="WebKit"&&e.os===rr.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Pt.SAFARI||zr()&&e.name!==Pt.SAFARI)}function al(){return Ct().name===Pt.CHROME}function Rr(){return Ct().name===Pt.SAFARI}function XP(){let e=Ct();if(e.name!==Pt.SAFARI||!e.browserVersion)return!1;let t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function JP(){return Ct().name===Pt.EDGE}function Ri(){return Ct().name===Pt.FIREFOX}function zr(){return Ct().os===rr.IOS}function qf(e){let t=Ct();return!(t.name!==Pt.CHROME||!t.osVersion)&&Number(t.version)>=e}function ZP(e){let t=Ct();return!(t.name!==Pt.CHROME||!t.osVersion)&&Number(t.version)<e}function UA(e,t,i){let r=Ct();return!(r.name!==e||!r.osVersion)&&(i?Number(r.version)>=t&&Number(r.version)<=i:Number(r.version)===t)}function VA(e){let t=Ct();return!(t.name!==Pt.EDGE||!t.osVersion)&&Number(t.version)>=e}function BA(e){let t=Ct();return!(t.name!==Pt.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function QP(e){let t=Ct();return!(t.name!==Pt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function $P(e,t,i){let r=Ct();if(r.os!==rr.IOS||!r.osVersion)return!1;let n=r.osVersion.split(".");return i?t&&Number(n[0])===e&&Number(n[1])>t||Number(n[0])>e:t?Number(n[0])===e&&Number(n[1])>=t||Number(n[0])>e:Number(n[0])>=e}function eL(e,t,i){let r=Ct();if(r.os!==rr.IOS||!r.osVersion)return!1;let n=r.osVersion.split(".");return t&&Number(n[0])===e&&Number(n[1])<t||Number(n[0])<e}function jA(e,t,i){let r=Ct();if(r.name!==Pt.SAFARI||!r.osVersion||!r.browserVersion)return!1;let n=r.browserVersion.split(".");return i?t&&Number(n[0])===e&&Number(n[1])<t||Number(n[0])<e:t?Number(n[0])===e&&Number(n[1])<=t||Number(n[0])<e:Number(n[0])<=e}function FA(e){let t=Ct();return!(t.name!==Pt.OPERA||!t.osVersion)&&Number(t.version)>=e}function tL(){let e=Ct();if(e.os!==rr.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Xf(){let e=Ct();if(e.os!==rr.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15}function GA(){let e=Ct();if(e.os!==rr.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===16}function iL(){let e=Ct();if(e.os!==rr.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function gs(){return Rr()&&navigator.maxTouchPoints>0}function rL(){return Ct().name===Pt.WECHAT}function nL(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function HA(){let e=$0();return(function(){let{deviceType:t}=Ct();return t==="mobile"||t==="tablet"})()||e===rr.ANDROID||e===rr.IOS||e===rr.HARMONY_OS}function sl(){let e=Ct();return e.name!==Pt.EDGE&&e.name!==Pt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function tR(){return $0()===rr.ANDROID}function Rg(){let e=Ct();return tR()&&(e.name===Pt.CHROME||e.name===Pt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function at(e,t,i){return(t=(function(r){var n=(function(s,c){if(typeof s!="object"||!s)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var d=l.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)})(r);return typeof n=="symbol"?n:n+""})(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function aL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function ge(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?aL(Object(i),!0).forEach(function(r){at(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):aL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let k=(function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e})({}),ne=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(t),at(this,"code",void 0),at(this,"message",void 0),at(this,"data",void 0),at(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function ro(e,t){if(typeof e!="boolean")throw new ne(k.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function $i(e,t,i){if(!ve(i).call(i,e))throw new ne(k.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(i)))}function Yt(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<i||e>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!(function(n){return typeof n=="number"&&n%1==0})(e))throw new ne(k.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(i,", ").concat(r,"]. integer only"))}function WA(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new ne(k.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&Yt(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&Yt(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&Yt(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&Yt(e.ideal,"".concat(t,".ideal"),1,1/0)}else Yt(e,t,1,1/0)}function pr(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,n=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new ne(k.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!sL(e,i,r,n))throw new ne(k.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(i,",").concat(r,"].").concat(n?" ASCII characters only.":""))}function ol(e,t){if(!Array.isArray(e))throw new ne(k.INVALID_PARAMS,"".concat(t," should be an array"))}function yi(e){return e==null}function sL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=i&&e.length>=t&&(!r||(function(n){if(typeof n!="string")return!1;for(let s=0;s<n.length;s+=1){let c=n.charCodeAt(s);if(c<0||c>255)return!1}return!0})(e))}var yg=(function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e})(yg||{}),zA=(function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e})(zA||{});let oL=new class{constructor(){at(this,"_clientSize",null),at(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),at(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),at(this,"getStyle",e=>window.getComputedStyle(e,null)),at(this,"checkCssVisibleProperty",e=>{var t;let i=!0,r=this.getStyle(e),{display:n,visibility:s,opacity:c,filter:l}=r;return(n==="none"||ve(t=["hidden","collapse"]).call(t,s)||Number(c)<.1)&&(i=!1),!!i&&(l&&l.split(" ").filter(d=>{var h;let p=d.split("(")[0];return ve(h=["brightness","blur","opacity"]).call(h,p)}).map(d=>{let[h,p]=d.split(/\(|\)/);return[h,Number(p.match(/^[0-9\.]+/))]}).forEach(d=>{let[h,p]=d;switch(h){case"brightness":(p<.1||p>3)&&(i=!1);break;case"blur":p>3&&(i=!1);break;case"opacity":p<.1&&(i=!1)}}),i)}),at(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let i=!0,r=!0,n=c=>t(c),s=e;for(;s&&r;)n(s)||(i=!1,r=!1),s=s.parentElement,s||(r=!1);return i}),at(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),at(this,"getSizeAboutClient",e=>{let{width:t,height:i,left:r,right:n,top:s,bottom:c}=e.getBoundingClientRect(),l=this.getClientWidth(),d=this.getClientHeight();return{width:t,height:i,left:r,right:n,top:s,bottom:c,clientWidth:l,clientHeight:d,clientMin:Math.min(l,d)}}),at(this,"checkActualSize",()=>{let{width:e,height:t,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(e,t,i)}),at(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),at(this,"checkCoverForAPoint",(e,t,i)=>{let r=this.elementFromPoint(e,t);return r!==null&&r!==i}),at(this,"getPointPositionList",()=>{let{width:e,height:t,left:i,top:r}=this._clientSize,n=e/6,s=t/6,c=[],l=10**6;for(let d=0;d<5;d++)for(let h=0;h<5;h++){let p=(i*l+(d===0?.1:d===4?(n*d*l-1e5)/l:n*d)*l)/l,_=(r*l+(h===0?.1:h===4?(s*h*l-1e5)/l:s*h)*l)/l;c.push({x:p,y:_})}return[...c]}),at(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),at(this,"checkSizeIsVisible",(e,t,i)=>(e>50||i/e<=10)&&(t>50||i/t<=10)),at(this,"checkSizeOfPartInClient",()=>{let{left:e,right:t,top:i,bottom:r,clientHeight:n,clientWidth:s,clientMin:c}=this._clientSize,l,d,h,p;if(e<0)l=0;else{if(!(e<s))return!1;l=e}if(t<0)return!1;if(d=t<s?t:s,i<0)h=0;else{if(!(i<n))return!1;h=i}if(r<0)return!1;p=r<n?r:n;let _=d-l,E=p-h;return this.checkSizeIsVisible(_,E,c)}),at(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),at(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(yg.COVERED);{let t=this.checkActualSize(),i=this.checkSizeOfPartInClient();return t&&!i?this.returnHiddenResult(yg.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(yg.SIZE)}}return this.returnHiddenResult(yg.STYLE)}return this.returnHiddenResult(zA.UNMOUNTED)}return this.returnHiddenResult(zA.INVALID_HTML_ELEMENT)}),at(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function KA(e){return new TextEncoder().encode(e)}let cL=function(e,t){let i=new Uint8Array(e.byteLength+t.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(t),e.byteLength),i},YA=async e=>(function(t,i){let r="";return new Uint8Array(t).forEach(n=>{r+=n.toString(i).padStart(2,"0")}),r})(await crypto.subtle.digest("SHA-256",KA(e)),16);class Ei{constructor(){at(this,"_events",{}),at(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(i=>i.listener):[]}on(t,i){this._events[t]||(this._events[t]=[]);let r=this._events[t];this._indexOfListener(r,i)===-1&&r.push({listener:i,once:!1})}once(t,i){this._events[t]||(this._events[t]=[]);let r=this._events[t];this._indexOfListener(r,i)===-1&&r.push({listener:i,once:!0})}off(t,i){if(!this._events[t])return;let r=this._events[t],n=this._indexOfListener(r,i);n!==-1&&r.splice(n,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);let i=this._events[t].map(c=>c);for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];for(let c=0;c<i.length;c+=1){let l=i[c];l.once&&this.off(t,l.listener),l.listener.apply(this,n||[])}}safeEmit(t){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];[...this._events[t]||[]].forEach(s=>{s.once&&this.off(t,s.listener);try{s.listener.apply(this,r)}catch(c){console.error("safeEmit event:".concat(t," error ").concat(c?.toString()))}})}_indexOfListener(t,i){let r=t.length;for(;r--;)if(t[r].listener===i)return r;return-1}}let Cg=null;function lL(){if(Cg)return Cg;if(window.electron)return Cg=window.electron;if(!window.require)return null;try{return Cg=window.require("electron"),Cg}catch{return null}}let Oi=(function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e})({}),pi=(function(e){return e.TRACER="tracer",e})({});function dL(e){return Yt(e.timeout,"config.timeout",0,1e5),Yt(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Yt(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Yt(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let g8=(function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e})({}),Bt=(function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e})({});function bg(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function uL(e){return pr(e.turnServerURL,"turnServerURL"),pr(e.username,"username"),pr(e.password,"password"),e.udpport&&Yt(e.udpport,"udpport",1,99999,!0),e.forceturn&&ro(e.forceturn,"forceturn"),e.security&&ro(e.security,"security"),e.tcpport&&Yt(e.tcpport,"tcpport",1,99999,!0),!0}function qA(e){return e.level!==void 0&&$i(e.level,"level",[1,2,3]),e.delay!==void 0&&Yt(e.delay,"delay",0,3e3,!0),!0}let Tt=(function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e})({}),yr=(function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e})({}),$n=(function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({}),Jf=(function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({});function Cr(e,t){for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];return e.getListeners(t).length===0?we.reject(new ne(k.UNEXPECTED_ERROR,"can not emit promise")):new we((s,c)=>{e.emit(t,...r,s,c)})}function Jt(e,t){if(e.getListeners(t).length===0)return we.resolve();for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];return Cr(e,t,...r)}function fa(e,t){if(e.getListeners(t).length===0)return null;for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];return Ag(e,t,...r)}function Ag(e,t){let i=null,r=null;for(var n=arguments.length,s=new Array(n>2?n-2:0),c=2;c<n;c++)s[c-2]=arguments[c];if(e.emit(t,...s,l=>{i=l},l=>{r=l}),r!==null)throw r;if(i===null)throw new ne(k.UNEXPECTED_ERROR,"handler is not sync");return i}let Bi=new class extends Ei{set networkState(e){this.emit(Jf.NETWORK_STATE_CHANGE,e,this._networkState),e===$n.ONLINE?this.emit(Jf.ONLINE):e===$n.OFFLINE&&(this.onlineWaiter=new we(t=>{this.once(Jf.ONLINE,()=>{this.onlineWaiter=void 0,t($n.ONLINE)})}),this.emit(Jf.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===$n.ONLINE}constructor(){super(),at(this,"_moduleName","network-indicator"),at(this,"_networkState",$n.ONLINE),at(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=$n.ONLINE}),window.addEventListener("offline",()=>{this.networkState=$n.OFFLINE})}};function iR(e,t){let i=e.indexOf(t);i!==-1&&e.splice(i,1)}function Zf(e){let t=[];return e.forEach(i=>{t.indexOf(i)===-1&&t.push(i)}),t}function rR(e){we!==void 0?we.resolve().then(e):setTimeout(e,0)}function fi(e){return JSON.parse(JSON.stringify(e))}function Th(e){try{return fi(e)}catch{return e}}let hL={};function Nd(e,t){hL[t]||(hL[t]=!0,e())}function vh(e){let t=window.atob(e),i=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)i[r]=t.charCodeAt(r);return i}function Dd(e){let t="";for(let i=0;i<e.length;i+=1)t+=String.fromCharCode(e[i]);return window.btoa(t)}function pL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(e);if(i.length>t)i=i.slice(0,t);else if(i.length<t){let r=new Uint8Array(t);r.set(i),i=r}return i}function fL(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=In(t).call(t,(c,l)=>c+l.length,0),n=new Uint8Array(new ArrayBuffer(r)),s=0;return t.forEach(c=>{n.set(c,s),s+=c.length}),n}function ec(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function mL(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(i=>{t+=typeof i=="string"?ec(i):i.size}),t+138}function S8(e){let t=new ne(k.TIMEOUT,"timeout");return new we((i,r)=>{window.setTimeout(()=>r(t),e)})}function fr(e){return new we(t=>{window.setTimeout(t,e)})}function Zt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?"".concat(t).concat(i):"".concat(t).concat(i)+Zt(e-i.length,"")}function Rh(){return Zt(32,"").toUpperCase()}let nR=()=>{},_L=new class{constructor(){at(this,"fnMap",new Map)}throttleByKey(e,t,i,r){for(var n=arguments.length,s=new Array(n>4?n-4:0),c=4;c<n;c++)s[c-4]=arguments[c];if(this.fnMap.has(t)){let l=this.fnMap.get(t);if(l.threshold!==i){l.fn(...l.args),clearTimeout(l.timer);let d=window.setTimeout(()=>{let h=this.fnMap.get(t);h&&h.fn(...h.args),this.fnMap.delete(t)},i);this.fnMap.set(t,{fn:e,threshold:i,timer:d,args:s,skipFn:r})}else l.skipFn&&l.skipFn(...l.args),this.fnMap.set(t,ge(ge({},l),{},{fn:e,args:s,skipFn:r}))}else{let l=window.setTimeout(()=>{let d=this.fnMap.get(t);d&&d.fn(...d.args),this.fnMap.delete(t)},i);this.fnMap.set(t,{fn:e,threshold:i,timer:l,args:s,skipFn:r})}}},EL=_L.throttleByKey.bind(_L);function gL(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function XA(e,t){if(!gL(e)||!gL(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){let i=[...e];for(let r=0;r<t.length;r++)i[r]=XA(e[r],t[r]);return i}{let i=ge({},e);for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?i[r]=XA(e[r],t[r]):i[r]=t[r]);return i}}function SL(e,t){let i=[0];if(i=new Array(t).fill(0),e===0)return i;let r=0;for(;e>0&&(i[r]=255&e,e>>=8,r++,r!==t););return i}function Qf(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function JA(e){return In(e).call(e,(t,i)=>t+i,0)}function TL(e){let t="0123456789abcdef";function i(B){let Y,H="";for(Y=0;Y<=3;Y++)H+=t.charAt(B>>8*Y+4&15)+t.charAt(B>>8*Y&15);return H}function r(B,Y){let H=(65535&B)+(65535&Y);return(B>>16)+(Y>>16)+(H>>16)<<16|65535&H}function n(B,Y,H,G,Q,ce){return r((function(he,Se){return he<<Se|he>>>32-Se})(r(r(Y,B),r(G,ce)),Q),H)}function s(B,Y,H,G,Q,ce,he){return n(Y&H|~Y&G,B,Y,Q,ce,he)}function c(B,Y,H,G,Q,ce,he){return n(Y&G|H&~G,B,Y,Q,ce,he)}function l(B,Y,H,G,Q,ce,he){return n(Y^H^G,B,Y,Q,ce,he)}function d(B,Y,H,G,Q,ce,he){return n(H^(Y|~G),B,Y,Q,ce,he)}let h=(function(B){let Y,H=1+(B.length+8>>6),G=new Array(16*H);for(Y=0;Y<16*H;Y++)G[Y]=0;for(Y=0;Y<B.length;Y++)G[Y>>2]|=B.charCodeAt(Y)<<Y%4*8;return G[Y>>2]|=128<<Y%4*8,G[16*H-2]=8*B.length,G})(e),p,_,E,R,N,w=1732584193,O=-271733879,L=-1732584194,M=271733878;for(p=0;p<h.length;p+=16)_=w,E=O,R=L,N=M,w=s(w,O,L,M,h[p+0],7,-680876936),M=s(M,w,O,L,h[p+1],12,-389564586),L=s(L,M,w,O,h[p+2],17,606105819),O=s(O,L,M,w,h[p+3],22,-1044525330),w=s(w,O,L,M,h[p+4],7,-176418897),M=s(M,w,O,L,h[p+5],12,1200080426),L=s(L,M,w,O,h[p+6],17,-1473231341),O=s(O,L,M,w,h[p+7],22,-45705983),w=s(w,O,L,M,h[p+8],7,1770035416),M=s(M,w,O,L,h[p+9],12,-1958414417),L=s(L,M,w,O,h[p+10],17,-42063),O=s(O,L,M,w,h[p+11],22,-1990404162),w=s(w,O,L,M,h[p+12],7,1804603682),M=s(M,w,O,L,h[p+13],12,-40341101),L=s(L,M,w,O,h[p+14],17,-1502002290),O=s(O,L,M,w,h[p+15],22,1236535329),w=c(w,O,L,M,h[p+1],5,-165796510),M=c(M,w,O,L,h[p+6],9,-1069501632),L=c(L,M,w,O,h[p+11],14,643717713),O=c(O,L,M,w,h[p+0],20,-373897302),w=c(w,O,L,M,h[p+5],5,-701558691),M=c(M,w,O,L,h[p+10],9,38016083),L=c(L,M,w,O,h[p+15],14,-660478335),O=c(O,L,M,w,h[p+4],20,-405537848),w=c(w,O,L,M,h[p+9],5,568446438),M=c(M,w,O,L,h[p+14],9,-1019803690),L=c(L,M,w,O,h[p+3],14,-187363961),O=c(O,L,M,w,h[p+8],20,1163531501),w=c(w,O,L,M,h[p+13],5,-1444681467),M=c(M,w,O,L,h[p+2],9,-51403784),L=c(L,M,w,O,h[p+7],14,1735328473),O=c(O,L,M,w,h[p+12],20,-1926607734),w=l(w,O,L,M,h[p+5],4,-378558),M=l(M,w,O,L,h[p+8],11,-2022574463),L=l(L,M,w,O,h[p+11],16,1839030562),O=l(O,L,M,w,h[p+14],23,-35309556),w=l(w,O,L,M,h[p+1],4,-1530992060),M=l(M,w,O,L,h[p+4],11,1272893353),L=l(L,M,w,O,h[p+7],16,-155497632),O=l(O,L,M,w,h[p+10],23,-1094730640),w=l(w,O,L,M,h[p+13],4,681279174),M=l(M,w,O,L,h[p+0],11,-358537222),L=l(L,M,w,O,h[p+3],16,-722521979),O=l(O,L,M,w,h[p+6],23,76029189),w=l(w,O,L,M,h[p+9],4,-640364487),M=l(M,w,O,L,h[p+12],11,-421815835),L=l(L,M,w,O,h[p+15],16,530742520),O=l(O,L,M,w,h[p+2],23,-995338651),w=d(w,O,L,M,h[p+0],6,-198630844),M=d(M,w,O,L,h[p+7],10,1126891415),L=d(L,M,w,O,h[p+14],15,-1416354905),O=d(O,L,M,w,h[p+5],21,-57434055),w=d(w,O,L,M,h[p+12],6,1700485571),M=d(M,w,O,L,h[p+3],10,-1894986606),L=d(L,M,w,O,h[p+10],15,-1051523),O=d(O,L,M,w,h[p+1],21,-2054922799),w=d(w,O,L,M,h[p+8],6,1873313359),M=d(M,w,O,L,h[p+15],10,-30611744),L=d(L,M,w,O,h[p+6],15,-1560198380),O=d(O,L,M,w,h[p+13],21,1309151649),w=d(w,O,L,M,h[p+4],6,-145523070),M=d(M,w,O,L,h[p+11],10,-1120210379),L=d(L,M,w,O,h[p+2],15,718787259),O=d(O,L,M,w,h[p+9],21,-343485551),w=r(w,_),O=r(O,E),L=r(L,R),M=r(M,N);return i(w)+i(O)+i(L)+i(M)}let T8=1,vL=console,Lr=class{static setLogger(e){vL=e}constructor(e,t){at(this,"id",void 0),at(this,"lockingPromise",we.resolve()),at(this,"locks",0),at(this,"name",""),at(this,"lockId",void 0),this.lockId=T8++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){let i=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),r=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");vL.debug("".concat(i," ").concat(r))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);let i=new we(n=>{t=()=>{this.locks-=1,this.logger("unlocked",e),n()}}),r=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>i),r}};function $f(e,t){return function(i,r,n){let s=n.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){let c=this[t];if(!c)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));let l=await c.lock("From ".concat(e,".").concat(r));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await s.apply(this,h)}finally{l()}},n}}let Wi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function ZA(e,t){let i=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,i)}function no(e,t,i,r){let n=Object.assign({},Wi,r),s=n.timeout,c=async()=>{await(function(h){return new we(p=>{window.setTimeout(p,h)})})(s),s*=n.timeoutFactor,s=Math.min(n.maxRetryTimeout,s)},l=!1,d=new we(async(h,p)=>{t=t||(()=>!1),i=i||(()=>!0);for(let _=0;_<n.maxRetryCount;_+=1){if(l)return p(new ne(k.OPERATION_ABORTED));try{let E=await e();if(!t(E,_)||_+1===n.maxRetryCount)return h(E);await c()}catch(E){if(!i(E,_)||_+1===n.maxRetryCount)return p(E);await c()}}});return d.cancel=()=>l=!0,d}let aR,RL=class{constructor(e){at(this,"input",[]),at(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:In(e=this.input).call(e,(t,i)=>t+i)/this.input.length}},sR=0,QA=0;function $A(e,t,i,r){return new we((n,s)=>{t.responseType=t.responseType||"json",t.data&&!i?(t.data=JSON.stringify(t.data),sR+=ec(t.data)):i&&(t.data.size?sR+=t.data.size:t.data instanceof FormData?sR+=mL(t.data):sR+=ec(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Tn.request(t).then(c=>{typeof c.data=="string"?QA+=ec(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?QA+=c.data.byteLength:QA+=ec(JSON.stringify(c.data)),n(c.data)}).catch(c=>{Tn.isCancel(c)?s(new ne(k.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?s(new ne(k.NETWORK_TIMEOUT,c.message)):c.response?s(new ne(k.NETWORK_RESPONSE_ERROR,c.response.status)):s(new ne(k.NETWORK_ERROR,c.message))})})}async function v8(e,t){let i=new Blob([t.data],{type:"buffer"});return await $A(e,ge(ge({},t),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}let yL=()=>window.isSecureContext!==void 0;function Ss(e){if(Array.isArray(e))return e.map(i=>i);if(!CL(e))return e;let t={};for(let i in e){let r=e[i];CL(r)||Array.isArray(r)?t[i]=Ss(r):t[i]=r}return t}function CL(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let ew=class{constructor(e){at(this,"input",[]),at(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}},tc={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},wg={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:tc,remoteCandidate:tc},updateInterval:0},bL={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},AL={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},wL={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},IL={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0},tw=class{constructor(e,t){at(this,"onFirstVideoReceived",void 0),at(this,"onFirstVideoDecoded",void 0),at(this,"onFirstAudioReceived",void 0),at(this,"onFirstVideoDecodedTimeout",void 0),at(this,"onFirstAudioDecoded",void 0),at(this,"onSelectedLocalCandidateChanged",void 0),at(this,"onSelectedRemoteCandidateChanged",void 0),at(this,"videoIsReady",!1),at(this,"videoIsReady2",{}),at(this,"pc",void 0),at(this,"options",void 0),at(this,"intervalTimer",void 0),at(this,"stats",Ss(wg)),at(this,"isFirstVideoReceived",{}),at(this,"isFirstVideoDecoded",{}),at(this,"isFirstAudioReceived",{}),at(this,"isFirstAudioDecoded",{}),at(this,"isFirstVideoDecodedTimeout",{}),at(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new we(e=>{e({local:ge({},tc),remote:ge({},tc)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let t=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"],r=0,n=0,s=0,c=0;for(let l of i)e[l].forEach((d,h)=>{if(!this.lossRateWindowStats[t-1][l][h]||!this.lossRateWindowStats[0][l][h])return;let p=this.lossRateWindowStats[t-1][l][h].packets-this.lossRateWindowStats[0][l][h].packets,_=this.lossRateWindowStats[t-1][l][h].packetsLost-this.lossRateWindowStats[0][l][h].packetsLost;l==="videoSend"||l==="audioSend"?(r+=p,s+=_):(n+=p,c+=_),Number.isNaN(p)||Number.isNaN(p)?d.packetLostRate=0:d.packetLostRate=p<=0||_<=0?0:_/(p+_)});e.sendPacketLossRate=r<=0||s<=0?0:s/(r+s),e.recvPacketLossRate=n<=0||c<=0?0:c/(n+c)}},R8=class extends tw{constructor(){super(...arguments),at(this,"_stats",wg),at(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Ss(wg);let i=t.filter(n=>n.type==="ssrc");this.processSSRCStats(i);let r=t.find(n=>n.type==="VideoBwe");r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var i;let r=ve(i=t.id).call(i,"send");switch("".concat(t.mediaType,"_").concat(r?"send":"recv")){case"video_send":{let n=Ss(AL);n.codec=t.googCodecName,n.adaptionChangeReason="none",t.googCpuLimitedResolution&&(n.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(n.adaptionChangeReason="bandwidth"),n.avgEncodeMs=Number(t.googAvgEncodeMs),n.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},n.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},n.firsCount=Number(t.googFirReceived),n.nacksCount=Number(t.googNacksReceived),n.plisCount=Number(t.googPlisReceived),n.frameCount=Number(t.framesEncoded),n.bytes=Number(t.bytesSent),n.packets=Number(t.packetsSent),n.packetsLost=Number(t.packetsLost),n.ssrc=Number(t.ssrc),n.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(n),this._stats.rtt=n.rttMs;break}case"video_recv":{let n=Ss(bL),s=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(n.codec=t.googCodecName,n.targetDelayMs=Number(t.googTargetDelayMs),n.renderDelayMs=Number(t.googRenderDelayMs),n.currentDelayMs=Number(t.googCurrentDelayMs),n.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),n.decodeMs=Number(t.googDecodeMs),n.maxDecodeMs=Number(t.googMaxDecodeMs),n.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},n.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},n.decodeFrameRate=Number(t.googFrameRateDecoded),n.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},n.jitterBufferMs=Number(t.googJitterBufferMs),n.firsCount=Number(t.googFirsSent),n.nacksCount=Number(t.googNacksSent),n.plisCount=Number(t.googPlisSent),n.framesDecodeCount=Number(t.framesDecoded),n.bytes=Number(t.bytesReceived),n.packets=Number(t.packetsReceived),n.packetsLost=Number(t.packetsLost),n.ssrc=Number(t.ssrc),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,n.decodedFrame.width,n.decodedFrame.height),this.isFirstVideoDecoded[n.ssrc]=!0),s){let c=s.stats,l=Date.now()-s.lts;n.framesDecodeFreezeTime=c.framesDecodeFreezeTime,n.framesDecodeInterval=c.framesDecodeInterval,n.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(s.lts=Date.now(),n.framesDecodeInterval=l,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):n.framesDecodeCount<s.stats.framesDecodeCount&&(n.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:ge({},n),lts:Date.now()}),this._stats.videoRecv.push(n);break}case"audio_recv":{let n=Ss(IL);n.codec=t.googCodecName,n.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,n.decodingCNG=Number(t.googDecodingCNG),n.decodingCTN=Number(t.googDecodingCTN),n.decodingCTSG=Number(t.googDecodingCTSG),n.decodingNormal=Number(t.googDecodingNormal),n.decodingPLC=Number(t.googDecodingPLC),n.decodingPLCCNG=Number(t.googDecodingPLCCNG),n.expandRate=Number(t.googExpandRate),n.accelerateRate=Number(t.googAccelerateRate),n.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),n.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),n.speechExpandRate=Number(t.googSpeechExpandRate),n.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),n.jitterBufferMs=Number(t.googJitterBufferMs),n.jitterMs=Number(t.googJitterReceived),n.bytes=Number(t.bytesReceived),n.packets=Number(t.packetsReceived),n.packetsLost=Number(t.packetsLost),n.ssrc=Number(t.ssrc),n.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),n.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.decodingNormal>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),this._stats.audioRecv.push(n);break}case"audio_send":{let n=Ss(wL);n.codec=t.googCodecName,n.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,n.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),n.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),n.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),n.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),n.bytes=Number(t.bytesSent),n.packets=Number(t.packetsSent),n.packetsLost=Number(t.packetsLost),n.ssrc=Number(t.ssrc),n.rttMs=Number(t.googRtt||0),this._stats.rtt=n.rttMs,this._stats.audioSend.push(n);break}}})}_getStats(){return new we((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){let t=[];return e.result().forEach(i=>{let r={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(n=>{r[n]=i.stat(n)}),t.push(r)}),t}},Ig=(function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e})({}),oR=(function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e})({}),iw=(function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e})({}),ma=(function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e})({});var em=(function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e})(em||{});function Og(e,t,i,r){let n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:em.kNone;if(!t)return;let s=Number(t[i]);if(typeof s!="number")return;let c=Number(t[r]);if(typeof c!="number")return;if(!e)return c?s/c*n:void 0;let l=Number(e[i]);if(typeof l!="number")return;let d=Number(e[r]);if(typeof d!="number")return;let h=c-d;return h?(s-l)/h*n:void 0}let OL=class extends tw{constructor(){super(...arguments),at(this,"_stats",wg),at(this,"report",void 0),at(this,"lastDecodeVideoReceiverStats",new Map),at(this,"lastVideoFramesRecv",new Map),at(this,"lastVideoFramesSent",new Map),at(this,"lastVideoFramesDecode",new Map),at(this,"lastVideoFramesOutput",new Map),at(this,"lastVideoJBDelay",new Map),at(this,"lastAudioJBDelay",new Map),at(this,"mediaBytesSent",new Map),at(this,"mediaBytesRetransmit",new Map),at(this,"mediaBytesTargetEncode",new Map),at(this,"lastDecodeAudioReceiverStats",new Map),at(this,"lastAudioConcealment",new Map),at(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Ss(wg),this.report.forEach(e=>{switch(e.type){case ma.OUTBOUND:case ma.INBOUND:{let t=e.mediaType||e.kind,i=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===ma.OUTBOUND?t==="audio"||r?this.processAudioOutboundStats(e):(t==="video"||i)&&this.processVideoOutboundStats(e):e.type===ma.INBOUND&&(t==="audio"||r?this.processAudioInboundStats(e):(t==="video"||i)&&this.processVideoInboundStats(e));break}case ma.TRANSPORT:{let t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case ma.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let e=await this.pc.getStats(),t={local:ge({},tc),remote:ge({},tc)};return e.forEach(i=>{let r;if(i.type===ma.TRANSPORT&&(r=e.get(i.selectedCandidatePairId)),i.type===ma.CANDIDATE_PAIR&&i.selected&&(r=i),r){let n=(s,c)=>{s.type=c.type,s.id=c.id,c.address&&(s.address=c.address),c.candidateType&&(s.candidateType=c.candidateType),c.port&&(s.port=c.port),c.priority&&(s.priority=c.priority),c.protocol&&(s.protocol=c.protocol),c.relayProtocol&&(s.relayProtocol=c.relayProtocol)};if(r.localCandidateId){let s=e.get(r.localCandidateId);s&&n(t.local,s)}if(r.remoteCandidateId){let s=e.get(r.remoteCandidateId);s&&n(t.remote,s)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){let t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){let t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===ma.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===ma.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===ma.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(ge({},t),ge({},this.stats.selectedCandidatePair.localCandidate)),e.type===ma.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(ge({},t),ge({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(r=>r.ssrc===e.ssrc);t||(t=Ss(IL),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;let i=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Og(i,t,"totalProcessingDelay","jitterBufferEmittedCount",em.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,i,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,ge({},t))}calculateAudioFreeze(e,t,i){let r=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&r!=null){let n=r.lts,s=i.timestamp,c=s-n;if(c<=0)return;let l=e.concealedSamples-t.concealedSamples-0,d=r.nonSilent+l,h=e.totalSamplesReceived-t.totalSamplesReceived;if(h<=0)return;let p=80*h/c,_=200*h/c,E=c/h,R=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,d>p&&(r.plc80>0?(e.freezeSamples80+=l,e.freezeMs80+=Math.round(l*E)):(e.freezeSamples80+=d,e.freezeMs80+=Math.round(d*E)),R=r.plc80+1);let N=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,d>_&&(r.plc200>0?(e.freezeSamples200+=l,e.freezeMs200+=Math.round(l*E)):(e.freezeSamples200+=d,e.freezeMs200+=Math.round(d*E)),N=r.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:l,lts:s,plc80:R,plc200:N})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:i.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(c=>c.ssrc===e.ssrc);t||(t=Ss(bL),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;let i=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),n=this.lastVideoFramesOutput.get(t.ssrc),s=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){let c=t.decodedFrame?t.decodedFrame.width:0,l=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,c,l),this.isFirstVideoDecoded[t.ssrc]=!0}if(i){let c=i.stats,l=s-i.lts;t.framesDecodeFreezeTime=c.framesDecodeFreezeTime,t.framesDecodeInterval=c.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&l>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(i.lts=Date.now(),t.framesDecodeInterval=l,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<c.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(i.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-i.qpSum)/(e.framesDecoded-i.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Og(i?.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Og(i?.stats,t,"totalProcessingDelay","framesDecodeCount",em.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Og(i?.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",em.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Og(i?.stats,t,"totalInterFrameDelay","framesDecodeCount",em.kMillisecondsFromSeconds),r&&s-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((s-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:0}),t.framesDroppedCount&&e.framesReceived&&(n&&s-n.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-n.count)/((s-n.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:Math.max(t.outputFrameRate,0)})):n?t.outputFrameRate=n.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:ge({},t),lts:i?i.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(r=>r.ssrc===e.ssrc);t||(t=Ss(AL),this._stats.videoSend.push(t));let i=this.mediaBytesSent.get(e.ssrc);if(i)i.add(e.bytesSent);else{let r=new ew(10);r.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,r)}if(e.retransmittedBytesSent!==void 0){let r=this.mediaBytesRetransmit.get(e.ssrc);if(r)r.add(e.retransmittedBytesSent);else{let n=new ew(10);n.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,n)}}if(e.totalEncodedBytesTarget){let r=this.mediaBytesTargetEncode.get(e.ssrc);if(r)r.add(e.totalEncodedBytesTarget);else{let n=new ew(10);n.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,n)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){let r=this.lastEncoderMs.get(e.ssrc);if(!r||r.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{let n=e.framesEncoded-r.lastFrameCount,s=e.totalEncodeTime-r.lastEncoderTime;t.avgEncodeMs=1e3*s/n}}if(e.framesEncoded&&e.qpSum){let r=this.lastEncoderMs.get(e.ssrc);!r||r.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-r.lastQpSum)/(e.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let r=this.findRemoteStatsId(e.ssrc,ma.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(i=>i.ssrc===e.ssrc);if(t||(t=Ss(wL),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let i=this.findRemoteStatsId(e.ssrc,ma.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,t)}}findRemoteStatsId(e,t){var i;let r=Array.from(Sn(i=this.report).call(i)).find(n=>n.type===t&&n.ssrc===e);return r?r.id:null}processVideoMediaSource(e,t){let i=this.report.get(e);i&&i.width&&i.height&&i.framesPerSecond&&(t.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(e,t){let i=this.report.get(e);i&&(t.inputLevel=i.audioLevel)}processVideoTrackSenderStats(e,t,i){var r,n,s,c;let l=t?this.report.get(t):void 0,d=(r=l?.framesSent)!==null&&r!==void 0?r:e.framesSent;if(typeof d!="number")return;let h=(n=l?.frameWidth)!==null&&n!==void 0?n:e.frameWidth,p=(s=l?.frameHeight)!==null&&s!==void 0?s:e.frameHeight,_=(c=l?.framesPerSecond)!==null&&c!==void 0?c:e.framesPerSecond;if(typeof h=="number"&&typeof p=="number"||(h=0,p=0),_==null){let E=Date.now(),R=this.lastVideoFramesSent.get(i.ssrc);R&&E-R.lts>=800?(_=Math.round((d-R.count)/((E-R.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:d,lts:E,rate:_})):R?_=R.rate:this.lastVideoFramesSent.set(i.ssrc,{count:d,lts:E,rate:0})}i.sentFrame={width:h,height:p,frameRate:Math.max(0,_)}}processVideoTrackReceiverStats(e,t,i){var r,n,s,c,l;let d=t?this.report.get(t):void 0,h=(r=d?.framesReceived)!==null&&r!==void 0?r:e.framesReceived,p=(n=d?.frameWidth)!==null&&n!==void 0?n:e.frameWidth,_=(s=d?.frameHeight)!==null&&s!==void 0?s:e.frameHeight,E=(c=d?.jitterBufferDelay)!==null&&c!==void 0?c:e.jitterBufferDelay,R=(l=d?.jitterBufferEmittedCount)!==null&&l!==void 0?l:e.jitterBufferEmittedCount;if(typeof h=="number"){let N=this.lastVideoFramesRecv.get(i.ssrc),w=Date.now();i.framesReceivedCount=h;let O=0;N&&w-N.lts>=800?(O=Math.round((h-N.count)/((w-N.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:h,lts:w,rate:O})):N?O=N.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:h,lts:w,rate:0}),i.receivedFrame={width:p||0,height:_||0,frameRate:O||0},i.decodedFrame={width:p||0,height:_||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:p||0,height:_||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(E&&R){let N=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},w=N.jitterBufferMs,O=R-N.jitterBufferEmittedCount;O>0&&(w=1e3*(E-N.jitterBufferDelay)/O),i.jitterBufferMs=w,i.currentDelayMs=Math.round(w),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:E,jitterBufferEmittedCount:R,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(e,t,i){var r,n,s,c;let l=t?this.report.get(t):void 0,d=(r=(n=l?.echoReturnLoss)!==null&&n!==void 0?n:e.echoReturnLoss)!==null&&r!==void 0?r:0,h=(s=(c=l?.echoReturnLossEnhancement)!==null&&c!==void 0?c:e.echoReturnLossEnhancement)!==null&&s!==void 0?s:0;i.aecReturnLoss=d,i.aecReturnLossEnhancement=h}processAudioTrackReceiverStats(e,t,i){var r,n,s,c,l,d,h,p,_;let E=t?this.report.get(t):void 0,R=(r=E?.removedSamplesForAcceleration)!==null&&r!==void 0?r:e.removedSamplesForAcceleration,N=(n=E?.totalSamplesReceived)!==null&&n!==void 0?n:e.totalSamplesReceived,w=(s=E?.jitterBufferDelay)!==null&&s!==void 0?s:e.jitterBufferDelay,O=(c=E?.jitterBufferEmittedCount)!==null&&c!==void 0?c:e.jitterBufferEmittedCount,L=(l=E?.audioLevel)!==null&&l!==void 0?l:e?.audioLevel,M=(d=E?.totalSamplesDuration)!==null&&d!==void 0?d:e?.totalSamplesDuration,B=(h=E?.concealedSamples)!==null&&h!==void 0?h:e.concealedSamples,Y=(p=E?.silentConcealedSamples)!==null&&p!==void 0?p:e.silentConcealedSamples,H=(_=E?.concealmentEvents)!==null&&_!==void 0?_:e.concealmentEvents;if(typeof N=="number"&&(i.totalSamplesReceived=N),typeof Y=="number"&&(i.silentConcealedSamples=Y),typeof H=="number"&&(i.concealmentEvents=H),typeof B=="number"&&(i.concealedSamples=B),R&&N&&(i.accelerateRate=R/N),w&&O){let Q=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},ce=Q.jitterBufferMs,he=O-Q.jitterBufferEmittedCount;he>0&&(ce=1e3*(w-Q.jitterBufferDelay)/he),i.jitterBufferMs=Math.round(ce),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:w,jitterBufferEmittedCount:O,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=L;let G=1920;M&&N&&(G=N/M/50,i.receivedFrames=Math.round(N/G)),B&&(i.droppedFrames=Math.round(B/G))}processRemoteInboundStats(e,t){let i=this.report.get(e);i&&(t.packetsLost=i.packetsLost,i.roundTripTime&&(t.rttMs=1e3*i.roundTripTime),i.jitter&&(t.jitterMs=1e3*i.jitter),i.timestamp&&(t.timestamp=i.timestamp))}getCodecFromCodecStats(e){let t=this.report.get(e);if(!t)return"";let i=t.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let e=0,t=null,i=null;this.mediaBytesSent.forEach(n=>{e+=n.diffMean()}),this.mediaBytesRetransmit.forEach(n=>{t=t===null?n.diffMean():t+n.diffMean()}),this.mediaBytesTargetEncode.forEach(n=>{i=i===null?n.diffMean():i+n.diffMean()});let r=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},y8=class extends tw{updateStats(){return we.resolve()}};function rw(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,s=(function(){let c=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return c&&c[0]?Number(c[0].split("/")[1]):null})();return s?s<76?new R8(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:r,firstVideoDecodedTimeout:n}):new OL(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:r,firstVideoDecodedTimeout:n}):(function(c){if(!window.RTCStatsReport)return!1;let l=c.getStats();return!!(l instanceof we||(function(d){return!!d&&(typeof d=="object"||typeof d=="function")&&typeof d.then=="function"})(l))})(e)?new OL(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:r,firstVideoDecodedTimeout:n}):new y8(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:r,firstVideoDecodedTimeout:n})}let NL="websdk_ng_install_id";function nw(){try{if(U("INSTALL_ID"))return U("INSTALL_ID");let e=window.localStorage.getItem(NL);return e||(e=Rh(),window.localStorage.setItem(NL,e)),Ht("INSTALL_ID",e),e}catch{return}}let Fa=(function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){let i=t[1],r=t[2];return"".concat(i,".").concat(r)}return"4.0.0.999"})("4.24.0"),aw=(function(){try{return JSON.parse("true")===!0}catch{return!0}})(),yh=(function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e})({}),br=(function(){let e="us".concat("erna","me"),t="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");let r=i.join(""),n=[];for(let l=0;l<6;l++)n.push("1");let s=n.join(""),c={};return c[e]=r,c[t]=s,Object.assign(c,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})})();window.DEFAULT_TURN_CONFIG=br;let cR={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},sw={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},ow="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",cw={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},di=ge(ge(ge(ge({},cw),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:sw,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},cR),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function Ht(e,t,i){var r,n,s;ve(r=Object.keys(di)).call(r,e)&&(!i&&ve(n=Object.keys(ao)).call(n,e)||(di[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(di.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(s=!!t,di.USE_NEW_NETWORK_CONFIG=s,s&&(di.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],di.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],di.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],di.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],di.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",di.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",di.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(di.ENABLE_INSTANT_VIDEO=!0,di.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(di.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(di.NEW_TURN_MODE||(di.NEW_TURN_MODE=4))))}function U(e){return di[e]}aw||(di.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],di.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],di.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],di.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],di.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],di.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],di.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",di.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",di.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",di.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",di.AREAS=["NORTH_AMERICA","OVERSEA"]);let DL=(function(e){return e[e.REALTIME=1]="REALTIME",e})({}),ao={};var st=(function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e})(st||{});let Ng=(function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e})({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});let PL=128,C8=96,LL=1e3,tm=10,b8=0;var kL=(()=>{var e={8:(r,n,s)=>{s.r(n),s.d(n,{Parser:()=>he,Printer:()=>xt,parse:()=>ye,print:()=>ke});let c=`
`,l="".concat("\r").concat(c),d=" ",h;function p(fe){return fe>="0"&&fe<="9"}function _(fe){return fe>="!"&&fe<="~"}function E(fe){return _(fe)||fe>=""&&fe<=""}function R(fe){return fe==="!"||fe>="#"&&fe<="'"||fe>="*"&&fe<="+"||fe>="-"&&fe<="."||fe>="0"&&fe<="9"||fe>="A"&&fe<="Z"||fe>="^"&&fe<="~"}function N(fe){return fe>="1"&&fe<="9"}function w(fe){return fe>="A"&&fe<="Z"||fe>="a"&&fe<="z"}function O(fe){return fe==="d"||fe==="h"||fe==="m"||fe==="s"}function L(fe){return fe>""&&fe<"	"||fe>"\v"&&fe<"\f"||fe>""&&fe<""}function M(fe){return w(fe)||p(fe)||fe==="+"||fe==="/"}function B(fe){return p(fe)||w(fe)||fe==="+"||fe==="/"||fe==="-"||fe==="_"}function Y(fe){return w(fe)||p(fe)||fe==="+"||fe==="/"}function H(fe,A){var F=Object.keys(fe);if(Object.getOwnPropertySymbols){var K=Object.getOwnPropertySymbols(fe);A&&(K=K.filter(function(Te){return Object.getOwnPropertyDescriptor(fe,Te).enumerable})),F.push.apply(F,K)}return F}function G(fe){for(var A=1;A<arguments.length;A++){var F=arguments[A]!=null?arguments[A]:{};A%2?H(Object(F),!0).forEach(function(K){Q(fe,K,F[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(fe,Object.getOwnPropertyDescriptors(F)):H(Object(F)).forEach(function(K){Object.defineProperty(fe,K,Object.getOwnPropertyDescriptor(F,K))})}return fe}function Q(fe,A,F){return A in fe?Object.defineProperty(fe,A,{value:F,enumerable:!0,configurable:!0,writable:!0}):fe[A]=F,fe}(function(fe){fe.VERSION="v",fe.ORIGIN="o",fe.SESSION_NAME="s",fe.INFORMATION="i",fe.URI="u",fe.EMAIL="e",fe.PHONE="p",fe.CONNECTION="c",fe.BANDWIDTH="b",fe.TIME="t",fe.REPEAT="r",fe.ZONE_ADJUSTMENTS="z",fe.KEY="k",fe.ATTRIBUTE="a",fe.MEDIA="m"})(h||(h={}));class ce{consumeText(A,F){let K=F;for(;K<A.length;){let Te=A[K];if(Te==="\0"||Te==="\r"||Te===c)break;K+=1}if(K-F==0)throw new Error("Invalid text, at ".concat(A));return K}consumeUnicastAddress(A,F,K){return this.consumeTill(A,F,d)}consumeOneOrMore(A,F,K){let Te=F;for(;K(A[Te]);)Te++;if(Te-F==0)throw new Error("Invalid rule at ".concat(F,"."));return Te}consumeSpace(A,F){if(A[F]===d)return F+1;throw new Error("Invalid space at ".concat(F,"."))}consumeIP4Address(A,F){let K=F;for(let Te=0;Te<4;Te++)if(K=this.consumeDecimalUChar(A,K),Te!==3){if(A[K]!==".")throw new Error("Invalid IP4 address.");K++}return K}consumeDecimalUChar(A,F){let K=F;for(let lt=0;lt<3&&p(A[K]);lt++,K++);if(K-F==0)throw new Error("Invalid decimal uchar.");let Te=parseInt(A.slice(F,K));if(Te>=0&&Te<=255)return K;throw new Error("Invalid decimal uchar")}consumeIP6Address(A,F){let K=this.consumeHexpart(A,F);return A[K]===":"&&(K+=1,K=this.consumeIP4Address(A,K)),K}consumeHexpart(A,F){let K=F;if(A[K]===":"&&A[K+1]===":"){K+=2;try{K=this.consumeHexseq(A,K)}catch{}return K}if(K=this.consumeHexseq(A,K),A[K]===":"&&A[K+1]===":"){K+=2;try{K=this.consumeHexseq(A,K)}catch{}return K}return K}consumeHexseq(A,F){let K=F;for(;K=this.consumeHex4(A,K),A[K]===":"&&A[K+1]!==":";)K+=1;return K}consumeHex4(A,F){let K=0;for(;K<4;K++)if(!((Te=A[F+K])>="0"&&Te<="9"||Te>="a"&&Te<="f"||Te>="A"&&Te<="F")){if(K===0)throw new Error("Invalid hex 4");break}var Te;return F+K}consumeFQDN(A,F){let K=F;for(;p(A[K])||w(A[K])||A[K]==="-"||A[K]===".";)K+=1;if(K-F<4)throw new Error("Invalid FQDN");return K}consumeExtnAddr(A,F){return this.consumeOneOrMore(A,F,E)}consumeMulticastAddress(A,F,K){switch(K){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(A,F);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(A,F);default:try{return this.consumeFQDN(A,F)}catch{return this.consumeExtnAddr(A,F)}}}consumeIP6MulticastAddress(A,F){let K=this.consumeHexpart(A,F);return A[K]==="/"?this.consumeInteger(A,K+1):K}consumeIP4MulticastAddress(A,F){let K=F+3,Te=A.slice(F,K),lt=parseInt(Te);if(lt<224||lt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let oi=0;oi<3;oi++){if(A[K]!==".")throw new Error("Invalid IP4 multicast address.");K+=1,K=this.consumeDecimalUChar(A,K)}return A[K]==="/"&&(K+=1),K=this.consumeTTL(A,K),A[K]==="/"&&(K=this.consumeInteger(A,K)),K}consumeInteger(A,F){if(!N(A[F]))throw new Error("Invalid integer.");for(F+=1;p(A[F]);)F+=1;return F}consumeTTL(A,F){if(A[F]==="0")return F+1;if(!N(A[F]))throw new Error("Invalid TTL.");F+=1;for(let K=0;K<2&&p(A[F]);K++)F+=1;return F}consumeToken(A,F){return this.consumeOneOrMore(A,F,R)}consumeTime(A,F){let K=F;if(A[K]==="0")return K+1;for(N(A[K])&&(K+=1);p(A[K]);)K++;if(K-F<10)throw new Error("Invalid time");return K}consumeAddress(A,F){return this.consumeTill(A,F,d)}consumeTypedTime(A,F){let K=F;return K=this.consumeOneOrMore(A,K,p),O(A[K])?K+1:K}consumeRepeatInterval(A,F){if(!N(A[F]))throw new Error("Invalid repeat interval");for(F+=1;p(A[F]);)F+=1;return O(A[F])&&(F+=1),F}consumePort(A,F){return this.consumeOneOrMore(A,F,p)}consume(A,F,K){for(let Te=0;Te<K.length;Te++){if(F+Te>=A.length)throw new Error("consume exceeding value length");if(A[F+Te]!==K[Te])throw new Error("consume ".concat(K," failed at ").concat(Te))}return F+K.length}consumeTill(A,F,K){let Te=F;for(;Te<A.length&&(typeof K!="string"||A[Te]!==K)&&(typeof K!="function"||!K(A[Te]));)Te++;return Te}}class he extends ce{constructor(){super(),Q(this,"records",[]),Q(this,"currentLine",0)}parse(A){let F=this.probeEOL(A);this.records=A.split(F).filter(_l=>!!Qr(_l).call(_l)).map(this.parseLine),this.currentLine=0;let K=this.parseVersion(),Te=this.parseOrigin(),lt=this.parseSessionName(),oi=this.parseInformation(),Ji=this.parseUri(),Ja=this.parseEmail(),Ds=this.parsePhone(),fS=this.parseConnection(),Hh=this.parseBandWidth(),Lm=this.parseTimeFields(),Ry=this.parseKey(),yy=this.parseSessionAttribute(),Za=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:K,origin:Te,sessionName:lt,information:oi,uri:Ji,emails:Ja,phones:Ds,connection:fS,bandwidths:Hh,timeFields:Lm,key:Ry,attributes:yy,mediaDescriptions:Za}}getCurrentRecord(){let A=this.records[this.currentLine];if(!A)throw new Error("Record doesn't exit.");return A}probeEOL(A){for(let F=0;F<A.length;F++)if(A[F]===c)return A[F-1]==="\r"?l:c;throw new Error("Invalid newline character.")}parseLine(A,F){if(A.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let K=A[0];if(A[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:K,value:A.slice(2),line:F,cur:0}}parseSessionAttribute(){let A=new ht;for(;this.currentLine<this.records.length;){let F=this.getCurrentRecord();if(F.type!==h.ATTRIBUTE)break;let K={attField:this.extractOneOrMore(F,Te=>R(Te)&&Te!==":"),_cur:0};F.value[F.cur]===":"&&(F.cur+=1,K.attValue=this.extractOneOrMore(F,L)),A.parse(K),this.currentLine++}return A.digest()}parseMediaAttributes(A){let F=new pt(A);for(;this.currentLine<this.records.length;){let K=this.getCurrentRecord();if(K.type!==h.ATTRIBUTE)break;let Te={attField:this.extractOneOrMore(K,lt=>R(lt)&&lt!==":"),_cur:0};K.value[K.cur]===":"&&(K.cur+=1,Te.attValue=this.extractOneOrMore(K,L)),F.parse(Te),this.currentLine++}return F.digest()}parseKey(){let A=this.getCurrentRecord();if(A.type===h.KEY){if(A.value==="prompt"||A.value==="clear:"||A.value==="base64:"||A.value==="uri:")return A.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let A=this.getCurrentRecord();if(A.type===h.ZONE_ADJUSTMENTS){let F=[];for(;;)try{let K=this.extract(A,this.consumeTime);this.consumeSpaceForRecord(A);let Te=!1;A.value[A.cur]==="-"&&(Te=!0,A.cur+=1);let lt=this.extract(A,this.consumeTypedTime);F.push({time:K,typedTime:lt,back:Te})}catch{break}if(F.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,F}return[]}parseRepeat(){let A=[];for(;;){let F=this.getCurrentRecord();if(F.type!==h.REPEAT)break;{let K=this.extract(F,this.consumeRepeatInterval),Te=this.parseTypedTime(F);A.push({repeatInterval:K,typedTimes:Te}),this.currentLine++}}return A}parseTypedTime(A){let F=[];for(;;)try{this.consumeSpaceForRecord(A),F.push(this.extract(A,this.consumeTypedTime))}catch{break}if(F.length===0)throw new Error("Invalid typed time.");return F}parseTime(){let A=this.getCurrentRecord(),F=this.extract(A,this.consumeTime);this.consumeSpaceForRecord(A);let K=this.extract(A,this.consumeTime);return this.currentLine++,{startTime:F,stopTime:K}}parseBandWidth(){let A=[];for(;this.currentLine<this.records.length;){let F=this.getCurrentRecord();if(F.type!==h.BANDWIDTH)break;{let K=this.extractOneOrMore(F,R);if(F.value[F.cur]!==":")throw new Error("Invalid bandwidth field.");F.cur++;let Te=this.extractOneOrMore(F,p);A.push({bwtype:K,bandwidth:Te}),this.currentLine++}}return A}parseVersion(){let A=this.getCurrentRecord();if(A.type!==h.VERSION)throw new Error("first sdp record must be version");let F=A.value.slice(0,this.consumeOneOrMore(A.value,0,p));if(F.length!==A.value.length)throw new Error('invalid proto version, "v='.concat(A.value,'"'));return this.currentLine++,F}parseOrigin(){let A=this.getCurrentRecord();if(A.type!==h.ORIGIN)throw new Error("second line of sdp must be origin");let F=this.extractOneOrMore(A,E);this.consumeSpaceForRecord(A);let K=this.extractOneOrMore(A,p);this.consumeSpaceForRecord(A);let Te=this.extractOneOrMore(A,p);this.consumeSpaceForRecord(A);let lt=this.extractOneOrMore(A,R);this.consumeSpaceForRecord(A);let oi=this.extractOneOrMore(A,R);this.consumeSpaceForRecord(A);let Ji=this.extract(A,this.consumeUnicastAddress);return this.currentLine++,{username:F,sessId:K,sessVersion:Te,nettype:lt,addrtype:oi,unicastAddress:Ji}}parseSessionName(){let A=this.getCurrentRecord();if(A.type===h.SESSION_NAME){let F=this.extract(A,this.consumeText);return this.currentLine++,F}}parseInformation(){let A=this.getCurrentRecord();if(A.type!==h.INFORMATION)return;let F=this.extract(A,this.consumeText);return this.currentLine++,F}parseUri(){let A=this.getCurrentRecord();if(A.type===h.URI)return this.currentLine++,A.value}parseEmail(){let A=[];for(;;){let F=this.getCurrentRecord();if(F.type!==h.EMAIL)break;A.push(F.value),this.currentLine++}return A}parsePhone(){let A=[];for(;;){let F=this.getCurrentRecord();if(F.type!==h.PHONE)break;A.push(F.value),this.currentLine++}return A}parseConnection(){let A=this.getCurrentRecord();if(A.type===h.CONNECTION){let F=this.extractOneOrMore(A,R);this.consumeSpaceForRecord(A);let K=this.extractOneOrMore(A,R);this.consumeSpaceForRecord(A);let Te=this.extract(A,this.consumeAddress);return this.currentLine++,{nettype:F,addrtype:K,address:Te}}}parseMedia(){let A=this.getCurrentRecord(),F=this.extract(A,this.consumeToken);this.consumeSpaceForRecord(A);let K=this.extract(A,this.consumePort);A.value[A.cur]==="/"&&(A.cur+=1,K+=this.extract(A,this.consumeInteger)),this.consumeSpaceForRecord(A);let Te=[];for(Te.push(this.extract(A,this.consumeToken));A.value[A.cur]==="/";)A.cur+=1,Te.push(this.extract(A,this.consumeToken));if(Te.length===0)throw new Error("Invalid proto");let lt=this.parseFmt(A);return this.currentLine++,{mediaType:F,port:K,protos:Te,fmts:lt}}parseTimeFields(){let A=[];for(;this.getCurrentRecord().type===h.TIME;){let F=this.parseTime(),K=this.parseRepeat(),Te=this.parseZone();A.push({time:F,repeats:K,zones:Te})}return A}parseMediaDescription(){let A=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.MEDIA;){let F=this.parseMedia(),K=this.parseInformation(),Te=this.parseConnections(),lt=this.parseBandWidth(),oi=this.parseKey(),Ji=this.parseMediaAttributes(F);A.push({media:F,information:K,connections:Te,bandwidths:lt,key:oi,attributes:Ji})}return A}parseConnections(){let A=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.CONNECTION;)A.push(this.parseConnection());return A}parseFmt(A){let F=[];for(;;)try{this.consumeSpaceForRecord(A),F.push(this.extract(A,this.consumeToken))}catch{break}if(F.length===0)throw new Error("Invalid fmts");return F}extract(A,F){for(var K=arguments.length,Te=new Array(K>2?K-2:0),lt=2;lt<K;lt++)Te[lt-2]=arguments[lt];let oi=F.call(this,A.value,A.cur,...Te),Ji=A.value.slice(A.cur,oi);return A.cur=oi,Ji}extractOneOrMore(A,F){let K=this.consumeOneOrMore(A.value,A.cur,F),Te=A.value.slice(A.cur,K);return A.cur=K,Te}consumeSpaceForRecord(A){if(A.value[A.cur]!==d)throw new Error("Invalid space at ".concat(A.cur,"."));A.cur+=1}}class Se extends ce{constructor(){super(...arguments),Q(this,"attributes",void 0),Q(this,"digested",!1)}extractOneOrMore(A,F,K){let Te=this.consumeOneOrMore(A.attValue,A._cur,F),lt=A.attValue.slice(A._cur,Te),[oi,Ji]=K||[];if(typeof oi=="number"&&lt.length<oi)throw new Error("error in length, should be more or equal than ".concat(oi," characters."));if(typeof Ji=="number"&&lt.length>Ji)throw new Error("error in length, should be less or equal than ".concat(Ji," characters."));return A._cur=Te,lt}consumeAttributeSpace(A){if(A.attValue[A._cur]!==d)throw new Error("Invalid space at ".concat(A._cur,"."));A._cur+=1}extract(A,F){if(!A.attValue)throw new Error("Nothing to extract from attValue.");for(var K=arguments.length,Te=new Array(K>2?K-2:0),lt=2;lt<K;lt++)Te[lt-2]=arguments[lt];let oi=F.call(this,A.attValue,A._cur,...Te),Ji=A.attValue.slice(A._cur,oi);return A._cur=oi,Ji}atEnd(A){if(!A.attValue)throw new Error;return A._cur>=A.attValue.length}peekChar(A){if(!A.attValue)throw new Error;return A.attValue[A._cur]}peek(A,F){if(!A.attValue)throw new Error;for(let K=0;K<F.length;K++)if(F[K]!==A.attValue[A._cur+K])return!1;return!0}parseIceUfrag(A){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(A,M,[4,256])}parseIcePwd(A){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(A,M,[22,256])}parseIceOptions(A){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let F=[];for(;!this.atEnd(A);){F.push(this.extractOneOrMore(A,M));try{this.consumeAttributeSpace(A)}catch(K){if(this.atEnd(A))break;throw K}}this.attributes.iceOptions=F}parseFingerprint(A){let F=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);let K=this.extract(A,this.consumeTill);this.attributes.fingerprints.push({hashFunction:F,fingerprint:K})}parseExtmap(A){let F=this.extractOneOrMore(A,p),K;this.peekChar(A)==="/"&&(this.extract(A,this.consume,"/"),K=this.extract(A,this.consumeToken)),this.consumeAttributeSpace(A);let Te=this.extract(A,this.consumeTill,d),lt=G(G({entry:parseInt(F,10)},K&&{direction:K}),{},{extensionName:Te});this.peekChar(A)===d&&(this.consumeAttributeSpace(A),lt.extensionAttributes=this.extract(A,this.consumeTill)),this.attributes.extmaps.push(lt)}parseSetup(A){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let F=this.extract(A,this.consumeTill);if(F!=="active"&&F!=="passive"&&F!=="actpass"&&F!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=F}}class ht extends Se{constructor(){super(...arguments),Q(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(A){if(this.digested)throw new Error("already digested");try{switch(A.attField){case"group":this.parseGroup(A);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(A);break;case"ice-pwd":this.parseIcePwd(A);break;case"ice-options":this.parseIceOptions(A);break;case"fingerprint":this.parseFingerprint(A);break;case"setup":this.parseSetup(A);break;case"tls-id":this.parseTlsId(A);break;case"identity":this.parseIdentity(A);break;case"extmap":this.parseExtmap(A);break;case"msid-semantic":this.parseMsidSemantic(A);break;default:A.ignored=!0,this.attributes.unrecognized.push(A)}}catch(F){throw console.error("parsing session attribute ".concat(A.attField,' error, "a=').concat(A.attField,":").concat(A.attValue,'"')),F}if(!A.ignored&&A.attValue&&!this.atEnd(A))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(A){let F=this.extract(A,this.consumeToken),K=[];for(;!this.atEnd(A)&&this.peekChar(A)===d;)this.consumeAttributeSpace(A),K.push(this.extract(A,this.consumeToken));this.attributes.groups.push({semantic:F,identificationTag:K})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(A){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(A,B)}parseIdentity(A){let F=this.extractOneOrMore(A,Y),K=[];for(;!this.atEnd(A)&&this.peekChar(A)===d;){this.consumeAttributeSpace(A);let Te=this.extract(A,this.consumeToken);this.extract(A,this.consume,"=");let lt=this.extractOneOrMore(A,oi=>oi!==d&&L(oi));K.push({name:Te,value:lt})}this.attributes.identities.push({assertionValue:F,extensions:K})}parseMsidSemantic(A){this.peekChar(A)===d&&this.consumeAttributeSpace(A);let F={semantic:this.extract(A,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(A)}catch{break}if(this.peekChar(A)==="*"){this.extract(A,this.consume,"*"),F.applyForAll=!0;break}{let K=this.extract(A,this.consumeTill,d);F.identifierList.push(K)}}this.attributes.msidSemantic=F}}class pt extends Se{constructor(A){super(),Q(this,"attributes",void 0),A.protos.indexOf("RTP")!==-1||A.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(A){if(this.digested)throw new Error("already digested");try{switch(A.attField){case"extmap":this.parseExtmap(A);break;case"setup":this.parseSetup(A);break;case"ice-ufrag":this.parseIceUfrag(A);break;case"ice-pwd":this.parseIcePwd(A);break;case"ice-options":this.parseIceOptions(A);break;case"candidate":this.parseCandidate(A);break;case"remote-candidate":this.parseRemoteCandidate(A);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(A);break;case"rtpmap":this.parseRtpmap(A);break;case"ptime":this.parsePtime(A);break;case"maxptime":this.parseMaxPtime(A);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(A);break;case"ssrc":this.parseSSRC(A);break;case"fmtp":this.parseFmtp(A);break;case"rtcp-fb":this.parseRtcpFb(A);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(A);break;case"mid":this.parseMid(A);break;case"msid":this.parseMsid(A);break;case"imageattr":this.parseImageAttr(A);break;case"rid":this.parseRid(A);break;case"simulcast":this.parseSimulcast(A);break;case"sctp-port":this.parseSctpPort(A);break;case"max-message-size":this.parseMaxMessageSize(A);break;case"ssrc-group":this.parseSSRCGroup(A);break;default:A.ignored=!0,this.attributes.unrecognized.push(A)}}catch(F){throw console.error("parsing media attribute ".concat(A.attField,' error, "a=').concat(A.attField,":").concat(A.attValue,'"')),F}if(!A.ignored&&A.attValue&&!this.atEnd(A))throw new Error("attribute parsing error")}parseCandidate(A){let F=this.extractOneOrMore(A,M,[1,32]);this.consumeAttributeSpace(A);let K=this.extractOneOrMore(A,p,[1,5]);this.consumeAttributeSpace(A);let Te=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);let lt=this.extractOneOrMore(A,p,[1,10]);this.consumeAttributeSpace(A);let oi=this.extract(A,this.consumeAddress);this.consumeAttributeSpace(A);let Ji=this.extract(A,this.consumePort);this.consumeAttributeSpace(A),this.extract(A,this.consume,"typ"),this.consumeAttributeSpace(A);let Ja={foundation:F,componentId:K,transport:Te,priority:lt,connectionAddress:oi,port:Ji,type:this.extract(A,this.consumeToken),extension:{}};for(this.peek(A," raddr")&&(this.extract(A,this.consume," raddr"),this.consumeAttributeSpace(A),Ja.relAddr=this.extract(A,this.consumeAddress)),this.peek(A," rport")&&(this.extract(A,this.consume," rport"),this.consumeAttributeSpace(A),Ja.relPort=this.extract(A,this.consumePort));this.peekChar(A)===d;){this.consumeAttributeSpace(A);let Ds=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A),Ja.extension[Ds]=this.extractOneOrMore(A,_)}this.attributes.candidates.push(Ja)}parseRemoteCandidate(A){let F=[];for(;;){let K=this.extractOneOrMore(A,p,[1,5]);this.consumeAttributeSpace(A);let Te=this.extract(A,this.consumeAddress);this.consumeAttributeSpace(A);let lt=this.extract(A,this.consumePort);F.push({componentId:K,connectionAddress:Te,port:lt});try{this.consumeAttributeSpace(A)}catch{break}}this.attributes.remoteCandidatesList.push(F)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(A){let F=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);let K=this.extract(A,this.consumeTill,"/");this.extract(A,this.consume,"/");let Te={encodingName:K,clockRate:this.extractOneOrMore(A,p)};this.atEnd(A)||this.peekChar(A)!=="/"||(this.extract(A,this.consume,"/"),Te.encodingParameters=parseInt(this.extract(A,this.consumeTill),10));let lt=this.attributes.payloads.find(oi=>oi.payloadType===parseInt(F,10));lt?lt.rtpMap=Te:this.attributes.payloads.push({payloadType:parseInt(F,10),rtpMap:Te,rtcpFeedbacks:[]})}parsePtime(A){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(A,this.consumeTill)}parseMaxPtime(A){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(A,this.consumeTill)}parseDirection(A){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=A.attField}parseSSRC(A){let F=this.extractOneOrMore(A,p);this.consumeAttributeSpace(A);let K=this.extract(A,this.consumeTill,":"),Te;this.peekChar(A)===":"&&(this.extract(A,this.consume,":"),Te=this.extract(A,this.consumeTill));let lt=this.attributes.ssrcs.find(oi=>oi.ssrcId===parseInt(F,10));lt?lt.attributes[K]=Te:this.attributes.ssrcs.push({ssrcId:parseInt(F,10),attributes:{[K]:Te}})}parseFmtp(A){let F=this.extract(A,this.consumeTill,d);this.consumeAttributeSpace(A);let K=this.extract(A,this.consumeTill),Te={};K.split(";").forEach(oi=>{let[Ji,Ja]=oi.split("=");Ji=Qr(Ji).call(Ji);let Ds=typeof Ja=="string"?Qr(Ja).call(Ja):null;typeof Ji=="string"&&Ji.length>0&&(Te[Ji]=Ds)});let lt=this.attributes.payloads.find(oi=>oi.payloadType===parseInt(F,10));lt?lt.fmtp={parameters:Te}:this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[],fmtp:{parameters:Te}})}parseFmtParameters(A){let F={},K=this.extract(A,this.consumeTill,"=");A._cur++;let Te=this.extract(A,this.consumeTill,";");for(F[K]=Te;A.attValue[A._cur]===";";){let lt=this.extract(A,this.consumeTill,"=");A._cur++;let oi=this.extract(A,this.consumeTill,";");F[lt]=oi}return F}parseRtcpFb(A){let F="";F=this.peekChar(A)==="*"?this.extract(A,this.consume,"*"):this.extract(A,this.consumeTill,d),this.consumeAttributeSpace(A);let K=this.extract(A,this.consumeTill,d),Te;if(K==="trr-int")Te={type:K,interval:this.extract(A,this.consumeTill)};else{let lt={type:K};this.peekChar(A)===d&&(this.consumeAttributeSpace(A),lt.parameter=this.extract(A,this.consumeToken),this.peekChar(A)===d&&(lt.additional=this.extract(A,this.consumeTill))),Te=lt}if(F==="*")this.attributes.rtcpFeedbackWildcards.push(Te);else{let lt=this.attributes.payloads.find(oi=>oi.payloadType===parseInt(F,10));lt?lt.rtcpFeedbacks.push(Te):this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[Te]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(A){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let F={port:this.extract(A,this.consumePort)};this.peekChar(A)===d&&(this.consumeAttributeSpace(A),F.netType=this.extractOneOrMore(A,R),this.consumeAttributeSpace(A),F.addressType=this.extractOneOrMore(A,R),this.consumeAttributeSpace(A),F.address=this.extract(A,this.consumeAddress)),this.attributes.rtcp=F}parseMsid(A){let F={id:this.extractOneOrMore(A,R,[1,64])};this.peekChar(A)===d&&(this.consumeAttributeSpace(A),F.appdata=this.extractOneOrMore(A,R,[1,64])),this.attributes.msids.push(F)}parseImageAttr(A){this.attributes.imageattr.push(A.attValue)}parseRid(A){let F=this.extractOneOrMore(A,Te=>w(Te)||p(Te)||Te==="_"||Te==="-");this.consumeAttributeSpace(A);let K={id:F,direction:this.extract(A,this.consumeToken),params:[]};if(this.peekChar(A)===d){if(this.consumeAttributeSpace(A),this.peek(A,"pt=")){this.extract(A,this.consume,"pt=");let Te=[];for(;;){let lt=this.extract(A,this.consumeToken);Te.push(lt);try{this.extract(A,this.consume,",")}catch{break}}K.payloads=Te,this.peekChar(A)===d&&this.extract(A,this.consume,d)}for(;;){let Te=this.extract(A,this.consumeToken);switch(Te){case"depend":{let lt={type:Te,rids:this.extract(A,this.consume,"=").split(",")};K.params.push(lt);break}default:{let lt={type:Te};this.peekChar(A)==="="&&(this.extract(A,this.consume,"="),lt.val=this.extract(A,this.consumeTill,";")),K.params.push(lt)}}try{this.extract(A,this.consume,";")}catch{break}}}this.attributes.rids.push(K)}parseSimulcast(A){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=A.attValue,this.extract(A,this.consumeTill)}parseSctpPort(A){this.attributes.sctpPort=this.extractOneOrMore(A,p,[1,5])}parseMaxMessageSize(A){this.attributes.maxMessageSize=this.extractOneOrMore(A,p,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(A){this.attributes.mid=this.extract(A,this.consumeToken)}parseSSRCGroup(A){let F=this.extract(A,this.consumeToken),K=[];for(;;)try{this.consumeAttributeSpace(A);let Te=this.extract(A,this.consumeInteger);K.push(parseInt(Te,10))}catch{break}this.attributes.ssrcGroups.push({semantic:F,ssrcIds:K})}}function tt(fe,A,F){return A in fe?Object.defineProperty(fe,A,{value:F,enumerable:!0,configurable:!0,writable:!0}):fe[A]=F,fe}class xt{constructor(){tt(this,"eol",l)}print(A,F){let K="";return F&&(this.eol=F),K+=this.printVersion(A.version),K+=this.printOrigin(A.origin),K+=this.printSessionName(A.sessionName),K+=this.printInformation(A.information),K+=this.printUri(A.uri),K+=this.printEmail(A.emails),K+=this.printPhone(A.phones),K+=this.printConnection(A.connection),K+=this.printBandwidth(A.bandwidths),K+=this.printTimeFields(A.timeFields),K+=this.printKey(A.key),K+=this.printSessionAttributes(A.attributes),K+=this.printMediaDescription(A.mediaDescriptions),K}printVersion(A){return"v=".concat(A).concat(this.eol)}printOrigin(A){return"o=".concat(A.username," ").concat(A.sessId," ").concat(A.sessVersion," ").concat(A.nettype," ").concat(A.addrtype," ").concat(A.unicastAddress).concat(this.eol)}printSessionName(A){return A?"s=".concat(A).concat(this.eol):""}printInformation(A){return A?"i=".concat(A).concat(this.eol):""}printUri(A){return A?"u=".concat(A).concat(this.eol):""}printEmail(A){let F="";for(let K of A)F+="e=".concat(K).concat(this.eol);return F}printPhone(A){let F="";for(let K of A)F+="e=".concat(K).concat(this.eol);return F}printConnection(A){return A?"c=".concat(A.nettype," ").concat(A.addrtype," ").concat(A.address).concat(this.eol):""}printBandwidth(A){let F="";for(let K of A)F+="b=".concat(K.bwtype,":").concat(K.bandwidth).concat(this.eol);return F}printTimeFields(A){let F="";for(let K of A){F+="t=".concat(K.time.startTime," ").concat(K.time.startTime).concat(this.eol);for(let Te of K.repeats)F+="r=".concat(Te.repeatInterval," ").concat(Te.typedTimes.join(" ")).concat(this.eol);K.zoneAdjustments&&(F+="z=",F+="z=".concat(K.zoneAdjustments.map(Te=>"".concat(Te.time," ").concat(Te.back?"-":""," ").concat(Te.typedTime)).join(" ")).concat(this.eol),F+=this.eol)}return F}printKey(A){return A?"k=".concat(A).concat(this.eol):""}printAttributes(A){let F="";for(let K of A)F+="a=".concat(K.attField).concat(K.attValue?":".concat(K.attValue):"").concat(this.eol);return F}printMediaDescription(A){let F="";for(let K of A)F+=this.printMedia(K.media),F+=this.printInformation(K.information),F+=this.printConnections(K.connections),F+=this.printBandwidth(K.bandwidths),F+=this.printKey(K.key),F+=this.printMediaAttributes(K);return F}printConnections(A){let F="";for(let K of A)F+=this.printConnection(K);return F}printMedia(A){return"m=".concat(A.mediaType," ").concat(A.port," ").concat(A.protos.join("/")," ").concat(A.fmts.join(" ")).concat(this.eol)}printSessionAttributes(A){return new Vr(this.eol).print(A)}printMediaAttributes(A){return new de(this.eol).print(A)}}class Lt{constructor(A){tt(this,"eol",void 0),this.eol=A}printIceUfrag(A){return A===void 0?"":"a=ice-ufrag:".concat(A).concat(this.eol)}printIcePwd(A){return A===void 0?"":"a=ice-pwd:".concat(A).concat(this.eol)}printIceOptions(A){return A===void 0?"":"a=ice-options:".concat(A.join(d)).concat(this.eol)}printFingerprints(A){return A.length>0?A.map(F=>"a=fingerprint:".concat(F.hashFunction).concat(d).concat(F.fingerprint)).join(this.eol)+this.eol:""}printExtmap(A){return A.map(F=>"a=extmap:".concat(F.entry).concat(F.direction?"/".concat(F.direction):"").concat(d).concat(F.extensionName).concat(F.extensionAttributes?"".concat(d).concat(F.extensionAttributes):"").concat(this.eol)).join("")}printSetup(A){return A===void 0?"":"a=setup:".concat(A).concat(this.eol)}printUnrecognized(A){return A.map(F=>"a=".concat(F.attField).concat(F.attValue?":".concat(F.attValue):"").concat(this.eol)).join("")}}class Vr extends Lt{print(A){let F="";return F+=this.printGroups(A.groups),F+=this.printMsidSemantic(A.msidSemantic),F+=this.printIceLite(A.iceLite),F+=this.printIceUfrag(A.iceUfrag),F+=this.printIcePwd(A.icePwd),F+=this.printIceOptions(A.iceOptions),F+=this.printFingerprints(A.fingerprints),F+=this.printSetup(A.setup),F+=this.printTlsId(A.tlsId),F+=this.printIdentity(A.identities),F+=this.printExtmap(A.extmaps),F+=this.printUnrecognized(A.unrecognized),F}printGroups(A){let F="";return A.length>0&&(F+=A.map(K=>"a=group:".concat(K.semantic).concat(K.identificationTag.map(Te=>"".concat(d).concat(Te)).join("")).concat(this.eol)).join("")),F}printIceLite(A){return A===void 0?"":"a=ice-lite"+this.eol}printTlsId(A){return A?"a=tls-id:".concat(A).concat(this.eol):""}printIdentity(A){return A.length===0?"":A.map(F=>"a=identity:".concat(F.assertionValue).concat(F.extensions.map(K=>"".concat(d).concat(K.name).concat(K.value?"=".concat(K.value):"")))).join(this.eol)+this.eol}printMsidSemantic(A){if(!A)return"";let F="a=msid-semantic:".concat(A.semantic);return A.applyForAll?F+="".concat(d,"*"):A.identifierList.length>0&&(F+=A.identifierList.map(K=>"".concat(d).concat(K))),F+this.eol}}class de extends Lt{print(A){let F=A.attributes,K="";return K+=this.printRTCP(F.rtcp),K+=this.printIceUfrag(F.iceUfrag),K+=this.printIcePwd(F.icePwd),K+=this.printIceOptions(F.iceOptions),K+=this.printCandidates(F.candidates),K+=this.printRemoteCandidatesList(F.remoteCandidatesList),K+=this.printEndOfCandidates(F.endOfCandidates),K+=this.printFingerprints(F.fingerprints),K+=this.printSetup(F.setup),K+=this.printMid(F.mid),K+=this.printExtmap(F.extmaps),K+=this.printRTPRelated(F),K+=this.printPtime(F.ptime),K+=this.printMaxPtime(F.maxPtime),K+=this.printDirection(F.direction),K+=this.printSSRCGroups(F.ssrcGroups),K+=this.printSSRC(F.ssrcs),K+=this.printRTCPMux(F.rtcpMux),K+=this.printRTCPMuxOnly(F.rtcpMuxOnly),K+=this.printRTCPRsize(F.rtcpRsize),K+=this.printMSId(F.msids),K+=this.printImageattr(F.imageattr),K+=this.printRid(F.rids),K+=this.printSimulcast(F.simulcast),K+=this.printSCTPPort(F.sctpPort),K+=this.printMaxMessageSize(F.maxMessageSize),K+=this.printUnrecognized(F.unrecognized),K}printCandidates(A){return A.map(F=>"a=candidate:".concat(F.foundation).concat(d).concat(F.componentId).concat(d).concat(F.transport).concat(d).concat(F.priority).concat(d).concat(F.connectionAddress).concat(d).concat(F.port).concat(d,"typ").concat(d).concat(F.type).concat(F.relAddr?"".concat(d,"raddr").concat(d).concat(F.relAddr):"").concat(F.relPort?"".concat(d,"rport").concat(d).concat(F.relPort):"").concat(Object.keys(F.extension).map(K=>"".concat(d).concat(K).concat(d).concat(F.extension[K])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(A){return A.map(F=>"a=remote-candidates:".concat(F.join(d)).concat(this.eol)).join("")}printEndOfCandidates(A){return A===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(A){if(!A.payloads)return"";let F=A.payloads,K="";K+=A.rtcpFeedbackWildcards.map(Te=>this.printRTCPFeedback("*",Te)).join("");for(let Te of F)K+=this.printRtpMap(Te.payloadType,Te.rtpMap),K+=this.printFmtp(Te.payloadType,Te.fmtp),K+=Te.rtcpFeedbacks.map(lt=>this.printRTCPFeedback(Te.payloadType,lt)).join("");return K}printFmtp(A,F){if(!F)return"";let K=Object.keys(F.parameters);return K.length===1&&F.parameters[K[0]]===null?"a=fmtp:".concat(A).concat(d).concat(K[0]).concat(this.eol):"a=fmtp:".concat(A).concat(d).concat(Object.keys(F.parameters).map(Te=>"".concat(Te,"=").concat(F.parameters[Te])).join(";")).concat(this.eol)}printRtpMap(A,F){return F?"a=rtpmap:".concat(A).concat(d).concat(F.encodingName,"/").concat(F.clockRate).concat(F.encodingParameters?"/".concat(F.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(A,F){let K="a=rtcp-fb:".concat(A).concat(d),Te=F;return Te.type==="trr-int"?K+="ttr-int".concat(d).concat(Te.interval):(K+="".concat(Te.type),Te.parameter&&(K+="".concat(d).concat(Te.parameter),Te.additional&&(K+="".concat(d).concat(Te.additional)))),K+this.eol}printPtime(A){return A===void 0?"":"a=ptime:".concat(A).concat(this.eol)}printMaxPtime(A){return A===void 0?"":"a=maxptime:".concat(A).concat(this.eol)}printDirection(A){return A===void 0?"":"a=".concat(A).concat(this.eol)}printSSRC(A){return A.map(F=>Object.keys(F.attributes).map(K=>"a=ssrc:".concat(F.ssrcId.toString(10)).concat(d).concat(K).concat(F.attributes[K]?":".concat(F.attributes[K]):"").concat(this.eol)).join("")).join("")}printRTCPMux(A){return A===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(A){return A===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(A){return A===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(A){if(A===void 0)return"";let F="a=rtcp:".concat(A.port);return A.netType&&(F+="".concat(d).concat(A.netType)),A.addressType&&(F+="".concat(d).concat(A.addressType)),A.address&&(F+="".concat(d).concat(A.address)),F+this.eol}printMSId(A){return A.map(F=>"a=msid:".concat(F.id).concat(F.appdata?"".concat(d).concat(F.appdata):"").concat(this.eol)).join("")}printImageattr(A){return A.map(F=>"a=imageattr:".concat(F).concat(this.eol)).join("")}printRid(A){return A.map(F=>{let K="a=rid:".concat(F.id).concat(d).concat(F.direction);return F.payloads&&(K+="".concat(d,"pt=").concat(F.payloads.join(","))),F.params.length>0&&(K+="".concat(d).concat(F.params.map(Te=>Te.type==="depend"?"depend=".concat(Te.rids.join(",")):"".concat(Te.type,"=").concat(Te.val)).join(";"))),K+this.eol}).join("")}printSimulcast(A){return A===void 0?"":"a=simulcast:".concat(A).concat(this.eol)}printSCTPPort(A){return A===void 0?"":"a=sctp-port:".concat(A).concat(this.eol)}printMaxMessageSize(A){return A===void 0?"":"a=max-message-size:".concat(A).concat(this.eol)}printMid(A){return A===void 0?"":"a=mid:".concat(A).concat(this.eol)}printSSRCGroups(A){return A.map(F=>"a=ssrc-group:".concat(F.semantic).concat(F.ssrcIds.map(K=>"".concat(d).concat(K.toString(10))).join("")).concat(this.eol)).join("")}}function ye(fe){return new he().parse(fe)}function ke(fe,A){return new xt().print(fe,A)}}},t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={exports:{}};return e[r](n,n.exports,i),n.exports}return i.d=(r,n)=>{for(var s in n)i.o(n,s)&&!i.o(r,s)&&Object.defineProperty(r,s,{enumerable:!0,get:n[s]})},i.o=(r,n)=>Object.prototype.hasOwnProperty.call(r,n),i.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},i(8)})();function kn(e){return kL.parse(e)}function Pd(e,t){return kL.print(e,t)}var A8=Hn("Array","keys"),w8=Vs,I8=tr,O8=se,N8=A8,lw=Array.prototype,D8={DOMTokenList:!0,NodeList:!0},P8=function(e){var t=e.keys;return e===lw||O8(lw,e)&&t===lw.keys||I8(D8,w8(e))?N8:t},Mn=b(P8);function Ci(e,t,i){return(t=(function(r){var n=(function(s,c){if(typeof s!="object"||!s)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var d=l.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)})(r);return typeof n=="symbol"?n:n+""})(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function ML(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function ut(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?ML(Object(i),!0).forEach(function(r){Ci(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ML(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let xL=new class extends Ei{constructor(){super(...arguments),Ci(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class L8{constructor(t){Ci(this,"logger",void 0),Ci(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];this.logger.debug(...this.prefixLists,...i)}info(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];this.logger.info(...this.prefixLists,...i)}warning(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];this.logger.warning(...this.prefixLists,...i)}error(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];this.logger.error(...this.prefixLists,...i)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function dw(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function UL(){let e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?t?.[0]+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}let Ga={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},lR=Date.now(),Dg=e=>{for(let t in Ga)if(Object.prototype.hasOwnProperty.call(Ga,t)&&Ga[t]===e)return t;return"DEFAULT"},y=new class{constructor(){Ci(this,"proxyServerURL",void 0),Ci(this,"logLevel",Ga.DEBUG),Ci(this,"uploadState","collecting"),Ci(this,"uploadLogWaitingList",[]),Ci(this,"uploadLogUploadingList",[]),Ci(this,"uploadErrorCount",0),Ci(this,"currentLogID",0),Ci(this,"url",void 0),Ci(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=[Ga.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=[Ga.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=[Ga.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=[Ga.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=[Ga.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Ht("UPLOAD_LOG",!0)}disableLogUpload(){Ht("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new L8(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Date.now()-lR<100)return void setTimeout(()=>{this.log(...t)},Date.now()-lR);let r=Math.max(0,Math.min(4,t[0]));if(t[0]=dw()+" Agora-SDK [".concat(Dg(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;let n=dw()+" %cAgora-SDK [".concat(Dg(r),"]:"),s=[];if(!U("USE_NEW_LOG"))switch(r){case Ga.DEBUG:s=[n,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,s);break;case Ga.INFO:s=[n,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,s);break;case Ga.WARNING:s=[n,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,s);break;case Ga.ERROR:s=[n,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Date.now()-lR<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-lR);let r=Math.max(0,Math.min(4,t[0]));t[0]=dw()+" Agora-SDK [".concat(Dg(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!U("UPLOAD_LOG"))return;for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];Array.isArray(i[0])?i[0][0]=UL()+" Agora-SDK [".concat(Dg(e),"]:"):i[0]=UL()+" Agora-SDK [".concat(Dg(e),"]:");let n="";i.forEach(s=>{typeof s=="object"&&(s=JSON.stringify(s)),n+="".concat(s," ")}),this.uploadLogWaitingList.push({payload_str:n,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){let e=this.uploadLogUploadingList,t={sdk_version:Fa,process_id:U("PROCESS_ID"),payload:JSON.stringify(e)};return no(async()=>{let i=await Tn.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(U("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(U("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(i.data!=="OK"){let r=new Error("unexpected upload log response");throw r.response=i,r}},()=>(this.uploadLogUploadingList=[],!1),i=>{let r={status:-1,message:i.message,errorRange:e.map(n=>n.log_item_id)};return i.response?(r.status=i.response.status,r.data=i.response.data,r.headers=i.response.headers):i.request&&(r.status=i.request.status),xL.reportLogUploadError(r),!0},{timeout:U("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:U("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,U("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),U("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),U("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),U("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var VL;function k8(e){return pr(e.reportId,"params.reportId",0,100,!1),pr(e.category,"params.category",0,100,!1),pr(e.event,"params.event",0,100,!1),pr(e.label,"params.label",0,100,!1),Yt(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(VL={}).FREE="free",VL.UPLOADING="uploading",(function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"})({});let M8={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},er=(function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e})({}),ui=(function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e})({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let x8=(function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e})({});function qe(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,i,r){let n=r.value;if(typeof n=="function"){let s=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var c,l=arguments.length,d=new Array(l),h=0;h<l;h++)d[h]=arguments[h];let p=d;if(e.argsMap)try{p=e.argsMap(this,...d)}catch(E){y.warning(E),p=[]}try{JSON.stringify(p)}catch{y.warning("arguments for method ".concat(s,".").concat(String(i)," not serializable for apiInvoke.")),p=[]}let _=(e.report||Fe).reportApiInvoke(this._sessionId||null,{id:this._clientId||((c=this.store)===null||c===void 0?void 0:c.clientId)||this._ID,name:"".concat(s,".").concat(String(i)),options:p,tag:pi.TRACER,reportResult:e.reportResult},e.throttleTime);try{let E=n.apply(this,d);return E instanceof we?E.then(R=>(_.onSuccess(e.reportResult&&R),R)).catch(R=>{throw _.onError(R),R}):(_.onSuccess(e.reportResult&&E),E)}catch(E){throw _.onError(E),E}}}return r}}let Fe=new class{constructor(){Ci(this,"baseInfoMap",new Map),Ci(this,"proxyServer",void 0),Ci(this,"eventUploadTimer",void 0),Ci(this,"setSessionIdTimer",void 0),Ci(this,"url",void 0),Ci(this,"sids",new Set),Ci(this,"backupUrl",void 0),Ci(this,"_appId",void 0),Ci(this,"_aid",0),Ci(this,"keyEventUploadPendingItems",[]),Ci(this,"normalEventUploadPendingItems",[]),Ci(this,"apiInvokeUploadPendingItems",[]),Ci(this,"apiInvokeCount",0),Ci(this,"apiInvokeLoggedCount",0),Ci(this,"ltsList",[]),Ci(this,"lastSendNormalEventTime",Date.now()),Ci(this,"customReportCounterTimer",void 0),Ci(this,"customReportCount",0),Ci(this,"extApiInvoke",async e=>{for(let t of e){let i=ut(ut({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:pi.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),U("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),U("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[i,r]=t;return i+r}),16)||0}reportApiInvoke(e,t,i){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;let r=Date.now();this.apiInvokeCount+=1;let n=this.apiInvokeCount,s=!!U("SHOW_REPORT_INVOKER_LOG"),c=!!U("SHOW_REPORT_USER_INVOKER_LOG"),l=s||c&&t.id;l&&(this.apiInvokeLoggedCount+=1);let d=this.apiInvokeLoggedCount;function h(R,N){if(l){let w="[apiInvoke-".concat(d,"]");if(t.id&&(w+="[".concat(t.id,"]")),t.name&&(w+="[".concat(t.name,"]"),t.name===Oi.JOIN))return y.info("".concat(w," ").concat(R));y.info("".concat(w," ").concat(R),R==="start"?t.options:N||"")}}let p=()=>({tag:t.tag,invokeId:n,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null});h("start");let _=!1;fr(t.timeout).then(()=>{_||(this.sendApiInvoke(ut(ut({},p()),{},{error:k.API_INVOKE_TIMEOUT,success:!1})),h("timeout"))});let E=new ne(k.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:R=>{let N=()=>{if(_)throw E;return _=!0,this.sendApiInvoke(ut(ut({},p()),{},{success:!0},t.reportResult&&{result:R})),h("onSuccess"),R};return i?EL(N,t.name+"Success",i,()=>_=!0):N()},onError:R=>{let N=()=>{if(_)throw R;_=!0,this.sendApiInvoke(ut(ut({},p()),{},{success:!1,error:R})),h("onFailure",R.toString())};return i?EL(N,t.name+"Error",i,()=>_=!0):N()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;let i=Date.now(),r=this.createBaseInfo(e,i);r.cname=t.cname;let n=Object.assign({},{willUploadConsoleLog:U("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:aw?"global":"oversea",areas:U("AREAS")&&U("AREAS").join(",")},t.extend),{stringUid:s,channelProfile:c,channelMode:l,isABTestSuccess:d,lsid:h,clientRole:p}=t,_=Date.now(),E=ut(ut({},r),{},{eventType:er.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:ow,lts:_,elapse:_-i,extend:JSON.stringify(n),mode:t.mode,process:U("PROCESS_ID"),appType:U("APP_TYPE"),success:!0,version:Fa,stringUid:s,channelProfile:c,channelMode:l,isABTestSuccess:d,lsid:h,clientType:ve(R=window.navigator.userAgent).call(R,"AgoraWebView")?42:20,clientRole:p,serviceId:U("PROCESS_ID"),extensionID:U("PLUGIN_INFO").join(",")||""});var R;this.send({type:ui.SESSION,data:E},!0)}joinChooseServer(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let r=i.info,n=Date.now(),s=ut(ut({},r),{},{role:t.role,eventType:er.JOIN_CHOOSE_SERVER,lts:n,eventElapse:t.elapse||n-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:n-i.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:ui.JOIN_CHOOSE_SERVER,data:s},!0)}reqUserAccount(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let r=i.info,n=Date.now(),s=ut(ut({},r),{},{eventType:er.REQ_USER_ACCOUNT,lts:n,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||n-i.startTime,eventElapse:n-t.lts,extend:JSON.stringify(t.extend)});this.send({type:ui.REQ_USER_ACCOUNT,data:s},!0)}joinGateway(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let r=i.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;let n=Date.now(),{firstSuccess:s,addr:c,isProxy:l}=t,d=n-i.startTime,h=ut(ut({},r),{},{eventType:er.JOIN_GATEWAY,lts:n,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:d,eventElapse:n-t.lts,firstSuccess:s,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:nw(),isABTestSuccess:t.isABTestSuccess?1:0}),p=h.success?1:0;if(t.succ&&(i.lastJoinSuccessTime=n),s)this.send({type:ui.JOIN_GATEWAY,data:h},!0);else{let _;if(c)if(l){let R=c.match(/h=(\d{1,3}-){3}\d{1,3}/g),N=c.match(/p=[0-9]{1,6}/g);_={isSuccess:p,gatewayIp:R&&R.length?R[0].split("=")[1].replace(/-/g,"."):"",port:N&&N.length?N[0].split("=")[1]:"",isProxy:l?1:0}}else{let R=c.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),N=c.match(/(:|p=)[0-9]{1,6}/g);_={isSuccess:p,gatewayIp:R&&R.length?R[0].split("//")[1].replace(/-/g,"."):"",port:N&&N.length?N[0].split(/:|p=/g)[1]:"",isProxy:l?1:0}}else _={isSuccess:p,gatewayIp:"",port:"",isProxy:l?1:0};delete h.success,delete h.eventType,delete h.firstSuccess,h.vid=Number(h.vid);let E=Object.assign({},h,_,{eventType:er.REJOIN_GATEWAY});this.send({type:ui.RE_JOIN_GATEWAY,data:E},!0)}}joinChannelTimeout(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let r=Date.now(),n=ut(ut({},i.info),{},{lts:r,timeout:t,elapse:r-i.startTime});this.send({type:ui.JOIN_CHANNEL_TIMEOUT,data:n},!0)}publish(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let r=i.info,n=Date.now(),s=ut(ut({},r),{},{eventType:er.PUBLISH,lts:n,eventElapse:t.eventElapse,elapse:n-i.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:ui.PUBLISH,data:s},!0)}subscribe(e,t,i){let r=this.baseInfoMap.get(e);if(!r)return;let n=r.info,s=Date.now(),c=ut(ut({},n),{},{eventType:er.SUBSCRIBE,lts:s,eventElapse:t.eventElapse,elapse:s-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?c.peerSuid=t.peerid:c.peer=t.peerid,this.send({type:ui.SUBSCRIBE,data:c},!0)}wsCompressorInit(e){var t;let i=[...Mn(t=this.baseInfoMap).call(t)],r=i.length?i[0]:"UnableToGetSid",n=this.baseInfoMap.get(r);if(!n)return;let s=n.info,c=Date.now(),l=ut(ut({},s),{},{eventType:er.WS_COMPRESSOR_INIT,lts:c,eventElapse:e.eventElapse,elapse:c-n.startTime,status:e.status?1:2});this.send({type:ui.WS_COMPRESSOR_INIT,data:l},!0)}firstXLAPeerFirstVideoFrame(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let r=i.info,n=Date.now(),s=t.peerPubStatusMs-(i.lastJoinSuccessTime||n),c=ut(ut({},r),{},{elapse:n-i.startTime,eventType:er.XLA_PEER_FIRST_VIDEO_FRAME,lts:n,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:s,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>s?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:ui.XLA_PEER_FIRST_VIDEO_FRAME,data:c},!0)}firstRemoteVideoDecode(e,t,i,r){let n=this.baseInfoMap.get(e);if(!n)return;let s=n.info,c=Date.now(),l=ut(ut(ut({},s),r),{},{elapse:c-n.startTime,eventType:t,lts:c,firstDecodeFrame:Math.max((r.firstFrame||c)-n.startTime,0),apEnd:Math.max(r.apEnd-n.startTime,0),apStart:Math.max(r.apStart-n.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-n.startTime,0),joinGwStart:Math.max(r.joinGwStart-n.startTime,0),pcEnd:Math.max(r.pcEnd-n.startTime,0),pcStart:Math.max(r.pcStart-n.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-n.startTime,0),subscriberStart:Math.max(r.subscriberStart-n.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-n.startTime,0)});this.send({type:i,data:l},!0)}firstRemoteFrame(e,t,i,r){let n=this.baseInfoMap.get(e);if(!n)return;let s=n.info,c=Date.now(),l=ut(ut(ut({},s),r),{},{elapse:c-n.startTime,eventType:t,lts:c});this.send({type:i,data:l},!0)}abTest(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let r=i.info,n=Date.now(),s=ut(ut(ut({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:n-i.startTime,eventType:er.AB_TEST,lts:n});this.send({type:ui.AB_TEST,data:s},!0)}pcStats(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let r=i.info,n=Date.now(),s=ut(ut(ut({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:n-i.startTime,eventType:er.PC_STATS,lts:n,preallocation:t.preallocation?1:0});this.send({type:ui.PC_STATS,data:s},!0)}updateRemoteRTPCapabilities(e,t){if(e){let i=this.baseInfoMap.get(e);if(!i)return;let r=i.info,n=Date.now(),s=ut(ut(ut({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),eventType:er.UPDATE_REMOTE_RTPCAPABILITIES,lts:n});this.send({type:ui.UPDATE_REMOTE_RTPCAPABILITIES,data:s},!0)}}onGatewayStream(e,t,i,r){let n=this.baseInfoMap.get(e);if(!n)return;let s=n.info,c=Date.now(),l=ut(ut(ut({},s),r),{},{eventType:t,lts:c});this.send({type:i,data:l},!0)}streamSwitch(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let r=i.info,n=Date.now(),s=ut(ut({},r),{},{eventType:er.STREAM_SWITCH,lts:n,isDual:t.isdual,elapse:n-i.startTime,success:t.succ});this.send({type:ui.STREAM_SWITCH,data:s},!0)}requestProxyAppCenter(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let r=i.info,n=Date.now(),s=ut(ut({},r),{},{eventType:er.REQUEST_PROXY_APPCENTER,lts:n,eventElapse:n-t.lts,elapse:n-i.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:ui.REQUEST_PROXY_APPCENTER,data:s},!0)}requestProxyWorkerManager(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let r=i.info,n=Date.now(),s=ut(ut({},r),{},{eventType:er.REQUEST_PROXY_WORKER_MANAGER,lts:n,eventElapse:n-t.lts,elapse:n-i.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:ui.REQUEST_PROXY_WORKER_MANAGER,data:s},!0)}setProxyServer(e){this.proxyServer=e,e?y.debug("reportProxyServerurl: ".concat(e)):y.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let r=i.info,n=Date.now(),s=ut(ut({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:n,elapse:n-i.startTime,joinChannelSuccessElapse:n-(i.lastJoinSuccessTime||n),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:ui.PEER_PUBLISH_STATUS,data:s},!0)}workerEvent(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let r=i.info,n=Date.now();(function(s,c,l){let d=s[c];if(!d||typeof d!="string")return[s];s[c]="";let h=ec(JSON.stringify(s)),p=0,_=[],E=0;for(let R=0;R<d.length;R++)E+=d.charCodeAt(R)<=127?1:3,E<=l-h||(_[_.length]=ge(ge({},s),{},{[c]:d.substring(p,R)}),p=R,E=d.charCodeAt(R)<=127?1:3);return p!==d.length-1&&(_[_.length]=ge(ge({},s),{},{[c]:d.substring(p)})),_})(ut(ut(ut({},r),t),{},{elapse:n-i.startTime,lts:n,productType:"WebRTC"}),"payload",1300).forEach(s=>this.send({type:ui.WORKER_EVENT,data:s},!0))}apworkerEvent(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let r=i.info,n=Date.now(),s=ut(ut(ut({},r),t),{},{elapse:n-i.startTime,lts:n});this.send({type:ui.AP_WORKER_EVENT,data:s},!0)}joinWebProxyAP(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let r=i.info,n=Date.now(),s=ut(ut(ut({},r),t),{},{elapse:n-i.startTime,lts:n,extend:t.extend||void 0});this.send({type:ui.JOIN_WEB_PROXY_AP,data:s},!0)}WebSocketQuit(e,t){let i=this.baseInfoMap.get(e);if(!i)return;let r=i.info,n=Date.now(),s=ut(ut(ut({},r),t),{},{elapse:n-i.startTime,lts:n});this.send({type:ui.WEBSOCKET_QUIT,data:s},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>U("CUSTOM_REPORT_LIMIT"))throw new ne(k.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let i=Date.now(),r=t.map(n=>({type:ui.USER_ANALYTICS,data:ut(ut({sid:e},n),{},{lts:i})}));try{U("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(n){throw y.error("send custom report message failed",n.toString()),new ne(k.CUSTOM_REPORT_SEND_FAILED,n.message)}}sendApiInvoke(e){let t=U("NOT_REPORT_EVENT");if(e.tag&&ve(t)&&ve(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;let i=this.baseInfoMap.get(e.sid);if(!i)return this.apiInvokeUploadPendingItems.push(e),!1;let{cname:r,uid:n,cid:s}=i.info,c;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof ne){let{code:d,message:h}=e.error;c=d||h||e.error.toString()}else c=e.error.toString();let l={invokeId:e.invokeId,sid:e.sid,cname:r,cid:s,uid:n,lts:e.lts,success:e.success,elapse:e.lts-i.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?c:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:ui.API_INVOKE,data:l},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){let e=this.apiInvokeUploadPendingItems;if(e.length===0)return;let t=Array.from(this.sids).find(i=>i!==null);t&&e.forEach(i=>{i&&(i.sid=t,this.sendApiInvoke(Object.assign({},i)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>U("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){let i=[],r=[];for(;e.length;){let s=e.shift();i.length<20?i.push(s):r.push(s)}e.push(...r);for(let s of[...i]){var n;this.ltsList.indexOf(s.data.lts)!==-1?(s.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s.data.lts)):(this.ltsList.push(s.data.lts),ct(n=this.ltsList).call(n,(c,l)=>c-l))}return t||(this.lastSendNormalEventTime=Date.now()),U("ENABLE_EVENT_REPORT")&&i.length&&(U("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((s=>c=>{U("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(s):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(s),this.normalEventUploadPendingItems.length>U("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-U("NORMAL_EVENT_QUEUE_CAPACITY")),y.warning("report: drop normal events"))))})(i)),e}async postDataToStatsCollector2(e){Bi.networkState===$n.OFFLINE&&await we.race([Bi.onlineWaiter,fr(2*Wi.maxRetryTimeout)]);let t=n=>{let s=new Uint8Array;return n.forEach(c=>{let l=KA(JSON.stringify(c.data)),d=new ArrayBuffer(5),h=(_=>{let E=0;return Object.entries(ui).forEach(R=>{let[N,w]=R;w===_.type&&(E=x8[N])}),E})(c),p=new DataView(d);p.setUint16(0,l.byteLength,!0),p.setUint8(2,255&h),p.setUint8(3,h>>>8&255),p.setUint8(4,h>>>16&255),s=cL(s,new Uint8Array(d)),s=cL(s,l)}),s},i="event",r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(U("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(U("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let n=0;n<2;n+=1){n===1&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(U("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(U("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await $A(r,{timeout:1e4,data:t(e),headers:ut(ut({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(s){if(n===1)throw s;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=(l=>{let d=l&&l.data.sid&&this.baseInfoMap.get(l.data.sid);return d&&d.info.vid&&+d.info.vid||0})(e[0]),r=i?void 0:this._aid,n={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(l=>JSON.stringify(l)),vid:i,aid:r};Bi.networkState===$n.OFFLINE&&await we.race([Bi.onlineWaiter,fr(2*Wi.maxRetryTimeout)]);let s=t?"/events/proto-raws":"/events/messages",c=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(U("EVENT_REPORT_DOMAIN"),"&p=").concat(U("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(U("EVENT_REPORT_DOMAIN"),":").concat(U("STATS_COLLECTOR_PORT")).concat(s));for(let l=0;l<2;l+=1){l===1&&(c=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(U("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(U("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(U("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(U("STATS_COLLECTOR_PORT")).concat(s)));try{t?await v8(c,{timeout:1e4,data:n}):await $A(c,{timeout:1e4,data:n})}catch(d){if(l===1)throw d;continue}return}}createBaseInfo(e,t){let i=Object.assign({},M8);return i.sid=e,this.baseInfoMap.set(e,{info:i,startTime:t}),i}reportResourceTiming(e,t){let i=performance.getEntriesByName(e),r=i[i.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:pi.TRACER}).onSuccess()}};xL.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Bi.networkState,Fe.reportApiInvoke(null,{name:"logUploadError",options:e,tag:pi.TRACER}).onSuccess("logUploadError")});class $ extends ne{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Ci(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,y)}throw(){super.throw(y)}}let mr={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Ot(){return mr}function BL(){return"setSinkId"in HTMLAudioElement.prototype&&(!U("RESTRICTION_SET_PLAYBACK_DEVICE")||(al()||JP())&&!HA())}function dR(){return!mr.supportUnifiedPlan||U("CHROME_FORCE_PLAN_B")&&sl()}function uw(e){return!(Ri()||ZP(87)||dR()||!U("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||U("FORCE_DISABLE_AUTO_SUB")))}function jL(e){return!!U("ENABLE_INSTANT_VIDEO")||!(e==null||!e.autoSubscribe||U("FORCE_DISABLE_AUTO_SUB"))}let _r=(function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e})({});function im(e,t,i){return{sampleRate:e,stereo:t,bitrate:i}}function Nt(e,t,i,r,n){return{width:e,height:t,frameRate:i,bitrateMin:r,bitrateMax:n}}function Ts(e,t,i,r,n){return{width:{max:e},height:{max:t},frameRate:i,bitrateMin:r,bitrateMax:n}}function hw(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}let U8={"90p":Nt(160,90),"90p_1":Nt(160,90),"120p":Nt(160,120,15,30,65),"120p_1":Nt(160,120,15,30,65),"120p_3":Nt(120,120,15,30,50),"120p_4":Nt(212,120),"180p":Nt(320,180,15,30,140),"180p_1":Nt(320,180,15,30,140),"180p_3":Nt(180,180,15,30,100),"180p_4":Nt(240,180,15,30,120),"240p":Nt(320,240,15,40,200),"240p_1":Nt(320,240,15,40,200),"240p_3":Nt(240,240,15,40,140),"240p_4":Nt(424,240,15,40,220),"360p":Nt(640,360,15,80,400),"360p_1":Nt(640,360,15,80,400),"360p_3":Nt(360,360,15,80,260),"360p_4":Nt(640,360,30,80,600),"360p_6":Nt(360,360,30,80,400),"360p_7":Nt(480,360,15,80,320),"360p_8":Nt(480,360,30,80,490),"360p_9":Nt(640,360,15,80,800),"360p_10":Nt(640,360,24,80,800),"360p_11":Nt(640,360,24,80,1e3),"480p":Nt(640,480,15,100,500),"480p_1":Nt(640,480,15,100,500),"480p_2":Nt(640,480,30,100,1e3),"480p_3":Nt(480,480,15,100,400),"480p_4":Nt(640,480,30,100,750),"480p_6":Nt(480,480,30,100,600),"480p_8":Nt(848,480,15,100,610),"480p_9":Nt(848,480,30,100,930),"480p_10":Nt(640,480,10,100,400),"720p":Nt(1280,720,15,120,1130),"720p_auto":Nt(1280,720,30,900,3e3),"720p_1":Nt(1280,720,15,120,1130),"720p_2":Nt(1280,720,30,120,2e3),"720p_3":Nt(1280,720,30,120,1710),"720p_5":Nt(960,720,15,120,910),"720p_6":Nt(960,720,30,120,1380),"1080p":Nt(1920,1080,15,120,2080),"1080p_1":Nt(1920,1080,15,120,2080),"1080p_2":Nt(1920,1080,30,120,3e3),"1080p_3":Nt(1920,1080,30,120,3150),"1080p_5":Nt(1920,1080,60,120,4780),"1440p":Nt(2560,1440,30,120,4850),"1440p_1":Nt(2560,1440,30,120,4850),"1440p_2":Nt(2560,1440,60,120,7350),"4k":Nt(3840,2160,30,120,8910),"4k_1":Nt(3840,2160,30,120,8910),"4k_3":Nt(3840,2160,60,120,13500)},V8={"480p":Ts(640,480,5),"480p_1":Ts(640,480,5),"480p_2":Ts(640,480,30),"480p_3":Ts(640,480,15),"720p":Ts(1280,720,5),"720p_auto":Nt(1280,720,30,900,3e3),"720p_1":Ts(1280,720,5),"720p_2":Ts(1280,720,30),"720p_3":Ts(1280,720,15),"1080p":Ts(1920,1080,5),"1080p_1":Ts(1920,1080,5),"1080p_2":Ts(1920,1080,30),"1080p_3":Ts(1920,1080,15)},B8={"1SL1TL":hw(1,1),"3SL3TL":hw(3,3),"2SL3TL":hw(2,3)};function vs(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},U8[e]):e}function pw(e){return typeof e=="string"?Object.assign({},V8[e]):e}function uR(e){return typeof e=="string"?Object.assign({},B8[e]):e}let j8={speech_low_quality:im(16e3,!1),speech_standard:im(32e3,!1,18),music_standard:im(48e3,!1),standard_stereo:im(48e3,!0,56),high_quality:im(48e3,!1,128),high_quality_stereo:im(48e3,!0,192)};function hR(e){return typeof e=="string"?Object.assign({},j8[e]):e}let rm=[];function FL(e){return $i(e,"mediaSource",["screen","window","application"]),!0}let xe=(function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e})({}),qt=(function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e})({}),nm=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e})({}),F8=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e})({}),G8=(function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e})({}),Ch=(function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e})({}),am=(function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e})({}),Ha=(function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e})({}),sm=(function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e})({}),_a=(function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e})({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});let fw={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},mw={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},GL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},H8={uplinkNetworkQuality:0,downlinkNetworkQuality:0},HL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},cn=(function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e})({}),Ea=(function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e})({}),Pg=(function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e})({}),bh=(function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e})({}),kr=(function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e})({}),ic=(function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e})({}),_w={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},pR=(function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e})({});function yt(e,t,i,r,n){var s,c,l={};return Object.keys(r).forEach(function(d){l[d]=r[d]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=In(s=yp(c=i.slice()).call(c)).call(s,function(d,h){return h(e,t,d)||d},l),n&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(n):void 0,l.initializer=void 0),l.initializer===void 0?(Object.defineProperty(e,t,l),null):l}function Z(e,t,i){return(t=(function(r){var n=(function(s,c){if(typeof s!="object"||!s)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var d=l.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)})(r);return typeof n=="symbol"?n:n+""})(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function WL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function ri(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?WL(Object(i),!0).forEach(function(r){Z(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):WL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}class zL extends Ei{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Ch.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,i){super(),Z(this,"trackMediaType",void 0),Z(this,"_ID",void 0),Z(this,"_rtpTransceiver",void 0),Z(this,"_lowRtpTransceiver",void 0),Z(this,"_hints",[]),Z(this,"_isClosed",!1),Z(this,"_originMediaStreamTrack",void 0),Z(this,"mediaStreamTrack",void 0),Z(this,"_external",{}),this._ID=i||Zt(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,(function(r){ve(rm).call(rm,r)||rm.push(r)})(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Nd(()=>{var i;Fe.reportApiInvoke(null,{name:Oi.GET_MEDIA_STREAM_TRACK,options:[],tag:pi.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===nm.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,(function(t){let i=rm.indexOf(t);i!==-1&&rm.splice(i,1)})(this),this.emit(am.CLOSED),this.removeAllListeners(Ch.SEI_RECEIVED)}_updateRtpTransceiver(t,i){if(i===nm.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Ch.TRANSCEIVER_UPDATED,t,i)}}class om extends zL{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,i){super(t,i),Z(this,"_enabled",!0),Z(this,"_muted",!1),Z(this,"_isExternalTrack",!1),Z(this,"_isClosed",!1),Z(this,"_enabledMutex",void 0),Z(this,"processor",void 0),Z(this,"_processorContext",void 0),Z(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Lr("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,i;return(t=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,y.debug("[".concat(this.getTrackId(),"] close")),this.emit(xe.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,i){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Jt(this,xe.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){y.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(am.TRACK_ENDED)}stateCheck(t,i){if(y.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(i,"]")),ro(i,t),this._enabled&&this._muted&&t==="enabled"&&i===!1)throw new ne(k.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",y);if(!this._enabled&&!this._muted&&t==="muted"&&i===!0)throw new ne(k.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",y)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():we.resolve([])}}let KL=window.AudioContext||window.webkitAudioContext,ga=null,Wt=new class extends Ei{constructor(){super(...arguments),Z(this,"prevState",void 0),Z(this,"curState",void 0),Z(this,"currentTime",void 0),Z(this,"currentTimeStuckAt",void 0),Z(this,"interruptDetectorTrack",void 0),Z(this,"onLocalAudioTrackMute",()=>{y.info("ios15-interruption-start"),this.emit(_r.IOS_15_16_INTERRUPTION_START)}),Z(this,"onLocalAudioTrackUnmute",async()=>{y.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?y.info("ios15-interruption-end-canceled"):(ga&&await ga.suspend(),this.emit(_r.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){y.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){y.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function cm(){if(!ga){if((function(){if(!KL)return void y.error("your browser is not support web audio");y.info("create audio context");let e=ri({},U("WEBAUDIO_INIT_OPTIONS"));y.debug("audio context init option:",JSON.stringify(e)),ga=new KL(e),Wt.curState=ga.state,ga.onstatechange=()=>{Wt.prevState=Wt.curState,Wt.curState=ga?ga.state:void 0;let{prevState:t,curState:i}=Wt,r=i==="running",n=i==="interrupted",s=t==="running",c=t==="suspended",l=t==="interrupted",d=Ct().osVersion;(zr()||gs())&&s&&n&&(y.info("ios".concat(d,"-interruption-start")),Wt.emit(_r.IOS_INTERRUPTION_START)),(zr()||gs())&&(c||l)&&r&&(y.info("ios".concat(d,"-interruption-end")),Wt.emit(_r.IOS_INTERRUPTION_END)),t!==i&&Wt.emit(_r.STATE_CHANGE,i,t)},setInterval(()=>{var t;let i=(t=ga)===null||t===void 0?void 0:t.currentTime;Wt.currentTime!==i?(Wt.currentTimeStuckAt&&(y.debug("AudioContext current time resume at ".concat(i)),Wt.currentTimeStuckAt=void 0),Wt.currentTime=i):(i!==Wt.currentTimeStuckAt&&(Fe.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:pi.TRACER}).onSuccess(),y.warning("AudioContext current time stuck at ".concat(i))),Wt.currentTimeStuckAt=i)},5e3),(async function(t){let i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],r,n=!1,s=!1,c=!1;function l(w){t.state==="running"?d(!1):zr()||gs()?t.state==="suspended"&&(d(!0),w&&t.resume().then(h,h)):t.state!=="closed"&&(d(!0),w&&t.resume().then(h,h))}function d(w){if(n!==w){n=w;for(let O=0,L=i;O<L.length;O+=1){let M=L[O];w?window.addEventListener(M,p,{capture:!0,passive:!0}):window.removeEventListener(M,p,{capture:!0,passive:!0})}}}function h(){l(!1)}function p(){l(!0)}function _(w){if(!c)if(r.paused)if(w){let O;E(!1),c=!0;try{O=r.play(),O?O.then(R,R):(r.addEventListener("playing",R),r.addEventListener("abort",R),r.addEventListener("error",R))}catch{R()}}else E(!0);else E(!1)}function E(w){if(s!==w){s=w;for(let O=0,L=i;O<L.length;O++){let M=L[O];w?window.addEventListener(M,N,{capture:!0,passive:!0}):window.removeEventListener(M,N,{capture:!0,passive:!0})}}}function R(){r.removeEventListener("playing",R),r.removeEventListener("abort",R),r.removeEventListener("error",R),c=!1,_(!1)}function N(){_(!0)}if(zr()){let w=t.createMediaStreamDestination(),O=document.createElement("div");O.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=O.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=w.stream,_(!0)}Wt.on(_r.STATE_CHANGE,function(){l(!0)}),l(!1)})(ga)})(),!ga)throw new ne(k.NOT_SUPPORTED,"can not create audio context");return ga}return ga}function Ah(e){if((function(){if(Ew!==null)return Ew;let r=cm(),n=r.createBufferSource(),s=r.createGain(),c=r.createGain();n.connect(s),n.connect(c),n.disconnect(s);let l=!1;try{n.disconnect(s)}catch{l=!0}return n.disconnect(),Ew=l,l})())return;let t=e.connect,i=e.disconnect;e.connect=(r,n,s)=>{var c;return e._inputNodes||(e._inputNodes=[]),ve(c=e._inputNodes).call(c,r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,n,s)):t.call(e,r,n)),e},e.disconnect=(r,n,s)=>{i.call(e),r?iR(e._inputNodes,r):e._inputNodes=[];for(let c of e._inputNodes)t.call(e,c)}}let Ew=null;function gw(e,t){let i=!1,r=1/t;if(U("DISABLE_WEBAUDIO")){let n=window.setInterval(()=>{i?window.clearInterval(n):e(performance.now()/1e3)},1e3*r)}else{let n=cm(),s=n.createGain();s.gain.value=0,s.connect(n.destination);let c=()=>{if(i)return void(s=null);let l=n.createOscillator();l.onended=c,l.connect(s),l.start(0),l.stop(n.currentTime+r),e(n.currentTime)};c()}return()=>{i=!0}}class YL{constructor(){Z(this,"context",void 0),Z(this,"analyserNode",void 0),Z(this,"sourceNode",void 0),this.context=cm(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||zr()||gs()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{let r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let n=0;n<t.length;++n)t[n]=r[n]/128-1}let i=In(t).call(t,(r,n)=>r+n*n,0)/t.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,i;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{y.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class qL extends Ei{get processSourceNode(){return this.sourceNode}set processedNode(t){var i;if(!this.isDestroyed&&this._processedNode!==t){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Z(this,"outputNode",void 0),Z(this,"outputTrack",void 0),Z(this,"isPlayed",!1),Z(this,"sourceNode",void 0),Z(this,"context",void 0),Z(this,"audioBufferNode",void 0),Z(this,"destNode",void 0),Z(this,"audioOutputLevel",0),Z(this,"volumeLevelAnalyser",void 0),Z(this,"_processedNode",void 0),Z(this,"playNode",void 0),Z(this,"isDestroyed",!1),Z(this,"onNoAudioInput",void 0),Z(this,"isNoAudioInput",!1),Z(this,"_noAudioInputCount",0),this.context=cm(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Ah(this.outputNode),this.volumeLevelAnalyser=new YL}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(_a.ON_AUDIO_BUFFER,(function(r){for(let n=0;n<r.outputBuffer.numberOfChannels;n+=1){let s=r.outputBuffer.getChannelData(n);for(let c=0;c<s.length;c+=1)s[c]=0}return r.inputBuffer})(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ot().webAudioMediaStreamDest)throw new ne(k.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&rR(()=>{Wt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;zr()||gs()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let i=this.volumeLevelAnalyser.getAnalyserNode(),r;i.getFloatTimeDomainData?(r=new Float32Array(i.fftSize),i.getFloatTimeDomainData(r)):(r=new Uint8Array(i.fftSize),i.getByteTimeDomainData(r));let n=!1;for(let s=0;s<r.length;s++)r[s]!==0&&(n=!0);return n?(this.isNoAudioInput=!1,!0):(await fr(200),await this.checkHasAudioInput(t?t+1:1)&&n)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,i;(t=this.processedNode)===null||t===void 0||t.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class XL extends qL{get isFreeze(){return!1}constructor(t,i,r){var n;if(super(),Z(this,"sourceNode",void 0),Z(this,"track",void 0),Z(this,"clonedTrack",void 0),Z(this,"audioElement",void 0),Z(this,"isCurrentTrackCloned",!1),Z(this,"isRemoteTrack",!1),Z(this,"originVolumeLevelAnalyser",void 0),Z(this,"rebuildWebAudio",async()=>{if(y.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void y.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>y.info("resume success")),y.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let l=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?l.stop():this.isCurrentTrackCloned=!0;let d=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(d),Ah(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let h=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(h,this.context.currentTime),Ah(this.outputNode),this.emit(_a.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=d,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new ne(k.UNEXPECTED_ERROR);this.track=t;let s=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(s),Ah(this.sourceNode),r){let l=r.clone();l.enabled=!0,this.clonedTrack=l,y.debug("create an unmuted track ".concat(l.id," from the original track ").concat(r.id," to get the volume"));let d=this.context.createMediaStreamSource(new MediaStream([l]));Ah(d),this.originVolumeLevelAnalyser=new YL,this.originVolumeLevelAnalyser.updateSource(d)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;let c=Ct();i&&c.os===rr.IOS&&Number((n=c.osVersion)===null||n===void 0?void 0:n.split(".")[0])<15&&(Wt.on(_r.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(l=>{l||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;let i=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(i),Ah(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(_a.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Wt.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){let i=t.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),y.debug("create an unmuted track ".concat(i.id," from the original track ").concat(t.id," to get the volume"));let r=this.context.createMediaStreamSource(new MediaStream([i]));Ah(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function JL(e,t,i){let r=(s,c)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||c:s:c,n={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(n.video.mandatory.maxFrameRate=t.frameRate.max,n.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(n.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(n)}async function W8(e,t){let i=await ZL(e.mediaSource),{sourceId:r,audio:n}=await(function(s){let c=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new we((l,d)=>{let h=document.createElement("div");h.innerText="share screen",h.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let p=document.createElement("div");p.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let _=document.createElement("div");_.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",_.setAttribute("style","height: 12%;");let E=document.createElement("div");E.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let R=document.createElement("div");R.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let N=document.createElement("button");N.innerHTML="cancel",N.setAttribute("style","width: 85px;"),N.onclick=()=>{document.body.removeChild(L);let M=new Error("NotAllowedError");M.name="NotAllowedError",d(M)};let w=c,O=document.createElement("div");if(c){let M=document.createElement("input");M.setAttribute("type","checkbox");let B=document.createElement("span");M.setAttribute("style","margin-right: 6px;"),B.innerText="Share audio",M.checked=w,M.onchange=()=>{w=M.checked},O.appendChild(M),O.appendChild(B)}R.appendChild(O),R.appendChild(N),p.appendChild(_),p.appendChild(E),p.appendChild(R);let L=document.createElement("div");L.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),L.appendChild(h),L.appendChild(p),document.body.appendChild(L),s.map(M=>{if(M.id){let B=document.createElement("div");B.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Y=M.thumbnail;try{let{width:H}=Y.getSize();H>1920&&(Y=Y.resize({width:1920}))}catch(H){throw H&&H.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),H}B.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Y.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+M.name.replace(/[\u00A0-\u9999<>\&]/g,function(H){return"&#"+H.charCodeAt(0)+";"})+"</span>",B.onclick=()=>{document.body.removeChild(L),l({sourceId:M.id,audio:w})},E.appendChild(B)}})})})(i,t);return await JL(r,e,n)}async function ZL(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);let i=lL();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new ne(k.ELECTRON_IS_NULL);let r=null;try{var n;r=((n=i.desktopCapturer)===null||n===void 0?void 0:n.getSources({types:t}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new we((s,c)=>{i.desktopCapturer.getSources({types:t},(l,d)=>{l?c(l):s(d)})}));try{return await r}catch(s){throw new ne(k.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}let Sw=new Lr("safari"),QL=!1,$L=!1;async function Sa(e,t){let i=0,r=null;for(;i<2;)try{r=await z8(e,t,i>0);break}catch(n){if(n instanceof ne)throw y.error("[".concat(t,"] ").concat(n.toString())),n;let s=fR(n.name||n.code||n,n.message);if(s.code===k.MEDIA_OPTION_INVALID){y.debug("[".concat(t,"] detect media option invalid, retry")),i+=1,await fr(500);continue}throw y.error("[".concat(t,"] ").concat(s.toString())),s}if(!r)throw new ne(k.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function z8(e,t,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new ne(k.NOT_SUPPORTED,"can not find getUserMedia");i&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let r=Ot(),n=new MediaStream;if(e.audioSource&&n.addTrack(e.audioSource),e.videoSource&&n.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return y.debug("Using Video Source/ Audio Source"),n;if(e.screen)if(lL())e.screen.sourceId?lm(n,await JL(e.screen.sourceId,e.screen,!!e.screenAudio)):lm(n,await W8(e.screen,!!e.screenAudio));else if(al()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new ne(k.NOT_SUPPORTED,"This browser does not support screen sharing");y.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));let E=await(c=e.screen.extensionId,l=t,new we((R,N)=>{try{chrome.runtime.sendMessage(c,{getStream:!0},w=>{if(!w||!w.streamId)return y.error("[".concat(l,"] No response from Chrome Plugin. Plugin not installed properly"),w),void N(new ne(k.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));R(w.streamId)})}catch(w){y.error("[".concat(l,"] AgoraRTC screensharing plugin is not accessible(").concat(c,")"),w.toString()),N(new ne(k.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=E,lm(n,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var s;e.screen.mediaSource&&FL(e.screen.mediaSource);let E={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(s=e.screen.displaySurface)!==null&&s!==void 0?s:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:R,surfaceSwitching:N,systemAudio:w,preferCurrentTab:O}=e.screen,L={selfBrowserSurface:R,surfaceSwitching:N,systemAudio:w,preferCurrentTab:O};!R&&delete L.selfBrowserSurface,!N&&delete L.surfaceSwitching,!w&&delete L.systemAudio,!O&&delete L.preferCurrentTab,y.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:E,audio:e.screenAudio,controls:L})),lm(n,await navigator.mediaDevices.getDisplayMedia(ri({video:E,audio:e.screenAudio},L)))}else{if(!Ri())throw y.error("[".concat(t,"] This browser does not support screenSharing")),new ne(k.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&FL(e.screen.mediaSource);let E={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};y.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(E))),lm(n,await navigator.mediaDevices.getUserMedia(E))}}var c,l;if(!e.video&&!e.audio)return n;let d={video:e.video,audio:e.audio},h=U("MEDIA_DEVICE_CONSTRAINTS");if(h)try{typeof h=="string"&&(h=JSON.parse(h)),d=XA(d,h)}catch{}y.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(d)),Ct();let p,_=null;(Rr()||zr()||eR())&&(_=await Sw.lock());try{p=await navigator.mediaDevices.getUserMedia(d)}catch(E){throw _&&_(),E}return d.audio&&(QL=!0),d.video&&($L=!0),lm(n,p),_&&_(),n}function fR(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new ne(k.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new ne(k.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new ne(k.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new ne(k.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new ne(k.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new ne(k.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return y.error("getUserMedia unexpected error",e),new ne(k.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function lm(e,t){let i=e.getVideoTracks()[0],r=e.getAudioTracks()[0],n=t.getVideoTracks()[0],s=t.getAudioTracks()[0];s&&(r&&e.removeTrack(r),e.addTrack(s)),n&&(i&&e.removeTrack(i),e.addTrack(n))}let Ta=new class extends Ei{get state(){return this._state}set state(e){e!==this._state&&(this.emit(bh.STATE_CHANGE,e),this._state=e)}constructor(){super(),Z(this,"_state",Pg.IDLE),Z(this,"isAccessMicrophonePermission",!1),Z(this,"isAccessCameraPermission",!1),Z(this,"lastAccessMicrophonePermission",!1),Z(this,"lastAccessCameraPermission",!1),Z(this,"checkdeviceMatched",!1),Z(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(U("ENUMERATE_DEVICES_INTERVAL")||(tR()||$0()===rr.HARMONY_OS)&&sl())&&this.updateDevicesInfo()},U("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>y.error(e.toString()))}async enumerateDevices(e,t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new ne(k.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let r=await navigator.mediaDevices.enumerateDevices(),n=this.checkMediaDeviceInfoIsOk(r),s=!this.isAccessMicrophonePermission&&e,c=!this.isAccessCameraPermission&&t;n.audio&&(s=!1),n.video&&(c=!1);let l=null,d=null,h=null;if(!i&&(s||c)){if(Sw.isLocked&&(y.debug("[device manager] wait GUM lock"),(await Sw.lock())(),y.debug("[device manager] GUM unlock")),QL&&(s=!1,this.isAccessMicrophonePermission=!0),$L&&(c=!1,this.isAccessCameraPermission=!0),y.debug("[device manager] check media device permissions",e,t,s,c),s&&c){try{h=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(p){let _=fR(p.name||p.code||p,p.message);if(_.code===k.PERMISSION_DENIED)throw _;y.warning("getUserMedia failed in getDevices",_)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{l=await navigator.mediaDevices.getUserMedia({audio:e})}catch(p){let _=fR(p.name||p.code||p,p.message);if(_.code===k.PERMISSION_DENIED)throw _;y.warning("getUserMedia failed in getDevices",_)}this.isAccessMicrophonePermission=!0}else if(c){try{d=await navigator.mediaDevices.getUserMedia({video:t})}catch(p){let _=fR(p.name||p.code||p,p.message);if(_.code===k.PERMISSION_DENIED)throw _;y.warning("getUserMedia failed in getDevices",_)}this.isAccessCameraPermission=!0}y.debug("[device manager] mic permission",e,"cam permission",t)}try{let p=await navigator.mediaDevices.enumerateDevices();return l&&l.getTracks().forEach(_=>_.stop()),d&&d.getTracks().forEach(_=>_.stop()),h&&h.getTracks().forEach(_=>_.stop()),l=null,d=null,h=null,p}catch(p){return l&&l.getTracks().forEach(_=>_.stop()),d&&d.getTracks().forEach(_=>_.stop()),h&&h.getTracks().forEach(_=>_.stop()),l=null,d=null,h=null,new ne(k.ENUMERATE_DEVICES_FAILED,p.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(i=>{i.device.label===e&&(t=i.device.deviceId)}),t}async getDeviceById(e){let t=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===e);if(!t)throw new ne(k.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Pg.INITING;try{await this.updateDevicesInfo(),this.state=Pg.INITEND}catch(e){throw y.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Pg.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new ne(k.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){let e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),i=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let n=e.find(c=>c.kind==="audioinput"&&c.deviceId==="default"),s=e.find(c=>c.kind==="audiooutput"&&c.deviceId==="default");n&&s?s.groupId===n.groupId?y.debug("[device-check] default input ".concat(n.label," and output ").concat(s.label," is the same group")):y.debug("[device-check] default input ".concat(n.label," and output ").concat(s.label," is not the same group")):y.debug("[device-check] default input or output not found")}let r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(n=>{if(!n.deviceId)return;let s=this.deviceInfoMap.get("".concat(n.kind,"_").concat(n.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){let c={initAt:t,updateAt:t,device:n,state:"ACTIVE"};this.deviceInfoMap.set("".concat(n.kind,"_").concat(n.deviceId),c),i.push(c)}s&&(s.updateAt=t)}),this.deviceInfoMap.forEach((n,s)=>{n.state==="ACTIVE"&&n.updateAt!==t&&(n.state="INACTIVE",i.push(n))}),this.state!==Pg.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(n=>{switch(n.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(bh.RECORDING_DEVICE_CHANGED,n);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(bh.CAMERA_DEVICE_CHANGED,n);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(bh.PLAYOUT_DEVICE_CHANGED,n)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){let t=e.filter(n=>n.kind==="audioinput"),i=e.filter(n=>n.kind==="videoinput"),r={audio:!1,video:!1};for(let n of t)if(n.label&&n.deviceId){r.audio=!0;break}for(let n of i)if(n.label&&n.deviceId){r.video=!0;break}return r}},Tw=!1,va=new class extends Ei{constructor(){super(...arguments),Z(this,"onAutoplayFailed",void 0),Z(this,"onAudioAutoplayFailed",void 0)}};function e2(){if(Ct(),!Tw){let e=t=>{t.preventDefault(),Tw=!1,Rg()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Tw=!0,Rg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),y.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),va.onAutoplayFailed?va.onAutoplayFailed():va.onAudioAutoplayFailed?y.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):y.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),va.emit("autoplay-failed")}}function t2(e,t,i,r){if(!e)return;let n=Fe.getBaseInfoBySessionId(e);if(!n)return;let s=n.info,c=Date.now(),l=ri(ri({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:c,elapse:c-n.startTime,cbRegistered:va.onAutoplayFailed||va.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:t,trackId:r,extend:void 0});Fe.send({type:ui.AUTOPLAY_FAILED,data:l},!0)}let K8=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],vn=new class{constructor(){Z(this,"onAutoplayFailed",void 0),Z(this,"elementMap",new Map),Z(this,"elementStateMap",new Map),Z(this,"elementsNeedToResume",[]),Z(this,"sinkIdMap",new Map),Z(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[i,r]=t,n=this.elementStateMap.get(i),s=r.srcObject.getAudioTracks()[0],c=s&&s.readyState;if(y.debug("resume after interrupted, ele: ".concat(n," audio: ").concat(c," ").concat(e)),c==="live"){if(e)return r.pause(),void r.play();if(Wt.curState==="running")return Xf()?(r.pause(),void r.play()):void(n&&n==="paused"&&r.play())}})}),Z(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,i]=e,r=i.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(y.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),Wt.on(_r.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Wt.on(_r.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Wt.on(_r.STATE_CHANGE,()=>{zr()&&Wt.prevState==="suspended"&&Wt.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){let i=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),i)try{await i.setSinkId(t)}catch(r){throw new ne(k.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,i,r){if(this.elementMap.has(t))return;let n=document.createElement("audio");n.autoplay=!0,n.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,n),this.elementMap.set(t,n),this.elementStateMap.set(t,kr.INIT),this.setVolume(t,i);let s=this.sinkIdMap.get(t);if(s)try{n.setSinkId(s).catch(l=>{y.warning("[".concat(t,"] set sink id failed"),l.toString())})}catch(l){y.warning("[".concat(t,"] set sink id failed"),l.toString())}let c=n.play();c&&c.then&&c.catch(l=>{r&&t2(r,"audio",l.message,t),y.warning("audio element play warning",l.toString()),this.elementMap.has(t)&&l.name==="NotAllowedError"&&(y.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(n),rR(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),e2()}))})}updateTrack(e,t){let i=this.elementMap.get(e);i&&(i.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){let i=this.elementMap.get(e);i&&(t=Math.max(0,Math.min(100,t)),i.volume=t/100)}stop(e){let t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;let i=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(i,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){K8.forEach(i=>{t.addEventListener(i,r=>{let n=this.elementStateMap.get(e),s=r.type==="pause"?"paused":r.type;if(y.debug("[".concat(e,"] audio-element-status change ").concat(n," => ").concat(s)),r.type==="error"){let c=t?.error;c&&y.error("[".concat(e,"] media error, code: ").concat(c.code,", message: ").concat(c.message))}this.elementStateMap.set(e,s)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(i=>{y.debug("Auto resume audio element success")}).catch(i=>{y.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new we(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Rg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function bi(){return function(e,t,i){let r=i.value;return typeof r=="function"&&(i.value=function(){this._isClosed&&new ne(k.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",y);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];let l=r.apply(this,s);return l instanceof we?new we((d,h)=>{l.then(d).catch(h)}):l}),i}}class i2 extends Ei{constructor(t){super(),Z(this,"name","VideoProcessorDestination"),Z(this,"ID","0"),Z(this,"_source",void 0),Z(this,"videoContext",void 0),Z(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new ne(k.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new ne(k.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(cn.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(cn.ON_TRACK,void 0)}}class r2 extends Ei{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,i){super(),Z(this,"constraintsMap",new Map),Z(this,"statsRegistry",[]),Z(this,"usageRegistry",[]),Z(this,"trackId",void 0),Z(this,"direction",void 0),Z(this,"_chained",!1),this.trackId=t,this.direction=i}async getConstraints(){return await Cr(this,Ea.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,i){var r;return y.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(i,t),Jt(this,Ea.REQUEST_UPDATE_CONSTRAINTS,Array.from(Sn(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var i;if(this.constraintsMap.has(t))return y.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),Jt(this,Ea.REQUEST_UPDATE_CONSTRAINTS,Array.from(Sn(i=this.constraintsMap).call(i)))}registerStats(t,i,r){this.statsRegistry.find(n=>n.processorID===t.ID&&n.processorName===t.name&&n.type===i)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:i,cb:r})}unregisterStats(t,i){let r=this.statsRegistry.findIndex(n=>n.processorID===t.ID&&n.processorName===t.name&&n.type===i);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){let t=[];for(let{processorID:i,processorName:r,type:n,cb:s}of this.statsRegistry)try{let c=s();t.push({processorID:i,processorName:r,type:n,stats:c})}catch(c){y.error(new ne(k.UNEXPECTED_ERROR,c.message))}return t}registerUsage(t,i){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:i})}unregisterUsage(t){let i=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:i}of this.usageRegistry)try{let r=i();r instanceof we&&(r=await r),t.push(ri(ri({},r),{},{direction:this.direction}))}catch(r){y.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class n2 extends Ei{constructor(t){super(),Z(this,"name","AudioProcessorDestination"),Z(this,"ID","0"),Z(this,"inputTrack",void 0),Z(this,"inputNode",void 0),Z(this,"audioProcessorContext",void 0),Z(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new ne(k.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new ne(k.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(cn.ON_TRACK,void 0),this.emit(cn.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(cn.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(cn.ON_NODE,this.inputNode))}}class a2 extends Ei{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,i,r){super(),Z(this,"constraintsMap",new Map),Z(this,"statsRegistry",[]),Z(this,"audioContext",void 0),Z(this,"trackId",void 0),Z(this,"direction",void 0),Z(this,"usageRegistry",[]),Z(this,"_chained",!1),this.audioContext=t,this.trackId=i,this.direction=r}async getConstraints(){return Cr(this,Ea.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,i){var r;return y.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(i,t),Jt(this,Ea.REQUEST_UPDATE_CONSTRAINTS,Array.from(Sn(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var i;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),Jt(this,Ea.REQUEST_UPDATE_CONSTRAINTS,Array.from(Sn(i=this.constraintsMap).call(i)))}registerStats(t,i,r){this.statsRegistry.find(n=>n.processorID===t.ID&&n.processorName===t.name&&n.type===i)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:i,cb:r})}unregisterStats(t,i){let r=this.statsRegistry.findIndex(n=>n.processorID===t.ID&&n.processorName===t.name&&n.type===i);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){let t=[];for(let{processorID:i,processorName:r,type:n,cb:s}of this.statsRegistry)try{let c=s();t.push({processorID:i,processorName:r,type:n,stats:c})}catch(c){y.error(new ne(k.UNEXPECTED_ERROR,c.message))}return t}registerUsage(t,i){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:i})}unregisterUsage(t){let i=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:i}of this.usageRegistry)try{let r=i();r instanceof we&&(r=await r),t.push(ri(ri({},r),{},{direction:this.direction}))}catch(r){y.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class vw extends Ei{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Z(this,"context",void 0),Z(this,"processSourceNode",void 0),Z(this,"outputTrack",void 0),Z(this,"processedNode",void 0),Z(this,"clonedTrack",void 0),Z(this,"outputNode",void 0),this.outputNode=new Y8}setVolume(){}createOutputTrack(){throw new ne(k.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Y8{disconnect(){}connect(){}}function s2(e){return new we((t,i)=>{let r=!1,n=document.createElement("video");n.setAttribute("autoplay",""),n.setAttribute("muted",""),n.muted=!0,n.autoplay=!0,n.setAttribute("playsinline",""),n.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(n);let s=zr()?"canplay":"playing";n.addEventListener(s,()=>{let c=n.videoWidth,l=n.videoHeight;!c&&Ri()||(r=!0,n.srcObject=null,n.remove(),t([c,l]))}),n.srcObject=new MediaStream([e]),n.play().catch(nR),setTimeout(()=>{r||(n.srcObject=null,n.remove(),t([n.videoWidth,n.videoHeight]))},4e3)})}function mR(e){let t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});let i=vs(e.encoderConfig);return i.width!=null&&(t.width=i.width),i.height!=null&&(t.height=i.height),!nL()&&i.frameRate&&(t.frameRate=i.frameRate),JP()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Ri()&&(t.frameRate={ideal:30,max:30}),t}function o2(e){let t={};return nL()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,al()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function c2(e){let t=o2(e);if(e.encoderConfig){let i=hR(e.encoderConfig);t.channelCount=i.stereo?2:1,t.sampleRate=i.sampleRate,t.sampleSize=i.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),tR()&&(t.sampleRate=void 0),t}let q8=e=>{let t=e._encoderConfig;if(!t)return;let{frameRate:i,width:r,height:n}=e.getMediaStreamTrackSettings(),{frameRate:s=i,width:c=r,height:l=n}=t;if(!s||!c||!l)return;c=Qf(c),l=Qf(l),s=Qf(s);let{max:d,min:h}=(function(R,N,w){let O=200*Math.pow(w/15,.6)*Math.pow(R*N/640/360,.75);return{min:Math.floor(O),max:Math.floor(4*O)}})(c,l,s),{bitrateMax:p,bitrateMin:_}=t||{};p||y.debug("calculate bitrate: [w: ".concat(c,", h: ").concat(l,", fps: ").concat(s,"] => [brMax: ").concat(p,", brMin: ").concat(_,"]"));let{maxFramerate:E}=U("ENCODER_CONFIG_LIMIT");return E&&typeof E=="number"&&(s=Math.min(s,E)),{frameRate:s,bitrateMax:p||d,bitrateMin:_||h,scaleResolutionDownBy:1,scale:0}},l2=async(e,t,i)=>await(async(r,n,s)=>{let c=(function(h){let p=[];for(let _=0;_<h.length;_+=2)p.push(parseInt(h.slice(_,_+2),16));return Uint8Array.from(p)})(TL(""+n+s)).slice(0,16),l=c.slice(0,12),d=await window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:l},d,r))})(e.buffer,t,i),Rw=e=>{let t=document.createElement("canvas");return t.width=2,t.height=2,new we((i,r)=>{t.toBlob(async n=>{if(t.remove(),n){let s=await d2(n);i({buffer:s,width:t.width,height:t.height})}else r(new ne(k.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},d2=async e=>{let t=await e.arrayBuffer();return new Uint8Array(t)};var u2,h2,p2,f2,m2,_2,E2,g2,S2,T2,v2,R2,y2,C2,b2,A2,w2,I2,gi,O2,N2,D2,P2,L2,k2,rc,M2,x2,U2,V2,B2,j2,F2,G2,H2,W2,z2,K2,Y2,Ar;let Ai=(u2=qe({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),h2=qe({argsMap:(e,t)=>[e.getTrackId(),t]}),p2=bi(),f2=$f("LocalAudioTrack","_enabledMutex"),m2=qe({argsMap:(e,t)=>[e.getTrackId(),t]}),_2=bi(),E2=$f("LocalAudioTrack","_enabledMutex"),g2=qe({argsMap:(e,t)=>[e.getTrackId(),t]}),S2=bi(),T2=bi(),v2=bi(),R2=qe({argsMap:e=>[e.getTrackId()]}),y2=bi(),C2=qe({argsMap:e=>[e.getTrackId()]}),b2=bi(),A2=qe({argsMap:e=>[e.getTrackId()]}),w2=qe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),I2=qe({argsMap:e=>[e.getTrackId()]}),yt((gi=class extends om{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?vn.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,i,r){super(e,i),Z(this,"trackMediaType",sm.AUDIO),Z(this,"_encoderConfig",void 0),Z(this,"_trackSource",void 0),Z(this,"metadata",[]),Z(this,"_enabled",!0),Z(this,"_volume",100),Z(this,"_useAudioElement",!0),Z(this,"_bypassWebAudio",!1),Z(this,"processor",void 0),Z(this,"_processorContext",void 0),Z(this,"_processorDestination",void 0),Z(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new vw,U("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),U("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Rr()&&!ga?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Yt(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&vn.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void y.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,Jt(this,xe.NEED_REPLACE_TRACK,this).then(()=>{y.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{y.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!BL())throw new ne(k.NOT_SUPPORTED,"your browser does not support setting the audio output device");await vn.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,i){return this._setEnabled(e,t,i)}async _setEnabled(e,t,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(y.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await Jt(this,xe.NEED_ENABLE_TRACK,this),y.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw i||(this._enabled=!1),y.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await Jt(this,xe.NEED_DISABLE_TRACK,this)}catch(r){throw i||(this._enabled=!0),y.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,y.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Jt(this,xe.NEED_MUTE_TRACK,this):await Jt(this,xe.NEED_UNMUTE_TRACK,this))}getStats(){return Nd(()=>{y.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),fa(this,xe.GET_STATS)||ri({},fw)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(_a.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(_a.ON_AUDIO_BUFFER),this._source.on(_a.ON_AUDIO_BUFFER,i=>e(i))}play(){y.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(y.debug("[".concat(this.getTrackId(),"] start audio playback in element")),vn.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){y.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?vn.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];y.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&vn.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Jt(this,xe.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return we.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new ne(k.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new ne(k.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(cn.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await Jt(this,xe.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Jt(this,xe.NEED_REPLACE_TRACK,this))}),e.on(cn.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(cn.ON_TRACK),e.removeAllListeners(cn.ON_NODE)}bindProcessorContextEvents(e){e.on(Ea.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Ea.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof vw&&(this._trackSource=new XL(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new a2(this._source.context,this.getTrackId(),"local"),t=new n2(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(_a.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(vn.stop(this.getTrackId()),this._source.play()),Jt(this,xe.NEED_REPLACE_MIXING_TRACK,this).then(()=>{y.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{y.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[u2],Object.getOwnPropertyDescriptor(gi.prototype,"setVolume"),gi.prototype),yt(gi.prototype,"setPlaybackDevice",[h2,p2],Object.getOwnPropertyDescriptor(gi.prototype,"setPlaybackDevice"),gi.prototype),yt(gi.prototype,"setEnabled",[f2,m2,_2],Object.getOwnPropertyDescriptor(gi.prototype,"setEnabled"),gi.prototype),yt(gi.prototype,"setMuted",[E2,g2,S2],Object.getOwnPropertyDescriptor(gi.prototype,"setMuted"),gi.prototype),yt(gi.prototype,"getStats",[T2],Object.getOwnPropertyDescriptor(gi.prototype,"getStats"),gi.prototype),yt(gi.prototype,"setAudioFrameCallback",[v2],Object.getOwnPropertyDescriptor(gi.prototype,"setAudioFrameCallback"),gi.prototype),yt(gi.prototype,"play",[R2,y2],Object.getOwnPropertyDescriptor(gi.prototype,"play"),gi.prototype),yt(gi.prototype,"stop",[C2,b2],Object.getOwnPropertyDescriptor(gi.prototype,"stop"),gi.prototype),yt(gi.prototype,"close",[A2],Object.getOwnPropertyDescriptor(gi.prototype,"close"),gi.prototype),yt(gi.prototype,"pipe",[w2],Object.getOwnPropertyDescriptor(gi.prototype,"pipe"),gi.prototype),yt(gi.prototype,"unpipe",[I2],Object.getOwnPropertyDescriptor(gi.prototype,"unpipe"),gi.prototype),gi),Lg=(O2=qe({argsMap:(e,t)=>[e.getTrackId(),t]}),N2=bi(),D2=$f("MicrophoneAudioTrack","_enabledMutex"),P2=qe({argsMap:(e,t,i)=>[e.getTrackId(),t,i]}),L2=bi(),k2=qe({argsMap:e=>[e.getTrackId()]}),yt((rc=class extends Ai{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,i,r){super(e,t.encoderConfig?hR(t.encoderConfig):{},r,U("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Z(this,"_config",void 0),Z(this,"_deviceName","default"),Z(this,"_constraints",void 0),Z(this,"_originalConstraints",void 0),Z(this,"_enabled",!0),this._config=t,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Xf()||GA())&&Wt.bindInterruptDetectorTrack(this)}async setDevice(e){if(y.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{let t=await Ta.getDeviceById(e),i={};i.audio=ri({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await Sa(i,this.getTrackId())}catch(n){throw y.error("[".concat(this.getTrackId(),"] setDevice failed"),n.toString()),r=await Sa({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),n}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw y.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{let t=await Ta.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw y.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}y.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,i){if(t)return y.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(y.info("[".concat(this.getTrackId(),"] start setEnabled"),e),U("AUTO_RESET_AUDIO_ROUTE")&&(zr()||gs())){let c=navigator.audioSession;c&&(e||(c.type="playback"),c.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),i||(this._enabled=!1);try{await Jt(this,xe.NEED_DISABLE_TRACK,this)}catch(c){throw y.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}let n=ri({},this._constraints),s=Ta.searchDeviceIdByName(this._deviceName);s&&!n.deviceId&&(n.deviceId=s);try{i||(this._enabled=!0);let c=await Sa({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await Jt(this,xe.NEED_ENABLE_TRACK,this)}catch(c){throw i||(this._enabled=!1),y.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}y.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Xf()||GA())&&Wt.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((zr()||gs())&&this._enabled&&!this._isClosed&&Wt.duringInterruption){let e=async()=>{Wt.off(_r.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(y.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Wt.on(_r.IOS_INTERRUPTION_END,e)}else y.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(am.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,i=Ta.searchDeviceIdByName(this._deviceName);if(i&&!t.deviceId&&(t.deviceId=i),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();let r=await Sa({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Ea.REQUEST_UPDATE_CONSTRAINTS,async(t,i,r)=>{try{let n=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(n),i()}catch(n){r(n)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Ea.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[O2,N2],Object.getOwnPropertyDescriptor(rc.prototype,"setDevice"),rc.prototype),yt(rc.prototype,"setEnabled",[D2,P2,L2],Object.getOwnPropertyDescriptor(rc.prototype,"setEnabled"),rc.prototype),yt(rc.prototype,"close",[k2],Object.getOwnPropertyDescriptor(rc.prototype,"close"),rc.prototype),rc),X8=(M2=qe({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),x2=bi(),U2=qe({argsMap:e=>[e.getTrackId()]}),V2=bi(),B2=qe({argsMap:e=>[e.getTrackId()]}),j2=bi(),F2=qe({argsMap:e=>[e.getTrackId()]}),G2=bi(),H2=qe({argsMap:e=>[e.getTrackId()]}),W2=bi(),z2=qe({argsMap:e=>[e.getTrackId()]}),K2=qe({argsMap:e=>[e.getTrackId()]}),Y2=bi(),yt((Ar=class extends Ai{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,i,r){super(t.createOutputTrack(),i,r),Z(this,"source",void 0),Z(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(_a.AUDIO_SOURCE_STATE_CHANGE,n=>{this.safeEmit(am.SOURCE_STATE_CHANGE,n)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Yt(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[M2,x2],Object.getOwnPropertyDescriptor(Ar.prototype,"startProcessAudioBuffer"),Ar.prototype),yt(Ar.prototype,"pauseProcessAudioBuffer",[U2,V2],Object.getOwnPropertyDescriptor(Ar.prototype,"pauseProcessAudioBuffer"),Ar.prototype),yt(Ar.prototype,"seekAudioBuffer",[B2,j2],Object.getOwnPropertyDescriptor(Ar.prototype,"seekAudioBuffer"),Ar.prototype),yt(Ar.prototype,"resumeProcessAudioBuffer",[F2,G2],Object.getOwnPropertyDescriptor(Ar.prototype,"resumeProcessAudioBuffer"),Ar.prototype),yt(Ar.prototype,"stopProcessAudioBuffer",[H2,W2],Object.getOwnPropertyDescriptor(Ar.prototype,"stopProcessAudioBuffer"),Ar.prototype),yt(Ar.prototype,"close",[z2],Object.getOwnPropertyDescriptor(Ar.prototype,"close"),Ar.prototype),yt(Ar.prototype,"setAudioBufferPlaybackSpeed",[K2,Y2],Object.getOwnPropertyDescriptor(Ar.prototype,"setAudioBufferPlaybackSpeed"),Ar.prototype),Ar);class qi extends Ai{get __className__(){return"MixingAudioTrack"}get isActive(){for(let t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){let t=cm().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Zt(8,"track-mix-")),Z(this,"trackList",void 0),Z(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(y.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):y.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){y.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}iR(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){let t={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(i=>{i instanceof qi?i.emit(Ch.TRANSCEIVER_UPDATED,t):i._updateRtpTransceiver(t)}))}}class J8 extends qL{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(_a.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Z(this,"audioBuffer",void 0),Z(this,"sourceNode",void 0),Z(this,"startPlayTime",0),Z(this,"startPlayOffset",0),Z(this,"pausePlayTime",0),Z(this,"options",void 0),Z(this,"currentLoopCount",0),Z(this,"currentPlaybackSpeed",100),Z(this,"_currentState","stopped"),this.audioBuffer=t,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):y.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let q2=new Map;function X2(e,t){if(e.length===0||t.length===0)return 1/0;let i=JA(e),r=JA(t);return Math.floor(r/i)}class yw{get rendFrameRate(){let t=Math.max(1,X2(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:kr.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(y.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var i;t!==this._videoState&&(this._videoState=t,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(t){Z(this,"trackId",void 0),Z(this,"config",void 0),Z(this,"onFirstVideoFrameDecoded",void 0),Z(this,"onFirstVideoFrameRender",void 0),Z(this,"onVideoStateChanged",void 0),Z(this,"freezeTimeCounterList",[]),Z(this,"renderFreezeAccTime",0),Z(this,"renderFreezeAccTime2",0),Z(this,"isKeepLastFrame",!1),Z(this,"isDestroyed",!1),Z(this,"timeUpdatedCount",0),Z(this,"freezeTime",0),Z(this,"playbackTime",0),Z(this,"lastTimeUpdatedTime",0),Z(this,"autoplayFailed",!1),Z(this,"videoTrack",void 0),Z(this,"videoElement",void 0),Z(this,"cacheVideoElement",void 0),Z(this,"internal",!1),Z(this,"_render_interframe_delays",[]),Z(this,"_render_interframe_delays_sizes",[]),Z(this,"_videoState",ic.VideoStateStopped),Z(this,"videoElementCheckInterval",void 0),Z(this,"videoElementFreezeTimeout",void 0),Z(this,"_videoElementStatus",kr.NONE),Z(this,"_isInPage",!0),Z(this,"isGettingVideoDimensions",!1),Z(this,"startGetVideoDimensions",()=>{let i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return y.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),Z(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Wt.curState==="running"&&(y.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(qP())),iL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Z(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":i.type==="play"&&y.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=kr.PLAYING;break;case"loadeddata":if(this.videoState=ic.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=kr.CANPLAY;break;case"stalled":this.videoElementStatus=kr.STALLED;break;case"suspend":this.videoElementStatus=kr.SUSPEND;break;case"pause":this.videoElementStatus=kr.PAUSED,zr()||gs()||Rr()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(y.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=kr.WAITING;break;case"abort":this.videoElementStatus=kr.ABORT;break;case"ended":this.videoElementStatus=kr.ENDED;break;case"emptied":this.videoElementStatus=kr.EMPTIED;break;case"error":{let r=this.videoElement.error;r&&(this.videoElementStatus=kr.ERROR,y.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")")));break}case"timeupdate":{let r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);let n=r-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,nc.lastVisibleTime<nc.lastHiddenTime||s<nc.lastHiddenTime||s<nc.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(n>U("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=n),this.playbackTime+=n;this.playbackTime>=6e3;){this.playbackTime-=6e3;let c=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(c),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Z(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(y.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(qP())),iL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Wt.on(_r.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Wt.on(_r.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){let i=this.videoElement.play();i&&i.catch&&i.catch(n=>{t&&t2(t,"video",n.message,this.trackId),n.name==="NotAllowedError"?(y.warning("detected video element autoplay failed",n),this.autoplayFailed=!0,this.handleAutoPlayFailed()):y.warning("[".concat(this.trackId,"] play warning: "),n)});let r=Ct();if((r.name==="Safari"&&Number(r.version)===15||Xf())&&i&&i.then){let n=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(n).catch(n)}}getCurrentFrame(){let t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;let i=t.getContext("2d");if(!i)return y.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,t.width,t.height);let r=i.getImageData(0,0,t.width,t.height);return t.remove(),r}async getCurrentFrameToUint8Array(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;let n=r.getContext("2d");return n?(n.drawImage(this.videoElement,0,0,r.width,r.height),new we((s,c)=>{r.toBlob(async l=>{if(r.remove(),l){let d=await d2(l);s({buffer:d,width:r.width,height:r.height})}else c(new ne(k.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,i<0?.1:i>1?1:i)})):await Rw(t)}destroy(){this.isDestroyed=!0,Wt.off(_r.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Wt.off(_r.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=ic.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=kr.INIT,!this.videoElementCheckInterval&&(J2.forEach(s=>{this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=(function(s){return s!==document.body&&document.body.contains(s)})(this.videoElement)},1e3),U("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,i;let s,c=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",c),this.videoElementFreezeTimeout=window.setTimeout(l,U("VIDEO_FREEZE_DURATION")))},l=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===ic.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=ic.VideoStateFrozen:document.addEventListener("visibilitychange",c))},d=(h,p)=>{if(this.videoElementStatus===kr.PLAYING){if(s){let R=p.presentationTime-s.presentationTime,N=p.presentedFrames-s.presentedFrames;this._render_interframe_delays_sizes.push(N),this._render_interframe_delays.push(R);let w=JA(this._render_interframe_delays_sizes),O=w-this._render_interframe_delays_sizes[0];if(w>30&&O>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===ic.VideoStateStarting&&(this.videoState=ic.VideoStateDecoding),this.videoState===ic.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(l,U("VIDEO_FREEZE_DURATION"))),R<U("VIDEO_FREEZE_DURATION")&&this.videoState===ic.VideoStateFrozen&&(this.videoState=ic.VideoStateDecoding),R>U("VIDEO_FREEZE_DURATION")&&nc.lastVisibleTime>=nc.lastHiddenTime&&s.timestamp>nc.lastVisibleTime&&s.timestamp>nc.lastHiddenTime){let L=Math.min(66,X2(this._render_interframe_delays_sizes,this._render_interframe_delays)),M=Math.max(0,R-(N-1)*L);this.renderFreezeAccTime2+=M>L?M:0,this.renderFreezeAccTime+=R}}s=ri(ri({},p),{},{timestamp:h})}else this.isSkipCalcRenderFreezeTime()&&(s=ri(ri({},p),{},{timestamp:h}));var _,E;U("ENABLE_VIDEO_FRAME_CALLBACK")&&((_=(E=this.videoElement).requestVideoFrameCallback)===null||_===void 0||_.call(E,d))};(t=(i=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(i,d)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),tR()&&!U("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let r=Ct();r.name==="Safari"&&Number(r.version)===15||Xf()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Ri()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Ri()&&this.videoElement.load());let n=this.videoElement.play();n!==void 0&&n.catch(s=>{y.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}resetVideoElement(){J2.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=kr.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===kr.DESTROYED||this.internal}handleAutoPlayFailed(){let t=i=>{i.preventDefault(),this.videoElement.play().then(()=>{y.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{y.error(r)}),this.autoplayFailed=!1,Rg()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Rg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),e2()}}let J2=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Cw extends yw{constructor(t){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),Z(this,"container",void 0),Z(this,"slot",void 0),this.slot=t.element,this.internal=i,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;let i=t.element;var r;!this.internal||this.slot?(i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()):(this.slot=i,i&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(r=this.slot)===null||r===void 0||r.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var i;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,r):await Rw(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",U("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var Z2,Q2,$2,ek,tk,ik,rk,nk,ak,sk,ok,ck,lk,dk,uk,hk,pk,fk,mk,_k,Ek,gk,Sk,Tk,vk,Rk,yk,Ck,_t,bk,Ak,wk,Ik,Ok,Nk,Dk,Pk,Ra;let ai=(Z2=qe({argsMap:(e,t,i)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),Q2=bi(),$2=qe({argsMap:e=>[e.getTrackId()]}),ek=$f("LocalVideoTrack","_enabledMutex"),tk=qe({argsMap:(e,t)=>[e.getTrackId(),t]}),ik=bi(),rk=$f("LocalVideoTrack","_enabledMutex"),nk=qe({argsMap:(e,t)=>[e.getTrackId(),t]}),ak=bi(),sk=qe({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),ok=bi(),ck=qe({argsMap:(e,t)=>[e.getTrackId(),t]}),lk=bi(),dk=bi(),uk=qe({argsMap:(e,t,i)=>[e.getTrackId(),t,i]}),hk=bi(),pk=bi(),fk=bi(),mk=qe({argsMap:e=>[e.getTrackId()]}),_k=bi(),Ek=bi(),gk=bi(),Sk=bi(),Tk=bi(),vk=qe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Rk=qe({argsMap:e=>[e.getTrackId()]}),yk=qe({argsMap:e=>[e.getTrackId()]}),Ck=qe({argsMap:(e,t,i)=>[e.getTrackId(),t.label,i]}),_t=class C5 extends om{get videoHeight(){if(Rr()){let{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Rr()){let{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==kr.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,i,r,n,s,c){if(super(t,s),Z(this,"trackMediaType",sm.VIDEO),Z(this,"_player",void 0),Z(this,"isUseScaleResolutionDownBy",!1),Z(this,"_videoVisibleTimer",null),Z(this,"_previousVideoVisibleStatus",void 0),Z(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Z(this,"_encoderConfig",void 0),Z(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Z(this,"_optimizationMode",void 0),Z(this,"_saveEncodeBitrateRatio",1),Z(this,"_videoHeight",void 0),Z(this,"_videoWidth",void 0),Z(this,"_forceBitrateLimit",void 0),Z(this,"_enabled",!0),Z(this,"_processorDestination",void 0),Z(this,"_processorContext",void 0),Rr()){let{width:l,height:d}=t.getSettings();this._videoWidth=l,this._videoHeight=d}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=r,this._optimizationMode=n,this._hints=c||[],i&&this._hints.indexOf(qt.CUSTOM_TRACK)!==-1?this._encoderConfig=fi(i):this._encoderConfig=i,this._hints.indexOf(qt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(UA(Pt.CHROME,115)&&$0().indexOf("Windows")!==-1){let l=(function(d,h){if("VideoFrame"in window&&"TransformStream"in window&&Ot().supportWebRTCInsertableStream){let p=new MediaStreamTrackProcessor(d),_=new MediaStreamTrackGenerator({kind:"video"}),E,R,N=Date.now(),w=()=>{O&&(clearInterval(O),O=void 0),E&&(E.close(),E=void 0),d.stop(),R=void 0,_.removeEventListener("ended",w)},O=window.setInterval(()=>{if(R&&E&&Date.now()-N>1e3)try{_.readyState==="live"?R.enqueue(E.clone()):w()}catch{w()}},1e3),L=new TransformStream({transform:(M,B)=>{_.readyState==="live"?(R=B,N=Date.now(),E===void 0?(E=M,B.enqueue(M.clone())):(B.enqueue(E),E=M)):M.close()}});return _.addEventListener("ended",w),p.readable.pipeThrough(L).pipeTo(_.writable),_}})(t);l&&(y.info("local screen video track begin to inject frame"),this._mediaStreamTrack=l)}i&&this._hints.indexOf(qt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new r2(this.getTrackId(),"local"),this._processorDestination=new i2(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){let n=document.getElementById(t);n?t=n:(y.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}y.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));let r=ri(ri(ri({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new yw(r):this._player=new Cw(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let n=this.getVideoElementVisibleStatus();this.safeEmit(am.VIDEO_ELEMENT_VISIBLE_STATUS,n)}catch{}},U("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,y.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,i){if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(y.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await Jt(this,xe.NEED_DISABLE_TRACK,this)}catch(r){throw y.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return i||(this._enabled=!1),void y.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Jt(this,xe.NEED_ENABLE_TRACK,this)}catch(r){throw y.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}y.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,y.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Jt(this,xe.NEED_MUTE_TRACK,this):await Jt(this,xe.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),y.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await Jt(this,xe.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(y)}}}async setEncoderConfiguration(t,i){if(!this._enabled)throw new ne(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=vs(t),U("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){let r=mR({encoderConfig:t});(Rr()||zr()||gs())&&(r.deviceId=void 0),y.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(n){let s=new ne(k.UNEXPECTED_ERROR,n.toString());throw y.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=t,this._hints.indexOf(qt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Jt(this,xe.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(y)}}getStats(){return Nd(()=>{y.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),fa(this,xe.GET_STATS)||ri({},mw)}async setBeautyEffect(t){y.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,i):await Rw(t)}async findClosestProfile(){let{width:t,height:i,frameRate:r}=this.getMediaStreamTrackSettings(),{width:n,height:s,frameRate:c}=this._encoderConfig||{},l=Qf(this._videoWidth||t||n||0),d=Qf(this._videoHeight||i||s||0),h=(function(p,_,E){if(!Array.isArray(U("VIDEO_ENCODER_CONFIG_LIST"))||U("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;let R=Math.min(p,_);return!(R>=480)&&ri(ri({},U("VIDEO_ENCODER_CONFIG_LIST").find(N=>N.height>R)),{},{frameRate:E})})(l,d,Qf(r||c||15));if(h)return y.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(l,"x").concat(d," => ").concat(JSON.stringify(h))),this.setEncoderConfiguration(h)}async setBitrateLimit(t){y.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void y.error(k.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let i=this._optimizationMode;try{this._optimizationMode=t,await Jt(this,xe.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=i,y.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}y.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return y.error(k.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,y.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){s2(this._originMediaStreamTrack).then(t=>{let[i,r]=t;this._videoHeight=r,this._videoWidth=i}).catch(nR)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new ne(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");y.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=vs(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(qt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Jt(this,xe.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(y)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:t,height:i,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!i||!r)return;let{bitrateMax:n,bitrateMin:s}=this._encoderConfig;if(s==null||n==null){let{max:c,min:l}=(function(d,h,p,_,E){let R=U("BITRATE_ADAPTER_TYPE");if(R==="DEFAULT_BITRATE")return{min:_,max:E};if(E===void 0){let N=Math.floor(200*Math.pow(p/15,.6)*Math.pow(d*h/640/360,.75));E=R==="STANDARD_BITRATE"?4*N:2*N,_=_??N}else _=_??Math.floor(E/10);return{min:_,max:E}})(t,i,r,s,n);if(this._encoderConfig.bitrateMin=l,this._encoderConfig.bitrateMax=c,U("VIDEO_STANDARD_BITRATE_VERSION")&&s==null&&n==null){let[d,h]=(function(p,_,E){let R=4*Math.floor(2e5*Math.pow(E/15,.6)*Math.pow(p*_/230400,.75)),N=p*_,w=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),O=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]),L=Sn(w).call(w).next().value,M=1;if(w.has(N))L=w.get(N);else{var B;let Se=ct(B=Array.from(w.entries())).call(B,(pt,tt)=>{let[xt]=pt,[Lt]=tt;return xt-Lt}),ht=Se.find(pt=>{let[tt]=pt;return tt>N});if(ht){let pt=Se.indexOf(ht);if(pt>0){let tt=Se[pt-1],xt=(N-tt[0])/(ht[0]-tt[0]);L=tt[1]+xt*(ht[1]-tt[1])}else L=ht[1]}else L=Se[Se.length-1][1]}if(O.has(N))M=O.get(N);else{var Y;let Se=ct(Y=Array.from(O.entries())).call(Y,(pt,tt)=>{let[xt]=pt,[Lt]=tt;return xt-Lt}),ht=Se.find(pt=>{let[tt]=pt;return tt>N});if(ht){let pt=Se.indexOf(ht);if(pt>0){let tt=Se[pt-1],xt=(N-tt[0])/(ht[0]-tt[0]);M=tt[1]+xt*(ht[1]-tt[1])}else M=ht[1]}else M=Se[Se.length-1][1]}let H=U("VIDEO_NEW_BITRATE_RATIO");H&&H>0&&(L=H/100);let G=Math.floor(R*L),Q=Math.floor(65e4*Math.pow(p*_/230400,.5)*Math.pow(E/15,.69)),ce=G,he=U("VIDEO_STANDARD_BITRATE_VERSION");return he&&he>0&&(he===1?ce=R:he===2?ce=G:he===3&&(ce=Q)),[Math.floor(ce/1e3),M]})(t,i,r);this._encoderConfig.bitrateMax=d,this._encoderConfig.bitrateMin=l?Math.min(l,d):d,this._saveEncodeBitrateRatio=h,y.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(i,", fps: ").concat(r,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else y.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(i,", fps: ").concat(r,"] => [brMax: ").concat(c,", brMin: ").concat(l,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,i;let r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),n={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:r?.parentElement},{element:s,slot:c}=n;if(this.isPlaying&&s instanceof HTMLVideoElement&&c instanceof HTMLElement){let l=oL.checkOneElementVisible(s),d=Object.assign({},l);if(d.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=d.visible;let h=Fe.reportApiInvoke(null,{tag:pi.TRACER,name:Oi.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});d.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(d.reason))}return d}return}catch(r){throw new ne(k.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new ne(k.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;let t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=ri(ri({},r),vs(t))),r=Th(r);let n=Zt(8,"track-video-cloned-"),s=new C5(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,Th(this._scalabilityMode),this._optimizationMode,n,Th(this._hints));return t&&r&&s.setEncoderConfiguration(r),y.debug("clone video track from ".concat(this.getTrackId()," to ").concat(n,", clone ").concat(i)),s}async replaceTrack(t,i){if(!(t instanceof MediaStreamTrack))throw new ne(k.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new ne(k.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Nd(()=>{Fe.reportApiInvoke(null,{name:Oi.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:pi.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!U("ENABLE_VIDEO_SEI")||!U("ENABLE_ENCODED_TRANSFORM"))return void y.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new ne(k.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let i=this.getRTCRtpTransceiver();if(!i)return void y.warning("Video track is not published, SEI can not be send");let r=i.sender.getParameters();if(r.codecs.length===0)return;let n=r.codecs[0].mimeType.toLocaleLowerCase();n==="video/h264"||n==="video/h265"?this.safeEmit("sei-to-send",t):y.warning("SEI is not supported by ".concat(n))}bindProcessorDestinationEvents(){this.processorDestination.on(cn.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await Jt(this,xe.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Jt(this,xe.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(cn.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Ea.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Ea.REQUEST_CONSTRAINTS)}},yt(_t.prototype,"play",[Z2,Q2],Object.getOwnPropertyDescriptor(_t.prototype,"play"),_t.prototype),yt(_t.prototype,"stop",[$2],Object.getOwnPropertyDescriptor(_t.prototype,"stop"),_t.prototype),yt(_t.prototype,"setEnabled",[ek,tk,ik],Object.getOwnPropertyDescriptor(_t.prototype,"setEnabled"),_t.prototype),yt(_t.prototype,"setMuted",[rk,nk,ak],Object.getOwnPropertyDescriptor(_t.prototype,"setMuted"),_t.prototype),yt(_t.prototype,"setSaveEncodeBitrateRatio",[sk,ok],Object.getOwnPropertyDescriptor(_t.prototype,"setSaveEncodeBitrateRatio"),_t.prototype),yt(_t.prototype,"setEncoderConfiguration",[ck,lk],Object.getOwnPropertyDescriptor(_t.prototype,"setEncoderConfiguration"),_t.prototype),yt(_t.prototype,"getStats",[dk],Object.getOwnPropertyDescriptor(_t.prototype,"getStats"),_t.prototype),yt(_t.prototype,"setBeautyEffect",[uk,hk],Object.getOwnPropertyDescriptor(_t.prototype,"setBeautyEffect"),_t.prototype),yt(_t.prototype,"getCurrentFrameData",[pk],Object.getOwnPropertyDescriptor(_t.prototype,"getCurrentFrameData"),_t.prototype),yt(_t.prototype,"getCurrentFrameImage",[fk],Object.getOwnPropertyDescriptor(_t.prototype,"getCurrentFrameImage"),_t.prototype),yt(_t.prototype,"findClosestProfile",[mk,_k],Object.getOwnPropertyDescriptor(_t.prototype,"findClosestProfile"),_t.prototype),yt(_t.prototype,"setBitrateLimit",[Ek],Object.getOwnPropertyDescriptor(_t.prototype,"setBitrateLimit"),_t.prototype),yt(_t.prototype,"setOptimizationMode",[gk],Object.getOwnPropertyDescriptor(_t.prototype,"setOptimizationMode"),_t.prototype),yt(_t.prototype,"setScalabiltyMode",[Sk],Object.getOwnPropertyDescriptor(_t.prototype,"setScalabiltyMode"),_t.prototype),yt(_t.prototype,"updateMediaStreamTrackResolution",[Tk],Object.getOwnPropertyDescriptor(_t.prototype,"updateMediaStreamTrackResolution"),_t.prototype),yt(_t.prototype,"pipe",[vk],Object.getOwnPropertyDescriptor(_t.prototype,"pipe"),_t.prototype),yt(_t.prototype,"unpipe",[Rk],Object.getOwnPropertyDescriptor(_t.prototype,"unpipe"),_t.prototype),yt(_t.prototype,"close",[yk],Object.getOwnPropertyDescriptor(_t.prototype,"close"),_t.prototype),yt(_t.prototype,"replaceTrack",[Ck],Object.getOwnPropertyDescriptor(_t.prototype,"replaceTrack"),_t.prototype),_t),_R=(bk=qe({argsMap:(e,t)=>[e.getTrackId(),t]}),Ak=bi(),wk=$f("CameraVideoTrack","_enabledMutex"),Ik=qe({argsMap:(e,t)=>[e.getTrackId(),t]}),Ok=bi(),Nk=qe({argsMap:(e,t)=>[e.getTrackId(),t]}),Dk=bi(),Pk=qe({argsMap:e=>[e.getTrackId()]}),Ra=class b5 extends ai{get __className__(){return"CameraVideoTrack"}constructor(t,i,r,n,s,c){super(t,vs(i.encoderConfig),n,s,c),Z(this,"_config",void 0),Z(this,"_originalConstraints",void 0),Z(this,"_constraints",void 0),Z(this,"_enabled",!0),Z(this,"_deviceName","default"),Z(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Xf()||GA())&&!(function(){let l=Ct();if(l.os!==rr.IOS||!l.osVersion)return!1;let d=l.osVersion.split(".");return Number(d[0])===15&&Number(d[1])>=2})()&&rL()&&this._enabled&&!this._isClosed&&(y.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=r,this._constraints=r,this._deviceName=t.label,this._encoderConfig=vs(this._config.encoderConfig),Wt.on(_r.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Wt.on(_r.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(y.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{let i=await Ta.getDeviceById(t),r={};r.video=ri({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let n=null;try{n=await Sa(r,this.getTrackId())}catch(s){throw y.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),n=await Sa({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(i){throw y.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{let i=await Ta.getDeviceById(t);this._deviceName=i.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(i){throw y.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}y.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){y.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));let i={video:ri(ri({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=await Sa(i,this.getTrackId())}catch(n){throw y.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),n.toString()),r=await Sa({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),n}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=ri({},i.video),y.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,i){if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(y.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let r=await Sa({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}await Jt(this,xe.NEED_ENABLE_TRACK,this)}catch(r){throw y.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),y.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await Jt(this,xe.NEED_DISABLE_TRACK,this)}catch(r){throw y.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}y.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,i){if(!this._enabled)throw new ne(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=vs(t),U("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);let r=fi(this._config);r.encoderConfig=t;let n=mR(r);(Rr()||zr()||gs())&&(n.deviceId=void 0),y.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(n));try{await this._originMediaStreamTrack.applyConstraints(n),this.updateMediaStreamTrackResolution()}catch(s){let c=new ne(k.UNEXPECTED_ERROR,s.toString());throw y.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}this._config=r,this._constraints=n,this._originalConstraints=n,this._encoderConfig=t,this._hints.indexOf(qt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Jt(this,xe.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(y)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((zr()||gs())&&this._enabled&&!this._isClosed&&Wt.duringInterruption){let t=async()=>{Wt.off(_r.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(y.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Wt.on(_r.IOS_INTERRUPTION_END,t)}else y.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(am.TRACK_ENDED)}async renewMediaStreamTrack(t){let i=t||this._constraints,r=Ta.searchDeviceIdByName(this._deviceName);if(r&&!i.deviceId&&(i.deviceId={exact:r}),this._enabled){let n=await Sa({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Wt.off(_r.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Wt.off(_r.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=ri(ri({},r),vs(t))),r=Th(r);let n=Zt(8,"track-cam-cloned-"),s=new b5(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,Th(ri(ri({},this._config),{},{encoderConfig:r})),Th(this._constraints),Th(this._scalabilityMode),this._optimizationMode,n);return t&&r&&s.setEncoderConfiguration(r),y.debug("clone track from ".concat(this.getTrackId()," to ").concat(n,", clone ").concat(i)),s}bindProcessorContextEvents(){this.processorContext.on(Ea.REQUEST_UPDATE_CONSTRAINTS,async(t,i,r)=>{try{let n=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(n),i()}catch(n){r(n)}}),this.processorContext.on(Ea.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},yt(Ra.prototype,"setDevice",[bk,Ak],Object.getOwnPropertyDescriptor(Ra.prototype,"setDevice"),Ra.prototype),yt(Ra.prototype,"setEnabled",[wk,Ik,Ok],Object.getOwnPropertyDescriptor(Ra.prototype,"setEnabled"),Ra.prototype),yt(Ra.prototype,"setEncoderConfiguration",[Nk,Dk],Object.getOwnPropertyDescriptor(Ra.prototype,"setEncoderConfiguration"),Ra.prototype),yt(Ra.prototype,"close",[Pk],Object.getOwnPropertyDescriptor(Ra.prototype,"close"),Ra.prototype),Ra);function bw(e,t,i,r){i.optimizationMode&&(r&&r.width&&r.height?(i.encoderConfig=ri(ri({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(t.contentHint=i.optimizationMode,t.contentHint===i.optimizationMode?y.debug("[".concat(e,"] set content hint to"),i.optimizationMode):y.debug("[".concat(e,"] set content hint failed")))):y.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var Lk,kk,Mk,xk,Wa,Uk,Vk,Bk,jk,Fk,Gk,$r;class Hk extends zL{getUserId(){return this._userId}constructor(t,i,r,n){super(t,"track-".concat(t.kind,"-").concat(i,"-").concat(n.clientId,"_").concat(Zt(5,""))),Z(this,"_userId",void 0),Z(this,"_uintId",void 0),Z(this,"_isDestroyed",!1),Z(this,"store",void 0),Z(this,"processor",void 0),Z(this,"processorContext",void 0),this._userId=i,this._uintId=r,this.store=n}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,y.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let dm=(Lk=qe({argsMap:(e,t,i)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),kk=qe({argsMap:e=>[e.getTrackId()]}),Mk=qe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),xk=qe({argsMap:e=>[e.getTrackId()]}),yt((Wa=class extends Hk{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==kr.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,i,r,n){super(e,t,i,r),Z(this,"_videoVisibleTimer",null),Z(this,"_previousVideoVisibleStatus",void 0),Z(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Z(this,"trackMediaType",sm.VIDEO),Z(this,"_videoWidth",void 0),Z(this,"_videoHeight",void 0),Z(this,"_player",void 0),Z(this,"_prePlayer",void 0),Z(this,"processorDestination",void 0),Z(this,"processorContext",void 0),this._prePlayer=n,this.updateMediaStreamTrackResolution(),this.processorContext=new r2(this.getTrackId(),"remote"),this.processorDestination=new i2(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Nd(()=>{y.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),fa(this,xe.GET_STATS)||ri({},HL)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Ha.PLAY_START),typeof e=="string"){let r=document.getElementById(e);r?e=r:(y.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}y.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let i=ri(ri({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(i);else{let r=!1,n=!1;e instanceof HTMLVideoElement?(this._player=new yw(i),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,n=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,r=this._player.videoState>0,this._player.updateConfig(i)):this._player=new Cw(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Ha.FIRST_FRAME_DECODED),n&&this.safeEmit(Ha.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=s=>{this.safeEmit(Ha.VIDEO_STATE_CHANGED,s)},r&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let r=this.getVideoElementVisibleStatus();this.safeEmit(Ha.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},U("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Ha.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,y.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){s2(this._originMediaStreamTrack).then(e=>{let[t,i]=e;this._videoHeight=i,this._videoWidth=t}).catch(nR)}_updatePlayerSource(){y.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;let i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:i?.parentElement},{element:n,slot:s}=r;if(this.isPlaying&&n instanceof HTMLVideoElement&&s instanceof HTMLElement){let c=oL.checkOneElementVisible(n),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;let d=Fe.reportApiInvoke(null,{tag:pi.TRACER,name:Oi.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?d.onSuccess("Video is visible"):d.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(i){throw new ne(k.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new ne(k.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(cn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(cn.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Ch.SEI_RECEIVED,e)}}).prototype,"play",[Lk],Object.getOwnPropertyDescriptor(Wa.prototype,"play"),Wa.prototype),yt(Wa.prototype,"stop",[kk],Object.getOwnPropertyDescriptor(Wa.prototype,"stop"),Wa.prototype),yt(Wa.prototype,"pipe",[Mk],Object.getOwnPropertyDescriptor(Wa.prototype,"pipe"),Wa.prototype),yt(Wa.prototype,"unpipe",[xk],Object.getOwnPropertyDescriptor(Wa.prototype,"unpipe"),Wa.prototype),Wa),um=(Uk=qe({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),Vk=qe({argsMap:(e,t)=>[e.getTrackId(),t]}),Bk=qe({argsMap:e=>[e.getTrackId()]}),jk=qe({argsMap:e=>[e.getTrackId()]}),Fk=qe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Gk=qe({argsMap:e=>[e.getTrackId()]}),yt(($r=class extends Hk{get isPlaying(){return this._useAudioElement?vn.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,i,r){super(e,t,i,r),Z(this,"trackMediaType",sm.AUDIO),Z(this,"_source",void 0),Z(this,"_useAudioElement",!0),Z(this,"_volume",100),Z(this,"processorContext",void 0),Z(this,"processorDestination",void 0),Z(this,"_played",!1),Z(this,"_bypassWebAudio",!1),U("DISABLE_WEBAUDIO")?(this._source=new vw,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new XL(e,!0),U("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(_a.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Ha.FIRST_FRAME_DECODED)}),this.processorContext=new a2(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new n2(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(_a.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(_a.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(_a.ON_AUDIO_BUFFER),this._source.on(_a.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?vn.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!BL())throw new ne(k.NOT_SUPPORTED,"your browser does not support setting the audio output device");await vn.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Nd(()=>{y.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),fa(this,xe.GET_STATS)||ri({},GL)}play(){y.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(y.debug("[".concat(this.getTrackId(),"] use audio element to play")),vn.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){y.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?vn.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];y.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&vn.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new ne(k.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new ne(k.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new ne(k.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(cn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(cn.ON_NODE,e=>{this._source.processedNode=e;let t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(cn.ON_TRACK),this.processorDestination.removeAllListeners(cn.ON_NODE)}}).prototype,"setVolume",[Uk],Object.getOwnPropertyDescriptor($r.prototype,"setVolume"),$r.prototype),yt($r.prototype,"setPlaybackDevice",[Vk],Object.getOwnPropertyDescriptor($r.prototype,"setPlaybackDevice"),$r.prototype),yt($r.prototype,"play",[Bk],Object.getOwnPropertyDescriptor($r.prototype,"play"),$r.prototype),yt($r.prototype,"stop",[jk],Object.getOwnPropertyDescriptor($r.prototype,"stop"),$r.prototype),yt($r.prototype,"pipe",[Fk],Object.getOwnPropertyDescriptor($r.prototype,"pipe"),$r.prototype),yt($r.prototype,"unpipe",[Gk],Object.getOwnPropertyDescriptor($r.prototype,"unpipe"),$r.prototype),$r),nc=new class extends Ei{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Z(this,"_lastHiddenTime",0),Z(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),y.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class Wk extends Ei{constructor(t,i){super(),Z(this,"trackMediaType",sm.DATA),Z(this,"_version",1),Z(this,"_type",3),Z(this,"_config",void 0),Z(this,"_originDataChannel",void 0),Z(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Z(this,"_dataStreamPacketHandler",{serialize:r=>r,deserialize:r=>r}),Z(this,"_datachannelEventMap",new Map),this._config=t,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return U("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,i;return(t=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,i;return(t=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new we((t,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();let r=setTimeout(()=>{var n;i(new ne(k.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((n=this._originDataChannel)===null||n===void 0?void 0:n.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new ne(k.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new ne(k.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){let t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[pR.OPEN,pR.CLOSE,pR.ERROR].forEach(i=>{let r=()=>{this.emit(i)};this._datachannelEventMap.set(i,r),t.addEventListener(i,r)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[r,n]=i;t.removeEventListener(r,n)}),this._datachannelEventMap.clear()}}class Z8 extends Wk{constructor(t){super(t),Z(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let r=i.data.slice(0,this._dataStreamPacketHeader.byteLength),n=new DataView(r).getUint8(3);if(n!==this.id)return void(U("SHOW_DATASTREAM2_LOG")&&y.debug("invalid datachannel id: ".concat(n," !== ").concat(this.id)));let s=i.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(pR.MESSAGE,s)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Q8 extends Wk{send(t){if(this._originDataChannel){let i=t;i=this._dataStreamPacketHandler.serialize(t);let r=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function ER(){let e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>_0.revokeObjectURL(e),0),new Worker(_0.createObjectURL(e))}let zk=71,Aw=1,ww=2,Iw=1,Kk=2;var Ld=(function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e})(Ld||{});function Ow(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=e.getUint8(0);if(i!==zk)return;let r=e.getUint16(1),n=Aw+ww+r,s=new Uint8Array(e.byteLength-n);s.set(new Uint8Array(e.buffer,n,e.byteLength-n));let c={m:i,tlvLen:r,tlv:[],frame:s},l=Aw+ww;for(;l<n;){let d=e.getUint8(l),h=e.getUint16(l+Iw),p=Iw+Kk;if(d===Ld.AUDIO_LEVEL){let _=e.getUint8(l+p);for(let E=1;E<h;E++)_=_<<8|e.getUint8(l+p+E);c.tlv.push({tag:d,length:h,value:t?127^_>>1:127&_})}else if(d===Ld.METADATA||d===Ld.AUDIO_64_BIT_PTS){let _=new Uint8Array(h);for(let E=0;E<h;E++)_[E]=e.getUint8(l+p+E);c.tlv.push({tag:d,length:h,value:_})}l+=p+h}return c}let gR=new Map,SR=127,wh=1e-10,Nw=139/13,TR=new Map;function Dw(e,t,i){let r="".concat(e,"-").concat(t,"-").concat(i),n=0;return TR.has(r)?n=TR.get(r):(n=Math.log((function(s,c){let l=s-c;c<l&&(c=l);let d=1;for(let h=s,p=1;h>c;h--,p++)d=d*h/p;return d})(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(i)+i*e,TR.set(r,n)),n<wh&&(n=wh),n}function Yk(e,t,i){let r=t.length,n=e.length/r,s=!1;for(let c=0,l=0;c<r;c++){let d=0;for(let h=l+n;l<h;l++)e[l]>i&&d++;t[c]!==d&&(t[c]=d,s=!0)}return s}window.cache=TR;let $8=0;class qk{constructor(t){Z(this,"id",void 0),Z(this,"immediates",[]),Z(this,"lastNonSilence",-1),Z(this,"immediateSpeechActivityScore",wh),Z(this,"lastLevelChangedTime",Date.now()),Z(this,"levels",[]),Z(this,"longs",[]),Z(this,"longSpeechActivityScore",wh),Z(this,"mediums",[]),Z(this,"mediumSpeechActivityScore",wh),Z(this,"minLevel",0),Z(this,"nextMinLevel",0),Z(this,"nextMinLevelWindowLength",0),Z(this,"energyScore",0),this.id=t||"".concat($8++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){let t=this.immediates,i=this.levels,r=this.minLevel+Nw,n=!1;for(let s=0;s<t.length;++s){let c=i[s];c<r&&(c=0);let l=Math.floor(c/Nw);t[s]!==l&&(t[s]=l,n=!0)}return n}computeLongs(){return Yk(this.mediums,this.longs,4)}computeMediums(){return Yk(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=Dw(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=Dw(this.longs[0],10,47),this.longSpeechActivityScore>wh&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=Dw(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(yp(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,i){if(this.lastLevelChangedTime<=i){this.lastLevelChangedTime=i;let r=t;return t<0&&(r=0),t>SR&&(r=SR),this.levels.unshift(r),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(r),r>=this.minLevel+Nw?r:r/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let i=Math.sqrt(this.minLevel*this.nextMinLevel);i<0?i=0:i>SR&&(i=SR),this.minLevel=i,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class e9{constructor(t){Z(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{let i=this.algorithm.runInDecisionMaker(this);i<=0?t=!0:setTimeout(this.execute.bind(this),i)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class Pw{constructor(t,i,r){Z(this,"isDominant",void 0),Z(this,"energyRanking",void 0),Z(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=i,this.energyScore=r}}class t9 extends Ei{constructor(t){super(),Z(this,"dominantId",null),Z(this,"lastDecisionTime",0),Z(this,"lastLevelChangedTime",0),Z(this,"lastLevelIdleTime",0),Z(this,"relativeSpeechActivities",[]),Z(this,"speakers",new Map),Z(this,"enableSilence",!1),Z(this,"timeoutToSilenceInterval",0),Z(this,"decisionMaker",null),Z(this,"loudest",[]),Z(this,"numLoudestToTrack",3),Z(this,"energyExpireTimeMs",250),Z(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,i=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,i!=null&&(this.energyExpireTimeMs=i),r!=null&&(this.energyAlphaPct=r),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(i=>i.id===t)}levelChanged(t,i){let r=Date.now(),n=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<r&&(this.lastLevelChangedTime=r,this.maybeStartDecisionMaker());let s=n.levelChanged(i,r);return this.updateLoudestList(n,s,r)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(i=>{this.speakers.has(i.id)||this.speakers.set(i.id,i)})}removeSpeakers(t){t.forEach(i=>{this.speakers.delete(i.id)})}getOrCreateSpeaker(t){let i=this.speakers.get(t);return i||(i=new qk(t),this.speakers.set(t,i),this.maybeStartDecisionMaker()),i}updateLoudestList(t,i,r){let n=t.id===this.dominantId;if(i<0){let d=0;for(;d<this.loudest.length&&this.loudest[d]!==t;)++d;return new Pw(n,d,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*i+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new Pw(n,0,t.energyScore);let s=r-this.energyExpireTimeMs,c=0;for(;c<this.loudest.length;){let d=this.loudest[c];if(d.getLastLevelChangedTime()<s&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(c,1);else if(d.id!==t.id)++c;else if(this.loudest.splice(c,1),this.loudest.length<this.numLoudestToTrack)break}let l=0;for(;l<this.loudest.length&&!(this.loudest[l].energyScore<t.energyScore);)++l;return l<this.numLoudestToTrack&&(this.loudest.splice(l,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new Pw(n,l,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new e9(this),this.decisionMaker.execute())}makeDecision(t){let i=null,r=null,n=this.speakers.size,s=null;if(n===0)s=null;else if(n===1){var c;let l=Sn(c=this.speakers).call(c).next().value;this.enableSilence&&l&&(s=l.id,l.evaluateSpeechActivityScores(t),t-l.lastNonSilence>this.timeoutToSilenceInterval&&(s=null))}else{let l=this.dominantId==null?null:this.speakers.get(this.dominantId);if(l==null){let p=this.speakers.entries().next();p.value&&(s=p.value[0],l=p.value[1])}else s=l.id;l?.evaluateSpeechActivityScores(t);let d=this.relativeSpeechActivities,h=2;for(let p of this.speakers.entries()){let[_,E]=p;if(E===l)continue;E.evaluateSpeechActivityScores(t);for(let O=0;O<d.length;++O){let L=l==null?wh:l.getSpeechActivityScore(O);d[O]=Math.log(E.getSpeechActivityScore(O)/L)}let R=d[0],N=d[1],w=d[2];R>3&&N>2&&w>0&&N>h&&(h=N,s=_)}this.enableSilence&&l!=null&&s===l.id&&t-l.lastNonSilence>this.timeoutToSilenceInterval&&(s=null)}s==null&&!this.enableSilence||s===this.dominantId||(i=this.dominantId,this.dominantId=s,r=this.dominantId),r==null&&!this.enableSilence||r===i||this.emit("ActiveSpeakerChanged",r)}_runInDecisionMaker(){let t=Date.now(),i=300-(t-this.lastLevelIdleTime),r=0;i<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):r=i;let n=300-(t-this.lastDecisionTime);return n<=0&&(this.lastDecisionTime=t,this.makeDecision(t),n=300-(Date.now()-t)),n>0&&r>n&&(r=n),r}timeoutIdleLevels(t){let i=[];for(let n of Sn(r=this.speakers).call(r)){var r;let s=t-n.getLastLevelChangedTime();36e5<s&&(this.dominantId==null||n.id!==this.dominantId)?i.push(n.id):300<s&&n.levelTimedOut()}i.forEach(n=>this.speakers.delete(n))}}let hm=new Map,so=null,vR=null,Xk=3,Ih=[],oo=new Map,RR=new Map;class i9{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,i){Z(this,"id",void 0),Z(this,"track",void 0),Z(this,"score",0),Z(this,"active",!0),Z(this,"muted",!1),Z(this,"timer",0),Z(this,"actives",0),Z(this,"inactives",0),this.id=t,this.track=i,this.setActive(oo.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){let t=this.active;this.active=this.activeRate>=.8;let{actives:i,inactives:r}=(function(){let n=[],s=[];return Array.from(Sn(oo).call(oo)).forEach(c=>{c.active?n.push(c):s.push(c)}),{actives:n,inactives:s}})();if(i.length>3){let n;i.forEach(s=>{(!n||n.score>s.score)&&(n=s)}),n&&n.setActive(!1)}if(i.length<3&&r.length>0){let n;r.forEach(s=>{(!n||n.score<s.score)&&s.id!==this.id&&(n=s)}),n&&t&&!this.active&&(n.samples>40&&n.activeRate-this.activeRate>.4?n.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){let t=(function(i){let r;return Array.from(Sn(oo).call(oo)).forEach(n=>{!n.active||n.id===i||n.samples<40||(!r||n.score<r.score)&&(r=n)}),r})(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){let t=(function(i){let r;return Array.from(Sn(oo).call(oo)).forEach(n=>{n.active||n.id===i||n.samples<40||(!r||n.score>r.score)&&(r=n)}),r})(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let yR;function Jk(e){let t=oo.get(e);t&&(oo.delete(e),t.clearTimer())}let CR=new Map,r9=new Map,Lw="video/h264",kw="video/h265";function Zk(e,t,i){let r=new Uint8Array(e,t,i),n=[],s=0;for(;n.length<i;)s+3<i&&r[s]===0&&r[s+1]===0&&r[s+2]===3&&(r[s+3]===0||r[s+3]===1||r[s+3]===2||r[s+3]===3)?(n.push(r[s],r[s+1],r[s+3]),s+=4):(n.push(r[s]),s++);return new Uint8Array(n)}function Qk(e){let t=e.length,i=[],r=0;for(;r<t;)r+2<t&&e[r]===0&&e[r+1]===0&&(e[r+2]===0||e[r+2]===1||e[r+2]===2||e[r+2]===3)?(i.push(e[r],e[r+1],3,e[r+2]),r+=3):(i.push(e[r]),r++);return new Uint8Array(i)}function $k(e){if(e.length<5)return"";let t=-1;for(let n=0;n<e.length-3;n++){if(e[n]===0&&e[n+1]===0&&e[n+2]===1){t=n;break}if(n<e.length-4&&e[n]===0&&e[n+1]===0&&e[n+2]===0&&e[n+3]===1){t=n;break}}if(t===-1)return"";let i=t+(e[t+2]===0?4:3);if(i>=e.length)return"";let r=e[i];return 128&r?"":(r>>1&63)>=32||i+1<e.length&&!(248&e[i+1])?kw:(31&r)<=31?Lw:""}let bR=new Map,kg=new Map;(function(){let e=Ct();mr.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),mr.getStreamFromExtension=e.name===Pt.CHROME&&Number(e.version)>34,mr.supportUnifiedPlan=(function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t=new RTCPeerConnection,i=!1;try{t.addTransceiver("audio"),i=!0}catch{}return t.close(),i})(),mr.supportMinBitrate=e.name===Pt.CHROME||e.name===Pt.EDGE,mr.supportSetRtpSenderParameters=(function(){let t=Ct();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!sl()||!(!Rr()&&!eR())||t.name===Pt.FIREFOX&&Number(t.version)>=64)})(),e.name===Pt.SAFARI&&(Number(e.version)>=14?mr.supportDualStream=!0:mr.supportDualStream=!1),mr.webAudioMediaStreamDest=(function(){let t=Ct();return!(t.name===Pt.SAFARI&&Number(t.version)<12)})(),mr.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",mr.supportWebGL=typeof WebGLRenderingContext<"u",mr.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,sl()||(mr.webAudioWithAEC=!0),mr.supportShareAudio=(function(){let t=Ct();return(t.os===rr.WIN_10||t.os===rr.WIN_81||t.os===rr.WIN_7||t.os===rr.LINUX||t.os===rr.MAC_OS||t.os===rr.CHROMIUM_OS)&&t.name===Pt.CHROME&&Number(t.version)>=74})(),mr.supportDataChannel=!!(qf(76)||BA(68)||QP(14)),mr.supportPCSetConfiguration=(function(){let t=window.RTCPeerConnection;return!Ri()&&!!t&&t.prototype.setConfiguration instanceof Function})(),mr.supportWebRTCEncodedTransform=qf(87)||XP()||BA(117),mr.supportWebRTCInsertableStream=(function(){let t=Ct();return(t.name===Pt.CHROME||t.name===Pt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window})(),mr.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,mr.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,rR(()=>{mr.supportDualStreamEncoding=(function(){let t=Ct();return!!U("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&U("CHROME_DUAL_STREAM_USE_ENCODING"))})(),y.debug("browser ua: ",navigator.userAgent),y.info("browser info: ",e),y.info("browser compatibility: ",mr)})})();let n9=["CHINA","GLOBAL"],eM=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Oh=[],pm=[];function Nh(e,t){return!!t&&Oh.some(i=>i.uid===e&&i.channelName===t)}function Mw(){return pm.length>0}var a9=f1.forEach,tM=wc("forEach")?[].forEach:function(e){return a9(this,e,arguments.length>1?arguments[1]:void 0)};Vt({target:"Array",proto:!0,forced:[].forEach!==tM},{forEach:tM});var s9=Hn("Array","forEach"),o9=Vs,c9=tr,l9=se,d9=s9,xw=Array.prototype,u9={DOMTokenList:!0,NodeList:!0},h9=function(e){var t=e.forEach;return e===xw||l9(xw,e)&&t===xw.forEach||c9(u9,o9(e))?d9:t},p9=b(h9),f9=wa,iM=Kl;Vt({target:"Object",stat:!0,forced:I(function(){iM(1)})},{keys:function(e){return iM(f9(e))}});var m9=b(bn.Object.keys),_9=b(Io),E9=b(C_),g9=Vt,rM=ts,S9=Fu,T9=Yr,nM=_p,v9=yo,R9=go,y9=Tb,C9=Li,b9=En,A9=a1("slice"),w9=C9("species"),Uw=Array,I9=Math.max;g9({target:"Array",proto:!0,forced:!A9},{slice:function(e,t){var i,r,n,s=R9(this),c=v9(s),l=nM(e,c),d=nM(t===void 0?c:t,c);if(rM(s)&&(i=s.constructor,(S9(i)&&(i===Uw||rM(i.prototype))||T9(i)&&(i=i[w9])===null)&&(i=void 0),i===Uw||i===void 0))return b9(s,l,d);for(r=new(i===void 0?Uw:i)(I9(d-l,0)),n=0;l<d;l++,n++)l in s&&y9(r,n,s[l]);return r.length=n,r}});var O9=Hn("Array","slice"),N9=se,D9=O9,Vw=Array.prototype,P9=function(e){var t=e.slice;return e===Vw||N9(Vw,e)&&t===Vw.slice?D9:t},L9=b(P9);function Be(e,t,i,r,n){var s,c,l,d={};return p9(s=m9(r)).call(s,function(h){d[h]=r[h]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=_9(c=E9(l=L9(i).call(i)).call(l)).call(c,function(h,p){return p(e,t,h)||h},d),n&&d.initializer!==void 0&&(d.value=d.initializer?d.initializer.call(n):void 0,d.initializer=void 0),d.initializer===void 0?(t1(e,t,d),null):d}let AR=(function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e})({}),Bw=(function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e})({}),Rs=(function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e})({}),ln=(function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e})({}),Ke=(function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e})({}),ni=(function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e})({}),nt=(function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e})({}),Je=(function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e})({}),Mg=(function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e})({}),vt=(function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e})({}),dn=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({}),dt=(function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e})({});function wR(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw y.error("Invalid Channel Name ".concat(e)),new $(k.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function IR(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||sL(e,1,255)))throw new $(k.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&y.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let cl=(function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e})({}),k9={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},jw={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Fw(e,t){pr(e.url,"".concat(t,".url"),1,1e3,!1),yi(e.x)||Yt(e.x,"".concat(t,".x"),0,1e4),yi(e.y)||Yt(e.y,"".concat(t,".y"),0,1e4),yi(e.width)||Yt(e.width,"".concat(t,".width"),0,1e4),yi(e.height)||Yt(e.height,"".concat(t,".height"),0,1e4),yi(e.zOrder)||Yt(e.zOrder,"".concat(t,".zOrder"),0,255),yi(e.alpha)||Yt(e.alpha,"".concat(t,".alpha"),0,1,!1)}let M9={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},kd=(function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e})({}),Gw=(function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e})({}),Xi=(function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e})({});function aM(e){if(!e.channelName)throw new $(k.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new $(k.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&pr(e.token,"info.token",1,2047),IR(e.uid),wR(e.channelName),!0}let un=(function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e})({}),ll=(function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e})({}),xn=(function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e})({}),fm=(function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e})({}),Ft=(function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e})({}),or=(function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e})({}),OR=(function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e})({}),nr=(function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e})({}),Mt=(function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e})({}),sM=[Mt.AFRICA,Mt.ASIA,Mt.CHINA,Mt.EUROPE,Mt.GLOBAL,Mt.INDIA,Mt.JAPAN,Mt.NORTH_AMERICA,Mt.OCEANIA,Mt.OVERSEA,Mt.SOUTH_AMERICA],Mr=(function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e})({}),NR={CHINA:{},ASIA:{CODE:Mr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Mr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Mr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Mr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Mr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Mr.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Mr.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Mr.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Mr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Mr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Mr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Mr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Mr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};aw&&(NR.CHINA={CODE:Mr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let xg=(function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e})({});function oM(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class cM extends Ei{constructor(t,i){super(),D(this,"onICEConnectionStateChange",void 0),D(this,"onConnectionStateChange",void 0),D(this,"onDTLSTransportStateChange",void 0),D(this,"onDTLSTransportError",void 0),D(this,"onICETransportStateChange",void 0),D(this,"onFirstAudioReceived",void 0),D(this,"onFirstVideoReceived",void 0),D(this,"onFirstAudioDecoded",void 0),D(this,"onFirstVideoDecoded",void 0),D(this,"onFirstVideoRender",void 0),D(this,"onFirstVideoDecodedTimeout",void 0),D(this,"onSelectedLocalCandidateChanged",void 0),D(this,"onSelectedRemoteCandidateChanged",void 0),D(this,"onICECandidateError",void 0),D(this,"getLocalVideoStats",void 0)}}class lM extends cM{constructor(t,i){super(t,i),D(this,"establishPromise",void 0)}}let Le=(function(e){return e.VIDEO="video",e.AUDIO="audio",e})({}),xr=(function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e})({}),dl=(function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e})({}),dM=["disconnected","failed"],me=(function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e})({}),jt=(function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e})({}),ze=(function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e})({}),ys=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),Cs=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),cr=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),uM=(function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e})({}),ac=(function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e})({}),za=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),co=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),mm=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),xi=(function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e})({}),_m=(function(e){return e.ABORT="abort",e})({}),Md=(function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e})({}),x9=(function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e})({}),U9={[AR.ACCESS_POINT]:{[ln.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[ln.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[ln.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[ln.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[ln.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[ln.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[ln.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[ln.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[ln.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[ln.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[ln.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[ln.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[ln.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[ln.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[ln.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[ln.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[ln.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[ln.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[AR.UNILBS]:{[Rs.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Rs.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Rs.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Rs.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Rs.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Rs.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Rs.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Rs.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Rs.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Rs.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Rs.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Rs.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[AR.STRING_UID_ALLOCATOR]:{[Bw.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Bw.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Bw.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Em(e){let t=U9[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};let i=t[e%1e4];if(!i){if(Math.floor(e/1e4)===AR.ACCESS_POINT){let r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}let V9={[Ke.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ke.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ke.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ke.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ke.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ke.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ke.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ke.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ke.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ke.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ke.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ke.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Ke.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ke.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ke.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ke.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ke.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ke.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ke.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ke.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ke.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ke.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ke.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ke.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ke.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ke.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ke.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ke.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ke.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ke.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ke.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ke.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ke.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ke.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ke.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ke.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ke.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ke.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ke.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ke.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ke.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ke.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ke.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ke.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ke.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ke.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ke.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ke.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ke.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ke.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ke.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ke.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ke.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ke.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ke.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ke.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ke.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ke.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ke.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ke.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ke.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ke.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ke.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ke.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Ug(e){return V9[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function hM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function Hw(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?hM(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):hM(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function Ww(e,t){if(typeof e=="string")return e;let{proxy:i,host:r,port:n}=e;if(t){let s=U("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(r,"/ws/?p=").concat(Number(n)+150):"wss://".concat(r,":").concat(s,"/ws/?p=").concat(Number(n)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(r,"&p=").concat(n):"wss://".concat(r,":").concat(n)}let B9=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,j9=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,F9=/wss:\/\/(.+):([0-9]+)\/?/,G9=/wss:\/\/(.[^\/]+)\/?/,H9=0;class W9{constructor(t,i){D(this,"id",0),D(this,"store",void 0),D(this,"recordIndex",void 0),D(this,"websockets",[]),D(this,"try443PortDuration",2e3),D(this,"forceCloseWSDuration",5e3),D(this,"try443PortTimeout",null),D(this,"forceCloseTimeout",null),D(this,"isTry443PortFailed",!1),D(this,"isNormalPortFailed",!1),D(this,"useDoubleDomain",!1),D(this,"useProxy",!1),D(this,"startTime",Date.now()),this.id=++H9,this.try443PortDuration=U("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;let i=Date.now()-this.startTime;for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];y.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...n)}createWebSocket(t,i,r){this.logger("createWebSocket:",t,{isTry443Port:i,hasTimeoutDetection:r});let n=U("GATEWAY_DOMAINS"),s=Date.now(),c=[],l=n.find(E=>{var R;return ve(R=t.host).call(R,E)});l||(this.useDoubleDomain=!1);let d=[];if(this.useDoubleDomain)n.forEach(E=>{d.push(Ww(Hw(Hw({},t),{},{host:t.host.replace(l,E)}),i))});else{let E=Hw({},t);if(i&&l){let R=n.find(N=>N!==l);R&&(E.host=E.host.replace(l,R))}d.push(Ww(E,i))}try{d.forEach(E=>{let R=new WebSocket(E);R.binaryType="arraybuffer",c.push(R),this.logger("ws is connecting:",R.url)})}catch(E){if(this.logger("ws create failed"),c.forEach(R=>R.close()),c.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,i,r);if(!i&&Number(t.port)!==443)return this.createWebSocket(t,!0,r);throw new $(k.WS_ERR,"init websocket failed! Error: ".concat(E.toString()))}let h=vg();this.store&&this.store.recordJoinChannelService({urls:c.map(E=>E.url),service:"gateway"},this.recordIndex),c.forEach(E=>{E.onopen=()=>{this.logger("onopen: ws ".concat(E.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach(R=>{R!==E&&(R.onopen=null,R.onclose=null,R.onmessage=null,R.close(),this.logger("close backup websocket: ".concat(R.url)))}),this.websockets.length=0,h.resolve(E)},E.onclose=R=>{this.logger("onclose: ws ".concat(E.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(E.readyState));let N=c.every(w=>w.readyState===WebSocket.CLOSED||w.readyState===WebSocket.CLOSING);this.logger("".concat(i?"443":"47xx"," websocket closed, all failed: ").concat(N)),N&&(i||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(R.reason)),h.reject({code:R.code,reason:OR.A_ROUND_WS_FAILED})):!i&&N&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),_()),i?this.isTry443PortFailed=N:this.isNormalPortFailed=N},E.onmessage=R=>this.logger("".concat(E.url," onmessage: ").concat(R.data))}),this.websockets.push(...c);let p=()=>{this.websockets.forEach(E=>E.readyState!==WebSocket.OPEN&&E.close())},_=()=>{if(h.isResolved)return p();Ct().os===rr.MAC_OS&&Ri()&&p(),this.createWebSocket(t,!0,!0).then(E=>{h.resolve(E)}).catch(E=>{this.isNormalPortFailed&&h.reject(E),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",h.isResolved),this.forceCloseTimeout=null,p()},this.forceCloseWSDuration)};return r||(()=>{if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,p()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",h.isResolved),this.try443PortTimeout=null,_()},this.try443PortDuration)})(),h.promise}chooseBestWebsocket(t,i,r,n){return this.useDoubleDomain=!!i,typeof t=="string"&&(t=(function(s){let c,l,d;return[,c,l,d]=s.match(B9)||[],c||([,l,d]=s.match(j9)||[]),l&&d||([,l,d]=s.match(F9)||[]),l&&d||([,l]=s.match(G9)||[]),l||y.warning("un-destructible url: ",s),{proxy:c,host:l,port:d||"443"}})(t)),this.recordIndex=n,this.useProxy=!!t.proxy,r&&this.useProxy&&(y.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(t,!!r,!1).finally(()=>this.clearTimeout())}}function pM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}class fM extends Ei{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var i;ve(i=["tryNext","recover"]).call(i,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(dt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(dt.CONNECTED):this._state==="closed"?this.emit(dt.CLOSED):this._state==="failed"&&this.emit(dt.FAILED))}resetReconnectCount(t){y.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,i){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],n=arguments.length>3&&arguments[3]!==void 0&&arguments[3],s=arguments.length>4&&arguments[4]!==void 0&&arguments[4],c=arguments.length>5?arguments[5]:void 0;super(),D(this,"_websocketUrl",null),D(this,"connectionID",0),D(this,"currentURLIndex",0),D(this,"urls",[]),D(this,"_reconnectMode","tryNext"),D(this,"reconnectReason",void 0),D(this,"_initMutex",void 0),D(this,"name",void 0),D(this,"_state","closed"),D(this,"reconnectInterrupter",void 0),D(this,"websocket",void 0),D(this,"retryConfig",void 0),D(this,"reconnectCount",0),D(this,"forceCloseTimeout",5e3),D(this,"onlineReconnectListener",void 0),D(this,"useCompress",void 0),D(this,"tryDoubleDomain",!1),D(this,"use443PortOnly",!1),D(this,"wsInflateLength",0),D(this,"wsDeflateLength",0),D(this,"closeEstablishingWs",()=>{}),D(this,"store",void 0),D(this,"joinGatewayRecordIndex",void 0),this.store=c,this.name=t,this.retryConfig=(function(_){for(var E=1;E<arguments.length;E++){var R=arguments[E]!=null?arguments[E]:{};E%2?pM(Object(R),!0).forEach(function(N){D(_,N,R[N])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(R)):pM(Object(R)).forEach(function(N){Object.defineProperty(_,N,Object.getOwnPropertyDescriptor(R,N))})}return _})({},i),this.useCompress=r,this.tryDoubleDomain=n,this.use443PortOnly=s,this._initMutex=new Lr("websocket",c?c.clientId:void 0);let{timeout:l,timeoutFactor:d}=i,h=Math.max(300,Math.floor(3*l/5)),p=Math.max(1.2,Math.floor(8*d)/10);$n.ONLINE&&(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p),Bi.on(Jf.NETWORK_STATE_CHANGE,(_,E)=>{_!==E&&(this.resetReconnectCount("network state change: ".concat(E," -> ").concat(_)),_===$n.ONLINE?(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p):(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=d))})}getConnection(){return this.websocket||void 0}async init(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=i,this.urls=t,this.state="connecting";try{var n;let s=vg(),c=this.urls[this.currentURLIndex];(n=this.store)===null||n===void 0||n.beforeConnect(),(function(l){return!(dR()||U("USE_NEW_TOKEN")||!U("ENABLE_PREALLOC_PC")&&(l==null||!l.autoSubscribe||U("FORCE_DISABLE_AUTO_SUB")))})(this.store)&&this.emit(uM.PRE_CONNECT_PC),this.createWebSocketConnection(c).then(s.resolve).catch(s.reject),this.once(dt.CLOSED,()=>{s.reject(new ne(k.WS_DISCONNECT))}),this.once(dt.CONNECTED,s.resolve),await s.promise}catch{}finally{r()}}close(t,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let r=this.websocket;i?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,i){if(!this.websocket)return void y.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),y.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);let r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:i})}sendMessage(t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new ne(k.WS_ABORT,"websocket is not ready");try{i||(t=JSON.stringify(t)),this.websocket.send(t)}catch(r){throw new ne(k.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){let t=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var i;let r=vg();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let n=p=>{var _;(_=this.store)===null||_===void 0||_.signalChannelOpen(),y.debug("[".concat(this.name,"] websocket opened:"),p),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},s=async p=>{var _;if(y.debug("[".concat(this.name,"] websocket close ").concat((_=this.websocket)===null||_===void 0?void 0:_.url,", code: ").concat(p.code,", reason: ").concat(p.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new ne(k.WS_DISCONNECT,"websocket close: ".concat(p.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=p.reason,this.state="reconnecting");let E=fa(this,dt.WILL_RECONNECT,this.reconnectMode,p.reason)||this.reconnectMode,R=await this.reconnectWithAction(E);if(this.state==="closed")return void y.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!R)return r.reject(new ne(k.WS_DISCONNECT,"websocket reconnect failed: ".concat(p.code))),this.close(!0);r.resolve()}},c=p=>{this.emit(dt.ON_MESSAGE,p)},l=p=>{y.warn("[".concat(this.connectionID,"] ws open error ").concat(p))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),U("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=U("GATEWAY_WSS_ADDRESS")),y.debug("[".concat(this.name,"] start connect, url:"),t);let d=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var h;this._websocketUrl=Ww(t);let p=await this.chooseBestWebsocketConnection(t);this.websocket=p,n&&n(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=c,this.websocket.onerror=l,(h=this.store)===null||h===void 0||h.recordJoinChannelService({endTs:Date.now(),status:"success"},d),this.joinGatewayRecordIndex=d}catch(p){let _=this.state==="closed",E=p instanceof ne,R=E&&p.code===k.WS_ABORT,N=E&&p.code===k.WS_ERR,w=E?p.message:p&&(p.reason||p.toString());y.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(w)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:R?"aborted":"error",errors:[p]},d),_||N?(r.reject(_?new ne(k.WS_DISCONNECT,"websocket is closed: ".concat(w)):new ne(k.WS_ERR,"init websocket failed: ".concat(w))),N&&y.error("[".concat(this.name,"] init websocket failed: ").concat(w))):s&&s(p)}return r.promise}async reconnectWithAction(t){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;y.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Bi.isOnline||!Bi.onlineWaiter||(this.onlineReconnectListener=Bi.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>r=!1,i){let c=ZA(this.reconnectCount,this.retryConfig);y.debug("[".concat(this.name,"] wait ").concat(c,"ms to reconnect websocket, mode: ").concat(t)),await we.race([fr(c),this.onlineReconnectListener||new we(()=>{})])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;let n=async(c,l)=>{this.emit(dt.RECONNECT_CREATE_CONNECTION,l),await this.createWebSocketConnection(c)};try{if(t==="retry")await n(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);y.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await n(this.urls[this.currentURLIndex],t)}else t==="recover"&&(y.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Cr(this,dt.REQUEST_NEW_URLS),this.currentURLIndex=0,await n(this.urls[this.currentURLIndex],t))}catch(c){var s;y.error("[".concat(this.name,"] reconnect failed ").concat(c&&c.toString()));let l=c==null||(s=c.data)===null||s===void 0?void 0:s.desc;return Array.isArray(l)&&ve(l).call(l,"dynamic key expired")?(this.emit(dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,i)}return!0}}class zw extends fM{constructor(t,i){super(t,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,i){let r=vg(),n=(function(c,l){return new W9(c,l)})(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{y.debug("[choose-best-ws] close establishing websockets"),n.closeAllWebsockets(),r.reject(new ne(k.WS_ABORT,"choose best websocket aborted"))};let s=U("GATEWAY_DOMAINS");return y.debug("[choose-best-ws] currentDomain: ",t,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),n.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,i).then(r.resolve).catch(r.reject),r.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Vg extends fM{constructor(t,i){super(t,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,i){return new we((r,n)=>{let s=!1,c=[];this.closeEstablishingWs=()=>{y.debug("[choose-best-ws] close establishing websockets"),c.forEach(N=>{N.onclose=null,N.onopen=null,N.onmessage=null,N.close()}),n(new ne(k.WS_ABORT,"choose best websocket aborted"))};let l=U("GATEWAY_DOMAINS"),d,h=t.indexOf("?h="),p=l.find(N=>h!==-1?ve(t).call(t,N,h):ve(t).call(t,N));y.debug("[choose-best-ws] currentDomain: ",p,", domains: ",l);let _=!this.tryDoubleDomain||!p;if(!_&&p){var E;let N=Date.now();try{l.forEach(w=>{let O=h===-1?t.replace(p,w):t.substr(0,h)+t.substr(h).replace(p,w),L=new WebSocket(O);L.binaryType="arraybuffer",c.push(L),y.debug("[choose-best-ws] ws is connecting:",L.url)})}catch{for(y.debug("[choose-best-ws] ws create failed, fallback to single url"),c.forEach(w=>w.close());c.length;)c.pop();_=!0}(E=this.store)===null||E===void 0||E.recordJoinChannelService({urls:c.map(w=>w.url),service:"gateway"},i),c.forEach(w=>{w.onopen=()=>{if(s)return;let O=Date.now()-N;y.debug("[choose-best-ws] ws open cost ".concat(O,"ms")),c.filter(L=>L!==w).forEach(L=>{y.debug("[choose-best-ws]close backup websocket: ".concat(L.url)),L.close()}),s=!0,r(w)},w.onclose=O=>{d=O,!s&&(c.find(L=>!(L.readyState===WebSocket.CLOSED||L.readyState===WebSocket.CLOSING))||(y.debug("[choose-best-ws] all websocket is closed"),s=!0,n(d)))},w.onmessage=O=>{y.debug("[choose-best-ws]".concat(w.url," onmessage: ").concat(O.data))}}),fr(this.forceCloseTimeout).then(()=>{c.forEach(w=>{w.readyState!==WebSocket.OPEN&&w.close()})})}if(_){var R;let N;y.debug("[choose-best-ws] use single url: ",t),(R=this.store)===null||R===void 0||R.recordJoinChannelService({urls:[t],service:"gateway"},i);try{N=new WebSocket(t),c.push(N),N.binaryType="arraybuffer"}catch(w){let O=new ne(k.WS_ERR,"init websocket failed! Error: ".concat(w.toString()));return y.error("[".concat(this.name,"]").concat(O)),void n(O)}N.onopen=()=>{r(N)},N.onclose=w=>{n(w)},N.onmessage=w=>{y.debug("[choose-best-ws]".concat(N.url," onmessage: ").concat(w.data))},fr(this.forceCloseTimeout).then(()=>{N&&N.readyState!==WebSocket.OPEN&&N.close()})}}).then(r=>(this.closeEstablishingWs=void 0,r)).catch(r=>{throw this.closeEstablishingWs=void 0,r})}}class z9 extends Ei{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===ni.CONNECTED?this.emit(nt.WS_CONNECTED):t===ni.RECONNECTING?this.emit(nt.WS_RECONNECTING,this._websocketReconnectReason):t===ni.CLOSED&&this.emit(nt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,i){super(),D(this,"_disconnectedReason",void 0),D(this,"_websocketReconnectReason",void 0),D(this,"_connectionState",ni.CLOSED),D(this,"reconnectToken",void 0),D(this,"websocket",void 0),D(this,"openConnectionTime",void 0),D(this,"clientId",void 0),D(this,"lastMsgTime",Date.now()),D(this,"uploadCache",[]),D(this,"uploadCacheInterval",void 0),D(this,"rttRolling",new RL(5)),D(this,"pingpongTimer",void 0),D(this,"wsInflateDataTimer",void 0),D(this,"pingpongTimeoutCount",0),D(this,"ortc",void 0),D(this,"joinResponse",void 0),D(this,"multiIpOption",void 0),D(this,"initError",void 0),D(this,"spec",void 0),D(this,"store",void 0),D(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(nt.ON_BINARY_DATA,r.data);let n=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(n,"_id")){let s="res-@".concat(n._id);this.emit(s,n._result,n._message)}else if(Object.prototype.hasOwnProperty.call(n,"_type")){if(this.emit(n._type,n._message),n._type===vt.ON_NOTIFICATION&&this.handleNotification(n._message),n._type===vt.ON_USER_BANNED)switch(n._message.error_code){case 14:this.close(Bt.UID_BANNED);break;case 15:this.close(Bt.IP_BANNED);break;case 16:this.close(Bt.CHANNEL_BANNED)}if(n._type===vt.ON_USER_LICENSE_BANNED)switch(n._message.error_code){case Ke.ERR_LICENSE_MISSING:this.close(Bt.LICENSE_MISSING);break;case Ke.ERR_LICENSE_EXPIRED:this.close(Bt.LICENSE_EXPIRED);break;case Ke.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Bt.LICENSE_MINUTES_EXCEEDED);break;case Ke.ERR_LICENSE_PERIOD_INVALID:this.close(Bt.LICENSE_PERIOD_INVALID);break;case Ke.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Bt.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ke.ERR_LICENSE_ILLEGAL:this.close(Bt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=i,this.websocket=new zw("gateway-".concat(this.clientId),this.spec.retryConfig,!0,U("JOIN_GATEWAY_USE_DUAL_DOMAIN"),U("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ni.CONNECTED&&this.reconnect("retry",yr.OFFLINE)})}async request(t,i,r,n){let s=Zt(6,""),c={_id:s,_type:t,_message:i},l=this.websocket.connectionID,d=()=>new we((N,w)=>{if(this.connectionState===ni.CONNECTED)return N();let O=()=>{this.off(nt.WS_CLOSED,L),N()},L=()=>{this.off(nt.WS_CONNECTED,O),w(new $(k.WS_ABORT))};this.once(nt.WS_CONNECTED,O),this.once(nt.WS_CLOSED,L),t!==Je.PUBLISH&&t!==Je.PUBLISH_DATASTREAM&&t!==Je.SUBSCRIBE&&t!==Je.SUBSCRIBE_DATASTREAM&&t!==Je.UNSUBSCRIBE&&t!==Je.UNSUBSCRIBE_DATASTREAM&&t!==Je.UNPUBLISH&&t!==Je.UNPUBLISH_DATASTREAM&&t!==Je.CONTROL&&t!==Je.RESTART_ICE||this.once(nt.DISCONNECT_P2P,()=>{w(new $(k.DISCONNECT_P2P))}),t!==Je.PUBLISH&&t!==Je.RESTART_ICE||this.once(nt.ABORT_P2P_EXECUTION,()=>{w(new $(k.DISCONNECT_P2P))})});if(this.connectionState!==ni.CONNECTING&&this.connectionState!==ni.RECONNECTING||t===Je.JOIN||t===Je.REJOIN||await d(),this.websocket.sendMessage(c,!0),n)return;let h=new we((N,w)=>{let O=!1,L=(B,Y)=>{O=!0,N({isSuccess:B==="success",message:Y||{}}),this.off(nt.WS_CLOSED,M),this.off(nt.WS_RECONNECTING,M),this.emit(nt.REQUEST_SUCCESS,t,i)};this.once("res-@".concat(s),L);let M=()=>{w(new $(k.WS_ABORT,"type: ".concat(t))),this.off(nt.WS_CLOSED,M),this.off(nt.WS_RECONNECTING,M),this.off("res-@".concat(s),L)};this.once(nt.WS_CLOSED,M),this.once(nt.WS_RECONNECTING,M),fr(U("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||O||(y.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(nt.REQUEST_TIMEOUT,t,i))})}),p=null;try{p=await h}catch(N){if(this.connectionState===ni.CLOSED||t===Je.LEAVE)throw new $(k.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?N.throw():t===Je.JOIN||t===Je.REJOIN?null:(await d(),await this.request(t,i))}if(p.isSuccess)return p.message;let _=Number(p.message.error_code||p.message.code),E=Ug(_),R=new $(k.UNEXPECTED_RESPONSE,"".concat(E.desc,": ").concat(p.message.error_str),{code:_,data:p.message,desc:E.desc});return E.action==="success"?p.message:(y.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(_,", message: ").concat(E.desc,", action: ").concat(E.action)),_===Ke.ERR_TOO_MANY_BROADCASTERS?((t===Je.JOIN||t===Je.REJOIN)&&(this.initError=R,this.close()),R.throw()):E.action==="failed"?R.throw():E.action==="quit"?(this.initError=R,this.close(),R.throw()):(_===Ke.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,y.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",yr.MULTI_IP)):this.reconnect(E.action,yr.SERVER_ERROR),t===Je.JOIN||t===Je.REJOIN?null:await this.request(t,i)))}waitMessage(t,i){return new we(r=>{let n=s=>{(!i||i(s))&&(this.off(t,n),r(s))};this.on(t,n)})}uploadWRTCStats(t){if(!this.store.sessionId)return void y.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Mg.WRTC_STATS,i)}upload(t,i){let r={_type:t,_message:i};try{this.websocket.sendMessage(r)}catch{let n=U("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>n&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ni.CONNECTED)return;let s=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(s._type,s._message)},U("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,i){let r={_type:t,_message:i};this.websocket.sendMessage(r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new we((i,r)=>{this.once(nt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(nt.WS_CLOSED,n=>r(this.initError||new $(k.WS_ABORT,n))),this.connectionState=ni.CONNECTING,this.websocket.init(t).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Bt.LEAVE,this.connectionState=ni.CLOSED,y.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(nt.ABORT_P2P_EXECUTION),this.store.signalConnected();let t=await Cr(this,nt.REQUEST_JOIN_INFO);this.store.joinReq();let i=await this.request(Je.JOIN,t);if(this.ortc=t?.ortc,this.store.joinRep(),!i)return this.emit(nt.REPORT_JOIN_GATEWAY,OR.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(nt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=ni.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new $(k.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let t=Ag(this,nt.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;let i=await this.request(Je.REJOIN,t);return!!i&&(this.connectionState=ni.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(r=>{this.emit(vt.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(vt.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(vt.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(vt.MUTE_AUDIO,{uid:r.uid}):this.emit(vt.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(vt.MUTE_VIDEO,{uid:r.uid}):this.emit(vt.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(vt.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(vt.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(vt.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(vt.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(vt.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,i)}async downgradeCodec(t){if(!this.ortc)return!1;let i={downgrade_codec:t,ortc:this.ortc};return!!await this.request(Je.DOWNGRADE_CODEC,i)}handleNotification(t){y.debug("[".concat(this.clientId,"] receive notification: "),t);let i=Ug(t.code);if(t.code===28&&"detail"in t&&(y.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(nt.RECOVER_NOTIFICATION,t.detail)),i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Bt.UID_BANNED),void this.close()):void this.reconnect(i.action,yr.SERVER_ERROR);y.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=U("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=t&&(y.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>U("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",yr.TIMEOUT):this.request(Je.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let r=Date.now()-i;this.rttRolling.add(r),U("REPORT_STATS")&&this.send(Je.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){let{wsInflateLength:t,wsDeflateLength:i}=this.websocket.getWsInflateData();t!==0&&i!==0&&this.upload(Mg.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(dt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(nt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(dt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(dt.CLOSED,()=>{this.connectionState=ni.CLOSED}),this.websocket.on(dt.FAILED,()=>{this._disconnectedReason=Bt.NETWORK_ERROR,this.connectionState=ni.CLOSED}),this.websocket.on(dt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===ni.CONNECTED?this.connectionState=ni.RECONNECTING:this.connectionState=ni.CONNECTING}),this.websocket.on(dt.WILL_RECONNECT,(t,i,r)=>{let n=Ag(this,nt.IS_P2P_DISCONNECTED),s=n||t!=="retry";n&&t==="retry"&&(y.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",i=OR.P2P_DISCONNECTED),s&&(y.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(nt.REPORT_JOIN_GATEWAY,i||OR.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(nt.DISCONNECT_P2P)),r(t)}),this.websocket.on(dt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{y.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",yr.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(nt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof $){if(t.code===k.UNEXPECTED_RESPONSE&&t.data.code===Ke.ERR_NO_AUTHORIZED)return this.initError=new $(k.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Bt.TOKEN_EXPIRE);y.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",yr.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(dt.REQUEST_NEW_URLS,(t,i)=>{Cr(this,nt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(i)}),this.websocket.on(dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(vt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(uM.PRE_CONNECT_PC,()=>{this.emit(nt.PRE_CONNECT_PC)})}}let K9=(function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e})({}),ji=(function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e})({});function mM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function DR(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?mM(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):mM(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function xd(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(U("TURN_DOMAIN")):(y.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function PR(e){try{let t=U("GATEWAY_DOMAINS").concat(U("TURN_DOMAIN")).find(i=>ve(e).call(e,i));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch{return y.debug("serverUrlToIp error, fallback to url",e),e}}function Kw(e,t){e.addresses||(e.addresses=[]);let i=(function(l,d){if(U("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return l.map(_=>{let{ip:E,port:R}=_;return{address:"".concat(E,":").concat(R)}});let h=U("GATEWAY_DOMAINS"),p=h[1]&&ve(d).call(d,h[1])?1:0;return l.map(_=>{let{domain_prefix:E,port:R,ip:N}=_;if(E)return{address:"".concat(E,".").concat(h[p++%h.length],":").concat(R)};let w=/^[\.\:\d]+$/.test(N),O=w?"".concat(N.replace(/[^\d]/g,"-"),".").concat(h[p++%h.length],":").concat(R):"".concat(N,":").concat(R);return w||y.debug("Cannot recognized as ip address: ".concat(N,", use as host3")),{ip:N,port:R,address:O}})})(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&typeof r=="string"){let l=r.split(";");for(let d=0;d<l.length;d++){var n;let h=Qr(n=l[d]).call(n);i[d]&&h&&(i[d].ip6=h)}}let s=e.detail&&e.detail.candidate,c;if(s){let[l,d]=s.split(":");l&&d&&(c={port:Number(d),ip:l,address:"".concat(l,":").concat(d)})}return{gatewayAddrs:i,apGatewayAddress:c,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function ea(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function _M(e){let t=e._encoderConfig;if(!t)return{};let i={resolution:t.width&&t.height?"".concat(ea(t.width),"x").concat(ea(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(i.maxFrameRate=t.frameRate,i.minFrameRate=t.frameRate):t.frameRate&&(i.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,i.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),i}function EM(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Bg(e,t){let i,r,n;switch(t){case ji.CHOOSE_SERVER:r=4096,n="choose server";break;case ji.CLOUD_PROXY:r=1048576,n="proxy";break;case ji.CLOUD_PROXY_5:r=4194304,n="proxy5";break;case ji.CLOUD_PROXY_FALLBACK:r=4194310,n="proxy fallback";break;default:throw new $(k.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(s=>{s.buffer&&s.buffer.flag===r&&(i={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map(c=>DR(DR({},c),{},{ticket:s.buffer.cert})),server_ts:e.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:DR(DR({},s.buffer.detail),e.detail),flag:s.buffer.flag,opid:e.opid,cert:s.buffer.cert})}),!i)throw new $(k.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(n," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function gM(e,t){return await we.all(e.addresses.map(async i=>({address:xd(i.ip),tcpport:i.port,udpport:i.port,username:t&&U("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():br.username,password:t&&U("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await YA(t.toString()):br.password})))}function Yw(e,t){let i=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||i.height,n=t.videoWidth||i.width;return r&&n?Math.max(Math.min(r,n)/Math.min(ea(e.height),ea(e.width)),1):(y.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Ud(e){let{candidateType:t,relayProtocol:i,type:r,address:n,port:s,protocol:c}=e,l={candidateType:t,relayProtocol:i,protocol:c};if(r!=="local-candidate"){let d=n.split(".");d.length>=4&&(d[1]="*",d[2]="*"),l.address=d.join("."),l.port=s}return l}function Dh(e){let t=e.split(":"),i=e.split(/[-.]/),r=ve(e).call(e,"-")?"-":".",n=e;return t.length>1?i.length>1?(i[1]="**",n=i[0]+r+"**:"+t[t.length-1]):n=t.length>2?t[0]+r+"**:"+t[t.length-1]:"**:"+t[t.length-1]:i.length>1&&(n=i[0]+r+"**"),n}function LR(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:U("SVC_MODE");if(U("ENABLE_SVC"))return(function(t){return t in oR})(e)?e:oR.L1T3}let SM={[Le.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Le.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function kR(e,t,i){t.forEach(r=>{var n;let s=SM[e].find(l=>{var d;let{key:h}=l;return ve(d=r.extensionName).call(d,h)});if(!s)return;let c=i.find(l=>{let{extensionName:d}=l;return ve(d).call(d,s.key)});c&&ve(n=c.extensionName).call(n,"gdpr_forbidden")&&(r.extensionName=c.extensionName)})}function gm(e,t){t.forEach(i=>{var r;let n=SM[e].find(s=>{var c;let{key:l}=s;return ve(c=i.extensionName).call(c,l)});ve(r=i.extensionName).call(r,"gdpr_forbidden")&&n&&(i.extensionName=n.extensionName)})}function TM(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||ve(e).call(e,"abs-send-time")}function MR(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||ve(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function vM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function RM(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?vM(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):vM(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function jg(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,{filterRTX:n,filterVideoFec:s,filterAudioFec:c,filterAudioCodec:l,filterVideoCodec:d,unsupportedVideoUplinkCodec:h,unsupportedVideoDownlinkCodec:p}=t,{useXR:_}=i,E=[],R=[],N=[],w=[],O=!1,L=!1;if(kn(e).mediaDescriptions.forEach(B=>{r&&r!==B.attributes.direction||(B.media.mediaType!=="video"||O||(R=B.attributes.payloads,w=B.attributes.extmaps,O=!0),B.media.mediaType!=="audio"||L||(E=B.attributes.payloads,N=B.attributes.extmaps,L=!0))}),!w||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!N||E.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(B=>{var Y;(Y=B.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(B.rtpMap.clockRate=parseInt(B.rtpMap.clockRate)),_&&B.rtcpFeedbacks.push({type:"rrtr"})}),E.forEach(B=>{var Y;(Y=B.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(B.rtpMap.clockRate=parseInt(B.rtpMap.clockRate)),_&&B.rtcpFeedbacks.push({type:"rrtr"})}),n&&(E=E.filter(B=>{var Y;return((Y=B.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"}),R=R.filter(B=>{var Y;return((Y=B.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"})),s){let B=R.filter(G=>{var Q;return/(red)|(ulpfec)|(flexfec)/i.test(((Q=G.rtpMap)===null||Q===void 0?void 0:Q.encodingName)||"")}),Y=Bd(B,R).map(G=>G.payloadType),H=[...B.map(G=>G.payloadType),...Y];R=R.filter(G=>!ve(H).call(H,G.payloadType))}if(c&&(E=E.filter(B=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=B.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),l&&l?.length>0&&(E=E.filter(B=>{var Y;return ve(l).call(l,((Y=B.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())||"")})),d&&d?.length>0){let B=R.filter(Y=>{var H;return ve(d).call(d,((H=Y.rtpMap)===null||H===void 0?void 0:H.encodingName.toLowerCase())||"")});R=B.concat(n?[]:Bd(B,R))}let M=U("UNSUPPORTED_VIDEO_CODEC");if(M&&M.length>0){let B=R.filter(G=>G.rtpMap&&ve(M).call(M,G.rtpMap.encodingName.toLowerCase())),Y=Bd(B,R),H=B.concat(Y).map(G=>G.payloadType);R=R.filter(G=>!ve(H).call(H,G.payloadType)),y.debug("unsupportedVideoCodec: ".concat(M,", toBeRemoved: ").concat(H))}if(h&&h.length>0&&r==="sendonly"){let B=R.filter(G=>G.rtpMap&&ve(h).call(h,G.rtpMap.encodingName.toLowerCase())),Y=Bd(B,R),H=B.concat(Y).map(G=>G.payloadType);R=R.filter(G=>!ve(H).call(H,G.payloadType)),y.debug("unsupportedVideoUplinkCodec: ".concat(h,", toBeRemoved: ").concat(H))}if(p&&p.length>0&&r==="recvonly"){let B=R.filter(G=>G.rtpMap&&ve(p).call(p,G.rtpMap.encodingName.toLowerCase())),Y=Bd(B,R),H=B.concat(Y).map(G=>G.payloadType);R=R.filter(G=>!ve(H).call(H,G.payloadType)),y.debug("unsupportedVideoDownlinkCodec: ".concat(p,", toBeRemoved: ").concat(H))}return{audioCodecs:E,videoCodecs:R,audioExtensions:N,videoExtensions:w}}function Vd(e){let t=kn(e),i,r;for(let n of t.mediaDescriptions){if(!i){let s=n.attributes.iceUfrag,c=n.attributes.icePwd;if(!s||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:s,icePwd:c}}if(!r){let s=n.attributes.fingerprints;s.length>0&&(r={fingerprints:s})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:r}}function yM(e,t){let i=[],r=e.attributes.ssrcGroups.filter(c=>c.semantic==="FID"),n=e.attributes.ssrcGroups.find(c=>c.semantic==="SIM"),s=e.attributes.ssrcs;if(n)n.ssrcIds.forEach(c=>{var l;let d=(l=r.find(h=>h.ssrcIds[0]===c))===null||l===void 0?void 0:l.ssrcIds[1];i.push({ssrcId:c,rtx:t?d:void 0})});else if(r.length>0){let c=r[0].ssrcIds[0],l=r[0].ssrcIds[1];i.push({ssrcId:c,rtx:t?l:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:s[0].ssrcId})}return i}function CM(e,t,i){let{cname:r}=e,n=[];t&&(n=bM(t)),n.length===0&&(n=e.iceParameters.candidates.map(p=>({foundation:p.foundation,componentId:"1",transport:p.protocol,priority:p.priority.toString(),connectionAddress:p.ip,port:p.port.toString(),type:p.type,extension:{}})),y.debug("Using candidates from gateway."));let s={fingerprints:e.dtlsParameters.fingerprints.map(p=>({hashFunction:p.algorithm,fingerprint:p.fingerprint}))},c={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd},l;switch(e.dtlsParameters.role){case"server":l="passive";break;case"client":l="active";break;case"auto":l="actpass"}let d=UR(e.rtpCapabilities),h=[];return Array.isArray(i)&&i.length>0&&i.forEach(p=>{h.push({kind:Le.VIDEO,ssrcMsg:[{ssrcId:p.v,rtx:p.v_rtx}],mslabel:"".concat(p.v,"_").concat(p.a)},{kind:Le.AUDIO,ssrcMsg:[{ssrcId:p.a}],mslabel:"".concat(p.v,"_").concat(p.a)})}),{dtlsParameters:s,iceParameters:c,candidates:n,rtpCapabilities:d,setup:l,cname:r,preSSRCs:h}}function bM(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],y.debug("Using remote candidate from AP ".concat(Dh(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),y.debug("Using IPV6 remote candidate from AP ".concat(Dh(e.ip6),":").concat(e.port)))),t}function Fg(e,t,i){let r=[],n=[];return e.forEach(s=>{let{ssrcId:c,rtx:l}=s,d=Zt(8,"track-"),h={ssrcId:c,attributes:RM({label:d,mslabel:i=i||Zt(10,""),msid:"".concat(i," ").concat(d)},t&&{cname:t})};if(r.push(h),l!==void 0){let p={ssrcId:l,attributes:RM({label:d,mslabel:i,msid:"".concat(i," ").concat(d)},t&&{cname:t})};r.push(p),n.push({semantic:"FID",ssrcIds:[c,l]})}}),e.length>1&&n.push({semantic:"SIM",ssrcIds:e.map(s=>{let{ssrcId:c}=s;return c})}),{ssrcs:r,ssrcGroups:n}}function Sm(e,t){t instanceof Ai&&e.attributes.payloads.forEach(i=>{var r;let n=(r=i.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!n||["opus","pcmu","pcma","g722"].indexOf(n)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),n==="opus"&&typeof U("OPUS_PTIME")=="number"?i.fmtp.parameters.ptime=U("OPUS_PTIME"):i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";let s=t._encoderConfig;s&&(n!=="pcmu"&&n!=="pcma"&&n!=="g722"&&(s.bitrate&&!Ri()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1")),t instanceof Lg&&n==="opus"&&t._config.DTX&&(i.fmtp.parameters.usedtx="1"))})}function qw(e){let t=e.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function Xw(e,t){var i;if(!(t instanceof ai&&t._encoderConfig&&t._hints.indexOf(qt.SCREEN_TRACK)===-1))return;let r=t._encoderConfig;Ot().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach(n=>{var s,c;ve(s=["h264","h265","vp8","vp9","av1"]).call(s,((c=n.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),Ot().supportMinBitrate&&!ve(i=t._hints).call(i,qt.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach(n=>{var s,c;ve(s=["h264","h265","vp8","vp9","av1"]).call(s,((c=n.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters["x-google-start-bitrate"]="".concat(U("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function AM(e){if(e.media.mediaType!=="video")return;let t=Ct();if(t.name!==Pt.SAFARI&&t.os!==rr.IOS)return;let i=e.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));i!==-1&&e.attributes.extmaps.splice(i,1)}function xR(e,t,i){if(!t)return;let r,n;if(e.media.mediaType==="video"?(r=i.videoExtensions,n=i.videoCodecs):(r=i.audioExtensions,n=i.audioCodecs),t.twcc===!0){let s=r.find(c=>MR(c.extensionName));if(s){let c=s.extensionName;e.attributes.extmaps.find(l=>MR(l.extensionName))||e.attributes.extmaps.push({entry:s.entry,extensionName:c}),(function(l,d){return d.filter(h=>!!l.find(p=>p.payloadType===h.payloadType&&!!p.rtcpFeedbacks.find(_=>_.type==="transport-cc")))})(n,e.attributes.payloads).forEach(l=>{l.rtcpFeedbacks.find(d=>d.type==="transport-cc")||l.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){let s=e.attributes.extmaps.findIndex(c=>MR(c.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach(c=>{let l=c.rtcpFeedbacks.findIndex(d=>d.type==="transport-cc");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}if(t.remb===!0){let s=r.find(c=>TM(c.extensionName));if(s){let c=s.extensionName;e.attributes.extmaps.find(l=>l.extensionName===c)||e.attributes.extmaps.push({entry:s.entry,extensionName:c}),(function(l,d){return d.filter(h=>!!l.find(p=>p.payloadType===h.payloadType&&!!p.rtcpFeedbacks.find(_=>_.type==="goog-remb")))})(n,e.attributes.payloads).forEach(l=>{l.rtcpFeedbacks.find(d=>d.type==="goog-remb")||l.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){let s=e.attributes.extmaps.findIndex(c=>TM(c.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach(c=>{let l=c.rtcpFeedbacks.findIndex(d=>d.type==="goog-remb");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}}function wM(e,t,i){if(Ri()||e.media.mediaType!=="video"||!(t instanceof ai)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!U("SIMULCAST")||i==="vp9"&&U("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;let r=i==="vp8"?2:t._scalabilityMode.numSpatialLayers,n=e.attributes.ssrcs[0],s=e.attributes.ssrcGroups.find(l=>l.semantic==="FID"&&l.ssrcIds[0]===n.ssrcId),c={semantic:"SIM",ssrcIds:[n.ssrcId]};for(let l=1;l<r;l++)e.attributes.ssrcs.push({ssrcId:n.ssrcId+l,attributes:fi(n.attributes)}),c.ssrcIds.push(n.ssrcId+l),s&&(e.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+l,attributes:fi(n.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[n.ssrcId+l,s.ssrcIds[1]+l]}));e.attributes.ssrcGroups.unshift(c)}async function IM(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});let r=(await i.createOffer()).sdp,{send:n,recv:s,sendrecv:c}=(function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0,p=jg(h,l,d,"sendonly"),_=jg(h,l,d,"recvonly"),E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},R={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(bs(p,_,"videoExtensions",E,R,N),bs(p,_,"videoCodecs",E,R,N),bs(p,_,"audioExtensions",E,R,N),bs(p,_,"audioCodecs",E,R,N),U("RAISE_H264_BASELINE_PRIORITY")){let w=[],O=[];if(N.videoCodecs.forEach((L,M)=>{var B;if(((B=L.rtpMap)===null||B===void 0?void 0:B.encodingName.toLocaleLowerCase())==="h264"){var Y,H;let G=N.videoCodecs[M+1],Q=G&&LM(L,G),ce=(Y=L.fmtp)===null||Y===void 0?void 0:Y.parameters["profile-level-id"],he=(H=L.fmtp)===null||H===void 0?void 0:H.parameters["packetization-mode"];!ce||ce!==U("FIRST_H264_PROFILE_LEVEL_ID")||U("FIRST_PACKETIZATION_MODE")&&he!==U("FIRST_PACKETIZATION_MODE")?Q?O.push([L,G]):O.push([L]):Q?w.push([L,G]):w.push([L])}}),w.length>0&&O.length>0){y.debug("raising H264 baseline profile priority"),N.videoCodecs.forEach((M,B)=>{var Y;if(((Y=M.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"){let H=LM(M,N.videoCodecs[B+1]),G=w.shift()||O.shift()||[];G.length>0&&(H?N.videoCodecs.splice(B,2,...G):N.videoCodecs.splice(B,1,...G))}});let L=R.videoCodecs.filter(M=>{var B,Y;return((B=M.rtpMap)===null||B===void 0?void 0:B.encodingName.toLocaleLowerCase())==="h264"&&((Y=M.fmtp)===null||Y===void 0?void 0:Y.parameters["profile-level-id"])!==U("FIRST_H264_PROFILE_LEVEL_ID")});if(L.length>0){let M=Bd(L,R.videoCodecs).map(Y=>Y.payloadType),B=[...L.map(Y=>Y.payloadType),...M];R.videoCodecs=R.videoCodecs.filter(Y=>!ve(B).call(B,Y.payloadType))}U("FILTER_SEND_H264_BASELINE")&&(E.videoCodecs=E.videoCodecs.filter(M=>{var B,Y;return!(((B=M.rtpMap)===null||B===void 0?void 0:B.encodingName.toLocaleLowerCase())==="h264"&&((Y=M.fmtp)===null||Y===void 0?void 0:Y.parameters["profile-level-id"])!==U("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:E,recv:R,sendrecv:N}}return{send:E,recv:R,sendrecv:N}})(e,t,r);try{i.close()}catch{}return{send:n,recv:s,sendrecv:c}}function OM(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=jg(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(bs(e,t,"videoExtensions",i,r,n),bs(e,t,"videoCodecs",i,r,n),bs(e,t,"audioExtensions",i,r,n),bs(e,t,"audioCodecs",i,r,n),U("RAISE_H264_BASELINE_PRIORITY")){let s=n.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]==="42001f");if(s!==-1){let c=n.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(c<s){y.debug("raising H264 baseline profile priority");let l=n.videoCodecs[s];n.videoCodecs.splice(s,1),n.videoCodecs.splice(c,0,l)}c!==-1&&(r.videoCodecs=r.videoCodecs.filter(l=>!(l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:r,sendrecv:n}}function bs(e,t,i,r,n,s){if(i==="videoExtensions"||i==="audioExtensions"){let c=[];return e[i].forEach(l=>{t[i].some((d,h)=>{if(l.entry===d.entry&&l.extensionName===d.extensionName)return c.push(h),!0})?s[i].push(l):r[i].push(l)}),void t[i].forEach((l,d)=>{c.indexOf(d)===-1&&n[i].push(l)})}if(i==="videoCodecs"||i==="audioCodecs"){let c=[];return e[i].forEach(l=>{t[i].some((d,h)=>{if(l.payloadType===d.payloadType&&JSON.stringify(l)===JSON.stringify(d))return c.push(h),!0})?s[i].push(l):r[i].push(l)}),void t[i].forEach((l,d)=>{c.indexOf(d)===-1&&n[i].push(l)})}}function UR(e){let{send:t,recv:i,sendrecv:r}=e;if(!r){if(!t||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:i}}let n,s;return t?(n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},n.audioCodecs=[...t.audioCodecs,...r.audioCodecs],n.videoCodecs=[...t.videoCodecs,...r.videoCodecs],n.audioExtensions=[...t.audioExtensions,...r.audioExtensions],n.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):n=r,i?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...i.audioCodecs,...r.audioCodecs],s.videoCodecs=[...i.videoCodecs,...r.videoCodecs],s.audioExtensions=[...i.audioExtensions,...r.audioExtensions],s.videoExtensions=[...i.videoExtensions,...r.videoExtensions]):s=r,{send:n,recv:s}}function Tm(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var i;return((i=t.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Gg(e,t,i,r){let n=[];if(e===Le.VIDEO){if(U("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(n=t.videoCodecs.filter(s=>{var c;return ve(c=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(c,r)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===U("H264_PROFILE_LEVEL_ID")})),!Array.isArray(n)||n.length===0){let s=[],c=[],l=[],d=[];if(i.videoCodecs.forEach(h=>{let p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"";ve(p).call(p,r)?s.push(h):ve(p).call(p,"vp9")?c.push(h):ve(p).call(p,"vp8")?l.push(h):ve(p).call(p,"h264")&&d.push(h)}),s.length===0){let h="";c.length!==0?(s=c,h="vp9"):l.length!==0?(s=l,h="vp8"):d.length!==0&&(s=d,h="h264"),y.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(h))}s.length!==0&&(n=t.videoCodecs.filter(h=>s.some(p=>p.payloadType===h.payloadType)))}if(n.length===0&&(y.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),n=t.videoCodecs),U("USE_PUB_RTX")||U("USE_SUB_RTX")){let s=Bd(n,t.videoCodecs);n=[...n,...s]}}else{n=t.audioCodecs.filter(c=>{var l;return ve(l=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(l,r)});let s=t.audioCodecs.filter(c=>{var l;return ve(l=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(l,"red")});n.length===0&&(y.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),n=t.audioCodecs.filter(c=>{var l;return ve(l=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(l,"opus")})),U("ENABLE_AUDIO_RED")&&s.length!==0&&(n=[...s,...n])}return n}function Bd(e,t){let i=e.map(r=>r.payloadType.toString());return t.filter(r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&ve(i).call(i,r.fmtp&&r.fmtp.parameters.apt))}async function jd(e,t,i){let r=t.toString(),n=DM(r,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:r});let s=await e.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let c=s.sdp;c=NM(c,i||{}),n?.(c||""),await e.setLocalDescription({type:"answer",sdp:c})}function NM(e,t,i){let r=kn(e),{useXR:n}=t;return r.mediaDescriptions.forEach(s=>{var c;s.attributes.mid&&(Array.isArray(i)&&!ve(i).call(i,s.attributes.mid)||(s.media.mediaType==="audio"&&Tm(s),n&&ve(c=["audio","video"]).call(c,s.media.mediaType)&&s.attributes.payloads.forEach(l=>{l.rtcpFeedbacks.findIndex(d=>d.type==="rrtr")===-1&&l.rtcpFeedbacks.push({type:"rrtr"})})))}),Pd(r)}function DM(e,t,i,r){if(U("SDP_LOGGING"))return y.upload("exchanging ".concat(i," ").concat(t," SDP during P2PConnection.").concat(r,`
`),e),t==="offer"?n=>{DM(n,"answer",i==="local"?"remote":"local",r)}:void 0}function PM(e){let t=U("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(i=>ve(e).call(e,i))}function LM(e,t){try{var i;return((i=e.fmtp)===null||i===void 0?void 0:i.parameters.apt)===t.payloadType.toString()}catch{return!1}}function kM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function ya(e,t){return typeof U(e)===t?U(e):void 0}function Y9(){try{let e=U("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:(function(t){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?kM(Object(r),!0).forEach(function(n){D(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):kM(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t})({},e)}catch(e){return y.debug("handle gateway attributes failed: ",e),{}}}let MM={};function Fd(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&y.debug("install service ".concat(e.name)),MM[e.name]=e}function ul(e){let t=MM[e];if(!t)throw new ne(k.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function xM(e,t){return ul("DataStream").create(e,t)}function VR(){return ul("InterceptFrame").create()}function UM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function Kr(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?UM(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):UM(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let Jw=new Map;class q9 extends Ei{get state(){return this._state}set state(t){if(t===this._state)return;let i=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(or.CONNECTION_STATE_CHANGE,t,i,this._disconnectedReason):this.emit(or.CONNECTION_STATE_CHANGE,t,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){y.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,i){var r,n,s;super(),D(this,"store",void 0),D(this,"joinInfo",void 0),D(this,"key",void 0),D(this,"ntpOffset",0),D(this,"signal",void 0),D(this,"role",void 0),D(this,"isPreallocation",void 0),D(this,"isPreSub",void 0),D(this,"inChannelInfo",{joinAt:null,duration:0}),D(this,"spec",void 0),D(this,"_state","DISCONNECTED"),D(this,"_statsCollector",void 0),D(this,"_disconnectedReason",void 0),D(this,"isSignalRecover",!1),D(this,"hasChangeBGPAddress",!1),D(this,"trafficStatsInterval",void 0),D(this,"networkQualityInterval",void 0),D(this,"_joinGatewayStartTime",0),D(this,"_signalTimeout",!1),D(this,"_clientRoleOptions",void 0),D(this,"_isProactiveJoin",!1),this.store=t,this.spec=i,this.signal=this.store.useP2P?(r={spec:Kr(Kr({},i),{},{retryConfig:i.websocketRetryConfig}),store:t},(n=(s=ul("P2PChannel")).createSubmodule)===null||n===void 0?void 0:n.call(s,r)):new z9(Kr(Kr({},i),{},{retryConfig:i.websocketRetryConfig}),t),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}async join(t,i,r){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let n=Date.now(),s=Jw.get(t.cname);if(s||(s=new Map,Jw.set(t.cname,s)),this._isProactiveJoin=!0,s.has(t.uid)){let h=new $(k.UID_CONFLICT);throw Fe.joinGateway(t.sid,{lts:n,succ:!1,ec:h.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),h}s.set(t.uid,!0),this.joinInfo=t,this.key=i;let c=0;this.joinGatewayStartTime=n;let l=t.proxyServer;try{y.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(c));let h=t.gatewayAddrs.map(p=>{let{address:_}=p,[E,R]=_.split(":"),N={host:E,port:R};return t.proxyServer&&(N.proxy=t.proxyServer),N});c=(await this.signal.init(h)).uid,y.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(c," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(h){var d;throw y.error("[".concat(this.store.clientId,"] User join failed"),h.toString()),Fe.joinGateway(t.sid,{lts:n,succ:!1,ec:((d=h.data)===null||d===void 0?void 0:d.desc)||h.code,errorMsg:h.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!l,signalChannel:"0",preload:t.preload}),s.delete(t.uid),this.signal.close(),h}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),y.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(h=>{y.warning("[".concat(this.store.clientId,"] get traffic stats error"),h.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(or.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(or.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(or.NETWORK_QUALITY,{uplinkNetworkQuality:EM(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:EM(this._statsCollector.trafficStats.B_dnq)}):this.emit(or.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),c}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==Bt.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==ni.CONNECTED||await(function(r,n){return n===1/0?r:we.race([r,S8(n)])})(this.signal.request(Je.LEAVE,void 0,!0),3e3)}catch(r){y.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(i),i!==Bt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,i,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new $(k.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let n={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:U("PUB_EXTEND"),twcc:!!U("PUBLISH_TWCC"),rtx:!!U("USE_PUB_RTX")};try{return(await this.signal.request(Je.PUBLISH,n,!0))._message}catch(s){if(r&&s.data&&s.data.code===Ke.ERR_PUBLISH_REQUEST_INVALID)return y.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(t,i),this.publish(t,i,!1);throw s}}async publishDataChannel(t,i,r){var n;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new $(k.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let s={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(n=i.maxRetransmits)!==null&&n!==void 0?n:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(Je.PUBLISH_DATASTREAM,s,!0)}catch(c){if(r&&c.data&&c.data.code===Ke.ERR_PUBLISH_REQUEST_INVALID)return y.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),c.toString()),await this.tryUnpubDataChannelBeforeRepub(t,i),this.publishDataChannel(t,i,!1);throw c}}async unpublish(t,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new $(k.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Je.UNPUBLISH,{stream_id:i,ortc:t},!0)}catch(r){y.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new $(k.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await we.all(t.map(i=>this.signal.request(Je.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){y.warning("unpublish datachannels warning: ",i)}}async presubscribe(t,i,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new $(k.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let n={stream_id:t,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!U("SUBSCRIBE_TWCC"),rtx:!!U("USE_SUB_RTX")||void 0,extend:U("SUB_EXTEND"),svc:Array.isArray(U("SVC"))&&U("SVC").length!==0?U("SVC"):void 0};try{return await this.signal.request(Je.PRE_SUBSCRIBE,n,!0)}catch(s){if(r&&s.data&&s.data.code===Ke.ERR_SUBSCRIBE_REQUEST_INVALID)return y.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(t,i,!1);throw s}}async subscribe(t,i,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new $(k.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let n={stream_id:t,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!U("SUBSCRIBE_TWCC"),rtx:!!U("USE_SUB_RTX"),extend:U("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(U("SVC"))&&U("SVC").length!==0?U("SVC"):void 0};try{return(await this.signal.request(Je.SUBSCRIBE,n,!0))._message}catch(s){if(r&&s.data&&s.data.code===Ke.ERR_SUBSCRIBE_REQUEST_INVALID)return y.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(t,i),await this.subscribe(t,i,!1);throw s}}async subscribeDataChannel(t,i,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new $(k.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let n={uid:t,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(Je.SUBSCRIBE_DATASTREAM,n,!0)}catch(s){if(r&&s.data&&s.data.code===Ke.ERR_SUBSCRIBE_REQUEST_INVALID)return y.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(t,i),await this.subscribeDataChannel(t,i,!1);throw s}}async subscribeAll(t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new $(k.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!U("USE_SUB_RTX"),twcc:!!U("SUBSCRIBE_TWCC"),svc:Array.isArray(U("SVC"))&&U("SVC").length!==0?U("SVC"):void 0};try{return await this.signal.request(Je.SUBSCRIBE_STREAMS,r,!0)}catch(n){if(i&&n.data&&n.data.code===Ke.ERR_SUBSCRIBE_REQUEST_INVALID)return y.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),n.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw n}}async setVideoProfile(t){let i=(function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let n=r.frameRate,s=r.width,c=r.height,l=!0;return typeof n!="number"&&(n=n.exact||n.ideal||n.max||n.min||0,n||(l=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(l=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,n||(l=!1)),l?{stream_type:0,width:s,height:c,fps:n,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0})(t);if(i)return this.signal.request(Je.SET_VIDEO_PROFILE,i);y.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,i){try{await this.signal.request(Je.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:i},!0)}catch(r){y.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(t,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new $(k.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await we.all(t.map(r=>this.signal.request(Je.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:i},!0)))}catch(r){y.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(t){try{await this.signal.request(Je.UNSUBSCRIBE_STREAMS,t,!0)}catch(i){y.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(t){let{iceParameters:i,dtlsParameters:r,rtpCapabilities:n}=t;return{gatewayEstablishParams:await this.signal.request(Je.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:r,rtpCapabilities:n}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Je.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Je.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,i){i&&(this._clientRoleOptions=Object.assign({},i)),U("CLIENT_ROLE_OPTIONS")&&(y.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(U("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},U("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),U("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},U("CLIENT_ROLE_OPTIONS")),y.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(U("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let r,n=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,n=1):n=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:n=0;let s=Object.assign({},i);delete s.delay,delete s.level,await this.signal.request(Je.SET_CLIENT_ROLE,Kr(Kr({role:t,level:n,delay:r},s),{},{client_ts:Date.now()})),this.role=t}async setRemoteVideoStreamType(t,i){await this.signal.request(Je.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:i})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Je.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,i){await this.signal.request(Je.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:i})}async pickSVCLayer(t,i){await this.signal.request(Je.PICK_SVC_LAYER,{stream_id:t,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(t){await this.signal.request(Je.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,i,r){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,i,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Kr({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Je.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let t=Jw.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let t=(function(i){let r;return r=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:br.username,password:br.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null})((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Kr(Kr({},br),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;let t=await this.signal.request(Je.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(i=>{let r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(n=>n.peer_uid===i.peer_uid);r&&r.B_st!==i.B_st&&rR(()=>{this.emit(or.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var i,r;if(!this.joinInfo||!this.key)throw new $(k.UNEXPECTED_ERROR,"can not generate join message, no join info");let n=Object.assign({},this.joinInfo.apResponse),s=U("REPORT_APP_SCENARIO");if(typeof s!="string")try{s=JSON.stringify(s)}catch{s=void 0}var c;s&&s.length>128&&(s=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(or.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,ve(pm).call(pm,c)||pm.push(c);let l=uw(this.store),d=!((i=this.isPreallocation)===null||i===void 0||!i.call(this)),h=jL(this.store),p=Y9(),_=qf(87)||XP()||BA(117),E=((function(){let N=Ct();if(N.name!==Pt.SAFARI||!N.browserVersion)return!1;let w=N.browserVersion.split(".");return Number(w[0])>18||Number(w[0])===18&&Number(w[1])>=4})()||$P(18,4,!1))&&jA(18,6,!0)&&this.spec.codec==="h264"&&U("ENABLE_ABSSENDTIME_AS_SENTTS"),R=Kr({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Fa,browser:navigator.userAgent,process_id:U("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:U("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:Kr(Kr({enableEncodedTransform:(!!U("ENABLE_AUDIO_METADATA")||!!U("ENABLE_AUDIO_PTS"))&&_||!!U("ENABLE_AUDIO_TOPN")&&UA(Pt.CHROME,87,116)||void 0,enableAudioMetadata:!!U("ENABLE_AUDIO_METADATA")&&_,enableAudioPts:!!U("ENABLE_AUDIO_PTS")&&_,topnSmoothLevel:U("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:U("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:U("TOPN_SWITCH_HOLD_MS"),topnAudioGain:U("TOPN_AUDIO_GAIN"),enablePublishedUserList:U("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:U("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:ya("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:ya("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:ya("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:U("USE_PUB_RTX")===!0||U("USE_SUB_RTX")===!0||void 0,disableFEC:U("DISABLE_FEC"),enableNTPReport:!!U("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:h,enableFulllinkAvSync:!!U("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:ya("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!U("FORCE_ENABLE_AUT_CC")||!dR()&&(!!U("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!U("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:ya("USE_XR","boolean"),enableLossbasedBwe:ya("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!U("FORCE_ENABLE_AUT_CC")||!dR()&&(!!U("ENABLE_AUT_CC")||void 0),enableCCFallback:ya("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:d,preSubNum:l?ya("PRE_SUB_NUM","number"):void 0,enablePubTWCC:ya("PUBLISH_TWCC","boolean"),enableSubTWCC:ya("SUBSCRIBE_TWCC","boolean"),enablePubRTX:ya("USE_PUB_RTX","boolean"),enableSubRTX:ya("USE_SUB_RTX","boolean"),enableSubSVC:U("ENABLE_SVC")?U("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(U("SVC"))&&U("SVC").length!==0?U("SVC"):void 0,enableSvcExtended:U("ENABLE_SVC")&&Array.isArray(U("SVC_EXTENDED"))&&U("SVC_EXTENDED").length!==0?U("SVC_EXTENDED"):void 0},p),{},{audioDuplicate:ya("ENABLE_AUDIO_RED","boolean")?(r=ya("AUDIO_DUPLICATE_NUM","number"))!==null&&r!==void 0?r:2:void 0,senttsUsesAbsSendTime:!!E||void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(R.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(R.aes_mode=this.joinInfo.aesmode,U("ENCRYPT_AES")?(R.aes_secret=this.joinInfo.aespassword,R.aes_encrypt=!0):R.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(R.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(R.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(R.default_video_stream=this.joinInfo.defaultVideoStream),R}getRejoinMessage(){if(!this.joinInfo)throw new $(k.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(nt.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(nt.WS_RECONNECTING,t=>{this.joinInfo&&Fe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||yr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Fe.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(nt.WS_CLOSED,t=>{let i;switch(t){case Bt.LEAVE:i=yr.LEAVE;break;case Bt.UID_BANNED:case Bt.IP_BANNED:case Bt.CHANNEL_BANNED:case Bt.SERVER_ERROR:i=yr.SERVER_ERROR;break;case Bt.FALLBACK:i=yr.FALLBACK;break;case Bt.LICENSE_MISSING:case Bt.LICENSE_EXPIRED:case Bt.LICENSE_MINUTES_EXCEEDED:case Bt.LICENSE_PERIOD_INVALID:case Bt.LICENSE_MULTIPLE_SDK_SERVICE:case Bt.LICENSE_ILLEGAL:case Bt.TOKEN_EXPIRE:i=t;break;default:i=yr.NETWORK_ERROR}y.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+yr.NETWORK_ERROR)),this.joinInfo&&Fe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Bt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=t,t!==Bt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(nt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){let t=U("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(y.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(Fe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){let t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void y.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));Ht("EVENT_REPORT_DOMAIN",t[1]),Ht("EVENT_REPORT_BACKUP_DOMAIN",t[1]),Ht("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(vt.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(nt.REQUEST_RECOVER,(t,i,r)=>{if(!this.joinInfo)return r(new $(k.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Cr(this,or.REQUEST_NEW_GATEWAY_LIST).then(i).catch(r)}),this.signal.on(nt.REQUEST_JOIN_INFO,async(t,i,r)=>{var n,s,c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));let l=fi((n=this.joinInfo)===null||n===void 0?void 0:n.turnServer);if(U("NEW_TURN_MODE")&&l&&((s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer)==="disabled"){var d;let E=l.servers.map(w=>"turnServerURL"in w&&U("USE_TURN_IP")?Kr(Kr({},w),{},{turnServerURL:PR(w.turnServerURL)}):w),R=(d=l.serversFromGateway)===null||d===void 0?void 0:d.map(w=>U("USE_TURN_IP")?Kr(Kr({},w),{},{turnServerURL:PR(w.turnServerURL)}):w),N=this.signal.currentURLIndex;E.length>0&&(E=[E[N%E.length]],l.servers=E),Array.isArray(R)&&R.length>0&&(R=[R[0]],l.serversFromGateway=R),y.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(N))}let{iceParameters:h,dtlsParameters:p,rtpCapabilities:_}=await Cr(this,or.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:l,cloudProxyServer:(c=this.joinInfo)===null||c===void 0?void 0:c.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:p,rtpCapabilities:_,version:"2"}}))}catch(E){i(E)}}),this.signal.on(nt.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(nt.REPORT_JOIN_GATEWAY,(t,i)=>{if(!this.joinInfo)return;let r,n="";var s;t instanceof $?(r=((s=t.data)===null||s===void 0?void 0:s.desc)||t.code,n=t.message):r=t,Fe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:n,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(nt.IS_P2P_DISCONNECTED,t=>{t(Ag(this,or.IS_P2P_DISCONNECTED))}),this.signal.on(nt.DISCONNECT_P2P,()=>{this.emit(or.DISCONNECT_P2P)}),this.signal.on(nt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(nt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(nt.JOIN_RESPONSE,t=>{let i=this.getCurrentGatewayAddress();this.emit(or.JOIN_RESPONSE,t,i)}),this.signal.on(nt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var t,i;this.updateTurnConfigFromSignal();let n=this.getCurrentGatewayAddress(),s=fi((t=this.joinInfo)===null||t===void 0?void 0:t.turnServer);if(U("NEW_TURN_MODE")&&s&&((i=this.joinInfo)===null||i===void 0?void 0:i.cloudProxyServer)==="disabled"){var r;let l=s.servers.map(p=>"turnServerURL"in p&&U("USE_TURN_IP")?Kr(Kr({},p),{},{turnServerURL:PR(p.turnServerURL)}):p),d=(r=s.serversFromGateway)===null||r===void 0?void 0:r.map(p=>U("USE_TURN_IP")?Kr(Kr({},p),{},{turnServerURL:PR(p.turnServerURL)}):p),h=this.signal.currentURLIndex;l.length>0&&(l=[l[h%l.length]],s.servers=l),Array.isArray(d)&&d.length>0&&(d=[d[0]],s.serversFromGateway=d),y.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(h,",in pre pc"))}let c=U("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(n&&c){let l=bM(n);this.emit(or.PRE_CONNECT_PC,{candidates:l,fingerprint:c,turnServer:s})}}}),this.signal.on(nt.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof U("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(U("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,i){try{await this.signal.request(Je.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[i]},!0)}catch(r){throw y.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(t,i){try{await this.signal.request(Je.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(r){throw y.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(t,i){try{await this.signal.request(Je.UNPUBLISH,{stream_id:t,ortc:i},!0)}catch(r){throw y.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(t,i){try{await this.signal.request(Je.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(r){throw y.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(t){let i={users:t.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{await this.signal.request(Je.UNSUBSCRIBE_STREAMS,i,!0)}catch(r){throw y.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(t,i){let r={action:t.find(n=>n.stream_type===Ft.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:i};try{await this.signal.request(Je.CONTROL,r,!0,!0)}catch(n){throw y.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),n),n}}async unmuteLocal(t,i){let r={action:t.find(n=>n.stream_type===Ft.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:i};try{await this.signal.request(Je.CONTROL,r,!0,!0)}catch(n){throw y.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),n),n}}async muteRemote(t,i){let r={action:t===Le.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Je.CONTROL,r,!0,!0)}catch(n){throw y.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),n),n}}async unmuteRemote(t,i){let r={action:t===Le.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Je.CONTROL,r,!0,!0)}catch(n){throw y.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),n),n}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,i){this.signal.upload(t,i)}getSignalRTT(){return this.signal.rtt}async restartICE(t){let i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Je.RESTART_ICE,i,!0)}catch(r){throw y.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(t,i){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,i||yr.P2P_FAILED)}getCurrentGatewayAddress(){var t,i;if(!U("GATEWAY_WSS_ADDRESS"))return U("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(y.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Je.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}}let BR=0,Zw=0;function lo(e,t,i,r){return new we((n,s)=>{t.timeout=t.timeout||U("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!i?(t.data=JSON.stringify(t.data),BR+=ec(t.data)):i&&(t.data.size?BR+=t.data.size:t.data instanceof FormData?BR+=mL(t.data):BR+=ec(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Tn.request(t).then(c=>{typeof c.data=="string"?Zw+=ec(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?Zw+=c.data.byteLength:Zw+=ec(JSON.stringify(c.data)),r&&n({data:c.data,headers:c.headers}),n(c.data)}).catch(c=>{Tn.isCancel(c)?s(new $(k.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?s(new $(k.NETWORK_TIMEOUT,c.message)):c.response?s(new $(k.NETWORK_RESPONSE_ERROR,c.response.status)):s(new $(k.NETWORK_ERROR,c.message))})})}(function(){var e;function t(de){var ye=0;return function(){return ye<de.length?{done:!1,value:de[ye++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(de,ye,ke){return de==Array.prototype||de==Object.prototype||(de[ye]=ke.value),de},r,n=(function(de){de=[typeof globalThis=="object"&&globalThis,de,typeof window=="object"&&window,typeof self=="object"&&self,typeof S=="object"&&S];for(var ye=0;ye<de.length;++ye){var ke=de[ye];if(ke&&ke.Math==Math)return ke}throw Error("Cannot find global object")})(this);function s(de,ye){if(ye)e:{var ke=n;de=de.split(".");for(var fe=0;fe<de.length-1;fe++){var A=de[fe];if(!(A in ke))break e;ke=ke[A]}(ye=ye(fe=ke[de=de[de.length-1]]))!=fe&&ye!=null&&i(ke,de,{configurable:!0,writable:!0,value:ye})}}function c(de){return(de={next:de})[Symbol.iterator]=function(){return this},de}function l(de){var ye=typeof Symbol<"u"&&Symbol.iterator&&de[Symbol.iterator];return ye?ye.call(de):{next:t(de)}}if(s("Symbol",function(de){function ye(A,F){this.A=A,i(this,"description",{configurable:!0,writable:!0,value:F})}if(de)return de;ye.prototype.toString=function(){return this.A};var ke="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",fe=0;return function A(F){if(this instanceof A)throw new TypeError("Symbol is not a constructor");return new ye(ke+(F||"")+"_"+fe++,F)}}),s("Symbol.iterator",function(de){if(de)return de;de=Symbol("Symbol.iterator");for(var ye="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ke=0;ke<ye.length;ke++){var fe=n[ye[ke]];typeof fe=="function"&&typeof fe.prototype[de]!="function"&&i(fe.prototype,de,{configurable:!0,writable:!0,value:function(){return c(t(this))}})}return de}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var d;e:{var h={};try{h.__proto__={a:!0},d=h.a;break e}catch{}d=!1}r=d?function(de,ye){if(de.__proto__=ye,de.__proto__!==ye)throw new TypeError(de+" is not extensible");return de}:null}var p=r;function _(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function E(de){if(de.m)throw new TypeError("Generator is already running");de.m=!0}function R(de,ye){return de.h=3,{value:ye}}function N(de){this.g=new _,this.G=de}function w(de,ye,ke,fe){try{var A=ye.call(de.g.j,ke);if(!(A instanceof Object))throw new TypeError("Iterator result "+A+" is not an object");if(!A.done)return de.g.m=!1,A;var F=A.value}catch(K){return de.g.j=null,de.g.s(K),O(de)}return de.g.j=null,fe.call(de.g,F),O(de)}function O(de){for(;de.g.h;)try{var ye=de.G(de.g);if(ye)return de.g.m=!1,{value:ye.value,done:!1}}catch(ke){de.g.v=void 0,de.g.s(ke)}if(de.g.m=!1,de.g.l){if(ye=de.g.l,de.g.l=null,ye.F)throw ye.D;return{value:ye.return,done:!0}}return{value:void 0,done:!0}}function L(de){this.next=function(ye){return de.o(ye)},this.throw=function(ye){return de.s(ye)},this.return=function(ye){return(function(ke,fe){E(ke.g);var A=ke.g.j;return A?w(ke,"return"in A?A.return:function(F){return{value:F,done:!0}},fe,ke.g.return):(ke.g.return(fe),O(ke))})(de,ye)},this[Symbol.iterator]=function(){return this}}function M(de,ye){return ye=new L(new N(ye)),p&&de.prototype&&p(ye,de.prototype),ye}if(_.prototype.o=function(de){this.v=de},_.prototype.s=function(de){this.l={D:de,F:!0},this.h=this.C||this.u},_.prototype.return=function(de){this.l={return:de},this.h=this.u},N.prototype.o=function(de){return E(this.g),this.g.j?w(this,this.g.j.next,de,this.g.o):(this.g.o(de),O(this))},N.prototype.s=function(de){return E(this.g),this.g.j?w(this,this.g.j.throw,de,this.g.o):(this.g.s(de),O(this))},s("Array.prototype.entries",function(de){return de||function(){return(function(ye,ke){ye instanceof String&&(ye+="");var fe=0,A=!1,F={next:function(){if(!A&&fe<ye.length){var K=fe++;return{value:ke(K,ye[K]),done:!1}}return A=!0,{done:!0,value:void 0}}};return F[Symbol.iterator]=function(){return F},F})(this,function(ye,ke){return[ye,ke]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var B=function(de,ye){for(var ke=0;ke<de.length;ke++)ye(de[ke])},Y=function(de){return de.replace(/\r?\n|\r/g,`\r
`)},H=function(de,ye,ke){return ye instanceof Blob?(ke=ke!==void 0?ke+"":typeof ye.name=="string"?ye.name:"blob",ye.name===ke&&Object.prototype.toString.call(ye)!=="[object Blob]"||(ye=new File([ye],ke)),[String(de),ye]):[String(de),String(ye)]},G=function(de,ye){if(de.length<ye)throw new TypeError(ye+" argument required, but only "+de.length+" present.")},Q=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,ce=Q.FormData,he=Q.XMLHttpRequest&&Q.XMLHttpRequest.prototype.send,Se=Q.Request&&Q.fetch,ht=Q.navigator&&Q.navigator.sendBeacon,pt=Q.Element&&Q.Element.prototype,tt=Q.Symbol&&Symbol.toStringTag;tt&&(Blob.prototype[tt]||(Blob.prototype[tt]="Blob"),"File"in Q&&!File.prototype[tt]&&(File.prototype[tt]="File"));try{new File([],"")}catch{Q.File=function(de,ye,ke){return de=new Blob(de,ke||{}),Object.defineProperties(de,{name:{value:ye},lastModified:{value:+(ke&&ke.lastModified!==void 0?new Date(ke.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),tt&&Object.defineProperty(de,tt,{value:"File"}),de}}var xt=function(de){return de.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Lt=function(de){this.i=[];var ye=this;de&&B(de.elements,function(ke){if(ke.name&&!ke.disabled&&ke.type!=="submit"&&ke.type!=="button"&&!ke.matches("form fieldset[disabled] *"))if(ke.type==="file"){var fe=ke.files&&ke.files.length?ke.files:[new File([],"",{type:"application/octet-stream"})];B(fe,function(A){ye.append(ke.name,A)})}else ke.type==="select-multiple"||ke.type==="select-one"?B(ke.options,function(A){!A.disabled&&A.selected&&ye.append(ke.name,A.value)}):ke.type==="checkbox"||ke.type==="radio"?ke.checked&&ye.append(ke.name,ke.value):(fe=ke.type==="textarea"?Y(ke.value):ke.value,ye.append(ke.name,fe))})};if((e=Lt.prototype).append=function(de,ye,ke){G(arguments,2),this.i.push(H(de,ye,ke))},e.delete=function(de){G(arguments,1);var ye=[];de=String(de),B(this.i,function(ke){ke[0]!==de&&ye.push(ke)}),this.i=ye},e.entries=function de(){var ye,ke=this;return M(de,function(fe){if(fe.h==1&&(ye=0),fe.h!=3)return ye<ke.i.length?fe=R(fe,ke.i[ye]):(fe.h=0,fe=void 0),fe;ye++,fe.h=2})},e.forEach=function(de,ye){G(arguments,1);for(var ke=l(this),fe=ke.next();!fe.done;fe=ke.next()){var A=l(fe.value);fe=A.next().value,A=A.next().value,de.call(ye,A,fe,this)}},e.get=function(de){G(arguments,1);var ye=this.i;de=String(de);for(var ke=0;ke<ye.length;ke++)if(ye[ke][0]===de)return ye[ke][1];return null},e.getAll=function(de){G(arguments,1);var ye=[];return de=String(de),B(this.i,function(ke){ke[0]===de&&ye.push(ke[1])}),ye},e.has=function(de){G(arguments,1),de=String(de);for(var ye=0;ye<this.i.length;ye++)if(this.i[ye][0]===de)return!0;return!1},e.keys=function de(){var ye,ke,fe,A,F=this;return M(de,function(K){if(K.h==1&&(ye=l(F),ke=ye.next()),K.h!=3)return ke.done?void(K.h=0):(fe=ke.value,A=l(fe),R(K,A.next().value));ke=ye.next(),K.h=2})},e.set=function(de,ye,ke){G(arguments,2),de=String(de);var fe=[],A=H(de,ye,ke),F=!0;B(this.i,function(K){K[0]===de?F&&(F=!fe.push(A)):fe.push(K)}),F&&fe.push(A),this.i=fe},e.values=function de(){var ye,ke,fe,A,F=this;return M(de,function(K){if(K.h==1&&(ye=l(F),ke=ye.next()),K.h!=3)return ke.done?void(K.h=0):(fe=ke.value,(A=l(fe)).next(),R(K,A.next().value));ke=ye.next(),K.h=2})},Lt.prototype._asNative=function(){for(var de=new ce,ye=l(this),ke=ye.next();!ke.done;ke=ye.next()){var fe=l(ke.value);ke=fe.next().value,fe=fe.next().value,de.append(ke,fe)}return de},Lt.prototype._blob=function(){var de="----formdata-polyfill-"+Math.random(),ye=[],ke="--"+de+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(fe,A){return typeof fe=="string"?ye.push(ke+xt(Y(A))+`"\r
\r
`+Y(fe)+`\r
`):ye.push(ke+xt(Y(A))+'"; filename="'+xt(fe.name)+`"\r
Content-Type: `+(fe.type||"application/octet-stream")+`\r
\r
`,fe,`\r
`)}),ye.push("--"+de+"--"),new Blob(ye,{type:"multipart/form-data; boundary="+de})},Lt.prototype[Symbol.iterator]=function(){return this.entries()},Lt.prototype.toString=function(){return"[object FormData]"},pt&&!pt.matches&&(pt.matches=pt.matchesSelector||pt.mozMatchesSelector||pt.msMatchesSelector||pt.oMatchesSelector||pt.webkitMatchesSelector||function(de){for(var ye=(de=(this.document||this.ownerDocument).querySelectorAll(de)).length;0<=--ye&&de.item(ye)!==this;);return-1<ye}),tt&&(Lt.prototype[tt]="FormData"),he){var Vr=Q.XMLHttpRequest.prototype.setRequestHeader;Q.XMLHttpRequest.prototype.setRequestHeader=function(de,ye){Vr.call(this,de,ye),de.toLowerCase()==="content-type"&&(this.B=!0)},Q.XMLHttpRequest.prototype.send=function(de){de instanceof Lt?(de=de._blob(),this.B||this.setRequestHeader("Content-Type",de.type),he.call(this,de)):he.call(this,de)}}Se&&(Q.fetch=function(de,ye){return ye&&ye.body&&ye.body instanceof Lt&&(ye.body=ye.body._blob()),Se.call(this,de,ye)}),ht&&(Q.navigator.sendBeacon=function(de,ye){return ye instanceof Lt&&(ye=ye._asNative()),ht.call(this,de,ye)}),Q.FormData=Lt}})();let Hg=()=>{let e=U("AREAS");return e.length===0&&e.push(Mt.GLOBAL),In(e).call(e,(t,i,r)=>{let n=VM(i);return n?r===0?n:"".concat(t,",").concat(n):t},"")},VM=e=>e===Mt.OVERSEA?"".concat(Mr.ASIA,",").concat(Mr.EUROPE,",").concat(Mr.AFRICA,",").concat(Mr.NORTH_AMERICA,",").concat(Mr.SOUTH_AMERICA,",").concat(Mr.OCEANIA):Mr[e],X9=e=>{let t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(i=>{let r=NR[i],n=Object.keys(r);n&&n.map(s=>{s!=="CODE"&&(t[s]=t[s].concat(r[s]))})}),t},jR={GLOBAL:{ASIA:[Mt.CHINA,Mt.JAPAN,Mt.INDIA,Mt.KOREA,Mt.HKMC],EUROPE:[],NORTH_AMERICA:[Mt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},FR=Object.keys(jR[Mt.GLOBAL]),Qw=[Mt.CHINA,Mt.NORTH_AMERICA,Mt.EUROPE,Mt.ASIA,Mt.JAPAN,Mt.INDIA,Mt.OCEANIA,Mt.SOUTH_AMERICA,Mt.AFRICA,Mt.KOREA,Mt.HKMC,Mt.US],J9=function(e,t){let i=[];if(ve(e).call(e,Mt.GLOBAL)){let s=[Mt.GLOBAL,Mt.OVERSEA],c=Object.keys(NR);if(t===Mt.GLOBAL)throw new $(k.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Mt.CHINA)i=[Mt.OVERSEA];else if(n=t,ve(FR).call(FR,n)){let l=(r=t,jR[Mt.GLOBAL][r]||[]),d=[...s,t,...l];i=c.filter(h=>!ve(d).call(d,h))}else if((function(l){let d=!1;return FR.forEach(h=>{var p;ve(p=jR[Mt.GLOBAL][h]).call(p,l)&&(d=!0)}),d})(t)){let l=(function(h){let p;return FR.forEach(_=>{var E;ve(E=jR[Mt.GLOBAL][_]).call(E,h)&&(p=_)}),p})(t),d=[...s,l,t];i=c.filter(h=>!ve(d).call(d,h))}else i=e;i=(function(l){let d=[];return Qw.forEach(h=>{ve(l).call(l,h)&&d.push(h)}),d.concat(l.filter(h=>!ve(Qw).call(Qw,h)))})(i)}else i=e;var r,n;return i};function BM(e){var t,i;if(!e&&ve(t=U("AREAS")).call(t,Mt.EXTENSIONS))return y.debug("update area from ap : reset"),void $w(n9,!0);if(!ve(i=U("AREAS")).call(i,Mt.GLOBAL)||!e)return;let r=NR.EXTENSIONS;r&&(r={CODE:VM(Mt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},y.debug("update area from ap success: ".concat(e,",config is "),r),Ht("AREAS",[Mt.EXTENSIONS],!0),Object.keys(r).map(n=>{n==="LOG_UPLOAD_SERVER"||n==="EVENT_REPORT_DOMAIN"||n==="EVENT_REPORT_BACKUP_DOMAIN"||n==="PROXY_SERVER_TYPE3"?Ht(n,r[n][0]):Ht(n,r[n])}))}function $w(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=Fe.reportApiInvoke(null,{name:Oi.SET_AREA,options:e,tag:pi.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach(s=>{if(!ve(sM).call(sM,s))throw new $(k.INVALID_PARAMS,"invalid area code")}),r=e),Object.prototype.toString.call(e)==="[object Object]"){let{areaCode:s,excludedArea:c}=e;if(!s)throw new $(k.INVALID_PARAMS,"area code is needed");let l=s;typeof s=="string"&&(l=[s]),r=c?J9(l,c):l}if(!t){if(ao.AREAS){let s=new $(k.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(s),void y.warning("setArea is prohibited because of config-distribute")}if(ve(r).call(r,Mt.GLOBAL)&&U("AREAS")===Mt.EXTENSIONS){let s=new $(k.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(s),void y.warning("setArea is prohibited because of ap extensions")}}Ht("AREAS",r,t);let n=X9(r);Object.keys(n).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?Ht(s,n[s][0]):Ht(s,n[s])}),y.debug("set area success:",r.join(","))}catch(r){throw i.onError(r),r}i.onSuccess()}function jM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function sc(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?jM(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):jM(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let eI=1;function Z9(e,t,i,r,n){eI+=1;let s={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:eI,requestId:eI,version:Fa,cname:i.cname},c={service_name:t,json_body:JSON.stringify(s)},l,d,h=e[0];return no(async()=>{l=Date.now();let p=await lo(h,{data:c,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(d=Date.now()-l,p.code!==0){let R=new $(k.UNEXPECTED_RESPONSE,"live streaming ap error, code"+p.code,{retry:!0,responseTime:d});throw y.error(R.toString()),R}let _=JSON.parse(p.json_body);if(_.code!==200){let R=new $(k.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(_.code,", reason: ").concat(_.reason),{code:_.code,responseTime:d});throw y.error(R.toString()),R}if(!_.servers||_.servers.length===0){let R=new $(k.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:_.code,responseTime:d});throw y.error(R.toString()),R}let E=(function(R,N){return{addressList:R.servers.map(w=>"wss://".concat(w.address.replace(/\./g,"-"),".").concat(U("WORKER_DOMAIN"),":").concat(w.wss,"?serviceName=").concat(encodeURIComponent(N))),workerToken:R.workerToken,vid:R.vid}})(_,t);return U("LIVE_STREAMING_ADDRESS")&&(E.addressList=U("LIVE_STREAMING_ADDRESS")instanceof Array?U("LIVE_STREAMING_ADDRESS"):[U("LIVE_STREAMING_ADDRESS")]),sc(sc({},E),{},{responseTime:d})},(p,_)=>(Fe.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(p.addressList),firstSuccess:_===0,responseTime:d,serverIp:e[_%e.length]}),!1),(p,_)=>(Fe.apworkerEvent(i.sid,{success:!1,sc:p.data&&p.data.code||200,serviceName:t,responseTime:d,serverIp:e[_%e.length]}),!!(p.code!==k.OPERATION_ABORTED&&p.code!==k.UNEXPECTED_RESPONSE||p.data&&p.data.retry)&&(h=e[(_+1)%e.length],!0)),n)}let tI=1;function FM(e,t,i,r){let{url:n,areaCode:s}=e,{clientId:c,sid:l}=t,d=Date.now(),h,p=t.role,[_,E]=rI(t,s,[ji.CHOOSE_SERVER]),R=Bi.networkState;return no(async()=>{R&&Bi.networkState===$n.OFFLINE&&Bi.onlineWaiter&&await we.race([Bi.onlineWaiter,fr(r&&r.maxRetryTimeout||Wi.maxRetryTimeout)]),R=Bi.networkState;let{data:N,headers:w}=await lo(n,{data:_,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=w.http3==="1"?1:-1,Fe.reportResourceTiming(n,l),HM(N,n,t,d,[ji.CHOOSE_SERVER],h);let O=Bg(N,ji.CHOOSE_SERVER);return iI(O),Kw(O,n)},N=>(N&&Fe.joinChooseServer(l,{role:p,lts:d,succ:!0,csAddr:n,opid:E,serverList:N.gatewayAddrs.map(w=>w.address),ec:null,cid:N.cid.toString(),uid:N.uid.toString(),csIp:N.csIp,unilbsServerIds:[ji.CHOOSE_SERVER].toString(),isHttp3:h,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:N.res.detail&&N.res.detail[38]}),!1),N=>N.code!==k.OPERATION_ABORTED&&(N.code===k.CAN_NOT_GET_GATEWAY_SERVER?N.data.retry:(Fe.joinChooseServer(l,{role:p,lts:d,succ:!1,csAddr:n,serverList:null,opid:E,ec:N.code,csIp:N.data&&N.data.csIp,unilbsServerIds:[ji.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:R}),isHttp3:h,corssRegionTagReq:t.apRequestDetail}),y.warning("[".concat(c||"sid-".concat(l.slice(0,6)),"] Choose server network error, retry"),N),!0)),r)}function GM(e,t,i,r){let n,{url:s,areaCode:c,serviceIds:l}=e,d=Date.now(),h=t.role,[p,_]=rI(t,c,l),E;return no(async()=>{E&&Bi.networkState===$n.OFFLINE&&Bi.onlineWaiter&&await we.race([Bi.onlineWaiter,fr(r&&r.maxRetryTimeout||Wi.maxRetryTimeout)]),E=Bi.networkState;let{data:R,headers:N}=await lo(s,{data:p,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);n=N.http3==="1"?1:-1,Fe.reportResourceTiming(s,t.sid),HM(R,s,t,d,l,n);let w=Bg(R,ji.CHOOSE_SERVER),O=Bg(R,t.cloudProxyServer==="proxy5"?ji.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?ji.CLOUD_PROXY:ji.CLOUD_PROXY_FALLBACK),L=performance.getEntriesByName(s),M=L[L.length-1],B;return M&&(B={name:M.name,protocol:"nextHopProtocol"in M?M.nextHopProtocol:"",dnscost:"domainLookupEnd"in M&&"domainLookupStart"in M&&typeof M.domainLookupEnd=="number"&&typeof M.domainLookupStart=="number"?M.domainLookupEnd-M.domainLookupStart:-1,tcpTlsCost:"connectEnd"in M&&"connectStart"in M&&typeof M.connectEnd=="number"&&typeof M.connectStart=="number"?M.connectEnd-M.connectStart:-1,reqCost:"requestStart"in M&&typeof M.requestStart=="number"&&"responseEnd"in M&&typeof M.responseEnd=="number"?M.responseEnd-M.requestStart:-1,handleCost:"leave_ts"in R&&"enter_ts"in R&&typeof R.leave_ts=="number"&&typeof R.enter_ts=="number"?R.leave_ts-R.enter_ts:-1}),iI(w),{gatewayInfo:Kw(w,s),proxyInfo:O,url:s,resourceTimingInfo:B}},R=>(R.gatewayInfo&&Fe.joinChooseServer(t.sid,{role:h,lts:d,succ:!0,csAddr:s,serverList:R.gatewayInfo.gatewayAddrs.map(N=>N.address),ec:null,opid:_,cid:R.gatewayInfo.cid.toString(),uid:R.gatewayInfo.uid.toString(),csIp:R.gatewayInfo.csIp,unilbsServerIds:l.toString(),isHttp3:n,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:R.gatewayInfo.res.detail&&R.gatewayInfo.res.detail[38],resourceTimingInfo:R.resourceTimingInfo?JSON.stringify(R.resourceTimingInfo):void 0}),R.proxyInfo&&Fe.joinWebProxyAP(t.sid,{lts:d,sucess:1,apServerAddr:s,turnServerAddrList:R.proxyInfo.addresses.map(N=>N.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:l.toString()}),!1),R=>R.code!==k.OPERATION_ABORTED&&(R.code===k.CAN_NOT_GET_GATEWAY_SERVER?R.data.retry:(Fe.joinWebProxyAP(t.sid,{lts:d,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:R.code,eventType:t.cloudProxyServer,unilbsServerIds:l.toString(),extend:JSON.stringify({networkState:E})}),y.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),R),!0)),r)}let HM=(e,t,i,r,n,s)=>{let{sid:c,clientId:l,cloudProxyServer:d}=i,h=[],p=_=>{_.flag===4096?Fe.joinChooseServer(c,{role:i.role,lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:_.error.message,csIp:_.error.data&&_.error.data.csIp,unilbsServerIds:n.toString(),isHttp3:s,corssRegionTagReq:i.apRequestDetail}):_.flag!==1048576&&_.flag!==4194304&&_.flag!==4194310||Fe.joinWebProxyAP(c,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:_.error.code,eventType:d,unilbsServerIds:n.toString()})};if(e.response_body.forEach(_=>{let E=_.buffer.code;if(_.uri===23&&E===0&&!_.buffer.edges_services)if(_.buffer.flag===4194310)y.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),_.buffer.edges_services=[];else{let R={error:new $(k.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:_.buffer.flag};h.push(R),p(R)}if(E!==0){let R=Em(E),N={error:new $(k.CAN_NOT_GET_GATEWAY_SERVER,R.desc,{desc:R.desc,retry:R.retry,csIp:e.detail[502]}),flag:_.buffer.flag};_.buffer.flag===4194310?y.warning(N.error.toString()):h.push(N),p(N)}}),h.length)throw y.warning("[".concat(l||"sid-".concat(c.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(h.map(_=>"flag: ".concat(_.flag,", message: ").concat(_.error.message,", retry: ").concat(_.error.data.retry)).join(" | "))),new $(k.CAN_NOT_GET_GATEWAY_SERVER,h.map(_=>"flag: ".concat(_.flag,", message: ").concat(_.error.message)).join(" | "),{retry:!!h.find(_=>_.error.data.retry),csIp:e.detail[502],desc:[...new Set(h.map(_=>{var E;return _==null||(E=_.error)===null||E===void 0||(E=E.data)===null||E===void 0?void 0:E.desc}).filter(_=>!!_))]})},iI=e=>{var t,i,r,n;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new $(k.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(U("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((n=e.detail)===null||n===void 0?void 0:n[23])=="string"?BM(e.detail[23].toLowerCase()):BM()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((i=e.detail)===null||i===void 0?void 0:i[19])=="string"){let c=e.detail[19],l=c?.split(";");for(let d=0;d<l.length;d++){var s;let h=Qr(s=l[d]).call(s);e.addresses[d]&&l&&(e.addresses[d].fingerprint=h)}}if(U("GATEWAY_ADDRESS")&&U("GATEWAY_ADDRESS").length>0){y.debug("assign gateway address to",U("GATEWAY_ADDRESS"));let c=U("GATEWAY_ADDRESS").map(l=>{var d,h;let p=(d=(h=e.addresses.find(_=>_.ip===l.ip&&_.port===l.port))===null||h===void 0?void 0:h.fingerprint)!==null&&d!==void 0?d:"";return{ip:l.ip,port:l.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:p}});e.addresses=c}},Q9=(e,t)=>{if(e.response_body&&e.response_body.length){let i=e.response_body[0];if(i.buffer.code!==0){let r=Em(i.buffer.code);throw new $(k.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return i.buffer.ticket}throw y.debug("update ticket request received ap response without response body:",t),new $(k.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},rI=(e,t,i)=>{let r=Math.floor(Math.random()*1e12),n=e.role==="host"?"1":e.role==="audience"?"2":void 0,s={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:sc(sc(sc({6:e.stringUid,11:t,12:U("USE_NEW_TOKEN")?"1":void 0},n?{17:n}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:i,uid:e.uid||0}}]};s.request_bodies.forEach(l=>{e.multiIP&&e.multiIP.gateway_ip&&(l.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});let c=new FormData;return c.append("request",JSON.stringify(s)),[c,r]},$9=(e,t)=>{let i=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(s=>({ip:s.ip,port:s.port}))}}]},n=new FormData;return n.append("request",JSON.stringify(r)),[n,i]},vm=0;function Rm(e){return we.all(e.map(t=>t.then(i=>{throw i},i=>i))).then(t=>{throw t},t=>t)}let Wg=async e=>{let{fragementLength:t,referenceList:i,asyncMapHandler:r,allFailedhandler:n,promisesCollector:s}=e,c=0,l=t,d,h=0,p=async()=>{let _=(()=>{let E=c*l,R=E+l;return i.slice(E,R).map(r)})();s&&s.push(..._);try{d=await Rm(_)}catch(E){if(h+=l,c++,!(h>=i.length))return void await p();n(E)}_.forEach(E=>E.cancel())};return await p(),d},WM=async e=>{let{referenceList:t,asyncMapHandler:i,closeFn:r}=e,n=t.length,s=0,c=async()=>{let l=i(t.shift());try{return await l}catch(d){if(s++,s>=n||r!=null&&r(d))throw d;return c()}};return c()};async function eG(){if(typeof VideoDecoder>"u")return!0;let e,t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],n=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],s=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],c=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new we((l,d)=>{let h;(async function(){e&&e.state!=="closed"||await(async function(){e=new VideoDecoder({output:_=>{_.close(),clearTimeout(h),l(!0)},error:_=>{clearTimeout(h),l(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})})();let p=[t,i,r,n,s,c];for(let _=0;_<p.length;_++){let E=new EncodedVideoChunk({type:_==0?"key":"delta",timestamp:33333*_,duration:33333,data:new Uint8Array(p[_])});try{await e.decode(E)}catch{return void l(!1)}}})(),h=setTimeout(()=>{l(!1)},5e3)})}async function nI(e,t,i,r){return{gatewayInfo:await(async function(n,s,c,l){let d=null,h=[],p=async()=>{let E=U("WEBCS_DOMAIN").slice(0,U("AJAX_REQUEST_CONCURRENT")).map(w=>({url:n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(w+"/api/v2/transpond/webrtc?v=2"):"https://".concat(w,"/api/v2/transpond/webrtc?v=2"),areaCode:Hg()})),R=l.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:E.map(w=>w.url)}),N=await Wg({fragementLength:U("FRAGEMENT_LENGTH"),referenceList:E,asyncMapHandler:w=>(y.debug("[".concat(n.clientId,"] Connect to choose_server:"),w.url),FM(w,n,s,c)),allFailedhandler:w=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},R),w[0]},promisesCollector:h});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},R),N},_=async()=>{if(await fr(1e3),d!==null)return d;let E=U("WEBCS_DOMAIN_BACKUP_LIST").map(w=>({url:n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(w+"/api/v2/transpond/webrtc?v=2"):"https://".concat(w,"/api/v2/transpond/webrtc?v=2"),areaCode:Hg()})),R=l.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:E.map(w=>w.url)}),N=await Wg({fragementLength:U("FRAGEMENT_LENGTH"),referenceList:E,asyncMapHandler:w=>(y.debug("[".concat(n.clientId,"] Connect to backup choose_server:"),w.url),FM(w,n,s,c)),allFailedhandler:w=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},R),w[0]},promisesCollector:h});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},R),N};try{return d=await Rm([p(),_()]),h.length&&h.forEach(E=>E.cancel&&typeof E.cancel=="function"&&E.cancel()),d}catch(E){throw E[0]}})(e,t,i,r)}}async function zM(e,t,i,r,n){let s=e.cloudProxyServer;if(s==="disabled"){if(e.useLocalAccessPoint)return await nI(e,t,i,n);if(U("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:E,proxyInfo:R}=await qM(e,t,i,n);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:E};let N=R.map(w=>({turnServerURL:w.address,tcpport:w.tcpport||br.tcpport,udpport:w.udpport||br.udpport,username:w.username||br.username,password:w.password||br.password,forceturn:!1,security:!0}));if(n.useP2P){var c;let w=(c=e.uid)!==null&&c!==void 0?c:E.uid,O="glb:".concat(w.toString()),L=await YA(O),M=R.map(B=>({turnServerURL:B.address,tcpport:B.tcpport||br.tcpport,udpport:B.udpport||br.udpport,username:O,password:L,forceturn:!1,security:!0}));N.push(...M)}return e.turnServer={mode:"manual",servers:N},{gatewayInfo:E}}return await nI(e,t,i,n)}let{proxyInfo:l,gatewayInfo:d}=await qM(e,t,i,n),h={gatewayInfo:d},p=l.map(E=>({turnServerURL:E.address,tcpport:s==="proxy3"?void 0:E.tcpport?E.tcpport:br.tcpport,udpport:s==="proxy4"?void 0:E.udpport?E.udpport:br.udpport,username:E.username||br.username,password:E.password||br.password,forceturn:s!=="proxy4",security:s==="proxy5"}));if(n.useP2P){var _;let E=(_=e.uid)!==null&&_!==void 0?_:d.uid,R="glb:".concat(E.toString()),N=await YA(R),w=l.map(O=>({turnServerURL:O.address,tcpport:s==="proxy3"?void 0:O.tcpport||br.tcpport,udpport:s==="proxy4"?void 0:O.udpport||br.udpport,username:R,password:N,forceturn:s!=="proxy4",security:s==="proxy5"}));p.push(...w)}return e.turnServer={mode:"manual",servers:p},y.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(s)),h}async function KM(e,t,i,r,n){let s=U("ACCOUNT_REGISTER").slice(0,U("AJAX_REQUEST_CONCURRENT")),c=[];c=t.proxyServer?s.map(d=>"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1")):s.map(d=>"https://".concat(d,"/api/v1"));let l=n?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:c});try{let d=await(async function(h,p,_,E,R){let N=Date.now(),w={sid:_.sid,opid:10,appid:_.appId,string_uid:p},O=h[0],L=await no(()=>lo(O+"".concat(O.indexOf("?")===-1?"?":"&","action=stringuid"),{data:w,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(M,B)=>{if(M.code===0){if(M.uid<=0||M.uid>=Math.pow(2,32))throw y.error("Invalid Uint Uid ".concat(p," => ").concat(M.uid),M),Fe.reqUserAccount(w.sid,{lts:N,success:!1,serverAddr:O,stringUid:w.string_uid,uid:M.uid,errorCode:k.INVALID_UINT_UID_FROM_STRING_UID,extend:w}),new $(k.INVALID_UINT_UID_FROM_STRING_UID);return Fe.reqUserAccount(w.sid,{lts:N,success:!0,serverAddr:O,stringUid:w.string_uid,uid:M.uid,errorCode:null,extend:w}),!1}let Y=Em(M.code);return Y.retry&&(O=h[(B+1)%h.length]),Fe.reqUserAccount(w.sid,{lts:N,success:!1,serverAddr:O,stringUid:w.string_uid,uid:M.uid,errorCode:Y.desc,extend:w}),Y.retry},(M,B)=>M.code!==k.OPERATION_ABORTED&&(Fe.reqUserAccount(w.sid,{lts:N,success:!1,serverAddr:O,stringUid:w.string_uid,uid:null,errorCode:M.code,extend:w}),O=h[(B+1)%h.length],!0),R);if(L.code!==0){let M=Em(L.code);throw new $(k.UNEXPECTED_RESPONSE,M.desc)}return L})(c,e,t,i,r);return n?.recordJoinChannelService({status:"success",endTs:Date.now()},l),d.uid}catch(d){throw n?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[d]},l),d}}async function tG(e,t,i){let r=U("ACCOUNT_REGISTER"),n=[];n=t.proxyServer?r.map(s=>"https://".concat(t.proxyServer,"/ap/?url=").concat(s+"/api/v1")):r.map(s=>"https://".concat(s,"/api/v1"));try{return await WM({referenceList:n,asyncMapHandler:s=>(async function(c,l,d,h){let p=Date.now(),_={sid:d.sid,opid:10,appid:d.appId,string_uid:l};try{let E=await lo(c+"".concat(c.indexOf("?")===-1?"?":"&","action=stringuid"),{data:_,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(E.code!==0){let R=Em(E.code);throw new $(k.UNEXPECTED_RESPONSE,"preload sua error:".concat(R.desc),R)}if(E.uid<=0||E.uid>=Math.pow(2,32))throw new $(k.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:p,url:c,req:_,uid:E.uid,elapse:Date.now()-p}}catch(E){throw E}})(s,e,t,i),closeFn:s=>s.code===k.OPERATION_ABORTED||s.code===k.UNEXPECTED_RESPONSE&&!s.data.retry})}catch(s){throw s}}async function iG(e,t,i){let r=U("CDS_AP").slice(0,U("AJAX_REQUEST_CONCURRENT")).map(d=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1"):"https://".concat(d,"/api/v1?action=config")),n=r.map(d=>(function(h,p,_,E){let R=Ct(),N={flag:64,cipher_method:0,features:sc(sc(sc(sc(sc({install_id:nw(),device:R.name,system:R.os,system_general:navigator.userAgent,vendor:p.appId,version:Fa,cname:p.cname,session_id:p.sid,proxyServer:p.proxyServer,sdk_type:K9.WEB_RTC,browser_name:R.name,browser_version:R.version,user_agent:navigator.userAgent,channel_name:p.cname},p.stringUid&&{string_uid:p.stringUid}),p.uid&&{uid:p.uid+""}),R.os&&{os_name:R.os}),R.osVersion&&{os_version:R.osVersion}),{},{detail:""})};return no(()=>lo(h,{data:N,timeout:1e3,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,w=>w.code!==k.OPERATION_ABORTED,E)})(d,e,t,i)),s=null,c=null,l={};try{s=await Rm(n)}catch(d){if(d.code===k.OPERATION_ABORTED)throw d;c=d}if(n.forEach(d=>d.cancel()),Fe.reportApiInvoke(e.sid,{name:Oi.REQUEST_CONFIG_DISTRIBUTE,options:{error:c,res:s}}).onSuccess(),s&&s.test_tags)try{l=(function(d){if(!d.test_tags)return{};let h=d.test_tags,p=Object.keys(h),_={};return p.forEach(E=>{var R;let N=Qr(R=E.slice(4)).call(R),w=JSON.parse(h[E]),O=w[1];_[N]={tag:w[0]||"",value:O}}),_})(s)}catch{}return l}async function YM(e,t){let i=U("WEBCS_DOMAIN").concat(U("WEBCS_DOMAIN_BACKUP_LIST")).map(r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:Hg(),serviceIds:[ji.CHOOSE_SERVER,ji.CLOUD_PROXY_FALLBACK]}));try{return await WM({referenceList:i,asyncMapHandler:r=>(async function(n,s,c){let l,{url:d,areaCode:h,serviceIds:p}=n,_=Date.now(),[E,R]=rI(s,h,p),N=Bi.networkState;try{N&&Bi.networkState===$n.OFFLINE&&Bi.onlineWaiter&&await we.race([Bi.onlineWaiter,fr(Wi.maxRetryTimeout)]),N=Bi.networkState;let{data:w,headers:O}=await lo(d,{data:E,cancelToken:c,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l=O.http3==="1"?1:-1,(B=>{let Y=[];if(B.response_body.forEach(H=>{let G=H.buffer.code;if(H.uri===23&&G===0&&!H.buffer.edges_services)if(H.buffer.flag===4194310)H.buffer.edges_services=[];else{let Q={error:new $(k.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:B.detail[502]}),flag:H.buffer.flag};Y.push(Q)}if(G!==0){let Q=Em(G),ce={error:new $(k.CAN_NOT_GET_GATEWAY_SERVER,Q.desc,{desc:Q.desc,retry:Q.retry,csIp:B.detail[502]}),flag:H.buffer.flag};H.buffer.flag===4194310?y.warning(ce.error.toString()):Y.push(ce)}}),Y.length)throw new $(k.CAN_NOT_GET_GATEWAY_SERVER,Y.map(H=>"flag: ".concat(H.flag,", message: ").concat(H.error.message)).join(" | "),{retry:!!Y.find(H=>H.error.data.retry),csIp:B.detail[502],desc:[...new Set(Y.map(H=>{var G;return H==null||(G=H.error)===null||G===void 0||(G=G.data)===null||G===void 0?void 0:G.desc}).filter(H=>!!H))]})})(w);let L=Bg(w,ji.CHOOSE_SERVER),M=Bg(w,ji.CLOUD_PROXY_FALLBACK);return iI(L),{gatewayInfo:Kw(L,d),proxyInfo:M,opid:R,requestTime:_,url:d,isHttp3:l,elapse:Date.now()-_}}catch(w){throw w}})(r,e,t),closeFn:r=>r.code===k.OPERATION_ABORTED||r.code===k.CAN_NOT_GET_GATEWAY_SERVER&&!r.data.retry})}catch(r){throw r}}async function qM(e,t,i,r){let n=U("PROXY_SERVER_TYPE3"),s=(R,N,w)=>{let O=w||n;return Array.isArray(O)&&(O=N%2==0&&n[1]||n[0]),"https://".concat(O,"/ap/?url=").concat(R)},c=null,l=[],d=async()=>{let R=U("WEBCS_DOMAIN").slice(0,U("AJAX_REQUEST_CONCURRENT")).map((O,L)=>{let M;return M=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(O,"/api/v2/transpond/webrtc?v=2"),L,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(O,"/api/v2/transpond/webrtc?v=2"):s("".concat(O,"/api/v2/transpond/webrtc?v=2"),L),{url:M,areaCode:Hg(),serviceIds:[ji.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ji.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ji.CLOUD_PROXY:ji.CLOUD_PROXY_FALLBACK]}}),N=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(O=>O.url)}),w=await Wg({fragementLength:U("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:O=>(y.debug("[".concat(e.clientId,"] Connect to choose_server:"),O.url),GM(O,e,t,i)),allFailedhandler:O=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},N),O[0]},promisesCollector:l});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},N),w},h=async()=>{if(await fr(1e3),c!==null)return c;let R=U("WEBCS_DOMAIN_BACKUP_LIST").map((O,L)=>{let M;return M=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(O,"/api/v2/transpond/webrtc?v=2"),L,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(O,"/api/v2/transpond/webrtc?v=2"):s("".concat(O,"/api/v2/transpond/webrtc?v=2"),L),{url:M,areaCode:Hg(),serviceIds:[ji.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ji.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ji.CLOUD_PROXY:ji.CLOUD_PROXY_FALLBACK]}}),N=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(O=>O.url)}),w=await Wg({fragementLength:U("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:O=>(y.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),O.url),GM(O,e,t,i)),allFailedhandler:O=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},N),O[0]},promisesCollector:l});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},N),w},p,_,E;try{({gatewayInfo:p,proxyInfo:_,url:E}=await Rm([d(),h()]))}catch(R){throw R[0]}if(l.length&&l.forEach(R=>R.cancel&&typeof R.cancel=="function"&&R.cancel()),!p||!_)throw new $(k.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=E,e.cloudProxyServer!=="disabled"&&Array.isArray(n)&&E){let R=/^https?:\/\/(.+?)(\/.*)?$/.exec(E)[1];ve(n).call(n,R)&&(e.proxyServer=R,y.setProxyServer(R),Fe.setProxyServer(R))}return c={gatewayInfo:p,proxyInfo:await gM(_,p.uid)},c}async function rG(e,t,i){let r=U("UAP_AP").slice(0,U("AJAX_REQUEST_CONCURRENT")).map(s=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")),n=r.map(s=>(function(c,l,d,h){let p={command:"convergeAllocateEdge",sid:l.sid,appId:l.appId,token:l.token,ts:Date.now(),version:Fa,cname:l.cname,uid:l.uid.toString(),requestId:tI,seq:tI};tI+=1;let _={service_name:"tele_channel",json_body:JSON.stringify(p)};return no(async()=>{let E=await lo(c,{data:_,cancelToken:d,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(E.code!==0){let N=new $(k.UNEXPECTED_RESPONSE,"cross channel ap error, code"+E.code,{retry:!0});throw y.error(N.toString()),N}let R=JSON.parse(E.json_body);if(R.code!==200){let N=new $(k.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(R.code,", reason: ").concat(R.reason));throw y.error(N.toString()),N}if(!R.servers||R.servers.length===0){let N=new $(k.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw y.error(N.toString()),N}return{vid:R.vid,workerToken:R.workerToken,addressList:(U("CHANNEL_MEDIA_RELAY_SERVERS")||R.servers).map(N=>"wss://".concat(N.address.replace(/\./g,"-"),".").concat(U("WORKER_DOMAIN"),":").concat(N.wss))}},void 0,E=>!!(E.code!==k.OPERATION_ABORTED&&E.code!==k.UNEXPECTED_RESPONSE||E.data&&E.data.retry),h)})(s,e,t,i));try{let s=await Rm(n);return n.forEach(c=>c.cancel()),s}catch(s){throw s[0]}}async function nG(e,t,i){let r=null,n=[],s=async c=>{let l=U(c?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(d=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v2/transpond/webrtc?v=2"):"https://".concat(d,"/api/v2/transpond/webrtc?v=2"));return c&&(await fr(1e3),r!==null)?r:await Wg({fragementLength:U("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:d=>(y.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(c?"backup":""," choose_server:"),d),(function(h,p,_,E){let[R]=$9(p,[ji.CHOOSE_SERVER]),N=Bi.networkState;return no(async()=>{N&&Bi.networkState===$n.OFFLINE&&Bi.onlineWaiter&&await we.race([Bi.onlineWaiter,fr(E&&E.maxRetryTimeout||Wi.maxRetryTimeout)]),N=Bi.networkState;let w=await lo(h,{data:R,cancelToken:_,headers:{"Content-Type":"multipart/form-data;"}},!0);return Q9(w,h)},()=>!1,w=>w.code!==k.OPERATION_ABORTED&&(w.code===k.UPDATE_TICKET_FAILED?w.data.retry:(y.warning("[".concat(p.clientId,"] update ticket network error, retry"),w),!0)),E)})(d,e,t,i)),allFailedhandler:d=>{throw d[0]},promisesCollector:n})};try{return r=await Rm([s(!1),s(!0)]),n.length&&n.forEach(c=>c.cancel&&typeof c.cancel=="function"&&c.cancel()),r}catch(c){throw c[0]}}function XM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function aI(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?XM(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):XM(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}class aG extends Ei{get isSuccess(){return!!this.configs}constructor(t,i){super(),D(this,"configs",void 0),D(this,"store",void 0),D(this,"joinInfo",void 0),D(this,"cancelToken",void 0),D(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),D(this,"interval",void 0),D(this,"mutex",void 0),D(this,"mutableParamsRead",!1),D(this,"configCache",{}),D(this,"limit_bitrate",void 0),this.mutex=new Lr("config-distribute",t),this.store=i}startGetConfigDistribute(t,i){this.joinInfo=t,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),U("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},U("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Fe.reportApiInvoke(null,{options:void 0,name:Oi.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:pi.TRACER}).onSuccess(JSON.stringify(ao))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void y.debug("[config-distribute] get config distribute interrupted have no joininfo");let t,i=await this.mutex.lock();try{t=await iG(this.joinInfo,this.cancelToken,this.retryConfig),y.debug("[config-distribute] get config distribute",JSON.stringify(t));let r=(function(n){var s;let c=ct(s=Object.keys(n).filter(h=>/^webrtc_ng_global_parameter/.test(h))).call(s);for(let h=0;h<c.length;h++)for(let p=c.length-1;p>h;p--){let _=c[p],E=n[_].value;if(typeof E.__priority=="number"){let R=E.__priority,N=c[p-1],w=n[N].value;if(typeof w.__priority=="number"){if(!(R>w.__priority))continue;{let O=_;c[p]=c[p-1],c[p-1]=O}}else{let O=_;c[p]=c[p-1],c[p-1]=O}}}let l=Date.now(),d={};return c.forEach(h=>{let p=n[h].value.__expires;p&&p<=l||(d[h]=n[h])}),d})(t);this.cacheGlobalParameterConfig(r),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=r}catch(r){let n=new $(k.NETWORK_RESPONSE_ERROR,r);y.warning("[config-distribute] ".concat(n.toString()))}finally{i()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){oM(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(xg.UPDATE_BITRATE_LIMIT,t):this.emit(xg.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&aI({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{let i={},r=Object.keys(t),n=[];r.forEach(s=>{let c=t[s].value;i[s]=c;let l=c.__id;if(l&&this.configCache[s]&&this.configCache[s].__id===l)return;let d=c.__type,h=t[s].value,p=t[s].tag,_=0;d?d===DL.REALTIME&&(_=1):Object.keys(h).some(E=>Object.prototype.hasOwnProperty.call(cw,E)||!Mw()&&Object.prototype.hasOwnProperty.call(cR,E)?(_=1,!0):void 0),n.push({tag:p,isApplied:_,feature:s,params:JSON.stringify(c)})}),n.forEach(s=>{let{tag:c,feature:l,params:d,isApplied:h}=s;this.store.sessionId&&Fe.abTest(this.store.sessionId,{intSucc:1,isApplied:h,tag:c,feature:l,params:d,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=i}catch(i){y.debug("handleABTestConfigDistribute error",i)}}cacheGlobalParameterConfig(t){let i=(function(n){let s={};return Object.keys(n).forEach(c=>{let l=n[c].value,d=l.__expires,h=l.__type;Object.keys(l).forEach(p=>{p==="__id"||p==="__type"||p==="__priority"||p==="__expires"||Object.prototype.hasOwnProperty.call(s,p)||(s[p]=aI(aI({value:l[p]},d&&{expires:d}),h&&{type:h}))})}),s})(t);try{var r;let n=(r=i.LIMIT_BITRATE)===null||r===void 0?void 0:r.value;delete i.LIMIT_BITRATE,n&&oM(n)&&this.handleBitrateLimit(n),this.limit_bitrate=n,this.handleGlobalParameterConfig(i),this.handleABTestConfigDistribute(t),(function(l){try{let d=Date.now();Object.keys(l).forEach(h=>{let{value:p,type:_,expires:E}=l[h];E&&E<=d||((_===DL.REALTIME||Object.prototype.hasOwnProperty.call(cw,h))&&(ao[h]=p,di[h]=p,y.debug("Update realtime parameters from config distribute",h,p)),_||Mw()||!Object.prototype.hasOwnProperty.call(cR,h)||(ao[h]=p,di[h]=p,y.debug("Update gateway parameters from config distribute",h,p)))})}catch(d){y.error("Error update config immediately: ".concat(l),d.message)}})(i);let s=JSON.stringify(i),c=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",c),y.debug("Caching global parameters ".concat(s))}catch(n){y.error("Error caching global parameters:",n.message)}}handleGlobalParameterConfig(t){try{let i=Date.now();Object.keys(t).forEach(r=>{if(r==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(di,r)){let{value:n,expires:s}=t[r];if(s&&s<=i)return;(function(c,l){try{return typeof c=="object"&&typeof l=="object"&&JSON.stringify(c)===JSON.stringify(l)}catch{return!1}})(di[r],n)||(ao[r]=n,di[r]=n,this.emit(xg.UPDATE_CLIENT_ROLE_OPTIONS,n),y.debug("Updating client role options: ".concat(JSON.stringify(n))))}})}catch(i){y.error("Error handling global parameter config:",i.message)}}}class sG extends Ei{constructor(){super(...arguments),D(this,"resultStorage",new Map)}setLocalAudioStats(t,i,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(r,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(r,i))}setLocalVideoStats(t,i,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(r,i)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(r,i)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(r)),!i.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(r))}setRemoteAudioStats(t,i){let r=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(i))}setRemoteVideoStats(t,i){let r=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(i))}record(t,i,r){if(U("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});let n=this.resultStorage.get(t);if(!n)return;n.result.push(r);let s=t==="VIDEO_ENCODE_FAILED"?U("ENCODE_EXCEPTION_TIMES"):5;if(n.result.length>=s){var c;let l=ve(c=n.result).call(c,!0);n.isPrevNormal&&!l&&this.emit("exception",sI[t],t,i),!n.isPrevNormal&&l&&this.emit("exception",sI[t]+2e3,t+"_RECOVER",i),n.isPrevNormal=l,n.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,i){return i instanceof qi&&!i.isActive||!!i.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,i){let r=null;i._encoderConfig&&i._encoderConfig.frameRate&&(r=ea(i._encoderConfig.frameRate));let n=t.captureFrameRate;return!r||!n||!(r>10&&n<5||r<10&&r>=5&&n<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var i;return!(!t.codecType||ve(i=U("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(i,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,i){return!!i.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,i){return i instanceof qi&&!i.isActive||!!i.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}let sI={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},Ur=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){let i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(i.length>0){let r=i[i.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){let i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(i.length>0){let r=i[i.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function JM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function Ph(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?JM(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):JM(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}class zg{constructor(t){D(this,"store",void 0),D(this,"onStatsException",void 0),D(this,"onUploadPublishDuration",void 0),D(this,"onStatsChanged",void 0),D(this,"onVideoCodecChanged",void 0),D(this,"localStats",new Map),D(this,"remoteStats",new Map),D(this,"updateStatsInterval",void 0),D(this,"trafficStats",void 0),D(this,"trafficStatsPeerList",[]),D(this,"uplinkStats",void 0),D(this,"exceptionMonitor",void 0),D(this,"p2pChannel",void 0),D(this,"scalabilityMode",oR.L1T1),D(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new sG,this.exceptionMonitor.on("exception",(i,r,n)=>{this.onStatsException&&this.onStatsException(i,r,n)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(me.LocalAudioTrack)||Ph({},fw)}getLocalVideoTrackStats(){return this.localStats.get(me.LocalVideoTrack)||Ph({},mw)}getRemoteAudioTrackStats(t){let i=(s,c)=>{if(!this.trafficStats)return c;let l=this.trafficStats.peer_delay.find(d=>d.peer_uid===s);return l&&(c.publishDuration=l.B_ppad+(Date.now()-this.trafficStats.timestamp)),c},r={};if(t){var n;let s=(n=this.remoteStats.get(t))===null||n===void 0?void 0:n.audioStats;s&&(r[t]=i(t,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[c,{audioStats:l}]=s;l&&(r[c]=i(c,l))});return r}getRemoteNetworkQualityStats(t){let i={};if(t){var r;let n=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;n&&(i[t]=n)}else Array.from(this.remoteStats.entries()).forEach(n=>{let[s,{networkStats:c}]=n;c&&(i[s]=c)});return i}getRemoteVideoTrackStats(t){let i=(s,c)=>{if(!this.trafficStats)return c;let l=this.trafficStats.peer_delay.find(d=>d.peer_uid===s);return l&&(c.publishDuration=l.B_ppvd+(Date.now()-this.trafficStats.timestamp)),c},r={};if(t){var n;let s=(n=this.remoteStats.get(t))===null||n===void 0?void 0:n.videoStats;s&&(r[t]=i(t,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[c,{videoStats:l}]=s;l&&(r[c]=i(c,l))});return r}getRTCStats(){let t=0,i=0,r=0,n=0,s=this.localStats.get(me.LocalAudioTrack);s&&(t+=s.sendBytes,i+=s.sendBitrate);let c=this.localStats.get(me.LocalVideoTrack);c&&(t+=c.sendBytes,i+=c.sendBitrate);let l=this.localStats.get(me.LocalVideoLowTrack);l&&(t+=l.sendBytes,i+=l.sendBitrate),this.remoteStats.forEach(h=>{let{audioStats:p,videoStats:_}=h;p&&(r+=p.receiveBytes,n+=p.receiveBitrate),_&&(r+=_.receiveBytes,n+=_.receiveBitrate)});let d=1;return this.trafficStats&&(d+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:d,SendBitrate:i,SendBytes:t,RecvBytes:r,RecvBitrate:n,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),t.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var r;let n=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(i.peer_uid),s=n!=null&&n.videoSSRC?Ur.measureFromSubscribeStart(this.store.clientId,n.videoSSRC):0,c=n!=null&&n.audioSSRC?Ur.measureFromSubscribeStart(this.store.clientId,n.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,s>c?s:c),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&y.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,i,r){if(!t)return!1;let n=!!r&&i.framesDecodeFreezeTime>r.framesDecodeFreezeTime,s=!r||i.framesDecodeCount>r.framesDecodeCount;return n||!s}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(i=>{let[r,n]=i;switch(r){case me.LocalVideoTrack:case me.LocalVideoLowTrack:{let l=n,d=Ph({},mw),h=t.getStats(),p=t.getLocalMedia(r);if(h){let _=h.videoSend.find(E=>E.ssrc===p?.ssrcs[0].ssrcId);if(_){let E=t.getLocalVideoSize(),R=t.getEncoderConfig(me.LocalVideoTrack);var s;(_.codec==="H264"||_.codec==="H265"||_.codec==="VP8"||_.codec==="VP9"||_.codec==="AV1X"||_.codec==="AV1")&&(d.codecType=_.codec,l?.codecType!==_.codec&&((s=this.onVideoCodecChanged)===null||s===void 0||s.call(this,_.codec.toLocaleLowerCase()))),d.sendBytes=_.bytes,d.sendBitrate=l?8*Math.max(0,d.sendBytes-l.sendBytes):0,_.inputFrame?(d.captureFrameRate=_.inputFrame.frameRate,d.captureResolutionHeight=_.inputFrame.height,d.captureResolutionWidth=_.inputFrame.width):E&&(d.captureResolutionWidth=E.width,d.captureResolutionHeight=E.height),_.sentFrame?(d.sendFrameRate=_.sentFrame.frameRate,d.sendResolutionHeight=_.sentFrame.height,d.sendResolutionWidth=_.sentFrame.width):E&&(d.sendResolutionWidth=E.width,d.sendResolutionHeight=E.height),_.avgEncodeMs&&(d.encodeDelay=_.avgEncodeMs),R&&R.bitrateMax?d.targetSendBitrate=1e3*R.bitrateMax:_.targetBitrate&&(d.targetSendBitrate=_.targetBitrate),d.sendPackets=_.packets,d.sendPacketsLost=_.packetsLost,d.sendJitterMs=_.jitterMs,d.sendRttMs=_.rttMs,d.totalDuration=l?l.totalDuration+1:1,d.totalFreezeTime=l?l.totalFreezeTime:0,this.isLocalVideoFreeze(_)&&(d.totalFreezeTime+=1),_.scalabilityMode&&this.scalabilityMode!==_.scalabilityMode&&(y.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(_.scalabilityMode)),this.scalabilityMode=_.scalabilityMode)}this.trafficStats&&(d.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var c;this.localStats.set(r,d),(l?.sendResolutionWidth!==d.sendResolutionWidth||l?.sendResolutionHeight!==d.sendResolutionHeight)&&((c=this.onStatsChanged)===null||c===void 0||c.call(this,"resolution",{width:d.sendResolutionWidth,height:d.sendResolutionHeight})),d&&p&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,p.track,d);break}case me.LocalAudioTrack:{let l=n,d=Ph({},fw),h=t.getStats(),p=t.getLocalMedia(r);if(h){let _=h.audioSend.find(E=>E.ssrc===p?.ssrcs[0].ssrcId);if(_){if(_.codec!=="opus"&&_.codec!=="aac"&&_.codec!=="PCMU"&&_.codec!=="PCMA"&&_.codec!=="G722"||(d.codecType=_.codec),_.inputLevel)d.sendVolumeLevel=Math.round(32767*_.inputLevel);else{let E=t.getLocalAudioVolume();E&&(d.sendVolumeLevel=Math.round(32767*E))}d.sendBytes=_.bytes,d.sendPackets=_.packets,d.sendPacketsLost=_.packetsLost,d.sendJitterMs=_.jitterMs,d.sendRttMs=_.rttMs,d.sendBitrate=l?8*Math.max(0,d.sendBytes-l.sendBytes):0}}this.trafficStats&&(d.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(me.LocalAudioTrack,d),d&&p&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,p.track,d);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(i=>{var r,n;let[s,{videoStats:c,audioStats:l,videoPcStats:d}]=i,h=l,p=c,_=d,E=Ph({},GL),R=Ph({},HL),N=Ph({},H8),{audioTrack:w,videoTrack:O,audioSSRC:L,videoSSRC:M}=t.getRemoteMedia(s),B;B=this.store.useP2P?t.getStats(!0):t.getStats();let Y=(r=B)===null||r===void 0?void 0:r.audioRecv.find(ce=>ce.ssrc===L),H=(n=B)===null||n===void 0?void 0:n.videoRecv.find(ce=>ce.ssrc===M),G=this.trafficStats&&this.trafficStats.peer_delay.find(ce=>ce.peer_uid===s);if(Y&&(Y.codec!=="opus"&&Y.codec!=="aac"&&Y.codec!=="PCMU"&&Y.codec!=="PCMA"&&Y.codec!=="G722"||(E.codecType=Y.codec),Y.outputLevel?E.receiveLevel=Math.round(32767*Y.outputLevel):w&&(E.receiveLevel=Math.round(32767*w.getVolumeLevel())),E.receiveBytes=Y.bytes,E.receivePackets=Y.packets,E.receivePacketsLost=Y.packetsLost,E.receivePacketsDiscarded=Y.packetsDiscarded,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.receiveBitrate=h?8*Math.max(0,E.receiveBytes-h.receiveBytes):0,E.totalDuration=h?h.totalDuration+1:1,E.totalFreezeTime=h?h.totalFreezeTime:0,E.freezeRate=E.totalFreezeTime/E.totalDuration,E.receiveDelay=Y.jitterBufferMs,E.totalDuration>10&&zg.isRemoteAudioFreeze(w)&&(E.totalFreezeTime+=1)),H){var Q;H.codec!=="H264"&&H.codec!=="H265"&&H.codec!=="VP8"&&H.codec!=="VP9"&&H.codec!=="AV1X"&&H.codec!=="AV1"||(R.codecType=H.codec),R.receiveBytes=H.bytes,R.receiveBitrate=p?8*Math.max(0,R.receiveBytes-p.receiveBytes):0,R.decodeFrameRate=H.decodeFrameRate<0?0:H.decodeFrameRate,R.renderFrameRate=H.decodeFrameRate<0?0:H.decodeFrameRate,H.outputFrame&&(R.renderFrameRate=H.outputFrame.frameRate),H.receivedFrame?(R.receiveFrameRate=H.receivedFrame.frameRate,R.receiveResolutionHeight=H.receivedFrame.height,R.receiveResolutionWidth=H.receivedFrame.width):O&&(R.receiveResolutionHeight=O._videoHeight||0,R.receiveResolutionWidth=O._videoWidth||0),H.framesRateFirefox!==void 0&&(R.receiveFrameRate=Math.round(H.framesRateFirefox)),R.receivePackets=H.packets,R.receivePacketsLost=H.packetsLost,R.packetLossRate=R.receivePacketsLost/(R.receivePackets+R.receivePacketsLost);let ce=p?p.totalFreezeTime:0,he=p?p.totalDuration:0;R.totalDuration=p?p.totalDuration+1:1,R.totalFreezeTime=(Q=H.totalFreezesDuration)!==null&&Q!==void 0?Q:ce||0,R.receiveDelay=H.jitterBufferMs||0;let Se=!!M&&t.getRemoteVideoIsReady(M);H.totalFreezesDuration===void 0&&O&&Se&&zg.isRemoteVideoFreeze(O,H,_)&&(R.totalFreezeTime+=1),R.freezeRate=Math.max(0,Math.min((R.totalFreezeTime-ce)/(R.totalDuration-he),1))}G&&(E.end2EndDelay=G.B_ad,R.end2EndDelay=G.B_vd,E.transportDelay=G.B_ed,R.transportDelay=G.B_ed,E.currentPacketLossRate=G.B_ealr4/100,R.currentPacketLossRate=G.B_evlr4/100,N.uplinkNetworkQuality=G.B_punq?G.B_punq:0,N.downlinkNetworkQuality=G.B_pdnq?G.B_pdnq:0),this.remoteStats.set(s,{audioStats:E,videoStats:R,videoPcStats:H,networkStats:N}),w&&this.exceptionMonitor.setRemoteAudioStats(w,E),O&&this.exceptionMonitor.setRemoteVideoStats(O,R)})}}class ZM{constructor(){D(this,"destChannelMediaInfos",new Map),D(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){aM(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){aM(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){wR(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function QM(e){if(!(e instanceof ZM))return new $(k.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo(),i=e.getDestChannelMediaInfo();if(!t)return new $(k.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new $(k.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Gd{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,i){D(this,"uid",void 0),D(this,"_uintid",void 0),D(this,"_trust_in_room_",!0),D(this,"_trust_audio_enabled_state_",!0),D(this,"_trust_video_enabled_state_",!0),D(this,"_trust_audio_mute_state_",!0),D(this,"_trust_video_mute_state_",!0),D(this,"_audio_muted_",!1),D(this,"_video_muted_",!1),D(this,"_audio_enabled_",!0),D(this,"_video_enabled_",!0),D(this,"_audio_added_",!1),D(this,"_video_added_",!1),D(this,"_is_pre_created",!1),D(this,"_video_pre_subscribed",!1),D(this,"_audio_pre_subscribed",!1),D(this,"_trust_video_stream_added_state_",!0),D(this,"_trust_audio_stream_added_state_",!0),D(this,"_audioTrack",void 0),D(this,"_videoTrack",void 0),D(this,"_dataChannels",[]),D(this,"_audioSSRC",void 0),D(this,"_videoSSRC",void 0),D(this,"_audioOrtc",void 0),D(this,"_videoOrtc",void 0),D(this,"_cname",void 0),D(this,"_rtxSsrcId",void 0),D(this,"_videoMid",void 0),D(this,"_audioMid",void 0),this.uid=t,this._uintid=i}}function $M(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function oI(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?$M(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):$M(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let GR="9",cI=2e4,HR=4e4;function ex(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function hl(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?ex(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ex(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var ym=(function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e})(ym||{});let WR=new Map;function tx(e,t,i,r){let{scale:n}=e;if(n===0&&r===ym.UP||n>=t.length-1&&r===ym.DOWN)return e;let s=hl(hl({},e),{},{scale:r===ym.DOWN?++n:--n});switch(i){case"maintain-framerate":s=hl(hl({},s),t[n].motion);break;case"maintain-resolution":s=hl(hl({},s),t[n].detail);break;case"balanced":s=hl(hl({},s),t[n].balanced)}return s}function ix(e,t){if(t){let i={overUse:0,underUse:0,adaptationList:rx(t)};WR.set(e,i)}else WR.delete(e)}function rx(e){let t=hl({},e),{bitrateMax:i,frameRate:r,scaleResolutionDownBy:n,bitrateMin:s}=t,{MIN_FRAME_RATE:c,MAX_THRESHOLD_FRAMERATE:l,MAX_SCALE:d,BITRATE_MIN_THRESHOLD:h,BITRATE_MAX_THRESHOLD:p,BWE_SCALE_UP_THRESHOLD:_,BWE_SCALE_DOWN_THRESHOLD:E,PERF_SCALE_DOWN_THRESHOLD:R,PERF_SCALE_UP_THRESHOLD:N,BALANCE_BITRATE_FACTOR:w,BALANCE_FRAMERATE_FACTOR:O,BALANCE_RESOLUTION_FACTOR:L,MOTION_RESOLUTION_FACTOR:M,MOTION_BITRATE_FACTOR:B,DETAIL_FRAMERATE_FACTOR:Y,DETAIL_BITRATE_FACTOR:H}=sw,G=Math.min(t.frameRate,l),Q=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(E,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(R,1)*G),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:i,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:i,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:i,bitrateMin:s}}];for(let ce=1;ce<=d;ce++){let he={bwe_up:Math.round(Math.pow(_,ce)*i),bwe_down:Math.round(Math.pow(E,ce+1)*i),fps_up:Math.round(Math.pow(N,ce)*G),fps_down:Math.round(Math.pow(R,ce+1)*G)},Se={scaleResolutionDownBy:n/Math.pow(L,ce),frameRate:Math.max(Math.round(Math.pow(O,ce)*r),c),bitrateMax:Math.max(Math.round(Math.pow(w,ce)*i),p),bitrateMin:Math.max(Math.round(Math.pow(w,ce)*s),h)},ht={scaleResolutionDownBy:n/Math.pow(M,ce),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(B,ce)*i),p),bitrateMin:Math.max(Math.round(Math.pow(B,ce)*s),h)},pt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(Y,ce)*r),c),bitrateMax:Math.max(Math.round(Math.pow(H,ce)*i),p),bitrateMin:Math.max(Math.round(Math.pow(H,ce)*s),h)};Q.push({scale:ce,threshold:he,balanced:Se,motion:ht,detail:pt})}return Q}function oG(e,t,i,r,n,s){let c=WR.get(e)||{overUse:0,underUse:0,adaptationList:rx(n)},{adaptationList:l}=c;WR.set(e,c);let{OVERUSE_TIMES_THRESHOLD:d,UNDERUSE_TIMES_THRESHOLD:h}=sw,{scale:p}=r,_,E;return typeof t=="number"&&t>0&&(function(R,N,w,O){if(N>=w.length)return!1;let{threshold:{fps_down:L}}=w[N];return U("FORCE_AG_HIGH_FRAMERATE")&&O==="maintain-framerate"&&(L=w[0].threshold.fps_down),R<L})(t,p,l,s)&&(c.overUse++,E=Ig.CPU,c.overUse>d)||typeof i=="number"&&i>0&&(function(R,N,w){if(N>=w.length)return!1;let{threshold:{bwe_down:O}}=w[N];return R<O})(i,p,l)&&(c.overUse++,E=Ig.BANDWIDTH,c.overUse>d)?(c.overUse=0,c.underUse=0,_=tx(r,l,s,ym.DOWN),[_,E]):(typeof t=="number"&&t>0&&typeof i=="number"&&i>0&&(function(R,N,w,O){if(N===0)return;let{threshold:{fps_up:L}}=w[N];return U("FORCE_AG_HIGH_FRAMERATE")&&O==="maintain-framerate"&&(L=w[1].threshold.fps_up),R>L})(t,p,l,s)&&(function(R,N,w){if(N===0)return;let{threshold:{bwe_up:O}}=w[N];return R>O})(i,p,l)&&(c.underUse++,c.underUse>h&&(c.overUse=0,c.underUse=0,_=tx(r,l,s,ym.UP),_.scale===0&&(E=Ig.NONE))),[_,E])}function nx(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function lI(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?nx(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):nx(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let zR=new Map;function KR(e,t){let i=zR.get(e);if(i){let{timer:r}=i;window.clearTimeout(r),zR.delete(e)}t.qualityLimitationReason=Ig.NONE,ix(e)}function cG(e,t){var i;let r;switch(t){case me.LocalAudioTrack:r=Ft.Audio;break;case me.LocalVideoTrack:r=ve(i=e._hints).call(i,qt.SCREEN_TRACK)?Ft.Screen:Ft.High;break;case me.LocalVideoLowTrack:r=Ft.Low}return r}function dI(e){let t=Ot();if(e.some(i=>i._bypassWebAudio))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function uI(e,t){dI(e);let i=new qi;return e.forEach(r=>i.addAudioTrack(r)),i}let lG=!Ot().supportUnifiedPlan||U("CHROME_FORCE_PLAN_B")&&sl();function YR(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;return lG?(i={spec:t,store:e},ul("PlanBConnection").create(i)):new Ka(t,e)}function hI(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function ax(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(bg(e.turnServer.servers))return!1;if(U("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var bt;function sx(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function uo(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?sx(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):sx(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let Ka=(bt=class zh extends lM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,i;return(t=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var i;return ve(i=Object.keys(Ng)).call(i,t)}))]}constructor(t,i){super(t,i),D(this,"id",Zt(5,"connection-")),D(this,"store",void 0),D(this,"peerConnection",void 0),D(this,"forceTurn",!1),D(this,"remoteSDP",void 0),D(this,"initialOffer",void 0),D(this,"transportEventReceiver",void 0),D(this,"statsFilter",void 0),D(this,"extension",{useXR:U("USE_XR")}),D(this,"localCapabilities",void 0),D(this,"remoteCodecs",void 0),D(this,"localCandidateCount",0),D(this,"allCandidatesReceived",!1),D(this,"isPreallocation",!1),D(this,"preMediaMap",new Map),D(this,"dataStreamChannelMap",new Map),D(this,"establishPromise",void 0),D(this,"recoveredDataChannelIds",[]),D(this,"currentDataChannelId",1),D(this,"supportAV1RtpSpec",!1),D(this,"mutex",void 0),D(this,"qualityLimitationReason",Ig.NONE),D(this,"isFirstConnected",!1),this.store=i,this.forceTurn=ax(t),this.mutex=new Lr("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(zh.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=rw(this.peerConnection,U("STATS_UPDATE_INTERVAL"),void 0,Ri()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,i){if(this.remoteCodecs=i,!this.remoteSDP)return void y.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(t,i,this.store.codec)){let r=await this.peerConnection.createOffer(),n=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);let s=this.remoteSDP.toString();n?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else y.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let n=Vd(r.sdp),s=await IM({filterRTX:!U("USE_PUB_RTX")&&!U("USE_SUB_RTX"),filterVideoFec:U("FILTER_VIDEO_FEC"),filterAudioFec:U("FILTER_AUDIO_FEC"),filterVideoCodec:U("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:U("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:U("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=UR(s),this.initialOffer=r,U("ENABLE_SVC")&&this.store.codec=="av1"){let l=await(async function(){try{let d=new RTCPeerConnection;d.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:oR.L1T3}]});let h=await d.createOffer();if(!h.sdp)return void d.close();let p=kn(h.sdp).mediaDescriptions[0];if(!p)return;let _=p.attributes.extmaps.find(E=>E.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return d.close(),_}catch{return}})();var t;l&&(this.supportAV1RtpSpec=!0,(t=s.send)===null||t===void 0||t.videoExtensions.push(l))}let c;return r.sdp&&PM(r.sdp)&&(c=fi(s),(i=c).send&&(gm(Le.VIDEO,i.send.videoExtensions),gm(Le.AUDIO,i.send.audioExtensions)),i.recv&&(gm(Le.VIDEO,i.recv.videoExtensions),gm(Le.AUDIO,i.recv.audioExtensions)),i.sendrecv&&(gm(Le.VIDEO,i.sendrecv.videoExtensions),gm(Le.AUDIO,i.sendrecv.audioExtensions))),uo(uo({},n),{},{rtpCapabilities:c||s,offerSDP:r.sdp})}catch(r){throw new ne(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}var i}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&PM(this.initialOffer.sdp)&&(i=t.rtpCapabilities,r=this.localCapabilities,i.send&&(kR(Le.VIDEO,i.send.videoExtensions,r.send.videoExtensions),kR(Le.AUDIO,i.send.audioExtensions,r.send.audioExtensions)),i.recv&&(kR(Le.VIDEO,i.recv.videoExtensions,r.recv.videoExtensions),kR(Le.AUDIO,i.recv.audioExtensions,r.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return fi(this._localCapabilities)}get rtpCapabilities(){return fi(this._rtpCapabilities)}get candidates(){return fi(this._candidates)}get iceParameters(){return fi(this._iceParameters)}get dtlsParameters(){return fi(this._dtlsParameters)}constructor(d){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1],p=arguments.length>2&&arguments[2]!==void 0&&arguments[2];D(this,"sessionDesc",void 0),D(this,"_localCapabilities",void 0),D(this,"_rtpCapabilities",void 0),D(this,"_candidates",void 0),D(this,"_originCandidates",void 0),D(this,"_iceParameters",void 0),D(this,"_isUseExtmapAllowMixed",void 0),D(this,"_isUseLocalCodecs",void 0),D(this,"_dtlsParameters",void 0),D(this,"setup",void 0),D(this,"currentMidIndex",void 0),D(this,"cname",void 0),D(this,"useLocalCodecsMids",[]),D(this,"preloadSsrcs",[]),D(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=h,this._isUseLocalCodecs=p,d=fi(d);let{iceParameters:_,dtlsParameters:E,candidates:R,rtpCapabilities:N,setup:w,localCapabilities:O,cname:L}=d;this._rtpCapabilities=N,this._candidates=R,this._originCandidates=fi(R),this._iceParameters=_,this._dtlsParameters=E,this._localCapabilities=O,this.setup=w,this.cname=L,[this.sessionDesc]=this.updateRemoteRTPCapabilities(N),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(d){return d.length===this.preloadSsrcs.length&&d.every(h=>{var p;return ve(p=this.preloadSsrcs).call(p,h)})}preloadRemoteMedia(d){let h=0,p=[],_=[];for(;d>0;){let E=[oI({ssrcId:HR+h},U("USE_SUB_RTX")?{rtx:HR+h+1}:{})],R="".concat(HR+h,"_").concat(cI+h),{ssrcs:N,ssrcGroups:w}=Fg(E,this.cname,U("SYNC_GROUP")?R:void 0),O=this.preCreateOrRecycleSendMedia("video",N,w,void 0),L=[{ssrcId:cI+h}],M="".concat(HR+h,"_").concat(cI+h),{ssrcs:B,ssrcGroups:Y}=Fg(L,this.cname,U("SYNC_GROUP")?M:void 0),H=this.preCreateOrRecycleSendMedia("audio",B,Y,void 0);d--,h+=2,p.push(O,H),_.push(N[0].ssrcId,B[0].ssrcId)}return this.useLocalCodecsMids.push(...p),this.preloadSsrcs=_,{mids:p,preSSRCs:_,isAvailable:!0}}preCreateOrRecycleSendMedia(d,h,p,_){let E=this.rtpCapabilities.send.videoCodecs,R=this._isUseLocalCodecs||E.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;y.debug("create or recycle send media without remote rtp capabilities, ssrcs ",h[0].ssrcId);let N=d===Le.VIDEO?R.videoCodecs:R.audioCodecs,w=d===Le.VIDEO?R.videoExtensions:R.audioExtensions;this.currentMidIndex+=1;let O="".concat(this.currentMidIndex),L={media:{mediaType:d,port:GR,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.map(M=>M.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:w,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:N,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(O)}};return L=this.mungSendMediaDesc(L,_),this.sessionDesc.mediaDescriptions.push(L),this.updateBundleMids(),O}toString(){return Pd(this.sessionDesc)}send(d,h,p,_){let{ssrcs:E,ssrcGroups:R}=Fg(h,this.cname,U("SYNC_GROUP")?p:void 0),N=this.findPreloadMediaDesc(E);if(N){if(Ri()&&this.firefoxSsrcMidMap.set(E[0].ssrcId,N.attributes.mid),_&&(_.twcc||_.remb)){let w=this.sessionDesc.mediaDescriptions.indexOf(N);return this.sessionDesc.mediaDescriptions[w]=this.mungSendMediaDesc(N,_),{mid:N.attributes.mid,needExchangeSDP:!0}}return{mid:N.attributes.mid,needExchangeSDP:!1}}{let w=this.findAvailableMediaIndex(d,E),O;return w===-1||w===1&&(Rr()||(function(){let L=Ct();return!(L.name!==Pt.CHROME||!L.osVersion)&&Number(L.version)<=90})()||U("ENABLE_ENCODED_TRANSFORM")&&al())||w===0&&!(function(L){let M=Ct();return!(M.name!==Pt.FIREFOX||!M.osVersion)&&Number(M.version)===L})(138)&&U("USE_SUB_RTX")||tL()?(O=this.createOrRecycleSendMedia(d,E,R,"sendonly",_),this.updateBundleMids()):(O=fi(this.sessionDesc.mediaDescriptions[w]),O.attributes.direction="sendonly",O.attributes.ssrcs=E,O.attributes.ssrcGroups=R,this.sessionDesc.mediaDescriptions[w]=this.mungSendMediaDesc(O,_)),Ri()&&this.firefoxSsrcMidMap.set(E[0].ssrcId,O.attributes.mid),{mid:O.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:d,needExchangeSDP:h}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:d.attributes.mid,needExchangeSDP:h}}batchSend(d){let h=d.map(E=>{let{kind:R,ssrcMsg:N,mslabel:w}=E;return this.send(R,N,w)}),p=[],_=!1;return h.forEach(E=>{let{mid:R,needExchangeSDP:N}=E;N&&(_=!0),p.push(R)}),{mids:p,needExchangeSDP:_}}stopSending(d){let h=this.sessionDesc.mediaDescriptions.filter(p=>p.attributes.mid&&d.indexOf(p.attributes.mid)!==-1);if(h.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");h.forEach(p=>{p.attributes.mid==="0"||Ri()||tL()?p.attributes.ssrcs=[]:(p.attributes.ssrcs=[],p.attributes.direction="inactive",p.media.port="0")}),this.updateBundleMids()}mute(d){let h=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===d);if(!h)throw new Error("mediaDescription not found with ".concat(d," in remote SDP when calling RemoteSDP.mute."));h.attributes.direction="inactive"}unmute(d){let h=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===d);if(!h)throw new Error("mediaDescription not found with ".concat(d," in remote SDP when calling RemoteSDP.unmute."));h.attributes.direction="sendonly"}muteRemote(d){let h=this.sessionDesc.mediaDescriptions.filter(p=>ve(d).call(d,p.attributes.mid||""));if(h.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");h.forEach(p=>{p.attributes.direction="inactive"})}unmuteRemote(d){let h=this.sessionDesc.mediaDescriptions.filter(p=>ve(d).call(d,p.attributes.mid||""));if(h.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");h.forEach(p=>{p.attributes.direction="recvonly"})}receive(d,h,p,_){d.forEach((E,R)=>{this.createOrRecycleRecvMedia(E,[],"recvonly",h,p,_[R])}),this.updateBundleMids()}stopReceiving(d){let h=this.sessionDesc.mediaDescriptions.filter(p=>d.indexOf(p.attributes.mid)!==-1);if(h.length!==d.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");h.forEach(p=>{p.media.port="0",p.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(d){let h=this.sessionDesc||kn((p=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(p?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var p;this._rtpCapabilities=d;let _=!1,E=this.rtpCapabilities.send,R=this.localCapabilities.send,N=this.localCapabilities.recv,w=N.videoCodecs,O=N.audioCodecs,L=N.videoExtensions,M=N.audioExtensions;for(let G of h.mediaDescriptions){var B;if(G.attributes.direction!=="sendonly"||typeof G.attributes.mid!="string"||!ve(B=this.useLocalCodecsMids).call(B,G.attributes.mid)){if(_=!0,G.attributes.iceUfrag=this._iceParameters.iceUfrag,G.attributes.icePwd=this._iceParameters.icePwd,G.attributes.fingerprints=this._dtlsParameters.fingerprints,G.attributes.candidates=this._candidates,G.attributes.setup=this.setup,G.media.mediaType==="application"&&(G.attributes.sctpPort="5000"),G.media.mediaType==="video")if(this._isUseLocalCodecs&&G.attributes.direction==="sendonly"){var Y;G.media.fmts=w.map(ce=>ce.payloadType.toString(10)),G.attributes.payloads=w,G.attributes.extmaps=L;let Q=G.attributes.mid;typeof Q!="string"||ve(Y=this.useLocalCodecsMids).call(Y,Q)||this.useLocalCodecsMids.push(Q)}else if(E.videoCodecs.length===0){let Q=R.videoCodecs.filter(ce=>{var he,Se;return(he=ce.rtpMap)===null||he===void 0?void 0:ve(Se=he.encodingName.toLowerCase()).call(Se,"vp8")})||[R.videoCodecs[0]];G.media.fmts=Q.map(ce=>ce.payloadType.toString(10)),G.attributes.payloads=Q,G.attributes.extmaps=[]}else G.media.fmts=E.videoCodecs.map(Q=>Q.payloadType.toString(10)),G.attributes.payloads=E.videoCodecs,G.attributes.extmaps=E.videoExtensions;if(G.media.mediaType==="audio")if(this._isUseLocalCodecs&&G.attributes.direction==="sendonly"){var H;G.media.fmts=O.map(ce=>ce.payloadType.toString(10)),G.attributes.payloads=O,G.attributes.extmaps=M;let Q=G.attributes.mid;typeof Q!="string"||ve(H=this.useLocalCodecsMids).call(H,Q)||this.useLocalCodecsMids.push(Q)}else if(E.audioCodecs.length===0){let Q=R.audioCodecs.filter(ce=>{var he,Se;return(he=ce.rtpMap)===null||he===void 0?void 0:ve(Se=he.encodingName.toLowerCase()).call(Se,"opus")})||[R.audioCodecs[0]];G.media.fmts=Q.map(ce=>ce.payloadType.toString(10)),G.attributes.payloads=Q,G.attributes.extmaps=[]}else G.media.fmts=E.audioCodecs.map(Q=>Q.payloadType.toString(10)),G.attributes.payloads=E.audioCodecs,G.attributes.extmaps=E.audioExtensions,Tm(G)}}return this.sessionDesc=h,this.currentMidIndex=h.mediaDescriptions.length-1,[this.sessionDesc,_]}updateCandidates(d){let h=this._originCandidates.filter(_=>_.transport==="udp"),p=[];if(h.forEach(_=>{p.push(oI(oI({},_),{},{foundation:"tcpcandidate",priority:Number(_.priority)-1+"",transport:"tcp",port:Number(_.port)+90+""}))}),h.length!==0){switch(d){case xr.TCP_RELAY:this._candidates=p;break;case xr.UDP_TCP_RELAY:case xr.RELAY:this._candidates=[...h,...p];break;default:this._candidates=h}for(let _ of this.sessionDesc.mediaDescriptions)_.attributes.candidates=this.candidates}}restartICE(d){d=fi(d),this._iceParameters=d,this.sessionDesc.mediaDescriptions.forEach(h=>{h.attributes.iceUfrag=d.iceUfrag,h.attributes.icePwd=d.icePwd})}predictReceivingMids(d){let h=[];for(let p=0;p<d;p++)h.push((this.currentMidIndex+p+1).toString(10));return h}findAvailableMediaIndex(d,h){return this.sessionDesc.mediaDescriptions.findIndex(p=>{let _=p.media.mediaType===d&&p.media.port!=="0"&&(p.attributes.direction==="sendonly"||p.attributes.direction==="sendrecv")&&p.attributes.ssrcs.length===0;if(Ri()){if(_){let E=this.firefoxSsrcMidMap.get(h[0].ssrcId);return!(E||p.attributes.mid!=="0"&&p.attributes.mid!=="1")||!(!E||E!==p.attributes.mid)}return!1}return _})}createOrRecycleDataChannel(){for(let p of this.sessionDesc.mediaDescriptions)if(p.media.mediaType==="application")return{mediaDesc:p,needExchangeSDP:!1};this.currentMidIndex+=1;let d="".concat(this.currentMidIndex),h={media:{mediaType:"application",port:GR,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(d),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(h),{mediaDesc:h,needExchangeSDP:!0}}createOrRecycleRecvMedia(d,h,p,_,E,R){let N=d._mediaStreamTrack.kind,w=this.rtpCapabilities.recv,O=Gg(N,w,this.localCapabilities.send,N===Le.VIDEO?_:E),L=N===Le.VIDEO?w.videoExtensions:w.audioExtensions;this.currentMidIndex+=1;let M="".concat(this.currentMidIndex),B={media:{mediaType:N,port:GR,protos:["UDP","TLS","RTP","SAVPF"],fmts:O.map(H=>H.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:L,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:O,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:p,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(M)}};B=this.mungRecvMediaDsec(B,d,R);let Y=this.findFirstClosedMedia(N);if(Y){let H=this.sessionDesc.mediaDescriptions.indexOf(Y);this.sessionDesc.mediaDescriptions[H]=B}else this.sessionDesc.mediaDescriptions.push(B);return B}updateRemoteDtlsParameters(d){let h=new Set(this._dtlsParameters.fingerprints.map(E=>E.fingerprint)),p=new Set(d.map(E=>E.fingerprint)),_=!1;h.size!==p.size&&(_=!0);for(let E of h)p.has(E)||(_=!0);return _}updateRemoteCodec(d,h,p){let _=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(B=>B.rtpMap&&B.rtpMap.encodingName.toLowerCase()||"").filter(B=>{var Y;return ve(Y=Object.keys(Ng)).call(Y,B)}))],E=new Set(h);if(_.every(B=>E.has(B)))return y.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(h)),!1;let R=this._rtpCapabilities.recv.videoCodecs.filter(B=>h.some(Y=>{var H;return ve(H=B.rtpMap&&B.rtpMap.encodingName.toLowerCase()||"").call(H,Y)}));if(R.length===0)return y.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(_," codecs: ").concat(h)),!1;let N=[...new Set(R.map(B=>B.rtpMap&&B.rtpMap.encodingName.toLowerCase()||""))],w;if(y.debug("updateRemoteCodec, from ".concat(_," to ").concat(N)),d.length===0)w=this.sessionDesc.mediaDescriptions.filter(B=>B.media.mediaType==="video"&&B.attributes.direction==="recvonly");else if(w=this.sessionDesc.mediaDescriptions.filter(B=>B.attributes.mid&&B.media.mediaType==="video"&&ve(d).call(d,B.attributes.mid)&&B.attributes.direction==="recvonly"),w.length!==d.length)return y.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(d,", codecs: ").concat(h)),!1;if(U("USE_PUB_RTX")||U("USE_SUB_RTX")){let B=Bd(R,this.rtpCapabilities.recv.videoCodecs);R.push(...B)}this._rtpCapabilities.recv.videoCodecs=R;let O=this.localCapabilities.send,L=this.rtpCapabilities.recv,M=Gg(Le.VIDEO,L,O,p);return w.forEach(B=>{let Y=M.map(H=>H.payloadType.toString(10));y.debug("updateRemoteCodec mid: ".concat(B.attributes.mid,", from"),B.attributes.payloads,"to",M),B.attributes.payloads=M,B.media.fmts=Y}),!0}createOrRecycleSendMedia(d,h,p,_,E){let R=this.rtpCapabilities.send.videoCodecs,N=this._isUseLocalCodecs||R.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,w=d===Le.VIDEO?N.videoCodecs:N.audioCodecs,O=d===Le.VIDEO?N.videoExtensions:N.audioExtensions;this.currentMidIndex+=1;let L="".concat(this.currentMidIndex),M={media:{mediaType:d,port:GR,protos:["UDP","TLS","RTP","SAVPF"],fmts:w.map(Y=>Y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:O,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:w,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:_,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(L)}};M=this.mungSendMediaDesc(M,E);let B=this.findFirstClosedMedia(d);if(B){let Y=this.sessionDesc.mediaDescriptions.indexOf(B);this.sessionDesc.mediaDescriptions[Y]=M}else this.sessionDesc.mediaDescriptions.push(M);return M}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(d=>d.media.port!=="0").map(d=>d.attributes.mid)}mungRecvMediaDsec(d,h,p){let _=fi(d);return qw(_),Sm(_,h),Xw(_,h),AM(_),xR(_,p,this.localCapabilities.send),_}mungSendMediaDesc(d,h){let p=fi(d);return xR(p,h,this.localCapabilities.recv),Tm(p),p}updateRecvMedia(d,h){let p=this.sessionDesc.mediaDescriptions.findIndex(_=>_.attributes.mid===d);if(p!==-1){let _=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[p],h);this.sessionDesc.mediaDescriptions[p]=_}}bumpMid(d){this.currentMidIndex+=d}findFirstClosedMedia(d){return this.sessionDesc.mediaDescriptions.find(h=>Ri()?h.media.port==="0"&&h.media.mediaType===d:h.media.port==="0")}findPreloadMediaDesc(d){return this.sessionDesc.mediaDescriptions.find(h=>{var p;return((p=h.attributes)===null||p===void 0||(p=p.ssrcs[0])===null||p===void 0?void 0:p.ssrcId)===d[0].ssrcId})}getSSRC(d){var h;return(h=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===d))===null||h===void 0?void 0:h.attributes.ssrcs}}(uo(uo({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!U("ENABLE_PRE_SUB_WITH_PRE_PC")||!U("PRE_USE_LOCAL_CODECS"))&&uw(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let n=this.remoteSDP.toString(),s=NM(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c?.(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n});let l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),uw(this.store))if(t.preallocation&&U("ENABLE_PRE_SUB_WITH_PRE_PC")){let d=U("PRE_SUB_NUM"),{mids:h,preSSRCs:p}=this.remoteSDP.preloadRemoteMedia(d);await jd(this.peerConnection,this.remoteSDP,this.extension),y.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(p)),this.presetMedia(h,p)}else{let{preSSRCs:d=[]}=t,h=d.map(_=>_.ssrcMsg[0].ssrcId);if(d.length===0)return;let{mids:p}=this.remoteSDP.batchSend(d.map(_=>Object.assign({},_)));await jd(this.peerConnection,this.remoteSDP,this.extension),y.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(h)),this.presetMedia(p,h)}}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}var i,r}presetMedia(t,i){t.forEach((r,n)=>{this.peerConnection.getTransceivers().forEach(s=>{if(s.mid!=null&&r===s.mid&&s.receiver.track){let c=s.receiver.track,l;c.kind==="video"&&U("ENABLE_PRE_RENDER")&&(l=new Cw({trackId:"track-".concat(c.kind,"-unknown-").concat(this.store.clientId,"_").concat(Zt(5,""))},!0),l.updateVideoTrack(c),l.onFirstVideoFrameRender=()=>{var d;let h=this.preMediaMap.get(i[n]);h&&(h.firstVideoRender=Date.now()),(d=this.onFirstVideoRender)===null||d===void 0||d.call(this,i[n])},l.play(this.store.sessionId||void 0)),this.preMediaMap.set(i[n],{mid:r,track:c,player:l,transceiver:s})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let i=!1,{rtpCapabilities:r}=t;if([,i]=this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){let c=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);i=i||c}let{preSSRCs:n=[]}=t,s=n.map(c=>c.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(s)){let c=[],l=[];if(Array.from(this.preMediaMap.entries()).every(d=>{let[h,{mid:p,player:_,track:E}]=d;return c.push(p),l.push(h),this.preMediaMap.delete(h),_&&_.destroy(),!0}),c.length>0&&(this.remoteSDP.stopSending(c),await jd(this.peerConnection,this.remoteSDP,this.extension),y.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(l)),Fe.reportApiInvoke(this.store.sessionId,{name:Oi.PRELOAD_MEDIA_FAILED,options:[n,l],tag:pi.TRACER}).onSuccess()),n.length>0){let{mids:d}=this.remoteSDP.batchSend(n.map(h=>Object.assign({},h)));await jd(this.peerConnection,this.remoteSDP,this.extension),y.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(s)),this.presetMedia(d,s)}}i?(await jd(this.peerConnection,this.remoteSDP,this.extension),y.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):y.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(t,i,r){var n=this;return ja(function*(){let s=yield It(n.mutex.lock("From P2PConnection.send"));try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let c=[],l=LR();t.forEach(O=>{let L=n.peerConnection.addTransceiver(O._mediaStreamTrack,uo({direction:"sendonly"},O.trackMediaType==="video"&&n.supportAV1RtpSpec&&l?{sendEncodings:[{scalabilityMode:l}]}:{}));c.push(L),O._updateRtpTransceiver(L)}),Ri()&&U("SIMULCAST")===!0&&(yield It(n.applySimulcastForFirefox(c,t)));let d=yield It(n.peerConnection.createOffer()),h=n.remoteSDP.predictReceivingMids(t.length),p=n.mungSendOfferSDP(d.sdp,t,h),_=kn(p),E=h.map(O=>{let L=_.mediaDescriptions.find(M=>M.attributes.mid===O);if(!L)throw new Error("Cannot extract ssrc from mediaDescription.");return yM(L,U("USE_PUB_RTX"))}),R;try{R=yield E}catch(O){R=[],n.remoteSDP.receive(t,i,r,R);let L=n.remoteSDP.toString();throw yield It(n.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield It(n.peerConnection.setRemoteDescription({type:"answer",sdp:L})),yield It(n.stopSending(h,!0)),O}n.remoteSDP.receive(t,i,r,R);let N=n.remoteSDP.toString(),w=n.logSDPExchange(p,"offer","local","send");return yield It(n.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield It(n.applySimulcastEncodings(c,t)),yield It(n.applySendEncodings(c,t)),w?.(N),yield It(n.peerConnection.setRemoteDescription({type:"answer",sdp:N})),c.map((O,L)=>{let M=h[L];return{localSSRC:E[L],id:M,transceiver:O}})}catch(c){throw c instanceof ne?c:new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{s()}})()}async createDataChannels(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")y.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:U("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}i.forEach(s=>{s._updateOriginDataChannel(r)});let{needExchangeSDP:n}=this.remoteSDP.sendDataChannel();if(n){let s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});let c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c),y.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else y.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof ne?r:new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{let i=this.dataStreamChannelMap.get(t);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(t)}catch(i){throw i instanceof ne?i:new ne(k.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(t,i){let r=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let n=this.peerConnection.getTransceivers().filter(d=>t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(d=>{var h;KR(this.id+d.mid,this),d.direction="inactive",(h=d.stop)===null||h===void 0||h.call(d)});let s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);let l=this.remoteSDP.toString();c?.(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}finally{r&&r()}}async receive(t,i,r,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:s,needExchangeSDP:c}=this.remoteSDP.send(t,i,r,n);c&&(await jd(this.peerConnection,this.remoteSDP,this.extension),y.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));let l=this.peerConnection.getTransceivers().find(d=>d.mid===s);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:s,transceiver:l}}catch(s){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:i,needExchangeSDP:r}=this.remoteSDP.batchSend(t);return r&&(await jd(this.peerConnection,this.remoteSDP,this.extension),y.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(n=>{let s=this.peerConnection.getTransceivers().find(c=>c.mid===n);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:n,transceiver:s}})}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(s=>{Array.from(this.preMediaMap.entries()).some(c=>{let[l,{mid:d,player:h}]=c;if(d===s)return this.preMediaMap.delete(l),h&&h.destroy(),!0})}),this.remoteSDP.stopSending(t);let i=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let n=await this.peerConnection.createAnswer();r?.(n.sdp||""),await this.peerConnection.setLocalDescription(n)}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let i=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let n=await this.peerConnection.createAnswer();r?.(n.sdp||""),await this.peerConnection.setLocalDescription(n)}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let i=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let n=await this.peerConnection.createAnswer();r?.(n.sdp||""),await this.peerConnection.setLocalDescription(n)}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(c=>{c.direction="inactive"});let r=await this.peerConnection.createOffer(),n=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);let s=this.remoteSDP.toString();n?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(c,l)=>{c.direction="sendonly"});let r=await this.peerConnection.createOffer(),n=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);let s=this.remoteSDP.toString();n?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(t){var i=this;return ja(function*(){let r=yield It(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let n=Ot().supportPCSetConfiguration,s=U("FORCE_TURN_TCP")||i.forceTurn;if(t===xr.RELAY&&!n)return;if(n&&!s){let _=t===xr.RELAY?"relay":"all",E=i.peerConnection.getConfiguration();E.iceTransportPolicy!==_&&(y.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(E.iceTransportPolicy,"] to [").concat(_,"]")),E.iceTransportPolicy=_,i.peerConnection.setConfiguration(E))}i.remoteSDP.updateCandidates(t);let c=yield It(i.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let l=Vd(c.sdp),{remoteIceParameters:d}=yield l.iceParameters;i.remoteSDP.restartICE(d);let h=i.remoteSDP.toString(),p=i.logSDPExchange(c.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield It(i.peerConnection.setLocalDescription(c)),p?.(h),yield It(i.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(n){y.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),n)}finally{r()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;let t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(xr.TCP_RELAY),await jd(this.peerConnection,this.remoteSDP,this.extension)}catch(i){y.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(i=>{KR(this.id+i.mid,this)}),this.preMediaMap.forEach(i=>{let{player:r}=i;r&&r.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return uo(uo({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let r=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(r.sdp,[i],[t]);this.remoteSDP.updateRecvMedia(t,i);let s=this.remoteSDP.toString(),c=this.logSDPExchange(n,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),c?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ne(k.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,i){let r=this.peerConnection.getTransceivers().filter(n=>n.mid===t);r.length===1&&(this.isVP8Simulcast(i)?Ri()||await this.applySimulcastEncodings(r,[i]):await this.applySendEncodings(r,[i]))}setStatsRemoteVideoIsReady(t,i){this.statsFilter.setVideoIsReady2(t,i)}async replaceTrack(t,i){let r=this.peerConnection.getTransceivers().find(n=>n.mid===i);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let i=t[0].transport.iceTransport,{local:r,remote:n}=i.getSelectedCandidatePair();return{local:uo(uo({},tc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:uo(uo({},tc),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var i;let r="code: ".concat(t.errorCode,", message: ").concat(t.errorText),n=t.port?"local: ".concat(t.port):"",s=Dh(t.url||"");y.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(r,"), url: ").concat(s||"",", host_candidate:").concat(n)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,r)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&y.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,y.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,y.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},U("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let i={iceServers:[]},r=t.cloudProxyServer||"disabled";return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&(bg(t.turnServer.servers)?i.iceServers=t.turnServer.servers:U("NEW_TURN_MODE")&&i.iceServers&&r==="disabled"?(U("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&i.iceServers.push(...zh.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):i.iceServers.push(...zh.newTurnServerConfigToIceServers(t.turnServer.servers)),U("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...zh.turnServerConfigToIceServers(t.turnServer.servers)),U("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...zh.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),U("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(n=>{n.forceturn&&(i.iceTransportPolicy="relay")}))),U("ENABLE_ENCODED_TRANSFORM")&&Ot().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(t){let i=[];return t.forEach(r=>{r.security?r.tcpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(xd(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!U("FORCE_TURN_TCP")&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(t){let i=[];return t.forEach(r=>{let n=U("NEW_TURN_MODE");n===1?i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}):n===2?i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}):n===3?i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(xd(r.turnServerURL),":443?transport=tcp")}):n===4&&(i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}),i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}),i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(xd(r.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(t){let i=t.transport;if(i){this.transportEventReceiver=t,i.onstatechange=()=>{var n;i!=null&&i.state&&((n=this.onDTLSTransportStateChange)===null||n===void 0||n.call(this,i.state))},i.onerror=n=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in n?n.error:n)};let r=i.iceTransport;r&&(r.onstatechange=()=>{let n=i?.iceTransport.state;var s;n&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,n))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){let{local:n,remote:s}=r.getSelectedCandidatePair()||{};if(n&&s){let c=n.address+":"+n.port,l=s.address+":"+s.port;y.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Dh(c)),", remote ").concat(JSON.stringify(Dh(l))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,i){var r,n;if(i||(i=this.peerConnection.getSenders().find(w=>w.track===t._mediaStreamTrack)),!i)return y.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return y.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ot().supportSetRtpSenderParameters)return y.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let s={},c={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}let l=(function(w,O){return w.getTransceivers().find(L=>L.sender.track===O||L.receiver.track===O)})(this.peerConnection,t._mediaStreamTrack),d=q8(t);if((function(w){var O;return!(!U("ENABLE_AG_ADAPTATION")||!(w instanceof _R||ve(O=w._hints).call(O,qt.CUSTOM_TRACK))||!U("FORCE_SUPPORT_AG_ADAPTATION")&&!($P(14,0,!1)&&eL(17,4)||QP(14)&&jA(17,4,!0)))})(t)&&l&&i&&d&&this.getLocalVideoStats&&ve(r=["vp8","vp9"]).call(r,this.store.codec)){var h;let w=s.degradationPreference||(ve(h=t._hints).call(h,qt.CUSTOM_TRACK)?U("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(O,L,M,B,Y,H){if(KR(O,M),Y(L),B!=="balanced"&&B!=="maintain-framerate"&&B!=="maintain-resolution")return;let G=-1;ix(O,L);let Q=window.setInterval(()=>{let he=zR.get(O);if(!U("ENABLE_AG_ADAPTATION")||!he)return KR(O,M),void Y(L);let Se=H();if(Se.sendPackets>0&&Se.OutgoingAvailableBandwidth>0){if(G===-1)return void(G=Date.now());if(Date.now()-G<1e3)return;let ht=Se.sendFrameRate,pt=Se.OutgoingAvailableBandwidth,[tt,xt]=oG(O,ht,pt,he.adaptationConfig,L,B);xt&&(M.qualityLimitationReason=xt),tt&&he.adaptationConfig.scale!==tt.scale&&(y.debug("[".concat(O,"] applyAdaptation: ").concat(M.qualityLimitationReason,`
           sendFps `).concat(ht,", bwe ").concat(pt,", switch from ").concat(he.adaptationConfig.scale," to ").concat(tt.scale," ")),he.adaptationConfig=lI(lI({},he.adaptationConfig),tt),Y(tt))}},U("CHECK_LOCAL_STATS_INTERVAL")),ce=lI({},L);zR.set(O,{timer:Q,adaptationConfig:ce,originConfig:L,adaptationFunc:Y}),y.debug("[".concat(O,"] start adaptation, originConfig: ").concat(JSON.stringify(L),", degradationPreference: ").concat(B))})(this.id+l.mid,d,this,w,O=>{i&&this.updateAdaptation(i,O)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var p;let{bitrateMax:w,frameRate:O,scaleResolutionDownBy:L}=t._encoderConfig;w&&(c.maxBitrate=1e3*w),(ve(p=t._hints).call(p,qt.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(O&&(c.maxFramerate=ea(O)),L&&L>=1&&(c.scaleResolutionDownBy=L))}let{maxFramerate:_}=U("ENCODER_CONFIG_LIMIT");if(_&&typeof _=="number"&&(c.maxFramerate=c.maxFramerate?Math.min(c.maxFramerate,_):_),U("DSCP_TYPE")&&sl()){var E;let w=U("DSCP_TYPE");ve(E=["very-low","low","medium","high"]).call(E,w)&&(c.networkPriority=w)}let R=i.getParameters(),N=(n=R.encodings)===null||n===void 0?void 0:n[0];Ri()&&!N&&(s.encodings=[c]),N&&Object.assign(N,c),Object.assign(R,s),y.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(R.encodings))),await i.setParameters(R),await(async function(w,O,L){try{var M;if(!Ot().supportSetRtpSenderParameters||!(function(Q){return Q==="vp9"||Q==="av1"})(w)||!U("ENABLE_SVC"))return;let B={},Y={},H=O.getParameters(),G=(M=H.encodings)===null||M===void 0?void 0:M[0];Y.scalabilityMode=LR(L),G&&Object.assign(G,Y),Object.assign(H,B),await O.setParameters(H),y.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(H.encodings)))}catch(B){y.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",B)}})(this.store.codec,i,U("SVC_MODE"))}async updateAdaptation(t,i){var r,n;if(!t)return y.debug("[updateAdaptation] no rtpSender found");if(!Ot().supportSetRtpSenderParameters)return y.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let s={},{bitrateMax:c,frameRate:l,scaleResolutionDownBy:d}=i;c&&(s.maxBitrate=1e3*c),l&&(s.maxFramerate=ea(l)),d&&d>=1&&ve(r=["vp8","vp9"]).call(r,this.store.codec)&&(s.scaleResolutionDownBy=d);let h=t.getParameters(),p=(n=h.encodings)===null||n===void 0?void 0:n[0];p&&Object.assign(p,s),Object.assign(h,{});try{await t.setParameters(h),y.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(h.encodings)))}catch(_){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?y.debug("[updateAdaptation] peerConnection not connected}"):y.debug("[updateAdaptation] updateRtpSenderEncodings failed",_):y.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,i){try{if(!Ot().supportSetRtpSenderParameters||t.length!==i.length)return;for(let r=0;r<t.length;r++){let n=t[r],s=i[r];s instanceof ai&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,n.sender)}}catch{y.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,i,r){let n=kn(t);return i.forEach((s,c)=>{let l=r[c],d=n.mediaDescriptions.find(h=>h.attributes.mid===l);d&&(Sm(d,s),wM(d,s,this.store.codec))}),Pd(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,i,r)=>{var n;(n=this.onFirstVideoDecoded)===null||n===void 0||n.call(this,t,i,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,i)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,i)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,i){if(t.length===i.length)for(let d=0;d<t.length;d++){var r,n,s,c,l;let h=t[d],p=i[d];if(p instanceof ai&&!ve(r=p._hints).call(r,qt.LOW_STREAM)&&(n=p._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=p._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){let _={},E={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];let R=h.sender.getParameters();await h.sender.setParameters(Object.assign(R,_))}}}async applySimulcastEncodings(t,i){if(!Ri()&&t.length===i.length)for(let r=0;r<t.length;r++){let n=i[r];if(n instanceof ai&&this.isVP8Simulcast(n)){let s=t[r],c={},l={high:1e3*(n._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];let d=s.sender.getParameters();await s.sender.setParameters(Object.assign(d,c))}}}isVP8Simulcast(t){var i,r,n,s,c;return!!(t instanceof ai&&U("SIMULCAST")&&this.store.codec==="vp8"&&!ve(i=t._hints).call(i,qt.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((n=t._encoderConfig)===null||n===void 0?void 0:n.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((c=t._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(t,i,r,n){if(U("SDP_LOGGING"))return y.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(i," SDP during P2PConnection.").concat(n,`
`),t),i==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",n)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;let i=this.remoteSDP.getSSRC(t);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(t){if(Ot().supportPCSetConfiguration){let i=zh.resolvePCConfiguration(t);this.peerConnection.setConfiguration(i)}t.isPreallocation&&(this.isPreallocation=!0)}},Be(bt.prototype,"updateRemoteRTPCapabilities",[Rn],Object.getOwnPropertyDescriptor(bt.prototype,"updateRemoteRTPCapabilities"),bt.prototype),Be(bt.prototype,"connect",[Rn],Object.getOwnPropertyDescriptor(bt.prototype,"connect"),bt.prototype),Be(bt.prototype,"updateRemoteConnect",[Rn],Object.getOwnPropertyDescriptor(bt.prototype,"updateRemoteConnect"),bt.prototype),Be(bt.prototype,"createDataChannels",[Rn],Object.getOwnPropertyDescriptor(bt.prototype,"createDataChannels"),bt.prototype),Be(bt.prototype,"receive",[Rn],Object.getOwnPropertyDescriptor(bt.prototype,"receive"),bt.prototype),Be(bt.prototype,"batchReceive",[Rn],Object.getOwnPropertyDescriptor(bt.prototype,"batchReceive"),bt.prototype),Be(bt.prototype,"stopReceiving",[Rn],Object.getOwnPropertyDescriptor(bt.prototype,"stopReceiving"),bt.prototype),Be(bt.prototype,"muteRemote",[Rn],Object.getOwnPropertyDescriptor(bt.prototype,"muteRemote"),bt.prototype),Be(bt.prototype,"unmuteRemote",[Rn],Object.getOwnPropertyDescriptor(bt.prototype,"unmuteRemote"),bt.prototype),Be(bt.prototype,"muteLocal",[Rn],Object.getOwnPropertyDescriptor(bt.prototype,"muteLocal"),bt.prototype),Be(bt.prototype,"unmuteLocal",[Rn],Object.getOwnPropertyDescriptor(bt.prototype,"unmuteLocal"),bt.prototype),Be(bt.prototype,"close",[Rn],Object.getOwnPropertyDescriptor(bt.prototype,"close"),bt.prototype),Be(bt.prototype,"updateEncoderConfig",[Rn],Object.getOwnPropertyDescriptor(bt.prototype,"updateEncoderConfig"),bt.prototype),Be(bt.prototype,"updateSendParameters",[Rn],Object.getOwnPropertyDescriptor(bt.prototype,"updateSendParameters"),bt.prototype),Be(bt.prototype,"replaceTrack",[Rn],Object.getOwnPropertyDescriptor(bt.prototype,"replaceTrack"),bt.prototype),Be(bt.prototype,"updateAdaptation",[Rn],Object.getOwnPropertyDescriptor(bt.prototype,"updateAdaptation"),bt.prototype),Be(bt.prototype,"getRemoteSSRC",[Rn],Object.getOwnPropertyDescriptor(bt.prototype,"getRemoteSSRC"),bt.prototype),bt);function Rn(e,t,i){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let n=this.mutex,s=await n.lock("From P2PConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await r.apply(this,l)}finally{s()}},i}function pI(e,t){let i=document.createElement("video"),r=document.createElement("canvas");i.setAttribute("style","display:none"),r.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),r.width=ea(t.width),r.height=ea(t.height);let n=ea(t.framerate||15);document.body.append(i),document.body.append(r);let s=e._mediaStreamTrack;i.srcObject=new MediaStream([s]),i.play();let c=r.getContext("2d");if(!c)throw new $(k.UNEXPECTED_ERROR,"can not get canvas context");let l=Ot(),d=r.captureStream(l.supportRequestFrame?0:n).getVideoTracks()[0];d.canvas||(d.canvas=r),r.startCapture=()=>{if(!i)return r.stopCapture&&r.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){let p=i.videoWidth,_=i.videoHeight/p,E=r.width*_;Math.abs(E-r.height)>=2&&(y.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(E)),r.height=E)}c.drawImage(i,0,0,r.width,r.height),d.requestFrame&&d.requestFrame(),s!==e._mediaStreamTrack&&(s=e._mediaStreamTrack,i.srcObject=new MediaStream([s]))},r.stopCapture=gw(()=>r.startCapture&&r.startCapture(),n);let h=d.stop;return d.stop=()=>{h.call(d),i&&(i.remove(),i.srcObject=null,i=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),y.debug("clean low stream renderer")},d}var ox=(function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e})(ox||{}),ho=(function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e})(ho||{}),ot=(function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e})(ot||{}),Er=(function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e})(Er||{}),yn=(function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e})(yn||{}),qR=(function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e})(qR||{});let Lh=1e3,XR=6,Kg=3,dG=Math.max(XR,Kg,60);function Ye(e,t,i){i!=null&&Number.isFinite(i)&&(e[t]=Math.round(Math.max(0,i)))}function cx(e){let t={[yn.CONN_TYPE]:0,[yn.RTT]:e.rtt,[yn.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let i=e.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(t[yn.CONN_TYPE]=1),i==="tcp"&&(t[yn.CONN_TYPE]=3),i==="tls"&&(t[yn.CONN_TYPE]=4);break}case"srflx":t[yn.CONN_TYPE]=2;break;case"unknown":t[yn.CONN_TYPE]=5;break;default:t[yn.CONN_TYPE]=0}return t}function lx(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class dx extends Ei{constructor(t){super(),D(this,"store",void 0),D(this,"uploadWRTCStatsTimer",void 0),D(this,"uploadOutboundDenoiserStatsTimer",void 0),D(this,"uploadExtStatsTimer",void 0),D(this,"uploadExtUsageStatsTimer",void 0),D(this,"uploadInboundExtStatsTimer",void 0),D(this,"requestStats",void 0),D(this,"requestTransportStats",void 0),D(this,"requestLocalMedia",void 0),D(this,"requestRemoteMedia",void 0),D(this,"requestAllTracks",void 0),D(this,"requestVideoIsReady",void 0),D(this,"requestUploadStats",void 0),D(this,"requestUpload",void 0),D(this,"uploadOutboundStarted",!1),D(this,"uploadInboundStarted",!1),D(this,"uploadTransportStarted",!1),D(this,"uploadBaseStatsStarted",!1),D(this,"uploadExtensionUsageStarted",!1),D(this,"lastRecvStats",void 0),D(this,"lastSendStats",void 0),D(this,"lastRefRecvStats",void 0),D(this,"lastRefSendStats",void 0),D(this,"lastNormalRecvStats",void 0),D(this,"lastNormalSendStats",void 0),D(this,"lastExtendStats",{}),D(this,"needUploadStats",{}),D(this,"needUploadRenderFreezeTime",!0),D(this,"lastUploadCompensateTime",-1),D(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;let i=t%Kg==0,r=t%XR==0,n=t%60==0,s,c;if(this.uploadTransportStarted&&(s=this.requestStats(),this.store.useP2P&&(c=this.requestStats(!0))),!s&&this.uploadOutboundStarted&&(s=this.requestStats()),!c&&this.uploadInboundStarted&&(c=this.requestStats(!0)),s||c){var l;let d={};if(this.uploadTransportStarted&&s){let p=this.getTransportStats(s,c,i);p&&(d.misc=[p])}if(this.uploadOutboundStarted&&s){let p=this.getOutboundStats(s,r?this.lastNormalSendStats:void 0,i?this.lastRefSendStats:void 0,this.lastSendStats,n);p&&(d.outbound=[p])}if(this.uploadInboundStarted&&c){this.uploadCompensateStats(t);let p=this.getInboundStats(c,r?this.lastNormalRecvStats:void 0,i?this.lastRefRecvStats:void 0,this.lastRecvStats);p&&(d.inbound=p)}let h=(l=this.requestTransportStats)===null||l===void 0?void 0:l.call(this).connectState;h&&(Array.isArray(d.misc)?d.misc[0]&&d.misc[0].addition&&(d.misc[0].addition[qR.RTC_PEER_CONNECTION_STATE]=iw[h]):d.misc=[{addition:{[qR.RTC_PEER_CONNECTION_STATE]:iw[h]}}]),this.needUploadStats.sendType&&(Array.isArray(d.outbound)&&d.outbound[0]&&d.outbound[0].high&&(d.outbound[0].high[ox.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(d)}this.lastRecvStats=c,this.lastSendStats=s,r&&(this.lastNormalRecvStats=c,this.lastNormalSendStats=s),i&&(this.lastRefRecvStats=c,this.lastRefSendStats=s)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var i,r;let n=(i=this.requestTransportStats)===null||i===void 0?void 0:i.call(this);return void(n&&((r=this.requestUploadStats)===null||r===void 0||r.call(this,{misc:[{addition:{[qR.RTC_PEER_CONNECTION_STATE]:iw[n.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===dG+1&&(t=1)},Lh)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;let i=t%Kg==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!i)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());let r=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=r,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;let n=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*n;let s=this.requestStats(!0);new Array(n).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;let c={};if(this.uploadInboundStarted&&s){let l=this.requestRemoteMedia()||[],d=[];l.forEach(h=>{let[p,_]=h,E={peer:p.uid};if(p._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(p._videoSSRC)&&_.has(Le.VIDEO)&&p.videoTrack){let R=(function(N,w,O){if(!w.videoRecv.find(M=>M.ssrc===N))return;let L={};if(O&&O._player){let M=O._player,{renderFreezeAccTime2:B,videoElementStatus:Y}=M;if(nc.visibility==="visible"&&Y===kr.PLAYING&&Ot().supportRequestVideoFrameCallback){let H=Math.min(6e3,B);M.renderFreezeAccTime2=Math.max(0,B-H),Ye(L,ho.Video_Render_Freeze_Time_Render2,H),U("USE_NEW_RENDER_FREEZE_TIME")&&Ye(L,ho.Video_Render_Freeze_Time_Render,H)}}return L})(p._videoSSRC,s,p.videoTrack);R&&(E.video=R)}E.video&&d.push(E)}),d.length>0&&(c.inbound=d,this.requestUploadStats(c))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,i,r){if(!this.requestStats)return;if(!r)return t.rtt==null?void 0:{addition:{[yn.RTT]:t.rtt,[yn.CONN_TYPE]:void 0,[yn.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};let n=cx(t);if(this.store.useP2P){if(i){let s=cx(i);n[yn.CONN_TYPE]+=s[yn.CONN_TYPE]<<3}n[yn.CONN_TYPE]+=110}else n[yn.CONN_TYPE]+=100;return{addition:n}}getOutboundStats(t,i,r,n,s){if(!this.requestUploadStats||!this.requestLocalMedia)return;let c=this.requestLocalMedia();if(!c||c.length===0)return;let l,d,h;return c.forEach(p=>{let[_,{track:E,ssrcs:R}]=p;switch(_){case me.LocalVideoLowTrack:case me.LocalVideoTrack:if(_===me.LocalVideoTrack){var N;let w=(function(B,Y,H,G,Q,ce){let he=Y.videoSend.find(tt=>tt.ssrc===B);if(!he)return;let Se={},{sentFrame:ht,inputFrame:pt}=he;if(G&&(Ye(Se,ho.Video_Send_Qp_Sum,he.qpSumPerFrame),pt&&ht)){let tt=pt.frameRate,xt=ht.frameRate;Se[ho.Video_Send_Freeze]=(function(Lt,Vr){let de=!0;return de=!(Lt<=5)&&(Lt<=10?Vr<3:Lt<=20?Vr<4:Vr<5),de})(tt,xt)?1:0}if(Q){switch(ht&&(Ye(Se,ot.Video_Send_Height,ht.height),Ye(Se,ot.Video_Send_Width,ht.width),Ye(Se,ot.Video_Send_Frame_Rate,ht.frameRate)),Se[ot.Video_Send_Disabled]=H._originMediaStreamTrack&&!H._originMediaStreamTrack.enabled||H._mediaStreamTrack&&!H._mediaStreamTrack.enabled?1:0,he.adaptionChangeReason){case"none":Se[ot.Video_Send_Adaptation]=0;break;case"cpu":Se[ot.Video_Send_Adaptation]=1;break;case"bandwidth":Se[ot.Video_Send_Adaptation]=2;break;case"other":Se[ot.Video_Send_Adaptation]=3}let tt=0;he.adaptionChangeReason&&(tt+=lx(he.adaptionChangeReason)),Y.qualityLimitationReason&&(tt+=lx(Y.qualityLimitationReason)<<3),Se[ot.Video_Send_Adaptation]=tt,Se[ot.Video_Send_Player_Status]=_w[H._player?H._player.videoElementStatus:"uninit"],Ye(Se,ot.Video_Send_Nacks,he.nacksCount),Ye(Se,ot.Video_Send_Plis,he.plisCount),Ye(Se,ot.Video_Send_Firs,he.firsCount),Ye(Se,ot.Video_Send_Avg_Encode,he.avgEncodeMs),Ye(Se,ot.Video_Send_Huge_Frame_Sent,he.hugeFramesSent),Ye(Se,ot.Video_Send_Bytes_Retransmit,he.retransmittedBytesSent),Ye(Se,ot.Video_Send_Packages_Retransmit,he.retransmittedPacketsSent),Ye(Se,ot.Video_Send_Key_Frames_Encoded,he.keyFramesEncoded);let xt=Q.videoSend.find(Lt=>Lt.ssrc===B);if(xt){let Lt=Lh*Kg;xt.timestamp&&he.timestamp&&(Lt=he.timestamp-xt.timestamp),xt.packets!=null&&he.packets!=null&&Ye(Se,ot.Video_Send_Package_Rate,1e3*(he.packets-xt.packets)/Lt),he.packetsLost!=null&&xt.packetsLost!=null&&Ye(Se,ot.Video_Send_Package_Lost,he.packetsLost-xt.packetsLost),xt.bytes!=null&&he.bytes!=null&&Ye(Se,ot.Video_Send_Bitrate,8*(he.bytes-xt.bytes)/Lt)}}return Se})(R[0].ssrcId,t,E,i,r),O=E.__className__==="CameraVideoTrack"?3:ve(N=E._hints).call(N,qt.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==O||s)&&(this.needUploadStats={sendType:O},this.lastExtendStats.sendType=O);let L=E&&(function(B,Y,H,G){let Q=Y.videoSend.find(he=>he.ssrc===B);if(!Q)return null;let ce={};if(G){let he=Q.inputFrame,Se=he&&he.height||H.videoHeight||0,ht=he&&he.width||H.videoWidth||0,pt=he&&he.frameRate||0;Ye(ce,ot.Video_Capture_Height,Se),Ye(ce,ot.Video_Capture_Width,ht),Ye(ce,ot.Video_Capture_Frame_Rate,pt)}return ce})(R[0].ssrcId,t,E,!!r),M=(function(B,Y){let H={};return Y&&(Ye(H,ot.Video_Send_Retransmit,B.bitrate.retransmit),Ye(H,ot.Video_Send_Target_Encoded,B.bitrate.targetEncoded),Ye(H,ot.Video_Send_Actual_Encoded,B.bitrate.actualEncoded),Ye(H,ot.Video_Send_Transmit,B.bitrate.transmit),Ye(H,ot.Video_Send_Bandwidth,B.sendBandwidth)),H})(t,!!r);d=Object.assign({},w,L,M)}else h=(function(w,O,L,M,B){let Y=O.videoSend.find(G=>G.ssrc===w);if(!Y)return;let H={};if(M){let G=Y.sentFrame;G&&(Ye(H,ot.Video_Send_Low_Height,G.height),Ye(H,ot.Video_Send_Low_Width,G.width),Ye(H,ot.Video_Send_Low_Frame_Rate,G.frameRate));let Q=M.videoSend.find(ce=>ce.ssrc===w);if(Q){let ce=Lh*XR;Q.timestamp&&Y.timestamp&&(ce=Y.timestamp-Q.timestamp),Q.packets!=null&&Y.packets!=null&&Ye(H,ot.Video_Send_Low_Package_Rate,1e3*(Y.packets-Q.packets)/ce),Y.packetsLost!=null&&Q.packetsLost!=null&&Ye(H,ot.Video_Send_Low_Package_Lost,Y.packetsLost-Q.packetsLost),Q.bytes!=null&&Y.bytes!=null&&Ye(H,ot.Video_Send_Low_Bitrate,8*(Y.bytes-Q.bytes)/ce)}}return H})(R[0].ssrcId,t,0,r);break;case me.LocalAudioTrack:l=E&&(function(w,O,L,M,B,Y){let H=O.audioSend.find(Q=>Q.ssrc===w);if(!H)return;let G={};if(B){G[ot.Audio_Send_Disabled]=L._originMediaStreamTrack&&!L._originMediaStreamTrack.enabled||L._mediaStreamTrack&&!L._mediaStreamTrack.enabled?1:0;let Q=100*L._source.getAccurateVolumeLevel(),ce=H.inputLevel;if(ce!=null){let Se=Math.ceil(50*Math.log10(100*ce+1));Ye(G,ot.Audio_Send_Level,Se)}Ye(G,ot.Audio_Capture_PCM_Level,Q),Ye(G,ot.Audio_Send_AEC_Return_Loss,H.aecReturnLoss),Ye(G,ot.Audio_Send_AEC_Return_Loss_Enhancement,H.aecReturnLossEnhancement),Ye(G,ot.Audio_Send_Bytes_Retransmit,H.retransmittedBytesSent),Ye(G,ot.Audio_Send_Packages_Retransmit,H.retransmittedPacketsSent),G[ot.Audio_Send_Freeze]=0;let he=B.audioSend.find(Se=>Se.ssrc===w);if(he){let Se=Lh*XR;he.timestamp&&H.timestamp&&(Se=H.timestamp-he.timestamp),he.bytes!=null&&H.bytes!=null&&Ye(G,ot.Audio_Send_Bitrate,8*(H.bytes-he.bytes)/Se),he.packets!=null&&H.packets!=null&&Ye(G,ot.Audio_Send_Package_Rate,1e3*(H.packets-he.packets)/Se)}}return G})(R[0].ssrcId,t,E,0,r)}}),{high:d,low:h,audio:l}}getInboundStats(t,i,r,n){if(!this.requestRemoteMedia)return;let s=this.requestRemoteMedia()||[],c=[];return s.forEach(l=>{let[d,h]=l,p={peer:d.uid};if(h.has(Le.VIDEO)&&d.videoTrack){let _=d._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(d._videoSSRC)||!1,E=d.videoTrack?(function(R,N,w,O,L,M,B,Y){let H=N.videoRecv.find(tt=>tt.ssrc===R);if(!H)return;let G={},{receivedFrame:Q,outputFrame:ce,decodeFrameRate:he}=H;Ye(G,Er.Video_Render_Frame_Rate_Decode,he),H.framesRateFirefox&&Ye(G,Er.Video_Recv_Frame_Rate,H.framesRateFirefox),Q&&Ye(G,Er.Video_Recv_Frame_Rate,Q.frameRate),Ye(G,Er.Video_Recv_Frame_Dropped,H.framesDroppedCount),Ye(G,Er.Video_Recv_Bytes_Retransmit,H.retransmittedBytesReceived),Ye(G,Er.Video_Recv_Packages_Retransmit,H.retransmittedPacketsReceived),Ye(G,Er.Video_Recv_Packages_Discarded,H.packetsDiscarded),Ye(G,Er.Video_Recv_Avg_Decode,H.avgDecodeMs),Ye(G,Er.Video_Recv_Avg_Processing_Delay,H.avgProcessingDelayMs),Ye(G,Er.Video_Recv_Avg_Assembly_Time,H.avgFramesAssembledFromMultiplePacketsMs),Ye(G,Er.Video_Recv_Avg_Inter_Frame_Delay,H.avgInterFrameDelayMs),Ye(G,Er.Video_Recv_Key_Frames_Decoded,H.keyFramesDecoded);let Se=Y&&Y.videoRecv.find(tt=>tt.ssrc===R);if(Se){let tt=N.timestamp-Y.timestamp||Lh;H.packetsLost!=null&&Se.packetsLost!=null&&Ye(G,Er.Video_Recv_Package_Lost,H.packetsLost-Se.packetsLost),Se.bytes!=null&&H.bytes!=null&&Ye(G,Er.Video_Recv_Bitrate,8*(H.bytes-Se.bytes)/tt),Se.packets!=null&&H.packets!=null&&Ye(G,Er.Video_Recv_Package_Rate,1e3*(H.packets-Se.packets)/tt)}let ht=M&&M.videoRecv.find(tt=>tt.ssrc===R);if(ht&&(Ye(G,ho.Video_Recv_Qp_Sum,H.qpSumPerFrame),G[ho.Video_Recv_Freeze]=O&&zg.isRemoteVideoFreeze(w,H,ht)?1:0),B){var pt;let tt=B.videoRecv.find(Lt=>Lt.ssrc===R);Q?(Ye(G,ot.Video_Recv_Height,Q.height),Ye(G,ot.Video_Recv_Width,Q.width)):w&&(Ye(G,ot.Video_Recv_Height,w._videoHeight||0),Ye(G,ot.Video_Recv_Width,w._videoWidth||0)),ce&&Ye(G,ot.Video_Recv_Frame_Rate_Output,ce.frameRate);let xt=(pt=w._player)===null||pt===void 0?void 0:pt.rendFrameRate.toFixed(0);if(xt&&Ye(G,ot.Video_Render_Frame_Rate_Render,+xt),Ye(G,ot.Video_Recv_Jitter_Buffer,H.jitterBufferMs),Ye(G,ot.Video_Recv_Current_Delay,H.currentDelayMs),Ye(G,ot.Video_Recv_Firs,H.firsCount),Ye(G,ot.Video_Recv_Nacks,H.nacksCount),Ye(G,ot.Video_Recv_Plis,H.plisCount),w){G[ot.Video_Recv_Disabled]=w._originMediaStreamTrack.enabled&&w._mediaStreamTrack.enabled?0:1;let Lt=w._player;if(Lt){let{freezeTimeCounterList:Vr,renderFreezeAccTime:de,renderFreezeAccTime2:ye,videoElementStatus:ke}=Lt;if(Vr&&Vr.length>0&&Ye(G,ho.Video_Render_Freeze_Time,Vr.splice(0,1)[0]),L&&nc.visibility==="visible"&&ke===kr.PLAYING&&Ot().supportRequestVideoFrameCallback){let fe=Math.min(6e3,ye);Lt.renderFreezeAccTime2=Math.max(0,ye-fe),Ye(G,ho.Video_Render_Freeze_Time_Render2,fe);let A=Math.min(6e3,de);Lt.renderFreezeAccTime=Math.max(0,de-A),Ye(G,ho.Video_Render_Freeze_Time_Render,U("USE_NEW_RENDER_FREEZE_TIME")?fe:A)}if(typeof H.totalFreezesDuration=="number"){let fe=tt&&tt.totalFreezesDuration?H.totalFreezesDuration-tt.totalFreezesDuration:H.totalFreezesDuration;Ye(G,ot.Video_Render_Freeze_Duration,1e3*fe)}}}if(G[ot.Video_Recv_Player_Status]=_w[w._player?w._player.videoElementStatus:"uninit"],tt&&H.totalInterFrameDelay!==void 0&&H.totalSquaredInterFrameDelay!==void 0&&tt.totalInterFrameDelay!==void 0&&tt.totalSquaredInterFrameDelay!==void 0){let Lt=H.totalInterFrameDelay-tt.totalInterFrameDelay,Vr=H.totalSquaredInterFrameDelay-tt.totalSquaredInterFrameDelay,de=H.framesDecodeCount-tt.framesDecodeCount,ye=Lt/de*1e3,ke=Math.round(1e3*Math.sqrt((Vr-Math.pow(Lt,2)/de)/de));!isNaN(ke)&&ye+ke>Math.max(3*ye,ye+150)&&(G[ot.Video_Recv_I_Frame_Delay]=ke)}}return G})(d._videoSSRC,t,d.videoTrack,_===!0,this.needUploadRenderFreezeTime,i,r,n):void 0;E&&(p.video=E)}if(h.has(Le.AUDIO)&&d.audioTrack){let _=d.audioTrack?(function(E,R,N,w,O,L){let M=R.audioRecv.find(G=>G.ssrc===E);if(!M)return;let B={};Ye(B,Er.Audio_Recv_Jitter,M.jitterMs),Ye(B,Er.Audio_Recv_Bytes_Retransmit,M.retransmittedBytesReceived),Ye(B,Er.Audio_Recv_Packages_Retransmit,M.retransmittedPacketsReceived),Ye(B,Er.Audio_Recv_Packages_Discarded,M.packetsDiscarded),Ye(B,Er.Audio_Recv_Avg_Processing_Delay,M.avgProcessingDelayMs);let Y=L&&L.audioRecv.find(G=>G.ssrc===E);if(Y){let G=Lh;M.packets!=null&&Y.packets!=null&&Ye(B,Er.Audio_Recv_Package_Rate,1e3*(M.packets-Y.packets)/G),M.packetsLost!=null&&Y.packetsLost!=null&&Ye(B,Er.Audio_Recv_Package_Lost,M.packetsLost-Y.packetsLost)}if(w){let{receivedFrames:G,droppedFrames:Q}=M;G!=null&&Q!=null&&(B[ho.Audio_Recv_Freeze]=(H=G)===0||100*Q/H>20?1:0)}var H;if(O){let G=100*N._source.getAccurateVolumeLevel(),Q=M.outputLevel;if(Q!=null){let he=Math.ceil(50*Math.log10(100*Q+1));Ye(B,ot.Audio_Render_Level,he)}Ye(B,ot.Audio_Recv_PCM_Level,G),N&&(B[ot.Audio_Recv_Disabled]=N._originMediaStreamTrack.enabled&&N._mediaStreamTrack.enabled?0:1),Ye(B,ot.Audio_Recv_Jitter_Buffer,M.jitterBufferMs),Ye(B,ot.Audio_Recv_Current_Delay,M.jitterBufferMs),B[ot.Audio_Recv_Player_Status]=_w[vn.getPlayerState(N.getTrackId())];let ce=O.audioRecv.find(he=>he.ssrc===E);if(ce){ce.bytes!=null&&M.bytes!=null&&Ye(B,ot.Audio_Recv_Bitrate,8*(M.bytes-ce.bytes)/(Lh*Kg));let he=M.concealedSamples-ce.concealedSamples;he>0&&Ye(B,ot.Audio_Recv_Concealed_Samples,he);let Se=M.totalSamplesReceived-ce.totalSamplesReceived;Se>0&&Ye(B,ot.Audio_Recv_Total_Samples_Received,Se);let ht=M.freezeSamples80-ce.freezeSamples80;ht>0&&Ye(B,ot.Audio_Render_Freeze_Samples_80ms,ht);let pt=M.freezeSamples200-ce.freezeSamples200;pt>0&&Ye(B,ot.Audio_Render_Freeze_Samples_200ms,pt);let tt=M.freezeMs80-ce.freezeMs80;Ye(B,ot.Audio_Render_Freeze_Time_80ms,tt<0?0:tt);let xt=M.freezeMs200-ce.freezeMs200;Ye(B,ot.Audio_Render_Freeze_Time_200ms,xt<0?0:xt)}}return B})(d._audioSSRC,t,d.audioTrack,i,r,n):void 0;_&&(p.audio=_)}(p.video||p.audio)&&c.push(p)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,c}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let t=(this.requestAllTracks()||[]).find(i=>i instanceof Lg);if(t&&t._external.getDenoiserStats){let i=t._external.getDenoiserStats();i&&this.requestUpload(Mg.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[i,r]=t;r.has(Le.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)}),r.has(Le.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let i=Date.now(),r={connectionInterval:U("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i},n=[],s=this.requestAllTracks&&this.requestAllTracks()||[];for(let h of s)!h.muted&&h.enabled&&(n=n.concat(await h.getProcessorUsage()));let c=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[h,p]of c)p.has(Le.VIDEO)&&h.videoTrack&&(n=n.concat(await h.videoTrack.getProcessorUsage())),p.has(Le.AUDIO)&&h.audioTrack&&(n=n.concat(await h.audioTrack.getProcessorUsage()));if(n.length===0)return;r.details=(function(h,p){let _={};for(let{id:w,value:O,level:L,direction:M}of h){var E;let B=(E=p.get(w))!==null&&E!==void 0?E:0,Y=O===2?B+U("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:B;var R,N;p.set(w,Y),_[w]?(O===2&&(_[w].value=O),L>_[w].level&&(_[w].level=L),M==="remote"&&(_[w].remoteUidCount+=1),_[w].totalTs=(R=p.get(w))!==null&&R!==void 0?R:0):_[w]={value:O,level:L,remoteUidCount:M==="local"?0:1,totalTs:(N=p.get(w))!==null&&N!==void 0?N:0}}return Object.keys(_).map(w=>{let{level:O,value:L,totalTs:M}=_[w];return{id:w,level:O,value:L,totalTs:M}})})(n,t);let l=Date.now(),d=l>i?l:i+1;this.requestUpload&&this.requestUpload(Mg.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:d})},U("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}let uG=U("ICE_RESTART_INTERVAL"),JR=new Map,Cm=new Map,Hd=[xr.UDP_TCP_RELAY,xr.TCP_RELAY,xr.RELAY],fI=U("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ot().supportPCSetConfiguration;function ux(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=JR.get(e.id);i&&(window.clearTimeout(i),JR.delete(e.id));let r=Cm.get(e.id);t&&r&&r.index===Hd.length-1&&(y.debug("[".concat(e.id,"] reset ICE restart policy")),Cm.delete(e.id))}function hx(e,t,i){if(JR.size===0&&Cm.size===0&&(Array.isArray(U("RESTART_SEQUENCE"))&&U("RESTART_SEQUENCE").length>0&&!(function(l,d){if(l.length!==d.length)return!1;for(let h=0;h<l.length;h+=1){let p=l[h];if(l.filter(_=>_===p).length!==d.filter(_=>_===p).length)return!1}return!0})(Hd,U("RESTART_SEQUENCE"))&&(Hd=U("RESTART_SEQUENCE").filter(l=>{var d;if(ve(d=Object.values(xr)).call(d,l))return!0}),y.debug("use reconnection policy from config distribution, queues: ".concat(Hd.join(" => ")))),fI=U("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ot().supportPCSetConfiguration),Hd.length===0)return void i();let r,{index:n=0,type:s}=Cm.get(e.id)||{};if(fI&&s===xr.RELAY)return void i();let c=s&&n>=Hd.length-1;if(fI)s=xr.RELAY;else{if(c)return void i();s?(n++,s=Hd[n]):(s=Hd[0],n=0)}y.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(s,", index: ").concat(n)),t(s),Cm.set(e.id,{index:n,type:s}),r=window.setTimeout(()=>hx(e,t,i),uG),JR.set(e.id,r)}var Et;function px(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function oc(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?px(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):px(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function fx(e){var t,i,r,n=2;for(typeof Symbol<"u"&&(i=OA,r=Symbol.iterator);n--;){if(i&&(t=e[i])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new ZR(t.call(e));i="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function ZR(e){function t(i){if(Object(i)!==i)return we.reject(new TypeError(i+" is not an object."));var r=i.done;return we.resolve(i.value).then(function(n){return{value:n,done:r}})}return ZR=function(i){this.s=i,this.n=i.next},ZR.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(i){var r=this.s.return;return r===void 0?we.resolve({value:i,done:!0}):t(r.apply(this.s,arguments))},throw:function(i){var r=this.s.return;return r===void 0?we.reject(i):t(r.apply(this.s,arguments))}},new ZR(e)}let Yg=(Et=class extends Ei{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(ze.StateChange,t,this._state)}constructor(e,t){super(),D(this,"isPlanB",void 0),D(this,"store",void 0),D(this,"statsUploader",void 0),D(this,"connection",void 0),D(this,"localTrackMap",new Map),D(this,"remoteUserMap",new Map),D(this,"localDataChannels",[]),D(this,"remoteDataChannelMap",new Map),D(this,"pendingLocalTracks",[]),D(this,"pendingRemoteTracks",[]),D(this,"pendingLocalDataChannels",[]),D(this,"pendingRemoteDataChannels",[]),D(this,"statsCollector",void 0),D(this,"shouldForwardP2PCreation",void 0),D(this,"iceFailedCount",0),D(this,"dtlsFailedCount",0),D(this,"mutex",void 0),D(this,"_state",jt.Disconnected),D(this,"_pcStatsUploadType",U("NEW_ICE_RESTART")?dl.FIRST_CONNECTION:dl.OLD_FIRST_CONNECTION),D(this,"_isStartRestartIce",!1),D(this,"_restartTimer",void 0),D(this,"_isTryConnecting",!1),D(this,"_iceError",null),D(this,"_forceTurn",!1),D(this,"_isWaitPcToRePub",!1),D(this,"handleMuteLocalTrack",async(i,r,n)=>{let s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==jt.Connected)return void n(new ne(k.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let c=this.filterTobeMutedTracks(i);if(c.length===0)return void r();let l=c.find(h=>h[0]==="videoLowTrack");if(l){let h=l[1];this.store.enableInstantMuteRestore?(h.track._originMediaStreamTrack.enabled=!1,y.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):h.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?y.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(c.map(h=>{let[,{id:p}]=h;return p}));let d=this.createMuteMessage(c);await Jt(this,ze.RequestMuteLocal,d),r()}catch(c){n(c)}finally{s()}}),D(this,"handleUnmuteLocalTrack",async(i,r,n)=>{let s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==jt.Connected)return void n(new ne(k.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let c=this.filterTobeUnmutedTracks(i);if(c.length===0)return void r();let l=c.find(h=>h[0]==="videoLowTrack");if(l){let h=l[1];if(this.store.enableInstantMuteRestore)h.track._originMediaStreamTrack.enabled=!0,y.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(h.track._originMediaStreamTrack.stop(),!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ot().supportDualStreamEncoding){let p=i._mediaStreamTrack.clone();h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}else{let p=pI(i,Ag(this,ze.RequestLowStreamParameter));h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}await new we((p,_)=>{this.handleReplaceTrack(h.track,p,_,!0)})}}this.store.enableInstantMuteRestore?y.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(c.map(h=>{let[,{id:p}]=h;return p}));let d=this.createUnmuteMessage(c);await Jt(this,ze.RequestUnmuteLocal,d),r()}catch(c){n(c)}finally{s()}}),D(this,"handleUpdateVideoEncoder",async(i,r,n,s)=>{let c;s||(c=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{let d=this.localTrackMap.get(me.LocalVideoTrack);if(!this.connection||!d||d.track!==i||this.state!==jt.Connected)return void r();let{id:h,track:p}=d;await this.connection.updateSendParameters(h,p),await this.connection.updateEncoderConfig(h,p),this.emit(ze.UpdateVideoEncoder,p),r()}catch(d){n(d)}finally{var l;(l=c)===null||l===void 0||l()}}),D(this,"handleUpdateVideoSendParameters",async(i,r,n)=>{let s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let c=this.localTrackMap.get(me.LocalVideoTrack);if(!this.connection||!c||c.track!==i||this.state!==jt.Connected)return void r();let{id:l,track:d}=c;await this.connection.updateSendParameters(l,d),r()}catch(c){n(c)}finally{s()}}),D(this,"handleReplaceMixingTrack",async(i,r,n,s)=>{if(!this.connection||this.state!==jt.Connected)return void r();let c=uI([i]),l;y.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(c.getTrackId(),"]")),typeof s=="boolean"&&s||(l=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,c),r()}catch(h){n(h)}finally{var d;(d=l)===null||d===void 0||d()}}),D(this,"handleReplaceTrack",async(i,r,n,s)=>{let c;y.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;let h=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:_}]=p;return i===_});if(!this.connection||!h||this.state!==jt.Connected)return void r();if(await((l=this.connection)===null||l===void 0?void 0:l.replaceTrack(i,h[1].id)),this.isPlanB){let p=h[1];p.id=i._mediaStreamTrack.id,this.localTrackMap.set(h[0],p)}if(h[0]===me.LocalVideoTrack&&!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ot().supportDualStreamEncoding){let p=this.localTrackMap.get(me.LocalVideoLowTrack);if(p){let _=i._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=_,p.track._originMediaStreamTrack=_,await new we((E,R)=>{this.handleReplaceTrack(p.track,E,R,!0)})}}r()}catch(h){n(h)}finally{var d;(d=c)===null||d===void 0||d()}}),D(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),D(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),D(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),D(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),D(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new dx(this.store),this.bindStatsUploaderEvents(),this.mutex=new Lr("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Ot().supportUnifiedPlan||U("CHROME_FORCE_PLAN_B")&&sl(),this.shouldForwardP2PCreation=U("FORWARD_P2P_CREATION")&&Ot().supportPCSetConfiguration&&HA(),this.shouldForwardP2PCreation&&(this.connection=YR(this.store),this.emit(ze.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var i;this.state=jt.New,this._forceTurn=ax(e),y.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));let r=this.shouldForwardP2PCreation&&((i=this.connection)===null||i===void 0?void 0:i.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||r||t)&&((r||t)&&this.connection&&(y.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=YR(this.store,e),this.emit(ze.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new ne(k.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=U("NEW_ICE_RESTART")?dl.FIRST_CONNECTION:dl.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new ne(k.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===jt.Connected){if(this.connection instanceof Ka&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return y.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),Fe.reportApiInvoke(this.store.sessionId,{name:Oi.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:pi.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(ze.RequestReconnect)});await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=jt.Connected}updateRemoteRTPCapabilities(e){let t=Array.from(this.localTrackMap.entries()).filter(n=>{var s;let[c]=n;return ve(s=[me.LocalVideoLowTrack,me.LocalVideoTrack]).call(s,c)}),i=t.map(n=>{let[,{id:s}]=n;return s}),r=t.map(n=>{let[s]=n;return s});if(this.connection instanceof Ka){if(Fe.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!ve(e).call(e,this.store.codec)){let n=["vp9","vp8","h264"].find(s=>ve(e).call(e,s));n&&(this.store.codec=n,y.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(n,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async getEstablishParams(){var e;if(this.connection instanceof Ka&&this.connection.peerConnectionState!=="closed"&&ve(e=[jt.New,jt.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==jt.Connected){if(this.state===jt.Disconnected)throw new ne(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(i=>{var r;ve(r=this.pendingLocalDataChannels).call(r,i)||this.pendingLocalDataChannels.push(i)}),[]}let t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(i=>{let r=Date.now();this.store.publish(i.id.toString(),"datachannel",r)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(i=>{this.localDataChannels.push(i);let r=Date.now();this.store.publish(i.id+"","datachannel",void 0,r)}),e.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(e,t,i){var r=this;return ja(function*(){let n=yield It(r.mutex.lock("From P2PChannel.publish"));try{var s;let c=r.connection&&ve(s=["disconnected","failed"]).call(s,r.connection.peerConnectionState);if(!r.connection||r.state!==jt.Connected||c){if(r.state===jt.Disconnected)throw new ne(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);let d=e.filter(h=>r.pendingLocalTracks.indexOf(h)===-1);return r.pendingLocalTracks=r.pendingLocalTracks.concat(d),void(c&&(r._isWaitPcToRePub=!0))}r.store.pubId=r.store.pubId+1,Ur.markPublishStart(r.store.clientId,r.store.pubId);let l=r.filterTobePublishedTracks(e,t,i);if(l.length===0)return void(yield It(r.tryToUnmuteAudio(e)));yield*H0(fx(r.doPublish(r.connection,l)))}finally{n()}})()}doPublish(e,t){var i=this;return ja(function*(){t.forEach(E=>{let{track:R,type:N}=E,w=Date.now();i.store.publish(R.getTrackId(),N===me.LocalAudioTrack?"audio":"video",w)}),i.bindLocalTrackEvents(t);let r=t.map(E=>{let{track:R}=E;return R}),n=yield It(e.send(r,i.store.codec,i.store.audioCodec)),s=(yield It(n.next())).value,c=i.createGatewayPublishMessage(t,s),l;try{l=yield c}catch(E){throw n.throw(E),E?.code===k.WS_ABORT&&t.forEach(R=>{let{track:N}=R;i.pendingLocalTracks.indexOf(N)===-1&&i.pendingLocalTracks.push(N)}),i.unbindLocalTrackEvents(t),E}let d=i.mapPubResToRemoteConfig(c,l,r),h=(yield It(n.next(d))).value;if(i.state===jt.Disconnected)throw new ne(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");U("ENABLE_VIDEO_SEI");let p=U("ENABLE_ENCODED_TRANSFORM"),_=U("ENABLE_AUDIO_METADATA");r.forEach(async E=>{let R=E.getRTCRtpTransceiver();if(!R||!p)return;let{interceptLocalVideoFrame:N,interceptLocalAudioFrame:w}=VR();E.trackMediaType===Le.VIDEO?await N(R.sender,E):E.trackMediaType===Le.AUDIO&&await w(R.sender,{metadata:_?()=>{let O=E.metadata.shift();return O&&O.value}:void 0})}),t.forEach(E=>{let{type:R}=E;i.statsCollector.addLocalStats(R)}),i.assignLocalTracks(t,h),i.statsUploader.startUploadOutboundStats(),t.forEach(E=>{let{track:R,type:N}=E,w=Date.now();i.store.publish(R.getTrackId(),N===me.LocalAudioTrack?"audio":"video",void 0,w)})})()}async updateVideoStreamParameter(e,t){let i=this.localTrackMap.get(t);if(!i||!this.connection)return;if(!(i.track instanceof ai))return y.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");let{track:r}=i,n=(function(s,c){let l={};return s.height&&s.width&&(l.scaleResolutionDownBy=Yw(s,c)),l.maxFramerate=s.framerate?ea(s.framerate):void 0,l.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,l})(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==me.LocalVideoLowTrack||!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ot().supportDualStreamEncoding)n.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=n.scaleResolutionDownBy);else{let s=r._originMediaStreamTrack;if(!s.canvas)return y.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(c,l){let d=c.canvas;l.width&&(d.width=ea(l.width)),l.height&&(d.height=ea(l.height)),l.framerate&&(d.stopCapture&&d.stopCapture(),d.stopCapture=gw(()=>{!d.startCapture&&d.stopCapture&&d.stopCapture(),d.startCapture&&d.startCapture()},ea(l.framerate)))})(s,e)}n.maxBitrate!=null&&(r._encoderConfig.bitrateMax=n.maxBitrate/1e3),n.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=n.maxFramerate:r._encoderConfig.frameRate={max:n.maxFramerate}),y.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return ja(function*(){if(!t.connection||t.state!==jt.Connected)return;let i=yield It(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let n=t.localTrackMap.get(me.LocalVideoTrack);if(!n)throw new ne(k.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(me.LocalVideoLowTrack))throw new ne(k.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));let s=[{track:t.getLowVideoTrack(n.track,e),type:me.LocalVideoLowTrack}];if(yield*H0(fx(t.doPublish(t.connection,s))),n.track.muted||!n.track.enabled){var r;let c=(r=t.localTrackMap.get(me.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;c!==void 0&&(yield It(t.connection.muteLocal([c])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(y.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Cr(this,ze.RequestRePublish,this.pendingLocalTracks),this.emit(ze.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(y.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Cr(this,ze.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){let{user:i,kind:r}=this.pendingRemoteTracks[t];(r!==Le.AUDIO||i._audio_added_&&i._audioSSRC)&&(r!==Le.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Cr(this,ze.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:t,kind:i}of this.pendingRemoteTracks)await this.subscribe(t,i,i===Le.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:i}=t;this.emit(ze.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==jt.Connected)return void e.forEach(r=>{let n=this.pendingLocalTracks.indexOf(r);n!==-1&&this.pendingLocalTracks.splice(n,1)});let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let i=t.find(r=>r[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==jt.Connected)return void e.forEach(i=>{let r=this.pendingLocalDataChannels.indexOf(i);r!==-1&&this.pendingLocalDataChannels.splice(r,1)});let t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(i=>{let r=this.localDataChannels.indexOf(i);r!==-1&&this.localDataChannels.splice(r,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==jt.Connected)return;let e=this.localTrackMap.get(me.LocalVideoLowTrack);if(!e)return;e.track.close();let t=[[me.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){let i=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(r=>{let[,{id:n}]=r;return n})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[n,{track:s}]=r;return{type:n,track:s}})),t.forEach(r=>{let[n]=r;this.statsCollector.removeLocalStats(n)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,t){if(!this.connection||this.state!==jt.Connected)throw new ne(k.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let i=t.filter(r=>{var n;return!((n=this.remoteDataChannelMap.get(e))!==null&&n!==void 0&&n.get(r.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(r=>{var n;this.remoteDataChannelMap.has(e)?(n=this.remoteDataChannelMap.get(e))===null||n===void 0||n.set(r.id,r):this.remoteDataChannelMap.set(e,new Map([[r.id,r]]));let s=this.pendingRemoteDataChannels.findIndex(c=>{let{user:l,id:d}=c;return l.uid===e.uid&&d===r.id});s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),i.map(r=>r.id)}async subscribe(e,t,i,r,n){var s;if(!this.connection||this.state!==jt.Connected)throw new ne(k.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(e))!==null&&s!==void 0&&s.has(t))return;let c,l,d,h,p=this.connection.getPreMedia(i);if(p)y.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),d=p.transceiver,c=p.track,l=p.mid,h=p.player,p.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:p.firstVideoRender});else if(n){let R=n.find(w=>{let{stream_type:O}=w;return O===t});if(!R)throw new ne(k.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));let N=await this.connection.receive(t,R.ssrcs,String(e._uintid),R.attributes);this.connection instanceof Ka&&(d=N.transceiver),c=N.track,l=N.id}else{let R=await this.connection.receive(t,[{ssrcId:i,rtx:r}],String(e._uintid),void 0);this.connection instanceof Ka&&(d=R.transceiver),c=R.track,l=R.id}if(t===Le.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(c):(e._audioTrack=new um(c,e.uid,e._uintid,this.store),y.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),d&&e._audioTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(c):(e._videoTrack=new dm(c,e.uid,e._uintid,this.store,h),y.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(Ha.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(Ha.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),h?e._videoTrack.once(Ha.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(Ha.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),d&&e._videoTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(e,e._videoTrack)),d&&U("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:R,interceptRemoteAudioFrame:N}=VR();t==Le.VIDEO?await R(d.receiver,{onSei:U("ENABLE_VIDEO_SEI")&&(w=>{var O;return(O=e._videoTrack)===null||O===void 0?void 0:O._onSei(w)})}):t==Le.AUDIO&&await N(d.receiver,{enableTopn:!!U("ENABLE_AUDIO_TOPN"),enableMetadata:!!U("ENABLE_AUDIO_METADATA"),enablePts:!!U("ENABLE_AUDIO_PTS"),onMetadata:w=>{this.safeEmit(ze.AudioMetadata,w)},onPts:w=>{this.safeEmit(ze.AudioPts,w)}})}let _=this.remoteUserMap.get(e);_?_.set(t,l):this.remoteUserMap.set(e,new Map([[t,l]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let E=this.pendingRemoteTracks.findIndex(R=>{let{user:N,kind:w}=R;return N.uid===e.uid&&t===w});E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(ze.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==jt.Connected)throw new ne(k.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(n=>{var s;let{user:c,mediaType:l}=n;return!((s=this.remoteUserMap.get(c))!==null&&s!==void 0&&s.has(l))});let t=[],i=new Map;e.forEach(n=>{if(!this.connection)return;let s=this.connection.getPreMedia(n.ssrcId);if(s){let{track:c,mid:l,transceiver:d,player:h}=s;i.set(n.ssrcId,{track:c,id:l,transceiver:d,player:h})}else t.push(n)});let r=await this.connection.batchReceive(t.map(n=>{let{user:s,mediaType:c,ssrcId:l,rtxSsrcId:d}=n;return{kind:c,ssrcMsg:[{ssrcId:l,rtx:d}],mslabel:String(s._uintid)}}));t.forEach((n,s)=>{i.set(n.ssrcId,r[s])});for(let{user:n,mediaType:s,ssrcId:c}of e){let l=i.get(c);if(!l)return void y.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(n.uid," subscribe data,").concat(s,", ").concat(c));let{track:d,id:h,transceiver:p,player:_}=l;if(p&&U("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:N,interceptRemoteAudioFrame:w}=VR();s==Le.VIDEO?await N(p.receiver,{onSei:U("ENABLE_VIDEO_SEI")&&(O=>{var L;return(L=n._videoTrack)===null||L===void 0?void 0:L._onSei(O)})}):s==Le.AUDIO&&await w(p.receiver,{enableTopn:!!U("ENABLE_AUDIO_TOPN"),enableMetadata:!!U("ENABLE_AUDIO_METADATA"),enablePts:!!U("ENABLE_AUDIO_PTS"),onMetadata:O=>{this.safeEmit(ze.AudioMetadata,O)},onPts:O=>{this.safeEmit(ze.AudioPts,O)}})}if(s===Le.AUDIO?(n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(d):(n._audioTrack=new um(d,n.uid,n._uintid,this.store),y.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),p&&n._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(d):(n._videoTrack=new dm(d,n.uid,n._uintid,this.store,_),y.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId()))),p&&n._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(n,n._videoTrack)),U("ENABLE_VIDEO_SEI")&&p){let{interceptRemoteVideoFrame:N,interceptRemoteAudioFrame:w}=VR();s==Le.VIDEO?await N(p.receiver,{onSei:O=>{var L;(L=n._videoTrack)===null||L===void 0||L._onSei(O)}}):s==Le.AUDIO&&await w(p.receiver)}let E=this.remoteUserMap.get(n);E?E.set(s,h):this.remoteUserMap.set(n,new Map([[s,h]])),this.statsCollector.addRemoteStats(n.uid),this.statsUploader.startUploadInboundStats();let R=this.pendingRemoteTracks.findIndex(N=>{let{user:w,kind:O}=N;return w.uid===n.uid&&s===O});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(ze.MediaReconnectEnd,n.uid))}}async unsubscribe(e,t,i){let r=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:d}=c;return t!==void 0?l.uid===e.uid&&t===d:l.uid===e.uid});if(r.forEach(c=>{let l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.connection&&this.state===jt.Connected||i||r.forEach(c=>{let{kind:l}=c;var d;if(l===Le.AUDIO)(d=e._audioTrack)===null||d===void 0||d._destroy(),e._audioTrack=void 0;else if(l===Le.VIDEO){var h;(h=e._videoTrack)===null||h===void 0||h._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==jt.Connected)return;let n=this.filterTobeUnSubscribedTracks(e,t);if(n.length===0)return;await this.connection.stopReceiving(n.map(c=>{let[,{id:l}]=c;return l}));let s=this.createUnsubscribeMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(c=>{let[l,{kind:d}]=c;var h,p;if(d===Le.VIDEO&&l._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),d===Le.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),i||((p=l._videoTrack)===null||p===void 0||p._destroy(),l._videoTrack=void 0);else if(d===Le.AUDIO){var _;this.unbindRemoteTrackEvents(l._audioTrack),!i&&((_=l._audioTrack)===null||_===void 0||_._destroy(),l._audioTrack=void 0)}}),s}async unsubscribeDataChannel(e,t){if(t.forEach(n=>{let s=this.pendingRemoteDataChannels.findIndex(c=>c.id===n.id);s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),!this.connection)return;let i=this.filterTobeUnSubscribedDataChannels(e,t);if(i.length===0)return;t.forEach(n=>{n._close()});let r=this.remoteDataChannelMap.get(e);return i.forEach(n=>{r&&r.delete(n.id)}),r&&r.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(n=>n.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(let{user:n,mediaType:s}of e){let c=this.pendingRemoteTracks.filter(l=>{let{user:d,kind:h}=l;return s!==void 0?d.uid===n.uid&&s===h:d.uid===n.uid});c.forEach(l=>{let d=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(d,1)}),t=t.concat(c)}if(!this.connection||this.state!==jt.Connected)return void t.forEach(n=>{let{user:s,kind:c}=n;var l;if(c===Le.AUDIO)(l=s._audioTrack)===null||l===void 0||l._destroy(),s._audioTrack=void 0;else if(c===Le.VIDEO){var d;(d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0}});let i=In(e).call(e,(n,s)=>{let{user:c,mediaType:l}=s,d=this.filterTobeUnSubscribedTracks(c,l);return n.concat(d)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(n=>{let[,{id:s}]=n;return s}));let r=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(n=>{let[s,{kind:c}]=n;var l,d;if(c===Le.VIDEO&&s._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),c===Le.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0;else if(c===Le.AUDIO){var h;this.unbindRemoteTrackEvents(s._audioTrack),(h=s._audioTrack)===null||h===void 0||h._destroy(),s._audioTrack=void 0}}),r}isPreSubScribe(e){return!this.connection||this.state!==jt.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;let i=this.remoteUserMap.get(e);if(!i)return void y.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(t))return void y.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let r=t===Le.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;let i=this.remoteUserMap.get(e);if(!i)return void y.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(t)||y.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){let t=this.localTrackMap.get(me.LocalAudioTrack),i=t&&t.track;i&&i.metadata.push(e)}getAllTracks(e){let t=this.localTrackMap.get(me.LocalAudioTrack);if(t?.track instanceof qi){let i=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[n]=r;return n!==me.LocalAudioTrack}).filter(r=>{let[n]=r;return!(e&&n===me.LocalVideoLowTrack)}).map(r=>{let[,{track:n}]=r;return n}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return!(e&&r===me.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,i,r,n){if(e){let c=this.localTrackMap.get(me.LocalAudioTrack),l=r?this.localTrackMap.get(me.LocalVideoLowTrack):this.localTrackMap.get(me.LocalVideoTrack);Fe.publish(this.store.sessionId,{eventElapse:Ur.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c?.track.getTrackLabel(),videoName:l?.track.getTrackLabel(),screenshare:l?.track._hints.indexOf(qt.SCREEN_TRACK)!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:n})}else{var s;i||(i=[]);let c=i.find(d=>d instanceof Ai),l=r?(s=this.localTrackMap.get(me.LocalVideoTrack))===null||s===void 0?void 0:s.track:i.find(d=>d instanceof ai);Fe.publish(this.store.sessionId,{eventElapse:Ur.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c?.getTrackLabel(),videoName:l?.getTrackLabel(),screenshare:l?._hints.indexOf(qt.SCREEN_TRACK)!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:n})}}reportSubscribeEvent(e,t,i,r){let n=r===Le.VIDEO?i._videoSSRC:i._audioSSRC;n&&Fe.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Le.VIDEO,audio:r===Le.AUDIO,peerid:i.uid,subscribeRequestid:n,p2pid:this.store.p2pId,eventElapse:Ur.measureFromSubscribeStart(this.store.clientId,n),preSsrc:this.isPreSubScribe(n)})}reset(){y.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Lr("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=YR(this.store),this.emit(ze.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(me.LocalAudioTrack);if(e?.track instanceof qi){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(i=>{t.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=jt.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(me.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(me.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof ai||t&&t.track instanceof Ai?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}getRemoteMedia(e){var t;let i=Array.from(Mn(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[r]=i;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(me.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=ct(e).call(e,(i,r)=>i.level-r.level),e}async disconnectForReconnect(){this.connection&&(y.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=jt.Reconnecting,U("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var i;t._videoTrack&&t._videoTrack._player&&((i=t._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=YR(this.store),this.emit(ze.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[i,{track:r}]=e;switch(i){case me.LocalVideoTrack:ve(t=r._hints).call(t,qt.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case me.LocalAudioTrack:r instanceof qi?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case me.LocalVideoLowTrack:}}),this.emit(ze.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;Array.from(Mn(i).call(i)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(ze.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,i]=e;Array.from(Mn(i).call(i)).forEach(r=>{this.setPendingRemoteDataChannel(t,r)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),y.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(let i of this.pendingRemoteDataChannels){let{user:r,id:n}=i;if((e instanceof Gd?e.uid:e)===r.uid&&n===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(let i of this.pendingRemoteTracks){let{user:r,kind:n}=i;if((e instanceof Gd?e.uid:e)===r.uid&&t===n)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return ja(function*(){if(!t.connection||t.state!==jt.Connected)return;let i=yield It(t.mutex.lock("From P2PChannel.restartICE")),r;try{r=yield It(t.connection.restartICE(e));let s=yield It(r.next());if(s.done)return;let c=s.value,l=yield c;switch(hI(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case xr.UDP_TCP_RELAY:t._pcStatsUploadType=dl.UDP_TCP_RESTART;break;case xr.TCP_RELAY:t._pcStatsUploadType=dl.TCP_RESTART;break;case xr.RELAY:t._pcStatsUploadType=dl.RELAY_RESTART;break;default:t._pcStatsUploadType=dl.OLD_RESTART}t._isTryConnecting=!0,r.next(l)}catch(s){var n;(n=r)===null||n===void 0||n.throw(s)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=this.localTrackMap.get(me.LocalVideoTrack),i=this.localTrackMap.get(me.LocalAudioTrack),r=e.videoSend.find(R=>R.ssrc===t?.ssrcs[0].ssrcId),n=e.audioSend.find(R=>R.ssrc===i?.ssrcs[0].ssrcId);if(!r||!n)return 1;let s=fa(this,ze.NeedSignalRTT),c=r?r.rttMs:void 0,l=n?n.rttMs:void 0,d=c&&l?(c+l)/2:c||l,h=(d&&s?(d+s)/2:d||s)||0,p=100*e.sendPacketLossRate*.7/50+.3*h/1500,_=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,E=t?.track;if(E&&E._encoderConfig&&E._hints.indexOf(qt.SCREEN_TRACK)===-1){let R=E._encoderConfig.bitrateMax,N=e.bitrate.actualEncoded;if(R&&N){let w=(1e3*R-N)/(1e3*R);return eM[w<.15?0:w<.3?1:w<.45?2:w<.6?3:4][_]}}return _}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[r]=i,n=r._audioSSRC,s=r._videoSSRC,c=e.audioRecv.find(N=>N.ssrc===n),l=e.videoRecv.find(N=>N.ssrc===s);if(!c&&!l)return void(t+=1);let d=fa(this,ze.NeedSignalRTT),h=e.rtt,p=(h&&d?(h+d)/2:h||d)||0,_=c?c.jitterMs:void 0,E=e.recvPacketLossRate,R=.7*E*100/50+.3*p/1500;_&&(R=.6*E*100/50+.2*p/1500+.2*_/400),t+=R<.1?1:R<.17?2:R<.36?3:R<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new we((t,i)=>{this.handleMuteLocalTrack(e,t,i)})}async replaceTrack(e,t){var i;if(y.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==jt.Connected)return;let r=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:c}]=s;return e===c});if(!r)return;let n=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:n}]),this.bindLocalTrackEvents([{track:t,type:n}]),r[1].track=t),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(t,r[1].id)),this.isPlanB){let s=r[1];s.id=t._mediaStreamTrack.id,this.localTrackMap.set(n,s)}if(n===me.LocalVideoTrack&&!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ot().supportDualStreamEncoding){let s=this.localTrackMap.get(me.LocalVideoLowTrack);if(s){let c=e._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=c,s.track._originMediaStreamTrack=c,await new we((l,d)=>{this.handleReplaceTrack(s.track,l,d,!0)})}}}filterTobePublishedTracks(e,t,i){let r=[],n=this.getAllTracks();e=Zf(e=e.filter(d=>n.indexOf(d)===-1));let s,c=!1,l=this.localTrackMap.get(me.LocalAudioTrack);for(let d of e){if(d instanceof ai&&(this.localTrackMap.has(me.LocalVideoTrack)||c?new ne(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:d,type:me.LocalVideoTrack}),c=!0),t)){let h=this.getLowVideoTrack(d,i);r.push({track:h,type:me.LocalVideoLowTrack})}if(d instanceof Ai)if(l){let h=l.track;if(h instanceof qi)dI([d]),h.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0);else{let p=uI([h,d]);y.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(p.getTrackId(),"]")),this.replaceTrack(h,p)}}else s instanceof qi?(dI([d]),s.addAudioTrack(d)):s||!d._useAudioElement&&Ot().webAudioMediaStreamDest&&!d._bypassWebAudio?s=uI(s?[d,s]:[d]):s=d}return s&&(y.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),r.push({track:s,type:me.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){let t=[],i=this.getAllTracks();e=Zf(e=e.filter(r=>i.indexOf(r)!==-1));for(let r of e){if(r instanceof Ai){let n=this.localTrackMap.get(me.LocalAudioTrack);if(!n)continue;n.track instanceof qi?(n.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),n.track.trackList.length===0&&(t.push([me.LocalAudioTrack,n]),n.track.close())):t.push([me.LocalAudioTrack,n])}if(r instanceof ai){let n=this.localTrackMap.get(me.LocalVideoTrack);if(!n)continue;t.push([me.LocalVideoTrack,n]);let s=this.localTrackMap.get(me.LocalVideoLowTrack);s&&t.push([me.LocalVideoLowTrack,s])}}return t}filterTobePublishedDataChannels(e){return e=(e=Zf(e)).filter(t=>this.localDataChannels.findIndex(i=>i.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Zf(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:i,type:r}=t;switch(r){case me.LocalVideoTrack:i.addListener(xe.GET_STATS,this.handleGetLocalVideoStats),i.addListener(xe.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(xe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(xe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(xe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(xe.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(xe.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(xe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(xe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case me.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case me.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof qi?e.trackList.forEach(i=>{i.addListener(xe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(xe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(xe.GET_STATS,this.handleGetLocalAudioStats),i.addListener(xe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(xe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(xe.GET_STATS,this.handleGetLocalAudioStats),e.addListener(xe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(xe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(xe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(xe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(xe.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(xe.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[i,{track:r}]=t;return{track:r,type:i}})),e.forEach(t=>{let{track:i,type:r}=t;switch(r){case me.LocalVideoTrack:i.off(xe.GET_STATS,this.handleGetLocalVideoStats),i.off(xe.GET_RTC_STATS,this.handleGetRTCStats),i.off(xe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(xe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(xe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(xe.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(xe.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(xe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(xe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case me.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case me.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof qi?e.trackList.forEach(t=>{t.off(xe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(xe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(xe.GET_STATS,this.handleGetLocalAudioStats),t.off(xe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(xe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(xe.GET_STATS,this.handleGetLocalAudioStats),e.off(xe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(xe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(xe.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(xe.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(xe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(xe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof dm&&t.addListener(xe.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),t instanceof um&&t.addListener(xe.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(xe.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;i.has(Le.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),i.has(Le.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((i,r)=>{var n;let s,c,{track:l,type:d}=i;switch(d){case me.LocalAudioTrack:s=Ft.Audio,c={dtx:l instanceof Lg&&l._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case me.LocalVideoTrack:s=ve(n=l._hints).call(n,qt.SCREEN_TRACK)?Ft.Screen:Ft.High,c=oc(oc({},_M(l)),{},{codec:this.store.codec,svc_mode:LR()});break;case me.LocalVideoLowTrack:s=Ft.Low,c=oc(oc({},_M(l)),{},{codec:this.store.codec,svc_mode:LR()})}return{stream_type:s,attributes:c,ssrcs:t[r]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var i;let r,[n,{track:s,ssrcs:c,id:l}]=t;switch(n){case me.LocalVideoTrack:r=ve(i=s._hints).call(i,qt.SCREEN_TRACK)?Ft.Screen:Ft.High;break;case me.LocalAudioTrack:r=Ft.Audio;break;case me.LocalVideoLowTrack:r=Ft.Low}return{stream_type:r,ssrcs:c,mid:l}})}assignLocalTracks(e,t){e.forEach((i,r)=>{let{track:n,type:s}=i;this.localTrackMap.set(s,{track:n,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[i]=t;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(ze.PeerConnectionStateChange,t),t==="connecting"&&e instanceof Ka&&!Ri()&&U("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},U("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Ka&&ux(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=dl.DISCONNECTED_OR_FAILED,fa(this,ze.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){let i=this.pendingLocalTracks.map(n=>n.getTrackId()),r=this.pendingLocalDataChannels.map(n=>"dc_".concat(n.id));Fe.reportApiInvoke(this.store.sessionId,{name:Oi.REPUB_AFTER_PC_CONNECTED,options:i.concat(r),tag:pi.TRACER}).onSuccess(),this.republish()}if(U("NEW_ICE_RESTART")&&e instanceof Ka&&!Ri()&&!this._forceTurn){if(ve(dM).call(dM,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let i=n=>{hI(e)&&(y.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(n)),fa(this,ze.QueryClientConnectionState)==="CONNECTED"&&this.emit(ze.RequestRestartICE,n))},r=()=>{hI(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),y.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(ze.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{hx(e,i,r)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&U("ICE_RESTART")&&fa(this,ze.QueryClientConnectionState)==="CONNECTED"&&this.emit(ze.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(y.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(ze.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(y.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(ze.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Fe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:pi.TRACER}).onSuccess(),this.emit(ze.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var i;let r=Array.from(Mn(i=this.remoteUserMap).call(i)).find(s=>s._audioSSRC===t);var n;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(n=r.audioTrack)===null||n===void 0||n.emit(Ha.FIRST_FRAME_DECODED),Fe.firstRemoteFrame(this.store.sessionId,er.FIRST_AUDIO_DECODE,ui.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Ur.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var i;let r=Array.from(Mn(i=this.remoteUserMap).call(i)).find(n=>n._audioSSRC===t);r&&Fe.firstRemoteFrame(this.store.sessionId,er.FIRST_AUDIO_RECEIVED,ui.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Ur.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,i,r)=>{var n;let s=Array.from(Mn(n=this.remoteUserMap).call(n)).find(c=>c._videoSSRC===t);s&&this.store.firstVideoFrameDecoded(s.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,i,r)},e.onFirstVideoRender=t=>{var i;let r=Array.from(Mn(i=this.remoteUserMap).call(i)).find(n=>n._videoSSRC===t);r&&(this.store.firstVideoFrameDecoded(r.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(r))},e.onFirstVideoReceived=t=>{var i;let r=Array.from(Mn(i=this.remoteUserMap).call(i)).find(n=>n._videoSSRC===t);r&&(this.store.firstVideoFrameDecoded(r.uid,{firstReceived:Date.now()}),Fe.firstRemoteFrame(this.store.sessionId,er.FIRST_VIDEO_RECEIVED,ui.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Ur.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(t,i)=>{let r=t.candidateType==="relay",n=i.candidateType==="relay";i.candidateType!=="unknown"&&r===n||this.emit(ze.ConnectionTypeChange,r),y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ud(i))," -> ").concat(JSON.stringify(Ud(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,i)=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ud(i))," -> ").concat(JSON.stringify(Ud(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let t=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return oc(oc({},t),i)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof Ka&&(function(t){Cm.delete(t.id),ux(t)})(e),e.close(),this.emit(ze.PeerConnectionStateChange,"closed"),(function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0})(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let i=this.localTrackMap.get(me.LocalAudioTrack);if(e instanceof Ai&&i?.track instanceof qi)return i.track.isActive||t.push([me.LocalAudioTrack,i]),t;let r=Array.from(this.localTrackMap.entries()).find(n=>{let[,{track:s}]=n;return e===s});if(r&&(t.push(r),r[0]===me.LocalVideoTrack)){let n=this.localTrackMap.get(me.LocalVideoLowTrack);n&&t.push([me.LocalVideoLowTrack,n])}return t}filterTobeUnmutedTracks(e){let t=[],i=this.localTrackMap.get(me.LocalAudioTrack);if(e instanceof Ai&&i?.track instanceof qi)return i.track.isActive&&t.push([me.LocalAudioTrack,i]),t;let r=Array.from(this.localTrackMap.entries()).find(n=>{let[,{track:s}]=n;return e===s});if(r)if(r[0]===me.LocalVideoTrack){t.push(r);let n=this.localTrackMap.get(me.LocalVideoLowTrack);n&&t.push([me.LocalVideoLowTrack,n])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var i;let r,[n,{track:s,ssrcs:c,id:l}]=t;switch(n){case me.LocalAudioTrack:r=Ft.Audio;break;case me.LocalVideoTrack:r=ve(i=s._hints).call(i,qt.SCREEN_TRACK)?Ft.Screen:Ft.High;break;case me.LocalVideoLowTrack:r=Ft.Low}return{stream_type:r,ssrcs:c,mid:l}})}createUnmuteMessage(e){return e.map(t=>{var i;let r,[n,{track:s,ssrcs:c,id:l}]=t;switch(n){case me.LocalAudioTrack:r=Ft.Audio;break;case me.LocalVideoTrack:r=ve(i=s._hints).call(i,qt.SCREEN_TRACK)?Ft.Screen:Ft.High;break;case me.LocalVideoLowTrack:r=Ft.Low}return{stream_type:r,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(e,t){let i=[],r=this.remoteUserMap.get(e);if(!r)return i;if(t){let n=r.get(t);if(!n)return i;i.push([e,{kind:t,id:n}])}else Array.from(r.entries()).forEach(n=>{let[s,c]=n;i.push([e,{kind:s,id:c}])});return i}filterTobeUnSubscribedDataChannels(e,t){let i=[];return t.forEach(r=>{var n;(n=this.remoteDataChannelMap.get(e))!==null&&n!==void 0&&n.has(r.id)&&i.push(r)}),i}createUnsubscribeMessage(e){let t=[];return e.forEach(i=>{let[r,{kind:n,id:s}]=i;switch(n){case Le.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Le.VIDEO,ssrcId:r._videoSSRC}));case Le.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Le.AUDIO,ssrcId:r._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){let t=new Map;return e.forEach(i=>{let[r,{kind:n}]=i;if(t.has(r)){let s=t.get(r);n===Le.VIDEO?s|=nr.Video:s|=nr.Audio,t.set(r,s)}else n===Le.VIDEO?t.set(r,nr.Video):t.set(r,nr.Audio)}),{users:Array.from(t.entries()).map(i=>{let[r,n]=i;return{stream_id:r.uid,stream_type:n}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[i,{kind:r}]=t,n=this.remoteUserMap.get(i);n&&(n.delete(r),Array.from(n.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(me.LocalVideoTrack),i=this.localTrackMap.get(me.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new we((r,n)=>{this.handleUpdateVideoEncoder(t.track,r,n,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new we((r,n)=>{this.handleUpdateVideoEncoder(i.track,r,n,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof Ka&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof Ka&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,i){return e.map((r,n)=>{var s;let{stream_type:c}=r,l=(s=t.find(d=>{let{stream_type:h}=d;return c===h}))===null||s===void 0?void 0:s.attributes;if(l&&U("DISABLE_SCREEN_SHARE_REMB")){let d=i[n]._hints;(ve(d).call(d,qt.SCREEN_TRACK)||ve(d).call(d,qt.SCREEN_LOW_TRACK))&&(l.remb=!1,y.debug("disable remb for screen share, hints:",d))}return l})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof Ai){var t;let r=this.filterTobeUnmutedTracks(e[i]);if(r.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map(s=>{let[,{id:c}]=s;return c})));let n=this.createUnmuteMessage(r);return void await Jt(this,ze.RequestUnmuteLocal,n)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(ze.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(ze.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await fr(ZA(this.dtlsFailedCount,Wi)),this.emit(ze.RequestReconnect)}async reconnectP2P(){let e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Cr(this,ze.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(ze.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(me.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof ai)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof ai).length>1)throw new ne(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Ai).length>1&&(e.some(t=>t instanceof Ai&&t._bypassWebAudio)||!Ot().webAudioMediaStreamDest))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof ai&&this.pendingLocalTracks.some(i=>i instanceof ai))throw new ne(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Ai&&this.pendingLocalTracks.some(i=>i instanceof Ai)&&(!Ot().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Ai&&i._bypassWebAudio)))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var i;let r=!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ot().supportDualStreamEncoding,n=oc(oc({},{width:160,height:120,framerate:15,bitrate:50}),t),s;s=r?e._mediaStreamTrack.clone():pI(e,n);let c=Zt(8,"track-low-"),l=new ai(s,oc(oc({},r&&{scaleResolutionDownBy:Yw(n,e)}),{},{frameRate:n.framerate,bitrateMax:n.bitrate,bitrateMin:n.bitrate}),void 0,void 0,c);return l.on(Ch.TRANSCEIVER_UPDATED,d=>{e._updateRtpTransceiver(d,nm.LOW_STREAM)}),l._hints.push(qt.LOW_STREAM),ve(i=e._hints).call(i,qt.SCREEN_TRACK)&&l._hints.push(qt.SCREEN_LOW_TRACK),e.on("sei-to-send",d=>{l.emit("sei-to-send",d)}),e.addListener(xe.NEED_CLOSE,()=>{l.close()}),l}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ka){var n,s,c,l;let d=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:h,dtlsTransportState:p,peerConnectionState:_}=this.connection,{local:E,remote:R}=await this.connection.getSelectedCandidatePair();Fe.pcStats(this.store.sessionId,{startTime:d,eventElapse:e-d||0,iceconnectionsate:h,dtlsstate:p,connectionstate:_,intSucc:t?1:2,error:this._iceError||r||"",selectedLocalCandidateProtocol:(n=E?.protocol)!==null&&n!==void 0?n:"",selectedLocalCandidateType:(s=E.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(E.address,":").concat(E.port),selectedRemoteCandidateProtocol:(c=R.protocol)!==null&&c!==void 0?c:"",selectedRemoteCandidateType:(l=R.candidateType)!==null&&l!==void 0?l:"",selectedRemoteCandidateAddress:"".concat(R.address,":").concat(R.port),restartCnt:i,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){let t=this.store.keyMetrics,i=t.firstVideoFrameDecoded.find(p=>p.userId===e.uid);if(!i)return;let{isInternalUpload:r,isExternalUpload:n}=i;if(r&&n)return;let{subscribeEnd:s,firstPreRender:c,peerPublishDuration:l,peerPubStatusMs:d}=i,{firstRender:h=0}=i;if(s&&(h||c)&&l&&d){i.isInternalUpload=!0;let{playEnd:p}=i;p&&(i.isExternalUpload=!0);let{firstPreRender:_=0}=i;h=_||h;let E=e.videoTrack,R={peer:e._uintid,width:E?._videoWidth||0,height:E?._videoHeight||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:l,peerPubStatusMs:d,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:i.userJoinNotify||0,videoAddNotify:i.videoAddNotify||0,subscribeStart:i.subscribeStart||0,subscribeEnd:i.subscribeEnd||0,firstReceived:i.firstReceived||0,firstDecoded:i.firstDecoded||0,firstPreRender:_||0,firstRender:p?Math.max(h,p):Math.max(h,s),playStart:i.playStart||0,playEnd:i.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:jL(this.store)};Fe.firstXLAPeerFirstVideoFrame(this.store.sessionId,R)}}reportVideoFirstFrameDecoded(e,t,i,r){var n;let s=Array.from(Mn(n=this.remoteUserMap).call(n)).find(c=>c._videoSSRC===e);if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());let c=this.store.keyMetrics,l=c.subscribe.find(d=>d.userId===s.uid&&d.type==="video");Fe.firstRemoteVideoDecode(this.store.sessionId,er.FIRST_VIDEO_DECODE,ui.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:i,subscribeElapse:Ur.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:l?.subscribeEnd||0,subscriberStart:l?.subscribeStart||0,videoAddNotify:l?.streamAdded||0,state:r?1:0,firstFrame:l?.firstFrame||0})}}async remoteMediaSsrcChanged(e,t,i){if(!this.connection)return!1;let r=this.remoteUserMap.get(e);if(!r)return!1;let n=r.get(t);if(!n)return!1;let s=await this.connection.getRemoteSSRC(n);return s!==void 0&&s!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:i}]=e;t===me.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,nm.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},Be(Et.prototype,"startP2PConnection",[en],Object.getOwnPropertyDescriptor(Et.prototype,"startP2PConnection"),Et.prototype),Be(Et.prototype,"connect",[en],Object.getOwnPropertyDescriptor(Et.prototype,"connect"),Et.prototype),Be(Et.prototype,"updateRemoteRTPCapabilities",[en],Object.getOwnPropertyDescriptor(Et.prototype,"updateRemoteRTPCapabilities"),Et.prototype),Be(Et.prototype,"publishDataChannel",[en],Object.getOwnPropertyDescriptor(Et.prototype,"publishDataChannel"),Et.prototype),Be(Et.prototype,"unpublish",[en],Object.getOwnPropertyDescriptor(Et.prototype,"unpublish"),Et.prototype),Be(Et.prototype,"unpublishDataChannel",[en],Object.getOwnPropertyDescriptor(Et.prototype,"unpublishDataChannel"),Et.prototype),Be(Et.prototype,"unpublishLowStream",[en],Object.getOwnPropertyDescriptor(Et.prototype,"unpublishLowStream"),Et.prototype),Be(Et.prototype,"subscribeDataChannel",[en],Object.getOwnPropertyDescriptor(Et.prototype,"subscribeDataChannel"),Et.prototype),Be(Et.prototype,"subscribe",[en],Object.getOwnPropertyDescriptor(Et.prototype,"subscribe"),Et.prototype),Be(Et.prototype,"massSubscribe",[en],Object.getOwnPropertyDescriptor(Et.prototype,"massSubscribe"),Et.prototype),Be(Et.prototype,"unsubscribe",[en],Object.getOwnPropertyDescriptor(Et.prototype,"unsubscribe"),Et.prototype),Be(Et.prototype,"unsubscribeDataChannel",[en],Object.getOwnPropertyDescriptor(Et.prototype,"unsubscribeDataChannel"),Et.prototype),Be(Et.prototype,"massUnsubscribe",[en],Object.getOwnPropertyDescriptor(Et.prototype,"massUnsubscribe"),Et.prototype),Be(Et.prototype,"muteRemote",[en],Object.getOwnPropertyDescriptor(Et.prototype,"muteRemote"),Et.prototype),Be(Et.prototype,"unmuteRemote",[en],Object.getOwnPropertyDescriptor(Et.prototype,"unmuteRemote"),Et.prototype),Be(Et.prototype,"hasRemoteMediaWithLock",[en],Object.getOwnPropertyDescriptor(Et.prototype,"hasRemoteMediaWithLock"),Et.prototype),Be(Et.prototype,"disconnectForReconnect",[en],Object.getOwnPropertyDescriptor(Et.prototype,"disconnectForReconnect"),Et.prototype),Be(Et.prototype,"updateBitrateLimit",[en],Object.getOwnPropertyDescriptor(Et.prototype,"updateBitrateLimit"),Et.prototype),Be(Et.prototype,"remoteMediaSsrcChanged",[en],Object.getOwnPropertyDescriptor(Et.prototype,"remoteMediaSsrcChanged"),Et.prototype),Et);function en(e,t,i){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let n=this.mutex,s=await n.lock("From P2PChannel.".concat(t));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await r.apply(this,l)}finally{s()}},i}function mx(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function _x(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?mx(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):mx(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let hG=Date.now(),pG=20,mI=new Map,QR=new Map;async function Ex(e){let t=mI.get(e),i=Array.isArray(t)&&t[t.length-1],r=QR.get(e);if(!i)return void(r.isSyncing=!1);let n={uid:i.uid,payload:i.payload};r.firstRecvTs===0&&(r.firstRecvTs=i.recvTs,r.firstSendTs=i.sendTs);let s=i.sendTs-r.firstSendTs,c=s-(Date.now()-r.firstRecvTs);c>0&&(r.firstRecvTs=Date.now()-s);let l=i.mediaDelay+c;l<=0?(t.pop(),gx(i.context,n),l=0):l=Math.min(l,pG),setTimeout(()=>t.length&&Ex(e),l)}function gx(e,t){e.safeEmit(Tt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function fG(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return gx(i,{uid:e.uid,payload:e.payload});let r="".concat(i.id,"-").concat(e.uid),n=mI.get(r)||[],s=n.findIndex(h=>e.sendTs>=h.sendTs),c=_x(_x({},e),{},{context:i,mediaDelay:t,recvTs:Date.now()});s===-1?n.push(c):n.splice(s,0,c),mI.set(r,n);let l=!1;var d;QR.has(r)?l=!((d=QR.get(r))===null||d===void 0||!d.isSyncing):QR.set(r,{isSyncing:l,firstRecvTs:0,firstSendTs:0}),l||Ex(r)}let mG=Ct().name;function Sx(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function Tx(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Sx(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Sx(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let bm="websdk_ng_cache_parameter",_G=U("MAX_PRELOAD_ASYNC_LENGTH"),EG=1e4,kh=new Map,Mh=[],_I=null,EI=0,gI=0,$R=new Map,gG=(function(e,t){let i=[],r=0,n=async()=>{let s=i.shift();s&&await s(),i.length>0&&r<t?n():r--};return async function(){for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];return new we(async(d,h)=>{i.push(async()=>{try{let p=await e(...c);d(p)}catch(p){h(p)}}),r<t&&(r++,n())})}})(vx,_G),SI=Tn.CancelToken.source();async function vx(e,t,i,r,n,s){try{if(!U("ENABLE_PRELOAD"))return;if(!Ot().supportWebCrypto)return void Nd(()=>{y.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new ne(k.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&pr(i,"token",1,2047),pr(e,"appid",1,2047),wR(t),r&&IR(r);let c=Rh();y.debug("preload channel ".concat(t,", uid is ").concat(r));let l={appId:e,cname:t,token:i||e,uid:typeof r!="string"?r:null,sid:c,proxyServer:n},d,h;typeof r=="string"?(l.stringUid=r,[h,d]=await we.all([tG(r,{sid:c,appId:e},SI.token),YM(Tx(Tx({},l),{},{token:i||e,uid:0}),SI.token)]),l.uid=h.uid,d.gatewayInfo.uid=l.uid,d.gatewayInfo.res.uid=l.uid):(s&&(l.stringUid=s),d=await YM(l,SI.token));let p={sid:c,appId:e,cname:t,token:i||e,uid:l.stringUid||r,intUid:l.uid||d.gatewayInfo.uid,stringUid:l.stringUid,ts:Date.now(),sua:h,ap:d};await(async function(_){let E;try{_.uid&&yx({appId:_.appId,cname:_.cname,token:_.token,uid:_.uid,stringUid:_.stringUid});let R=wx(_),N=await(async function(O,L){try{let M=await window.crypto.subtle.importKey("raw",pL(L),"AES-GCM",!1,["encrypt"]),B=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},M,vh(window.btoa(JSON.stringify(O))));return Dd(new Uint8Array(B))}catch{return}})(_,_.token||_.appId);if(!N)return;E=Ax(bm);let w=E?JSON.parse(E):[];w.push({[R]:N}),w.length>U("AP_CACHE_NUM")&&w.shift(),ey(bm,JSON.stringify(w))}catch(R){y.warn("Error caching server parameters:",R.message),ey(bm,"")}})(p),EI++}catch(c){throw gI++,(function(l){_I||(_I=window.setTimeout(()=>{let h="";$R.forEach((p,_)=>{h+="".concat(_,": ").concat(p," ;")}),Fe.reportApiInvoke(null,{name:Oi.PRELOAD,options:{success:EI,failed:gI,err:h}}).onError(l),EI=0,gI=0,$R.clear(),_I=null},EG));let d=$R.get(l.code)||0;$R.set(l.code,d+1)})(c),c}}async function Rx(e){try{if(U("AP_REQUEST_DETAIL")||U("ENABLE_ROLE_SELECT_EDGE"))return;let t=yx(e);if(!t||e.cloudProxyServer!=="disabled")return;let i=await(async function(r,n){try{let s=await window.crypto.subtle.importKey("raw",pL(n),"AES-GCM",!1,["decrypt"]),c=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,vh(r));return JSON.parse(window.atob(Dd(new Uint8Array(c))))}catch{return}})(t,e.token||e.appId);if(!i||!(function(r,n){return r.cname===n.cname&&r.appId===n.appId&&r.token===n.token?n.stringUid?r.stringUid===n.stringUid:typeof n.uid=="number"?r.uid===n.uid:r.uid==n.uid:!1})(i,e))return;if(i&&Date.now()-i.ts<U("AP_CACHE_LIFETIME"))return i}catch(t){y.warn("Error get preloadInfo",t.message)}}function yx(e){let t;try{if(t=Ax(bm),!t)return;let i=JSON.parse(t),r=wx(e),n=(function(c,l){for(let d=c.length-1;d>=0;d--)if(l(c[d]))return d;return-1})(i,c=>r in c);if(n===-1)return;let s=i.splice(n,1)[0];return ey(bm,JSON.stringify(i)),s[r]}catch(i){y.warn("Error delete preload info: ".concat(t),i.message),ey(bm,"")}}function TI(e){if(e){let t=kh.get(e);t&&(window.clearTimeout(t),t=null,kh.delete(e)),ve(Mh).call(Mh,e)||e.cloudProxyServer!=="disabled"||Mh.push(e)}if(kh.size<U("AP_CACHE_NUM")&&Mh.length>0){let t=Mh.shift();kh.set(t,window.setTimeout(async()=>{let{appId:i,cname:r,token:n,stringUid:s,uid:c,proxyServer:l}=t;try{await gG(i,r,n,c,l,s),kh.has(t)&&TI(t)}catch(d){y.warn("update preload failed",d.message),Cx(t)}},U("AP_UPDATE_INTERVAL")))}}function Cx(e){let t=Mh.indexOf(e);t!==-1&&Mh.splice(t,1);let i=kh.get(e);i&&(window.clearTimeout(i),i=null,kh.delete(e),TI())}function bx(e,t){let i=e.sua,r=e.ap;t&&i&&Fe.reqUserAccount(e.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:t,uid:e.intUid,errorCode:null,extend:i.req}),Fe.reportResourceTiming(e.ap.url,e.sid),Fe.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(n=>n.ip).join(","),eventType:"disabled",unilbsServerIds:[ji.CHOOSE_SERVER,ji.CLOUD_PROXY_FALLBACK].toString()}),Fe.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(n=>n.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[ji.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function Ax(e){return window.atob(window.localStorage.getItem(e)||"")}function ey(e,t){window.localStorage.setItem(e,window.btoa(t))}function wx(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),TL(t)}function SG(e){let t=(function(){let i=RG.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}})();return(function(i,r){let n=i.appId;n!==void 0&&(Fi(r,10),Wd(r,n));let s=i.cid;s!==void 0&&(Fi(r,16),Fi(r,s));let c=i.cname;c!==void 0&&(Fi(r,26),Wd(r,c));let l=i.deviceId;l!==void 0&&(Fi(r,34),Wd(r,l));let d=i.elapse;d!==void 0&&(Fi(r,40),zd(r,d));let h=i.fileSize;h!==void 0&&(Fi(r,48),zd(r,Am(h)));let p=i.height;p!==void 0&&(Fi(r,56),zd(r,Am(p)));let _=i.jpg;_!==void 0&&(Fi(r,66),Fi(r,_.length),Ox(r,_));let E=i.networkType;E!==void 0&&(Fi(r,72),zd(r,Am(E)));let R=i.osType;R!==void 0&&(Fi(r,80),zd(r,Am(R)));let N=i.requestId;N!==void 0&&(Fi(r,90),Wd(r,N));let w=i.sdkVersion;w!==void 0&&(Fi(r,98),Wd(r,w));let O=i.sequence;O!==void 0&&(Fi(r,104),zd(r,Am(O)));let L=i.sid;L!==void 0&&(Fi(r,114),Wd(r,L));let M=i.timestamp;M!==void 0&&(Fi(r,120),zd(r,M));let B=i.uid;B!==void 0&&(Fi(r,128),Fi(r,B));let Y=i.vid;Y!==void 0&&(Fi(r,136),Fi(r,Y));let H=i.width;H!==void 0&&(Fi(r,144),zd(r,Am(H)));let G=i.service;G!==void 0&&(Fi(r,152),Fi(r,G));let Q=i.callbackData;Q!==void 0&&(Fi(r,162),Fi(r,Q.length),Ox(r,Q));let ce=i.ticket;ce!==void 0&&(Fi(r,170),Wd(r,ce));let he=i.vendorConfigs;he!==void 0&&(Fi(r,178),Wd(r,he))})(e,t),(function(i){let r=i.bytes,n=i.limit;return r.length===n?r:r.subarray(0,n)})(t)}function TG(e){return(function(i){let r={};e:for(;!yG(i);){let n=qg(i);switch(n>>>3){case 0:break e;case 1:r.code=qg(i);break;case 2:r.msg=Nx(i,qg(i));break;case 3:r.requestId=Nx(i,qg(i));break;case 4:r.timestamp=CG(i,!1);break;default:vG(i,7&n)}}return r})({bytes:t=e,offset:0,limit:t.length});var t}function vG(e,t){switch(t){case 0:for(;128&As(e););break;case 2:vI(e,qg(e));break;case 5:vI(e,4);break;case 1:vI(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Am(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let RG=[];function vI(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function yG(e){return e.offset>=e.limit}function ty(e,t){let i=e.bytes,r=e.offset,n=e.limit,s=r+t;if(s>i.length){let c=new Uint8Array(2*s);c.set(i),e.bytes=c}return e.offset=s,s>n&&(e.limit=s),r}function Ix(e,t){let i=e.offset;if(i+t>e.limit)throw new Error("Read past limit");return e.offset+=t,i}function Ox(e,t){let i=ty(e,t.length);e.bytes.set(t,i)}function Nx(e,t){let i=Ix(e,t),r=String.fromCharCode,n=e.bytes,s="",c="";for(let l=0;l<t;l++){let d,h,p,_,E=n[l+i];128&E?(224&E)==192?l+1>=t?c+=s:(d=n[l+i+1],(192&d)!=128?c+=s:(_=(31&E)<<6|63&d,_<128?c+=s:(c+=r(_),l++))):(240&E)==224?l+2>=t?c+=s:(d=n[l+i+1],h=n[l+i+2],(49344&(d|h<<8))!=32896?c+=s:(_=(15&E)<<12|(63&d)<<6|63&h,_<2048||_>=55296&&_<=57343?c+=s:(c+=r(_),l+=2))):(248&E)==240?l+3>=t?c+=s:(d=n[l+i+1],h=n[l+i+2],p=n[l+i+3],(12632256&(d|h<<8|p<<16))!=8421504?c+=s:(_=(7&E)<<18|(63&d)<<12|(63&h)<<6|63&p,_<65536||_>1114111?c+=s:(_-=65536,c+=r(55296+(_>>10),56320+(1023&_)),l+=3))):c+=s:c+=r(E)}return c}function Wd(e,t){let i=t.length,r=0;for(let c=0;c<i;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<i&&(l=(l<<10)+t.charCodeAt(++c)-56613888),r+=l<128?1:l<2048?2:l<65536?3:4}Fi(e,r);let n=ty(e,r),s=e.bytes;for(let c=0;c<i;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<i&&(l=(l<<10)+t.charCodeAt(++c)-56613888),l<128?s[n++]=l:(l<2048?s[n++]=l>>6&31|192:(l<65536?s[n++]=l>>12&15|224:(s[n++]=l>>18&7|240,s[n++]=l>>12&63|128),s[n++]=l>>6&63|128),s[n++]=63&l|128)}}function As(e){return e.bytes[Ix(e,1)]}function Dx(e,t){let i=ty(e,1);e.bytes[i]=t}function qg(e){let t,i=0,r=0;do t=As(e),i<32&&(r|=(127&t)<<i),i+=7;while(128&t);return r}function Fi(e,t){for(t>>>=0;t>=128;)Dx(e,127&t|128),t>>>=7;Dx(e,t)}function CG(e,t){let i,r=0,n=0,s=0;return i=As(e),r=127&i,128&i&&(i=As(e),r|=(127&i)<<7,128&i&&(i=As(e),r|=(127&i)<<14,128&i&&(i=As(e),r|=(127&i)<<21,128&i&&(i=As(e),n=127&i,128&i&&(i=As(e),n|=(127&i)<<7,128&i&&(i=As(e),n|=(127&i)<<14,128&i&&(i=As(e),n|=(127&i)<<21,128&i&&(i=As(e),s=127&i,128&i&&(i=As(e),s|=(127&i)<<7))))))))),{low:r|n<<28,high:n>>>4|s<<24,unsigned:t}}function zd(e,t){let i=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,n=t.high>>>24,s=n===0?r===0?i<16384?i<128?1:2:i<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:n<128?9:10,c=ty(e,s),l=e.bytes;switch(s){case 10:l[c+9]=n>>>7&1;case 9:l[c+8]=s!==9?128|n:127&n;case 8:l[c+7]=s!==8?r>>>21|128:r>>>21&127;case 7:l[c+6]=s!==7?r>>>14|128:r>>>14&127;case 6:l[c+5]=s!==6?r>>>7|128:r>>>7&127;case 5:l[c+4]=s!==5?128|r:127&r;case 4:l[c+3]=s!==4?i>>>21|128:i>>>21&127;case 3:l[c+2]=s!==3?i>>>14|128:i>>>14&127;case 2:l[c+1]=s!==2?i>>>7|128:i>>>7&127;case 1:l[c]=s!==1?128|i:127&i}}let Px={},Lx={},iy=4294967296,bG=iy*iy,AG=bG/2;Mx(0,!0);let kx=Mx(0),wG=Xg(0,-2147483648,!1),IG=Xg(-1,2147483647,!1);function Mx(e,t){let i,r,n;return t?(n=0<=(e>>>=0)&&e<256)&&(r=Lx[e],r)?r:(i=Xg(e,0,!0),n&&(Lx[e]=i),i):(n=-128<=(e|=0)&&e<128)&&(r=Px[e],r)?r:(i=Xg(e,e<0?-1:0,!1),n&&(Px[e]=i),i)}function Xg(e,t,i){return{low:0|e,high:0|t,unsigned:!!i}}function xx(e,t){if(isNaN(e))return kx;{if(e<=-9223372036854776e3)return wG;if(e+1>=AG)return IG}return e<0?kx:Xg(e%iy|0,e/iy|0,t)}function Ux(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}class RI extends Ei{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let i=this._connectionState;this._connectionState=t,this.emit(co.CONNECTION_STATE_CHANGE,t,i)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var i;super(),D(this,"name","AgoraRTCImageModeration"),D(this,"_connectionState",za.CONNECTING),D(this,"_sequence",0),D(this,"_moderationStartTime",void 0),D(this,"_workerConnection",void 0),D(this,"_workerMessageLengthLimit",void 0),D(this,"_qualityRatio",void 0),D(this,"_connectInfo",void 0),D(this,"_cancelTokenSource",Tn.CancelToken.source()),D(this,"_retryConfig",void 0),D(this,"_moderationInterval",void 0),D(this,"_moderationTimer",null),D(this,"_moderationMode",1),D(this,"_quality",1),D(this,"_qualityTimer",null),D(this,"_ticket",void 0),D(this,"_moderationIntervalMinimum",void 0),D(this,"_uploadFailedNum",0),D(this,"_uploadNum",0),D(this,"_uploadTimer",null),D(this,"_extraInfo",void 0),D(this,"_vendor",""),D(this,"_encoder",new TextEncoder),D(this,"_moderationId",void 0),D(this,"inspectImage",()=>{if(this.connectionState!==za.CONNECTED)throw new $(k.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===za.CONNECTED?this.requestToInspectImage():y.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Zt(5,"image-moderation-"),this._workerMessageLengthLimit=U("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=U("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=t.interval)!==null&&i!==void 0?i:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=U("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Vg("worker-"+this._moderationId,Wi),this.on(co.STATE_CHANGE,(r,n)=>{y.debug("[".concat(this._moderationId,"] Moderation operation :").concat(mm[r]," ").concat(n||""))}),this.handleWorkerEvents()}async init(t,i){this.emit(co.STATE_CHANGE,mm.CONNECT_AP),this._connectInfo=t;let r=this._cancelTokenSource.token;return this._retryConfig=i,new we((n,s)=>{this.on(co.CONNECTION_STATE_CHANGE,(c,l)=>{c===za.CONNECTED&&n()}),this.requestAP(t,r,i).then(c=>{this.connectWorker(c)}).catch(c=>{s(c)})})}updateConfig(t){var i;this._moderationInterval=(i=t.interval)!==null&&i!==void 0?i:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),y.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===za.CONNECTED&&this.inspectImage()}async requestAP(t,i,r){let n=U("WEBCS_DOMAIN").map(d=>"https://".concat(d,"/api/v1")),s=await(function(d,h,p,_){let{appId:E,areaCode:R,cname:N,sid:w,token:O,uid:L}=h;vm++;let M="moderation_plugin",B={service_name:M,json_body:JSON.stringify({appId:E,areaCode:R,cname:N,command:"allocateEdge",requestId:vm,seq:vm,sid:w,appToken:O,ts:Date.now(),uid:L+""})},Y,H,G=d[0];return no(async()=>{Y=Date.now();let Q=await lo(G,{data:B,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(H=Date.now()-Y,Q.code!==0){let Se=new $(k.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Q.code,{retry:!0,responseTime:H});throw y.error(Se.toString()),Se}let ce=JSON.parse(Q.json_body);if(ce.code!==200){let Se=new $(k.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(ce.code,", reason: ").concat(ce.reason),{code:ce.code,responseTime:H});throw y.error(Se.toString()),Se}if(!ce.servers||!Array.isArray(ce.servers)||ce.servers.length===0){let Se=new $(k.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:ce.code,responseTime:H});throw y.error(Se.toString()),Se}if(!ce.servers.some(Se=>!!Se.wss)){let Se=new $(k.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:ce.code,responseTime:H});throw y.error(Se.toString()),Se}let he=U("IMAGE_MODERATION_WORKER_HOST");return{addressList:ce.servers.map(Se=>{let{address:ht,wss:pt}=Se;if(ht&&pt)return"wss://".concat(ht.replace(/\./g,"-"),".").concat(he,":").concat(pt,"/moderation")}).filter(Se=>!!Se),workerToken:ce.workerToken,vid:ce.vid,ticket:ce.appTicket,responseTime:H}},(Q,ce)=>(Fe.apworkerEvent(w,{success:!0,sc:200,serviceName:M,responseDetail:JSON.stringify(Q.addressList),firstSuccess:ce===0,responseTime:H,serverIp:d[ce%d.length]}),!1),(Q,ce)=>(Fe.apworkerEvent(w,{success:!1,sc:Q.data&&Q.data.code||200,serviceName:M,responseTime:H,serverIp:d[ce%d.length]}),!!(Q.code!==k.OPERATION_ABORTED&&Q.code!==k.UNEXPECTED_RESPONSE||Q.data&&Q.data.retry)&&(G=d[(ce+1)%d.length],!0)),_)})(n,t,i,r);this.emit(co.STATE_CHANGE,mm.AP_CONNECTED);let{addressList:c,ticket:l}=s;return this._ticket=l,c}async connectWorker(t){this.emit(co.STATE_CHANGE,mm.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(dt.CONNECTED,async()=>{this.emit(co.STATE_CHANGE,mm.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=za.CONNECTED}),this._workerConnection.on(dt.CLOSED,()=>{this.connectionState=za.CLOSED}),this._workerConnection.on(dt.FAILED,()=>{this.connectionState=za.CLOSED}),this._workerConnection.on(dt.RECONNECTING,()=>{this.connectionState=this.connectionState===za.CONNECTED?za.RECONNECTING:za.CONNECTING}),this._workerConnection.on(dt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let i=TG(new Uint8Array(t.data));U("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&y.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,y.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Fe.reportApiInvoke(this._connectInfo.sid||null,{name:Oi.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:pi.TRACER}).onError(new $(k.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},U("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else y.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(dt.WILL_RECONNECT,(t,i,r)=>{t==="recover"&&r(t),r("tryNext")}),this._workerConnection.on(dt.REQUEST_NEW_URLS,(t,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(i)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){let t=fa(this,co.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(U("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&y.debug("Only the track being played can be inspected"));this._sequence++;let r=await this.generateRequestData(t,i);this._workerConnection.sendMessage(r,!0,!0)}else U("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&y.debug("Only the track being published can be inspected")}async generateRequestData(t,i){let{appId:r,cname:n,cid:s,vid:c,sid:l,uid:d}=i,h=Date.now(),p=await t.getCurrentFrameImage("image/jpeg",this.quality),_=await l2(p,r,n),E=this._sequence+"-"+s+"-"+d+"-"+h+"-"+Zt(12,""),R={appId:r,cid:s,cname:n,deviceId:"",elapse:RI.intToLong(Number(h-this._moderationStartTime)),fileSize:p.buffer.byteLength,height:p.height,width:p.width,jpg:_,networkType:6,osType:7,requestId:E,sdkVersion:"4.24.0",sequence:this._sequence,sid:l,timestamp:xx(h),uid:d,vid:c,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete R.callbackData;let N=SG(R);if(N.byteLength<this._workerMessageLengthLimit){if(U("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let w=(function(O){for(var L=1;L<arguments.length;L++){var M=arguments[L]!=null?arguments[L]:{};L%2?Ux(Object(M),!0).forEach(function(B){D(O,B,M[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(M)):Ux(Object(M)).forEach(function(B){Object.defineProperty(O,B,Object.getOwnPropertyDescriptor(M,B))})}return O})({},R);delete w.jpg,y.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(w))}return N}{let w=this.quality*this._qualityRatio;return this.quality=w,await this.generateRequestData(t,{appId:r,cname:n,cid:s,vid:c,sid:l,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Tn.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=za.CLOSED,this.emit(co.STATE_CHANGE,mm.CLOSED)}}function Vx(e){if(Yt(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new $(k.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new $(k.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}let OG={name:"ImageModeration",create:function(e){let{config:t}=e;return Vx(t),new RI(t)}};var Bx,jx,Fx,Gx,Hx,Wx,zx,Kx,Yx,qx,Xx,Jx,Zx,Qx,$x,eU,tU,iU,rU,nU,aU,sU,oU,cU,lU,dU,uU,hU,pU,fU,mU,_U,EU,gU,SU,TU,vU,RU,yU,CU,bU,Pe;function AU(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function ws(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?AU(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):AU(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}Lr.setLogger(y);let NG=(Bx=qe(),jx=qe({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof om))return[t];t=[t]}return t.map(i=>i?Object(i).toString():"null")}}),Fx=qe({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==sm.DATA?(Array.isArray(t)||(t=[t]),t.map(i=>i.getTrackId())):[t.getChannelId()])}),Gx=qe({argsMap:(e,t,i,r)=>[typeof t=="object"?t.uid:t,i,r]}),Hx=qe({argsMap:(e,t,i)=>[t,i]}),Wx=qe({argsMap:(e,t)=>t.map(i=>{let{user:r,mediaType:n}=i;return[r?.uid,n]})}),zx=qe({argsMap:(e,t,i,r)=>[typeof t=="object"?t.uid:t,i,r]}),Kx=qe({argsMap:(e,t)=>t.map(i=>{let{user:r,mediaType:n}=i;return{uid:r?.uid,mediaType:n}})}),Yx=qe(),qx=qe(),Xx=qe(),Jx=qe(),Zx=qe(),Qx=qe(),$x=qe(),eU=qe(),tU=qe(),iU=qe(),rU=qe(),nU=qe(),aU=qe(),sU=qe(),oU=qe(),cU=qe({argsMap:(e,t)=>[t]}),lU=qe(),dU=qe(),uU=qe(),hU=qe(),pU=qe(),fU=qe(),mU=qe(),_U=qe(),EU=qe({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),gU=qe(),SU=qe(),TU=qe(),vU=qe(),RU=qe(),yU=qe(),CU=qe({reportResult:!0}),bU=qe(),Pe=class extends Ei{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let i;if(super(),D(this,"store",void 0),D(this,"_uid",void 0),D(this,"_channelName",void 0),D(this,"_uintUid",void 0),D(this,"_users",[]),D(this,"_config",void 0),D(this,"_clientId",void 0),D(this,"_appId",void 0),D(this,"_sessionId",null),D(this,"_key",void 0),D(this,"_rtmConfig",{}),D(this,"_joinInfo",void 0),D(this,"_gateway",void 0),D(this,"_statsCollector",void 0),D(this,"_configDistribute",void 0),D(this,"_leaveMutex",void 0),D(this,"_publishMutex",void 0),D(this,"_renewTokenMutex",void 0),D(this,"_subscribeMutex",void 0),D(this,"_encryptionMode","none"),D(this,"_encryptionSecret",null),D(this,"_encryptionSalt",null),D(this,"_encryptDataStream",!1),D(this,"_encryptDataStreamKey",null),D(this,"_encryptDataStreamIv",null),D(this,"_proxyServer",void 0),D(this,"_turnServer",{servers:[],mode:"auto"}),D(this,"_cloudProxyServerMode","disabled"),D(this,"_isDualStreamEnabled",!1),D(this,"_defaultStreamFallbackType",void 0),D(this,"_lowStreamParameter",void 0),D(this,"_streamFallbackTypeCacheMap",new Map),D(this,"_remoteStreamTypeCacheMap",new Map),D(this,"_axiosCancelSource",Tn.CancelToken.source()),D(this,"_audioVolumeIndicationInterval",void 0),D(this,"_networkQualityInterval",void 0),D(this,"_userOfflineTimeout",void 0),D(this,"_streamRemovedTimeout",void 0),D(this,"_liveTranscodeStreamingClient",void 0),D(this,"_liveRawStreamingClient",void 0),D(this,"_channelMediaRelayClient",void 0),D(this,"_networkQualitySensitivity","normal"),D(this,"_p2pChannel",void 0),D(this,"_useLocalAccessPoint",!1),D(this,"_setLocalAPVersion",void 0),D(this,"_joinAndNotLeaveYet",!1),D(this,"_numberOfJoinCount",0),D(this,"_joinResponse",null),D(this,"_remoteDefaultVideoStreamType",void 0),D(this,"_inspect",void 0),D(this,"_moderation",void 0),D(this,"_license",void 0),D(this,"_pendingPublishedUsers",[]),D(this,"ntpAlignErrorCount",0),D(this,"remoteInboundOffset",0),D(this,"_peerConnectionState",void 0),D(this,"_handleLocalTrackEnable",(n,s,c)=>{this.publish(n,!1).then(s).catch(c)}),D(this,"_handleLocalTrackDisable",(n,s,c)=>{this.unpublish(n).then(s).catch(c)}),D(this,"_handleUserOnline",n=>{if(U("BLOCK_LOCAL_CLIENT")&&Nh(n.uid,this.channelName))return void y.debug("[".concat(n.uid,"] will be ignored in local"));this.isStringUID&&typeof n.uid!="string"&&y.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let s=this._users.find(c=>c.uid===n.uid);if(s)s._trust_in_room_=!0,s._is_pre_created&&(s._is_pre_created=!1,this.safeEmit(Tt.USER_JOINED,s));else{let c=new Gd(n.uid,n.uint_id||n.uid);this._users.push(c),y.debug("[".concat(this._clientId,"] user online"),n.uid),this.store.firstVideoFrameDecoded(c.uid,{userJoinNotify:Date.now()}),this.safeEmit(Tt.USER_JOINED,c)}}),D(this,"_handleUserOffline",n=>{if(U("BLOCK_LOCAL_CLIENT")&&Nh(n.uid,this.channelName))return;let s=this._users.find(c=>c.uid===n.uid);s&&(this._handleRemoveStream(n),this._handleRemoveDataChannels(n),s._audio_pre_subscribed||s._video_pre_subscribed?s._is_pre_created=!0:iR(this._users,s),this._remoteStreamTypeCacheMap.delete(s.uid),this._streamFallbackTypeCacheMap.delete(s.uid),y.debug("[".concat(this._clientId,"] user offline"),n.uid,"reason:",n.reason),this.safeEmit(Tt.USER_LEAVED,s,n.reason))}),D(this,"_handleAddAudioOrVideoStream",(n,s,c,l,d,h,p,_)=>{if(U("BLOCK_LOCAL_CLIENT")&&Nh(s,this.channelName))return;let E=this._users.find(N=>N.uid===s);if(!E)return void y.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));y.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(n)),this.store.subscribe(E.uid,n,void 0,void 0,void 0,Date.now()),n==="video"&&this.store.firstVideoFrameDecoded(E.uid,{videoAddNotify:Date.now()});let R=n==="audio"?E.hasAudio:E.hasVideo;if(E._uintid||(E._uintid=h||s),n==="audio"?E._trust_audio_stream_added_state_=!0:E._trust_video_stream_added_state_=!0,n==="audio"?(E._audio_added_=!0,c!==void 0&&(E._audioSSRC=c),l!==void 0&&(E._cname=l),p&&(E._audioOrtc=p)):(E._video_added_=!0,c!==void 0&&(E._videoSSRC=c),l!==void 0&&(E._cname=l),_!==void 0&&(E._rtxSsrcId=_),p&&(E._videoOrtc=p)),(n==="audio"?E.hasAudio:E.hasVideo)&&!R&&(y.info("[".concat(this._clientId,"] remote user ").concat(E.uid," published ").concat(n)),this.safeEmit(Tt.USER_PUBLISHED,E,n)),n==="video"?Fe.onGatewayStream(this._sessionId,er.ON_ADD_VIDEO_STREAM,ui.ON_ADD_VIDEO_STREAM,{peer:h||s,ssrc:E._videoSSRC}):Fe.onGatewayStream(this._sessionId,er.ON_ADD_AUDIO_STREAM,ui.ON_ADD_AUDIO_STREAM,{peer:h||s,ssrc:E._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(E,n,c).then(N=>{if(N&&(y.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(E.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Yg))return this._p2pChannel.unsubscribe(E,n,!0).then(()=>this._subscribe(E,n,!0).catch(w=>{y.error("[".concat(this._clientId,"] resubscribe error"),w.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(E,n)&&(y.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(E.uid," after reconnect.")),this._subscribe(E,n,!0).catch(N=>{y.error("[".concat(this._clientId,"] resubscribe error"),N.toString())})),n==="video"&&!Rr()&&!zr()){let N=this._getEncodingName(d);N?.toLocaleLowerCase()==Ng.av1&&eG().then(w=>{w||this._gateway.downgradeCodec(N)})}}),D(this,"_handleRemoveStream",n=>{if(U("BLOCK_LOCAL_CLIENT")&&Nh(n.uid,this.channelName))return;let s=this._users.find(l=>l.uid===n.uid);if(!s)return void y.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));y.debug("[".concat(this._clientId,"] stream removed with uid ").concat(n.uid));let c=()=>{};s.hasAudio&&s.hasVideo?c=()=>{y.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(Tt.USER_UNPUBLISHED,s,"audio"),y.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(Tt.USER_UNPUBLISHED,s,"video")}:s.hasVideo?c=()=>{y.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(Tt.USER_UNPUBLISHED,s,"video")}:s.hasAudio&&(c=()=>{y.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(Tt.USER_UNPUBLISHED,s,"audio")}),s._video_pre_subscribed||s._audio_pre_subscribed||(s._trust_audio_stream_added_state_=!0,s._trust_video_stream_added_state_=!0,s._audio_added_=!1,s._video_added_=!1,this._p2pChannel instanceof Yg&&this._p2pChannel.unsubscribe(s).then(l=>{if(l)return this._gateway.unsubscribe(l,s.uid)}),s._audioSSRC=void 0,s._videoSSRC=void 0,s._audioOrtc=void 0,s._videoOrtc=void 0,s._rtxSsrcId=void 0),Fe.onGatewayStream(this._sessionId,er.ON_REMOVE_STREAM,ui.ON_REMOVE_STREAM,{peer:n.uint_id||n.uid}),c()}),D(this,"_handleSetStreamLocalEnable",(n,s,c)=>{if(U("BLOCK_LOCAL_CLIENT")&&Nh(s,this.channelName))return;let l=this._users.find(p=>p.uid===s);if(!l)return void y.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));y.debug("[".concat(this._clientId,"] local ").concat(n," ").concat(c?"enabled":"disabled"," with uid ").concat(s));let d=n==="audio"?l.hasAudio:l.hasVideo;if(n==="audio"){l._trust_audio_enabled_state_=!0;let p=l._audio_enabled_;if(l._audio_enabled_=c,l._audio_enabled_===p)return;{let _=l._audio_enabled_?"enable-local-audio":"disable-local-audio";y.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(s,", msg: ").concat(_)),this.safeEmit(Tt.USER_INFO_UPDATED,s,_)}}else{l._trust_video_enabled_state_=!0;let p=l._video_enabled_;if(l._video_enabled_=c,l._video_enabled_===p)return;{let _=l._video_enabled_?"enable-local-video":"disable-local-video";y.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(_)),this.safeEmit(Tt.USER_INFO_UPDATED,s,_)}}let h=n==="audio"?l.hasAudio:l.hasVideo;return d!==h?!d&&h?(y.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(n)),void this.safeEmit(Tt.USER_PUBLISHED,l,n)):(n==="video"&&l._videoTrack&&l._videoTrack._destroy(),n==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,n),y.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(n)),void this.safeEmit(Tt.USER_UNPUBLISHED,l,n)):void 0}),D(this,"_handleMuteStream",(n,s,c)=>{if(U("BLOCK_LOCAL_CLIENT")&&Nh(n,this.channelName))return;y.debug("[".concat(this._clientId,"] receive mute message"),n,s,c);let l=this._users.find(p=>p.uid===n);if(!l)return void y.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(n));let d=s==="audio"?l.hasAudio:l.hasVideo;if(s==="audio"){l._trust_audio_mute_state_=!0;let p=l._audio_muted_;if(l._audio_muted_=c,l._audio_muted_===p)return;{let _=l._audio_muted_?"mute-audio":"unmute-audio";y.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(_)),this.safeEmit(Tt.USER_INFO_UPDATED,n,_)}}else{l._trust_video_mute_state_=!0;let p=l._video_muted_;if(l._video_muted_=c,l._video_muted_===p)return;{let _=l._video_muted_?"mute-video":"unmute-video";y.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(_)),this.safeEmit(Tt.USER_INFO_UPDATED,n,_)}}let h=s==="audio"?l.hasAudio:l.hasVideo;if(d!==h){if(!d&&h)return(s==="audio"?l._audioSSRC:l._videoSSRC)?(y.info("[".concat(this._clientId,"] remote user ").concat(n," published ").concat(s)),void this.safeEmit(Tt.USER_PUBLISHED,l,s)):void y.warning("[".concat(this._clientId,"] remote user ").concat(n," receive ").concat(s," unmute message  before add stream message, ").concat(s," SSRC doesn't exist yet."));s==="video"&&l._videoTrack&&!l._video_pre_subscribed&&l._videoTrack._destroy(),s==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,s),y.info("[".concat(this._clientId,"] remote user ").concat(n," unpublished ").concat(s)),this.safeEmit(Tt.USER_UNPUBLISHED,l,s)}}),D(this,"_handleP2PLost",async n=>{y.debug("[".concat(this._clientId,"] receive p2p lost"),n),parseInt(n.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():y.warning("[".concat(this._clientId,"] P2PLost stream not found"),n)}),D(this,"_handleTokenWillExpire",()=>{y.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Tt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),D(this,"_handleBeforeUnload",n=>{n.type==="beforeunload"&&n.returnValue!==void 0&&n.returnValue!==""||(this.leave(),y.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),D(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Tt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let n={downlinkNetworkQuality:0,uplinkNetworkQuality:0};n.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),n.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Tt.NETWORK_QUALITY,n)}),D(this,"_handleP2PAddAudioOrVideoStream",(n,s,c,l)=>{let d=this._users.find(p=>p.uid===s);if(!d)return void y.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));y.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(n)),this.store.subscribe(d.uid,n,void 0,void 0,void 0,Date.now());let h=n==="audio"?d.hasAudio:d.hasVideo;n==="audio"?d._trust_audio_stream_added_state_=!0:d._trust_video_stream_added_state_=!0,n==="audio"?(d._audio_added_=!0,c!==void 0&&(d._audioSSRC=c),l!==void 0&&(d._audioMid=l)):(d._video_added_=!0,c!==void 0&&(d._videoSSRC=c),l!==void 0&&(d._videoMid=l)),(n==="audio"?d.hasAudio:d.hasVideo)&&!h&&(y.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published ").concat(n)),this.safeEmit(Tt.USER_PUBLISHED,d,n)),this._p2pChannel.hasPendingRemoteMedia(d,n)&&(y.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(d.uid," after reconnect.")),this._subscribe(d,n,!0).catch(p=>{y.error("[".concat(this._clientId,"] resubscribe error"),p.toString())}))}),this._config=e,this._clientId=t||Zt(5,"client-"),this.store=new class{constructor(n,s,c,l){at(this,"state",void 0),this.state={codec:n,audioCodec:s,mode:c,clientId:l,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:yh.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(n){this.state=(function(s,c){switch(c.type){case st.SET_SESSION_ID:return ge(ge({},s),{},{sessionId:c.sessionId});case st.SET_P2P_ID:return ge(ge({},s),{},{p2pId:c.p2pId});case st.SET_UID:return ge(ge({},s),{},{uid:c.uid});case st.SET_INT_UID:return ge(ge({},s),{},{intUid:c.intUid});case st.SET_PUB_ID:return ge(ge({},s),{},{pubId:c.pubId});case st.KEY_METRIC_CLIENT_CREATED:return ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{clientCreated:c.metric})});case st.KEY_METRIC_JOIN_START:return ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{joinStart:c.metric})});case st.KEY_METRIC_PRELOAD_START:return ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{preloadStart:c.metric})});case st.KEY_METRIC_PRELOAD_END:return ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{preloadEnd:c.metric})});case st.KEY_METRIC_JOIN_END:return ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{joinEnd:c.metric})});case st.KEY_METRIC_REQUEST_AP_START:return ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{requestAPStart:c.metric})});case st.KEY_METRIC_REQUEST_AP_END:return ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{requestAPEnd:c.metric})});case st.KEY_METRIC_REQUEST_SUA_END:return ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{requestSUAEnd:c.metric})});case st.KEY_METRIC_BEFORE_CONNECT:return ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{beforeConnect:c.metric})});case st.KEY_METRIC_PEER_RECEIVER:return ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{peerReceiver:c.metric})});case st.KEY_METRIC_SIGNAL_CONNECTED:return ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{signalConnected:c.metric})});case st.KEY_METRIC_JOIN_REQ:return ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{joinReq:c.metric})});case st.KEY_METRIC_JOIN_REP:return ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{joinRep:c.metric})});case st.KEY_METRIC_JOIN_GATEWAY_START:return ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{joinGatewayStart:c.metric})});case st.KEY_METRIC_JOIN_GATEWAY_END:return ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{joinGatewayEnd:c.metric})});case st.KEY_METRIC_PEER_CONNECTION_START:return ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{peerConnectionStart:c.metric})});case st.KEY_METRIC_PEER_CONNECTION_END:return ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{peerConnectionEnd:c.metric})});case st.KEY_METRIC_DESCRIPTION_START:return ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{descriptionStart:c.metric})});case st.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{signalChannelOpen:c.metric})});case st.KEY_METRIC_ICE_CONNECTION_END:return ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{iceConnectionEnd:c.metric})});case st.KEY_METRIC_PUBLISH:{let l=s.keyMetrics.publish,d=l.findIndex(h=>h.trackId===c.metric.trackId);return d!==-1?(l[d]=ge(ge({},l[d]),c.metric),ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{publish:[...l]})})):ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{publish:[...s.keyMetrics.publish,c.metric]})})}case st.KEY_METRIC_SUBSCRIBE:{let l=s.keyMetrics.subscribe,d=l.findIndex(h=>h.userId===c.metric.userId&&h.type===c.metric.type);return d!==-1?(l[d]=ge(ge({},l[d]),c.metric),ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{subscribe:[...l]})})):ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{subscribe:[...s.keyMetrics.subscribe,c.metric]})})}case st.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{let l=s.keyMetrics.firstVideoFrameDecoded,d=l.findIndex(h=>h.userId===c.metric.userId);return d!==-1?(l[d]=ge(ge({},l[d]),c.metric),ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{firstVideoFrameDecoded:[...l]})})):ge(ge({},s),{},{keyMetrics:ge(ge({},s.keyMetrics),{},{firstVideoFrameDecoded:[...s.keyMetrics.firstVideoFrameDecoded,c.metric]})})}case st.RESET_FIRST_VIDEO_FRAME_DECODED:return s.keyMetrics.firstVideoFrameDecoded=[],s;case st.SET_CLOUD_PROXY_SERVER_MODE:return s.cloudProxyServerMode=c.mode,s;case st.RECORD_JOIN_CHANNEL_SERVICE:return typeof c.index!="number"?s.joinChannelServiceRecords=[...s.joinChannelServiceRecords,c.record]:(s.joinChannelServiceRecords[c.index]=ge(ge({},s.joinChannelServiceRecords[c.index]),c.record),s.joinChannelServiceRecords=[...s.joinChannelServiceRecords]),s;case st.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return s.joinChannelServiceRecords=[],s;case st.RESET_KEY_METRICS:return s.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},s;case st.SET_USE_P2P:return ge(ge({},s),{},{useP2P:c.val});case st.SET_TRANSPORT_TYPE:return ge(ge({},s),{},{p2pTransport:c.val});default:return s}})(this.state,n)}set autoSubscribe(n){this.state.autoSubscribe=n}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(n){this.state.enableInstantMuteRestore=n}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(n){this.dispatch({type:st.SET_SESSION_ID,sessionId:n})}get sessionId(){return this.state.sessionId}set cid(n){this.state.cid=n}get cid(){return this.state.cid}set codec(n){this.state.codec=n}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(n){this.dispatch({type:st.SET_P2P_ID,p2pId:n})}get p2pId(){return this.state.p2pId}set dcId(n){this.dispatch({type:st.SET_DC_ID,dcId:n})}get dcId(){return this.state.dcId}set uid(n){this.dispatch({type:st.SET_UID,uid:n})}get uid(){return this.state.uid}set intUid(n){this.dispatch({type:st.SET_INT_UID,intUid:n})}get intUid(){return this.state.intUid}set pubId(n){this.dispatch({type:st.SET_PUB_ID,pubId:n})}get pubId(){return this.state.pubId}set cloudProxyServerMode(n){this.dispatch({type:st.SET_CLOUD_PROXY_SERVER_MODE,mode:n})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(n){this.dispatch({type:st.SET_USE_P2P,val:n})}get useP2P(){return this.state.useP2P}set p2pTransport(n){this.dispatch({type:st.SET_TRANSPORT_TYPE,val:n})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(n){this.state.hasStartJoinChannel=n}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(n){this.state.isABTestSuccess=n}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:st.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:st.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:st.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:st.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:st.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:st.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:st.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:st.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:st.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:st.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:st.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:st.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:st.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:st.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:st.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:st.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:st.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(n,s){this.dispatch({type:st.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:ge({userId:n},s)})}descriptionStart(){this.dispatch({type:st.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:st.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:st.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(n,s,c,l){this.dispatch({type:st.KEY_METRIC_PUBLISH,metric:ge(ge({trackId:n,type:s},c&&{publishStart:c}),l&&{publishEnd:l})})}subscribe(n,s,c,l,d,h,p){this.dispatch({type:st.KEY_METRIC_SUBSCRIBE,metric:ge(ge(ge(ge(ge({userId:n,type:s},c&&{subscribeStart:c}),l&&{subscribeEnd:l}),d&&{firstFrame:d}),h&&{streamAdded:h}),p&&{firstDecoded:p})})}massSubscribe(n,s,c,l){n.forEach(d=>{this.dispatch({type:st.KEY_METRIC_SUBSCRIBE,metric:ge(ge(ge({userId:d.userId,type:d.type},s&&{subscribeStart:s}),c&&{subscribeEnd:c}),l&&{firstFrame:l})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(n,s){n.service==="gateway"&&Array.isArray(n.urls)&&(n.urls=n.urls.map(c=>c.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof s!="number"?(this.dispatch({type:st.RECORD_JOIN_CHANNEL_SERVICE,record:ge(ge({},n),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(s<0||s>=this.state.joinChannelServiceRecords.length||this.dispatch({type:st.RECORD_JOIN_CHANNEL_SERVICE,record:n,index:s}),s)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:st.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:st.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:st.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Lr("client-leave",this._clientId),this._publishMutex=new Lr("client-publish",this._clientId),this._renewTokenMutex=new Lr("client-renewtoken",this._clientId),this._subscribeMutex=new Lr("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),y.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Fa," build: ").concat(ow,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{qA(e.clientRoleOptions),i=Object.assign({},e.clientRoleOptions)}catch(n){y.warning("[".concat(this._clientId,"] ").concat(n.toString()))}var r;this._statsCollector=new zg(this.store),this._statsCollector.onStatsException=(n,s,c)=>{y.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(n,", msg: ").concat(s,", uid: ").concat(c)),n===sI.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(l=>{l instanceof _R&&U("ENABLE_ENCODE_EXCEPTION")&&l.findClosestProfile()}),this.safeEmit(Tt.EXCEPTION,{code:n,msg:s,uid:c})},this._statsCollector.onUploadPublishDuration=(n,s,c,l)=>{let d=this._users.find(h=>h.uid===n);d&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(d._uintid,{peerPublishDuration:c,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(d)),Fe.peerPublishStatus(this._sessionId,{subscribeElapse:l,audioPublishDuration:s,videoPublishDuration:c,peer:d._uintid}))},this._statsCollector.onVideoCodecChanged=n=>{if(U("VIDEO_STANDARD_BITRATE_VERSION")&&(n==="av1"||n==="h265"||n==="h264")){let s=this.localTracks.find(c=>c instanceof ai);s&&s._saveEncodeBitrateRatio!==1&&s.setSaveEncodeBitrateRatio(n==="h264"?U("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new q9(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Wi,httpRetryConfig:e.httpRetryConfig||Wi,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:i}),this._configDistribute=new aG(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},ul("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new Yg(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,i,r,n){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],c=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Ht("JOIN_GATEWAY_USE_443PORT_ONLY",s),Ht("JOIN_GATEWAY_USE_DUAL_DOMAIN",c);let l=this._gateway.signal.websocket;return l instanceof zw&&(l.use443PortOnly=s,l.tryDoubleDomain=c),(async function(d,h,p){Z0.get(d)||Z0.set(d,[]),Q0.get(d)||Q0.set(d,h),$o.get(d)||$o.set(d,0);let _=Z0.get(d),E=Q0.get(d);if(!_||!E)throw new Error("concurrent: deferQueue or maxConcurrency is null");if($o.get(d)===E){let L=vg();_.push(L),await L.promise}$o.set(d,$o.get(d)+1);for(var R=arguments.length,N=new Array(R>3?R-3:0),w=3;w<R;w++)N[w-3]=arguments[w];let O=await p(...N);return $o.set(d,$o.get(d)-1),$o.get(d)===E-1&&_.length>0&&(_[0].resolve(),_.shift()),$o.get(d)===0&&(Z0.set(d,[]),Q0.set(d,0),$o.set(d,0)),O})("client.join",U("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,i,r,n)}async join(e,t,i,r,n){let s=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);let c=(aR||aR||(aR=(window.location.protocol.split(":")[0]||"").toUpperCase(),aR))==="HTTPS",l=yL()?window.isSecureContext:"Browser Not Support";(!yL()&&!c||!window.isSecureContext)&&y.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let d;Fe.setAppId(e);try{if(!i&&i!==null)throw new $(k.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));if(i&&pr(i,"token",1,2047),pr(e,"appid",1,2047),wR(t),r&&IR(r),n)if(typeof n=="string")pr(n,"optionalInfo",1,256),d=n;else{if(typeof n!="object")throw new $(k.INVALID_PARAMS,"Invalid options: options is not a string or object");{let{autoSubscribe:O,enableInstantMuteRestore:L}=n;O&&(ro(O,"autoSubscribe"),y.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(O)),this.store.autoSubscribe=O),L&&(ro(L,"enableInstantMuteRestore"),y.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(L)),this.store.enableInstantMuteRestore=L)}}}catch(O){throw Fe.reportApiInvoke(Rh(),{name:Oi.JOIN,options:[e,t,i,r],states:{isHttps:c,isSecureContext:l},tag:pi.TRACER}).onError(O),O}if(this._leaveMutex.isLocked&&(y.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),y.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let O=new $(k.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Fe.reportApiInvoke(Rh(),{name:Oi.JOIN,options:[e,t,i,r],states:{isHttps:c,isSecureContext:l},tag:pi.TRACER}).onError(O),O}this._gateway.state="CONNECTING",this.store.preloadStart();let h=await Rx({appId:e,cname:t,uid:r,stringUid:typeof r=="string"?r:void 0,token:i||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new $(k.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let p=h?.sid||Rh();y.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(s)),this._sessionId||(this._sessionId=p,this.store.sessionId=this._sessionId);let _=Fe.reportApiInvoke(p,{id:this._clientId,name:Oi.JOIN,options:[e,t,i,r],states:{isHttps:c,isSecureContext:l},tag:pi.TRACER}),E=ws(ws(ws({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:d,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!h},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:U("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(E.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(E.stringUid=r,this._uintUid?(E.uid=this._uintUid,this._uintUid=void 0):E.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(E.aesmode=this._encryptionMode,E.aespassword=await(async O=>{let L=(function(H){let G=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),Q=new Uint8Array(new ArrayBuffer(G.length));for(let ce=0;ce<G.length;ce+=1)Q[ce]=G.charCodeAt(ce);return Q})(),M=await window.crypto.subtle.importKey("spki",L,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),B=KA(O),Y=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},M,B);return(function(H){let G="";for(let Q=0;Q<H.length;Q+=1)G+=String.fromCharCode(H[Q]);return window.btoa(G)})(new Uint8Array(Y))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new $(k.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(E.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let O=new TextEncoder,L=U("USE_PURE_ENCRYPTION_MASTER_KEY")?O.encode(E.appId+this._encryptionSecret+this._encryptionSecret):O.encode(E.appId+E.cname+this._encryptionSecret);this._encryptDataStreamIv=await(async function(M,B,Y){let H=await window.crypto.subtle.importKey("raw",B,"PBKDF2",!1,["deriveBits","deriveKey"]),G=M==="aes-128-gcm2"?128:256,Q=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:LL,hash:"SHA-256",salt:Y},H,G+C8);return new Uint8Array(Q).subarray(G/8)})(this._encryptionMode,L,vh(this._encryptionSalt)),this._encryptDataStreamKey=await(async function(M,B,Y){let H=await window.crypto.subtle.importKey("raw",B,"PBKDF2",!1,["deriveBits","deriveKey"]),G=M==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:LL,hash:"SHA-256",salt:Y},H,{name:"AES-GCM",length:G},!0,["encrypt","decrypt"])})(this._encryptionMode,L,vh(this._encryptionSalt))}else l?y.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):y.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,y.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:E.stringUid});let R=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&R===this._sessionId&&Fe.joinChannelTimeout(this._sessionId,5)},5e3);try{var N;let O,L=E.cloudProxyServer;if(ve(N=["proxy3","proxy4","proxy5"]).call(N,L)){let G=U("PROXY_SERVER_TYPE3");Array.isArray(G)?E.proxyServer=G[0]:E.proxyServer=G}if(Fe.setProxyServer(E.proxyServer),y.setProxyServer(E.proxyServer),this.store.requestAPStart(),h){if(y.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(E.stringUid?", ".concat(E.stringUid," => ").concat(h.intUid):""," ")),E.stringUid&&!E.uid&&(E.uid=h.intUid),O={gatewayInfo:h.ap.gatewayInfo},U("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&E.turnServer.mode==="auto")if(h.ap.proxyInfo.addresses.length===0)y.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let G=(await gM(h.ap.proxyInfo,h.ap.gatewayInfo.uid)).map(Q=>({turnServerURL:Q.address,tcpport:Q.tcpport||br.tcpport,udpport:Q.udpport||br.udpport,username:Q.username||br.username,password:Q.password||br.password,forceturn:!1,security:!0}));E.turnServer={mode:"manual",servers:G}}bx(h,E.stringUid)}else{if(E.stringUid&&!E.uid){let G;[G,O]=await we.all([KM(E.stringUid,E,this._axiosCancelSource.token,this._config.httpRetryConfig||Wi,this.store).finally(()=>{this.store.requestSUAEnd()}),zM(E,this._axiosCancelSource.token,this._config.httpRetryConfig||Wi,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),y.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(E.stringUid," => ").concat(G)),E.uid=G,O.gatewayInfo.uid=G,O.gatewayInfo.res.uid=G}else O=await zM(E,this._axiosCancelSource.token,this._config.httpRetryConfig||Wi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new $(k.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(E,this._axiosCancelSource.token),this._configDistribute.on(xg.UPDATE_BITRATE_LIMIT,G=>{this._p2pChannel.updateBitrateLimit(G)}),this._configDistribute.on(xg.UPDATE_CLIENT_ROLE_OPTIONS,G=>{this._setClientRoleOptions(G)})},0),this._key=i||e;let M=O.gatewayInfo,B=E.uid?E.uid:M.uid;this._joinInfo=ws(ws({},E),{},{cid:M.cid,uid:B,vid:M.vid,apResponse:M.res,apGatewayAddress:M.apGatewayAddress,uni_lbs_ip:M.uni_lbs_ip,gatewayAddrs:M.gatewayAddrs}),this.store.intUid=B,this.store.cid=M.cid;let Y=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new $(k.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));_.onSuccess(Y),this._appId=e,this._channelName=E.cname,this._uid=Y,this.store.uid=Y,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Rr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let H=E.stringUid?"string uid: ".concat(E.stringUid,",uid: ").concat(E.uid):"uid: ".concat(this._uid);return y.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(H)),setTimeout(()=>{y.startUpload()},5e3),this.store.joinEnd(),w=this,ve(Oh).call(Oh,w)||Oh.push(w),this._cloudProxyServerMode==="disabled"&&Ot().supportWebCrypto&&U("ENABLE_PRELOAD")&&TI(this._joinInfo),Y}catch(O){let L=Array.isArray(O)?O[0]:O;throw L&&L.code===k.OPERATION_ABORTED?y.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),L):y.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),L),L.code!==k.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),_.onError(L),L}var w}_joinGateway(){if(!this._joinInfo||!this._key)throw new $(k.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!U("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){y.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Rr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),(function(t){let i=Oh.indexOf(t);i!==-1&&Oh.splice(i,1)})(this),this._statsCollector.stopUpdateStats();let e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return y.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Bt.LEAVE),y.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof om))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new $(k.INVALID_PARAMS,"param list is empty");let i=e;if(this._gateway.role==="audience")throw new $(k.INVALID_OPERATION,"audience can not publish stream");for(let n of i){if(!(n instanceof om))throw new $(k.INVALID_PARAMS,"parameter is not local track");if(!n._enabled&&t)throw new $(k.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(n.getTrackId()))}y.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(n=>"".concat(n.getTrackId()," "))));let r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&i.forEach(n=>{let s=this._configDistribute.getBitrateLimit();n instanceof ai&&s&&n.setBitrateLimit(s.uplink)});try{await this._publishHighStream(i),y.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(n=>"".concat(n.getTrackId()," "))))}catch(n){throw y.error("[".concat(this._clientId,"] publish error"),n.toString()),n}finally{r()}}async _publishDataChannel(e){if(e==null)throw new $(k.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));Yt(e.id,"id",0,65535,!0),ro(e.ordered,"ordered"),pr(e.metadata,"metadata",0,512),y.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(n=>n.id===e.id)!==-1)throw new $(k.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new $(k.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new $(k.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&U("FORCE_TURN")&&!U("TURN_ENABLE_TCP")&&!U("TURN_ENABLE_UDP"))throw new $(k.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let i=(function(n){return xM(n,!1)})(e),r=await this._p2pChannel.publishDataChannel([i]);if(r.length>0){if(typeof i._originDataChannelId!="number")throw y.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new $(k.CREATE_DATACHANNEL_ERROR);try{await we.all(r.map(n=>this._uid&&this._gateway.publishDataChannel(this._uid,n,!0))),await i._waitTillOpen()}catch(n){if(n.code!==k.DISCONNECT_P2P)throw n}}return y.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw y.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new $(k.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof om))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);y.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(r=>"".concat(r.getTrackId()," "))," "));let i=await this._publishMutex.lock();try{if(this.store.useP2P){let r=await this._p2pChannel.unpublish(t);r&&await this._gateway.sendExtensionMessage(xi.UNPUBLISH,{unpubMsg:r},!0)}else{let r=await this._p2pChannel.unpublish(t);r&&await this._gateway.unpublish(r,this._uid),y.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(n=>"".concat(n.getTrackId()))))}}catch(r){throw y.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),y.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));let t=await this._publishMutex.lock();try{let i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),y.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(r=>"".concat(r.id))))}catch(i){throw y.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{t&&t()}}async subscribe(e,t,i){if(!(e instanceof Gd)){let r=this.remoteUsers.find(n=>n.uid===e);if(!r)throw new $(k.INVALID_REMOTE_USER,"user is not in the channel");e=r}return t==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,t)}async presubscribe(e,t){if($i(t,"mediaType",["audio","video"]),this.store.useP2P)throw new $(k.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new $(k.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new $(k.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let i=t===Le.AUDIO,r=t===Le.VIDEO,n=await this._subscribeMutex.lock();try{let{ssrcId:s,ortc:c,rtxSsrcId:l,cname:d,uint_id:h}=await this._gateway.presubscribe(e,t,!0);if(s==null)throw new $(k.UNEXPECTED_RESPONSE,"no ssrc id");let p=this._users.find(E=>E.uid===e);p||(p=new Gd(e,h||e),p._is_pre_created=!0,this._users.push(p)),d&&(p._cname=d),p._uintid||(p._uintid=h||e),i&&(p._audioSSRC=s,p._audio_pre_subscribed=!0,c&&(p._audioOrtc=c)),r&&(p._videoSSRC=s,p._video_pre_subscribed=!0,c&&(p._videoOrtc=c),l!=null&&(p._rtxSsrcId=l)),y.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(p,t,s,l,c);let _=i?p._audioTrack:p._videoTrack;if(!_)throw new $(k.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(p._trust_audio_stream_added_state_=!0,p._audio_added_=!0),r&&(p._trust_video_stream_added_state_=!0,p._video_added_=!0),_}catch(s){throw y.error("[".concat(this._clientId,"] presub user ").concat(e," error"),s),s}finally{n()}}async _subscribeDataChannel(e,t){var i;if(Yt(t,"channelId",0,65535,!0),!this._joinInfo)throw new $(k.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new $(k.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===e))throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new $(k.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new $(k.INVALID_REMOTE_USER,"user is not published");let r=(i=e._dataChannels)===null||i===void 0?void 0:i.find(c=>c.id===t);if(!r)throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new $(k.REMOTE_USER_IS_NOT_PUBLISHED);let n=await this._subscribeMutex.lock();y.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let c=await this._p2pChannel.subscribeDataChannel(e,[r]);if(c&&ve(c).call(c,r.id))try{var s;if(typeof r._originDataChannelId!="number")throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new $(k.CREATE_DATACHANNEL_ERROR);let l={id:r.id,datachannelId:r._originDataChannelId,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:(s=r.metadata)!==null&&s!==void 0?s:""};await this._gateway.subscribeDataChannel(e.uid,l,!0),await r._waitTillOpen()}catch(l){if(l?.code!==k.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[r]),l;await this._p2pChannel.unsubscribeDataChannel(e,[r]),this._p2pChannel.setPendingRemoteDataChannel(e,r.id)}return y.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),r}finally{n()}}async _p2pSubscribe(e,t,i){if($i(t,"mediaType",["audio","video"]),!this._joinInfo)throw new $(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new $(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(n=>n===e)){let n=new $(k.INVALID_REMOTE_USER,"user is not in the channel");throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),n}if(!e.hasAudio&&!e.hasVideo){let n=new $(k.INVALID_REMOTE_USER,"user is not published");throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),n}if(!i&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){let n=new $(k.REMOTE_USER_IS_NOT_PUBLISHED);throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}let r=await this._subscribeMutex.lock();y.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let s=t==="audio"?e._audioSSRC:e._videoSSRC,c=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,s,c)}catch(s){throw s}y.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(s=>{y.warning("[".concat(this._clientId,"] auto set fallback failed"),s)});let n=t==="audio"?e._audioTrack:e._videoTrack;if(!n)throw new $(k.UNEXPECTED_ERROR,"can not find remote track in user object");return n}catch(n){throw y.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),n),n}finally{r()}}async _subscribe(e,t,i){if(this.store.useP2P)return this._p2pSubscribe(e,t);if($i(t,"mediaType",["audio","video"]),!this._joinInfo)throw new $(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new $(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===e)){let d=new $(k.INVALID_REMOTE_USER,"user is not in the channel");throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),d}if(!e.hasAudio&&!e.hasVideo){let d=new $(k.INVALID_REMOTE_USER,"user is not published");throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),d}if(!(i||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){let d=new $(k.REMOTE_USER_IS_NOT_PUBLISHED);throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),d}let r=t==="audio"?e._audioSSRC:e._videoSSRC,n=t==="audio"?e._audioOrtc:e._videoOrtc,s=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?Le.AUDIO:Le.VIDEO,ssrcId:r};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});let l=await this._subscribeMutex.lock();y.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let h=t==="audio"?e._audioSSRC:e._videoSSRC;h!==void 0&&h!==r&&(r=h,n=t==="audio"?e._audioOrtc:e._videoOrtc,s=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?Le.AUDIO:Le.VIDEO,ssrcId:r}),Ur.markSubscribeStart(this.store.clientId,r),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,r,s,n);try{this._p2pChannel.isPreSubScribe(r)||await this._gateway.subscribe(e.uid,c,!0)}catch(p){if(p?.code!==k.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),p;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(h){throw this._p2pChannel.reportSubscribeEvent(!1,h?.code,e,t),h}y.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(h=>{y.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});let d=t==="audio"?e._audioTrack:e._videoTrack;if(!d)throw new $(k.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),d}catch(d){throw y.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),d),d}finally{l()}}async massSubscribe(e){if(ol(e,"subscribeList"),!this._joinInfo)throw new $(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new $(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t=Date.now(),i=new Map,r=await this._subscribeMutex.lock();y.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(l=>{let{user:d,mediaType:h}=l;return"user: ".concat(d?.uid,", mediaType: ").concat(h)}).join("; ")));let n=(e=[...e]).map(l=>{let{user:d,mediaType:h}=l;return{user:d,mediaType:h}}),s=await this._p2pChannel.globalLock();try{var c;for(let d=e.length-1;d>=0;d--){let h=e[d],{user:p,mediaType:_}=h;if($i(_,"mediaType",["audio","video"]),!p){let N=new $(k.INVALID_PARAMS,"user property does not exist in subscribeList item");throw y.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),N}if(!this._users.find(N=>N===p)){let N=new $(k.INVALID_REMOTE_USER,"user is not in the channel");y.error("[".concat(this._clientId,"] can not massSubscribe ").concat(p.uid,", this user is not in the channel")),n[d].error=N,e.splice(d,1);continue}if(_==="audio"&&(!p.hasAudio||p._audioSSRC===void 0)||_==="video"&&(!p.hasVideo||p._videoSSRC===void 0)){let N=new $(k.REMOTE_USER_IS_NOT_PUBLISHED);y.error("[".concat(this._clientId,"] can not subscribe ").concat(p.uid," with mediaType ").concat(_,", remote user is not published")),n[d].error=N,e.splice(d,1);continue}let E=nr.Video|nr.LwoVideo,R=i.get(p);if(R){if(_==="video"?R&E:R&nr.Audio){e.splice(d,1),y.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(p.uid,", mediaType:").concat(_," twice"));continue}i.set(p,R|(_==="video"?E:nr.Audio))}else i.set(p,_==="video"?E:nr.Audio)}for(let d=e.length-1;d>=0;d--){let h=e[d],{user:p,mediaType:_}=h,E=nr.Video|nr.LwoVideo;if(this._p2pChannel.hasRemoteMedia(p,_)){await this._p2pChannel.unmuteRemoteNoLock(p,_);let R=i.get(p);i.set(p,_==="video"?R^E:R^nr.Audio),e.splice(d,1)}}this.store.massSubscribe(e.map(d=>({userId:d.user.uid,type:d.mediaType})),t);let l=In(c=Array.from(i.entries())).call(c,(d,h)=>{let[p,_]=h;if(_===0)return d;let E={stream_id:p.uid,stream_type:_};return _&nr.Audio&&(E.audio_ssrc=p._audioSSRC),_&nr.Video&&(E.video_ssrc=p._videoSSRC),d.push(E),d},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(h=>{let{user:p,mediaType:_}=h;return{user:p,mediaType:_,ssrcId:_===Le.VIDEO?p._videoSSRC:p._audioSSRC,rtxSsrcId:_===Le.VIDEO?p._rtxSsrcId:void 0}}));let d=new Map;if(l=l.filter(h=>h.video_ssrc&&!this._p2pChannel.isPreSubScribe(h.video_ssrc)||h.audio_ssrc&&!this._p2pChannel.isPreSubScribe(h.audio_ssrc)||!h.video_ssrc&&!h.audio_ssrc),l.length>0&&((await this._gateway.subscribeAll(l,!0))?.users||[]).forEach(p=>{let{stream_id:_,video_error_code:E,audio_error_code:R,error_code:N}=p;(E||R||N)&&d.set(_,{video_error_code:E,audio_error_code:R,error_code:N})}),Array.from(d.entries()).length>0){let h=[];Array.from(d.entries()).forEach(p=>{let[_,E]=p,R=this.remoteUsers.find(N=>N.uid===_);if(R){let N;E.error_code||E.video_error_code&&E.audio_error_code?N=void 0:E.video_error_code?N=Le.VIDEO:E.audio_error_code&&(N=Le.AUDIO),h.push({user:R,mediaType:N})}}),h.length>0&&await this._p2pChannel.massUnsubscribeNoLock(h)}for(let h of n){let p=d.get(h.user.uid);if(p){let _=p.error_code||h.mediaType==="audio"&&p.audio_error_code||h.mediaType==="video"&&p.video_error_code;if(_){let E=Ug(_);y.error("user:".concat(h.user.uid," mediaType:").concat(h.mediaType," has massSubscribe error ").concat(E.desc)),h.error=new $(k.SUBSCRIBE_FAILED,"code ".concat(_,": ").concat(E.desc))}}h.error||(h.mediaType==="video"?h.track=h.user.videoTrack:h.track=h.user.audioTrack)}return this.store.massSubscribe(n.filter(h=>!h.error).map(h=>({userId:h.user.uid,type:h.mediaType})),void 0,Date.now()),n.forEach(h=>{var p;Fe.subscribe(this.store.sessionId,{succ:!!h.error,ec:((p=h.error)===null||p===void 0?void 0:p.code)||null,video:h.mediaType===Le.VIDEO,audio:h.mediaType===Le.AUDIO,peerid:h.user.uid,subscribeRequestid:h.mediaType===Le.VIDEO?h.user._videoSSRC:h.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(h.user._videoSSRC)},!0)}),y.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(h=>{let{user:p,mediaType:_}=h;return"user: ".concat(p?.uid,", mediaType: ").concat(_)}).join("; "))),n}catch(d){throw await this._p2pChannel.massUnsubscribeNoLock(e),d}}finally{s(),r()}}async unsubscribe(e,t,i){if(!(e instanceof Gd)){let n=this.remoteUsers.find(s=>s.uid===e);if(!n)throw new $(k.INVALID_REMOTE_USER,"user is not in the channel");e=n}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(t&&$i(t,"mediaType",["audio","video"]),!this._joinInfo)throw new $(k.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(n=>n===e)){let n=new $(k.INVALID_REMOTE_USER,"user is not in the channel");throw y.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),n}y.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));let r=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{let n=await this._p2pChannel.unsubscribe(e,t);n&&await this._gateway.unsubscribe(n,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&iR(this._users,e),y.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(n){if(n.code===k.DISCONNECT_P2P)return void y.warning("disconnecting p2p, abort unsubscribe request.");throw y.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),n.toString()),n}finally{r()}}async _unsubscribeDataChannel(e,t){if(t&&Yt(t,"id",0,65535,!0),!this._joinInfo)throw new $(k.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(r=>r===e)){let r=new $(k.INVALID_REMOTE_USER,"user is not in the channel");throw y.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),r}let i;if(typeof t=="number"){let r=e._dataChannels.find(n=>n.id===t);r&&(i=[r])}else i=e._dataChannels;if(i===void 0){let r=new $(k.REMOTE_USER_IS_NOT_PUBLISHED);throw y.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),r}y.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i.map(r=>r.id)));try{let r=await this._p2pChannel.unsubscribeDataChannel(e,i);r&&await this._gateway.unsubscribeDataChannel(r,e.uid),y.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r))}catch(r){if(r.code===k.DISCONNECT_P2P)return void y.warning("disconnecting p2p, abort unsubscribe request.");throw y.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),r.toString()),r}}async massUnsubscribe(e){if(ol(e,"unsubscribeList"),!this._joinInfo)throw new $(k.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");y.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:r,mediaType:n}=i;return"user: ".concat(r?.uid,", mediaType: ").concat(n,";")}).join())),e=[...e];let t=new Map;for(let i=e.length-1;i>=0;i--){let{user:r,mediaType:n}=e[i];if(!r){let c=new $(k.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw y.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),c}if($i(n,"mediaType",["video","audio",void 0]),!this._users.find(c=>c===r)){y.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(i,1);continue}let s=nr.Video|nr.LwoVideo;if(t.has(r)){let c=t.get(r),l;switch(n){case"video":l=c&s;break;case"audio":l=c&nr.Audio;break;default:l=c&(nr.Audio|s)}if(l){y.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(n," twice.")),e.splice(i,1);continue}n?n==="audio"?t.set(r,c|nr.Audio):n==="video"&&t.set(r,c|s):t.set(r,c|nr.Audio|s)}else n?n==="audio"?t.set(r,nr.Audio):n==="video"&&t.set(r,s):t.set(r,nr.Audio|s)}try{let i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),y.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(r=>{let{user:n,mediaType:s}=r;return"user: ".concat(n?.uid,", mediaType: ").concat(s,";")}).join()))}catch(i){if(i.code===k.DISCONNECT_P2P)return void y.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw y.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new ne(k.INVALID_PARAMS);yi(i.width)||WA(i.width,"streamParameter.width"),yi(i.height)||WA(i.height,"streamParameter.height"),yi(i.framerate)||WA(i.framerate,"streamParameter.framerate"),yi(i.bitrate)||Yt(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&y.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),y.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,me.LocalVideoLowTrack)}async enableDualStream(){if(!Ot().supportDualStream)throw Fe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new $(k.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new $(k.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Fe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,Fe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),y.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new $(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(me.LocalVideoLowTrack))try{let e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Fe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,Fe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),y.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if((function(r){$i(r,"role",["audience","host"])})(e),t&&qA(t),this.mode==="rtc"||this.mode==="p2p")throw y.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new $(k.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new $(k.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new $(k.INVALID_OPERATION,"can not set client role to audience when publishing stream");let i=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==i&&U("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",yr.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),y.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&qA(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{y.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;let t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;let i=t.timestamp-Date.now();return Math.abs(i)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(pr(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new $(k.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new $(k.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Fe.setProxyServer(this._proxyServer),y.setProxyServer(this._proxyServer),y.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new $(k.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new $(k.INVALID_OPERATION,"You have already set the proxy")}if(bg(e))return this._turnServer={servers:e,mode:"original-manual"},void y.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>uL(i)),this._turnServer={servers:e,mode:"manual"},y.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new $(k.INVALID_OPERATION,"you should set license before join channel");if(pr(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new $(k.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,y.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new $(k.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new $(k.INVALID_OPERATION,"You have already set the proxy");let t=[3,4,5],i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new $(k.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new $(k.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,y.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new $(k.INVALID_OPERATION,"Stop proxy server after leave channel");Fe.setProxyServer(),y.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",y.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new $(k.INVALID_PARAMS,"accessPoints is required.");ol(e.accessPoints.serverList,"accessPoints.serverList"),pr(e.accessPoints.domain,"accessPoints.domain");let t=(E,R)=>{Yt(E,R,0,65535,!0)},i=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new $(k.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");U("CLOSE_AFB_FOR_LOCAL_AP")&&(Ht("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Ht("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,n=e.accessPoints.domain,s=e.accessPoints.serverList.map(E=>r.test(E)?"".concat(E.replace(/\./g,"-"),".").concat(n):E),c=s.map(E=>"".concat(E,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Ht("WEBCS_DOMAIN",c),Ht("WEBCS_DOMAIN_BACKUP_LIST",c),Ht("GATEWAY_DOMAINS",[n]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(ol(e.report.hostname,"report.hostname"),Ht("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Ht("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Ht("EVENT_REPORT_DOMAIN",s[0]),Ht("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let l=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),l=e.report.port),Ht("STATS_COLLECTOR_PORT",l),e.report?Ht("ENABLE_EVENT_REPORT",!0):Ht("ENABLE_EVENT_REPORT",!1);let d="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(ol(e.log.hostname,"log.hostname"),d=e.log.hostname[0]):d=s[0];let h=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),h=e.log.port),Ht("LOG_UPLOAD_SERVER","".concat(d,":").concat(h));let p=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(ol(e.cds.hostname,"cds.hostname"),p=e.cds.hostname):p=s;let _=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),_=e.cds.port),Ht("CDS_AP",p.map(E=>"".concat(E,":").concat(_))),e.cds?Ht("ENABLE_CONFIG_DISTRIBUTE",!0):Ht("ENABLE_CONFIG_DISTRIBUTE",!1),y.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(ol(e,"serverList"),pr(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new $(k.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(r=>i.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Ht("WEBCS_DOMAIN",e),Ht("WEBCS_DOMAIN_BACKUP_LIST",e),Ht("GATEWAY_DOMAINS",[t]),Ht("EVENT_REPORT_DOMAIN",e[0]),Ht("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Ht("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),y.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if($i(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw y.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else y.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){$i(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{let i=this._users.find(r=>r.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw y.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}y.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){$i(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(i){throw y.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}y.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,i,r){(function(s){$i(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),pr(t,"secret");let n=["aes-128-gcm2","aes-256-gcm2"];if(ve(n).call(n,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new $(k.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new $(k.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(ro(r,"encryptDataStream"),!ve(n).call(n,e))throw new $(k.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||y.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,i&&(this._encryptionSalt=Dd(i))}async renewToken(e){if(pr(e,"token",1,2047),!this._key||!this._joinInfo)throw new $(k.INVALID_OPERATION,"renewToken should not be called before user join");let t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let i=await this._renewTokenMutex.lock();try{if(U("USE_NEW_TOKEN")){y.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let r=await nG(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Wi);y.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:r})}else y.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});y.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,y.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?y.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(Tt.VOLUME_INDICATOR,e)},U("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new $(k.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new $(k.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new $(k.LIVE_STREAMING_TASK_CONFLICT);let i=t?cl.TRANSCODE:cl.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(cl.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){let t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!t.length)throw new $(k.INVALID_PARAMS,"can not find live streaming url to stop");await we.all(t.map(i=>i&&i.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){QM(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){QM(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Yg&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new $(k.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){let n=new TextEncoder;e.payload=n.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ve(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await(async function(n,s,c){var l;let d=In(l=Array.from(c)).call(l,(w,O)=>w+O,0),h={serverTs:0,seq:b8++,length:c.length,checkSum:d},p=new Uint8Array(SL(d,2)),_=new ArrayBuffer(tm),E=new DataView(_);E.setUint32(0,h.serverTs),E.setUint16(4,h.seq),E.setUint16(6,h.length),E.setUint16(8,h.checkSum);let R=16-c.length%16;c=fL(c,new Uint8Array(R));let N=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:n,tagLength:PL,additionalData:p},s,c);return fL(new Uint8Array(_),new Uint8Array(N))})(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new $(k.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Je.DATA_STREAM,{payload:Dd(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-hG},!i)}sendMetadata(e){if(!this._joinInfo)throw new $(k.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new $(k.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Je.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Dd(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(k8),!this._joinInfo)throw new $(k.INVALID_OPERATION,"can not send custom report, not joined");await Fe.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){let e=this._statsCollector.getRemoteNetworkQualityStats();if(U("DELETE_NEQ_AFTER_USER_LEAVE")){let t=this._users.map(i=>i.uid+"");Object.keys(e).forEach(i=>{ve(t).call(t,i)||delete e[i]})}return e}async pickSVCLayer(e,t){$i(t.spatialLayer,"spatialLayer",[0,1,2,3]),$i(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(i){throw y.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){let{apRTM:t=!1,rtmFlag:i}=e;if(ro(t,"apRTM"),Yt(i,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=i,y.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(y.debug("[".concat(this._clientId,"] reset client")),(function(e){let t=pm.indexOf(e);t!==-1&&pm.splice(t,1)})(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Tn.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&Cx(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Fe.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Lr("client-publish",this._clientId),this._subscribeMutex=new Lr("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var i;let r=e||Rh();e?y.debug("[".concat(this._clientId,"] new Session ").concat(r)):y.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));let n=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,Fe.addSid(r);let s={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:t?.stringUid||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:n,clientRole:this.role==="audience"?2:1};Fe.sessionInit(this._sessionId,ws({cname:t.channel,appid:t.appId},s)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new $(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new $(k.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&U("FORCE_TURN")&&!U("TURN_ENABLE_TCP")&&!U("TURN_ENABLE_UDP"))throw new $(k.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");y.debug("[".concat(this._clientId,"] publish high stream"));try{let i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){let r=(await i.next()).value;if(r){try{await this._gateway.sendExtensionMessage(xi.PUBLISH,r,!0)}catch(n){throw i.throw(n),n}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let r=(await i.next()).value;if(r){var t;let n;try{n=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==k.DISCONNECT_P2P)throw i.throw(s),s}await i.next(((t=n)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let n of e)n instanceof ai&&n._encoderConfig&&this._gateway.setVideoProfile(n._encoderConfig).catch(s=>{y.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!n.muted&&n.enabled||await this._p2pChannel.muteLocalTrack(n)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i?.code,e),i?.code===k.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new $(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new $(k.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));y.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await i.next()).value;if(r){var t;let n;try{n=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==k.DISCONNECT_P2P)throw i.throw(s),s}i.next(((t=n)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i?.code,void 0,!0),i?.code===k.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){let t=()=>{if(!this._joinInfo||!this._appId)return new $(k.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let i=(r={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},ul("LiveStreaming").create(r));var r;return i.onLiveStreamError=(n,s)=>{Fe.reportApiInvoke(this._sessionId,{name:Oi.ON_LIVE_STREAM_ERROR,options:[n,s],tag:pi.TRACER}).onSuccess(),this.safeEmit(Tt.LIVE_STREAMING_ERROR,n,s)},i.onLiveStreamWarning=(n,s)=>{Fe.reportApiInvoke(this._sessionId,{name:Oi.ON_LIVE_STREAM_WARNING,options:[n,s],tag:pi.TRACER}).onSuccess(),this.safeEmit(Tt.LIVE_STREAMING_WARNING,n,s)},i.on(Gw.REQUEST_WORKER_MANAGER_LIST,(n,s,c)=>{if(!this._joinInfo)return c(new $(k.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(l,d,h,p){let _=U("UAP_AP").slice(0,U("AJAX_REQUEST_CONCURRENT")).map(E=>d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(E+"/api/v1?action=uap"):"https://".concat(E,"/api/v1?action=uap"));return await Z9(_,l,d,h,p)})(n,this._joinInfo,this._axiosCancelSource.token,Wi).then(s).catch(c)}),i};return e===cl.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new $(k.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:t,sendResolutionHeight:i}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:i}},ul("ChannelMediaRelay").create(e));r.on("state",n=>{n===xn.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(Tt.CHANNEL_MEDIA_RELAY_STATE,n)}),r.on("event",n=>{this.safeEmit(Tt.CHANNEL_MEDIA_RELAY_EVENT,n)}),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(n,s)=>{var c;n==="resolution"&&((c=this._channelMediaRelayClient)===null||c===void 0||c.setVideoProfile(s))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){let{added:i,deleted:r}=e,n=[];if(t){let s=[];this._users.forEach(c=>{c._dataChannels.forEach(l=>{i.every(d=>d.uid!==c._uintid||d.stream_id!==l.id)&&s.push({uid:c._uintid,stream_id:l.id,ordered:l.ordered,max_retrans_times:l.maxRetransmits,metadata:l.metadata})})}),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(i)&&i.length>0&&i.forEach(s=>{let{uid:c,stream_id:l,ordered:d,max_retrans_times:h,metadata:p}=s,_=this._users.find(E=>E._uintid===c);if(!_)return void y.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(y.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(c)),ve(n).call(n,_)||n.push(_),_._uintid||(_._uintid=c),_._dataChannels.findIndex(E=>E.id===s.stream_id)===-1){let E={id:l,ordered:!!d,maxRetransmits:h,metadata:p},R=(function(N){return xM(N,!0)})(E);_._dataChannels.push(R),y.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published datachannel")),t||this.safeEmit(Tt.USER_PUBLISHED,_,"datachannel",E)}this._p2pChannel.hasPendingRemoteDataChannel(_,s.stream_id)&&(y.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(_.uid," after reconnect.")),this._subscribeDataChannel(_,s.stream_id).catch(E=>{y.error("[".concat(this._clientId,"] resubscribe datachannel error"),E.toString())}))}),t&&(this.safeEmit(Tt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(s=>{let{uid:c,stream_id:l}=s,d=this._users.find(p=>p._uintid===c);if(!d)return void y.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let h=d._dataChannels.find(p=>p.id===s.stream_id);h&&(y.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(c)),this._p2pChannel.unsubscribeDataChannel(d,[h]).then(p=>{if(d._dataChannels=d._dataChannels.filter(_=>_!==h),p)return this._gateway.unsubscribeDataChannel(p,d.uid)}),y.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished datachannel ,id:").concat(h.id)),this.safeEmit(Tt.USER_UNPUBLISHED,d,"datachannel",h._config))})}_getEncodingName(e){var t;if(!this._joinResponse)return;let i=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(i)for(let n of i){var r;if(n.payloadType===e)return n==null||(r=n.rtpMap)===null||r===void 0?void 0:r.encodingName}}_handleRemoveDataChannels(e){let t=this._users.find(i=>i.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){y.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));let i=()=>{y.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(r=>{this.safeEmit(Tt.USER_UNPUBLISHED,t,"datachannel",r._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(r=>{if(r)return this._gateway.unsubscribeDataChannel(r,t.uid)}),i()}}else y.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(or.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void y.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),i=Date.now();Object.keys(t).forEach(r=>{let{value:n,type:s,expires:c}=t[r];c&&c<=i||s||Mw()||!Object.prototype.hasOwnProperty.call(cR,r)||(ao[r]=n,di[r]=n,y.debug("Update gateway parameters from config distribute",r,n))})}catch(t){y.error("Error update config from local cache",t.message)}})()}),this._gateway.on(or.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(or.CONNECTION_STATE_CHANGE,(e,t,i)=>{var r;if(i===Bt.FALLBACK)return;let n=()=>{this.safeEmit(Tt.CONNECTION_STATE_CHANGE,e,t,i)};if(Fe.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:Oi.CONNECTION_STATE_CHANGE,options:[e,t,i],tag:pi.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:i})),y.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void n();if(e==="RECONNECTING")this._users.forEach(c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._is_pre_created||(c._audio_pre_subscribed||(c._audioSSRC=void 0,c._audioOrtc=void 0),c._video_pre_subscribed||(c._videoSSRC=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),c._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach((c,l)=>{this._gateway.setStreamFallbackOption(l,c).catch(d=>{y.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),d)})}),this._remoteStreamTypeCacheMap.forEach((c,l)=>{this._gateway.setRemoteVideoStreamType(l,c).catch(d=>{y.warning("[".concat(this._clientId,"] auto set remote stream type failed"),d)})}),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{y.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(c=>{y.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(c=>!c._trust_in_room_).forEach(c=>{y.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(c=>{c._trust_audio_mute_state_||(y.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,Le.AUDIO,!1)),c._trust_video_mute_state_||(y.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,Le.VIDEO,!1)),c._trust_audio_enabled_state_||(y.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(y.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(y.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(y.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(y.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))}))},1e3))}n()}),this._gateway.on(or.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new $(k.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i,r=await Rx(ws(ws({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));r?(i=r.ap,bx(r),this._joinInfo.preload=!0):(i=await nI(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Wi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);let n=[];i.gatewayInfo.gatewayAddrs.forEach(s=>{let{address:c}=s,[l,d]=c.split(":");this._joinInfo&&this._joinInfo.proxyServer?n.push({proxy:this._joinInfo.proxyServer,host:l,port:d}):n.push({host:l,port:d})}),e(n)}catch(i){t(i)}}),this._gateway.on(or.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Tt.NETWORK_QUALITY,e)}),this._gateway.on(or.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Tt.STREAM_TYPE_CHANGED,e,t),Fe.reportApiInvoke(this._sessionId,{name:Oi.STREAM_TYPE_CHANGE,options:[e,t],tag:pi.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(or.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(or.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,i)=>{try{let r=await this._p2pChannel.getEstablishParams();r&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(r=await this._p2pChannel.startP2PConnection(e)),t(r)}catch(r){i(r)}}),this._gateway.on(or.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let i;this._joinResponse=e,e.attributes?i=e.attributes.userAttributes.preSubSsrcs:y.debug("no attributes in joinResponse");let r=CM(e.ortc,t,i);this._p2pChannel.connect(r)}),this._gateway.on(or.PRE_CONNECT_PC,async e=>{let{candidates:t,fingerprint:i,turnServer:r}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){let{cert:s,cid:c}=this._joinInfo.apResponse,l="".concat(c,"_").concat(s);if(l.length<4||l.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:r,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var n;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(c,"_").concat(s),icePwd:"".concat(c,"_").concat(s)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(n=U("FINGERPRINT"))!==null&&n!==void 0?n:i}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(d){d.code&&d.code===k.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:r,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(vt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(vt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(vt.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(vt.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(vt.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(vt.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(vt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(vt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(vt.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Le.AUDIO,!0)),this._gateway.signal.on(vt.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Le.AUDIO,!1)),this._gateway.signal.on(vt.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Le.VIDEO,!0)),this._gateway.signal.on(vt.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Le.VIDEO,!1)),this._gateway.signal.on(vt.RECEIVE_METADATA,e=>{let t=vh(e.metadata);this.safeEmit(Tt.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(vt.ON_DATA_STREAM,async e=>{var t;if(!e)return;let i=vh(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ve(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<tm)throw new $(k.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(tm));i=await(async function(n,s,c){let l=c.subarray(0,tm),d=l.slice(8,tm),h=(d[0]<<8)+d[1],p=(l[6]<<8)+l[7],_=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:n,tagLength:PL,additionalData:new Uint8Array(SL(h,2))},s,c.subarray(tm));return new Uint8Array(_).subarray(0,p)})(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let r=0;if(e.ordered||e.syncWithAudio){let n=this._p2pChannel.getStats(),s=this.remoteUsers.find(l=>l.uid===e.uid);r=n?.audioRecv.find(l=>l.ssrc===s?._audioSSRC)?.jitterBufferMs}(r==null||Number.isNaN(r))&&(r=0),fG(ws(ws({},e),{},{payload:i}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(vt.ON_CRYPT_ERROR,()=>{Nd(()=>{y.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Tt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(vt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(vt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{y.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Bt.TOKEN_EXPIRE),this.safeEmit(Tt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(vt.ON_STREAM_FALLBACK_UPDATE,e=>{y.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Tt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(vt.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),y.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(vt.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(vt.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(nt.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Je.PUBLISH:{if(!t)return;let n=t.ortc;if(n){var i,r;let s=n.some(d=>{let{stream_type:h}=d;return h===Ft.Audio}),c=n.some(d=>{let{stream_type:h}=d;return h!==Ft.Audio}),l=n.some(d=>{let{stream_type:h}=d;return h===Ft.Screen||h===Ft.ScreenLow});t.state==="offer"&&Fe.publish(this._joinInfo.sid,{eventElapse:Ur.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:k.TIMEOUT,audio:s,video:c,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:l,audioName:s?(i=n.find(d=>{let{stream_type:h}=d;return h===Ft.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:c?(r=n.find(d=>{let{stream_type:h}=d;return h!==Ft.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case Je.SUBSCRIBE:t&&Fe.subscribe(this._joinInfo.sid,{succ:!1,ec:k.TIMEOUT,audio:t.stream_type===Le.AUDIO,video:t.stream_type===Le.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Ur.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(vt.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(vt.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;U("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(r=>!Nh(r.string_id||r.stream_id,this.channelName)));let t=[],i=[];for(let r of e.users){let n=this._users.find(p=>p._uintid===r.stream_id);n?n._trust_in_room_=!0:(n=new Gd(r.string_id||r.stream_id,r.stream_id),this._users.push(n),this.store.firstVideoFrameDecoded(n.uid,{userJoinNotify:Date.now()}),this.getListeners(Tt.PUBLISHED_USER_LIST).length===0&&(y.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(Tt.USER_JOINED,n)));let s=nr.Audio&r.stream_type,c=(nr.Video|nr.LwoVideo)&r.stream_type,l=(65280&r.stream_type)!=0,d=s&&n.hasAudio,h=c&&n.hasVideo;c&&(n._trust_video_stream_added_state_=!0,n._video_added_=!0,n._videoSSRC=r.video_ssrc,n._rtxSsrcId=r.video_rtx),s&&(n._trust_audio_stream_added_state_=!0,n._audio_added_=!0,n._audioSSRC=r.audio_ssrc),s&&!d&&this.getListeners(Tt.PUBLISHED_USER_LIST).length===0&&(y.info("[".concat(this._clientId,"] remote user ").concat(n.uid," published audio")),this.safeEmit(Tt.USER_PUBLISHED,n,"audio")),c&&!h&&this.getListeners(Tt.PUBLISHED_USER_LIST).length===0&&(y.info("[".concat(this._clientId,"] remote user ").concat(n.uid," published video")),this.safeEmit(Tt.USER_PUBLISHED,n,"video")),(s&&!d||c&&!h||l)&&t.push(n),c&&this._p2pChannel.hasPendingRemoteMedia(n,"video")&&i.push({user:n,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(n,"audio")&&i.push({user:n,mediaType:"audio"})}i.length>0&&(y.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(r=>{y.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(Tt.PUBLISHED_USER_LIST).length>0?U("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(y.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(r=>r.uid).join(", "))),this.safeEmit(Tt.PUBLISHED_USER_LIST,t)):y.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(r=>r.uid).join(", ")))}),this._gateway.signal.on(vt.ON_RTP_CAPABILITY_CHANGE,e=>{let{video_codec:t}=e;this._p2pChannel instanceof Yg&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(i=>i.toLowerCase()).filter(i=>{var r;return ve(r=Object.keys(Ng)).call(r,i)}))})}_handleP2PEvents(){this._gateway.signal.on(vt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(xi.PUBLISH,(e,t,i)=>{let{uid:r}=e;e.forEach(n=>{let{kind:s,ssrcs:c,mid:l,isMuted:d}=n;this._handleP2PAddAudioOrVideoStream(s,r,c[0].ssrcId,l);let h=this._users.find(p=>p.uid===r);return h&&this.store.useP2P?this._p2pChannel.mockSubscribe(h,s,c[0].ssrcId,l).then(()=>{t()}).catch(i):t(),this._handleMuteStream(r,s,!!d)})}),this._gateway.signal.on(xi.CALL,async(e,t,i)=>{if(this.store.useP2P)try{var r;t(await this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},e))}catch(n){i(n)}}),this._gateway.signal.on(nt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(xi.UNPUBLISH,async(e,t,i)=>{if(this.store.useP2P){let{unpubMsg:r,uid:n}=e,s=this._users.find(c=>c.uid===n);if(!s)return y.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(n)),void t();try{r.forEach(async c=>{let{stream_type:l}=c,d=l===Ft.Audio?Le.AUDIO:Le.VIDEO;await this._p2pChannel.unsubscribe(s,d),this._handleMuteStream(n,d,!0)}),t()}catch(c){i(c)}}}),this._gateway.signal.on(xi.CONTROL,async(e,t)=>{let{action:i}=e;switch(i){case Md.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Le.VIDEO,!0);break;case Md.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Le.AUDIO,!0);break;case Md.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Le.VIDEO,!1);break;case Md.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Le.AUDIO,!1)}}),this._gateway.signal.on(xi.RESTART_ICE,async(e,t,i)=>{if(this.store.useP2P)try{let{direction:r,iceParameter:n}=e;r!==dn.SEND_ONLY||n?t(await this._p2pChannel.restartICE(r,n)):(this._p2pChannel.handleDisconnect(r),t())}catch(r){i(r)}}),this._gateway.signal.on(xi.CANDIDATE,e=>{if(this.store.useP2P){let{candidate:t,direction:i}=e;this._p2pChannel.addRemoteCandidate(t,i)}}),this._p2pChannel.on(ze.RequestP2PRestartICE,async(e,t,i)=>{try{let{direction:r}=e;t(await this._gateway.sendExtensionMessage(xi.RESTART_ICE,e,r===dn.SEND_ONLY))}catch(r){i(r)}}),this._p2pChannel.on(ze.LocalCandidate,e=>{this._gateway.sendExtensionMessage(xi.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(ze.RequestP2PMuteLocal,async(e,t,i)=>{try{await this._gateway.sendExtensionMessage(xi.CONTROL,e,!0),t()}catch(r){i(r)}}),this._p2pChannel.on(ze.RequestP2PUnmuteRemote,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===k.DISCONNECT_P2P?t():i(r)}else t()}),this._p2pChannel.on(ze.RequestP2PMuteRemote,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===k.DISCONNECT_P2P?t():i(r)}else t()}),this._p2pChannel.on(ze.StateChange,(e,t)=>{t===jt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(ze.PeerConnectionStateChange,e=>{let t=this._peerConnectionState;e!==t&&(this.safeEmit(Tt.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(ze.RequestMuteLocal,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===k.DISCONNECT_P2P?t():i(r)}else t()}),this._p2pChannel.on(ze.RequestUnmuteLocal,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===k.DISCONNECT_P2P?t():i(r)}else t()}),this._p2pChannel.on(ze.RequestRePublish,(e,t,i)=>{this.publish(e,!1).then(t).catch(i)}),this._p2pChannel.on(ze.RequestRePublishDataChannel,(e,t,i)=>{we.all(e.map(async r=>{let n=await this._p2pChannel.publishDataChannel([r]);try{n.forEach(s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)})}catch(s){if(s.code!==k.DISCONNECT_P2P)throw s}})).then(t).catch(i)}),this._p2pChannel.on(ze.RequestReSubscribe,async(e,t,i)=>{try{for(let{user:r,kind:n}of e)n===Le.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");t()}catch(r){i(r)}}),this._p2pChannel.on(ze.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(ze.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(ze.MediaReconnectStart,e=>{this.safeEmit(Tt.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(ze.MediaReconnectEnd,e=>{this.safeEmit(Tt.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(ze.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(ze.RequestRestartICE,async e=>{if(this.store.useP2P)return;let t=await this._p2pChannel.restartICE(e),i=await t.next();if(i.done)return;let r=i.value,n;try{n=await this._gateway.restartICE({iceParameters:r})}catch(c){return void t.throw(c)}let{iceParameters:s}=(function(c){let l=c.iceParameters;return{iceParameters:{iceUfrag:l.iceUfrag,icePwd:l.icePwd}}})(n);await t.next({remoteIceParameters:s})}),this._p2pChannel.on(ze.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(ze.RequestReconnectPC,async()=>{var e;let{iceParameters:t,dtlsParameters:i,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:n,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:i,rtpCapabilities:r}),c=CM(n,s);await this._p2pChannel.connect(c),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(ze.RequestUnpublishForReconnectPC,async(e,t,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):i()}),this._p2pChannel.on(ze.P2PLost,()=>{this.safeEmit(Tt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(ze.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(ze.ConnectionTypeChange,e=>{this.safeEmit(Tt.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(ze.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(ze.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(ze.AudioMetadata,e=>{this.safeEmit(Tt.AUDIO_METADATA,e)}),this._p2pChannel.on(ze.AudioPts,e=>{this.safeEmit(Tt.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new $(k.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new $(k.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let i=(t={config:e},ul("ContentInspect").create(t));this._inspect=i,this.handleVideoInspectEvents(i);let{appId:r,cname:n,sid:s,token:c,uid:l,cid:d,vid:h}=this._joinInfo;await i.init({appId:r,areaCode:"",cname:n,sid:s,token:c,uid:l,cid:d,vid:h?Number(h):0},Wi)}catch(i){throw Array.isArray(i)?i[0]:i}var t}handleVideoInspectEvents(e){e.on(cr.CONNECTION_STATE_CHANGE,(t,i)=>{if(this.safeEmit(Tt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,i),i===ys.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Tt.CONTENT_INSPECT_ERROR,new $(k.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(cr.INSPECT_RESULT,(t,i)=>{var r;if(i?.code===k.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return y.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(Tt.CONTENT_INSPECT_RESULT,t,i)}),e.on(cr.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new $(k.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(ro(e,"enabled"),e){if(!t)throw new $(k.INVALID_PARAMS,"config is required");if(Vx(t),!this._joinInfo)throw new $(k.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{let r=(i={config:t},ul("ImageModeration").create(i));this._moderation=r,this.handleImageModerationEvents(r);let{appId:n,cname:s,sid:c,token:l,uid:d,cid:h,vid:p}=this._joinInfo;await r.init({appId:n,areaCode:"",cname:s,sid:c,token:l,uid:d,cid:h,vid:p?Number(p):0},Wi)}}catch(r){throw Array.isArray(r)?r[0]:r}}else{var i;if(!this._moderation)throw new $(k.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}}handleImageModerationEvents(e){e.on(co.CONNECTION_STATE_CHANGE,(t,i)=>{if(this.safeEmit(Tt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,i),t===za.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new $(k.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(co.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(e){if((function(t){$i(t,"transport",["default","auto","relay","sd-rtn"])})(e),this.mode!=="p2p")throw new $(k.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,y.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return y.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){ro(e,"enabled"),Ht("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Be(Pe.prototype,"leave",[Bx],Object.getOwnPropertyDescriptor(Pe.prototype,"leave"),Pe.prototype),Be(Pe.prototype,"publish",[jx],Object.getOwnPropertyDescriptor(Pe.prototype,"publish"),Pe.prototype),Be(Pe.prototype,"unpublish",[Fx],Object.getOwnPropertyDescriptor(Pe.prototype,"unpublish"),Pe.prototype),Be(Pe.prototype,"subscribe",[Gx],Object.getOwnPropertyDescriptor(Pe.prototype,"subscribe"),Pe.prototype),Be(Pe.prototype,"presubscribe",[Hx],Object.getOwnPropertyDescriptor(Pe.prototype,"presubscribe"),Pe.prototype),Be(Pe.prototype,"massSubscribe",[Wx],Object.getOwnPropertyDescriptor(Pe.prototype,"massSubscribe"),Pe.prototype),Be(Pe.prototype,"unsubscribe",[zx],Object.getOwnPropertyDescriptor(Pe.prototype,"unsubscribe"),Pe.prototype),Be(Pe.prototype,"massUnsubscribe",[Kx],Object.getOwnPropertyDescriptor(Pe.prototype,"massUnsubscribe"),Pe.prototype),Be(Pe.prototype,"setLowStreamParameter",[Yx],Object.getOwnPropertyDescriptor(Pe.prototype,"setLowStreamParameter"),Pe.prototype),Be(Pe.prototype,"enableDualStream",[qx],Object.getOwnPropertyDescriptor(Pe.prototype,"enableDualStream"),Pe.prototype),Be(Pe.prototype,"disableDualStream",[Xx],Object.getOwnPropertyDescriptor(Pe.prototype,"disableDualStream"),Pe.prototype),Be(Pe.prototype,"setClientRole",[Jx],Object.getOwnPropertyDescriptor(Pe.prototype,"setClientRole"),Pe.prototype),Be(Pe.prototype,"_setClientRoleOptions",[Zx],Object.getOwnPropertyDescriptor(Pe.prototype,"_setClientRoleOptions"),Pe.prototype),Be(Pe.prototype,"setProxyServer",[Qx],Object.getOwnPropertyDescriptor(Pe.prototype,"setProxyServer"),Pe.prototype),Be(Pe.prototype,"setTurnServer",[$x],Object.getOwnPropertyDescriptor(Pe.prototype,"setTurnServer"),Pe.prototype),Be(Pe.prototype,"setLicense",[eU],Object.getOwnPropertyDescriptor(Pe.prototype,"setLicense"),Pe.prototype),Be(Pe.prototype,"startProxyServer",[tU],Object.getOwnPropertyDescriptor(Pe.prototype,"startProxyServer"),Pe.prototype),Be(Pe.prototype,"stopProxyServer",[iU],Object.getOwnPropertyDescriptor(Pe.prototype,"stopProxyServer"),Pe.prototype),Be(Pe.prototype,"setLocalAccessPointsV2",[rU],Object.getOwnPropertyDescriptor(Pe.prototype,"setLocalAccessPointsV2"),Pe.prototype),Be(Pe.prototype,"setLocalAccessPoints",[nU],Object.getOwnPropertyDescriptor(Pe.prototype,"setLocalAccessPoints"),Pe.prototype),Be(Pe.prototype,"setRemoteDefaultVideoStreamType",[aU],Object.getOwnPropertyDescriptor(Pe.prototype,"setRemoteDefaultVideoStreamType"),Pe.prototype),Be(Pe.prototype,"setRemoteVideoStreamType",[sU],Object.getOwnPropertyDescriptor(Pe.prototype,"setRemoteVideoStreamType"),Pe.prototype),Be(Pe.prototype,"setStreamFallbackOption",[oU],Object.getOwnPropertyDescriptor(Pe.prototype,"setStreamFallbackOption"),Pe.prototype),Be(Pe.prototype,"setEncryptionConfig",[cU],Object.getOwnPropertyDescriptor(Pe.prototype,"setEncryptionConfig"),Pe.prototype),Be(Pe.prototype,"renewToken",[lU],Object.getOwnPropertyDescriptor(Pe.prototype,"renewToken"),Pe.prototype),Be(Pe.prototype,"enableAudioVolumeIndicator",[dU],Object.getOwnPropertyDescriptor(Pe.prototype,"enableAudioVolumeIndicator"),Pe.prototype),Be(Pe.prototype,"startLiveStreaming",[uU],Object.getOwnPropertyDescriptor(Pe.prototype,"startLiveStreaming"),Pe.prototype),Be(Pe.prototype,"setLiveTranscoding",[hU],Object.getOwnPropertyDescriptor(Pe.prototype,"setLiveTranscoding"),Pe.prototype),Be(Pe.prototype,"stopLiveStreaming",[pU],Object.getOwnPropertyDescriptor(Pe.prototype,"stopLiveStreaming"),Pe.prototype),Be(Pe.prototype,"startChannelMediaRelay",[fU],Object.getOwnPropertyDescriptor(Pe.prototype,"startChannelMediaRelay"),Pe.prototype),Be(Pe.prototype,"updateChannelMediaRelay",[mU],Object.getOwnPropertyDescriptor(Pe.prototype,"updateChannelMediaRelay"),Pe.prototype),Be(Pe.prototype,"stopChannelMediaRelay",[_U],Object.getOwnPropertyDescriptor(Pe.prototype,"stopChannelMediaRelay"),Pe.prototype),Be(Pe.prototype,"sendCustomReportMessage",[EU],Object.getOwnPropertyDescriptor(Pe.prototype,"sendCustomReportMessage"),Pe.prototype),Be(Pe.prototype,"pickSVCLayer",[gU],Object.getOwnPropertyDescriptor(Pe.prototype,"pickSVCLayer"),Pe.prototype),Be(Pe.prototype,"setRTMConfig",[SU],Object.getOwnPropertyDescriptor(Pe.prototype,"setRTMConfig"),Pe.prototype),Be(Pe.prototype,"enableContentInspect",[TU],Object.getOwnPropertyDescriptor(Pe.prototype,"enableContentInspect"),Pe.prototype),Be(Pe.prototype,"disableContentInspect",[vU],Object.getOwnPropertyDescriptor(Pe.prototype,"disableContentInspect"),Pe.prototype),Be(Pe.prototype,"setImageModeration",[RU],Object.getOwnPropertyDescriptor(Pe.prototype,"setImageModeration"),Pe.prototype),Be(Pe.prototype,"setP2PTransport",[yU],Object.getOwnPropertyDescriptor(Pe.prototype,"setP2PTransport"),Pe.prototype),Be(Pe.prototype,"getJoinChannelServiceRecords",[CU],Object.getOwnPropertyDescriptor(Pe.prototype,"getJoinChannelServiceRecords"),Pe.prototype),Be(Pe.prototype,"setPublishAudioFilterEnabled",[bU],Object.getOwnPropertyDescriptor(Pe.prototype,"setPublishAudioFilterEnabled"),Pe.prototype),Pe);class Jg{constructor(t,i){D(this,"id",0),D(this,"element",void 0),D(this,"peerPair",void 0),D(this,"context",void 0),D(this,"audioPlayerElement",void 0),D(this,"audioTrack",void 0),Jg.count+=1,this.id=Jg.count,this.element=t,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{let i=document.createElement("audio");i.srcObject=new MediaStream([t.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;let t=async(r,n)=>{let s=n==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(s),r.iceGatheringState==="complete"?r.localDescription:new we(c=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&c(r.localDescription)}})},i=async(r,n)=>await r.setRemoteDescription(n);try{let r=await t(this.peerPair[0],"offer");await i(this.peerPair[1],r);let n=await t(this.peerPair[1],"answer");await i(this.peerPair[0],n)}catch(r){throw new $(k.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let i;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(i)}catch(n){throw new $(k.LOCAL_AEC_ERROR,n.toString()).print()}if(!i)throw new $(k.LOCAL_AEC_ERROR,"no dest node when local aec").print();let r=i.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let t=this.element,i=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){y.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var wU,ry;D(Jg,"count",0);let DG=window.AudioContext||window.webkitAudioContext,PG=new(wU=qe({report:Fe}),Be((ry=class{constructor(){D(this,"units",[]),D(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return y.debug("the system does not need to process local aec"),-1;this.context||(this.context=new DG);let t=this.units.find(i=>i&&i.getElement()===e);return t||(t=new Jg(e,this.context),this.units.push(t)),t.startEchoCancellation(),y.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Ct().name!==Pt.SAFARI}}).prototype,"processExternalMediaAEC",[wU],Object.getOwnPropertyDescriptor(ry.prototype,"processExternalMediaAEC"),ry.prototype),ry);function IU(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function OU(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?IU(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):IU(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let yI=window||document;function NU(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!yI)return;let i=zi._cspEventHandlerPointer;if(i&&t)return void console.error(i,t);let r=n=>{if(!(n&&n.blockedURI&&(zi.onSecurityPolicyViolation||zi.getListeners(ac.SECURITY_POLICY_VIOLATION).length>0)))return;let s=n.blockedURI;U("CSP_DETECTED_HOSTNAME_LIST").some(c=>ve(s).call(s,c))&&(zi.onSecurityPolicyViolation&&typeof zi.onSecurityPolicyViolation=="function"&&zi.onSecurityPolicyViolation(n),zi.getListeners(ac.SECURITY_POLICY_VIOLATION).length>0&&zi.safeEmit(ac.SECURITY_POLICY_VIOLATION,n))};i&&yI.removeEventListener("securitypolicyviolation",i),(t||e&&typeof e=="function"||zi.getListeners(ac.SECURITY_POLICY_VIOLATION).length>0)&&yI.addEventListener("securitypolicyviolation",r),zi._cspEventHandlerPointer=r}var LG=se,kG=hP,DU=RegExp.prototype,MG=function(e){return e===DU||LG(DU,e)?kG(e):e.flags},tn=b(MG);function wm(e){let t=e.length;for(;--t>=0;)e[t]=0}let CI=256,PU=286,Zg=30,Qg=15,bI=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ny=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),xG=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),LU=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),pl=new Array(576);wm(pl);let $g=new Array(60);wm($g);let eS=new Array(512);wm(eS);let tS=new Array(256);wm(tS);let AI=new Array(29);wm(AI);let ay=new Array(Zg);function wI(e,t,i,r,n){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=r,this.max_length=n,this.has_stree=e&&e.length}let kU,MU,xU;function II(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}wm(ay);let UU=e=>e<256?eS[e]:eS[256+(e>>>7)],iS=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Ca=(e,t,i)=>{e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,iS(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},cc=(e,t,i)=>{Ca(e,i[2*t],i[2*t+1])},VU=(e,t)=>{let i=0;do i|=1&e,e>>>=1,i<<=1;while(--t>0);return i>>>1},BU=(e,t,i)=>{let r=new Array(16),n,s,c=0;for(n=1;n<=Qg;n++)c=c+i[n-1]<<1,r[n]=c;for(s=0;s<=t;s++){let l=e[2*s+1];l!==0&&(e[2*s]=VU(r[l]++,l))}},jU=e=>{let t;for(t=0;t<PU;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Zg;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},FU=e=>{e.bi_valid>8?iS(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},GU=(e,t,i,r)=>{let n=2*t,s=2*i;return e[n]<e[s]||e[n]===e[s]&&r[t]<=r[i]},OI=(e,t,i)=>{let r=e.heap[i],n=i<<1;for(;n<=e.heap_len&&(n<e.heap_len&&GU(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!GU(t,r,e.heap[n],e.depth));)e.heap[i]=e.heap[n],i=n,n<<=1;e.heap[i]=r},HU=(e,t,i)=>{let r,n,s,c,l=0;if(e.sym_next!==0)do r=255&e.pending_buf[e.sym_buf+l++],r+=(255&e.pending_buf[e.sym_buf+l++])<<8,n=e.pending_buf[e.sym_buf+l++],r===0?cc(e,n,t):(s=tS[n],cc(e,s+CI+1,t),c=bI[s],c!==0&&(n-=AI[s],Ca(e,n,c)),r--,s=UU(r),cc(e,s,i),c=ny[s],c!==0&&(r-=ay[s],Ca(e,r,c)));while(l<e.sym_next);cc(e,256,t)},NI=(e,t)=>{let i=t.dyn_tree,r=t.stat_desc.static_tree,n=t.stat_desc.has_stree,s=t.stat_desc.elems,c,l,d,h=-1;for(e.heap_len=0,e.heap_max=573,c=0;c<s;c++)i[2*c]!==0?(e.heap[++e.heap_len]=h=c,e.depth[c]=0):i[2*c+1]=0;for(;e.heap_len<2;)d=e.heap[++e.heap_len]=h<2?++h:0,i[2*d]=1,e.depth[d]=0,e.opt_len--,n&&(e.static_len-=r[2*d+1]);for(t.max_code=h,c=e.heap_len>>1;c>=1;c--)OI(e,i,c);d=s;do c=e.heap[1],e.heap[1]=e.heap[e.heap_len--],OI(e,i,1),l=e.heap[1],e.heap[--e.heap_max]=c,e.heap[--e.heap_max]=l,i[2*d]=i[2*c]+i[2*l],e.depth[d]=(e.depth[c]>=e.depth[l]?e.depth[c]:e.depth[l])+1,i[2*c+1]=i[2*l+1]=d,e.heap[1]=d++,OI(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((p,_)=>{let E=_.dyn_tree,R=_.max_code,N=_.stat_desc.static_tree,w=_.stat_desc.has_stree,O=_.stat_desc.extra_bits,L=_.stat_desc.extra_base,M=_.stat_desc.max_length,B,Y,H,G,Q,ce,he=0;for(G=0;G<=Qg;G++)p.bl_count[G]=0;for(E[2*p.heap[p.heap_max]+1]=0,B=p.heap_max+1;B<573;B++)Y=p.heap[B],G=E[2*E[2*Y+1]+1]+1,G>M&&(G=M,he++),E[2*Y+1]=G,Y>R||(p.bl_count[G]++,Q=0,Y>=L&&(Q=O[Y-L]),ce=E[2*Y],p.opt_len+=ce*(G+Q),w&&(p.static_len+=ce*(N[2*Y+1]+Q)));if(he!==0){do{for(G=M-1;p.bl_count[G]===0;)G--;p.bl_count[G]--,p.bl_count[G+1]+=2,p.bl_count[M]--,he-=2}while(he>0);for(G=M;G!==0;G--)for(Y=p.bl_count[G];Y!==0;)H=p.heap[--B],H>R||(E[2*H+1]!==G&&(p.opt_len+=(G-E[2*H+1])*E[2*H],E[2*H+1]=G),Y--)}})(e,t),BU(i,h,e.bl_count)},WU=(e,t,i)=>{let r,n,s=-1,c=t[1],l=0,d=7,h=4;for(c===0&&(d=138,h=3),t[2*(i+1)+1]=65535,r=0;r<=i;r++)n=c,c=t[2*(r+1)+1],++l<d&&n===c||(l<h?e.bl_tree[2*n]+=l:n!==0?(n!==s&&e.bl_tree[2*n]++,e.bl_tree[32]++):l<=10?e.bl_tree[34]++:e.bl_tree[36]++,l=0,s=n,c===0?(d=138,h=3):n===c?(d=6,h=3):(d=7,h=4))},zU=(e,t,i)=>{let r,n,s=-1,c=t[1],l=0,d=7,h=4;for(c===0&&(d=138,h=3),r=0;r<=i;r++)if(n=c,c=t[2*(r+1)+1],!(++l<d&&n===c)){if(l<h)do cc(e,n,e.bl_tree);while(--l!=0);else n!==0?(n!==s&&(cc(e,n,e.bl_tree),l--),cc(e,16,e.bl_tree),Ca(e,l-3,2)):l<=10?(cc(e,17,e.bl_tree),Ca(e,l-3,3)):(cc(e,18,e.bl_tree),Ca(e,l-11,7));l=0,s=n,c===0?(d=138,h=3):n===c?(d=6,h=3):(d=7,h=4)}},KU=!1,YU=(e,t,i,r)=>{Ca(e,0+(r?1:0),3),FU(e),iS(e,i),iS(e,~i),i&&e.pending_buf.set(e.window.subarray(t,t+i),e.pending),e.pending+=i};var UG=e=>{KU||((()=>{let t,i,r,n,s,c=new Array(16);for(r=0,n=0;n<28;n++)for(AI[n]=r,t=0;t<1<<bI[n];t++)tS[r++]=n;for(tS[r-1]=n,s=0,n=0;n<16;n++)for(ay[n]=s,t=0;t<1<<ny[n];t++)eS[s++]=n;for(s>>=7;n<Zg;n++)for(ay[n]=s<<7,t=0;t<1<<ny[n]-7;t++)eS[256+s++]=n;for(i=0;i<=Qg;i++)c[i]=0;for(t=0;t<=143;)pl[2*t+1]=8,t++,c[8]++;for(;t<=255;)pl[2*t+1]=9,t++,c[9]++;for(;t<=279;)pl[2*t+1]=7,t++,c[7]++;for(;t<=287;)pl[2*t+1]=8,t++,c[8]++;for(BU(pl,287,c),t=0;t<Zg;t++)$g[2*t+1]=5,$g[2*t]=VU(t,5);kU=new wI(pl,bI,257,PU,Qg),MU=new wI($g,ny,0,Zg,Qg),xU=new wI(new Array(0),xG,0,19,7)})(),KU=!0),e.l_desc=new II(e.dyn_ltree,kU),e.d_desc=new II(e.dyn_dtree,MU),e.bl_desc=new II(e.bl_tree,xU),e.bi_buf=0,e.bi_valid=0,jU(e)},VG=(e,t,i,r)=>{let n,s,c=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(l=>{let d,h=4093624447;for(d=0;d<=31;d++,h>>>=1)if(1&h&&l.dyn_ltree[2*d]!==0)return 0;if(l.dyn_ltree[18]!==0||l.dyn_ltree[20]!==0||l.dyn_ltree[26]!==0)return 1;for(d=32;d<CI;d++)if(l.dyn_ltree[2*d]!==0)return 1;return 0})(e)),NI(e,e.l_desc),NI(e,e.d_desc),c=(l=>{let d;for(WU(l,l.dyn_ltree,l.l_desc.max_code),WU(l,l.dyn_dtree,l.d_desc.max_code),NI(l,l.bl_desc),d=18;d>=3&&l.bl_tree[2*LU[d]+1]===0;d--);return l.opt_len+=3*(d+1)+5+5+4,d})(e),n=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=n&&(n=s)):n=s=i+5,i+4<=n&&t!==-1?YU(e,t,i,r):e.strategy===4||s===n?(Ca(e,2+(r?1:0),3),HU(e,pl,$g)):(Ca(e,4+(r?1:0),3),((l,d,h,p)=>{let _;for(Ca(l,d-257,5),Ca(l,h-1,5),Ca(l,p-4,4),_=0;_<p;_++)Ca(l,l.bl_tree[2*LU[_]+1],3);zU(l,l.dyn_ltree,d-1),zU(l,l.dyn_dtree,h-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,c+1),HU(e,e.dyn_ltree,e.dyn_dtree)),jU(e),r&&FU(e)},BG=(e,t,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,t===0?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(tS[i]+CI+1)]++,e.dyn_dtree[2*UU(t)]++),e.sym_next===e.sym_end),jG=e=>{Ca(e,2,3),cc(e,256,pl),(t=>{t.bi_valid===16?(iS(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},FG={_tr_init:UG,_tr_stored_block:YU,_tr_flush_block:VG,_tr_tally:BG,_tr_align:jG},rS=(e,t,i,r)=>{let n=65535&e|0,s=e>>>16&65535|0,c=0;for(;i!==0;){c=i>2e3?2e3:i,i-=c;do n=n+t[r++]|0,s=s+n|0;while(--c);n%=65521,s%=65521}return n|s<<16|0};let GG=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})());var hn=(e,t,i,r)=>{let n=GG,s=r+i;e^=-1;for(let c=r;c<s;c++)e=e>>>8^n[255&(e^t[c])];return-1^e},xh={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},sy={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};let{_tr_init:HG,_tr_stored_block:DI,_tr_flush_block:WG,_tr_tally:Kd,_tr_align:zG}=FG,{Z_NO_FLUSH:Yd,Z_PARTIAL_FLUSH:KG,Z_FULL_FLUSH:YG,Z_FINISH:Is,Z_BLOCK:qU,Z_OK:Cn,Z_STREAM_END:XU,Z_STREAM_ERROR:lc,Z_DATA_ERROR:qG,Z_BUF_ERROR:PI,Z_DEFAULT_COMPRESSION:XG,Z_FILTERED:JG,Z_HUFFMAN_ONLY:oy,Z_RLE:ZG,Z_FIXED:QG,Z_DEFAULT_STRATEGY:$G,Z_UNKNOWN:eH,Z_DEFLATED:cy}=sy,LI=286,tH=30,iH=19,rH=2*LI+1,nH=15,Uh=258,dc=262,Im=42,Vh=113,nS=666,Bh=(e,t)=>(e.msg=xh[t],t),JU=e=>2*e-(e>4?9:0),qd=e=>{let t=e.length;for(;--t>=0;)e[t]=0},aH=e=>{let t,i,r,n=e.w_size;t=e.hash_size,r=t;do i=e.head[--r],e.head[r]=i>=n?i-n:0;while(--t);t=n,r=t;do i=e.prev[--r],e.prev[r]=i>=n?i-n:0;while(--t)},Xd=(e,t,i)=>(t<<e.hash_shift^i)&e.hash_mask,Ya=e=>{let t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,t.pending===0&&(t.pending_out=0))},qa=(e,t)=>{WG(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Ya(e.strm)},Ni=(e,t)=>{e.pending_buf[e.pending++]=t},aS=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},kI=(e,t,i,r)=>{let n=e.avail_in;return n>r&&(n=r),n===0?0:(e.avail_in-=n,t.set(e.input.subarray(e.next_in,e.next_in+n),i),e.state.wrap===1?e.adler=rS(e.adler,t,n,i):e.state.wrap===2&&(e.adler=hn(e.adler,t,n,i)),e.next_in+=n,e.total_in+=n,n)},ZU=(e,t)=>{let i,r,n=e.max_chain_length,s=e.strstart,c=e.prev_length,l=e.nice_match,d=e.strstart>e.w_size-dc?e.strstart-(e.w_size-dc):0,h=e.window,p=e.w_mask,_=e.prev,E=e.strstart+Uh,R=h[s+c-1],N=h[s+c];e.prev_length>=e.good_match&&(n>>=2),l>e.lookahead&&(l=e.lookahead);do if(i=t,h[i+c]===N&&h[i+c-1]===R&&h[i]===h[s]&&h[++i]===h[s+1]){s+=2,i++;do;while(h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&s<E);if(r=Uh-(E-s),s=E-Uh,r>c){if(e.match_start=t,c=r,r>=l)break;R=h[s+c-1],N=h[s+c]}}while((t=_[t&p])>d&&--n!=0);return c<=e.lookahead?c:e.lookahead},Om=e=>{let t=e.w_size,i,r,n;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-dc)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),aH(e),r+=t),e.strm.avail_in===0)break;if(i=kI(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=i,e.lookahead+e.insert>=3)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=Xd(e,e.ins_h,e.window[n+1]);e.insert&&(e.ins_h=Xd(e,e.ins_h,e.window[n+3-1]),e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<dc&&e.strm.avail_in!==0)},QU=(e,t)=>{let i,r,n,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,c=0,l=e.strm.avail_in;do{if(i=65535,n=e.bi_valid+42>>3,e.strm.avail_out<n||(n=e.strm.avail_out-n,r=e.strstart-e.block_start,i>r+e.strm.avail_in&&(i=r+e.strm.avail_in),i>n&&(i=n),i<s&&(i===0&&t!==Is||t===Yd||i!==r+e.strm.avail_in)))break;c=t===Is&&i===r+e.strm.avail_in?1:0,DI(e,0,0,c),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,Ya(e.strm),r&&(r>i&&(r=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,i-=r),i&&(kI(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(c===0);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),c?4:t!==Yd&&t!==Is&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(n=e.window_size-e.strstart,e.strm.avail_in>n&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,n+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),n>e.strm.avail_in&&(n=e.strm.avail_in),n&&(kI(e.strm,e.window,e.strstart,n),e.strstart+=n,e.insert+=n>e.w_size-e.insert?e.w_size-e.insert:n),e.high_water<e.strstart&&(e.high_water=e.strstart),n=e.bi_valid+42>>3,n=e.pending_buf_size-n>65535?65535:e.pending_buf_size-n,s=n>e.w_size?e.w_size:n,r=e.strstart-e.block_start,(r>=s||(r||t===Is)&&t!==Yd&&e.strm.avail_in===0&&r<=n)&&(i=r>n?n:r,c=t===Is&&e.strm.avail_in===0&&i===r?1:0,DI(e,e.block_start,i,c),e.block_start+=i,Ya(e.strm)),c?3:1)},MI=(e,t)=>{let i,r;for(;;){if(e.lookahead<dc){if(Om(e),e.lookahead<dc&&t===Yd)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=Xd(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-dc&&(e.match_length=ZU(e,i)),e.match_length>=3)if(r=Kd(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Xd(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Xd(e,e.ins_h,e.window[e.strstart+1]);else r=Kd(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(qa(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Is?(qa(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(qa(e,!1),e.strm.avail_out===0)?1:2},Nm=(e,t)=>{let i,r,n;for(;;){if(e.lookahead<dc){if(Om(e),e.lookahead<dc&&t===Yd)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=Xd(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-dc&&(e.match_length=ZU(e,i),e.match_length<=5&&(e.strategy===JG||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-3,r=Kd(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=n&&(e.ins_h=Xd(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(qa(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(r=Kd(e,0,e.window[e.strstart-1]),r&&qa(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=Kd(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Is?(qa(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(qa(e,!1),e.strm.avail_out===0)?1:2};function uc(e,t,i,r,n){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=r,this.func=n}let sS=[new uc(0,0,0,0,QU),new uc(4,4,8,4,MI),new uc(4,5,16,8,MI),new uc(4,6,32,32,MI),new uc(4,4,16,16,Nm),new uc(8,16,32,32,Nm),new uc(8,16,128,128,Nm),new uc(8,32,128,256,Nm),new uc(32,128,258,1024,Nm),new uc(32,258,258,4096,Nm)];function sH(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=cy,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*rH),this.dyn_dtree=new Uint16Array(2*(2*tH+1)),this.bl_tree=new Uint16Array(2*(2*iH+1)),qd(this.dyn_ltree),qd(this.dyn_dtree),qd(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(nH+1),this.heap=new Uint16Array(2*LI+1),qd(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*LI+1),qd(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}let oS=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.status!==Im&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Vh&&t.status!==nS?1:0},$U=e=>{if(oS(e))return Bh(e,lc);e.total_in=e.total_out=0,e.data_type=eH;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Im:Vh,e.adler=t.wrap===2?0:1,t.last_flush=-2,HG(t),Cn},eV=e=>{let t=$U(e);return t===Cn&&(i=>{i.window_size=2*i.w_size,qd(i.head),i.max_lazy_match=sS[i.level].max_lazy,i.good_match=sS[i.level].good_length,i.nice_match=sS[i.level].nice_length,i.max_chain_length=sS[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(e.state),t},tV=(e,t,i,r,n,s)=>{if(!e)return lc;let c=1;if(t===XG&&(t=6),r<0?(c=0,r=-r):r>15&&(c=2,r-=16),n<1||n>9||i!==cy||r<8||r>15||t<0||t>9||s<0||s>QG||r===8&&c!==1)return Bh(e,lc);r===8&&(r=9);let l=new sH;return e.state=l,l.strm=e,l.status=Im,l.wrap=c,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=n+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<n+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=t,l.strategy=s,l.method=i,eV(e)};var oH=(e,t)=>{if(oS(e)||t>qU||t<0)return e?Bh(e,lc):lc;let i=e.state;if(!e.output||e.avail_in!==0&&!e.input||i.status===nS&&t!==Is)return Bh(e,e.avail_out===0?PI:lc);let r=i.last_flush;if(i.last_flush=t,i.pending!==0){if(Ya(e),e.avail_out===0)return i.last_flush=-1,Cn}else if(e.avail_in===0&&JU(t)<=JU(r)&&t!==Is)return Bh(e,PI);if(i.status===nS&&e.avail_in!==0)return Bh(e,PI);if(i.status===Im&&i.wrap===0&&(i.status=Vh),i.status===Im){let n=cy+(i.w_bits-8<<4)<<8,s=-1;if(s=i.strategy>=oy||i.level<2?0:i.level<6?1:i.level===6?2:3,n|=s<<6,i.strstart!==0&&(n|=32),n+=31-n%31,aS(i,n),i.strstart!==0&&(aS(i,e.adler>>>16),aS(i,65535&e.adler)),e.adler=1,i.status=Vh,Ya(e),i.pending!==0)return i.last_flush=-1,Cn}if(i.status===57){if(e.adler=0,Ni(i,31),Ni(i,139),Ni(i,8),i.gzhead)Ni(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Ni(i,255&i.gzhead.time),Ni(i,i.gzhead.time>>8&255),Ni(i,i.gzhead.time>>16&255),Ni(i,i.gzhead.time>>24&255),Ni(i,i.level===9?2:i.strategy>=oy||i.level<2?4:0),Ni(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Ni(i,255&i.gzhead.extra.length),Ni(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=hn(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Ni(i,0),Ni(i,0),Ni(i,0),Ni(i,0),Ni(i,0),Ni(i,i.level===9?2:i.strategy>=oy||i.level<2?4:0),Ni(i,3),i.status=Vh,Ya(e),i.pending!==0)return i.last_flush=-1,Cn}if(i.status===69){if(i.gzhead.extra){let n=i.pending,s=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+s>i.pending_buf_size;){let l=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+l),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>n&&(e.adler=hn(e.adler,i.pending_buf,i.pending-n,n)),i.gzindex+=l,Ya(e),i.pending!==0)return i.last_flush=-1,Cn;n=0,s-=l}let c=new Uint8Array(i.gzhead.extra);i.pending_buf.set(c.subarray(i.gzindex,i.gzindex+s),i.pending),i.pending+=s,i.gzhead.hcrc&&i.pending>n&&(e.adler=hn(e.adler,i.pending_buf,i.pending-n,n)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let n,s=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>s&&(e.adler=hn(e.adler,i.pending_buf,i.pending-s,s)),Ya(e),i.pending!==0)return i.last_flush=-1,Cn;s=0}n=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Ni(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>s&&(e.adler=hn(e.adler,i.pending_buf,i.pending-s,s)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let n,s=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>s&&(e.adler=hn(e.adler,i.pending_buf,i.pending-s,s)),Ya(e),i.pending!==0)return i.last_flush=-1,Cn;s=0}n=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Ni(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>s&&(e.adler=hn(e.adler,i.pending_buf,i.pending-s,s))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(Ya(e),i.pending!==0))return i.last_flush=-1,Cn;Ni(i,255&e.adler),Ni(i,e.adler>>8&255),e.adler=0}if(i.status=Vh,Ya(e),i.pending!==0)return i.last_flush=-1,Cn}if(e.avail_in!==0||i.lookahead!==0||t!==Yd&&i.status!==nS){let n=i.level===0?QU(i,t):i.strategy===oy?((s,c)=>{let l;for(;;){if(s.lookahead===0&&(Om(s),s.lookahead===0)){if(c===Yd)return 1;break}if(s.match_length=0,l=Kd(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,l&&(qa(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,c===Is?(qa(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(qa(s,!1),s.strm.avail_out===0)?1:2})(i,t):i.strategy===ZG?((s,c)=>{let l,d,h,p,_=s.window;for(;;){if(s.lookahead<=Uh){if(Om(s),s.lookahead<=Uh&&c===Yd)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(h=s.strstart-1,d=_[h],d===_[++h]&&d===_[++h]&&d===_[++h])){p=s.strstart+Uh;do;while(d===_[++h]&&d===_[++h]&&d===_[++h]&&d===_[++h]&&d===_[++h]&&d===_[++h]&&d===_[++h]&&d===_[++h]&&h<p);s.match_length=Uh-(p-h),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(l=Kd(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(l=Kd(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),l&&(qa(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,c===Is?(qa(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(qa(s,!1),s.strm.avail_out===0)?1:2})(i,t):sS[i.level].func(i,t);if(n!==3&&n!==4||(i.status=nS),n===1||n===3)return e.avail_out===0&&(i.last_flush=-1),Cn;if(n===2&&(t===KG?zG(i):t!==qU&&(DI(i,0,0,!1),t===YG&&(qd(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),Ya(e),e.avail_out===0))return i.last_flush=-1,Cn}return t!==Is?Cn:i.wrap<=0?XU:(i.wrap===2?(Ni(i,255&e.adler),Ni(i,e.adler>>8&255),Ni(i,e.adler>>16&255),Ni(i,e.adler>>24&255),Ni(i,255&e.total_in),Ni(i,e.total_in>>8&255),Ni(i,e.total_in>>16&255),Ni(i,e.total_in>>24&255)):(aS(i,e.adler>>>16),aS(i,65535&e.adler)),Ya(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Cn:XU)},cH=(e,t)=>{let i=t.length;if(oS(e))return lc;let r=e.state,n=r.wrap;if(n===2||n===1&&r.status!==Im||r.lookahead)return lc;if(n===1&&(e.adler=rS(e.adler,t,i,0)),r.wrap=0,i>=r.w_size){n===0&&(qd(r.head),r.strstart=0,r.block_start=0,r.insert=0);let d=new Uint8Array(r.w_size);d.set(t.subarray(i-r.w_size,i),0),t=d,i=r.w_size}let s=e.avail_in,c=e.next_in,l=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,Om(r);r.lookahead>=3;){let d=r.strstart,h=r.lookahead-2;do r.ins_h=Xd(r,r.ins_h,r.window[d+3-1]),r.prev[d&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=d,d++;while(--h);r.strstart=d,r.lookahead=2,Om(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=c,e.input=l,e.avail_in=s,r.wrap=n,Cn},cS={deflateInit:(e,t)=>tV(e,t,cy,15,8,$G),deflateInit2:tV,deflateReset:eV,deflateResetKeep:$U,deflateSetHeader:(e,t)=>oS(e)||e.state.wrap!==2?lc:(e.state.gzhead=t,Cn),deflate:oH,deflateEnd:e=>{if(oS(e))return lc;let t=e.state.status;return e.state=null,t===Vh?Bh(e,qG):Cn},deflateSetDictionary:cH,deflateInfo:"pako deflate (from Nodeca project)"};let lH=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var ly={assign:function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let i=t.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(let r in i)lH(i,r)&&(e[r]=i[r])}}return e},flattenChunks:e=>{let t=0;for(let r=0,n=e.length;r<n;r++)t+=e[r].length;let i=new Uint8Array(t);for(let r=0,n=0,s=e.length;r<s;r++){let c=e[r];i.set(c,n),n+=c.length}return i}};let iV=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{iV=!1}let lS=new Uint8Array(256);for(let e=0;e<256;e++)lS[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;lS[254]=lS[254]=1;var dS={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,i,r,n,s,c=e.length,l=0;for(n=0;n<c;n++)i=e.charCodeAt(n),(64512&i)==55296&&n+1<c&&(r=e.charCodeAt(n+1),(64512&r)==56320&&(i=65536+(i-55296<<10)+(r-56320),n++)),l+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(l),s=0,n=0;s<l;n++)i=e.charCodeAt(n),(64512&i)==55296&&n+1<c&&(r=e.charCodeAt(n+1),(64512&r)==56320&&(i=65536+(i-55296<<10)+(r-56320),n++)),i<128?t[s++]=i:i<2048?(t[s++]=192|i>>>6,t[s++]=128|63&i):i<65536?(t[s++]=224|i>>>12,t[s++]=128|i>>>6&63,t[s++]=128|63&i):(t[s++]=240|i>>>18,t[s++]=128|i>>>12&63,t[s++]=128|i>>>6&63,t[s++]=128|63&i);return t},buf2string:(e,t)=>{let i=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,n,s=new Array(2*i);for(n=0,r=0;r<i;){let c=e[r++];if(c<128){s[n++]=c;continue}let l=lS[c];if(l>4)s[n++]=65533,r+=l-1;else{for(c&=l===2?31:l===3?15:7;l>1&&r<i;)c=c<<6|63&e[r++],l--;l>1?s[n++]=65533:c<65536?s[n++]=c:(c-=65536,s[n++]=55296|c>>10&1023,s[n++]=56320|1023&c)}}return((c,l)=>{if(l<65534&&c.subarray&&iV)return String.fromCharCode.apply(null,c.length===l?c:c.subarray(0,l));let d="";for(let h=0;h<l;h++)d+=String.fromCharCode(c[h]);return d})(s,n)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let i=t-1;for(;i>=0&&(192&e[i])==128;)i--;return i<0||i===0?t:i+lS[e[i]]>t?i:t}},rV=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};let nV=Object.prototype.toString,{Z_NO_FLUSH:dH,Z_SYNC_FLUSH:uH,Z_FULL_FLUSH:hH,Z_FINISH:pH,Z_OK:dy,Z_STREAM_END:fH,Z_DEFAULT_COMPRESSION:mH,Z_DEFAULT_STRATEGY:_H,Z_DEFLATED:EH}=sy;function uy(e){this.options=ly.assign({level:mH,method:EH,chunkSize:16384,windowBits:15,memLevel:8,strategy:_H},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new rV,this.strm.avail_out=0;let i=cS.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==dy)throw new Error(xh[i]);if(t.header&&cS.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?dS.string2buf(t.dictionary):nV.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,i=cS.deflateSetDictionary(this.strm,r),i!==dy)throw new Error(xh[i]);this._dict_set=!0}}function gH(e,t){let i=new uy(t);if(i.push(e,!0),i.err)throw i.msg||xh[i.err];return i.result}uy.prototype.push=function(e,t){let i=this.strm,r=this.options.chunkSize,n,s;if(this.ended)return!1;for(s=t===~~t?t:t===!0?pH:dH,typeof e=="string"?i.input=dS.string2buf(e):nV.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(r),i.next_out=0,i.avail_out=r),(s===uH||s===hH)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(n=cS.deflate(i,s),n===fH)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),n=cS.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===dy;if(i.avail_out!==0){if(s>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},uy.prototype.onData=function(e){this.chunks.push(e)},uy.prototype.onEnd=function(e){e===dy&&(this.result=ly.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var SH={deflate:gH};let hy=16209;var TH=function(e,t){let i,r,n,s,c,l,d,h,p,_,E,R,N,w,O,L,M,B,Y,H,G,Q,ce,he,Se=e.state;i=e.next_in,ce=e.input,r=i+(e.avail_in-5),n=e.next_out,he=e.output,s=n-(t-e.avail_out),c=n+(e.avail_out-257),l=Se.dmax,d=Se.wsize,h=Se.whave,p=Se.wnext,_=Se.window,E=Se.hold,R=Se.bits,N=Se.lencode,w=Se.distcode,O=(1<<Se.lenbits)-1,L=(1<<Se.distbits)-1;e:do{R<15&&(E+=ce[i++]<<R,R+=8,E+=ce[i++]<<R,R+=8),M=N[E&O];t:for(;;){if(B=M>>>24,E>>>=B,R-=B,B=M>>>16&255,B===0)he[n++]=65535&M;else{if(!(16&B)){if(!(64&B)){M=N[(65535&M)+(E&(1<<B)-1)];continue t}if(32&B){Se.mode=16191;break e}e.msg="invalid literal/length code",Se.mode=hy;break e}Y=65535&M,B&=15,B&&(R<B&&(E+=ce[i++]<<R,R+=8),Y+=E&(1<<B)-1,E>>>=B,R-=B),R<15&&(E+=ce[i++]<<R,R+=8,E+=ce[i++]<<R,R+=8),M=w[E&L];i:for(;;){if(B=M>>>24,E>>>=B,R-=B,B=M>>>16&255,!(16&B)){if(!(64&B)){M=w[(65535&M)+(E&(1<<B)-1)];continue i}e.msg="invalid distance code",Se.mode=hy;break e}if(H=65535&M,B&=15,R<B&&(E+=ce[i++]<<R,R+=8,R<B&&(E+=ce[i++]<<R,R+=8)),H+=E&(1<<B)-1,H>l){e.msg="invalid distance too far back",Se.mode=hy;break e}if(E>>>=B,R-=B,B=n-s,H>B){if(B=H-B,B>h&&Se.sane){e.msg="invalid distance too far back",Se.mode=hy;break e}if(G=0,Q=_,p===0){if(G+=d-B,B<Y){Y-=B;do he[n++]=_[G++];while(--B);G=n-H,Q=he}}else if(p<B){if(G+=d+p-B,B-=p,B<Y){Y-=B;do he[n++]=_[G++];while(--B);if(G=0,p<Y){B=p,Y-=B;do he[n++]=_[G++];while(--B);G=n-H,Q=he}}}else if(G+=p-B,B<Y){Y-=B;do he[n++]=_[G++];while(--B);G=n-H,Q=he}for(;Y>2;)he[n++]=Q[G++],he[n++]=Q[G++],he[n++]=Q[G++],Y-=3;Y&&(he[n++]=Q[G++],Y>1&&(he[n++]=Q[G++]))}else{G=n-H;do he[n++]=he[G++],he[n++]=he[G++],he[n++]=he[G++],Y-=3;while(Y>2);Y&&(he[n++]=he[G++],Y>1&&(he[n++]=he[G++]))}break}}break}}while(i<r&&n<c);Y=R>>3,i-=Y,R-=Y<<3,E&=(1<<R)-1,e.next_in=i,e.next_out=n,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=n<c?c-n+257:257-(n-c),Se.hold=E,Se.bits=R};let py=15,vH=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),RH=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),yH=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),CH=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var uS=(e,t,i,r,n,s,c,l)=>{let d=l.bits,h,p,_,E,R,N,w=0,O=0,L=0,M=0,B=0,Y=0,H=0,G=0,Q=0,ce=0,he=null,Se=new Uint16Array(16),ht=new Uint16Array(16),pt,tt,xt,Lt=null;for(w=0;w<=py;w++)Se[w]=0;for(O=0;O<r;O++)Se[t[i+O]]++;for(B=d,M=py;M>=1&&Se[M]===0;M--);if(B>M&&(B=M),M===0)return n[s++]=20971520,n[s++]=20971520,l.bits=1,0;for(L=1;L<M&&Se[L]===0;L++);for(B<L&&(B=L),G=1,w=1;w<=py;w++)if(G<<=1,G-=Se[w],G<0)return-1;if(G>0&&(e===0||M!==1))return-1;for(ht[1]=0,w=1;w<py;w++)ht[w+1]=ht[w]+Se[w];for(O=0;O<r;O++)t[i+O]!==0&&(c[ht[t[i+O]]++]=O);if(e===0?(he=Lt=c,N=20):e===1?(he=vH,Lt=RH,N=257):(he=yH,Lt=CH,N=0),ce=0,O=0,w=L,R=s,Y=B,H=0,_=-1,Q=1<<B,E=Q-1,e===1&&Q>852||e===2&&Q>592)return 1;for(;;){pt=w-H,c[O]+1<N?(tt=0,xt=c[O]):c[O]>=N?(tt=Lt[c[O]-N],xt=he[c[O]-N]):(tt=96,xt=0),h=1<<w-H,p=1<<Y,L=p;do p-=h,n[R+(ce>>H)+p]=pt<<24|tt<<16|xt|0;while(p!==0);for(h=1<<w-1;ce&h;)h>>=1;if(h!==0?(ce&=h-1,ce+=h):ce=0,O++,--Se[w]==0){if(w===M)break;w=t[i+c[O]]}if(w>B&&(ce&E)!==_){for(H===0&&(H=B),R+=L,Y=w-H,G=1<<Y;Y+H<M&&(G-=Se[Y+H],!(G<=0));)Y++,G<<=1;if(Q+=1<<Y,e===1&&Q>852||e===2&&Q>592)return 1;_=ce&E,n[_]=B<<24|Y<<16|R-s|0}}return ce!==0&&(n[R+ce]=w-H<<24|64<<16|0),l.bits=B,0};let{Z_FINISH:aV,Z_BLOCK:bH,Z_TREES:fy,Z_OK:jh,Z_STREAM_END:AH,Z_NEED_DICT:wH,Z_STREAM_ERROR:Os,Z_DATA_ERROR:sV,Z_MEM_ERROR:oV,Z_BUF_ERROR:IH,Z_DEFLATED:cV}=sy,my=16180,_y=16190,fl=16191,xI=16192,UI=16194,Ey=16199,gy=16200,VI=16206,lr=16209,lV=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function OH(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}let Fh=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<my||t.mode>16211?1:0},dV=e=>{if(Fh(e))return Os;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=my,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,jh},uV=e=>{if(Fh(e))return Os;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,dV(e)},hV=(e,t)=>{let i;if(Fh(e))return Os;let r=e.state;return t<0?(i=0,t=-t):(i=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Os:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=i,r.wbits=t,uV(e))},pV=(e,t)=>{if(!e)return Os;let i=new OH;e.state=i,i.strm=e,i.window=null,i.mode=my;let r=hV(e,t);return r!==jh&&(e.state=null),r},BI,jI,fV=!0,NH=e=>{if(fV){BI=new Int32Array(512),jI=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(uS(1,e.lens,0,288,BI,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;uS(2,e.lens,0,32,jI,0,e.work,{bits:5}),fV=!1}e.lencode=BI,e.lenbits=9,e.distcode=jI,e.distbits=5},mV=(e,t,i,r)=>{let n,s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(t.subarray(i-s.wsize,i),0),s.wnext=0,s.whave=s.wsize):(n=s.wsize-s.wnext,n>r&&(n=r),s.window.set(t.subarray(i-r,i-r+n),s.wnext),(r-=n)?(s.window.set(t.subarray(i-r,i),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=n,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=n))),0};var DH=(e,t)=>{let i,r,n,s,c,l,d,h,p,_,E,R,N,w,O,L,M,B,Y,H,G,Q,ce=0,he=new Uint8Array(4),Se,ht,pt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Fh(e)||!e.output||!e.input&&e.avail_in!==0)return Os;i=e.state,i.mode===fl&&(i.mode=xI),c=e.next_out,n=e.output,d=e.avail_out,s=e.next_in,r=e.input,l=e.avail_in,h=i.hold,p=i.bits,_=l,E=d,Q=jh;e:for(;;)switch(i.mode){case my:if(i.wrap===0){i.mode=xI;break}for(;p<16;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}if(2&i.wrap&&h===35615){i.wbits===0&&(i.wbits=15),i.check=0,he[0]=255&h,he[1]=h>>>8&255,i.check=hn(i.check,he,2,0),h=0,p=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",i.mode=lr;break}if((15&h)!==cV){e.msg="unknown compression method",i.mode=lr;break}if(h>>>=4,p-=4,G=8+(15&h),i.wbits===0&&(i.wbits=G),G>15||G>i.wbits){e.msg="invalid window size",i.mode=lr;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&h?16189:fl,h=0,p=0;break;case 16181:for(;p<16;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}if(i.flags=h,(255&tn(i))!==cV){e.msg="unknown compression method",i.mode=lr;break}if(57344&tn(i)){e.msg="unknown header flags set",i.mode=lr;break}i.head&&(i.head.text=h>>8&1),512&tn(i)&&4&i.wrap&&(he[0]=255&h,he[1]=h>>>8&255,i.check=hn(i.check,he,2,0)),h=0,p=0,i.mode=16182;case 16182:for(;p<32;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}i.head&&(i.head.time=h),512&tn(i)&&4&i.wrap&&(he[0]=255&h,he[1]=h>>>8&255,he[2]=h>>>16&255,he[3]=h>>>24&255,i.check=hn(i.check,he,4,0)),h=0,p=0,i.mode=16183;case 16183:for(;p<16;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}i.head&&(i.head.xflags=255&h,i.head.os=h>>8),512&tn(i)&&4&i.wrap&&(he[0]=255&h,he[1]=h>>>8&255,i.check=hn(i.check,he,2,0)),h=0,p=0,i.mode=16184;case 16184:if(1024&tn(i)){for(;p<16;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}i.length=h,i.head&&(i.head.extra_len=h),512&tn(i)&&4&i.wrap&&(he[0]=255&h,he[1]=h>>>8&255,i.check=hn(i.check,he,2,0)),h=0,p=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&tn(i)&&(R=i.length,R>l&&(R=l),R&&(i.head&&(G=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(r.subarray(s,s+R),G)),512&tn(i)&&4&i.wrap&&(i.check=hn(i.check,r,R,s)),l-=R,s+=R,i.length-=R),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&tn(i)){if(l===0)break e;R=0;do G=r[s+R++],i.head&&G&&i.length<65536&&(i.head.name+=String.fromCharCode(G));while(G&&R<l);if(512&tn(i)&&4&i.wrap&&(i.check=hn(i.check,r,R,s)),l-=R,s+=R,G)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&tn(i)){if(l===0)break e;R=0;do G=r[s+R++],i.head&&G&&i.length<65536&&(i.head.comment+=String.fromCharCode(G));while(G&&R<l);if(512&tn(i)&&4&i.wrap&&(i.check=hn(i.check,r,R,s)),l-=R,s+=R,G)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&tn(i)){for(;p<16;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}if(4&i.wrap&&h!==(65535&i.check)){e.msg="header crc mismatch",i.mode=lr;break}h=0,p=0}i.head&&(i.head.hcrc=tn(i)>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=fl;break;case 16189:for(;p<32;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}e.adler=i.check=lV(h),h=0,p=0,i.mode=_y;case _y:if(i.havedict===0)return e.next_out=c,e.avail_out=d,e.next_in=s,e.avail_in=l,i.hold=h,i.bits=p,wH;e.adler=i.check=1,i.mode=fl;case fl:if(t===bH||t===fy)break e;case xI:if(i.last){h>>>=7&p,p-=7&p,i.mode=VI;break}for(;p<3;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}switch(i.last=1&h,h>>>=1,p-=1,3&h){case 0:i.mode=16193;break;case 1:if(NH(i),i.mode=Ey,t===fy){h>>>=2,p-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=lr}h>>>=2,p-=2;break;case 16193:for(h>>>=7&p,p-=7&p;p<32;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",i.mode=lr;break}if(i.length=65535&h,h=0,p=0,i.mode=UI,t===fy)break e;case UI:i.mode=16195;case 16195:if(R=i.length,R){if(R>l&&(R=l),R>d&&(R=d),R===0)break e;n.set(r.subarray(s,s+R),c),l-=R,s+=R,d-=R,c+=R,i.length-=R;break}i.mode=fl;break;case 16196:for(;p<14;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}if(i.nlen=257+(31&h),h>>>=5,p-=5,i.ndist=1+(31&h),h>>>=5,p-=5,i.ncode=4+(15&h),h>>>=4,p-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=lr;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;p<3;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}i.lens[pt[i.have++]]=7&h,h>>>=3,p-=3}for(;i.have<19;)i.lens[pt[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,Se={bits:i.lenbits},Q=uS(0,i.lens,0,19,i.lencode,0,i.work,Se),i.lenbits=Se.bits,Q){e.msg="invalid code lengths set",i.mode=lr;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;ce=i.lencode[h&(1<<i.lenbits)-1],O=ce>>>24,L=ce>>>16&255,M=65535&ce,!(O<=p);){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}if(M<16)h>>>=O,p-=O,i.lens[i.have++]=M;else{if(M===16){for(ht=O+2;p<ht;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}if(h>>>=O,p-=O,i.have===0){e.msg="invalid bit length repeat",i.mode=lr;break}G=i.lens[i.have-1],R=3+(3&h),h>>>=2,p-=2}else if(M===17){for(ht=O+3;p<ht;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}h>>>=O,p-=O,G=0,R=3+(7&h),h>>>=3,p-=3}else{for(ht=O+7;p<ht;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}h>>>=O,p-=O,G=0,R=11+(127&h),h>>>=7,p-=7}if(i.have+R>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=lr;break}for(;R--;)i.lens[i.have++]=G}}if(i.mode===lr)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=lr;break}if(i.lenbits=9,Se={bits:i.lenbits},Q=uS(1,i.lens,0,i.nlen,i.lencode,0,i.work,Se),i.lenbits=Se.bits,Q){e.msg="invalid literal/lengths set",i.mode=lr;break}if(i.distbits=6,i.distcode=i.distdyn,Se={bits:i.distbits},Q=uS(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,Se),i.distbits=Se.bits,Q){e.msg="invalid distances set",i.mode=lr;break}if(i.mode=Ey,t===fy)break e;case Ey:i.mode=gy;case gy:if(l>=6&&d>=258){e.next_out=c,e.avail_out=d,e.next_in=s,e.avail_in=l,i.hold=h,i.bits=p,TH(e,E),c=e.next_out,n=e.output,d=e.avail_out,s=e.next_in,r=e.input,l=e.avail_in,h=i.hold,p=i.bits,i.mode===fl&&(i.back=-1);break}for(i.back=0;ce=i.lencode[h&(1<<i.lenbits)-1],O=ce>>>24,L=ce>>>16&255,M=65535&ce,!(O<=p);){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}if(L&&!(240&L)){for(B=O,Y=L,H=M;ce=i.lencode[H+((h&(1<<B+Y)-1)>>B)],O=ce>>>24,L=ce>>>16&255,M=65535&ce,!(B+O<=p);){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}h>>>=B,p-=B,i.back+=B}if(h>>>=O,p-=O,i.back+=O,i.length=M,L===0){i.mode=16205;break}if(32&L){i.back=-1,i.mode=fl;break}if(64&L){e.msg="invalid literal/length code",i.mode=lr;break}i.extra=15&L,i.mode=16201;case 16201:if(i.extra){for(ht=i.extra;p<ht;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}i.length+=h&(1<<i.extra)-1,h>>>=i.extra,p-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;ce=i.distcode[h&(1<<i.distbits)-1],O=ce>>>24,L=ce>>>16&255,M=65535&ce,!(O<=p);){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}if(!(240&L)){for(B=O,Y=L,H=M;ce=i.distcode[H+((h&(1<<B+Y)-1)>>B)],O=ce>>>24,L=ce>>>16&255,M=65535&ce,!(B+O<=p);){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}h>>>=B,p-=B,i.back+=B}if(h>>>=O,p-=O,i.back+=O,64&L){e.msg="invalid distance code",i.mode=lr;break}i.offset=M,i.extra=15&L,i.mode=16203;case 16203:if(i.extra){for(ht=i.extra;p<ht;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}i.offset+=h&(1<<i.extra)-1,h>>>=i.extra,p-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=lr;break}i.mode=16204;case 16204:if(d===0)break e;if(R=E-d,i.offset>R){if(R=i.offset-R,R>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=lr;break}R>i.wnext?(R-=i.wnext,N=i.wsize-R):N=i.wnext-R,R>i.length&&(R=i.length),w=i.window}else w=n,N=c-i.offset,R=i.length;R>d&&(R=d),d-=R,i.length-=R;do n[c++]=w[N++];while(--R);i.length===0&&(i.mode=gy);break;case 16205:if(d===0)break e;n[c++]=i.length,d--,i.mode=gy;break;case VI:if(i.wrap){for(;p<32;){if(l===0)break e;l--,h|=r[s++]<<p,p+=8}if(E-=d,e.total_out+=E,i.total+=E,4&i.wrap&&E&&(e.adler=i.check=tn(i)?hn(i.check,n,E,c-E):rS(i.check,n,E,c-E)),E=d,4&i.wrap&&(tn(i)?h:lV(h))!==i.check){e.msg="incorrect data check",i.mode=lr;break}h=0,p=0}i.mode=16207;case 16207:if(i.wrap&&tn(i)){for(;p<32;){if(l===0)break e;l--,h+=r[s++]<<p,p+=8}if(4&i.wrap&&h!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=lr;break}h=0,p=0}i.mode=16208;case 16208:Q=AH;break e;case lr:Q=sV;break e;case 16210:return oV;default:return Os}return e.next_out=c,e.avail_out=d,e.next_in=s,e.avail_in=l,i.hold=h,i.bits=p,(i.wsize||E!==e.avail_out&&i.mode<lr&&(i.mode<VI||t!==aV))&&mV(e,e.output,e.next_out,E-e.avail_out),_-=e.avail_in,E-=e.avail_out,e.total_in+=_,e.total_out+=E,i.total+=E,4&i.wrap&&E&&(e.adler=i.check=tn(i)?hn(i.check,n,E,e.next_out-E):rS(i.check,n,E,e.next_out-E)),e.data_type=i.bits+(i.last?64:0)+(i.mode===fl?128:0)+(i.mode===Ey||i.mode===UI?256:0),(_===0&&E===0||t===aV)&&Q===jh&&(Q=IH),Q},ml={inflateReset:uV,inflateReset2:hV,inflateResetKeep:dV,inflateInit:e=>pV(e,15),inflateInit2:pV,inflate:DH,inflateEnd:e=>{if(Fh(e))return Os;let t=e.state;return t.window&&(t.window=null),e.state=null,jh},inflateGetHeader:(e,t)=>{if(Fh(e))return Os;let i=e.state;return 2&i.wrap?(i.head=t,t.done=!1,jh):Os},inflateSetDictionary:(e,t)=>{let i=t.length,r,n,s;return Fh(e)?Os:(r=e.state,r.wrap!==0&&r.mode!==_y?Os:r.mode===_y&&(n=1,n=rS(n,t,i,0),n!==r.check)?sV:(s=mV(e,t,i,i),s?(r.mode=16210,oV):(r.havedict=1,jh)))},inflateInfo:"pako inflate (from Nodeca project)"},PH=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};let _V=Object.prototype.toString,{Z_NO_FLUSH:LH,Z_FINISH:kH,Z_OK:hS,Z_STREAM_END:FI,Z_NEED_DICT:GI,Z_STREAM_ERROR:MH,Z_DATA_ERROR:EV,Z_MEM_ERROR:xH}=sy;function Sy(e){this.options=ly.assign({chunkSize:65536,windowBits:15,to:""},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new rV,this.strm.avail_out=0;let i=ml.inflateInit2(this.strm,t.windowBits);if(i!==hS)throw new Error(xh[i]);if(this.header=new PH,ml.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=dS.string2buf(t.dictionary):_V.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=ml.inflateSetDictionary(this.strm,t.dictionary),i!==hS)))throw new Error(xh[i])}function UH(e,t){let i=new Sy(t);if(i.push(e),i.err)throw i.msg||xh[i.err];return i.result}Sy.prototype.push=function(e,t){let i=this.strm,r=this.options.chunkSize,n=this.options.dictionary,s,c,l;if(this.ended)return!1;for(c=t===~~t?t:t===!0?kH:LH,_V.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(r),i.next_out=0,i.avail_out=r),s=ml.inflate(i,c),s===GI&&n&&(s=ml.inflateSetDictionary(i,n),s===hS?s=ml.inflate(i,c):s===EV&&(s=GI));i.avail_in>0&&s===FI&&i.state.wrap>0&&e[i.next_in]!==0;)ml.inflateReset(i),s=ml.inflate(i,c);switch(s){case MH:case EV:case GI:case xH:return this.onEnd(s),this.ended=!0,!1}if(l=i.avail_out,i.next_out&&(i.avail_out===0||s===FI))if(this.options.to==="string"){let d=dS.utf8border(i.output,i.next_out),h=i.next_out-d,p=dS.buf2string(i.output,d);i.next_out=h,i.avail_out=r-h,h&&i.output.set(i.output.subarray(d,d+h),0),this.onData(p)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(s!==hS||l!==0){if(s===FI)return s=ml.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},Sy.prototype.onData=function(e){this.chunks.push(e)},Sy.prototype.onEnd=function(e){e===hS&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=ly.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var VH={inflate:UH};let{deflate:BH}=SH,{inflate:jH}=VH;var FH=BH,GH=jH,gV=(function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e})(gV||{});class HH{constructor(){D(this,"_sequence",0),D(this,"_startTime",Date.now()),D(this,"isUseOneByte",!0)}get startTime(){let t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){let i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){let l=new Uint8Array(4);l.set([1,0,0,0]);let d={id:0,length:4,data:l.buffer},h={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[d]};i.commonPacketHeader.extension=1,i.extension=h,i.payload=this.compress(t),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;U("SHOW_DATASTREAM2_LOG")&&y.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));let r=new ArrayBuffer(i.commonPacketHeader.length),n=new Uint8Array(r),s=new DataView(r),c=0;if(s.setUint16(c,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),c+=2,s.setUint32(c,i.commonPacketHeader.sequence,!0),c+=4,s.setUint16(c,i.commonStreamHeader,!0),c+=2,i.extension){let l=this.serializeExtension(i.extension);n.set(new Uint8Array(l),c),c+=l.byteLength}if(n.set(new Uint8Array(i.payload),c),c+=i.payload.byteLength,c!==i.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);let i=new DataView(t),r=0,n=i.getUint16(r,!0);r+=2;let s={length:16383&n,reserved:(16384&n)>>14,extension:(32768&n)>>15,sequence:i.getUint16(r+2,!0)<<16|i.getUint16(r,!0)},c,l;if(r+=4,U("SHOW_DATASTREAM2_LOG")&&y.debug("receive data header: ".concat(JSON.stringify(s))),i.getUint16(r,!0),r+=2,s.extension){l=this.deserializeExtension(t.slice(r)),r+=2+l.length,c=t.slice(r);let d=!1;if(l.datas.length>0){let h=l.datas.find(p=>p.id===0);h&&(d=(1&new DataView(h.data).getUint32(0,!0))==1)}c=d?this.decompress(c):c}else c=t.slice(8);return c}serializeExtension(t){let{profile:i,length:r,datas:n}=t,s=new ArrayBuffer(r+2),c=new Uint8Array(s),l=new DataView(s),d=0;if(l.setUint8(d++,i),l.setUint8(d++,r),n.forEach(h=>{i?(l.setUint8(d++,h.id),l.setUint8(d++,h.length),c.set(new Uint8Array(h.data),d),d+=h.data.byteLength):(l.setUint8(d++,h.id|h.length<<4),c.set(new Uint8Array(h.data),d),d+=h.data.byteLength)}),d!==r+2)throw Error("serialize extension error, is ".concat(d,"!==").concat(r+2));return s}deserializeExtension(t){let i=new DataView(t),r=0,n=i.getUint8(r);r++;let s=i.getUint8(r);r++;let c=n===gV.TWO_BYTE,l=[],d=new DataView(t,2),h=0;for(;h<s;){let p=0,_=0,E=new ArrayBuffer(0);c?(p=d.getUint8(h),h++,_=d.getUint8(h),h++):(p=15&d.getUint8(h),_=d.getUint8(h)>>4,h++),_>0&&(E=d.buffer.slice(h+2,h+2+_),h+=E.byteLength),l.push({id:p,length:_,data:E})}if(h!==s)throw Error("parse error");return{profile:n,length:s,datas:l}}decompress(t){return GH(new Uint8Array(t))}compress(t){return FH(new Uint8Array(t))}}let WH={name:"DataStream",create:(e,t)=>{let i=t?new Z8(e):new Q8(e);return i.useDataStream(new HH),i}};class zH extends Ei{constructor(t,i,r){super(),D(this,"ws",void 0),D(this,"requestId",1),D(this,"heartBeatTimer",void 0),D(this,"joinInfo",void 0),D(this,"clientId",void 0),D(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),D(this,"onClose",n=>{this.emit("close"),this.dispose()}),D(this,"onMessage",n=>{let s=JSON.parse(n.data);if(!s||s.command!=="serverResponse"||!s.requestId)return s&&s.command==="serverStatus"&&s.serverStatus&&s.serverStatus.command?(this.emit("status",s.serverStatus),void this.emit(s.serverStatus.command,s.serverStatus)):void 0;this.emit("req_".concat(s.requestId),s)}),this.joinInfo=t,this.clientId=i,this.ws=new Vg("cross-channel-".concat(this.clientId),r),this.ws.on(dt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(dt.CONNECTED,this.onOpen),this.ws.on(dt.ON_MESSAGE,this.onMessage),this.ws.on(dt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){let i=this.requestId++;return t.requestId=i,t.seq=i,this.ws.sendMessage(t),i}waitStatus(t){return new we((i,r)=>{let n=window.setTimeout(()=>{r(new $(k.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,s=>{window.clearTimeout(n),s.state&&s.state!==0?r(new $(k.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(n),r(new $(k.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new $(k.WS_DISCONNECT);let i=()=>new we((c,l)=>{this.ws.once(dt.CLOSED,()=>l(new $(k.WS_ABORT))),this.ws.once(dt.CONNECTED,c)});this.ws.state!=="connected"&&await i();let r=this.sendMessage(t),n=new we((c,l)=>{let d=()=>{l(new $(k.WS_ABORT))};this.ws.once(dt.RECONNECTING,d),this.ws.once(dt.CLOSED,d),this.once("req_".concat(r),c),fr(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(dt.RECONNECTING,d),this.ws.off(dt.CLOSED,d),l(new $(k.TIMEOUT,"cross channel ws request timeout"))})}),s=await n;if(!s||s.code!==200)throw new $(k.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(t){this.ws.removeAllListeners(dt.REQUEST_NEW_URLS),this.ws.on(dt.REQUEST_NEW_URLS,i=>{i(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){let i=this.requestId++;return t.requestId=i,this.ws.sendMessage(t),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class KH extends Ei{set state(t){t!==this._state&&(t!==xn.RELAY_STATE_FAILURE&&(this.errorCode=fm.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,i,r,n,s){super(),D(this,"joinInfo",void 0),D(this,"sid",void 0),D(this,"clientId",void 0),D(this,"cancelToken",Tn.CancelToken.source()),D(this,"workerToken",void 0),D(this,"requestId",0),D(this,"signal",void 0),D(this,"prevChannelMediaConfig",void 0),D(this,"httpRetryConfig",void 0),D(this,"_resolution",void 0),D(this,"_state",xn.RELAY_STATE_IDLE),D(this,"errorCode",fm.RELAY_OK),D(this,"onStatus",c=>{y.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(c))),c&&c.command&&(c.command==="onAudioPacketReceived"&&this.emit("event",ll.PACKET_RECEIVED_AUDIO_FROM_SRC),c.command==="onVideoPacketReceived"&&this.emit("event",ll.PACKET_RECEIVED_VIDEO_FROM_SRC),c.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=fm.SRC_TOKEN_EXPIRED,this.state=xn.RELAY_STATE_FAILURE),c.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=fm.DEST_TOKEN_EXPIRED,this.state=xn.RELAY_STATE_FAILURE))}),D(this,"onReconnect",async()=>{y.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",ll.NETWORK_DISCONNECTED),this.state=xn.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(c=>{this.state!==xn.RELAY_STATE_IDLE&&(y.error("auto restart channel media relay failed",c.toString()),this.errorCode=fm.SERVER_CONNECTION_LOST,this.state=xn.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=i,this.sid=Rh(),this.signal=new zH(this.joinInfo,this.clientId,r),this.httpRetryConfig=n,this._resolution=s}async startChannelMediaRelay(t){if(this.state!==xn.RELAY_STATE_IDLE)throw new $(k.INVALID_OPERATION);this.state=xn.RELAY_STATE_CONNECTING,await this.connect(),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new $(k.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new $(k.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new $(k.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==xn.RELAY_STATE_RUNNING)throw new $(k.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==xn.RELAY_STATE_RUNNING)throw new $(k.INVALID_OPERATION);let i=this.genMessage(un.SetVideoProfile);await this.signal.request(i),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),y.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=xn.RELAY_STATE_IDLE,this.dispose()}dispose(){y.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Tn.CancelToken.source(),this.state=xn.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let t=await rG(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",ll.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){let i=this.genMessage(un.StopPacketTransfer);await this.signal.request(i),await this.signal.waitStatus("Normal Quit"),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let r=this.genMessage(un.SetSdkProfile,t);await this.signal.request(r),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let n=this.genMessage(un.SetSourceChannel,t);await this.signal.request(n),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",ll.PACKET_JOINED_SRC_CHANNEL),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let s=this.genMessage(un.SetSourceUserId,t);await this.signal.request(s),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let c=this.genMessage(un.SetDestChannel,t);await this.signal.request(c),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",ll.PACKET_JOINED_DEST_CHANNEL),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let l=this.genMessage(un.StartPacketTransfer,t);await this.signal.request(l),this.emit("event",ll.PACKET_SENT_TO_DEST_CHANNEL),this.state=xn.RELAY_STATE_RUNNING,y.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){let i=this.genMessage(un.UpdateDestChannel,t);await this.signal.request(i),this.emit("event",ll.PACKET_UPDATE_DEST_CHANNEL),y.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let t=this.genMessage(un.StopPacketTransfer);await this.signal.request(t),y.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,i){let r=[],n=[],s=[];this.requestId+=1;let c={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Fa,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};c.sdkVersion==="4.24.0"&&(c.sdkVersion="0.0.1");let l=null,d=null;switch(t){case un.SetSdkProfile:return c.clientRequest={command:"SetSdkProfile",type:"multi_channel"},c;case un.SetSourceChannel:if(d=i&&i.getSrcChannelMediaInfo(),!d)throw new $(k.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceChannel",uid:"0",channelName:d.channelName,token:d.token||this.joinInfo.appId},c;case un.SetSourceUserId:if(d=i&&i.getSrcChannelMediaInfo(),!d)throw new $(k.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceUserId",uid:d.uid+""},c;case un.SetDestChannel:if(l=i&&i.getDestChannelMediaInfo(),!l)throw new $(k.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(h=>{r.push(h.channelName),n.push(h.uid+""),s.push(h.token||this.joinInfo.appId)}),c.clientRequest={command:"SetDestChannel",channelName:r,uid:n,token:s},c;case un.StartPacketTransfer:return c.clientRequest={command:"StartPacketTransfer"},c;case un.Reconnect:return c.clientRequest={command:"Reconnect"},c;case un.StopPacketTransfer:return c.clientRequest={command:"StopPacketTransfer"},c;case un.UpdateDestChannel:if(l=i&&i.getDestChannelMediaInfo(),!l)throw new $(k.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(h=>{r.push(h.channelName),n.push(h.uid+""),s.push(h.token||this.joinInfo.appId)}),c.clientRequest={command:"UpdateDestChannel",channelName:r,uid:n,token:s},c;case un.SetVideoProfile:c.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return c}}let YH={name:"ChannelMediaRelay",create:function(e){return new KH(e.joinInfo,e.clientId,e.websocketRetryConfig||Wi,e.httpRetryConfig||Wi,e.resolution)}};function SV(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function pS(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?SV(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):SV(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}class qH extends Ei{constructor(t,i,r,n){super(),D(this,"spec",void 0),D(this,"token",void 0),D(this,"websocket",void 0),D(this,"pingpongTimer",void 0),D(this,"reconnectMode","retry"),D(this,"serviceMode",void 0),D(this,"reqId",0),D(this,"commandReqId",0),D(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),D(this,"handleWebSocketMessage",s=>{if(!s.data)return;let c=JSON.parse(s.data);c.requestId?this.emit("@".concat(c.requestId,"-").concat(c.sid),c):(Fe.workerEvent(this.spec.sid,{actionType:"status",serverCode:c.code,workerType:this.serviceMode===cl.TRANSCODE?1:2}),this.emit(kd.PUBLISH_STREAM_STATUS,c))}),this.spec=i,this.token=t,this.serviceMode=n,this.websocket=new Vg("live-streaming",r),this.websocket.on(dt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(dt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(dt.REQUEST_NEW_URLS,(s,c)=>{Cr(this,kd.REQUEST_NEW_ADDRESS).then(s).catch(c)}),this.websocket.on(dt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,i,r,n){this.reqId+=1,t==="request"&&(this.commandReqId+=1);let s=this.commandReqId,c=this.reqId;if(!c||!this.websocket)throw new $(k.UNEXPECTED_ERROR);let l=pS({command:t,sdkVersion:Fa==="4.24.0"?"0.0.1":Fa,seq:c,requestId:c,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new $(k.WS_DISCONNECT);let d=()=>new we((E,R)=>{this.websocket.once(dt.CLOSED,()=>R(new $(k.WS_ABORT))),this.websocket.once(dt.CONNECTED,E)});this.websocket.state!=="connected"&&await d(),l.clientRequest&&(l.clientRequest.workerToken=this.token);let h=new we((E,R)=>{let N=()=>{R(new $(k.WS_ABORT))};this.websocket.once(dt.RECONNECTING,N),this.websocket.once(dt.CLOSED,N),this.once("@".concat(c,"-").concat(this.spec.sid),w=>{E(w)})});n&&Fe.workerEvent(this.spec.sid,pS(pS({},n),{},{requestId:s,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));let p=Date.now();this.websocket.sendMessage(l);let _=null;try{_=await h}catch(E){if(this.websocket.state==="closed")throw E;return await d(),await this.request(t,i,r)}return n&&Fe.workerEvent(this.spec.sid,pS(pS({},n),{},{requestId:s,actionType:"response",payload:JSON.stringify(_.serverResponse),serverCode:_.code,success:_.code===200,responseTime:Date.now()-p})),_.code!==200&&this.handleResponseError(_),_}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let t=Fa==="4.24.0"?"0.0.1":Fa;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Xi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void y.warning("live stream response already exists stream");case Xi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Xi.LIVE_STREAM_RESPONSE_BAD_STREAM:case Xi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new $(k.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Xi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new $(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Xi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new $(k.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Xi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let i=new $(k.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(kd.WARNING,i,t.serverResponse.url)}case Xi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let i=new $(k.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(kd.WARNING,i,t.serverResponse.url)}case Xi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new $(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Xi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new $(k.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Xi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let i=new $(k.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(kd.WARNING,i,t.serverResponse.url)}case Xi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new $(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Xi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new $(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Xi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Xi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new $(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Xi.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new $(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new $(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Xi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Xi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Xi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Xi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new $(k.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(nR)},6e3)}}function TV(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function Un(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?TV(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):TV(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}class XH extends Ei{constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Wi,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Wi;super(),D(this,"onLiveStreamWarning",void 0),D(this,"onLiveStreamError",void 0),D(this,"spec",void 0),D(this,"retryTimeout",1e4),D(this,"connection",void 0),D(this,"httpRetryConfig",void 0),D(this,"wsRetryConfig",void 0),D(this,"streamingTasks",new Map),D(this,"isStartingStreamingTask",!1),D(this,"taskMutex",new Lr("live-streaming")),D(this,"cancelToken",Tn.CancelToken.source()),D(this,"transcodingConfig",void 0),D(this,"uapResponse",void 0),D(this,"lastTaskId",1),D(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=r,this.wsRetryConfig=i}async setTranscodingConfig(t){let i=Un(Un({},M9),t);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(y.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(c=>Un(Un(Un({},k9),c),{},{zOrder:c.zOrder?c.zOrder+1:1}))),(function(c){yi(c.width)||Yt(c.width,"config.width",0,1e4),yi(c.height)||Yt(c.height,"config.height",0,1e4),yi(c.videoBitrate)||Yt(c.videoBitrate,"config.videoBitrate",1,1e6),yi(c.videoFrameRate)||Yt(c.videoFrameRate,"config.videoFrameRate"),yi(c.lowLatency)||ro(c.lowLatency,"config.lowLatency"),yi(c.audioSampleRate)||$i(c.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),yi(c.audioBitrate)||Yt(c.audioBitrate,"config.audioBitrate",1,128),yi(c.audioChannels)||$i(c.audioChannels,"config.audioChannels",[1,2,3,4,5]),yi(c.videoGop)||Yt(c.videoGop,"config.videoGop"),yi(c.videoCodecProfile)||$i(c.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),yi(c.userCount)||Yt(c.userCount,"config.userCount",0,17),yi(c.backgroundColor)||Yt(c.backgroundColor,"config.backgroundColor",0,16777215),yi(c.userConfigExtraInfo)||pr(c.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),c.transcodingUsers&&!yi(c.transcodingUsers)&&(ol(c.transcodingUsers,"config.transcodingUsers"),c.transcodingUsers.forEach((l,d)=>{IR(l.uid),yi(l.x)||Yt(l.x,"transcodingUser[".concat(d,"].x"),0,1e4),yi(l.y)||Yt(l.y,"transcodingUser[".concat(d,"].y"),0,1e4),yi(l.width)||Yt(l.width,"transcodingUser[".concat(d,"].width"),0,1e4),yi(l.height)||Yt(l.height,"transcodingUser[".concat(d,"].height"),0,1e4),yi(l.zOrder)||Yt(l.zOrder-1,"transcodingUser[".concat(d,"].zOrder"),0,100),yi(l.alpha)||Yt(l.alpha,"transcodingUser[".concat(d,"].alpha"),0,1,!1)})),yi(c.watermark)||Fw(c.watermark,"watermark"),yi(c.backgroundImage)||Fw(c.backgroundImage,"backgroundImage"),c.images&&!yi(c.images)&&(ol(c.images,"config.images"),c.images.forEach((l,d)=>{Fw(l,"images[".concat(d,"]"))}))})(i);let r=[];i.images&&r.push(...i.images.map(c=>Un(Un(Un({},jw),c),{},{zOrder:255}))),i.backgroundImage&&(r.push(Un(Un(Un({},jw),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(r.push(Un(Un(Un({},jw),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=r,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(c=>Un({},c)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);let n=(i.userConfigs||[]).map(c=>typeof c.uid=="number"?we.resolve(c.uid):KM(c.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await we.all(n)).forEach((c,l)=>{i.userConfigs&&i.userConfigs[l]&&(i.userConfigs[l].uid=c)}),this.transcodingConfig=i,this.connection)try{var s;let c=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Sn(s=this.streamingTasks).call(s)).map(l=>l.taskId).join("#")});y.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(c.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(c){if(!c.data||!c.data.retry)throw c;c.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(l=>{y.warning("[".concat(this.spec.clientId,"] live streaming receive error"),c.toString(),"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,c).then(()=>{y.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(l.url," success"))}).catch(d=>{y.error("[".concat(this.spec.clientId,"] live streaming republish failed"),l.url,d.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,d)})})}}async startLiveStreamingTask(t,i,r){if(!this.transcodingConfig&&i===cl.TRANSCODE)throw new $(k.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let n={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};y.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(i));let s=await this.taskMutex.lock();if(!this.connection&&r)return void s();if(this.streamingTasks.get(t)&&!r)return s(),new $(k.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(l){throw s(),l}switch(i){case cl.TRANSCODE:n.transcodingConfig=Un({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(n.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let c=this.lastTaskId++;try{let l=new we((h,p)=>{fr(this.retryTimeout).then(()=>{if(r)return p(r);let _=this.statusError.get(t);return _?(this.statusError.delete(t),p(_)):void 0})}),d=await we.race([this.connection.request("request",{clientRequest:n},!0,{url:t,command:"PublishStream",workerType:i===cl.TRANSCODE?1:2,requestByUser:!r,tid:c.toString()}),l]);this.isStartingStreamingTask=!1,y.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(d.code)),this.streamingTasks.set(t,{clientRequest:n,mode:i,url:t,taskId:c}),s()}catch(l){if(s(),this.isStartingStreamingTask=!1,!l.data||!l.data.retry||r)throw l;return l.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,i,l)):await this.startLiveStreamingTask(t,i,l)}}stopLiveStreamingTask(t){return new we((i,r)=>{let n=this.streamingTasks.get(t);if(!n||!this.connection)return new $(k.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let s=n.mode;n.abortTask=()=>{y.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),i()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:n.url}},!1,{url:t,command:"UnPublishStream",workerType:s===cl.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(c=>{y.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(c.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),i()}).catch(r)})}resetAllTask(){var t;let i=Array.from(Sn(t=this.streamingTasks).call(t));this.terminate();for(let r of i)this.startLiveStreamingTask(r.url,r.mode).catch(n=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,n)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Tn.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new $(k.UNEXPECTED_ERROR,"live streaming connection has already connected");let i=await Cr(this,Gw.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=i,this.connection=new qH(i.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(kd.WARNING,(r,n)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(n,r)),this.connection.on(kd.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on(kd.REQUEST_NEW_ADDRESS,(r,n)=>{if(!this.connection)return n(new $(k.UNEXPECTED_ERROR,"can not get new live streaming address list"));Cr(this,Gw.REQUEST_WORKER_MANAGER_LIST,t).then(s=>{this.uapResponse=s,r(s.addressList)}).catch(n)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(t){let i=t.serverStatus&&t.serverStatus.url||"empty_url",r=this.streamingTasks.get(i),n=t.reason;switch(t.code){case Xi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Xi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Xi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Xi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let c=new $(k.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return y.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,c);if(!this.isStartingStreamingTask)return;this.statusError.set(i,c)}case Xi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let c=new $(k.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,n);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,c)}case Xi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Xi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();let c=Array.from(Sn(s=this.streamingTasks).call(s));for(let l of c)l.abortTask?l.abortTask():(y.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,new $(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{y.debug("[".concat(this.spec.clientId,"] republish live stream success"),l.url)}).catch(d=>{y.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,d)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}let JH={name:"LiveStreaming",create:function(e){return new XH(e.joinInfo,e.websocketRetryConfig||Wi,e.httpRetryConfig||Wi)}};function ZH(e){let t=yV();return(function(i,r){let n=i.appId;n!==void 0&&(Gt(r,10),hc(r,n));let s=i.cid;s!==void 0&&(Gt(r,16),Gt(r,s));let c=i.cname;c!==void 0&&(Gt(r,26),hc(r,c));let l=i.deviceId;l!==void 0&&(Gt(r,34),hc(r,l));let d=i.elapse;d!==void 0&&(Gt(r,40),Jd(r,d));let h=i.fileSize;h!==void 0&&(Gt(r,48),Jd(r,Dm(h)));let p=i.height;p!==void 0&&(Gt(r,56),Jd(r,Dm(p)));let _=i.jpg;_!==void 0&&(Gt(r,66),Gt(r,_.length),(function(Vr,de){let ye=Pm(Vr,de.length);Vr.bytes.set(de,ye)})(r,_));let E=i.networkType;E!==void 0&&(Gt(r,72),Jd(r,Dm(E)));let R=i.osType;R!==void 0&&(Gt(r,80),Jd(r,Dm(R)));let N=i.requestId;N!==void 0&&(Gt(r,90),hc(r,N));let w=i.sdkVersion;w!==void 0&&(Gt(r,98),hc(r,w));let O=i.sequence;O!==void 0&&(Gt(r,104),Jd(r,Dm(O)));let L=i.sid;L!==void 0&&(Gt(r,114),hc(r,L));let M=i.timestamp;M!==void 0&&(Gt(r,120),Jd(r,M));let B=i.uid;B!==void 0&&(Gt(r,128),Gt(r,B));let Y=i.vid;Y!==void 0&&(Gt(r,136),Gt(r,Y));let H=i.width;H!==void 0&&(Gt(r,144),Jd(r,Dm(H)));let G=i.service;G!==void 0&&(Gt(r,152),Gt(r,G));let Q=i.callbackData;Q!==void 0&&(Gt(r,162),hc(r,Q));let ce=i.jpgEncryption;ce!==void 0&&(Gt(r,168),Gt(r,ce));let he=i.requestType;he!==void 0&&(Gt(r,176),Gt(r,he));let Se=i.scorePorn;Se!==void 0&&(Gt(r,185),YI(r,Se));let ht=i.scoreSexy;ht!==void 0&&(Gt(r,193),YI(r,ht));let pt=i.scoreNeutral;pt!==void 0&&(Gt(r,201),YI(r,pt));let tt=i.scene;tt!==void 0&&(Gt(r,208),Gt(r,tt));let xt=i.ossFilePrefix;xt!==void 0&&(Gt(r,218),hc(r,xt));let Lt=i.serviceVendor;if(Lt!==void 0)for(let Vr of Lt){Gt(r,226);let de=yV();e7(Vr,de),Gt(r,de.limit),n7(r,de),r7(de)}})(e,t),(function(i){let r=i.bytes,n=i.limit;return r.length===n?r:r.subarray(0,n)})(t)}function QH(e){return(function(i){let r={};e:for(;!CV(i);){let n=pc(i);switch(n>>>3){case 0:break e;case 1:r.code=pc(i);break;case 2:r.msg=bV(i,pc(i));break;case 3:{let s=t7(i);r.data=$H(i),i.limit=s;break}default:vV(i,7&n)}}return r})({bytes:t=e,offset:0,limit:t.length});var t}function $H(e){let t={};e:for(;!CV(e);){let i=pc(e);switch(i>>>3){case 0:break e;case 1:t.requestId=bV(e,pc(e));break;case 2:t.requestType=pc(e)>>>0;break;case 3:t.scorePorn=KI(e);break;case 4:t.scoreSexy=KI(e);break;case 5:t.scoreNeutral=KI(e);break;case 6:t.requestScene=pc(e)>>>0;break;case 7:t.scene=pc(e)>>>0;break;default:vV(e,7&i)}}return t}function e7(e,t){let i=e.service;i!==void 0&&(Gt(t,8),Gt(t,i));let r=e.vendor;r!==void 0&&(Gt(t,16),Gt(t,r));let n=e.token;n!==void 0&&(Gt(t,26),hc(t,n));let s=e.callbackUrl;s!==void 0&&(Gt(t,34),hc(t,s))}function t7(e){let t=pc(e),i=e.limit;return e.limit=e.offset+t,i}function vV(e,t){switch(t){case 0:for(;128&AV(e););break;case 2:WI(e,pc(e));break;case 5:WI(e,4);break;case 1:WI(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let i7=new Float32Array(1);new Uint8Array(i7.buffer);let HI=new Float64Array(1),Vn=new Uint8Array(HI.buffer);function Dm(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let RV=[];function yV(){let e=RV.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function r7(e){RV.push(e)}function WI(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function CV(e){return e.offset>=e.limit}function Pm(e,t){let i=e.bytes,r=e.offset,n=e.limit,s=r+t;if(s>i.length){let c=new Uint8Array(2*s);c.set(i),e.bytes=c}return e.offset=s,s>n&&(e.limit=s),r}function zI(e,t){let i=e.offset;if(i+t>e.limit)throw new Error("Read past limit");return e.offset+=t,i}function bV(e,t){let i=zI(e,t),r=String.fromCharCode,n=e.bytes,s="",c="";for(let l=0;l<t;l++){let d,h,p,_,E=n[l+i];128&E?(224&E)==192?l+1>=t?c+=s:(d=n[l+i+1],(192&d)!=128?c+=s:(_=(31&E)<<6|63&d,_<128?c+=s:(c+=r(_),l++))):(240&E)==224?l+2>=t?c+=s:(d=n[l+i+1],h=n[l+i+2],(49344&(d|h<<8))!=32896?c+=s:(_=(15&E)<<12|(63&d)<<6|63&h,_<2048||_>=55296&&_<=57343?c+=s:(c+=r(_),l+=2))):(248&E)==240?l+3>=t?c+=s:(d=n[l+i+1],h=n[l+i+2],p=n[l+i+3],(12632256&(d|h<<8|p<<16))!=8421504?c+=s:(_=(7&E)<<18|(63&d)<<12|(63&h)<<6|63&p,_<65536||_>1114111?c+=s:(_-=65536,c+=r(55296+(_>>10),56320+(1023&_)),l+=3))):c+=s:c+=r(E)}return c}function hc(e,t){let i=t.length,r=0;for(let c=0;c<i;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<i&&(l=(l<<10)+t.charCodeAt(++c)-56613888),r+=l<128?1:l<2048?2:l<65536?3:4}Gt(e,r);let n=Pm(e,r),s=e.bytes;for(let c=0;c<i;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<i&&(l=(l<<10)+t.charCodeAt(++c)-56613888),l<128?s[n++]=l:(l<2048?s[n++]=l>>6&31|192:(l<65536?s[n++]=l>>12&15|224:(s[n++]=l>>18&7|240,s[n++]=l>>12&63|128),s[n++]=l>>6&63|128),s[n++]=63&l|128)}}function n7(e,t){let i=Pm(e,t.limit),r=e.bytes,n=t.bytes;for(let s=0,c=t.limit;s<c;s++)r[s+i]=n[s]}function AV(e){return e.bytes[zI(e,1)]}function wV(e,t){let i=Pm(e,1);e.bytes[i]=t}function KI(e){let t=zI(e,8),i=e.bytes;return Vn[0]=i[t++],Vn[1]=i[t++],Vn[2]=i[t++],Vn[3]=i[t++],Vn[4]=i[t++],Vn[5]=i[t++],Vn[6]=i[t++],Vn[7]=i[t++],HI[0]}function YI(e,t){let i=Pm(e,8),r=e.bytes;HI[0]=t,r[i++]=Vn[0],r[i++]=Vn[1],r[i++]=Vn[2],r[i++]=Vn[3],r[i++]=Vn[4],r[i++]=Vn[5],r[i++]=Vn[6],r[i++]=Vn[7]}function pc(e){let t,i=0,r=0;do t=AV(e),i<32&&(r|=(127&t)<<i),i+=7;while(128&t);return r}function Gt(e,t){for(t>>>=0;t>=128;)wV(e,127&t|128),t>>>=7;wV(e,t)}function Jd(e,t){let i=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,n=t.high>>>24,s=n===0?r===0?i<16384?i<128?1:2:i<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:n<128?9:10,c=Pm(e,s),l=e.bytes;switch(s){case 10:l[c+9]=n>>>7&1;case 9:l[c+8]=s!==9?128|n:127&n;case 8:l[c+7]=s!==8?r>>>21|128:r>>>21&127;case 7:l[c+6]=s!==7?r>>>14|128:r>>>14&127;case 6:l[c+5]=s!==6?r>>>7|128:r>>>7&127;case 5:l[c+4]=s!==5?128|r:127&r;case 4:l[c+3]=s!==4?i>>>21|128:i>>>21&127;case 3:l[c+2]=s!==3?i>>>14|128:i>>>14&127;case 2:l[c+1]=s!==2?i>>>7|128:i>>>7&127;case 1:l[c]=s!==1?128|i:127&i}}function IV(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}let a7=new Map([["moderation",1],["supervise",2]]);class s7 extends Ei{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let i=this._connectionState;this._connectionState=t,this.emit(cr.CONNECTION_STATE_CHANGE,i,t)}get inspectType(){return this._inspectType}set inspectType(t){var i;this._inspectMode=In(i=t.map(r=>a7.get(r)||0)).call(i,(r,n)=>r+n),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),D(this,"name","AgoraRTCVideoContentInspect"),D(this,"_connectionState",ys.CONNECTING),D(this,"_innerConnectionState",void 0),D(this,"sequence",0),D(this,"inspectStartTime",void 0),D(this,"workerManagerConnection",void 0),D(this,"workerConnection",void 0),D(this,"workerMessageLengthLimit",void 0),D(this,"inspectIntervalMinimum",void 0),D(this,"qualityRatio",void 0),D(this,"_connectInfo",void 0),D(this,"_cancelTokenSource",Tn.CancelToken.source()),D(this,"_retryConfig",void 0),D(this,"wmSequence",0),D(this,"inspectInterval",void 0),D(this,"inspectTimer",null),D(this,"ossFilePrefix",void 0),D(this,"extraInfo",void 0),D(this,"_inspectType",void 0),D(this,"_inspectMode",void 0),D(this,"_quality",1),D(this,"qualityTimer",null),D(this,"_inspectId",void 0),D(this,"_needWorkUrlOnly",!1),D(this,"inspectImage",()=>{if(this.connectionState!==ys.CONNECTED)throw new $(k.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===ys.CONNECTED?this.requestToInspectImage():y.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Zt(5,"inspect-"),this.workerMessageLengthLimit=U("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=U("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=U("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Vg("worker-manager-"+this._inspectId,Wi),this.on(cr.STATE_CHANGE,(i,r)=>{this._innerConnectionState=i,y.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Cs[i]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Vg("worker-"+this._inspectId,Wi),this.handleWorkerEvents()}async init(t,i){this.emit(cr.STATE_CHANGE,Cs.CONNECT_AP),this._connectInfo=t;let r=this._cancelTokenSource.token;return this._retryConfig=i,new we((n,s)=>{this.on(cr.CONNECTION_STATE_CHANGE,(c,l)=>{l===ys.CONNECTED&&n()}),this.requestAP(t,r,i).then(c=>{this.connectWorkerManager(c)}).catch(c=>{s(c)})})}async requestAP(t,i,r){let n=U("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),s=await(function(l,d,h,p){let{appId:_,areaCode:E,cname:R,sid:N,token:w,uid:O}=d;vm++;let L="image_moderation_api",M={service_name:L,json_body:JSON.stringify({appId:_,areaCode:E,cname:R,command:"allocateEdge",requestId:vm,seq:vm,sid:N,token:w,ts:Date.now(),uid:O+""})},B,Y,H=l[0];return no(async()=>{B=Date.now();let G=await lo(H,{data:M,cancelToken:h,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Y=Date.now()-B,G.code!==0){let Se=new $(k.UNEXPECTED_RESPONSE,"image inspect ap error, code"+G.code,{retry:!0,responseTime:Y});throw y.error(Se.toString()),Se}let Q=JSON.parse(G.json_body);if(Q.code!==200){let Se=new $(k.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Q.code,", reason: ").concat(Q.reason),{code:Q.code,responseTime:Y});throw y.error(Se.toString()),Se}if(!Q.servers||!Array.isArray(Q.servers)||Q.servers.length===0){let Se=new $(k.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Q.code,responseTime:Y});throw y.error(Se.toString()),Se}let ce=U("VIDEO_INSPECT_WORKER_MANAGER_HOST"),he=U("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Q.servers.map(Se=>{let{address:ht,wss:pt}=Se;if(ht&&pt)return"wss://".concat(ht.replace(/\./g,"-"),".").concat(ce,":").concat(he||pt)}).filter(Se=>!!Se),workerToken:Q.workerToken,vid:Q.vid,responseTime:Y}},(G,Q)=>(Fe.apworkerEvent(N,{success:!0,sc:200,serviceName:L,responseDetail:JSON.stringify(G.addressList),firstSuccess:Q===0,responseTime:Y,serverIp:l[Q%l.length]}),!1),(G,Q)=>(Fe.apworkerEvent(N,{success:!1,sc:G.data&&G.data.code||200,serviceName:L,responseTime:Y,serverIp:l[Q%l.length]}),!!(G.code!==k.OPERATION_ABORTED&&G.code!==k.UNEXPECTED_RESPONSE||G.data&&G.data.retry)&&(H=l[(Q+1)%l.length],!0)),p)})(n,t,i,r);this.emit(cr.STATE_CHANGE,Cs.AP_CONNECTED);let{addressList:c}=s;return this.wmSequence++,c}async connectWorkerManager(t){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(cr.STATE_CHANGE,Cs.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(dt.CONNECTED,async()=>{this.emit(cr.STATE_CHANGE,Cs.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(dt.CLOSED,()=>{this._innerConnectionState<Cs.GET_WORKER_MANAGER_RESPONSE&&y.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(dt.FAILED,()=>{this._innerConnectionState<Cs.GET_WORKER_MANAGER_RESPONSE&&y.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(dt.RECONNECTING,()=>{this._innerConnectionState<Cs.GET_WORKER_MANAGER_RESPONSE&&y.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(dt.ON_MESSAGE,async t=>{this.emit(cr.STATE_CHANGE,Cs.GET_WORKER_MANAGER_RESPONSE);let i=this.workerManagerConnection.url;this.workerManagerConnection.close();let r=JSON.parse(t.data);if(r.code!==200)throw y.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new $(k.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&i))throw y.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new $(k.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{let n=U("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,s=i.replace(/:\d+\/?$/,":".concat(n));this.emit(cr.STATE_CHANGE,Cs.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit(cr.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}}),this.workerManagerConnection.on(dt.WILL_RECONNECT,(t,i,r)=>{r(t)}),this.workerManagerConnection.on(dt.REQUEST_NEW_URLS,(t,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(i)})}handleWorkerEvents(){this.workerConnection.on(dt.CONNECTED,async()=>{this.emit(cr.STATE_CHANGE,Cs.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=ys.CONNECTED}),this.workerConnection.on(dt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let r=QH(new Uint8Array(t.data));if(U("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&y.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(cr.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var i;let n={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},s=In(i=Object.keys(n)).call(i,(l,d)=>n[l]>n[d]?l:d,"porn"),c=Object.keys(n).find(l=>l===s);this.emit(cr.INSPECT_RESULT,c)}else this.emit(cr.INSPECT_RESULT,void 0,new $(k.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(cr.INSPECT_RESULT,void 0,new $(k.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else y.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(cr.INSPECT_RESULT,void 0,new $(k.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(dt.CLOSED,()=>{this.connectionState=ys.CLOSED}),this.workerConnection.on(dt.FAILED,()=>{this.connectionState=ys.CLOSED}),this.workerConnection.on(dt.RECONNECTING,()=>{this.connectionState=this.connectionState===ys.CONNECTED?ys.RECONNECTING:ys.CONNECTING}),this.workerConnection.on(dt.WILL_RECONNECT,(t,i,r)=>{t==="recover"&&r(t),r("tryNext")}),this.workerConnection.on(dt.REQUEST_NEW_URLS,(t,i)=>{this.workerManagerConnection.close(),this.once(cr.REQUEST_NEW_WORKER_URL,r=>{t([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{i(r)})})}async requestToInspectImage(){this.sequence++;let t=fa(this,cr.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(cr.INSPECT_RESULT,void 0,new $(k.INVALID_OPERATION,"Only the track being played can be inspected"));let r=await this.generateRequestData(t,i);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(cr.INSPECT_RESULT,void 0,new $(k.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,i){let{appId:r,cname:n,cid:s,vid:c,sid:l,uid:d}=i,h=Date.now(),p=await t.getCurrentFrameImage("image/jpeg",this.quality),_=await l2(p,r,n),E=this.sequence+"-"+s+"-"+d+"-"+h+"-"+Zt(12,""),R={appId:r,cid:s,cname:n,deviceId:"",elapse:(N=Number(h-this.inspectStartTime),{low:N|=0,high:N>>31,unsigned:N>=0}),fileSize:_.byteLength,jpgEncryption:2,height:p.height,width:p.width,jpg:_,networkType:6,osType:7,requestId:E,sdkVersion:"4.24.0",sequence:this.sequence,sid:l,timestamp:xx(h),uid:d,vid:c,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var N;this.extraInfo===void 0&&delete R.callbackData,this.ossFilePrefix===void 0&&delete R.ossFilePrefix;let w=ZH(R);if(w.byteLength<this.workerMessageLengthLimit){if(U("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let O=(function(L){for(var M=1;M<arguments.length;M++){var B=arguments[M]!=null?arguments[M]:{};M%2?IV(Object(B),!0).forEach(function(Y){D(L,Y,B[Y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(B)):IV(Object(B)).forEach(function(Y){Object.defineProperty(L,Y,Object.getOwnPropertyDescriptor(B,Y))})}return L})({},R);delete O.jpg,y.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(O))}return w}{let O=this.quality*this.qualityRatio;return this.quality=O,await this.generateRequestData(t,{appId:r,cname:n,cid:s,vid:c,sid:l,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Tn.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=ys.CLOSED,this.emit(cr.STATE_CHANGE,Cs.CLOSED)}}let o7={name:"ContentInspect",create:function(e){let{config:t}=e;return(function(i){if(!i)throw new $(k.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new $(k.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{let r=[...new Set(i.inspectType)];r.forEach(n=>{var s;if(!ve(s=["supervise","moderation"]).call(s,n))throw new $(k.INVALID_PARAMS,"".concat(n," is not a valid inspect type."))}),i.inspectType=r}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new $(k.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")})(t),new s7(t)}};var OV=b(bn.Object.getOwnPropertySymbols),c7=Vt,l7=Ac.indexOf,d7=wc,qI=rt([].indexOf),NV=!!qI&&1/qI([1],1,-0)<0;c7({target:"Array",proto:!0,forced:NV||!d7("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return NV?qI(this,e,t)||0:l7(this,e,t)}});var u7=Hn("Array","indexOf"),h7=se,p7=u7,XI=Array.prototype,f7=function(e){var t=e.indexOf;return e===XI||h7(XI,e)&&t===XI.indexOf?p7:t},DV=b(f7);function m7(e,t){if(e==null)return{};var i,r,n=(function(c,l){if(c==null)return{};var d={};for(var h in c)if({}.hasOwnProperty.call(c,h)){if(DV(l).call(l,h)!==-1)continue;d[h]=c[h]}return d})(e,t);if(OV){var s=OV(e);for(r=0;r<s.length;r++)i=s[r],DV(t).call(t,i)===-1&&{}.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}let PV=class{get localCapabilities(){return fi(this._localCapabilities)}get rtpCapabilities(){return fi(this._rtpCapabilities)}get candidates(){return fi(this._candidates)}get iceParameters(){return fi(this._iceParameters)}get dtlsParameters(){return fi(this._dtlsParameters)}constructor(e){D(this,"sessionDesc",void 0),D(this,"_localCapabilities",void 0),D(this,"_rtpCapabilities",void 0),D(this,"_candidates",void 0),D(this,"_iceParameters",void 0),D(this,"_dtlsParameters",void 0),D(this,"setup",void 0),D(this,"currentMidIndex",void 0),D(this,"cname","o/i14u9pJrxRKAsu"),D(this,"firefoxSsrcMidMap",new Map),e=fi(e);let{remoteIceParameters:t,remoteDtlsParameters:i,candidates:r,remoteRTPCapabilities:n,localCapabilities:s,direction:c,setup:l,videoCodec:d,audioCodec:h}=e,p;this.setup=l,p=c===dn.RECEIVE_ONLY?kn(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):kn(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=n,this._candidates=r,this._iceParameters=t,this._dtlsParameters=i,this._localCapabilities=s;let _=c===dn.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,E=c===dn.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,R=c===dn.RECEIVE_ONLY?n.send.videoCodecs:Gg(Le.VIDEO,_,E,d),N=c===dn.RECEIVE_ONLY?n.send.audioCodecs:Gg(Le.AUDIO,_,E,h);for(let w of p.mediaDescriptions)w.attributes.iceUfrag=t.iceUfrag,w.attributes.icePwd=t.icePwd,w.attributes.fingerprints=i.fingerprints,w.attributes.candidates=r,w.attributes.setup=this.setup,w.media.mediaType==="application"&&(w.attributes.sctpPort="5000"),w.media.mediaType==="video"&&(w.media.fmts=R.map(O=>O.payloadType.toString(10)),w.attributes.payloads=R,w.attributes.extmaps=_.videoExtensions),w.media.mediaType==="audio"&&(w.media.fmts=N.map(O=>O.payloadType.toString(10)),w.attributes.payloads=N,w.attributes.extmaps=_.audioExtensions,Tm(w));this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return Pd(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,i,r,n){i=i.replace(/ /g,"-");let{ssrcs:s,ssrcGroups:c}=Fg(t,this.cname,U("SYNC_GROUP")?i:void 0),l=this.findPreloadMediaDesc(s);if(l){if(Ri()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,l.attributes.mid),n&&(n.twcc||n.remb)){let d=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(l,n),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{let d=this.findAvailableMediaIndex(e,s,r),h;return d===-1?(h=this.createOrRecycleSendMedia(e,s,c,"sendonly",r,n),this.updateBundleMids()):(h=fi(this.sessionDesc.mediaDescriptions[d]),h.attributes.direction="sendonly",h.attributes.ssrcs=s,h.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(h,n)),Ri()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,h.attributes.mid),{needExchangeSDP:!0,mid:h.attributes.mid}}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,i){let r=[];return e.forEach(n=>{let s=n._mediaStreamTrack.kind,c=this.findAvailableRecvMediaIndex(s),l,d=!1;c===-1?(d=!0,l=this.createOrRecycleRecvMedia(n,[],"recvonly",t,i),this.updateBundleMids()):(l=fi(this.sessionDesc.mediaDescriptions[c]),l.attributes.direction="recvonly"),r.push({mid:l.attributes.mid,needCreateTransceiver:d})}),r}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:t,protocol:i,address:r,port:n,type:s,relatedAddress:c,relatedPort:l,priority:d}=new RTCIceCandidate(e),h={foundation:t??"",componentId:"1",transport:i??"",priority:d?d+"":"",connectionAddress:r??"",port:n?n+"":"",type:s?s+"":"",relAddr:c??"",relPort:l?l+"":"",extension:{}};this.candidates.some(p=>p.priority===h.priority&&p.connectionAddress===h.connectionAddress&&p.port===h.port)||(this._candidates.push(h),this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,i,r,n){let s=e._mediaStreamTrack.kind,c=this.rtpCapabilities.recv,l=Gg(s,c,this.localCapabilities.send,s===Le.AUDIO?n:r),d=s===Le.VIDEO?c.videoExtensions:c.audioExtensions,h="".concat(++this.currentMidIndex),p={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(h)}};p=this.mungRecvMediaDsec(p,e);let _=this.findFirstClosedMedia(s);if(_){let E=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[E]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>ve(e).call(e,i.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>ve(e).call(e,i.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,i){return this.sessionDesc.mediaDescriptions.findIndex(r=>{let n=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(Ri()){if(n){let s=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(s||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!s||s!==r.attributes.mid)}return!1}return n&&r.attributes.mid===i})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{let i=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&i})}predictReceivingMids(e){let t=[];for(let i=0;i<e;i++)t.push((this.currentMidIndex+i+1).toString(10));return t}restartICE(e){e=fi(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,i,r,n,s){let c=this.rtpCapabilities.send,l=e===Le.VIDEO?c.videoCodecs:c.audioCodecs,d=e===Le.VIDEO?c.videoExtensions:c.audioExtensions;Ri()&&(n="".concat(++this.currentMidIndex));let h={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:n}};h=this.mungSendMediaDesc(h,s);let p=this.findFirstClosedMedia(e);if(p){let _=this.sessionDesc.mediaDescriptions.indexOf(p);this.sessionDesc.mediaDescriptions[_]=h}else this.sessionDesc.mediaDescriptions.push(h);return h}mungRecvMediaDsec(e,t,i){let r=fi(e);return qw(r),Sm(r,t),Xw(r,t),AM(r),xR(r,i,this.localCapabilities.send),r}mungSendMediaDesc(e,t){let i=fi(e);return xR(i,t,this.localCapabilities.recv),Tm(i),i}updateRecvMedia(e,t){let i=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(i!==-1){let r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],t);this.sessionDesc.mediaDescriptions[i]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var i;return((i=t.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Ri()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}},_7=["sdp"];var si;function LV(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function Zd(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?LV(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):LV(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let kV=(si=class km extends cM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,i;return(t=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,i,r){super(t,i),D(this,"direction",void 0),D(this,"name",void 0),D(this,"store",void 0),D(this,"spec",void 0),D(this,"peerConnection",void 0),D(this,"initialOffer",void 0),D(this,"transport",void 0),D(this,"statsFilter",void 0),D(this,"localCandidateCount",0),D(this,"_isInRestartIce",!1),D(this,"mutex",void 0),D(this,"onLocalCandidate",void 0),D(this,"remoteSDP",void 0),D(this,"pendingCandidates",[]),D(this,"localCapabilities",void 0),D(this,"isReady",!1),D(this,"restartCnt",0),D(this,"curTurnServerIndex",0),this.store=i,this.spec=t,this.mutex=new Lr("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(km.resolvePCConfiguration(t,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??dn.SEND_ONLY,this.name=this.direction===dn.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=rw(this.peerConnection,U("STATS_UPDATE_INTERVAL"),void 0,Ri()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{let i=await IM();if(this.localCapabilities=UR(i),t){let{sdp:r}=t,n=m7(t,_7),s=(function(){let p={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},_=jg(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},R={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(bs(_,p,"videoExtensions",E,R,N),bs(_,p,"videoCodecs",E,R,N),bs(_,p,"audioExtensions",E,R,N),bs(_,p,"audioCodecs",E,R,N),U("RAISE_H264_BASELINE_PRIORITY")){let w=N.videoCodecs.findIndex(O=>O.rtpMap&&O.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&O.fmtp&&O.fmtp.parameters["profile-level-id"]==="42001f");if(w!==-1){let O=N.videoCodecs.findIndex(L=>L.rtpMap&&L.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(O<w){y.debug("raising H264 baseline profile priority");let L=N.videoCodecs[w];N.videoCodecs.splice(w,1),N.videoCodecs.splice(O,0,L)}O!==-1&&U("FILTER_SEND_H264_BASELINE")&&(E.videoCodecs=E.videoCodecs.filter(L=>!(L.rtpMap&&L.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&L.fmtp&&L.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:E,recv:R,sendrecv:N}})({},{},r);this.remoteSDP=new PV({remoteIceParameters:n.iceParameters,remoteDtlsParameters:n.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let c=await this.peerConnection.createAnswer();if(!c.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let l=Vd(c.sdp);await this.peerConnection.setLocalDescription(c);let d=await OM({},{},c.sdp);this.localCapabilities=UR(d);let h=this.peerConnection.getTransceivers()[0];return h!=null&&h.receiver&&h.receiver.transport&&this.tryBindTransportEvents(h.receiver.transport),Zd(Zd({},l),{},{sdp:c.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let n=Vd(r.sdp);return this.initialOffer=r,Zd(Zd({},n),{},{sdp:r.sdp})}}catch(i){throw new ne(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:i,iceParameters:r,dtlsParameters:n}=t,s=await OM({},{},i);this.remoteSDP=new PV({remoteIceParameters:r,remoteDtlsParameters:n,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let c=this.peerConnection.getTransceivers()[0];c!=null&&c.sender&&c.sender.transport&&this.tryBindTransportEvents(c.sender.transport)}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new ne(k.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(t,i,r){var n=this;return ja(function*(){let s=yield It(n.mutex.lock("From P2PConnection.send"));try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let c=[],l=n.remoteSDP.receive(t,i,r);t.forEach((O,L)=>{if(l[L].needCreateTransceiver){let M=n.peerConnection.addTransceiver(O._mediaStreamTrack,{direction:"sendonly"});c.push(M),O._updateRtpTransceiver(M)}else{let M=n.peerConnection.getTransceivers().find(B=>B.mid===l[L].mid);if(!M)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(l[L].mid));c.push(M),O._updateRtpTransceiver(M)}}),Ri()&&U("SIMULCAST")===!0&&(yield It(n.applySimulcastForFirefox(c,t)));let d=l.map(O=>O.mid),h=yield It(n.peerConnection.createOffer()),p=n.mungSendOfferSDP(h.sdp,t,d),_=kn(p),E=d.map(O=>{let L=_.mediaDescriptions.find(M=>M.attributes.mid===O);if(!L)throw new Error("Cannot extract ssrc from mediaDescription.");return yM(L,U("USE_PUB_RTX"))}),R=c.map((O,L)=>{let M=d[L];return{localSSRC:E[L],id:M}});yield It(n.peerConnection.setLocalDescription({type:"offer",sdp:p}));try{yield R}catch(O){let L=n.remoteSDP.toString();throw yield It(n.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield It(n.peerConnection.setRemoteDescription({type:"answer",sdp:L})),yield It(n.stopSending(d,!0)),O}yield It(n.applySimulcastEncodings(c,t)),yield It(n.applySendEncodings(c,t));let N=n.remoteSDP.toString();return n.logSDPExchange(p,"offer","local","send")?.(N),yield It(n.setRemoteDescription({type:"answer",sdp:N})),c.map((O,L)=>{let M=d[L];return{localSSRC:E[L],id:M}})}catch(c){throw c instanceof ne?c:new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{s()}})()}async stopSending(t,i){let r=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let n=this.peerConnection.getTransceivers().filter(d=>t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length (".concat(n.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));n.map(d=>{var h;d.direction="inactive",(h=d.stop)===null||h===void 0||h.call(d)});let s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);let l=this.remoteSDP.toString();c?.(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}finally{r&&r()}}async receive(t,i,r,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:s,needExchangeSDP:c}=this.remoteSDP.send(t,i,r,n);if(c){let d=this.remoteSDP.toString(),h=this.logSDPExchange(d,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:d});let p=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(p.sdp,s,t);h?.(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),y.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else y.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));let l=this.peerConnection.getTransceivers().find(d=>d.mid===s);if(!l||l.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,mid:l.mid,transceiver:l}}catch(s){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(t,i,r,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:s,needExchangeSDP:c}=this.remoteSDP.send(t,i,r,n);if(c){let l=this.remoteSDP.toString(),d=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});let h=await this.peerConnection.createAnswer(),p=this.mungReceiveAnswerSDP(h.sdp,s,t);d?.(p||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:p}),y.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else y.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(s){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let i=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});let n=await this.peerConnection.createAnswer();r?.(n.sdp||""),await this.peerConnection.setLocalDescription(n)}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===yh.Auto&&(this.store.p2pTransport=yh.SdRtn,Ot().supportPCSetConfiguration&&this.peerConnection.setConfiguration(km.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Ot().supportPCSetConfiguration&&this.peerConnection.setConfiguration(km.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;let i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:r}=Vd(i.sdp);return this.store.descriptionStart(),this.direction===dn.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===dn.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:r}=Vd(i.sdp);return await this.peerConnection.setLocalDescription(i),r}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let r=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(r.sdp,[i],[t]);this.remoteSDP.updateRecvMedia(t,i);let s=this.remoteSDP.toString(),c=this.logSDPExchange(n,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),c?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ne(k.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,i){let r=this.peerConnection.getTransceivers().filter(n=>n.mid===t);r.length===1&&(this.isVP8Simulcast(i)?Ri()||await this.applySimulcastEncodings(r,[i]):await this.applySendEncodings(r,[i]))}setStatsRemoteVideoIsReady(t,i){this.statsFilter.setVideoIsReady2(t,i)}async replaceTrack(t,i){let r=this.peerConnection.getTransceivers().find(n=>n.mid===i);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let i=t[0].transport.iceTransport,{local:r,remote:n}=i.getSelectedCandidatePair();return{local:Zd(Zd({},tc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Zd(Zd({},tc),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,i;ve(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var i;t.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else y.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n={iceServers:[]};var s;return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(bg(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...km.turnServerConfigToIceServers(t.turnServer.servers,i,r)),U("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...km.turnServerConfigToIceServers(t.turnServer.serversFromGateway,i,r)),ve(s=[yh.Relay,yh.SdRtn]).call(s,i)&&(n.iceTransportPolicy="relay"),U("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(n.iceTransportPolicy="relay")}))),U("ENABLE_ENCODED_TRANSFORM")&&Ot().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),y.debug("P2PConnection p2pTransport is ".concat(i)),n}static turnServerConfigToIceServers(t,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=[],s=t.filter(l=>l.tcpport);y.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(r));let c=s.length>r?s[r]:s[0];switch(i){case yh.SdRtn:let l=t.filter(h=>{var p;return ve(p=h.username).call(p,"glb:")&&h.turnServerURL==h.turnServerURL}),d=l.length>r?l[r]:l[0];d&&(n.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(xd(d.turnServerURL),":").concat(d.tcpport,"?transport=udp")}),n.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(xd(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}));break;case yh.Relay:c&&(n.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),n.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(xd(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;default:c&&(n.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),n.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(xd(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}),n.push({username:c.username,credential:c.password,credentialType:"password",urls:"stun:".concat(c.turnServerURL,":").concat(c.tcpport)}))}return n}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var r;t!=null&&t.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,t.state))},t.onerror=r=>{var n;(n=this.onDTLSTransportError)===null||n===void 0||n.call(this,"error"in r?r.error:r)};let i=t.iceTransport;i&&(i.onstatechange=()=>{let r=t?.iceTransport.state;var n;r&&((n=this.onICETransportStateChange)===null||n===void 0||n.call(this,r))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){let{local:r,remote:n}=i.getSelectedCandidatePair()||{};if(r&&n){let s=r.address+":"+r.port,c=n.address+":"+n.port;y.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Dh(s)),", remote ").concat(JSON.stringify(Dh(c))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,i){var r;if(i||(i=this.peerConnection.getSenders().find(p=>p.track===t._mediaStreamTrack)),!i)return y.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return y.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ot().supportSetRtpSenderParameters)return y.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let n={},s={};switch(t._optimizationMode){case"motion":n.degradationPreference="maintain-framerate";break;case"detail":n.degradationPreference="maintain-resolution";break;default:n.degradationPreference="balanced"}if(t._encoderConfig){var c;let{bitrateMax:p,frameRate:_,scaleResolutionDownBy:E}=t._encoderConfig;p&&(s.maxBitrate=1e3*p),ve(c=t._hints).call(c,qt.LOW_STREAM)&&(_&&(s.maxFramerate=ea(_)),E&&E>=1&&(s.scaleResolutionDownBy=E))}if(U("DSCP_TYPE")&&sl()){var l;let p=U("DSCP_TYPE");ve(l=["very-low","low","medium","high"]).call(l,p)&&(s.networkPriority=p)}let d=i.getParameters(),h=(r=d.encodings)===null||r===void 0?void 0:r[0];Ri()&&!h&&(n.encodings=[s]),h&&Object.assign(h,s),Object.assign(d,n),y.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(d.encodings))),await i.setParameters(d)}async applySendEncodings(t,i){try{if(!Ot().supportSetRtpSenderParameters||t.length!==i.length)return;for(let r=0;r<t.length;r++){let n=t[r],s=i[r];s instanceof ai&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,n.sender)}}catch{y.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,i,r){let n=kn(t);return i.forEach((s,c)=>{let l=r[c],d=n.mediaDescriptions.find(h=>h.attributes.mid===l);d&&(Sm(d,s),wM(d,s,this.store.codec))}),Pd(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,i,r)=>{var n;(n=this.onFirstVideoDecoded)===null||n===void 0||n.call(this,t,i,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,i)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,i)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,i){if(t.length===i.length)for(let d=0;d<t.length;d++){var r,n,s,c,l;let h=t[d],p=i[d];if(p instanceof ai&&!ve(r=p._hints).call(r,qt.LOW_STREAM)&&(n=p._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=p._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){let _={},E={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];let R=h.sender.getParameters();await h.sender.setParameters(Object.assign(R,_))}}}async applySimulcastEncodings(t,i){if(!Ri()&&t.length===i.length)for(let r=0;r<t.length;r++){let n=i[r];if(n instanceof ai&&this.isVP8Simulcast(n)){let s=t[r],c={},l={high:1e3*(n._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];let d=s.sender.getParameters();await s.sender.setParameters(Object.assign(d,c))}}}isVP8Simulcast(t){var i,r,n,s,c;return!!(t instanceof ai&&U("SIMULCAST")&&this.store.codec==="vp8"&&!ve(i=t._hints).call(i,qt.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((n=t._encoderConfig)===null||n===void 0?void 0:n.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((c=t._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(t,i,r,n){if(U("SDP_LOGGING"))return y.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(i," SDP during P2PConnection.").concat(n,`
`),t),i==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",n)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(c=>{c.direction="inactive"});let r=await this.peerConnection.createOffer(),n=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);let s=this.remoteSDP.toString();n?.(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async c=>{c.direction="sendonly"});let r=await this.peerConnection.createOffer(),n=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);let s=this.remoteSDP.toString();n?.(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(t,i){var r;if(i=i??((r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp)){var n;return((n=kn(i).mediaDescriptions.find(c=>c.attributes.mid===t))===null||n===void 0?void 0:n.attributes.ssrcs)?.[0].ssrcId}}async setRemoteDescription(t){var i;await this.peerConnection.setRemoteDescription(t),ve(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,i,r){let n=kn(t),s=n.mediaDescriptions.find(c=>c.attributes.mid===i);return s&&r===Le.AUDIO&&s.media.mediaType==="audio"&&Tm(s),Pd(n)}},Be(si.prototype,"establish",[Ns],Object.getOwnPropertyDescriptor(si.prototype,"establish"),si.prototype),Be(si.prototype,"connect",[Ns],Object.getOwnPropertyDescriptor(si.prototype,"connect"),si.prototype),Be(si.prototype,"receive",[Ns],Object.getOwnPropertyDescriptor(si.prototype,"receive"),si.prototype),Be(si.prototype,"mockReceive",[Ns],Object.getOwnPropertyDescriptor(si.prototype,"mockReceive"),si.prototype),Be(si.prototype,"stopReceiving",[Ns],Object.getOwnPropertyDescriptor(si.prototype,"stopReceiving"),si.prototype),Be(si.prototype,"restartICE",[Ns],Object.getOwnPropertyDescriptor(si.prototype,"restartICE"),si.prototype),Be(si.prototype,"close",[Ns],Object.getOwnPropertyDescriptor(si.prototype,"close"),si.prototype),Be(si.prototype,"updateEncoderConfig",[Ns],Object.getOwnPropertyDescriptor(si.prototype,"updateEncoderConfig"),si.prototype),Be(si.prototype,"updateSendParameters",[Ns],Object.getOwnPropertyDescriptor(si.prototype,"updateSendParameters"),si.prototype),Be(si.prototype,"replaceTrack",[Ns],Object.getOwnPropertyDescriptor(si.prototype,"replaceTrack"),si.prototype),Be(si.prototype,"muteLocal",[Ns],Object.getOwnPropertyDescriptor(si.prototype,"muteLocal"),si.prototype),Be(si.prototype,"unmuteLocal",[Ns],Object.getOwnPropertyDescriptor(si.prototype,"unmuteLocal"),si.prototype),si);function Ns(e,t,i){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let n=this.mutex,s=await n.lock("From P2PConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await r.apply(this,l)}finally{s()}},i}let po=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({});var MV,xV,UV,VV,BV,jV,FV,GV,HV,WV,zV,mi;function KV(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function Ty(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?KV(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):KV(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let E7=(MV=fo(po.SEND_ONLY),xV=fo(po.SEND_ONLY),UV=fo(),VV=fo(po.RECEIVE_ONLY),BV=fo(po.RECEIVE_ONLY),jV=fo(po.RECEIVE_ONLY),FV=fo(po.RECEIVE_ONLY),GV=fo(po.RECEIVE_ONLY),HV=fo(po.RECEIVE_ONLY),WV=fo(),zV=fo(po.RECEIVE_ONLY),mi=class extends Ei{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(ze.StateChange,t,this._state)}constructor(e,t){super(),D(this,"isPlanB",!1),D(this,"store",void 0),D(this,"statsUploader",void 0),D(this,"sendConnection",void 0),D(this,"recvConnection",void 0),D(this,"localTrackMap",new Map),D(this,"remoteUserMap",new Map),D(this,"localDataChannels",[]),D(this,"pendingLocalTracks",[]),D(this,"pendingRemoteTracks",[]),D(this,"statsCollector",void 0),D(this,"dtlsFailedCount",0),D(this,"sendMutex",void 0),D(this,"recvMutex",void 0),D(this,"_state",jt.Disconnected),D(this,"_restartStates",["disconnected","failed"]),D(this,"reconnectInterval",void 0),D(this,"uploadUnplinkStarted",!1),D(this,"uploadDownlinkStarted",!1),D(this,"uplinkStateUploadInterval",void 0),D(this,"downlinkStatsUploadInterval",void 0),D(this,"handleMuteLocalTrack",async(i,r,n)=>{let s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==jt.Connected)return void n(new ne(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let d=this.filterTobeMutedTracks(i);if(d.length===0)return void r();let h=d.find(R=>R[0]==="videoLowTrack");h&&h[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(d.map(R=>{let[,{id:N}]=R;return N}));let p=!1;var c,l;i.trackMediaType==="video"?p=!((c=this.localTrackMap.get(me.LocalAudioTrack))===null||c===void 0||!c.track._muted):p=((l=this.localTrackMap.get(me.LocalVideoTrack))===null||l===void 0?void 0:l.id)===void 0;let _=this.createMuteMessage(d);await Jt(this,ze.RequestMuteLocal,_);let E=i.trackMediaType==="video"?Md.MUTE_LOCAL_VIDEO:Md.MUTE_LOCAL_AUDIO;await Jt(this,ze.RequestP2PMuteLocal,{action:E,message:_,isMuteAll:p}),r()}catch(d){n(d)}finally{s()}}),D(this,"handleUnmuteLocalTrack",async(i,r,n)=>{let s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==jt.Connected)return void n(new ne(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let c=this.filterTobeUnmutedTracks(i);if(c.length===0)return void r();await this.sendConnection.unmuteLocal(c.map(h=>{let[,{id:p}]=h;return p}));let l=this.createUnmuteMessage(c),d=i.trackMediaType==="video"?Md.UNMUTE_LOCAL_VIDEO:Md.UNMUTE_LOCAL_AUDIO;await Jt(this,ze.RequestP2PMuteLocal,{action:d,message:l}),r()}catch(c){n(c)}finally{s()}}),D(this,"handleUpdateVideoEncoder",async(i,r,n,s)=>{let c;typeof s=="boolean"&&s||(c=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{let d=this.localTrackMap.get(me.LocalVideoTrack);if(!this.sendConnection||!d||d.track!==i||this.state!==jt.Connected)return void r();let{id:h,track:p}=d;h&&(await this.sendConnection.updateSendParameters(h,p),await this.sendConnection.updateEncoderConfig(h,p),this.emit(ze.UpdateVideoEncoder,p)),r()}catch(d){n(d)}finally{var l;(l=c)===null||l===void 0||l()}}),D(this,"handleUpdateVideoSendParameters",async(i,r,n)=>{let s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let c=this.localTrackMap.get(me.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==i||this.state!==jt.Connected)return void r();let{id:l,track:d}=c;l&&await this.sendConnection.updateSendParameters(l,d),r()}catch(c){n(c)}finally{s()}}),D(this,"handleReplaceTrack",async(i,r,n,s)=>{let c;y.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var l;let h=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:_}]=p;return i===_});if(!this.sendConnection||!h||h[1].id===void 0||this.state!==jt.Connected)return void r();if(await((l=this.sendConnection)===null||l===void 0?void 0:l.replaceTrack(i,h[1].id)),h[0]===me.LocalVideoTrack&&Ot().supportDualStreamEncoding){let p=this.localTrackMap.get(me.LocalVideoLowTrack);if(p){let _=i._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=_,p.track._originMediaStreamTrack=_,await new we((E,R)=>{this.handleReplaceTrack(p.track,E,R,!0)})}}r()}catch(h){n(h)}finally{var d;(d=c)===null||d===void 0||d()}}),D(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),D(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),D(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),D(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new dx(e),this.bindStatsUploaderEvents(),this.sendMutex=new Lr("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Lr("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},U("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let i;try{if(t){this.recvConnection&&(y.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new kV(e,this.store,dn.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=jt.New,this.sendConnection&&(y.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new kV(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let r=await this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new ne(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=jt.Connected}async addRemoteCandidate(e,t){if(t===dn.RECEIVE_ONLY){if(!this.sendConnection)throw new ne(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new ne(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,i){var r=this;return ja(function*(){let n=yield It(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==jt.Connected){r.throwIfTrackTypeNotMatch(e);let h=e.filter(p=>r.pendingLocalTracks.indexOf(p)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(h))}r.store.pubId=r.store.pubId+1,Ur.markPublishStart(r.store.clientId,r.store.pubId);let s=r.filterTobePublishedTracks(e,t,i);if(s.length===0)return void(yield It(r.tryToUnmuteAudio(e)));s.forEach(h=>{let{track:p,type:_}=h,E=Date.now();r.store.publish(p.getTrackId(),_===me.LocalAudioTrack?"audio":"video",E)}),r.bindLocalTrackEvents(s);let c=yield It(r.sendConnection.send(s.map(h=>{let{track:p}=h;return p}),r.store.codec,r.store.audioCodec)),l=(yield It(c.next())).value,d=r.createGatewayPublishMessage(s,l);try{yield d}catch(h){throw c.throw(h),h?.code===k.WS_ABORT&&s.forEach(p=>{let{track:_}=p;r.pendingLocalTracks.indexOf(_)===-1&&r.pendingLocalTracks.push(_)}),r.unbindLocalTrackEvents(s),h}yield It(c.next()),s.forEach(h=>{let{type:p}=h;r.statsCollector.addLocalStats(p)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(s,l),s.forEach(h=>{let{track:p,type:_}=h,E=Date.now();r.store.publish(p.getTrackId(),_===me.LocalAudioTrack?"audio":"video",void 0,E)}),r.startUploadUplinkState()}finally{n()}})()}async unpublish(e){if(!this.sendConnection||this.state!==jt.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(n=>!ve(e).call(e,n)));let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let i=t.find(n=>n[0]==="videoLowTrack");i&&i[1].track.close();let r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(n=>{let[,{id:s}]=n;return s})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(n=>{let[s,{track:c}]=n;return{type:s,track:c}})),t.forEach(n=>{let[s]=n;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===jt.Connected)return i&&i[1].track.close(),r;e.forEach(n=>{let s=this.pendingLocalTracks.indexOf(n);s!==-1&&this.pendingLocalTracks.splice(s,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let t=[],i=[];Array.from(this.localTrackMap.entries()).forEach(r=>{let[n,{track:s,ssrcs:c}]=r,l={stream_type:cG(s,n),ssrcs:c};s._muted||!s._enabled?t.push(l):i.push(l)}),t.length>0&&t.forEach(r=>{Jt(this,ze.RequestMuteLocal,[r])}),i.length>0&&i.forEach(r=>{Jt(this,ze.RequestUnmuteLocal,[r])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return ja(function*(){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(y.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Cr(this,ze.RequestRePublish,this.pendingLocalTracks),this.emit(ze.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,i,r){var n;if(!this.recvConnection)throw new ne(k.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((n=this.remoteUserMap.get(e))!==null&&n!==void 0&&n.has(t))return;let{track:s,mid:c,transceiver:l}=await this.recvConnection.receive(t,[{ssrcId:i}],String(e.uid),r);t===Le.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(s):(e._audioTrack=new um(s,e.uid,e._uintid,this.store),y.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),l&&e._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(s):(e._videoTrack=new dm(s,e.uid,e._uintid,this.store),y.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),l&&e._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._videoTrack));let d=this.remoteUserMap.get(e);d?d.set(t,c):this.remoteUserMap.set(e,new Map([[t,c]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let h=this.pendingRemoteTracks.findIndex(p=>{let{user:_,kind:E}=p;return _.uid===e.uid&&t===E});h!==-1&&(this.pendingRemoteTracks.splice(h,1),this.emit(ze.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,i,r){if(!this.recvConnection)throw new ne(k.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:i}],String(e.uid),r)}async unsubscribe(e,t,i){let r=this.pendingRemoteTracks.filter(s=>{let{user:c,kind:l}=s;return t!==void 0?c.uid===e.uid&&t===l:c.uid===e.uid});if(r.forEach(s=>{let c=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(c,1)}),this.recvConnection||i||r.forEach(s=>{let{kind:c}=s;var l;if(c===Le.AUDIO)(l=e._audioTrack)===null||l===void 0||l._destroy(),e._audioTrack=void 0;else if(c===Le.VIDEO){var d;(d=e._videoTrack)===null||d===void 0||d._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;let n=this.filterTobeUnSubscribedTracks(e,t);n.length!==0&&(await this.recvConnection.stopReceiving(n.map(s=>{let[,{id:c}]=s;return c})),this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),n.forEach(s=>{let[c,{kind:l}]=s;var d,h;if(l===Le.VIDEO&&c._videoSSRC&&((d=this.recvConnection)===null||d===void 0||d.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===Le.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),i||((h=c._videoTrack)===null||h===void 0||h._destroy(),c._videoTrack=void 0);else if(l===Le.AUDIO){var p;this.unbindRemoteTrackEvents(c._audioTrack),!i&&((p=c._audioTrack)===null||p===void 0||p._destroy(),c._audioTrack=void 0)}}),n.forEach(s=>{let[,{kind:c}]=s;Jt(this,ze.RequestP2PMuteRemote,c)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,i]=t;[Le.VIDEO,Le.AUDIO].forEach(r=>{i.has(r)?Jt(this,ze.RequestP2PUnmuteRemote,r):Jt(this,ze.RequestP2PMuteRemote,r)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new ne(k.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;let i=this.remoteUserMap.get(e);if(!i)return void y.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(t))return void y.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let r=t===Le.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;let i=this.remoteUserMap.get(e);if(!i)return void y.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(t)||y.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(me.LocalAudioTrack);if(t?.track instanceof qi){let i=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[n]=r;return n!==me.LocalAudioTrack}).filter(r=>{let[n]=r;return!(e&&n===me.LocalVideoLowTrack)}).map(r=>{let[,{track:n}]=r;return n}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return!(e&&r===me.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r})}reportPublishEvent(e,t,i,r,n){if(e){let c=this.localTrackMap.get(me.LocalAudioTrack),l=r?this.localTrackMap.get(me.LocalVideoLowTrack):this.localTrackMap.get(me.LocalVideoTrack);Fe.publish(this.store.sessionId,{eventElapse:Ur.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c?.track.getTrackLabel(),videoName:l?.track.getTrackLabel(),screenshare:l?.track._hints.indexOf(qt.SCREEN_TRACK)!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:n})}else{var s;i||(i=[]);let c=i.find(d=>d instanceof Ai),l=r?(s=this.localTrackMap.get(me.LocalVideoTrack))===null||s===void 0?void 0:s.track:i.find(d=>d instanceof ai);Fe.publish(this.store.sessionId,{eventElapse:Ur.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c?.getTrackLabel(),videoName:l?.getTrackLabel(),screenshare:l?._hints.indexOf(qt.SCREEN_TRACK)!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:n})}}reportSubscribeEvent(e,t,i,r){let n=r===Le.VIDEO?i._videoSSRC:i._audioSSRC;n&&Fe.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Le.VIDEO,audio:r===Le.AUDIO,peerid:i.uid,subscribeRequestid:r===Le.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ur.measureFromSubscribeStart(this.store.clientId,n)})}reset(){y.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Lr("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Lr("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(me.LocalAudioTrack);if(e?.track instanceof qi){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(i=>{t.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=jt.Disconnected}getStats(e){var t,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(me.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(me.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof ai||t&&t.track instanceof Ai?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}getRemoteMedia(e){var t;let i=Array.from(Mn(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[r]=i;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(me.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=ct(e).call(e,(i,r)=>i.level-r.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(y.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=jt.Reconnecting,U("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var i;t._videoTrack&&t._videoTrack._player&&((i=t._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[i,{track:r}]=e;switch(i){case me.LocalVideoTrack:ve(t=r._hints).call(t,qt.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case me.LocalAudioTrack:r instanceof qi?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case me.LocalVideoLowTrack:}}),this.emit(ze.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;Array.from(Mn(i).call(i)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(ze.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),y.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(let i of this.pendingRemoteTracks){let{user:r,kind:n}=i;if((e instanceof Gd?e.uid:e)===r.uid&&t===n)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let i,r;if(e===dn.SEND_ONLY){if(!this.sendConnection)throw new ne(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new ne(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){let n=await r.restartICE(t);return r.isInRestartIce=!1,n}{let n=await r.restartICE();if(n){let s=await Cr(this,ze.RequestP2PRestartICE,{direction:dn.RECEIVE_ONLY,iceParameter:n});await r.restartICE(s),r.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),t=this.localTrackMap.get(me.LocalVideoTrack),i=this.localTrackMap.get(me.LocalAudioTrack),r=e.videoSend.find(R=>{var N;return R.ssrc===(t==null||(N=t.ssrcs)===null||N===void 0?void 0:N[0].ssrcId)}),n=e.audioSend.find(R=>{var N;return R.ssrc===(i==null||(N=i.ssrcs)===null||N===void 0?void 0:N[0].ssrcId)});if(!r||!n)return 1;let s=fa(this,ze.NeedSignalRTT),c=r?r.rttMs:void 0,l=n?n.rttMs:void 0,d=c&&l?(c+l)/2:c||l,h=(d&&s?(d+s)/2:d||s)||0,p=100*e.sendPacketLossRate*.7/50+.3*h/1500,_=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,E=t?.track;if(E&&E._encoderConfig&&E._hints.indexOf(qt.SCREEN_TRACK)===-1){let R=E._encoderConfig.bitrateMax,N=e.bitrate.actualEncoded;if(R&&N){let w=(1e3*R-N)/(1e3*R);return eM[w<.15?0:w<.3?1:w<.45?2:w<.6?3:4][_]}}return _}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[r]=i,n=r._audioSSRC,s=r._videoSSRC,c=e.audioRecv.find(N=>N.ssrc===n),l=e.videoRecv.find(N=>N.ssrc===s);if(!c&&!l)return void(t+=1);let d=fa(this,ze.NeedSignalRTT),h=e.rtt,p=(h&&d?(h+d)/2:h||d)||0,_=c?c.jitterMs:void 0,E=e.recvPacketLossRate,R=.7*E*100/50+.3*p/1500;_&&(R=.6*E*100/50+.2*p/1500+.2*_/400),t+=R<.1?1:R<.17?2:R<.36?3:R<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new we((t,i)=>{this.handleMuteLocalTrack(e,t,i)})}filterTobePublishedTracks(e,t,i){let r=[],n=Ot(),s=this.getAllTracks();e=Zf(e=e.filter(d=>s.indexOf(d)===-1));let c=!1,l=!1;for(let d of e){if(d instanceof ai&&(this.localTrackMap.has(me.LocalVideoTrack)||c?new ne(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:d,type:me.LocalVideoTrack}),c=!0),t)){let h=this.getLowVideoTrack(d,i);r.push({track:h,type:me.LocalVideoLowTrack})}if(d instanceof Ai){let h=this.localTrackMap.get(me.LocalAudioTrack);if(h){if(!(h.track instanceof qi))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0)}else if(l){let p=r.find(_=>{let{type:E}=_;return E===me.LocalAudioTrack});if(!(p.track instanceof qi))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(d)}else{if(!n.webAudioMediaStreamDest||d instanceof qi||d._bypassWebAudio)r.push({track:d,type:me.LocalAudioTrack});else{let p=new qi;p.addAudioTrack(d),r.push({track:p,type:me.LocalAudioTrack})}l=!0}}}return r}filterTobeUnpublishedTracks(e){let t=[],i=this.getAllTracks();e=Zf(e=e.filter(r=>i.indexOf(r)!==-1));for(let r of e){if(r instanceof Ai){let n=this.localTrackMap.get(me.LocalAudioTrack);if(!n)continue;n.track instanceof qi?(n.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),n.track.trackList.length===0&&(t.push([me.LocalAudioTrack,n]),n.track.close())):t.push([me.LocalAudioTrack,n])}if(r instanceof ai){let n=this.localTrackMap.get(me.LocalVideoTrack);if(!n)continue;t.push([me.LocalVideoTrack,n]);let s=this.localTrackMap.get(me.LocalVideoLowTrack);s&&t.push([me.LocalVideoLowTrack,s])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:i,type:r}=t;switch(r){case me.LocalVideoTrack:i.addListener(xe.GET_STATS,this.handleGetLocalVideoStats),i.addListener(xe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(xe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(xe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(xe.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(xe.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(xe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(xe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case me.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case me.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof qi?e.trackList.forEach(i=>{i.addListener(xe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(xe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(xe.GET_STATS,this.handleGetLocalAudioStats),i.addListener(xe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(xe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(xe.GET_STATS,this.handleGetLocalAudioStats),e.addListener(xe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(xe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(xe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(xe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(xe.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[i,{track:r}]=t;return{track:r,type:i}})),e.forEach(t=>{let{track:i,type:r}=t;switch(r){case me.LocalVideoTrack:i.off(xe.GET_STATS,this.handleGetLocalVideoStats),i.off(xe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(xe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(xe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(xe.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(xe.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(xe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(xe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case me.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case me.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof qi?e.trackList.forEach(t=>{t.off(xe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(xe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(xe.GET_STATS,this.handleGetLocalAudioStats),t.off(xe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(xe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(xe.GET_STATS,this.handleGetLocalAudioStats),e.off(xe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(xe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(xe.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(xe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(xe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof dm&&t.addListener(xe.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),t instanceof um&&t.addListener(xe.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(xe.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;i.has(Le.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),i.has(Le.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((i,r)=>{var n;let s,{track:c,type:l}=i;switch(l){case me.LocalAudioTrack:s=Ft.Audio;break;case me.LocalVideoTrack:s=ve(n=c._hints).call(n,qt.SCREEN_TRACK)?Ft.Screen:Ft.High;break;case me.LocalVideoLowTrack:s=Ft.Low}return{kind:l===me.LocalAudioTrack?Le.AUDIO:Le.VIDEO,stream_type:s,mid:t[r].id,ssrcs:t[r].localSSRC,isMuted:c.muted||!c.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var i;let r,[n,{track:s,ssrcs:c,id:l}]=t;switch(n){case me.LocalVideoTrack:r=ve(i=s._hints).call(i,qt.SCREEN_TRACK)?Ft.Screen:Ft.High;break;case me.LocalAudioTrack:r=Ft.Audio;break;case me.LocalVideoLowTrack:r=Ft.Low}return{stream_type:r,ssrcs:c,mid:l}})}assignLocalTracks(e,t){e.forEach((i,r)=>{let{track:n,type:s}=i;this.localTrackMap.set(s,{track:n,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[i]=t;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var i;y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(ze.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),ve(i=this._restartStates).call(i,t)&&!e.isInRestartIce&&(t==="disconnected"&&await fr(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Fe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:pi.TRACER}).onSuccess(),this.emit(ze.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var i;let r=Array.from(Mn(i=this.remoteUserMap).call(i)).find(s=>s._audioSSRC===t);var n;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(n=r.audioTrack)===null||n===void 0||n.emit(Ha.FIRST_FRAME_DECODED),Fe.firstRemoteFrame(this.store.sessionId,er.FIRST_AUDIO_DECODE,ui.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Ur.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var i;let r=Array.from(Mn(i=this.remoteUserMap).call(i)).find(n=>n._audioSSRC===t);r&&Fe.firstRemoteFrame(this.store.sessionId,er.FIRST_AUDIO_RECEIVED,ui.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Ur.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,i,r)=>{this.reportVideoFirstFrameDecoded(t,i,r)},e.onFirstVideoReceived=t=>{var i;let r=Array.from(Mn(i=this.remoteUserMap).call(i)).find(n=>n._videoSSRC===t);r&&Fe.firstRemoteFrame(this.store.sessionId,er.FIRST_VIDEO_RECEIVED,ui.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Ur.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,i)=>{let r=t.candidateType==="relay",n=i.candidateType==="relay";i.candidateType!=="unknown"&&r===n||this.emit(ze.ConnectionTypeChange,r),y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ud(i))," -> ").concat(JSON.stringify(Ud(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,i)=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ud(i))," -> ").concat(JSON.stringify(Ud(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(ze.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){let t=e===dn.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,y.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===dn.SEND_ONLY?this.restartICE(e):Cr(this,ze.RequestP2PRestartICE,{direction:dn.SEND_ONLY}))}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let i=this.localTrackMap.get(me.LocalAudioTrack);if(e instanceof Ai&&i?.track instanceof qi)return i.track.isActive||t.push([me.LocalAudioTrack,i]),t;let r=Array.from(this.localTrackMap.entries()).find(n=>{let[,{track:s}]=n;return e===s});if(r&&(t.push(r),r[0]===me.LocalVideoTrack)){let n=this.localTrackMap.get(me.LocalVideoLowTrack);n&&t.push([me.LocalVideoLowTrack,n])}return t}filterTobeUnmutedTracks(e){let t=[],i=this.localTrackMap.get(me.LocalAudioTrack);if(e instanceof Ai&&i?.track instanceof qi)return i.track.isActive&&t.push([me.LocalAudioTrack,i]),t;let r=Array.from(this.localTrackMap.entries()).find(n=>{let[,{track:s}]=n;return e===s});if(r)if(r[0]===me.LocalVideoTrack){t.push(r);let n=this.localTrackMap.get(me.LocalVideoLowTrack);n&&t.push([me.LocalVideoLowTrack,n])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var i;let r,[n,{track:s,ssrcs:c,id:l}]=t;switch(n){case me.LocalAudioTrack:r=Ft.Audio;break;case me.LocalVideoTrack:r=ve(i=s._hints).call(i,qt.SCREEN_TRACK)?Ft.Screen:Ft.High;break;case me.LocalVideoLowTrack:r=Ft.Low}return{stream_type:r,ssrcs:c,mid:l}})}createUnmuteMessage(e){return e.map(t=>{var i;let r,[n,{track:s,ssrcs:c,id:l}]=t;switch(n){case me.LocalAudioTrack:r=Ft.Audio;break;case me.LocalVideoTrack:r=ve(i=s._hints).call(i,qt.SCREEN_TRACK)?Ft.Screen:Ft.High;break;case me.LocalVideoLowTrack:r=Ft.Low}return{stream_type:r,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(e,t){let i=[],r=this.remoteUserMap.get(e);if(!r)return i;if(t){let n=r.get(t);if(!n)return i;i.push([e,{kind:t,id:n}])}else Array.from(r.entries()).forEach(n=>{let[s,c]=n;i.push([e,{kind:s,id:c}])});return i}createUnsubscribeMessage(e){let t=[];return e.forEach(i=>{let[r,{kind:n,id:s}]=i;switch(n){case Le.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Le.VIDEO,ssrcId:r._videoSSRC}));case Le.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Le.AUDIO,ssrcId:r._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[i,{kind:r}]=t,n=this.remoteUserMap.get(i);n&&(n.delete(r),Array.from(n.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(me.LocalVideoTrack),i=this.localTrackMap.get(me.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new we((r,n)=>{this.handleUpdateVideoEncoder(t.track,r,n,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new we((r,n)=>{this.handleUpdateVideoEncoder(i.track,r,n,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Ai){let i=this.filterTobeUnmutedTracks(e[t]);if(i.length===0)continue;let r=this.createUnmuteMessage(i);return void await Jt(this,ze.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(ze.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(ze.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await fr(ZA(this.dtlsFailedCount,Wi)),this.emit(ze.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(me.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof ai)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof ai).length>1)throw new ne(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Ai).length>1&&(e.some(t=>t instanceof Ai&&t._bypassWebAudio)||!Ot().webAudioMediaStreamDest))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof ai&&this.pendingLocalTracks.some(i=>i instanceof ai))throw new ne(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Ai&&this.pendingLocalTracks.some(i=>i instanceof Ai)&&(!Ot().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Ai&&i._bypassWebAudio)))throw new ne(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let i=!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ot().supportDualStreamEncoding,r=Ty(Ty({},{width:160,height:120,framerate:15,bitrate:50}),t),n;n=i?e._mediaStreamTrack.clone():pI(e,r);let s=Zt(8,"track-low-"),c=new ai(n,Ty(Ty({},i&&{scaleResolutionDownBy:Yw(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,s);return c.on(Ch.TRANSCEIVER_UPDATED,l=>{e._updateRtpTransceiver(l,nm.LOW_STREAM)}),c._hints.push(qt.LOW_STREAM),e.addListener(xe.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,i,r){var n;let s=Array.from(Mn(n=this.remoteUserMap).call(n)).find(c=>c._videoSSRC===e);if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());let c=this.store.keyMetrics,l=c.subscribe.find(d=>d.userId===s.uid&&d.type==="video");Fe.firstRemoteVideoDecode(this.store.sessionId,er.FIRST_VIDEO_DECODE,ui.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:i,subscribeElapse:Ur.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:l?.subscribeEnd||0,subscriberStart:l?.subscribeStart||0,videoAddNotify:l?.streamAdded||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,i){if(!this.recvConnection)return!1;let r=this.remoteUserMap.get(e);if(!r)return!1;let n=r.get(t);if(!n)return!1;let s=await this.recvConnection.getRemoteSSRC(n);return s!==void 0&&s!==i}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new ne(k.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new ne(k.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new ne(k.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new ne(k.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new ne(k.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new ne(k.NOT_SUPPORTED)}async preConnect(e){throw new ne(k.NOT_SUPPORTED)}getEstablishParams(){throw new ne(k.NOT_SUPPORTED)}async reSubscribe(e){throw new ne(k.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new ne(k.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:i}]=e;t===me.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,nm.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},Be(mi.prototype,"p2pConnect",[MV],Object.getOwnPropertyDescriptor(mi.prototype,"p2pConnect"),mi.prototype),Be(mi.prototype,"unpublish",[xV],Object.getOwnPropertyDescriptor(mi.prototype,"unpublish"),mi.prototype),Be(mi.prototype,"unpublishLowStream",[UV],Object.getOwnPropertyDescriptor(mi.prototype,"unpublishLowStream"),mi.prototype),Be(mi.prototype,"subscribe",[VV],Object.getOwnPropertyDescriptor(mi.prototype,"subscribe"),mi.prototype),Be(mi.prototype,"mockSubscribe",[BV],Object.getOwnPropertyDescriptor(mi.prototype,"mockSubscribe"),mi.prototype),Be(mi.prototype,"unsubscribe",[jV],Object.getOwnPropertyDescriptor(mi.prototype,"unsubscribe"),mi.prototype),Be(mi.prototype,"muteRemote",[FV],Object.getOwnPropertyDescriptor(mi.prototype,"muteRemote"),mi.prototype),Be(mi.prototype,"unmuteRemote",[GV],Object.getOwnPropertyDescriptor(mi.prototype,"unmuteRemote"),mi.prototype),Be(mi.prototype,"hasRemoteMediaWithLock",[HV],Object.getOwnPropertyDescriptor(mi.prototype,"hasRemoteMediaWithLock"),mi.prototype),Be(mi.prototype,"disconnectForReconnect",[WV],Object.getOwnPropertyDescriptor(mi.prototype,"disconnectForReconnect"),mi.prototype),Be(mi.prototype,"remoteMediaSsrcChanged",[zV],Object.getOwnPropertyDescriptor(mi.prototype,"remoteMediaSsrcChanged"),mi.prototype),mi);function fo(e){return function(t,i,r){let n=t[i];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];switch(e){case po.SEND_ONLY:{let d=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await n.apply(this,c)}finally{d()}}case po.RECEIVE_ONLY:{let d=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await n.apply(this,c)}finally{d()}}default:{let d=await this.sendMutex.lock("From P2PChannel2.".concat(i)),h=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await n.apply(this,c)}finally{d(),h()}}}},r}}class Gh extends Ei{constructor(t,i){super(),D(this,"signal",void 0),D(this,"token",void 0),D(this,"tokenTimeout",void 0),D(this,"tokenInterval",void 0),D(this,"_sequence",0),D(this,"userMap",new Map),D(this,"encoder",new TextEncoder),this.signal=t,this.token=i;let r=()=>{this.signal.connectionState===ni.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*U("P2P_TOKEN_INTERVAL"))};r()}async send(t,i,r,n,s){var c;if(this.userMap.size===0)return;let l=Array.from(Sn(c=this.userMap).call(c))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),n=n??Zt(6,""),s=s??this._sequence++;let d={_id:n,_type:t,_seq:s,_message:i,token:"".concat(this.token,"_").concat(l)};U("SHOW_P2P_LOG")&&y.debug("send message",d,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(d)).forEach(p=>{this.signal.request(Je.DATA_STREAM,{payload:Dd(this.encoder.encode(p))})});let h=new we((p,_)=>{let E=window.setTimeout(()=>{this.off("res-@".concat(n,"_ack"),R),this.off("res-@".concat(n),w),this.off(_m.ABORT,N),y.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(n)),this.userMap.size===0?_(new ne(k.INVALID_REMOTE_USER)):_(new ne(k.TIMEOUT))},U("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),R=()=>{E&&window.clearTimeout(E),this.off(_m.ABORT,N),r&&p()},N=()=>{E&&window.clearTimeout(E),this.off("res-@".concat(n,"_ack"),R),this.off("res-@".concat(n),w),_(new ne(k.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(n)))};this.once(_m.ABORT,N),this.once("res-@".concat(n,"_ack"),R);let w=(L,M)=>{O=!0,E&&window.clearTimeout(E),this.off("res-@".concat(n,"_ack"),R),this.off(_m.ABORT,N),L==="success"?p(M):_(new ne(k.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(n)))},O=!1;r||(this.once("res-@".concat(n),w),fr(U("SIGNAL_REQUEST_TIMEOUT")).then(()=>{O||y.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(n,", ").concat(d))}))});try{return await h}catch(p){if(p.code===k.TIMEOUT)return await this.send(t,i,r,n,s);throw p}}onMessage(t){var i;let{_uid:r}=t,n,s=this.userMap.get(r);if(s)n=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==xi.CHECK)return;let{token:h}=t;n=new Map,s={uid:r,isStart:!0,token:h,splitMessageMap:n,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,s),this.signal.emit(vt.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in t&&"total"in t){var c;let{id:h,total:p}=t,_=(c=n.get(h))!==null&&c!==void 0?c:[];if(_.push(t),n.has(h)||n.set(h,_),_.length!==p)return;{let E=ct(_).call(_,(R,N)=>R.index-N.index).map(R=>R.payload).join("");n.delete(h),(t=JSON.parse(E))._uid=r}}let{_type:l,token:d}=t;if(ve(i=[xi.ACK,xi.CHECK]).call(i,l))return l===xi.CHECK&&this.handleCheckToken(s,d),void this.receiveMessage(t);d==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(t):y.debug('Receive unexpected message", '.concat(d,", cur_token: ").concat(s.token,"_").concat(this.token),t)}check(){let t={_id:Zt(6,""),token:this.token,_type:xi.CHECK};U("SHOW_P2P_LOG")&&y.debug("send message",t),this.signal.request(Je.DATA_STREAM,{payload:Dd(this.encoder.encode(JSON.stringify(t)))})}ack(t){let i={_id:t,_type:xi.ACK,token:this.token};U("SHOW_P2P_LOG")&&y.debug("send message",i),this.signal.request(Je.DATA_STREAM,{payload:Dd(this.encoder.encode(JSON.stringify(i)))})}response(t,i,r){this.send(xi.RESPONSE,JSON.stringify({success:!r,message:i}),!0,t)}handleReceivedMessage(t){let i=()=>{this.userMap.forEach(h=>{let{receivedMessagesMap:p,nextExpectedSequenceNumber:_}=h;for(;p.has(_);){let E=p.get(_);p.delete(_),this.receiveMessage(E),h.nextExpectedSequenceNumber++}})};if(!t)return void i();let{_uid:r,_seq:n}=t,s=this.userMap.get(r),{receivedMessagesMap:c,isStart:l,nextExpectedSequenceNumber:d}=s;if(n<d)return this.ack(t._id),void y.debug("[external-signal] receive old message, seq: ".concat(n,", ").concat(t._message));c.set(n,t),l&&n===d&&(this.receiveMessage(t),c.delete(d),s.nextExpectedSequenceNumber++,i())}receiveMessage(t){let{_id:i,_type:r,_message:n,_uid:s}=t;if(U("SHOW_P2P_LOG")&&y.debug("receive message",t),i){let c;switch(t._type!==xi.ACK&&(n&&(c=JSON.parse(n)),this.ack(t._id)),t._type){case xi.CANDIDATE:case xi.CONTROL:this.signal.emit(r,c,s);break;case xi.PUBLISH:case xi.UNPUBLISH:case xi.RESTART_ICE:case xi.CALL:c.uid=s,Cr(this.signal,r,c).then(l=>{this.response(t._id,l)}).catch(()=>{this.response(t._id,void 0,!0)});break;case xi.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case xi.RESPONSE:{let{success:l,message:d}=c;this.emit("res-@".concat(i),l?"success":"failed",d);break}}}}splitMessage(t){if(t.length<Gh.MAX_MESSAGE_SIZE)return[t];let i=[],{remoteToken:r}=JSON.parse(t),n=Zt(6,""),s=0,c=800,l=Math.ceil(t.length/c);for(;t.length>0;){s++;let d={id:n,index:s,total:l,payload:t.slice(0,c),token:"".concat(this.token,"_").concat(r)};JSON.stringify(d).length>Gh.MAX_MESSAGE_SIZE?c-=50:(i.push(d),t=t.slice(c))}return i.map(d=>JSON.stringify(d))}handleCheckToken(t,i){return t.token!==i?(y.debug("token changed, from ".concat(t.token," to ").concat(i)),this.reset(t.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{y.debug("token timeout, ".concat(i)),this.reset(t.uid)},U("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let t=await Cr(this.signal,xi.CALL,void 0),i=await this.send(xi.CALL,t);this.signal.emit(nt.P2P_CONNECTION,i,!0)}async reset(t,i){let r=this.userMap.get(t);r&&(this.emit(_m.ABORT),this.signal.emit(vt.ON_USER_OFFLINE,{uid:r.uid,reason:x9.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(y.debug("change local token from ".concat(i," to ").concat(i)),this.token=Zt(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(_m.ABORT)}}D(Gh,"MAX_SIZE",1),D(Gh,"MAX_MESSAGE_SIZE",1024);class g7 extends Ei{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===ni.CONNECTED?this.emit(nt.WS_CONNECTED):t===ni.RECONNECTING?this.emit(nt.WS_RECONNECTING,this._websocketReconnectReason):t===ni.CLOSED&&this.emit(nt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,i){super(),D(this,"_disconnectedReason",void 0),D(this,"_websocketReconnectReason",void 0),D(this,"_connectionState",ni.CLOSED),D(this,"reconnectToken",void 0),D(this,"p2pToken",void 0),D(this,"websocket",void 0),D(this,"openConnectionTime",void 0),D(this,"clientId",void 0),D(this,"lastMsgTime",Date.now()),D(this,"uploadCache",[]),D(this,"uploadCacheInterval",void 0),D(this,"rttRolling",new RL(5)),D(this,"pingpongTimer",void 0),D(this,"pingpongTimeoutCount",0),D(this,"joinResponse",void 0),D(this,"multiIpOption",void 0),D(this,"initError",void 0),D(this,"spec",void 0),D(this,"store",void 0),D(this,"_external_signal",void 0),D(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(nt.ON_BINARY_DATA,r.data);let n=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(n,"_id")){let s="res-@".concat(n._id);this.emit(s,n._result,n._message)}else if(Object.prototype.hasOwnProperty.call(n,"_type")){switch(n._type){case vt.ON_DATA_STREAM:return void this.handleDataStream(n._message);case vt.MUTE_AUDIO:case vt.MUTE_VIDEO:case vt.ON_P2P_LOST:case vt.ON_USER_ONLINE:return;case vt.ON_USER_OFFLINE:let{uid:s}=n._message;return y.debug("[".concat(this.clientId,"] user-offline uid: ").concat(s)),void this._external_signal.reset(s)}if(this.emit(n._type,n._message),n._type===vt.ON_NOTIFICATION&&this.handleNotification(n._message),n._type===vt.ON_USER_BANNED)switch(n._message.error_code){case 14:this.close(Bt.UID_BANNED);break;case 15:this.close(Bt.IP_BANNED);break;case 16:this.close(Bt.CHANNEL_BANNED)}if(n._type===vt.ON_USER_LICENSE_BANNED)switch(n._message.error_code){case Ke.ERR_LICENSE_MISSING:this.close(Bt.LICENSE_MISSING);break;case Ke.ERR_LICENSE_EXPIRED:this.close(Bt.LICENSE_EXPIRED);break;case Ke.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Bt.LICENSE_MINUTES_EXCEEDED);break;case Ke.ERR_LICENSE_PERIOD_INVALID:this.close(Bt.LICENSE_PERIOD_INVALID);break;case Ke.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Bt.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ke.ERR_LICENSE_ILLEGAL:this.close(Bt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=i,this.websocket=new zw("gateway-".concat(this.clientId),this.spec.retryConfig,!0,U("JOIN_GATEWAY_USE_DUAL_DOMAIN"),U("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ni.CONNECTED&&this.reconnect("retry",yr.OFFLINE)}),this.p2pToken=Zt(6,""),this._external_signal=new Gh(this,this.p2pToken)}async request(t,i,r,n){let s=Zt(6,""),c={_id:s,_type:t,_message:i},l=this.websocket.connectionID,d=()=>new we((N,w)=>{if(this.connectionState===ni.CONNECTED)return N();let O=()=>{this.off(nt.WS_CLOSED,L),N()},L=()=>{this.off(nt.WS_CONNECTED,O),w(new ne(k.WS_ABORT))};this.once(nt.WS_CONNECTED,O),this.once(nt.WS_CLOSED,L)});if(this.connectionState!==ni.CONNECTING&&this.connectionState!==ni.RECONNECTING||t===Je.JOIN||t===Je.REJOIN||await d(),this.websocket.sendMessage(c,!0),n)return;let h=new we((N,w)=>{let O=!1,L=(B,Y)=>{O=!0,N({isSuccess:B==="success",message:Y||{}}),this.off(nt.WS_CLOSED,M),this.off(nt.WS_RECONNECTING,M),this.emit(nt.REQUEST_SUCCESS,t,i)};this.once("res-@".concat(s),L);let M=()=>{w(new ne(k.WS_ABORT,"type: ".concat(t))),this.off(nt.WS_CLOSED,M),this.off(nt.WS_RECONNECTING,M),this.off("res-@".concat(s),L)};this.once(nt.WS_CLOSED,M),this.once(nt.WS_RECONNECTING,M),fr(U("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||O||(y.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(nt.REQUEST_TIMEOUT,t,i))})}),p=null;try{p=await h}catch(N){if(this.connectionState===ni.CLOSED||t===Je.LEAVE)throw new ne(k.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?N.throw():t===Je.JOIN||t===Je.REJOIN?null:(await d(),await this.request(t,i))}if(p.isSuccess)return p.message;let _=Number(p.message.error_code||p.message.code),E=Ug(_),R=new ne(k.UNEXPECTED_RESPONSE,"".concat(E.desc,": ").concat(p.message.error_str),{code:_,data:p.message,desc:E.desc});return E.action==="success"?p.message:(y.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(_,", message: ").concat(E.desc,", action: ").concat(E.action)),_===Ke.ERR_TOO_MANY_BROADCASTERS?((t===Je.JOIN||t===Je.REJOIN)&&(this.initError=R,this.close()),R.throw()):E.action==="failed"?R.throw():E.action==="quit"?(this.initError=R,this.close(),R.throw()):(_===Ke.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,y.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",yr.MULTI_IP)):this.reconnect(E.action,yr.SERVER_ERROR),t===Je.JOIN||t===Je.REJOIN?null:await this.request(t,i)))}waitMessage(t,i){return new we(r=>{let n=s=>{(!i||i(s))&&(this.off(t,n),r(s))};this.on(t,n)})}uploadWRTCStats(t){if(!this.store.sessionId)return void y.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Mg.WRTC_STATS,i)}upload(t,i){let r={_type:t,_message:i};try{this.websocket.sendMessage(r)}catch{let n=U("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>n&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ni.CONNECTED)return;let s=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(s._type,s._message)},U("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,i){let r={_type:t,_message:i};this.websocket.sendMessage(r)}async sendExtensionMessage(t,i,r){return await this._external_signal.send(t,i,r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new we((i,r)=>{this.once(nt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(nt.WS_CLOSED,()=>r(this.initError||new ne(k.WS_ABORT))),this.connectionState=ni.CONNECTING,this.websocket.init(t).catch(r)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Bt.LEAVE,this.connectionState=ni.CLOSED,y.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Zt(6,""),this._external_signal.clear(),this._external_signal=new Gh(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(nt.ABORT_P2P_EXECUTION);let t=await Cr(this,nt.REQUEST_JOIN_INFO),i=await this.request(Je.JOIN,t);if(!i)return this.emit(nt.REPORT_JOIN_GATEWAY,k.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(nt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=ni.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,i)}async downgradeCodec(t){return!1}handleDataStream(t){try{var i;let r=vh(t.payload),n=new TextDecoder().decode(r),s=JSON.parse(n);"total"in s&&"id"in s||ve(i=Object.values(xi)).call(i,s._type)?(s._uid=t.uid,this._external_signal.onMessage(s)):this.emit(vt.ON_DATA_STREAM,t)}catch{this.emit(vt.ON_DATA_STREAM,t)}}handleNotification(t){y.debug("[".concat(this.clientId,"] receive notification: "),t);let i=Ug(t.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Bt.UID_BANNED),void this.close()):void this.reconnect(i.action,yr.SERVER_ERROR);y.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=U("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=t&&(y.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>U("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",yr.TIMEOUT):this.request(Je.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let r=Date.now()-i;this.rttRolling.add(r),U("REPORT_STATS")&&this.send(Je.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWebsocketEvents(){this.websocket.on(dt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(nt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(dt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(dt.CLOSED,()=>{this.connectionState=ni.CLOSED}),this.websocket.on(dt.FAILED,()=>{this._disconnectedReason=Bt.NETWORK_ERROR,this.connectionState=ni.CLOSED}),this.websocket.on(dt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===ni.CONNECTED?this.connectionState=ni.RECONNECTING:this.connectionState=ni.CONNECTING}),this.websocket.on(dt.WILL_RECONNECT,(t,i,r)=>{t!=="retry"?(y.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):y.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(t)}),this.websocket.on(dt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(nt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof ne&&t.code===k.UNEXPECTED_RESPONSE&&t.data.code===Ke.ERR_NO_AUTHORIZED)return y.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",yr.SERVER_ERROR);y.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",yr.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(dt.REQUEST_NEW_URLS,(t,i)=>{Cr(this,nt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(i)}),this.websocket.on(dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(vt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}let S7={name:"P2PChannel",create:function(e){let{store:t,statsCollector:i}=e;return new E7(t,i)},createSubmodule:function(e){let{store:t,spec:i}=e;return new g7(i,t)}};function YV(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function qV(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?YV(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):YV(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}class T7{constructor(t){D(this,"sessionDesc",void 0),D(this,"localCapabilities",void 0),D(this,"rtpCapabilities",void 0),D(this,"candidates",void 0),D(this,"_originCandidates",void 0),D(this,"iceParameters",void 0),D(this,"dtlsParameters",void 0),D(this,"setup",void 0),D(this,"currentMidIndex",void 0),D(this,"cname",void 0),t=fi(t);let{iceParameters:i,dtlsParameters:r,candidates:n,rtpCapabilities:s,setup:c,localCapabilities:l,sdkCodec:d,cname:h}=t,p=kn(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=s,this.candidates=n,this._originCandidates=fi(n),this.iceParameters=i,this.dtlsParameters=r,this.setup=c,this.localCapabilities=l,this.cname=h;for(let _=0;_<p.mediaDescriptions.length;_++){let E=p.mediaDescriptions[_];if(E.attributes.iceUfrag=i.iceUfrag,E.attributes.icePwd=i.icePwd,E.attributes.fingerprints=r.fingerprints,E.attributes.candidates=n,E.attributes.setup=c,E.media.mediaType==="video"){E.media.fmts=s.videoCodecs.map(w=>w.payloadType.toString(10));let R=s.videoCodecs.filter(w=>{var O,L;return(O=w.rtpMap)===null||O===void 0?void 0:ve(L=O.encodingName.toLowerCase()).call(L,d)}),N=s.videoCodecs.filter(w=>!ve(R).call(R,w));E.attributes.payloads=[...R,...N],E.attributes.extmaps=s.videoExtensions}E.media.mediaType==="audio"&&(E.media.fmts=s.audioCodecs.map(R=>R.payloadType.toString(10)),E.attributes.payloads=s.audioCodecs,E.attributes.extmaps=s.audioExtensions),p.mediaDescriptions[_]=this.mungMediaDesc(E)}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return Pd(this.sessionDesc)}send(t,i,r){let{ssrcs:n,ssrcGroups:s}=Fg(i,this.cname),c=this.sessionDesc.mediaDescriptions.find(h=>t===Le.VIDEO?h.media.mediaType==="video":h.media.mediaType==="audio"),l=n[0].attributes.label,d=n[0].attributes.mslabel;return c.attributes.ssrcs=c.attributes.ssrcs.concat(n),c.attributes.ssrcGroups=c.attributes.ssrcGroups.concat(s),{id:l,mslabel:d}}batchSend(t){return t.map(i=>{let{kind:r,ssrcMsg:n}=i;return this.send(r,n,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(i=>{let r=[],n=[],s=[];i.attributes.ssrcs.forEach(c=>{ve(t).call(t,c.attributes.label||"")?s.push(c):r.push(c)}),i.attributes.ssrcGroups.forEach(c=>{var l;ve(l=s.map(d=>d.ssrcId)).call(l,c.ssrcIds[0])||n.push(c)}),i.attributes.ssrcs=r,i.attributes.ssrcGroups=n})}mute(t){let i=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!i)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(t){let i=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!i)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(t,i,r){t.forEach((n,s)=>{let c=n._mediaStreamTrack,l=this.sessionDesc.mediaDescriptions.findIndex(h=>h.attributes.mid===c.kind),d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],n);this.sessionDesc.mediaDescriptions[l]=d})}stopReceiving(t){}updateCandidates(t){let i=this._originCandidates.filter(n=>n.transport==="udp"),r=[];if(i.forEach(n=>{r.push(qV(qV({},n),{},{foundation:"tcpcandidate",priority:Number(n.priority)-1+"",transport:"tcp",port:Number(n.port)+90+""}))}),i.length!==0){switch(t){case xr.TCP_RELAY:this.candidates=r;break;case xr.UDP_TCP_RELAY:case xr.RELAY:this.candidates=[...i,...r];break;default:this.candidates=i}for(let n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}}restartICE(t){t=fi(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=t.iceUfrag,i.attributes.icePwd=t.icePwd})}predictReceivingMids(t){let i=[];for(let r=0;r<t;r++)i.push((this.currentMidIndex+r+1).toString(10));return i}mungRecvMediaDsec(t,i){let r=fi(t);return Sm(r,i),Xw(r,i),r}updateRecvMedia(t,i){let r=this.sessionDesc.mediaDescriptions.findIndex(n=>n.attributes.mid===t);if(r!==-1){let n=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],i);this.sessionDesc.mediaDescriptions[r]=n}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,i,r){let n=this.sessionDesc.mediaDescriptions.find(c=>t===Le.VIDEO?c.attributes.mid==="video":c.attributes.mid==="audio");if(n){let c=n.attributes.ssrcs.find(l=>l.attributes.label===i);var s;c&&(c.attributes.label=r,(s=c.attributes.msid)===null||s===void 0||s.replace(i,r))}}mungMediaDesc(t){let i=fi(t);return qw(i),(function(r){let n=r.attributes.extmaps.find(s=>MR(s.extensionName));n&&r.attributes.extmaps.splice(r.attributes.extmaps.indexOf(n),1),r.attributes.payloads.forEach(s=>{let c=s.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&s.rtcpFeedbacks.splice(c,1)})})(i),i}getSSRC(t){for(let i of this.sessionDesc.mediaDescriptions)for(let r of i.attributes.ssrcs)if(r.attributes.label===t)return[r]}}var Qt;function XV(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function vy(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?XV(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):XV(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let v7=(Qt=class gS extends lM{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var i;return ve(i=Object.keys(Ng)).call(i,t)}))]}constructor(t,i){super(t,i),D(this,"store",void 0),D(this,"peerConnection",void 0),D(this,"remoteSDP",void 0),D(this,"initialOffer",void 0),D(this,"statsFilter",void 0),D(this,"useRTX",!1),D(this,"localCapabilities",void 0),D(this,"localCandidateCount",0),D(this,"allCandidatesReceived",!1),D(this,"establishPromise",void 0),D(this,"mutex",void 0),this.store=i,this.mutex=new Lr("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(gS.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=rw(this.peerConnection,U("STATS_UPDATE_INTERVAL"),void 0,Ri()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let i=Vd(t.sdp),r=jg(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:U("FILTER_VIDEO_FEC"),filterAudioFec:U("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=t,vy(vy({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new ne(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new T7(vy(vy({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));let i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(t,i){throw new ne(k.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,i){var r=this;return ja(function*(){let n=yield It(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let s=t.map(E=>r.peerConnection.addTrack(E._mediaStreamTrack)),c=yield It(r.peerConnection.createOffer()),l=kn(c.sdp),d=t.map(E=>{let R=E._mediaStreamTrack,N=l.mediaDescriptions.find(w=>w.attributes.mid===R.kind);if(!N)throw new Error("Cannot extract ssrc from mediaDescription.");return(function(w,O,L){let M=w.attributes.ssrcs.filter(Y=>Y.attributes.label===O),B=w.attributes.ssrcGroups;if(M.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(B&&M.length>1){let Y=B.find(H=>H.ssrcIds.indexOf(M[0].ssrcId)!==-1);return Y?[{ssrcId:Y.ssrcIds[0],rtx:L?Y.ssrcIds[1]:void 0}]:[{ssrcId:M[0].ssrcId}]}return[{ssrcId:M[0].ssrcId}]})(N,R.id,r.useRTX)}),h;try{h=yield d}catch(E){throw s.forEach(R=>{Rr()&&R.replaceTrack(null),r.peerConnection.removeTrack(R)}),E}let p=r.mungSendOfferSDP(c.sdp,t);r.remoteSDP.receive(t,i,h);let _=r.remoteSDP.toString();return yield It(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield It(r.applySendEncodings(s,t)),yield It(r.peerConnection.setRemoteDescription({type:"answer",sdp:_})),t.map((E,R)=>{let N=E._mediaStreamTrack.id;return{localSSRC:d[R],id:N}})}catch(s){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{n()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let i=this.peerConnection.getSenders().filter(s=>{var c;return t.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(s=>{Rr()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)});let r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);let n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(t,i,r,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{id:s,mslabel:c}=this.remoteSDP.send(t,i,n),l=new we((p,_)=>{let E=setTimeout(()=>{_(new Error("Cannot receive track, id: ".concat(s)))},1e4),R=N=>{let w=Ct();if((w.name==="Safari"&&Number(w.version)===11||zr())&&N.track.id!==s&&N.streams[0].id===c){var O;let L=N.streams[0].getTracks()[0];return(O=this.remoteSDP)===null||O===void 0||O.updateTrackLabel(t,s,N.track.id),this.peerConnection.removeEventListener("track",R),clearTimeout(E),void p(L)}if(N.track.id===s)return this.peerConnection.removeEventListener("track",R),clearTimeout(E),void p(N.track)};this.peerConnection.addEventListener("track",R)}),d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});let h=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(h),{track:await l,id:s}}catch(s){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getSenders().filter(r=>{var n;return t.indexOf(((n=r.track)===null||n===void 0?void 0:n.id)||"")!==-1});if(i.length!==t.length)throw new Error("sender' length doesn't match mids' length.");i.map(r=>{if(Rr()&&r.track)r.track.enabled=!1;else{let n=r.getParameters();n.encodings.forEach(s=>s.active=!1),r.setParameters(n)}})}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getSenders().filter(s=>{var c;return t.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async s=>{if(Rr()&&s.track)s.track.enabled=!0;else{let c=s.getParameters();c.encodings.forEach(l=>l.active=!0),await s.setParameters(c)}});let r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);let n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(t){var i=this;return ja(function*(){let r=yield It(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let n=Ot().supportPCSetConfiguration;if(t===xr.RELAY&&!n)return;if(n){let h=i.peerConnection.getConfiguration(),p=t===xr.RELAY?"relay":"all";h.iceTransportPolicy!==p&&(y.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(h.iceTransportPolicy,"] to [").concat(p,"]")),h.iceTransportPolicy=p,i.peerConnection.setConfiguration(h))}t!==xr.RELAY&&i.remoteSDP.updateCandidates(t);let s=yield It(i.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let c=Vd(s.sdp),{remoteIceParameters:l}=yield c.iceParameters;i.remoteSDP.restartICE(l);let d=i.remoteSDP.toString();yield It(i.peerConnection.setLocalDescription(s)),yield It(i.peerConnection.setRemoteDescription({type:"answer",sdp:d}))}catch(n){y.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),n)}finally{r()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let r=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(r.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);let s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ne(k.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,i){let r=this.peerConnection.getSenders().filter(n=>{var s;return((s=n.track)===null||s===void 0?void 0:s.id)===t});r.length===1&&await this.applySendEncodings(r,[i])}setStatsRemoteVideoIsReady(t,i){this.statsFilter.setVideoIsReady2(t,i)}async replaceTrack(t,i){let r=this.peerConnection.getSenders().find(n=>{var s;return((s=n.track)===null||s===void 0?void 0:s.id)===i});r&&await r.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,i){throw new ne(k.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new ne(k.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,y.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,y.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},U("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let i={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(bg(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...gS.turnServerConfigToIceServers(t.turnServer.servers)),U("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...gS.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(t){let i=[];return t.forEach(r=>{r.security?r.tcpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(t,i){var r;if(i||(i=this.peerConnection.getSenders().find(h=>{var p;return((p=h.track)===null||p===void 0?void 0:p.id)===t._mediaStreamTrack.id})),!i)return y.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Ot().supportSetRtpSenderParameters)return y.warn("Browser not support set rtp-sender parameters");let n={},s={};if(t instanceof ai)switch(t._optimizationMode){case"motion":n.degradationPreference="maintain-framerate";break;case"detail":n.degradationPreference="maintain-resolution";break;default:n.degradationPreference="balanced"}if(U("DSCP_TYPE")&&sl()){var c;let h=U("DSCP_TYPE");ve(c=["very-low","low","medium","high"]).call(c,h)&&(s.networkPriority=h)}let l=i.getParameters(),d=(r=l.encodings)===null||r===void 0?void 0:r[0];d&&Object.assign(d,s),Object.assign(l,n),y.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await i.setParameters(l)}async applySendEncodings(t,i){try{if(!Ot().supportSetRtpSenderParameters||t.length!==i.length)return;for(let r=0;r<t.length;r++){let n=t[r],s=i[r];n&&s&&await this.updateRtpSenderEncodings(s,n)}}catch{y.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,i){let r=kn(t);return i.forEach((n,s)=>{let c=n._mediaStreamTrack,l=r.mediaDescriptions.find(d=>d.attributes.mid===c.kind);l&&Sm(l,n)}),Pd(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,i,r)=>{var n;(n=this.onFirstVideoDecoded)===null||n===void 0||n.call(this,t,i,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,i)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,i)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let i=this.remoteSDP.batchSend(t).map((s,c)=>{let{id:l,mslabel:d}=s,{kind:h}=t[c];return new we((p,_)=>{let E=setTimeout(()=>{_(new Error("Cannot receive track, id: ".concat(l)))},1e4),R=N=>{let w=Ct();if(w.name==="Safari"&&Number(w.version)===11&&N.track.id!==l&&N.streams[0].id===d){var O;let L=N.streams[0].getTracks()[0];return(O=this.remoteSDP)===null||O===void 0||O.updateTrackLabel(h,l,N.track.id),this.peerConnection.removeEventListener("track",R),clearTimeout(E),void p({track:L,id:l})}if(N.track.id===l)return this.peerConnection.removeEventListener("track",R),clearTimeout(E),void p({track:N.track,id:l})};this.peerConnection.addEventListener("track",R)})}),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let n=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(n),await we.all(i)}catch(i){throw new ne(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(t){return this.remoteSDP?this.remoteSDP.getSSRC(t)?.[0].ssrcId:void 0}setConfiguration(t){if(Ot().supportPCSetConfiguration){let i=gS.resolvePCConfiguration(t);this.peerConnection.setConfiguration(i)}}},Be(Qt.prototype,"connect",[Xa],Object.getOwnPropertyDescriptor(Qt.prototype,"connect"),Qt.prototype),Be(Qt.prototype,"stopSending",[Xa],Object.getOwnPropertyDescriptor(Qt.prototype,"stopSending"),Qt.prototype),Be(Qt.prototype,"receive",[Xa],Object.getOwnPropertyDescriptor(Qt.prototype,"receive"),Qt.prototype),Be(Qt.prototype,"stopReceiving",[Xa],Object.getOwnPropertyDescriptor(Qt.prototype,"stopReceiving"),Qt.prototype),Be(Qt.prototype,"muteRemote",[Xa],Object.getOwnPropertyDescriptor(Qt.prototype,"muteRemote"),Qt.prototype),Be(Qt.prototype,"unmuteRemote",[Xa],Object.getOwnPropertyDescriptor(Qt.prototype,"unmuteRemote"),Qt.prototype),Be(Qt.prototype,"muteLocal",[Xa],Object.getOwnPropertyDescriptor(Qt.prototype,"muteLocal"),Qt.prototype),Be(Qt.prototype,"unmuteLocal",[Xa],Object.getOwnPropertyDescriptor(Qt.prototype,"unmuteLocal"),Qt.prototype),Be(Qt.prototype,"close",[Xa],Object.getOwnPropertyDescriptor(Qt.prototype,"close"),Qt.prototype),Be(Qt.prototype,"updateEncoderConfig",[Xa],Object.getOwnPropertyDescriptor(Qt.prototype,"updateEncoderConfig"),Qt.prototype),Be(Qt.prototype,"updateSendParameters",[Xa],Object.getOwnPropertyDescriptor(Qt.prototype,"updateSendParameters"),Qt.prototype),Be(Qt.prototype,"replaceTrack",[Xa],Object.getOwnPropertyDescriptor(Qt.prototype,"replaceTrack"),Qt.prototype),Be(Qt.prototype,"getRemoteSSRC",[Xa],Object.getOwnPropertyDescriptor(Qt.prototype,"getRemoteSSRC"),Qt.prototype),Qt);function Xa(e,t,i){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let n=this.mutex,s=await n.lock("Locking from P2PConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await r.apply(this,l)}finally{s()}},i}let R7={name:"PlanBConnection",create:function(e){let{store:t,spec:i}=e;return new v7(i,t)}},y7={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ot().supportWebRTCEncodedTransform)return void y.warning("browser not support audio encoded transform");if(gR.has(e)||!e.track)return;let i={track:e.track};if(al()){if(!e.createEncodedStreams)return void y.warning("browser not support createEncodedStreams() API");let n=null;try{n=e.createEncodedStreams()}catch(c){return void y.error("create audio-encoded-streams error",c&&c.message)}let s=new TransformStream({transform(c,l){i.controller||(i.controller=l),e.track&&e.track.id!==i.track.id&&(y.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r));let d=t.metadata&&t.metadata();d?(function(h,p){let{chunk:_,controller:E}=p,R=Ld.METADATA;_.data=(function(N,w,O){let L=O.byteLength,M=L+Iw+Kk,B=Aw+ww+M,Y=new ArrayBuffer(N.byteLength+B),H=new DataView(Y);H.setUint8(0,zk),H.setUint16(1,M),H.setUint8(3,w),H.setUint16(4,L);for(let Q=0;Q<L;Q++)H.setUint8(6+Q,O[Q]);let G=new Uint8Array(H.buffer);return G.set(new Uint8Array(N),B),G.buffer})(_.data,R,h),E.enqueue(_)})(d,{chunk:c,controller:l}):l.enqueue(c)}});n.readable.pipeThrough(s).pipeTo(n.writable)}else if(Rr()){if(typeof RTCRtpScriptTransform>"u")return void y.warning("browser not support RTCRtpScriptTransform");let n=ER(),s=new MessageChannel;await new we(l=>n.onmessage=d=>{d.data==="registered"&&l(void 0)});let c=new RTCRtpScriptTransform(n,{name:"audio-metadata-tx",port:s.port2},[s.port2]);e.transform=c,await new we(l=>n.onmessage=d=>{d.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var d;if(l.data.transformed&&e.track&&((d=e.track)===null||d===void 0?void 0:d.id)!==i.track.id)y.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r);else if(l.data.getMetadata){let h=t.metadata&&t.metadata();h&&s.port1.postMessage({metadata:h})}},i.worker=n}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}let n=gR.get(e);if(n){gR.delete(e);try{var s,c;(s=n.controller)===null||s===void 0||s.terminate(),(c=n.worker)===null||c===void 0||c.terminate()}catch(l){y.warning(l&&l.message)}}}gR.set(e,i),e.track.addEventListener("ended",r)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ot().supportWebRTCEncodedTransform)return void y.warning("browser not support audio encoded transform");if(CR.has(e))return;let i={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(al()&&!zr()){if(!e.createEncodedStreams)return void y.warning("browser not support createEncodedStreams() API");UA(Pt.CHROME,87,116)||(t.enableTopn=!1);let n=null;try{n=e.createEncodedStreams()}catch(c){return void y.error("create audio-encoded-streams error",c&&c.message)}let s=new TransformStream({transform(c,l){i.controller||(i.controller=l),e.track&&e.track.id!==i.track.id&&(y.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r)),t.enableTopn?(function(d,h,p){var _;let E=Ow(new DataView(h.data));if(!E)return p.enqueue(h);let R=d.track.id;r9.set(R,d.track);let N=(_=E.tlv.find(Y=>Y.tag===Ld.AUDIO_LEVEL))===null||_===void 0?void 0:_.value,w=0;typeof N=="number"&&(w=127-N);let O=Math.round(Math.pow(10,w/60)-1),{selected:L,speaker:M}=(function(Y,H){let G=hm.get(Y);if(G||(G=(function(Q){let ce=new qk;return hm.set(Q,ce),so||(so=new t9(U("TOPN_SILENCE_THRESHOLD")||500),so.on("ActiveSpeakerChanged",he=>{he!=null&&(vR=he)})),so.addSpeakers([ce]),ce})(Y)),hm.size<=Xk)return{selected:!0,speaker:G};if(!so)throw new Error("no active speaker detector");return so.levelChanged(G.id,H),Ih=so.loudest.map(Q=>Q.id),vR&&!ve(Ih).call(Ih,vR)&&Ih.length>=Xk&&Ih.pop(),{selected:ve(Ih).call(Ih,G.id)||G.id===vR,speaker:G}})(d,O),B=(function(Y,H,G){let Q=oo.get(Y)||new i9(Y,H);return Q.score=G,oo.set(Y,Q),(function(ce){if(RR.set(ce,!0),!yR)return void(yR=Date.now());let he=Date.now();he-yR>1e3&&(RR.get(ce)?RR.set(ce,!1):(Jk(ce),RR.delete(ce)),yR=he)})(Y),Q})(R,d.track,M.energyScore);B.addSample(L),B.active&&(h.data=E.frame.buffer,p.enqueue(h))})(e,c,l):t.enableMetadata||t.enablePts?(function(d,h,p,_){let E=new DataView(d.data),R=E.getUint8(0),N;if(128&R&&R!==71){let L=(function(M){if(M.byteLength<=0)return[];let B=[],Y=0;for(;Y<M.byteLength;){let G=(128&M.getUint8(Y))>>7,Q=127&M.getUint8(Y);if(!(G&&Y+4<=M.byteLength)){Y++;break}{let ce=M.getUint32(Y,!1),he=(16776192&ce)>>10,Se=1023&ce;B.push({pt:Q,ts_offset:he,length:Se,data:new Uint8Array}),Y+=4}}let H=M.byteLength-Y;for(let G of B){if(G.length>H)return console.warn("Broken red payload"),[];G.length>0&&(G.data=new Uint8Array(M.buffer,M.byteOffset+Y,G.length),Y+=G.length,H-=G.length)}if(H>0){let G={pt:B.length>0?B[B.length-1].pt:0,ts_offset:0,length:H,data:new Uint8Array(M.buffer,M.byteOffset+Y,H)};B.push(G)}return B})(E);if(L.length>0){let M=(function(B){let Y=0;for(let Q=0;Q<B.length;Q++)Y+=Q<B.length-1?4:1,Y+=B[Q].length;let H=new Uint8Array(Y),G=0;for(let Q=0;Q<B.length;Q++)if(Q<B.length-1){let ce=(2147483648|(127&B[Q].pt)<<24|(262143&B[Q].ts_offset)<<10|1023&B[Q].length)>>>0;H[G++]=ce>>24&255,H[G++]=ce>>16&255,H[G++]=ce>>8&255,H[G++]=255&ce}else H[G++]=127&B[Q].pt;for(let Q of B)H.set(Q.data,G),G+=Q.length;return H})(L.map(B=>{let Y=new Uint8Array(B.length);Y.set(B.data);let H=Ow(new DataView(Y.buffer));return H!=null&&H.frame&&(B.data=H?.frame),N=H,B}));d.data=M.buffer}}else N=Ow(E),N&&(d.data=N.frame.buffer);if(h.enqueue(d),!N)return;let w=N.tlv.find(L=>L.tag===Ld.METADATA);w&&p&&w.value instanceof Uint8Array&&p(w.value);let O=N.tlv.find(L=>L.tag===Ld.AUDIO_64_BIT_PTS);O&&_&&O.value instanceof Uint8Array&&O.value.length==8&&_(new DataView(O.value.buffer).getBigUint64(0,!0))})(c,l,t.onMetadata,t.onPts):l.enqueue(c)}});n.readable.pipeThrough(s).pipeTo(n.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void y.warning("browser not support RTCRtpScriptTransform");let n=ER(),s=new MessageChannel;await new we(l=>n.onmessage=d=>{d.data==="registered"&&l(void 0)});let c=new RTCRtpScriptTransform(n,{name:"audio-metadata-rx",port:s.port2},[s.port2]);e.transform=c,await new we(l=>n.onmessage=d=>{d.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var d;l.data.transformed&&e.track&&((d=e.track)===null||d===void 0?void 0:d.id)!==i.track.id?(y.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r)):l.data.metadata&&i.onMetadata?i.onMetadata(l.data.metadata):l.data.pts&&i.onPts&&i.onPts(l.data.pts)},i.worker=n}function r(){e.track.removeEventListener("ended",r),(function(n){let s=CR.get(n);if(s){(function(d){let h=hm.get(d);h&&(hm.delete(d),so&&(so.removeSpeakers([h]),hm.size===0&&(so.destroy(),so=null)))})(n),Jk(n.track.id),CR.delete(n);try{var c,l;(c=s.controller)===null||c===void 0||c.terminate(),(l=s.worker)===null||l===void 0||l.terminate()}catch(d){y.warning(d&&d.message)}}})(e)}CR.set(e,i),e.track.addEventListener("ended",r)},interceptLocalVideoFrame:async function(e,t){if(!Ot().supportWebRTCEncodedTransform)return void y.warning("browser not support video encoded transform");if(bR.has(e)||!e.track)return;let i={track:e.track};if(al()){if(!e.createEncodedStreams)return void y.warning("browser not support createEncodedStreams() API");let n=null;try{n=e.createEncodedStreams()}catch(l){return void y.error("create video-encoded-streams error",l&&l.message)}let s=[];t.on("sei-to-send",l=>{s.push(l)});let c=new TransformStream({transform(l,d){i.controller||(i.controller=d),e.track&&e.track.id!==i.track.id&&(y.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r));let h=$k(new Uint8Array(l.data)),p=s.shift();if(p){let _=(function(E,R,N){switch(N){case Lw:return(function(w,O){let L=Qk(O),M=L.length,B=Math.floor(M/255),Y=M%255,H=new Uint8Array(6+B+1+M+w.byteLength);H[0]=0,H[1]=0,H[2]=0,H[3]=1,H[4]=6,H[5]=101;let G=0;for(;G<B;)H[6+G]=255,G++;return H[6+G]=Y,G++,H.set(L,6+G),H.set(new Uint8Array(w),6+G+M),H.buffer})(E,R);case kw:return(function(w,O){let L=Qk(O),M=L.length,B=Math.floor(M/255),Y=M%255,H=new Uint8Array(7+B+1+M+1+w.byteLength);H[0]=0,H[1]=0,H[2]=0,H[3]=1,H[4]=78,H[5]=1,H[6]=101;let G=0;for(;G<B;)H[7+G]=255,G++;return H[7+G]=Y,G++,H.set(L,7+G),G+=M,H[7+G]=128,G++,H.set(new Uint8Array(w),7+G),H.buffer})(E,R);default:return null}})(l.data,p,h);_&&(l.data=_)}d.enqueue(l)}});n.readable.pipeThrough(c).pipeTo(n.writable)}else{if(!Rr())return;{if(typeof RTCRtpScriptTransform>"u")return void y.warning("browser not support RTCRtpScriptTransform");let n=ER(),s=new MessageChannel;await new we(l=>n.onmessage=d=>{d.data==="registered"&&l(void 0)});let c=new RTCRtpScriptTransform(n,{name:"sei-tx",port:s.port2},[s.port2]);e.transform=c,await new we(l=>n.onmessage=d=>{d.data==="started"&&l(void 0)}),t.on("sei-to-send",l=>{s.port1.postMessage({sei:l})}),s.port1.onmessage=l=>{var d;l.data.transformed&&e.track&&((d=e.track)===null||d===void 0?void 0:d.id)!==i.track.id&&(y.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r))},i.worker=n}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}let n=bR.get(e);if(n){bR.delete(e);try{var s,c;(s=n.controller)===null||s===void 0||s.terminate(),(c=n.worker)===null||c===void 0||c.terminate()}catch(l){y.warning(l&&l.message)}}}bR.set(e,i),e.track.addEventListener("ended",r)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ot().supportWebRTCEncodedTransform)return void y.warning("browser not support video encoded transform");if(!e.track)return;if(kg.has(e)){let n=kg.get(e);return void(n&&(n.onSei=t.onSei))}let i={track:e.track,onSei:t.onSei};if(al()){if(!e.createEncodedStreams)return void y.warning("browser not support createEncodedStreams() API");let n=null;try{n=e.createEncodedStreams()}catch(c){return void y.error("create video-encoded-streams error",c&&c.message)}let s=new TransformStream({transform(c,l){i.controller||(i.controller=l),e.track&&e.track.id!==i.track.id&&(y.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r));let d=(function(h,p){switch(p){case Lw:return(function(_){let E=new DataView(_.data),R=0;for(;R+4<_.data.byteLength;){if(E.getUint8(R+0)===0&&E.getUint8(R+1)===0&&E.getUint8(R+2)===0&&E.getUint8(R+3)===1&&E.getUint8(R+4)===6){let N=R+6,w=0,O=0;for(;(O=E.getUint8(N++))===255;)w+=255;w+=O;let L=Zk(_.data,N,w);return new Uint8Array(L)}R++}return null})(h);case kw:return(function(_){let E=new DataView(_.data),R=0;for(;R+5<_.data.byteLength;){if(E.getUint8(R+0)===0&&E.getUint8(R+1)===0&&E.getUint8(R+2)===0&&E.getUint8(R+3)===1&&E.getUint8(R+4)===78&&E.getUint8(R+5)===1&&E.getUint8(R+6)===101){let N=R+7,w=0,O=0;for(;(O=E.getUint8(N++))===255;)w+=255;w+=O;let L=Zk(_.data,N,w);return new Uint8Array(L)}R++}return null})(h);default:return null}})(c,$k(new Uint8Array(c.data)));d&&i.onSei&&i.onSei(d),l.enqueue(c)}});n.readable.pipeThrough(s).pipeTo(n.writable)}else if(Rr()){if(typeof RTCRtpScriptTransform>"u")return void y.warning("browser not support RTCRtpScriptTransform");let n=ER(),s=new MessageChannel;await new we(l=>n.onmessage=d=>{d.data==="registered"&&l(void 0)});let c=new RTCRtpScriptTransform(n,{name:"sei-rx",port:s.port2},[s.port2]);e.transform=c,await new we(l=>n.onmessage=d=>{d.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var d;l.data.transformed&&e.track&&((d=e.track)===null||d===void 0?void 0:d.id)!==i.track.id?(y.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r)):l.data.sei&&i.onSei&&i.onSei(l.data.sei)},i.worker=n}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}(function(n){let s=kg.get(n);if(s){kg.delete(n);try{var c,l;(c=s.controller)===null||c===void 0||c.terminate(),(l=s.worker)===null||l===void 0||l.terminate()}catch(d){y.warning(d&&d.message)}}})(e)}kg.set(e,i),e.track.addEventListener("ended",r)}},C7={name:"InterceptFrame",create:()=>y7};nw(),Ht("PROCESS_ID","process-".concat(Zt(8,""),"-").concat(Zt(4,""),"-").concat(Zt(4,""),"-").concat(Zt(4,""),"-").concat(Zt(12,""))),(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void y.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),i=Date.now();y.debug("Loading global parameters from cache",t),Object.keys(t).forEach(r=>{if(Object.prototype.hasOwnProperty.call(di,r)){let{value:n,expires:s}=t[r];if(s&&s<=i)return;ao[r]=n,di[r]=n}})}catch(t){y.error("Error loading mutableParamsCache: ".concat(e),t.message)}})(),Array.isArray(ao.AREAS)&&ao.AREAS.length>0&&$w(ao.AREAS,!0);let JV=(e,t,i)=>{y.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Ht(e,t,i)};Fd(YH,!1),Fd(JH,!1),Fd(OG,!1),Fd(o7,!1),Fd(WH,!1),Fd(S7,!1),Fd(R7,!1),Fd(C7,!1);let zi=(function(e){let t=new Ei,i=e,r={getListeners:t.getListeners.bind(t),on:(n,s)=>((function(c,l){c===ac.SECURITY_POLICY_VIOLATION&&NU(l,!0)})(n,s),t.on.bind(t)(n,s)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return OU(OU({},i),r)})({__TRACK_LIST__:rm,VERSION:Fa,BUILD:ow,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:JV,getParameter:U,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection,i=await(async function(r){let n;return Ot().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),n=(await r.createOffer()).sdp):n=(await r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,n})(t);if(!i)return e;t.close(),t=null,e=(function(r){let n={video:[],audio:[]};return r.match(/ VP8/i)&&n.video.push("VP8"),r.match(/ VP9/i)&&n.video.push("VP9"),r.match(/ AV1/i)&&n.video.push("AV1"),r.match(/ H264/i)&&n.video.push("H264"),r.match(/ H265/i)&&n.video.push("H265"),r.match(/ opus/i)&&n.audio.push("OPUS"),r.match(/ PCMU/i)&&n.audio.push("PCMU"),r.match(/ PCMA/i)&&n.audio.push("PCMA"),r.match(/ G722/i)&&n.audio.push("G722"),n})(i)}catch(t){throw new $(k.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=Fe.reportApiInvoke(null,{name:Oi.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:pi.TRACER}),t=!1;try{let s=window.RTCPeerConnection,c=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,l=window.WebSocket;t=!!(s&&c&&l),t&&HA()&&ZP(75)&&new s().close()}catch(s){return y.error("check system requirement failed: ",s),!1}let i=!1,r=Ct();r.name===Pt.CHROME&&Number(r.version)>=58&&(io.engine.name!=="WebKit"||(function(){let s=Ct();if(eR()){if(s.os===rr.MAC_OS)return!0;if(s.os===rr.IOS){let c=io.os.version&&io.os.version.split(".");if(c&&Number(c[0])===14&&c[1]&&Number(c[1])>=3||c&&Number(c[0])>14)return!0}}return!1})())&&(i=!0),(r.name===Pt.FIREFOX&&Number(r.version)>=56||r.name===Pt.OPERA&&Number(r.version)>=45||r.name===Pt.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(zr()||gs())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||rL()||Ct().name===Pt.QQ)&&(i=!0),y.debug("checkSystemRequirements, api:",t,"browser",i);let n=t&&i;return e.onSuccess(n),n},getDevices:function(e){return Ta.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Ta.getRecordingDevices(e)},getCameras:function(e){return Ta.getCamerasDevices(e)},getElectronScreenSources:ZL,getPlaybackDevices:function(e){return Ta.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},i=Zt(5,"client-"),r=Fe.reportApiInvoke(null,{id:i,name:Oi.CREATE_CLIENT,options:[t],tag:pi.TRACER});try{(function(n){$i(n.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),$i(n.mode,"config.mode",["rtc","live","p2p"]),n.audioCodec!==void 0&&$i(n.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),n.proxyServer!==void 0&&pr(n.proxyServer,"config.proxyServer",1,1e4),n.turnServer!==void 0&&uL(n.turnServer),n.httpRetryConfig!==void 0&&dL(n.httpRetryConfig),n.websocketRetryConfig!==void 0&&dL(n.websocketRetryConfig)})(t)}catch(n){throw r.onError(n),n}return(eL(16,0)||jA(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",y.debug("browser not support vp9, force use vp8")),Ht("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),r.onSuccess(),new NG(ws(ws({forceWaitGatewayResponse:!0},t),{},{role:ve(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),i)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=U("CAMERA_CAPTURE_CONFIG"),i=Zt(8,"track-cam-"),r=Fe.reportApiInvoke(null,{id:i,tag:pi.TRACER,name:Oi.CREATE_CAM_VIDEO_TRACK,options:[ri({},e),t]});t&&(e.encoderConfig=t);let n=mR(e),s=null;y.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{s=(await Sa({video:n},i)).getVideoTracks()[0]||null}catch(l){throw r.onError(l),l}if(!s){let l=new ne(k.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(l),l.throw(y)}if(e.optimizationMode&&bw(i,s,e,vs(e.encoderConfig)),U("USE_STANDARD_BITRATE_DEFAULT")){let l=vs(e.encoderConfig);e.encoderConfig=l,delete l.bitrateMax,delete l.bitrateMin}let c=new _R(s,e,n,e.scalabiltyMode?uR(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return r.onSuccess(c.getTrackId()),y.info("create camera video success, trackId:",i),c},createCustomVideoTrack:function(e){let t=Zt(8,"track-cus-"),i=Fe.reportApiInvoke(null,{id:t,tag:pi.TRACER,name:Oi.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});U("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);let r=new ai(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?uR(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[qt.CUSTOM_TRACK]);return i.onSuccess(r.getTrackId()),y.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",i=typeof t=="object"?(function(E){return o2(E)})(t):void 0;i&&(t="auto");let r=Zt(8,"track-scr-v-"),n=Fe.reportApiInvoke(null,{id:r,tag:pi.TRACER,name:Oi.CREATE_SCREEN_VIDEO_TRACK,options:[ri({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let s=(function(E){let R={};E.screenSourceType&&(R.mediaSource=E.screenSourceType),E.extensionId&&al()&&(R.extensionId=E.extensionId);let{displaySurface:N,selfBrowserSurface:w,surfaceSwitching:O,systemAudio:L,preferCurrentTab:M}=E;(qf(107)||VA(107)||FA(93))&&(N&&($i(N,"displaySurface",["browser","window","monitor"]),R.displaySurface=N),w?($i(w,"selfBrowserSurface",["exclude","include"]),R.selfBrowserSurface=w):R.selfBrowserSurface="include",O&&($i(O,"surfaceSwitching",["exclude","include"]),R.surfaceSwitching=O)),(qf(105)||VA(105)||FA(91))&&L&&($i(L,"systemAudio",["exclude","include"]),R.systemAudio=L),(qf(94)||VA(94)||FA(80))&&M&&(R.preferCurrentTab=!0),E.electronScreenSourceId&&(R.sourceId=E.electronScreenSourceId);let B=E.encoderConfig?pw(E.encoderConfig):null;return R.mandatory={chromeMediaSource:"desktop",maxWidth:B?B.width:void 0,maxHeight:B?B.height:void 0},B&&(B.frameRate&&(typeof B.frameRate=="number"?(R.mandatory.maxFrameRate=B.frameRate,R.mandatory.minFrameRate=B.frameRate):(R.mandatory.maxFrameRate=B.frameRate.max||B.frameRate.ideal||B.frameRate.exact||void 0,R.mandatory.minFrameRate=B.frameRate.min||B.frameRate.ideal||B.frameRate.exact||void 0),R.frameRate=B.frameRate),B.width&&(R.width=B.width),B.height&&(R.height=B.height)),R})(e),c=null,l=null,d=Ot();if(!d.supportShareAudio&&t==="enable"){let E=new ne(k.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(E),E.throw(y)}y.info("start create screen video track with config",e,"withAudio",t,"trackId",r);let h=d.supportShareAudio&&t!=="disable";try{let E=await Sa({screen:s,screenAudio:h?i||!0:void 0},r);c=E.getVideoTracks()[0]||null,l=E.getAudioTracks()[0]||null}catch(E){throw n.onError(E),E}if(!c){let E=new ne(k.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(E),E.throw(y)}if(!l&&t==="enable"){c&&c.stop();let E=new ne(k.SHARE_AUDIO_NOT_ALLOWED);return n.onError(E),E.throw(y)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(bw(r,c,e,e.encoderConfig&&pw(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let p=new ai(c,e.encoderConfig?pw(e.encoderConfig):{},e.scalabiltyMode?uR(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[qt.SCREEN_TRACK]);if(!l)return n.onSuccess(p.getTrackId()),y.info("create screen video track success","video:",p.getTrackId()),p;let _=new Ai(l,void 0,Zt(8,"track-scr-a-"),!1);return n.onSuccess([p.getTrackId(),_.getTrackId()]),y.info("create screen video track success","video:",p.getTrackId(),"audio:",_.getTrackId()),[p,_]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=U("CAMERA_CAPTURE_CONFIG"),r=Zt(8,"track-mic-"),n=Zt(8,"track-cam-"),s=Fe.reportApiInvoke(null,{id:"".concat(r,"-").concat(n),tag:pi.TRACER,name:Oi.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,i]});i&&(t.encoderConfig=i);let c=mR(t),l=c2(e),d=null,h=null;y.info("start create camera video track(".concat(n,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{let E=await Sa({audio:l,video:c},"".concat(r,"-").concat(n));d=E.getAudioTracks()[0],h=E.getVideoTracks()[0]}catch(E){throw s.onError(E),E}if(!d||!h){let E=new ne(k.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(E),E.throw(y)}if(t.optimizationMode&&bw(n,h,t,vs(t.encoderConfig)),U("USE_STANDARD_BITRATE_DEFAULT")){let E=vs(t.encoderConfig);t.encoderConfig=E,delete E.bitrateMax,delete E.bitrateMin}let p=new Lg(d,e,l,r),_=new _R(h,t,c,t.scalabiltyMode?uR(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,n);return s.onSuccess([p.getTrackId(),_.getTrackId()]),y.info("create camera video track(".concat(n,") and microphone audio track(").concat(r,") success")),[p,_]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Zt(8,"track-mic-"),i=Fe.reportApiInvoke(null,{id:t,tag:pi.TRACER,name:Oi.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=c2(e),n=null;y.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{n=(await Sa({audio:r},t)).getAudioTracks()[0]||null}catch(c){throw i.onError(c),c}if(!n){let c=new ne(k.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(c),c.throw(y)}let s=new Lg(n,e,r,t);return i.onSuccess(s.getTrackId()),y.info("create microphone audio track success, trackId:",t),s},createCustomAudioTrack:function(e){let t=Zt(8,"track-cus-"),i=Fe.reportApiInvoke(null,{id:t,tag:pi.TRACER,name:Oi.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new Ai(e.mediaStreamTrack,e.encoderConfig?hR(e.encoderConfig):{},t,!1);return y.info("create custom audio track success with config",e,"trackId",r.getTrackId()),i.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){var t;let{cacheOnlineFile:i,encoderConfig:r}=e,{source:n}=e,s={source:n instanceof AudioBuffer?"AudioBuffer":n instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":n,cacheOnlineFile:i,encoderConfig:r},c=Zt(8,"track-buf-"),l=Fe.reportApiInvoke(null,{id:c,tag:pi.TRACER,name:Oi.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(U("DISABLE_WEBAUDIO"))throw new ne(k.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");y.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",c);let d=n;if(!(n instanceof AudioBuffer))try{n=await(async function(_,E){let R=null;if(typeof _=="string"){let w=q2.get(_);if(w)return y.debug("use cached audio resource: ",_),w;try{R=(await no(()=>Tn.get(_,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(O){throw new ne(k.FETCH_AUDIO_FILE_FAILED,O.toString())}}else R=await new we((w,O)=>{let L=new FileReader;L.onload=M=>{M.target?w(M.target.result):O(new ne(k.READ_LOCAL_AUDIO_FILE_ERROR))},L.onerror=()=>{O(new ne(k.READ_LOCAL_AUDIO_FILE_ERROR))},L.readAsArrayBuffer(_)});let N=await(function(w){let O=cm();return new we((L,M)=>{O.decodeAudioData(w,B=>{L(B)},B=>{M(new ne(k.DECODE_AUDIO_FILE_FAILED,B.toString()))})})})(R);return typeof _=="string"&&E&&q2.set(_,N),N})(n,i)}catch(_){return l.onError(_),_.throw(y)}let h=new J8(n),p=new X8(d,h,r?hR(r):{},c);return y.info("create buffer source audio track success, trackId:",c),l.onSuccess(p.getTrackId()),p},setAppType:function(e){if(y.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw y.debug("Invalid appType"),new $(k.INVALID_PARAMS,"invalid app type",e);Ht("APP_TYPE",Math.floor(e))},setLogLevel:function(e){y.setLogLevel(e)},enableLogUpload:function(){U("USE_NEW_LOG")?Ht("UPLOAD_LOG",!0):y.enableLogUpload()},disableLogUpload:function(){U("USE_NEW_LOG")?Ht("UPLOAD_LOG",!1):y.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new ZM},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,i=Fe.reportApiInvoke(null,{tag:pi.TRACER,name:Oi.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Ai||e instanceof um)){let d=new $(k.INVALID_TRACK,"the parameter is not a audio track");return i.onError(d),d.throw()}t&&t<1e3&&(t=1e3);let r=e instanceof Ai?e.getTrackLabel():"remote_track",n=e.getVolumeLevel(),s=n,c=n,l=Date.now();return new we(d=>{let h=setInterval(()=>{let p=e.getVolumeLevel();s=p>s?p:s,c=p<c?p:c;let _=s-c>1e-4,E=Date.now()-l;if(_||E>t){clearInterval(h);let R=_,N={duration:E,deviceLabel:r,maxVolumeLevel:s,result:R};y.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(N))),i.onSuccess(N),d(R)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,i=Fe.reportApiInvoke(null,{tag:pi.TRACER,name:Oi.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof ai||e instanceof dm)){let _=new $(k.INVALID_TRACK,"the parameter is not a video track");return i.onError(_),_.throw()}t&&t<1e3&&(t=1e3);let r=e instanceof ai?e.getTrackLabel():"remote_track",n=e.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(Rr()||eR())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([n]),s.play();let c=document.createElement("canvas");c.width=160,c.height=120;let l=0,d=0;try{let _=Date.now();l=await(function(E,R,N,w){let O,L=0,M=null;return new we((B,Y)=>{function H(){L>w&&O&&(O(),B(L));let G=N.getContext("2d");if(!G){let he=new $(k.UNEXPECTED_ERROR,"can not get canvas 2d context.");return y.error(he.toString()),void Y(he)}G.drawImage(E,0,0,160,120);let Q=G.getImageData(0,0,N.width,N.height),ce=Math.floor(Q.data.length/3);if(M){for(let he=0;he<ce;he+=3)if(Q.data[he]!==M[he])return L+=1,void(M=Q.data);M=Q.data}else M=Q.data}setTimeout(()=>{O&&(O(),B(L))},R),O=gw(()=>{H()},30)})})(s,t,c,4),d=Date.now()-_}catch(_){throw i.onError(_),_}mG===Pt.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;let h=l>4,p={duration:d,changedPicNum:l,deviceLabel:r,result:h};return y.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(p))),i.onSuccess(p),h},setArea:$w,audioElementPlayCenter:vn,resumeAudioContext:function(){vn.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){PG.processExternalMediaAEC(e)},registerExtensions:function(e){let t=U("PLUGIN_INFO")||[];e.forEach(i=>{"name"in i&&!ve(t).call(t,i.name)&&t.push(i.name);let r=i;r.__registered__=!0,r.logger.hookLog=y.extLog,r.reporter.hookApiInvoke=Fe.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(n=>{r.parameters[n]=U(n)})}),JV("PLUGIN_INFO",t)},ChannelMediaRelayError:fm,ChannelMediaRelayEvent:ll,ChannelMediaRelayState:xn,RemoteStreamFallbackType:G8,RemoteStreamType:F8,ConnectionDisconnectedReason:Bt,AudienceLatencyLevelType:g8,AREAS:Mt,preload:async function(e,t,i,r){return vx(e,t,i,r)}});return Object.defineProperties(zi,{onAudioAutoplayFailed:{get:()=>va.onAudioAutoplayFailed,set:e=>{va.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>va.onAutoplayFailed,set:e=>{va.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>zi._onSecurityPolicyViolation,set(e){zi._onSecurityPolicyViolation=e,NU(e)}},__CLIENT_LIST__:{get:()=>U("SHOW_GLOBAL_CLIENT_LIST")?Oh:[]}}),Ta.on(bh.CAMERA_DEVICE_CHANGED,e=>{y.info("camera device changed",JSON.stringify(e)),zi.onCameraChanged&&zi.onCameraChanged(e),zi.safeEmit(ac.CAMERA_CHANGED,e)}),Ta.on(bh.RECORDING_DEVICE_CHANGED,e=>{y.info("microphone device changed",JSON.stringify(e)),zi.onMicrophoneChanged&&zi.onMicrophoneChanged(e),zi.safeEmit(ac.MICROPHONE_CHANGED,e)}),Ta.on(bh.PLAYOUT_DEVICE_CHANGED,e=>{y.debug("playout device changed",JSON.stringify(e)),zi.onPlaybackDeviceChanged&&zi.onPlaybackDeviceChanged(e),zi.safeEmit(ac.PLAYBACK_DEVICE_CHANGED,e)}),vn.onAutoplayFailed=()=>{y.info("detect audio element autoplay failed"),va.onAudioAutoplayFailed&&va.onAudioAutoplayFailed()},Wt.on("autoplay-failed",()=>{y.info("detect webaudio autoplay failed"),va.onAudioAutoplayFailed&&va.onAudioAutoplayFailed(),zi.safeEmit(ac.AUTOPLAY_FAILED)}),Wt.on(_r.STATE_CHANGE,(e,t)=>{y.info("audio context state changed: ".concat(t," => ").concat(e)),zi.onAudioContextStateChanged&&zi.onAudioContextStateChanged(e,t),zi.safeEmit(ac.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Bi.on(Jf.NETWORK_STATE_CHANGE,(e,t)=>{y.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=zi),zi})}),A5={};RY(A5,{AgoraRTCProvider:()=>PY,AgoraRTCReactError:()=>ta,AgoraRTCScreenShareProvider:()=>kY,LocalAudioTrack:()=>N5,LocalUser:()=>iq,LocalVideoTrack:()=>L5,RemoteAudioTrack:()=>M5,RemoteUser:()=>rq,RemoteVideoTrack:()=>x5,TrackBoundary:()=>$Y,VERSION:()=>sq,default:()=>U5,useAutoPlayAudioTrack:()=>kO,useAutoPlayVideoTrack:()=>LO,useClientEvent:()=>NY,useConnectionState:()=>xY,useCurrentUID:()=>UY,useIsConnected:()=>Vm,useJoin:()=>VY,useLocalCameraTrack:()=>KY,useLocalMicrophoneTrack:()=>WY,useLocalScreenTrack:()=>ZY,useNetworkQuality:()=>BY,usePublish:()=>FY,useRTCClient:()=>Eo,useRTCScreenShareClient:()=>MY,useRemoteAudioTracks:()=>YY,useRemoteUserTrack:()=>EO,useRemoteUsers:()=>XY,useRemoteVideoTracks:()=>qY,useTrackEvent:()=>DY,useVolumeLevel:()=>GY});var CY=Xh(Jh());function Fn(m,g,T){return m.on(g,T),()=>m.off(g,T)}function bY(m){try{return m()}catch(g){console.error(g)}}function Zh(m){return()=>m.forEach(bY)}function AY(m,g){let T=setInterval(m,g);return()=>clearInterval(T)}function jy(m,g){let T=setTimeout(m,g);return()=>clearTimeout(T)}function DO(){let m,g,T;function S(){if(g){let V=g;g=void 0,V()}}async function b(){if(T){let V=T;T=void 0;try{await V()}catch(q){console.error(q)}}}async function I(V){m=!0,await b();try{T=await V()}catch(q){console.error(q)}m=!1,S()}async function x(){m=!0,await b(),m=!1,S()}function z(V){m?g=()=>I(V):I(V)}function P(){m?g=x:x()}return{run:z,dispose:P}}var Fy=typeof document<"u"?te.useLayoutEffect:te.useEffect;function wY(m){return m!=null&&typeof m.then=="function"}function $d(){let m=te.useRef(!1);return te.useEffect(()=>(m.current=!1,()=>{m.current=!0}),[]),m}function IY(){let m=$d();function g(T,S){return new Promise(async(b,I)=>{try{let x=await T;m.current||b(x)}catch(x){m.current?S&&S(x):I(x)}})}return te.useCallback(g,[m])}function w5(m){let g=IY(),[T,S]=te.useState();return Fy(()=>{wY(m)?g(m).then(S):S(m)},[m,g]),T}function Qh(m,g){let T=te.useRef();te.useEffect(()=>{let{run:S,dispose:b}=T.current||=DO();return S(m),b},g)}function OY(m,g){let T=m.split("."),S=g.split("."),b=Math.max(T.length,S.length);for(let I=0;I<b;I++){let x=parseInt(T[I]||"0"),z=parseInt(S[I]||"0");if(x>z)return 1;if(x<z)return-1}return 0}function NY(m,g,T){let S=te.useRef(T);Fy(()=>{S.current=T},[T]),te.useEffect(()=>{if(m)return Fn(m,g,(...b)=>{S.current&&S.current(...b)})},[g,m])}function DY(m,g,T){let S=te.useRef(T);Fy(()=>{S.current=T},[T]),te.useEffect(()=>{if(m)return Fn(m,g,(...b)=>{S.current&&S.current(...b)})},[g,m])}var I5=te.createContext(null);function PY({client:m,children:g}){return J.jsx(I5.Provider,{value:m,children:g})}function LY(m){let g=te.useContext(I5);return m||g}function Eo(m){let g=LY(m);if(!g)throw new Error("Agora RTC client not found. Should be wrapped in <AgoraRTCProvider value={client} />");return g}var O5=te.createContext(null);function kY({client:m,children:g}){return J.jsx(O5.Provider,{value:m,children:g})}function MY(m){let g=te.useContext(O5);return m||g}function xY(m){let g=Eo(m),[T,S]=te.useState(g?g.connectionState:"DISCONNECTED");return te.useEffect(()=>{if(g){S(g.connectionState);let b;return Zh([Fn(g,"connection-state-change",I=>{b?.(),I==="CONNECTED"?b=jy(()=>S(I),0):S(I)}),()=>b?.()])}else S("DISCONNECTED")},[g]),T}function Vm(m){let g=Eo(m),[T,S]=te.useState(g?g.connectionState==="CONNECTED":!1);return te.useEffect(()=>{if(g){S(g.connectionState==="CONNECTED");let b;return Zh([Fn(g,"connection-state-change",I=>{b?.(),b=jy(()=>S(I==="CONNECTED"),0)}),()=>b?.()])}else S(!1)},[g]),T}function UY(m){let g=Eo(m),[T,S]=te.useState(g?.uid);return te.useEffect(()=>{if(g)return Fn(g,"connection-state-change",b=>{if(b==="CONNECTED")return jy(()=>S(g.uid),0);b==="DISCONNECTED"&&S(void 0)})},[g]),T}var ta=class extends Error{rtcMethod;rtcError;name="AgoraRTCReactException";constructor(m,g){typeof g=="string"?super(g):super(g.message),this.rtcMethod=m,this.rtcError=g}log(m){console[m](this)}};function VY(m,g=!0,T){let S=Eo(T),b=Vm(T),I=te.useRef(),[x,z]=te.useState(!1),[P,V]=te.useState(0),[q,X]=te.useState(null),se=$d();return Qh(async()=>{if(se.current||(X(null),V(0),z(!1)),g&&S){try{se.current||z(!0);let{appid:ue,channel:ae,token:oe,uid:Ae}=typeof m=="function"?await m():m,be=await S.join(ue,ae,oe,Ae);se.current||V(be)}catch(ue){console.error(ue),se.current||X(new ta("IAgoraRTCClient.join",ue))}se.current||z(!1);let re=I.current||=DO();return Zh([()=>{re.dispose()},()=>{re.run(()=>S.unpublish(S.localTracks))},()=>{for(let ue of S.localTracks)ue.isPlaying&&ue.stop(),ue.close();re.run(()=>S.leave())}])}},[g,T]),{data:P,isLoading:x,isConnected:b,error:q}}var w3=()=>({uplinkNetworkQuality:0,downlinkNetworkQuality:0,delay:0});function BY(m){let g=Eo(m),[T,S]=te.useState(w3);return te.useEffect(()=>{if(g)return Fn(g,"network-quality",b=>S({uplinkNetworkQuality:b.uplinkNetworkQuality,downlinkNetworkQuality:b.downlinkNetworkQuality,delay:g.getRTCStats().RTT??0}));S(w3())},[g]),T}var jY=Xh(Jh());function FY(m,g=!0,T){let S=Eo(T),b=Vm(T),I=te.useRef([]),[x,z]=te.useState(!1),[P,V]=te.useState(null),q=$d();return Qh(async()=>{if(q.current||(z(!1),V(null)),!S||!b||!g)return;let X=m.filter(Boolean),se=ae=>{let oe=OY(jY.default.VERSION,"4.18.2")>=0;return oe||new ta("usePublish","please check your agora-rtc-sdk-ng version in package.json, it's recommend upgrade to >= 4.18.2").log("warn"),oe?S.mode!=="live"||S.role!=="audience":!0},re=ae=>I.current.some(oe=>oe&&oe.getTrackId()===ae.getTrackId()),ue=ae=>se()&&ae.enabled&&g&&!re(ae);for(let ae=0;ae<X.length;ae++){let oe=X[ae];if(oe&&ue(oe)){await S.unpublish(I.current.filter(Ae=>Ae?.trackMediaType===oe.trackMediaType));try{q.current||z(!0),await S.publish(oe)}catch(Ae){console.error(Ae),q.current||V(new ta("IAgoraRTCClient.publish",Ae))}q.current||z(!1)}}I.current=X},[b,g,S,m]),{isLoading:x,error:P}}function GY(m){let[g,T]=te.useState(0);return te.useEffect(()=>{if(m)return AY(()=>{T(m.getVolumeLevel())},1e3)},[m]),g}var HY=Xh(Jh());function WY(m=!0,g={ANS:!0,AEC:!0}){let[T,S]=te.useState(null),[b,I]=te.useState(!1),[x,z]=te.useState(null),P=$d();return Qh(async()=>{if(P.current||(I(!1),z(null)),m&&!T){try{P.current||I(!0);let V=await HY.default.createMicrophoneAudioTrack(g);P.current||S(V)}catch(V){console.error(V),P.current||z(new ta("IAgoraRTC.createMicrophoneAudioTrack",V))}P.current||I(!1)}},[m]),{localMicrophoneTrack:T,isLoading:b,error:x}}var zY=Xh(Jh());function KY(m=!0,g){let[T,S]=te.useState(null),[b,I]=te.useState(!1),[x,z]=te.useState(null),P=$d();return Qh(async()=>{if(P.current||(I(!1),z(null)),m&&!T){try{P.current||I(!0);let V=await zY.default.createCameraVideoTrack(g);P.current||S(V)}catch(V){console.error(V),P.current||z(new ta("IAgoraRTC.createCameraVideoTrack",V))}P.current||I(!1)}},[m]),{localCameraTrack:T,isLoading:b,error:x}}function YY(m,g){let T=Eo(g),[S,b]=te.useState([]),I=Vm(),x=te.useRef([]),[z,P]=te.useState(!1),[V,q]=te.useState(null),X=$d();return Qh(async()=>{if(X.current||q(null),!Array.isArray(m)||!I)return;let se=async ae=>{if(!ae.audioTrack&&m.some(({uid:oe})=>ae.uid===oe)){try{X.current||P(!0),await T.subscribe(ae,"audio")}catch(oe){console.error(oe),X.current||q(new ta("IAgoraRTCClient.subscribe",oe))}ae.audioTrack&&!x.current.some(oe=>oe.getUserId()===ae.uid)&&x.current.push(ae.audioTrack),x.current=x.current.map(oe=>ae.audioTrack&&oe.getUserId()===ae.uid&&oe.getTrackId()!==ae.audioTrack.getTrackId()?ae.audioTrack:oe),X.current||(b([...x.current]),P(!1))}},re=async ae=>{if(m.some(({uid:oe})=>ae.uid===oe)){X.current||(x.current=x.current.filter(oe=>oe.getUserId()!==ae.uid),b([...x.current]));try{X.current||P(!0),await T.unsubscribe(ae,"audio")}catch(oe){console.error(oe),X.current||q(new ta("IAgoraRTCClient.unsubscribe",oe))}X.current||P(!1)}};m.map(ae=>{!ae.audioTrack&&ae.hasAudio&&se(ae)});let ue=[];for(let ae=0;ae<x.current.length;ae++){let oe=x.current[ae];if(!m.some(Ae=>Ae.uid===oe.getUserId())){let Ae=T.remoteUsers.find(be=>be.uid===oe.getUserId());Ae&&ue.push({user:Ae,mediaType:"audio"}),x.current.splice(ae,1),ae--}}if(ue.length>0){try{X.current||P(!0),await T.massUnsubscribe(ue)}catch(ae){console.error(ae),X.current||q(new ta("IAgoraRTCClient.massUnsubscribe",ae))}X.current||(b(x.current.slice()),P(!1))}return Zh([Fn(T,"user-published",(ae,oe)=>{m.find(Ae=>Ae.uid===ae.uid)&&oe==="audio"&&se(ae)}),Fn(T,"user-unpublished",(ae,oe)=>{m.find(Ae=>Ae.uid===ae.uid)&&oe==="audio"&&re(ae)})])},[I,T,m]),{audioTracks:S,isLoading:z,error:V}}function qY(m,g){let T=Eo(g),[S,b]=te.useState([]),I=Vm(),x=te.useRef([]),[z,P]=te.useState(!1),[V,q]=te.useState(null),X=$d();return Qh(async()=>{if(X.current||q(null),!Array.isArray(m)||!I)return;let se=async ae=>{if(!ae.videoTrack&&m.some(({uid:oe})=>ae.uid===oe)){try{X.current||P(!0),await T.subscribe(ae,"video")}catch(oe){console.error(oe),X.current||q(new ta("IAgoraRTCClient.subscribe",oe))}ae.videoTrack&&!x.current.some(oe=>oe.getUserId()===ae.uid)&&x.current.push(ae.videoTrack),x.current=x.current.map(oe=>ae.videoTrack&&oe.getUserId()===ae.uid&&oe.getTrackId()!==ae.videoTrack.getTrackId()?ae.videoTrack:oe),X.current||(b([...x.current]),P(!1))}},re=async ae=>{if(m.some(({uid:oe})=>ae.uid===oe)){X.current||(x.current=x.current.filter(oe=>oe.getUserId()!==ae.uid),b([...x.current]));try{X.current||P(!0),await T.unsubscribe(ae,"video")}catch(oe){console.error(oe),X.current||q(new ta("IAgoraRTCClient.unsubscribe",oe))}X.current||P(!1)}};m.map(ae=>{!ae.videoTrack&&ae.hasVideo&&se(ae)});let ue=[];for(let ae=0;ae<x.current.length;ae++){let oe=x.current[ae];if(!m.some(Ae=>Ae.uid===oe.getUserId())){let Ae=T.remoteUsers.find(be=>be.uid===oe.getUserId());Ae&&ue.push({user:Ae,mediaType:"video"}),x.current.splice(ae,1),ae--}}if(ue.length>0){try{X.current||P(!0),await T.massUnsubscribe(ue)}catch(ae){console.error(ae),X.current||q(new ta("IAgoraRTCClient.massUnsubscribe",ae))}X.current||(b(x.current.slice()),P(!1))}return Zh([Fn(T,"user-published",(ae,oe)=>{m.find(Ae=>Ae.uid===ae.uid)&&oe==="video"&&se(ae)}),Fn(T,"user-unpublished",(ae,oe)=>{m.find(Ae=>Ae.uid===ae.uid)&&oe==="video"&&re(ae)})])},[I,T,m]),{videoTracks:S,isLoading:z,error:V}}function EO(m,g,T){let S=Eo(T),b=g==="audio"?"audioTrack":"videoTrack",[I,x]=te.useState(m&&m[b]),z=Vm(),P=te.useRef(),[V,q]=te.useState(!1),[X,se]=te.useState(null);return te.useEffect(()=>{if(!m||!z)return;let re=!1;re||se(null);let ue=g==="audio"?"hasAudio":"hasVideo",ae=m.uid,oe=async(Oe,Xe)=>{if(Oe[b]&&S.remoteUsers.some(({uid:Ue})=>Oe.uid===Ue))try{re||q(!0),await S.unsubscribe(Oe,Xe)}catch(Ue){re||se(new ta("IAgoraRTCClient.unsubscribe",Ue)),console.error(Ue)}re||(x(void 0),q(!1))},Ae=async(Oe,Xe)=>{try{!Oe[b]&&S.remoteUsers.some(({uid:Ue})=>Oe.uid===Ue)&&(re||q(!0),await S.subscribe(Oe,Xe)),re||x(Oe[b])}catch(Ue){re||se(new ta("IAgoraRTCClient.subscribe",Ue)),console.error(Ue)}re||q(!1)},be=P.current||=DO();return!m[b]&&m[ue]?be.run(()=>Ae(m,g)):x(m[b]),Zh([()=>{re=!0,be.dispose()},Fn(S,"user-published",(Oe,Xe)=>{Oe.uid===ae&&Xe===g&&be.run(()=>Ae(Oe,g))}),Fn(S,"user-unpublished",(Oe,Xe)=>{Oe.uid===ae&&Xe===g&&be.run(()=>oe(Oe,g))})])},[z,S,m,g,b]),{track:I,isLoading:V,error:X}}function XY(m){let g=Eo(m),[T,S]=te.useState(g?g.remoteUsers:[]);return te.useEffect(()=>{if(g){let b=()=>S(g.remoteUsers.slice());return Zh([Fn(g,"user-joined",b),Fn(g,"user-left",b),Fn(g,"user-published",b),Fn(g,"user-unpublished",b)])}},[g]),T}var JY=Xh(Jh());function ZY(m=!0,g,T){let[S,b]=te.useState(null),[I,x]=te.useState(!1),[z,P]=te.useState(null),V=$d();return Qh(async()=>{if(V.current||(x(!1),P(null)),m&&!S){try{V.current||x(!0);let q=await JY.default.createScreenVideoTrack(g,T);V.current||b(q)}catch(q){console.error(q),V.current||P(new ta("IAgoraRTC.createScreenVideoTrack",q))}V.current||x(!1)}},[m]),{screenTrack:S,isLoading:I,error:z}}function QY(){let m=new Map,g=1500;return{onMount:T=>{let S=m.get(T);S&&(S(),m.delete(T))},onUnmount:T=>{let S=m.get(T);S&&S(),m.set(T,jy(()=>{T.isPlaying&&T.stop(),m.delete(T)},g))},dispose:()=>{for(let[T,S]of m)T.isPlaying&&T.stop(),S&&S();m.clear()}}}var PO=te.createContext(void 0);function $Y({children:m}){let[g]=te.useState(QY);return te.useEffect(()=>g.dispose,[g]),J.jsx(PO.Provider,{value:g,children:m})}function LO(m,g,T,S){let b=te.useContext(PO);te.useEffect(()=>{if(m)return S&&g?m.play(S,T||void 0):m.stop(),b?(b.onMount(m),()=>b.onUnmount(m)):()=>{m.isPlaying&&m.stop()}},[m,S,g,b,T])}function kO(m,g){let T=te.useContext(PO);Fy(()=>{if(m)return g?m.play():m.stop(),T?(T.onMount(m),()=>T.onUnmount(m)):()=>{m.isPlaying&&m.stop()}},[m,g,T])}function N5({track:m,play:g=!1,volume:T,disabled:S,muted:b,children:I}){let x=w5(m);return kO(x,g),te.useEffect(()=>{x&&T!=null&&x.setVolume(T)},[x,T]),te.useEffect(()=>{x&&S!=null&&x.setEnabled(!S).catch(console.warn)},[S,x]),te.useEffect(()=>{x&&b!=null&&x.setMuted(b).catch(console.warn)},[b,x]),I?J.jsx(J.Fragment,{children:I}):null}var D5={position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"#000"},P5={width:"100%",height:"100%"},MO={position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",zIndex:2},Gy=(m,g)=>te.useMemo(()=>({...m,...g}),[m,g]);function L5({track:m,play:g,disabled:T,muted:S,style:b,videoPlayerConfig:I,...x}){let z=Gy(P5,b),[P,V]=te.useState(null),q=w5(m);return LO(q,g,I,P),te.useEffect(()=>{q&&T!=null&&q.setEnabled(!T).catch(console.warn)},[T,q]),te.useEffect(()=>{q&&S!=null&&q.setMuted(S).catch(console.warn)},[S,q]),J.jsx("div",{...x,ref:V,style:z})}var eq={width:"100%",height:"100%",background:"#1a1e21 center/cover no-repeat",filter:"blur(16px) brightness(0.4)"},tq={position:"absolute",top:"50%",left:"50%",maxWidth:"50%",maxHeight:"50%",aspectRatio:"1",transform:"translate(-50%, -50%)",borderRadius:"50%",overflow:"hidden",objectFit:"cover"};function k5({cover:m}){return J.jsx("div",{style:MO,children:typeof m=="string"?J.jsxs(J.Fragment,{children:[J.jsx("div",{style:{...eq,backgroundImage:`url(${m})`}}),J.jsx("img",{src:m,style:tq})]}):m()})}function iq({micOn:m,cameraOn:g,audioTrack:T,videoTrack:S,playAudio:b,playVideo:I,volume:x,cover:z,children:P,style:V,...q}){let X=Gy(D5,V);return I=I??!!g,b=b??!!m,J.jsxs("div",{...q,style:X,children:[J.jsx(L5,{disabled:!g,play:I,track:S}),J.jsx(N5,{disabled:!m,play:b,track:T,volume:x}),z&&!g&&J.jsx(k5,{cover:z}),J.jsx("div",{style:MO,children:P})]})}function M5({track:m,play:g=!1,playbackDeviceId:T,volume:S,children:b}){return kO(m,g),te.useEffect(()=>{m&&T!=null&&m.setPlaybackDevice(T).catch(console.warn)},[m,T]),te.useEffect(()=>{m&&S!=null&&m.setVolume(S)},[m,S]),b?J.jsx(J.Fragment,{children:b}):null}function x5({track:m,play:g,style:T,videoPlayerConfig:S,...b}){let I=Gy(P5,T),[x,z]=te.useState(null);return LO(m,g,S,x),J.jsx("div",{...b,ref:z,style:I})}function rq({user:m,playVideo:g,playAudio:T,playbackDeviceId:S,volume:b,cover:I,style:x,children:z,videoPlayerConfig:P,...V}){let q=Gy(D5,x),{track:X}=EO(m,"video"),{track:se}=EO(m,"audio");return g=g??m?.hasVideo,T=T??m?.hasAudio,J.jsxs("div",{...V,style:q,children:[J.jsx(x5,{play:g,track:X,videoPlayerConfig:P}),J.jsx(M5,{play:T,playbackDeviceId:S,track:se,volume:b}),I&&!g&&J.jsx(k5,{cover:I}),J.jsx("div",{style:MO,children:z})]})}var nq=Xh(Jh()),aq=class{appType=1001;constructor(){nq.default.setAppType(this.appType)}};new aq;var sq="2.5.0";yY(A5,Xh(Jh()));var U5=CY.default;const oq={WARNING:2};U5.setLogLevel(oq.WARNING);M7.createRoot(document.getElementById("root")).render(J.jsx(te.StrictMode,{children:J.jsx(mY,{})}));
